function EventAggregator(handler,timeout,dataPolicy,latency,maxDelays,delayTimeout){this.handler=handler;this.timeout=timeout||1e3;if(latency===0){this.latency=0}else{this.latency=latency||this.timeout}this.maxDelays=maxDelays||0;if(delayTimeout===0){this.delayTimeout=0}else{this.delayTimeout=delayTimeout||this.timeout/2}this.dataPolicy=dataPolicy||EventAggregator.DP_NONE;this.timer=null;this.clear()}EventAggregator.DP_NONE=0;EventAggregator.DP_FIRST=1;EventAggregator.DP_LAST=2;EventAggregator.DP_COUNT=3;EventAggregator.DP_ALL=4;EventAggregator.prototype.setTimeout=function(delay){var owner=this;return setTimeout(function(){owner.fired()},delay)};EventAggregator.prototype.fireNow=function(){if(this.count>0){var count=this.count;var data=this.data;this.cancel();this.clear();switch(this.dataPolicy){case EventAggregator.DP_FIRST:case EventAggregator.DP_LAST:case EventAggregator.DP_ALL:this.handler(data);break;case EventAggregator.DP_COUNT:this.handler(count);break;default:this.handler()}if(this.latency>0){this.timer=this.setTimeout(this.latency)}}};EventAggregator.prototype.update=function(data){switch(this.dataPolicy){case EventAggregator.DP_FIRST:if(this.count===0){this.data=data}break;case EventAggregator.DP_LAST:this.data=data;break;case EventAggregator.DP_ALL:this.data.push(data);break}this.count++;if(this.timer===null){this.timer=this.setTimeout(this.timeout)}else if(this.count>1){this.burst=true}};EventAggregator.prototype.fired=function(){if(this.burst&&this.delays<this.maxDelays){this.burst=false;this.delays++;this.timer=this.setTimeout(this.delayTimeout)}else{this.timer=null;this.fireNow()}};EventAggregator.prototype.cancel=function(){if(this.timer!==null){clearTimeout(this.timer);this.timer=null}};EventAggregator.prototype.clear=function(){if(this.dataPolicy===EventAggregator.DP_ALL){this.data=[]}else{this.data=undefined}this.burst=false;this.delays=0;this.count=0};(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define([],factory);else if(typeof exports==="object")exports["Handlebars"]=factory();else root["Handlebars"]=factory()})(this,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)}([function(module,exports,__webpack_require__){"use strict";var _interopRequireWildcard=__webpack_require__(1)["default"];var _interopRequireDefault=__webpack_require__(2)["default"];exports.__esModule=true;var _handlebarsBase=__webpack_require__(3);var base=_interopRequireWildcard(_handlebarsBase);var _handlebarsSafeString=__webpack_require__(32);var _handlebarsSafeString2=_interopRequireDefault(_handlebarsSafeString);var _handlebarsException=__webpack_require__(5);var _handlebarsException2=_interopRequireDefault(_handlebarsException);var _handlebarsUtils=__webpack_require__(4);var Utils=_interopRequireWildcard(_handlebarsUtils);var _handlebarsRuntime=__webpack_require__(33);var runtime=_interopRequireWildcard(_handlebarsRuntime);var _handlebarsNoConflict=__webpack_require__(38);var _handlebarsNoConflict2=_interopRequireDefault(_handlebarsNoConflict);function create(){var hb=new base.HandlebarsEnvironment;Utils.extend(hb,base);hb.SafeString=_handlebarsSafeString2["default"];hb.Exception=_handlebarsException2["default"];hb.Utils=Utils;hb.escapeExpression=Utils.escapeExpression;hb.VM=runtime;hb.template=function(spec){return runtime.template(spec,hb)};return hb}var inst=create();inst.create=create;_handlebarsNoConflict2["default"](inst);inst["default"]=inst;exports["default"]=inst;module.exports=exports["default"]},function(module,exports){"use strict";exports["default"]=function(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj["default"]=obj;return newObj}};exports.__esModule=true},function(module,exports){"use strict";exports["default"]=function(obj){return obj&&obj.__esModule?obj:{default:obj}};exports.__esModule=true},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(2)["default"];exports.__esModule=true;exports.HandlebarsEnvironment=HandlebarsEnvironment;var _utils=__webpack_require__(4);var _exception=__webpack_require__(5);var _exception2=_interopRequireDefault(_exception);var _helpers=__webpack_require__(9);var _decorators=__webpack_require__(29);var _logger=__webpack_require__(31);var _logger2=_interopRequireDefault(_logger);var VERSION="4.5.3";exports.VERSION=VERSION;var COMPILER_REVISION=8;exports.COMPILER_REVISION=COMPILER_REVISION;var LAST_COMPATIBLE_COMPILER_REVISION=7;exports.LAST_COMPATIBLE_COMPILER_REVISION=LAST_COMPATIBLE_COMPILER_REVISION;var REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};exports.REVISION_CHANGES=REVISION_CHANGES;var objectType="[object Object]";function HandlebarsEnvironment(helpers,partials,decorators){this.helpers=helpers||{};this.partials=partials||{};this.decorators=decorators||{};_helpers.registerDefaultHelpers(this);_decorators.registerDefaultDecorators(this)}HandlebarsEnvironment.prototype={constructor:HandlebarsEnvironment,logger:_logger2["default"],log:_logger2["default"].log,registerHelper:function registerHelper(name,fn){if(_utils.toString.call(name)===objectType){if(fn){throw new _exception2["default"]("Arg not supported with multiple helpers")}_utils.extend(this.helpers,name)}else{this.helpers[name]=fn}},unregisterHelper:function unregisterHelper(name){delete this.helpers[name]},registerPartial:function registerPartial(name,partial){if(_utils.toString.call(name)===objectType){_utils.extend(this.partials,name)}else{if(typeof partial==="undefined"){throw new _exception2["default"]('Attempting to register a partial called "'+name+'" as undefined')}this.partials[name]=partial}},unregisterPartial:function unregisterPartial(name){delete this.partials[name]},registerDecorator:function registerDecorator(name,fn){if(_utils.toString.call(name)===objectType){if(fn){throw new _exception2["default"]("Arg not supported with multiple decorators")}_utils.extend(this.decorators,name)}else{this.decorators[name]=fn}},unregisterDecorator:function unregisterDecorator(name){delete this.decorators[name]}};var log=_logger2["default"].log;exports.log=log;exports.createFrame=_utils.createFrame;exports.logger=_logger2["default"]},function(module,exports){"use strict";exports.__esModule=true;exports.extend=extend;exports.indexOf=indexOf;exports.escapeExpression=escapeExpression;exports.isEmpty=isEmpty;exports.createFrame=createFrame;exports.blockParams=blockParams;exports.appendContextPath=appendContextPath;var escape={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"};var badChars=/[&<>"'`=]/g,possible=/[&<>"'`=]/;function escapeChar(chr){return escape[chr]}function extend(obj){for(var i=1;i<arguments.length;i++){for(var key in arguments[i]){if(Object.prototype.hasOwnProperty.call(arguments[i],key)){obj[key]=arguments[i][key]}}}return obj}var toString=Object.prototype.toString;exports.toString=toString;var isFunction=function isFunction(value){return typeof value==="function"};if(isFunction(/x/)){exports.isFunction=isFunction=function(value){return typeof value==="function"&&toString.call(value)==="[object Function]"}}exports.isFunction=isFunction;var isArray=Array.isArray||function(value){return value&&typeof value==="object"?toString.call(value)==="[object Array]":false};exports.isArray=isArray;function indexOf(array,value){for(var i=0,len=array.length;i<len;i++){if(array[i]===value){return i}}return-1}function escapeExpression(string){if(typeof string!=="string"){if(string&&string.toHTML){return string.toHTML()}else if(string==null){return""}else if(!string){return string+""}string=""+string}if(!possible.test(string)){return string}return string.replace(badChars,escapeChar)}function isEmpty(value){if(!value&&value!==0){return true}else if(isArray(value)&&value.length===0){return true}else{return false}}function createFrame(object){var frame=extend({},object);frame._parent=object;return frame}function blockParams(params,ids){params.path=ids;return params}function appendContextPath(contextPath,id){return(contextPath?contextPath+".":"")+id}},function(module,exports,__webpack_require__){"use strict";var _Object$defineProperty=__webpack_require__(6)["default"];exports.__esModule=true;var errorProps=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function Exception(message,node){var loc=node&&node.loc,line=undefined,endLineNumber=undefined,column=undefined,endColumn=undefined;if(loc){line=loc.start.line;endLineNumber=loc.end.line;column=loc.start.column;endColumn=loc.end.column;message+=" - "+line+":"+column}var tmp=Error.prototype.constructor.call(this,message);for(var idx=0;idx<errorProps.length;idx++){this[errorProps[idx]]=tmp[errorProps[idx]]}if(Error.captureStackTrace){Error.captureStackTrace(this,Exception)}try{if(loc){this.lineNumber=line;this.endLineNumber=endLineNumber;if(_Object$defineProperty){Object.defineProperty(this,"column",{value:column,enumerable:true});Object.defineProperty(this,"endColumn",{value:endColumn,enumerable:true})}else{this.column=column;this.endColumn=endColumn}}}catch(nop){}}Exception.prototype=new Error;exports["default"]=Exception;module.exports=exports["default"]},function(module,exports,__webpack_require__){module.exports={default:__webpack_require__(7),__esModule:true}},function(module,exports,__webpack_require__){var $=__webpack_require__(8);module.exports=function defineProperty(it,key,desc){return $.setDesc(it,key,desc)}},function(module,exports){var $Object=Object;module.exports={create:$Object.create,getProto:$Object.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:$Object.getOwnPropertyDescriptor,setDesc:$Object.defineProperty,setDescs:$Object.defineProperties,getKeys:$Object.keys,getNames:$Object.getOwnPropertyNames,getSymbols:$Object.getOwnPropertySymbols,each:[].forEach}},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(2)["default"];exports.__esModule=true;exports.registerDefaultHelpers=registerDefaultHelpers;exports.moveHelperToHooks=moveHelperToHooks;var _helpersBlockHelperMissing=__webpack_require__(10);var _helpersBlockHelperMissing2=_interopRequireDefault(_helpersBlockHelperMissing);var _helpersEach=__webpack_require__(11);var _helpersEach2=_interopRequireDefault(_helpersEach);var _helpersHelperMissing=__webpack_require__(24);var _helpersHelperMissing2=_interopRequireDefault(_helpersHelperMissing);var _helpersIf=__webpack_require__(25);var _helpersIf2=_interopRequireDefault(_helpersIf);var _helpersLog=__webpack_require__(26);var _helpersLog2=_interopRequireDefault(_helpersLog);var _helpersLookup=__webpack_require__(27);var _helpersLookup2=_interopRequireDefault(_helpersLookup);var _helpersWith=__webpack_require__(28);var _helpersWith2=_interopRequireDefault(_helpersWith);function registerDefaultHelpers(instance){_helpersBlockHelperMissing2["default"](instance);_helpersEach2["default"](instance);_helpersHelperMissing2["default"](instance);_helpersIf2["default"](instance);_helpersLog2["default"](instance);_helpersLookup2["default"](instance);_helpersWith2["default"](instance)}function moveHelperToHooks(instance,helperName,keepHelper){if(instance.helpers[helperName]){instance.hooks[helperName]=instance.helpers[helperName];if(!keepHelper){delete instance.helpers[helperName]}}}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _utils=__webpack_require__(4);exports["default"]=function(instance){instance.registerHelper("blockHelperMissing",function(context,options){var inverse=options.inverse,fn=options.fn;if(context===true){return fn(this)}else if(context===false||context==null){return inverse(this)}else if(_utils.isArray(context)){if(context.length>0){if(options.ids){options.ids=[options.name]}return instance.helpers.each(context,options)}else{return inverse(this)}}else{if(options.data&&options.ids){var data=_utils.createFrame(options.data);data.contextPath=_utils.appendContextPath(options.data.contextPath,options.name);options={data:data}}return fn(context,options)}})};module.exports=exports["default"]},function(module,exports,__webpack_require__){(function(global){"use strict";var _Object$keys=__webpack_require__(12)["default"];var _interopRequireDefault=__webpack_require__(2)["default"];exports.__esModule=true;var _utils=__webpack_require__(4);var _exception=__webpack_require__(5);var _exception2=_interopRequireDefault(_exception);exports["default"]=function(instance){instance.registerHelper("each",function(context,options){if(!options){throw new _exception2["default"]("Must pass iterator to #each")}var fn=options.fn,inverse=options.inverse,i=0,ret="",data=undefined,contextPath=undefined;if(options.data&&options.ids){contextPath=_utils.appendContextPath(options.data.contextPath,options.ids[0])+"."}if(_utils.isFunction(context)){context=context.call(this)}if(options.data){data=_utils.createFrame(options.data)}function execIteration(field,index,last){if(data){data.key=field;data.index=index;data.first=index===0;data.last=!!last;if(contextPath){data.contextPath=contextPath+field}}ret=ret+fn(context[field],{data:data,blockParams:_utils.blockParams([context[field],field],[contextPath+field,null])})}if(context&&typeof context==="object"){if(_utils.isArray(context)){for(var j=context.length;i<j;i++){if(i in context){execIteration(i,i,i===context.length-1)}}}else if(global.Symbol&&context[global.Symbol.iterator]){var newContext=[];var iterator=context[global.Symbol.iterator]();for(var it=iterator.next();!it.done;it=iterator.next()){newContext.push(it.value)}context=newContext;for(var j=context.length;i<j;i++){execIteration(i,i,i===context.length-1)}}else{(function(){var priorKey=undefined;_Object$keys(context).forEach(function(key){if(priorKey!==undefined){execIteration(priorKey,i-1)}priorKey=key;i++});if(priorKey!==undefined){execIteration(priorKey,i-1,true)}})()}}if(i===0){ret=inverse(this)}return ret})};module.exports=exports["default"]}).call(exports,function(){return this}())},function(module,exports,__webpack_require__){module.exports={default:__webpack_require__(13),__esModule:true}},function(module,exports,__webpack_require__){__webpack_require__(14);module.exports=__webpack_require__(20).Object.keys},function(module,exports,__webpack_require__){var toObject=__webpack_require__(15);__webpack_require__(17)("keys",function($keys){return function keys(it){return $keys(toObject(it))}})},function(module,exports,__webpack_require__){var defined=__webpack_require__(16);module.exports=function(it){return Object(defined(it))}},function(module,exports){module.exports=function(it){if(it==undefined)throw TypeError("Can't call method on  "+it);return it}},function(module,exports,__webpack_require__){var $export=__webpack_require__(18),core=__webpack_require__(20),fails=__webpack_require__(23);module.exports=function(KEY,exec){var fn=(core.Object||{})[KEY]||Object[KEY],exp={};exp[KEY]=exec(fn);$export($export.S+$export.F*fails(function(){fn(1)}),"Object",exp)}},function(module,exports,__webpack_require__){var global=__webpack_require__(19),core=__webpack_require__(20),ctx=__webpack_require__(21),PROTOTYPE="prototype";var $export=function(type,name,source){var IS_FORCED=type&$export.F,IS_GLOBAL=type&$export.G,IS_STATIC=type&$export.S,IS_PROTO=type&$export.P,IS_BIND=type&$export.B,IS_WRAP=type&$export.W,exports=IS_GLOBAL?core:core[name]||(core[name]={}),target=IS_GLOBAL?global:IS_STATIC?global[name]:(global[name]||{})[PROTOTYPE],key,own,out;if(IS_GLOBAL)source=name;for(key in source){own=!IS_FORCED&&target&&key in target;if(own&&key in exports)continue;out=own?target[key]:source[key];exports[key]=IS_GLOBAL&&typeof target[key]!="function"?source[key]:IS_BIND&&own?ctx(out,global):IS_WRAP&&target[key]==out?function(C){var F=function(param){return this instanceof C?new C(param):C(param)};F[PROTOTYPE]=C[PROTOTYPE];return F}(out):IS_PROTO&&typeof out=="function"?ctx(Function.call,out):out;if(IS_PROTO)(exports[PROTOTYPE]||(exports[PROTOTYPE]={}))[key]=out}};$export.F=1;$export.G=2;$export.S=4;$export.P=8;$export.B=16;$export.W=32;module.exports=$export},function(module,exports){var global=module.exports=typeof window!="undefined"&&window.Math==Math?window:typeof self!="undefined"&&self.Math==Math?self:Function("return this")();if(typeof __g=="number")__g=global},function(module,exports){var core=module.exports={version:"1.2.6"};if(typeof __e=="number")__e=core},function(module,exports,__webpack_require__){var aFunction=__webpack_require__(22);module.exports=function(fn,that,length){aFunction(fn);if(that===undefined)return fn;switch(length){case 1:return function(a){return fn.call(that,a)};case 2:return function(a,b){return fn.call(that,a,b)};case 3:return function(a,b,c){return fn.call(that,a,b,c)}}return function(){return fn.apply(that,arguments)}}},function(module,exports){module.exports=function(it){if(typeof it!="function")throw TypeError(it+" is not a function!");return it}},function(module,exports){module.exports=function(exec){try{return!!exec()}catch(e){return true}}},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(2)["default"];exports.__esModule=true;var _exception=__webpack_require__(5);var _exception2=_interopRequireDefault(_exception);exports["default"]=function(instance){instance.registerHelper("helperMissing",function(){if(arguments.length===1){return undefined}else{throw new _exception2["default"]('Missing helper: "'+arguments[arguments.length-1].name+'"')}})};module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(2)["default"];exports.__esModule=true;var _utils=__webpack_require__(4);var _exception=__webpack_require__(5);var _exception2=_interopRequireDefault(_exception);exports["default"]=function(instance){instance.registerHelper("if",function(conditional,options){if(arguments.length!=2){throw new _exception2["default"]("#if requires exactly one argument")}if(_utils.isFunction(conditional)){conditional=conditional.call(this)}if(!options.hash.includeZero&&!conditional||_utils.isEmpty(conditional)){return options.inverse(this)}else{return options.fn(this)}});instance.registerHelper("unless",function(conditional,options){if(arguments.length!=2){throw new _exception2["default"]("#unless requires exactly one argument")}return instance.helpers["if"].call(this,conditional,{fn:options.inverse,inverse:options.fn,hash:options.hash})})};module.exports=exports["default"]},function(module,exports){"use strict";exports.__esModule=true;exports["default"]=function(instance){instance.registerHelper("log",function(){var args=[undefined],options=arguments[arguments.length-1];for(var i=0;i<arguments.length-1;i++){args.push(arguments[i])}var level=1;if(options.hash.level!=null){level=options.hash.level}else if(options.data&&options.data.level!=null){level=options.data.level}args[0]=level;instance.log.apply(instance,args)})};module.exports=exports["default"]},function(module,exports){"use strict";exports.__esModule=true;var dangerousPropertyRegex=/^(constructor|__defineGetter__|__defineSetter__|__lookupGetter__|__proto__)$/;exports.dangerousPropertyRegex=dangerousPropertyRegex;exports["default"]=function(instance){instance.registerHelper("lookup",function(obj,field){if(!obj){return obj}if(dangerousPropertyRegex.test(String(field))&&!Object.prototype.propertyIsEnumerable.call(obj,field)){return undefined}return obj[field]})}},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(2)["default"];exports.__esModule=true;var _utils=__webpack_require__(4);var _exception=__webpack_require__(5);var _exception2=_interopRequireDefault(_exception);exports["default"]=function(instance){instance.registerHelper("with",function(context,options){if(arguments.length!=2){throw new _exception2["default"]("#with requires exactly one argument")}if(_utils.isFunction(context)){context=context.call(this)}var fn=options.fn;if(!_utils.isEmpty(context)){var data=options.data;if(options.data&&options.ids){data=_utils.createFrame(options.data);data.contextPath=_utils.appendContextPath(options.data.contextPath,options.ids[0])}return fn(context,{data:data,blockParams:_utils.blockParams([context],[data&&data.contextPath])})}else{return options.inverse(this)}})};module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(2)["default"];exports.__esModule=true;exports.registerDefaultDecorators=registerDefaultDecorators;var _decoratorsInline=__webpack_require__(30);var _decoratorsInline2=_interopRequireDefault(_decoratorsInline);function registerDefaultDecorators(instance){_decoratorsInline2["default"](instance)}},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _utils=__webpack_require__(4);exports["default"]=function(instance){instance.registerDecorator("inline",function(fn,props,container,options){var ret=fn;if(!props.partials){props.partials={};ret=function(context,options){var original=container.partials;container.partials=_utils.extend({},original,props.partials);var ret=fn(context,options);container.partials=original;return ret}}props.partials[options.args[0]]=options.fn;return ret})};module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";exports.__esModule=true;var _utils=__webpack_require__(4);var logger={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function lookupLevel(level){if(typeof level==="string"){var levelMap=_utils.indexOf(logger.methodMap,level.toLowerCase());if(levelMap>=0){level=levelMap}else{level=parseInt(level,10)}}return level},log:function log(level){level=logger.lookupLevel(level);if(typeof console!=="undefined"&&logger.lookupLevel(logger.level)<=level){var method=logger.methodMap[level];if(!console[method]){method="log"}for(var _len=arguments.length,message=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){message[_key-1]=arguments[_key]}console[method].apply(console,message)}}};exports["default"]=logger;module.exports=exports["default"]},function(module,exports){"use strict";exports.__esModule=true;function SafeString(string){this.string=string}SafeString.prototype.toString=SafeString.prototype.toHTML=function(){return""+this.string};exports["default"]=SafeString;module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _Object$seal=__webpack_require__(34)["default"];var _interopRequireWildcard=__webpack_require__(1)["default"];var _interopRequireDefault=__webpack_require__(2)["default"];exports.__esModule=true;exports.checkRevision=checkRevision;exports.template=template;exports.wrapProgram=wrapProgram;exports.resolvePartial=resolvePartial;exports.invokePartial=invokePartial;exports.noop=noop;var _utils=__webpack_require__(4);var Utils=_interopRequireWildcard(_utils);var _exception=__webpack_require__(5);var _exception2=_interopRequireDefault(_exception);var _base=__webpack_require__(3);var _helpers=__webpack_require__(9);function checkRevision(compilerInfo){var compilerRevision=compilerInfo&&compilerInfo[0]||1,currentRevision=_base.COMPILER_REVISION;if(compilerRevision>=_base.LAST_COMPATIBLE_COMPILER_REVISION&&compilerRevision<=_base.COMPILER_REVISION){return}if(compilerRevision<_base.LAST_COMPATIBLE_COMPILER_REVISION){var runtimeVersions=_base.REVISION_CHANGES[currentRevision],compilerVersions=_base.REVISION_CHANGES[compilerRevision];throw new _exception2["default"]("Template was precompiled with an older version of Handlebars than the current runtime. "+"Please update your precompiler to a newer version ("+runtimeVersions+") or downgrade your runtime to an older version ("+compilerVersions+").")}else{throw new _exception2["default"]("Template was precompiled with a newer version of Handlebars than the current runtime. "+"Please update your runtime to a newer version ("+compilerInfo[1]+").")}}function template(templateSpec,env){if(!env){throw new _exception2["default"]("No environment passed to template")}if(!templateSpec||!templateSpec.main){throw new _exception2["default"]("Unknown template object: "+typeof templateSpec)}templateSpec.main.decorator=templateSpec.main_d;env.VM.checkRevision(templateSpec.compiler);var templateWasPrecompiledWithCompilerV7=templateSpec.compiler&&templateSpec.compiler[0]===7;function invokePartialWrapper(partial,context,options){if(options.hash){context=Utils.extend({},context,options.hash);if(options.ids){options.ids[0]=true}}partial=env.VM.resolvePartial.call(this,partial,context,options);var optionsWithHooks=Utils.extend({},options,{hooks:this.hooks});var result=env.VM.invokePartial.call(this,partial,context,optionsWithHooks);if(result==null&&env.compile){options.partials[options.name]=env.compile(partial,templateSpec.compilerOptions,env);result=options.partials[options.name](context,optionsWithHooks)}if(result!=null){if(options.indent){var lines=result.split("\n");for(var i=0,l=lines.length;i<l;i++){if(!lines[i]&&i+1===l){break}lines[i]=options.indent+lines[i]}result=lines.join("\n")}return result}else{throw new _exception2["default"]("The partial "+options.name+" could not be compiled when running in runtime-only mode")}}var container={strict:function strict(obj,name,loc){if(!obj||!(name in obj)){throw new _exception2["default"]('"'+name+'" not defined in '+obj,{loc:loc})}return obj[name]},lookup:function lookup(depths,name){var len=depths.length;for(var i=0;i<len;i++){if(depths[i]&&depths[i][name]!=null){return depths[i][name]}}},lambda:function lambda(current,context){return typeof current==="function"?current.call(context):current},escapeExpression:Utils.escapeExpression,invokePartial:invokePartialWrapper,fn:function fn(i){var ret=templateSpec[i];ret.decorator=templateSpec[i+"_d"];return ret},programs:[],program:function program(i,data,declaredBlockParams,blockParams,depths){var programWrapper=this.programs[i],fn=this.fn(i);if(data||depths||blockParams||declaredBlockParams){programWrapper=wrapProgram(this,i,fn,data,declaredBlockParams,blockParams,depths)}else if(!programWrapper){programWrapper=this.programs[i]=wrapProgram(this,i,fn)}return programWrapper},data:function data(value,depth){while(value&&depth--){value=value._parent}return value},nullContext:_Object$seal({}),noop:env.VM.noop,compilerInfo:templateSpec.compiler};function ret(context){var options=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var data=options.data;ret._setup(options);if(!options.partial&&templateSpec.useData){data=initData(context,data)}var depths=undefined,blockParams=templateSpec.useBlockParams?[]:undefined;if(templateSpec.useDepths){if(options.depths){depths=context!=options.depths[0]?[context].concat(options.depths):options.depths}else{depths=[context]}}function main(context){return""+templateSpec.main(container,context,container.helpers,container.partials,data,blockParams,depths)}main=executeDecorators(templateSpec.main,main,container,options.depths||[],data,blockParams);return main(context,options)}ret.isTop=true;ret._setup=function(options){if(!options.partial){container.helpers=Utils.extend({},env.helpers,options.helpers);if(templateSpec.usePartial){container.partials=Utils.extend({},env.partials,options.partials)}if(templateSpec.usePartial||templateSpec.useDecorators){container.decorators=Utils.extend({},env.decorators,options.decorators)}container.hooks={};var keepHelperInHelpers=options.allowCallsToHelperMissing||templateWasPrecompiledWithCompilerV7;_helpers.moveHelperToHooks(container,"helperMissing",keepHelperInHelpers);_helpers.moveHelperToHooks(container,"blockHelperMissing",keepHelperInHelpers)}else{container.helpers=options.helpers;container.partials=options.partials;container.decorators=options.decorators;container.hooks=options.hooks}};ret._child=function(i,data,blockParams,depths){if(templateSpec.useBlockParams&&!blockParams){throw new _exception2["default"]("must pass block params")}if(templateSpec.useDepths&&!depths){throw new _exception2["default"]("must pass parent depths")}return wrapProgram(container,i,templateSpec[i],data,0,blockParams,depths)};return ret}function wrapProgram(container,i,fn,data,declaredBlockParams,blockParams,depths){function prog(context){var options=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var currentDepths=depths;if(depths&&context!=depths[0]&&!(context===container.nullContext&&depths[0]===null)){currentDepths=[context].concat(depths)}return fn(container,context,container.helpers,container.partials,options.data||data,blockParams&&[options.blockParams].concat(blockParams),currentDepths)}prog=executeDecorators(fn,prog,container,depths,data,blockParams);prog.program=i;prog.depth=depths?depths.length:0;prog.blockParams=declaredBlockParams||0;return prog}function resolvePartial(partial,context,options){if(!partial){if(options.name==="@partial-block"){partial=options.data["partial-block"]}else{partial=options.partials[options.name]}}else if(!partial.call&&!options.name){options.name=partial;partial=options.partials[partial]}return partial}function invokePartial(partial,context,options){var currentPartialBlock=options.data&&options.data["partial-block"];options.partial=true;if(options.ids){options.data.contextPath=options.ids[0]||options.data.contextPath}var partialBlock=undefined;if(options.fn&&options.fn!==noop){(function(){options.data=_base.createFrame(options.data);var fn=options.fn;partialBlock=options.data["partial-block"]=function partialBlockWrapper(context){var options=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];options.data=_base.createFrame(options.data);options.data["partial-block"]=currentPartialBlock;return fn(context,options)};if(fn.partials){options.partials=Utils.extend({},options.partials,fn.partials)}})()}if(partial===undefined&&partialBlock){partial=partialBlock}if(partial===undefined){throw new _exception2["default"]("The partial "+options.name+" could not be found")}else if(partial instanceof Function){return partial(context,options)}}function noop(){return""}function initData(context,data){if(!data||!("root"in data)){data=data?_base.createFrame(data):{};data.root=context}return data}function executeDecorators(fn,prog,container,depths,data,blockParams){if(fn.decorator){var props={};prog=fn.decorator(prog,props,container,depths&&depths[0],data,blockParams,depths);Utils.extend(prog,props)}return prog}},function(module,exports,__webpack_require__){module.exports={default:__webpack_require__(35),__esModule:true}},function(module,exports,__webpack_require__){__webpack_require__(36);module.exports=__webpack_require__(20).Object.seal},function(module,exports,__webpack_require__){var isObject=__webpack_require__(37);__webpack_require__(17)("seal",function($seal){return function seal(it){return $seal&&isObject(it)?$seal(it):it}})},function(module,exports){module.exports=function(it){return typeof it==="object"?it!==null:typeof it==="function"}},function(module,exports){(function(global){"use strict";exports.__esModule=true;exports["default"]=function(Handlebars){var root=typeof global!=="undefined"?global:window,$Handlebars=root.Handlebars;Handlebars.noConflict=function(){if(root.Handlebars===Handlebars){root.Handlebars=$Handlebars}return Handlebars}};module.exports=exports["default"]}).call(exports,function(){return this}())}])});var E_S_ADVANCE=0;var E_S_BUILD=1;var E_S_CITY=2;var E_S_D_ME=3;var E_S_D_THEM=4;var E_S_GLOBAL=5;var E_S_HUT=6;var E_S_NATION=7;var E_S_TREATY=8;var E_S_UNIT=9;var E_S_VOTE=10;var E_S_WONDER=11;var E_S_XYZZY=12;var E_S_CHAT=13;var fc_e_section_names=["e_s_advance","e_s_build","e_s_city","e_s_d_me","e_s_d_them","e_s_global","e_s_hut","e_s_nation","e_s_treaty","e_s_unit","e_s_vote","e_s_wonder","e_s_xyzzy","e_s_chat"];var fc_e_section_descriptions=["Technology","Improvement","City","Diplomat Action","Enemy Diplomat","Global","Hut","Nation","Treaty","Unit","Vote","Wonder","Misc","Chat"];var E_CITY_CANTBUILD=0;var E_CITY_LOST=1;var E_CITY_LOVE=2;var E_CITY_DISORDER=3;var E_CITY_FAMINE=4;var E_CITY_FAMINE_FEARED=5;var E_CITY_GROWTH=6;var E_CITY_MAY_SOON_GROW=7;var E_CITY_AQUEDUCT=8;var E_CITY_AQ_BUILDING=9;var E_CITY_NORMAL=10;var E_CITY_NUKED=11;var E_CITY_CMA_RELEASE=12;var E_CITY_GRAN_THROTTLE=13;var E_CITY_TRANSFER=14;var E_CITY_BUILD=15;var E_CITY_PRODUCTION_CHANGED=16;var E_WORKLIST=17;var E_UPRISING=18;var E_CIVIL_WAR=19;var E_ANARCHY=20;var E_FIRST_CONTACT=21;var E_NEW_GOVERNMENT=22;var E_LOW_ON_FUNDS=23;var E_POLLUTION=24;var E_REVOLT_DONE=25;var E_REVOLT_START=26;var E_SPACESHIP=27;var E_MY_DIPLOMAT_BRIBE=28;var E_DIPLOMATIC_INCIDENT=29;var E_MY_DIPLOMAT_ESCAPE=30;var E_MY_DIPLOMAT_EMBASSY=31;var E_MY_DIPLOMAT_FAILED=32;var E_MY_DIPLOMAT_INCITE=33;var E_MY_DIPLOMAT_POISON=34;var E_MY_DIPLOMAT_SABOTAGE=35;var E_MY_DIPLOMAT_THEFT=36;var E_ENEMY_DIPLOMAT_BRIBE=37;var E_ENEMY_DIPLOMAT_EMBASSY=38;var E_ENEMY_DIPLOMAT_FAILED=39;var E_ENEMY_DIPLOMAT_INCITE=40;var E_ENEMY_DIPLOMAT_POISON=41;var E_ENEMY_DIPLOMAT_SABOTAGE=42;var E_ENEMY_DIPLOMAT_THEFT=43;var E_CARAVAN_ACTION=44;var E_SCRIPT=45;var E_BROADCAST_REPORT=46;var E_GAME_END=47;var E_GAME_START=48;var E_NATION_SELECTED=49;var E_DESTROYED=50;var E_REPORT=51;var E_TURN_BELL=52;var E_NEXT_YEAR=53;var E_GLOBAL_ECO=54;var E_NUKE=55;var E_HUT_BARB=56;var E_HUT_CITY=57;var E_HUT_GOLD=58;var E_HUT_BARB_KILLED=59;var E_HUT_MERC=60;var E_HUT_SETTLER=61;var E_HUT_TECH=62;var E_HUT_BARB_CITY_NEAR=63;var E_IMP_BUY=64;var E_IMP_BUILD=65;var E_IMP_AUCTIONED=66;var E_IMP_AUTO=67;var E_IMP_SOLD=68;var E_TECH_GAIN=69;var E_TECH_LEARNED=70;var E_TREATY_ALLIANCE=71;var E_TREATY_BROKEN=72;var E_TREATY_CEASEFIRE=73;var E_TREATY_PEACE=74;var E_TREATY_SHARED_VISION=75;var E_UNIT_LOST_ATT=76;var E_UNIT_WIN_ATT=77;var E_UNIT_BUY=78;var E_UNIT_BUILT=79;var E_UNIT_LOST_DEF=80;var E_UNIT_WIN_DEF=81;var E_UNIT_BECAME_VET=82;var E_UNIT_UPGRADED=83;var E_UNIT_RELOCATED=84;var E_UNIT_ORDERS=85;var E_WONDER_BUILD=86;var E_WONDER_OBSOLETE=87;var E_WONDER_STARTED=88;var E_WONDER_STOPPED=89;var E_WONDER_WILL_BE_BUILT=90;var E_DIPLOMACY=91;var E_TREATY_EMBASSY=92;var E_BAD_COMMAND=93;var E_SETTING=94;var E_CHAT_MSG=95;var E_MESSAGE_WALL=96;var E_CHAT_ERROR=97;var E_CONNECTION=98;var E_AI_DEBUG=99;var E_LOG_ERROR=100;var E_LOG_FATAL=101;var E_TECH_GOAL=102;var E_UNIT_LOST_MISC=103;var E_CITY_PLAGUE=104;var E_VOTE_NEW=105;var E_VOTE_RESOLVED=106;var E_VOTE_ABORTED=107;var E_CITY_RADIUS_SQ=108;var E_UNIT_BUILT_POP_COST=109;var E_DISASTER=110;var E_ACHIEVEMENT=111;var E_TECH_LOST=112;var E_TECH_EMBASSY=113;var E_MY_SPY_STEAL_GOLD=114;var E_ENEMY_SPY_STEAL_GOLD=115;var E_SPONTANEOUS_EXTRA=116;var E_UNIT_ILLEGAL_ACTION=117;var E_MY_SPY_STEAL_MAP=118;var E_ENEMY_SPY_STEAL_MAP=119;var E_MY_SPY_NUKE=120;var E_ENEMY_SPY_NUKE=121;var E_UNIT_WAS_EXPELLED=122;var E_UNIT_DID_EXPEL=123;var E_UNIT_ACTION_FAILED=124;var E_UNIT_ESCAPED=125;var E_DEPRECATION_WARNING=126;var E_BEGINNER_HELP=127;var E_MY_UNIT_DID_HEAL=128;var E_MY_UNIT_WAS_HEALED=129;var E_MULTIPLIER=130;var E_UNIT_ACTION_ACTOR_SUCCESS=131;var E_UNIT_ACTION_ACTOR_FAILURE=132;var E_UNIT_ACTION_TARGET_OTHER=133;var E_UNIT_ACTION_TARGET_HOSTILE=134;var E_CHAT_MSG_PUBLIC=135;var E_CHAT_MSG_PRIVATE_SENT=136;var E_CHAT_MSG_PRIVATE_RCVD=137;var E_CHAT_MSG_ALLY=138;var E_CHAT_PRIVATE=139;var E_CHAT_ALLIES=140;var E_CHAT_OBSERVER=141;var E_UNDEFINED=142;var fc_e_events=[["e_city_cantbuild",E_S_CITY,"Building Unavailable Item"],["e_city_lost",E_S_CITY,"Captured/Destroyed"],["e_city_love",E_S_CITY,"Celebrating"],["e_city_disorder",E_S_CITY,"Civil Disorder"],["e_city_famine",E_S_CITY,"Famine"],["e_city_famine_feared",E_S_CITY,"Famine Feared"],["e_city_growth",E_S_CITY,"Growth"],["e_city_may_soon_grow",E_S_CITY,"May Soon Grow"],["e_city_aqueduct",E_S_CITY,"Needs Aqueduct"],["e_city_aq_building",E_S_CITY,"Needs Aqueduct Being Built"],["e_city_normal",E_S_CITY,"Normal"],["e_city_nuked",E_S_CITY,"Nuked"],["e_city_cma_release",E_S_CITY,"Released from citizen governor"],["e_city_gran_throttle",E_S_CITY,"Suggest Growth Throttling"],["e_city_transfer",E_S_CITY,"Transfer"],["e_city_build",E_S_CITY,"Was Built"],["e_city_production_changed",E_S_CITY,"Production changed"],["e_worklist",E_S_CITY,"Worklist Events"],["e_uprising",E_S_NATION,"Barbarian Uprising"],["e_civil_war",E_S_NATION,"Civil War"],["e_anarchy",E_S_NATION,"Collapse to Anarchy"],["e_first_contact",E_S_NATION,"First Contact"],["e_new_government",E_S_NATION,"Learned New Government"],["e_low_on_funds",E_S_NATION,"Low Funds"],["e_pollution",E_S_NATION,"Pollution"],["e_revolt_done",E_S_NATION,"Revolution Ended"],["e_revolt_start",E_S_NATION,"Revolution Started"],["e_spaceship",E_S_NATION,"Spaceship Events"],["e_my_diplomat_bribe",E_S_D_ME,"Bribe"],["e_diplomatic_incident",E_S_D_ME,"Caused Incident"],["e_my_diplomat_escape",E_S_D_ME,"Escape"],["e_my_diplomat_embassy",E_S_D_ME,"Embassy"],["e_my_diplomat_failed",E_S_D_ME,"Failed"],["e_my_diplomat_incite",E_S_D_ME,"Incite"],["e_my_diplomat_poison",E_S_D_ME,"Poison"],["e_my_diplomat_sabotage",E_S_D_ME,"Sabotage"],["e_my_diplomat_theft",E_S_D_ME,"Theft"],["e_enemy_diplomat_bribe",E_S_D_THEM,"Bribe"],["e_enemy_diplomat_embassy",E_S_D_THEM,"Embassy"],["e_enemy_diplomat_failed",E_S_D_THEM,"Failed"],["e_enemy_diplomat_incite",E_S_D_THEM,"Incite"],["e_enemy_diplomat_poison",E_S_D_THEM,"Poison"],["e_enemy_diplomat_sabotage",E_S_D_THEM,"Sabotage"],["e_enemy_diplomat_theft",E_S_D_THEM,"Theft"],["e_caravan_action",E_S_XYZZY,"Caravan actions"],["e_script",E_S_XYZZY,"Scenario/ruleset script message"],["e_broadcast_report",E_S_XYZZY,"Broadcast Report"],["e_game_end",E_S_XYZZY,"Game Ended"],["e_game_start",E_S_XYZZY,"Game Started"],["e_nation_selected",E_S_XYZZY,"Nation Selected"],["e_destroyed",E_S_XYZZY,"Player Destroyed"],["e_report",E_S_XYZZY,"Report"],["e_turn_bell",E_S_XYZZY,"Turn Bell"],["e_next_year",E_S_XYZZY,"Year Advance"],["e_global_eco",E_S_GLOBAL,"Eco-Disaster"],["e_nuke",E_S_GLOBAL,"Nuke Detonated"],["e_hut_barb",E_S_HUT,"Barbarians in a Hut Roused"],["e_hut_city",E_S_HUT,"City Founded from Hut"],["e_hut_gold",E_S_HUT,"Gold Found in Hut"],["e_hut_barb_killed",E_S_HUT,"Killed by Barbarians in a Hut"],["e_hut_merc",E_S_HUT,"Mercenaries Found in Hut"],["e_hut_settler",E_S_HUT,"Settler Found in Hut"],["e_hut_tech",E_S_HUT,"Tech Found in Hut"],["e_hut_barb_city_near",E_S_HUT,"Unit Spared by Barbarians"],["e_imp_buy",E_S_BUILD,"Bought"],["e_imp_build",E_S_BUILD,"Built"],["e_imp_auctioned",E_S_BUILD,"Forced to Sell"],["e_imp_auto",E_S_BUILD,"New Improvement Selected"],["e_imp_sold",E_S_BUILD,"Sold"],["e_tech_gain",E_S_ADVANCE,"Acquired New Tech"],["e_tech_learned",E_S_ADVANCE,"Learned New Tech"],["e_treaty_alliance",E_S_TREATY,"Alliance"],["e_treaty_broken",E_S_TREATY,"Broken"],["e_treaty_ceasefire",E_S_TREATY,"Cease-fire"],["e_treaty_peace",E_S_TREATY,"Peace"],["e_treaty_shared_vision",E_S_TREATY,"Shared Vision"],["e_unit_lost_att",E_S_UNIT,"Attack Failed"],["e_unit_win_att",E_S_UNIT,"Attack Succeeded"],["e_unit_buy",E_S_UNIT,"Bought"],["e_unit_built",E_S_UNIT,"Built"],["e_unit_lost_def",E_S_UNIT,"Defender Destroyed"],["e_unit_win_def",E_S_UNIT,"Defender Survived"],["e_unit_became_vet",E_S_UNIT,"Promoted to Veteran"],["e_unit_upgraded",E_S_UNIT,"Production Upgraded"],["e_unit_relocated",E_S_UNIT,"Relocated"],["e_unit_orders",E_S_UNIT,"Orders / goto events"],["e_wonder_build",E_S_WONDER,"Finished"],["e_wonder_obsolete",E_S_WONDER,"Made Obsolete"],["e_wonder_started",E_S_WONDER,"Started"],["e_wonder_stopped",E_S_WONDER,"Stopped"],["e_wonder_will_be_built",E_S_WONDER,"Will Finish Next Turn"],["e_diplomacy",E_S_XYZZY,"Diplomatic Message"],["e_treaty_embassy",E_S_TREATY,"Embassy"],["e_bad_command",E_S_XYZZY,"Error message from bad command"],["e_setting",E_S_XYZZY,"Server settings changed"],["e_chat_msg",E_S_CHAT,"Chat messages"],["e_message_wall",E_S_XYZZY,"Message from server operator"],["e_chat_error",E_S_CHAT,"Chat error messages"],["e_connection",E_S_XYZZY,"Connect/disconnect messages"],["e_ai_debug",E_S_XYZZY,"AI Debug messages"],["e_log_error",E_S_XYZZY,"Server Problems"],["e_log_fatal",E_S_XYZZY,"Server Aborting"],["e_tech_goal",E_S_ADVANCE,"Selected New Goal"],["e_unit_lost_misc",E_S_UNIT,"Lost outside battle"],["e_city_plague",E_S_CITY,"Has Plague"],["e_vote_new",E_S_VOTE,"New vote"],["e_vote_resolved",E_S_VOTE,"Vote resolved"],["e_vote_aborted",E_S_VOTE,"Vote canceled"],["e_city_radius_sq",E_S_CITY,"City Map changed"],["e_unit_built_pop_cost",E_S_UNIT,"Built unit with population cost"],["e_disaster",E_S_CITY,"Disaster"],["e_achievement",E_S_NATION,"Achievements"],["e_tech_lost",E_S_ADVANCE,"Lost a Tech"],["e_tech_embassy",E_S_ADVANCE,"Other Player Gained/Lost a Tech"],["e_my_spy_steal_gold",E_S_D_ME,"Gold Theft"],["e_enemy_spy_steal_gold",E_S_D_THEM,"Gold Theft"],["e_spontaneous_extra",E_S_XYZZY,"Extra Appears or Disappears"],["e_unit_illegal_action",E_S_UNIT,"Unit Illegal Action"],["e_my_spy_steal_map",E_S_D_ME,"Map Theft"],["e_enemy_spy_steal_map",E_S_D_THEM,"Map Theft"],["e_my_spy_nuke",E_S_D_ME,"Suitcase Nuke"],["e_enemy_spy_nuke",E_S_D_THEM,"Suitcase Nuke"],["e_unit_was_expelled",E_S_UNIT,"Was Expelled"],["e_unit_did_expel",E_S_UNIT,"Did Expel"],["e_unit_action_failed",E_S_UNIT,"Action failed"],["e_unit_escaped",E_S_UNIT,"Unit escaped"],["e_deprecation_warning",E_S_XYZZY,"Deprecated Modpack syntax warnings"],["e_beginner_help",E_S_XYZZY,"Help for beginners"],["e_my_unit_did_heal",E_S_UNIT,"Unit did heal"],["e_my_unit_was_healed",E_S_UNIT,"Unit was healed"],["e_multiplier",E_S_NATION,"Multiplier changed"],["e_unit_action_actor_success",E_S_UNIT,"Your unit did"],["e_unit_action_actor_failure",E_S_UNIT,"Your unit failed"],["e_unit_action_target_other",E_S_UNIT,"Unit did"],["e_unit_action_target_hostile",E_S_UNIT,"Unit did to you"],["e_chat_msg_public",E_S_XYZZY,"Public chat messages"],["e_chat_msg_private_sent",E_S_XYZZY,"Private chat messages sent"],["e_chat_msg_private_rcvd",E_S_XYZZY,"Private chat messages rcvd"],["e_chat_msg_ally",E_S_XYZZY,"Ally chat messages"],["e_chat_private",E_S_CHAT,"Private messages"],["e_chat_allies",E_S_CHAT,"Allies messages"],["e_chat_observer",E_S_CHAT,"Observers messages"],["e_undefined",E_S_XYZZY,"Unknown event"]];var E_I_NAME=0;var E_I_SECTION=1;var E_I_DESCRIPTION=2;var helpdata_order=["help_overview","help_strategy_and_tactics","help_terrain","help_gen_terrain","help_gen_natural_extras","help_resources","help_gen_resource_extras","help_terrain_alterations","help_gen_extras","help_gen_misc_extras","help_borders","help_economy","help_food","help_production","help_trade","help_goods","help_gen_goods","help_cities","help_specialists","help_gen_specialists","help_happiness","help_plague","help_migration","help_city_improvements","help_gen_improvements","help_wonders_of_the_world","help_gen_wonders","help_units","help_gen_units","help_combat","help_combat_example_1","help_combat_example_2","help_zones_of_control","help_government","help_gen_governments","help_civil_war","help_policies","help_gen_policies","help_diplomacy","help_technology","help_gen_techs","help_space_race","help_gen_ruleset","help_gen_tileset","help_nations","help_gen_nations","help_connecting","help_controls","help_governor","help_chatline","help_worklist_editor","help_languages","help_copying","help_about"];var helpdata={help_overview:{name:"?help:Overview",text:"Freeciv is a turn-based strategy game, in which each player becomes the leader of a civilization. You compete against several opponents to found cities, use them to support a military and economy, and finally to complete an empire that survives all encounters with its neighbors to emerge victorious. Each opponent may be either another human or be controlled by the computer. All players begin at the dawn of history with a handful of units -- typically with an explorer and a couple of settlers in 4000 BCE -- and race to expand outward from those humble beginnings. <br><br> Achieving success requires a balance between economic expansion, military strength, and technological development. Not only must you develop all three in concert to both expand and successfully defend your empire, but any of the three may provide victory over your opponents: <br><br>  - As in other games of conquest and expansion, you are declared the winner by default once the last city and unit of every other civilization is destroyed. <br><br>  - Once technological progress has brought you into the space age, you may launch a spacecraft destined for Alpha Centauri, the first civilization whose craft reaches the system wins. <br><br>  - In the absence of other means to determine victory, the game will end after 5000 turns if no spacecraft have yet been launched. The surviving civilizations are then rated, and the one with the highest score is the winner. <br><br> A word of warning: Freeciv is highly customizable, both through run-time configuration and through custom rulesets which can change almost any aspect of the game rules. This help system tries to adapt to different rules, but may not completely cover rulesets which are very different from the classic rules."},help_strategy_and_tactics:{name:"Strategy and Tactics",text:"While every game is different, there's a basic strategy which most players follow, especially at the start of the game. <br><br> These steps may vary depending upon the server options, but in general, the steps are:  <br><br>  0. Choosing the first city site.<br> 1. Mapping the countryside.<br> 2. Defending the cities.<br> 3. Deciding which units to build first.<br> 4. Improving the land.<br> 5. Deciding where to build cities.<br> 6. Taking care of the cities.<br> 7. Interacting with other players (diplomacy).<br> 8. Exploring the world.<br> 9. Things to keep in mind.<br> 10. Making your own strategy for the game.<br> <br><br>  0. Choosing the first city site.<br><br>    Start the game by wandering around BRIEFLY to find a good place to build the first city.  Don't feel tempted to investigate any yellow-roofed villages yet - they might contain barbarian tribes.  Build the city close to resources and perhaps close to the sea.  Keep in mind that the city you build first will be your capital!  The idea is to balance the quality of the site you find against getting your first city established as early as possible. <br><br>  1. Mapping the countryside.<br><br>    After the capital city has been founded, it will start producing a warrior unit.  These units can be used to rove around exploring the countryside.  Remember, it is risky to leave a city undefended, so perhaps keep the first warrior in the city, and use the following one to explore.  If you started the game with an explorer unit, use that to explore, obviously! <br><br>  2. Defending the cities.<br><br>    At this point, defend your cities by always leaving a warrior unit in them.  As your civilization develops units with a greater defense strength, replace the obsolete units with new ones to ensure your cities have maximum defense.  The units most often used for defense are (in order of strength):  Warrior, Phalanx, Pikemen, Musketeers, and Riflemen. <br><br>     Keep in mind that with some types of government, military units inside or outside cities can reduce or create unhappiness. Also remember that when a land unit is inside a city, it gets a 50% defensive bonus, as if fortified.  When a new city is built, the city starts to build the best available defensive unit from the above list. <br><br>  3. Deciding which units to build first.<br><br>    After building one or two Warrior units, start building Settlers.  Settlers take city population, but if you picked a good city site, your city should be big enough by now.  Settlers are best put to use founding new cities, while they can also build agricultural improvements (see the next section), it is better to use Workers for this when available, as unlike Settlers, Workers do not consume food from their parent city.  Keep in mind that a large population increases both the amount of productivity and your civilization's research rate, not to mention that cities secure land for your empire, so founding new cities should be a high priority initially. <br><br>  4. Improving the land.<br><br>    Each city has an area of land around it that can be used for growing food, producing goods, and generating trade.  This output can be increased by using Workers (or Settlers) to improve the land close to your cities.  The land can be improved with irrigation (increasing food), roads (allowing units to move faster and increasing trade), and mines (increasing production), among other improvements. <br><br>  5. Deciding where to build cities.<br><br>    The best location for a city is a matter of taste.  A city which is placed near the sea is easier to spot by opponents, but can also serve as a port for sea-going units.  (They also usually need a coastal defense later on.)  The best strategy is to build a few of both, but keep in mind that your opponents will find it harder to locate your city if you don't build it by the sea. <br><br>  6. Taking care of the cities.<br><br>    Every city has a band of citizens.  The number of citizens depends on the city's population.  When you click on a city, you can see how the land around the city is being used.  You can assign your citizens to the land, or they can be specialists that contribute to your civilization in other ways.  Especially at the start of the game, care should be taken to ensure that the citizens are employed so that they maximize growth, trade and production. <br><br>     If too much food is being generated, a citizen can be taken off the land by clicking on the occupied land tile.  This citizen can then be transferred to the other duties mentioned previously. <br><br>     If you move all of your citizens into the city and right-click on the central tile of the land, the citizens will be rearranged to maximize food production. <br><br>     The golden rule of taking care of a city is that there should be at least as many happy citizens as unhappy citizens.  A city where this is not so falls into disorder, such cities are labeled with a raised fist or a lightning bolt (depending on the tileset).  Take care not to let this happen to any of your cities, as cities in disorder produce nothing, and are prone to revolt. <br><br>  7. Interacting with other players (diplomacy).<br><br>    When one of your units first meets a unit of another nation, or finds one of their cities (or equally if they find you), a basic contact is established between the two nations.  This provides each with basic intelligence about the other, which can be accessed from the 'Nations' report. <br><br>     This communication will lapse after a set number of turns with no contact.  Establishing an embassy will give a more permanent communication channel, as well as more advanced intelligence such as details of technology.  Embassies are one-way - the nation hosting the embassy receives no benefit - and once established, cannot be revoked. <br><br>     If you are in contact with another player, then you can arrange a diplomatic meeting.  From the 'Nations' report, this is done by clicking on the nation with whom you wish to meet and selecting 'Meet'.  If the entry under the embassy column is not blank and the other player is connected (or is a server AI) then a treaty dialog will pop up. <br><br>     In this dialog you can negotiate an exchange of assets (maps, vision, advances, cities, or gold), embassies, or binding pacts such as a cease-fire or peace.  There is no need to trade like for like, you can trade, say, an advance or city for gold - you can consider this buying and selling.  Each player builds a list of offered items.  To remove an item from the list, double-click on it.  When both players indicate satisfaction, the pact is concluded. <br><br>     Pacts affect where your units can go and what they can do, and a pact with one nation can affect your relations with others.  Under authoritarian governments such as Monarchy you can break a pact at any time, but the representative governments (Republic and Democracy) have a senate which will block the unprovoked cancelation of a treaty, unless a foreign Diplomat or Spy sparks a diplomatic incident, the only way to dissolve a pact in this situation is to dissolve your government.  The details of pacts are described in the Diplomacy section. <br><br>     A couple of notes: <br><br>    - You can't give away your capital. <br><br>    - You can only request property that you know about, so you can't request technology unless you have an embassy, and if you can't see a city on your map, then you can't request it.  Of course, the owner of that city can still offer it to you, in which case the area around the city is shown on your map before you accept the treaty. <br><br>    - One important thing to note: when a city is transferred, any units in the field and supported by that city are also transferred (but not those sitting in other cities).  So make sure the other player isn't getting a better deal than you expect. <br><br>  8. Exploring the world.<br><br>    After you have fortified your cities with troops, build Triremes in the cities near the sea.  Use the Triremes to map the world in search of opponents and new lands.  If you are on an island, you should spend less on military and more on expansion.  Or if you are located close to an opponent, it is truly a good idea to make a peace treaty and share the advances you have made. Diplomatic units are very useful here, and WILL pay off later. <br><br>  9. Things to keep in mind.<br><br>  - What the next advance you'll need is.<br><br>  - What your tax, luxury and research rates are currently set to.<br><br>  - Treaties are often broken, so don't neglect defense...<br><br>  - Some wonders can be made obsolete. <br><br>  10. Making your own strategy for the game.<br><br>    These basic concepts will allow you to play the game pretty well, especially in the beginning of the game.  But to improve, you need to study the various units and advances, and PRACTICE, PRACTICE, PRACTICE!  Freeciv has many twists, so if you haven't played a similar game before, try consulting the Freeciv WWW pages at: <br><br> \"  http: \", You'll find more tips for playing, and details of how to contact other players."},help_terrain:{name:"Terrain",text:"Terrain serves three roles: the theater upon which your units battle rival civilizations, the landscape across which your units travel, and the medium which your cities work to produce resources. The different types of terrain each have different strengths and drawbacks, see the sections on each terrain type for details. <br><br> Terrain affects combat very simply: when a unit is attacked, its defense strength is multiplied by the defense factor ('bonus') of the terrain beneath it. (However, some types of units do not enjoy this bonus, in the classic ruleset, only land units do.) See the help section on Combat for further details. <br><br> Terrain can complicate the movement of units. For instance, in the classic ruleset, moving onto rough terrain such as Mountains can cost land units more than flat terrain like Plains, although sea and air units always expend one movement point to move one tile. <br><br> Tiles within range of a city may be worked by that city to produce food, production, and trade points, and the quantity of each produced depends on the terrain. These three products are so important that we specify the output of a tile simply by listing them with slashes in between: for example, '1/2/0' describes a tile that each turn when it is being worked produces one food point, two production points, and no trade points. In addition to the characteristic output of the terrain, some tiles have an additional special resource that boosts one or two of the products. See the Economy section for more information on the use of these products. <br><br> The net benefit of a tile for your city depends on your government type as well as city improvements and wonders. <br><br> It is possible for your units to change the terrain and hence its effects, see the section on Terrain Alterations for more details."},help_gen_terrain:{generate:'" Terrain"'},help_gen_natural_extras:{generate:'" Extras"',categories:'"Natural"'},help_resources:{name:"Resources",text:"Tiles can have natural resources in addition to their base terrain."},help_gen_resource_extras:{generate:'"  Extras"',categories:'"Resource"'},help_terrain_alterations:{name:"Terrain Alterations",text:"Certain units have the ability to alter terrain tiles in several ways: they may add or remove tile improvements, remove unwanted features such as pollution, or change the base terrain type entirely. <br><br> Tile improvements typically provide some lasting bonus for as long as they are present, such as a production bonus when a city works the tile. Roads or paths typically ease movement, if they connect to a similar road on an adjacent tile, and bases often provide protection and refueling. The available tile improvements are described in the following sections. <br><br> Improvements can be built by issuing one of several orders to a suitable unit while on a suitable tile: 'mine', 'irrigate', 'road', or 'build base' (although whether the order builds an improvement of the same name is up to the ruleset). Terrain alterations can also be requested from the city map (see the help on Cities). <br><br> Terrain can sometimes be permanently converted into a type more suitable to the player's needs, although this usually takes longer than adding an improvement. Converting terrain from one type to another in this way may destroy existing improvements, if the new terrain is unsuitable, and may also remove access to special resources if they were specific to the original terrain type. <br><br> The requirements for terrain conversion are set by the ruleset. It can be initiated in several ways: <br><br>  - By issuing 'irrigate' or 'mine' orders when on terrain unsuitable for tile improvements. <br><br>  - By issuing the special 'transform' order. This often causes more radical transformations. <br><br> In some rulesets, units can even reclaim land from water tiles, and similarly land can be transformed to water, although such radical transformations may require a certain number of surrounding tiles to already be land or water respectively. Terrain-altering units that cannot reach the existing terrain may have to be loaded onto a suitable vessel, and if necessary and possible, they will move to safe neighboring tiles when the conversion is complete. <br><br> Units may also be able to destroy terrain alterations, by pillaging, typically more kinds of unit can pillage an improvement than could build it in the first place. Some tile features can only be removed by specialized units, with the 'clean pollution' or 'clean fallout' orders. <br><br> Terrain conversions cannot be undone in this way, for example, in the classic ruleset, if a Forest tile has been irrigated to convert it into Plains, you cannot convert it back into a Forest by pillaging -- to do so, you would have to convert the tile again with a suitable unit. <br><br> The time it takes a unit to alter terrain depends on its movement rate. The following table shows the number of turns required for a unit with 1 movement point to complete an activity, these numbers are reduced for units with faster move rates (such as Engineers in the classic ruleset). The time taken can be reduced further by several units working together as a team, if two or more units are working on the same task on the same tile, their efforts will be added together each turn until the task is finished. Be careful not to dedicate too many units to one task, though, excess effort can be wasted, and groups of terrain improving units are often vulnerable to enemy attacks. <br><br> \"$TerrainAlterations \""},help_gen_extras:{generate:'"  Extras"',categories:'"Infra"'},help_gen_misc_extras:{generate:'" Extras"',categories:'"Bonus", "Nuisance"'},help_borders:{name:"National Borders",text:"If enabled on the server, each nation has borders, which can be seen as dotted lines on the map. Borders determine what land your citizens can work and where you can found new cities, and whether your units are considered to be aggressively deployed by your citizens (see the section on Happiness). Borders also come into play when there is a diplomatic pact between nations (see the section on Diplomacy). <br><br> Founding a city establishes a claim on an area of land around the city. In the classic ruleset, once claimed, a tile that can be directly worked by a city can not change ownership unless the city does (or is destroyed). However, the ownership of land that is out of range of any city can change depending on factors such as the relative size of nearby nations' cities. Other rulesets may differ in which, if any, tiles are permanently claimed by a city. <br><br> Normally borders extend into water only for tiles adjacent to a city, beyond that, only narrow inlets and inland lakes can usually be claimed. Some rulesets may allow water tiles to be claimed as easily as land tiles in some circumstances, although the classic ruleset does not. Border claims can never extend to remote islands. <br><br> Bases can also extend national borders. See the help on Terrain Alterations for more details."},help_economy:{name:"Economy",text:"The products which your cities extract from the surrounding terrain are the fountain from which your civilization is watered. There are three types of products: food points, production points, and trade points. The following sections describe each of these resources along with its properties, uses, and limitations."},help_food:{name:"Food",text:"Your population needs food to survive. Each citizen requires two food points per turn, in addition, some units (such as Settlers in the classic ruleset) may require food points from the city supporting them. <br><br> Every city has a granary for storing food points (the building called a Granary in the classic ruleset only enhances this capability). Cities producing more food than they require accumulate the surplus in their granary, while those producing less than they require deplete their granary. When food is needed but none remains, the city population starves, killing food-consuming units first, followed by citizens, until the food deficit ends. <br><br> Excess food can increase the population: the city granary has a limited capacity, and once full the city grows by one citizen and the granary starts again at empty. But since granary capacity increases with population, each citizen is more costly than the last, making this mode of growth important only for small cities. (An alternative way for cities to grow is 'rapture', described in the section on Happiness.)"},help_production:{name:"Production",text:"Production points (also known as 'shields') represent manufacturing output. In the classic ruleset, most units require production points as upkeep, and demand them from their home city, although under autocratic regimes each city supports a few units for free. If city production drops too low, the units that cannot be supported are automatically disbanded. You can also disband most types of unit at any time. If a unit is disbanded while in a city, half of its production cost will usually be put towards that city's surplus. <br><br> Production points in excess of any required by the city's units are put towards whichever unit, building, or wonder has been selected as the city's current product. Just as food points accumulate in the city granary and yield a citizen when it reaches full, so production points accumulate until the cost of the product has been achieved. Products appear in their city when complete -- units appear on the map while improvements and wonders are added to their city's list of structures. Any leftover production points remain available to be applied towards the next project. <br><br> Some units, such as Settlers, are built from city population as well as production points, the city size will reduce when the unit is built. By default, a city will not finish building a unit that would take all of the city's remaining population, in this case, production points will continue to accumulate until the city is of sufficient size. You can allow a city to be disbanded from the city's dialog, however, you cannot disband your last city this way. <br><br> In the classic ruleset, a city can build at most one product per turn, regardless of its production surplus. However, in some rulesets, factors such as city size and technology may enable a single city to produce more than one unit in a single turn under certain conditions. A city with multiple 'build slots', ordered to build a unit, can build as many of that single kind of unit per turn as its production surplus allows, up to the number of slots. Units which cost city population to build are an exception to this rule, they can only be built singly, as can buildings. <br><br> A city can be given a list of several products to build in its 'worklist', avoiding the need to pay attention to it every few turns. Each item on the worklist represents a single product (such as a unit)finished all the work you have given it to do, it will try to build the last item again if possible, otherwise it will choose a new target itself. If a city is currently producing gold (building Coinage in the classic rules), an activity which never completes, putting an item on its worklist will cause it to stop producing gold and start working on the new item next turn. In rulesets which permit it, a city may take several units of the same type off its worklist in a single turn, but if a different kind of item is reached, production pauses until the following turn. This can be used to limit the number of units produced by highly productive cities. <br><br> Each player is free to build any products that his technology has made available, with a few restrictions, see the sections on Units, City Improvements, and Wonders of the World for more information. Be careful -- the game even gives you the freedom to produce units you cannot support and buildings whose upkeep you cannot afford, both of which will be disbanded immediately after completion. <br><br> You can always change the product on which a city is working, though you lose half of the accumulated production points when switching from a building, unit, or wonder to a product from one of the other two categories. You can spend gold to complete a project in one turn by hitting the Buy button on the city dialog. <br><br> Some production points may be lost to waste, although there is no waste in the classic rules. Waste can result in your cities not building anything. <br><br> Cities with a large production output contribute to pollution, which affects the tiles around the city. See the Terrain help."},help_trade:{name:"Trade",text:"Trade points reflect wealth generated in each city by external commerce. Some trade points may be lost to corruption, which varies among forms of government, and tends to increase with distance from your center of government. Each city distributes its remaining trade points among three uses: gold, in the form of taxes, goes into your national treasury, luxury points influence citizen morale, and science points ('bulbs') contribute towards the discovery of new technology. <br><br> You must choose a single ratio for your civilization by which trade points are distributed among these three uses. Though you may alter the tax rates on any turn, you are constrained to multiples of ten percent, and most forms of government limit their maximum value. <br><br> Having this single ratio does not impact gold and science, because gold and technological progress are both empire-wide tallies. Luxury is more problematic, however, because its effect is local -- it affects only the city producing it. Thus, while it would be convenient for unhappy cities to invest all their trade in luxury while others invested in science or taxes instead, you will instead have to compromise among the needs of all your cities (although there may be ways to make local adjustments, such as assigning citizens as entertainers in the classic ruleset). See the section on Happiness for more details on the effect of luxuries. <br><br> Besides working terrain gifted with rare commodities, or logistical benefits such as waterways or roads, you can increase trade by using units to establish permanent trade routes between two cities, if the ruleset allows it. <br><br> The ruleset may limit the ability to trade or the yield from doing so depending on whether the two cities are on different continents and/or in different nations, for international trade routes, on the diplomatic status of the two trade partners, and for domestic routes, there must be a minimum distance between the two cities, controlled by the 'trademindist' server option (default nine tiles). <br><br> A trade route is established when a suitable unit (in the classic ruleset, a Caravan or Freight unit) enters an eligible city. For your own or allied cities, you need to issue the 'Establish Trade Route' command. This creates a trade route between the unit's home city (which might be different from the city that originally produced it) and the destination. <br><br> The origin civilization of the unit gains immediate revenue in gold and science from selling its trade goods at the destination city. The initial revenue depends on the trade already produced by the two cities involved and their distance apart. The destination civilization learns about the location of the origin city, if it is not already known. <br><br> The ongoing trade route that is established benefits both its origin and destination cities equally by generating trade points for each city every turn. The amount of ongoing trade increases with the size of each city and the distance between them, and may also depend on the factors mentioned above. The trade relationship also gives each civilization limited ongoing intelligence about the partner city. If a trade route ever becomes unsustainable -- for instance, if war breaks out in a ruleset where enemies cannot trade -- it may be permanently canceled. <br><br> Each city can only support a limited number of trade routes (the exact limit is set by ruleset and circumstance). If you attempt to establish more, the trade route with the smallest ongoing revenue is canceled if it would be less than the new route. (Otherwise, the origin civilization can still gain initial revenue by entering the marketplace and selling trade goods, but it is reduced to a third.) <br><br> This limit is enforced only when attempting to establish a new route. If you temporarily lose the ability to establish as many trade routes as a city already has, existing ones are not affected. <br><br> Beware: in rulesets where plague is enabled, it can travel along trade routes. See the section on Plague for more details. <br><br> To view the current trade routes of a city, click and hold over the Trade: line in the Overview tab in the city view."},help_goods:{name:"Goods",text:"Goods are carried via trade routes."},help_gen_goods:{generate:'"  Goods"'},help_cities:{name:"Cities",text:"Cities are your sole instrument for developing natural resources and channeling them toward expansion, technological progress, and warfare. <br><br> A city is created when Settlers are given the 'build city' command on suitable terrain, removing the unit from play to provide the city with its first citizens. A city may grow to include dozens of citizens, some working within the city while others are dispatched as new settlers. Famine, war, and plague kill citizens and reduce population, with the loss of its last citizen a city disappears (in the classic ruleset, this can leave ruins, although these have no effect on gameplay). <br><br> While city growth should usually be your aim, it comes with challenges. As cities grow, managing happiness becomes a problem, this is described in its own section. Depending on the ruleset, pollution (described in the Terrain help), plague, and migration can also be issues. <br><br> Each city may work the terrain within its reach. In the classic ruleset, this is a fixed radius of approximately three tiles, giving access to 20 tiles on rectangular maps, or 18 tiles on hexagonal ones, in addition to the city center tile. In other rulesets it may be different, and may vary depending on factors such as the size of the city and known technologies. <br><br> To extract resources from a tile, you must have a citizen working there. You cannot begin working a tile which a neighboring city is already working, nor can you work terrain upon which an enemy unit is standing, or terrain inside another player's borders. Thus you can simulate conditions of siege by stationing your units atop valuable resources around an enemy city. Units can also be ordered to pillage, which damages improvements. Worker units could even transform the terrain to make the tile less productive. <br><br> The section on Terrain describes how the output of each tile is affected by the terrain, the presence of special resources such as game or minerals, and tile improvements built by units. Note that the tile on which the city itself rests -- the city center -- gets worked for free, without being assigned a citizen. The city's tile may also receive other benefits. In the classic ruleset, it always produces at least one food and one production point regardless of terrain, gains whatever advantages the terrain offers with an irrigation system (because cities come with water systems built-in)developed with roads. Other rulesets may differ in detail. <br><br> The roles of citizens are controlled from the City dialog. Citizens working the land are represented by three numbers showing their output on the tile they are working. Clicking on these numbers will remove the citizen from the tile, turning them into a specialist (see the section on Specialists for more details)row of citizen icons. You can click another tile to assign the citizen to work it, or click on the specialist icon to change their specialist role. <br><br> Clicking on the city center tile in the city map will automatically choose citizen roles and tiles to work, with an emphasis on food production and hence growth. Citizen roles are also automatically assigned when a city grows, you may want to inspect cities that have just grown and adjust the role in which the new citizen has been placed. You can set different priorities for a city with the Citizen Governor, see its help section. <br><br> You can also request tile alterations from the city map, as an alternative to explicitly instructing units to make them. In clients which support it, right-clicking on a city map tile gives a menu of changes which can be made to that tile, such as irrigation and building roads (see the section on Terrain Alterations)select one improvement per tile at a time. These 'worker tasks' will be carried out by any units capable of them that are in 'auto settler' mode. <br><br> Citizens have a nationality distinct from that of the state they inhabit. When a city grows due to food surplus, new citizens take the nationality of the city's current owner, but when a city is conquered or otherwise transferred, its citizens retain their original nationality, as do any immigrants. Units founding or contributing citizens to a city can also bring their own nationality. <br><br> Citizens of another nationality will work in your cities just the same as your own, and behave the same in most respects, but they may become unhappy when you are at war with their associated state, their presence makes it cheaper for their state's agents to incite revolt in your cities, and if migration is enabled, they have an increased tendency to migrate to their state's cities. Over time, citizens may be assimilated into their home city, depending on ruleset settings. <br><br> Some rulesets do not have nationality, in this case, citizens always consider their nationality to be that of their home city. If nationality is enabled, you can see the cultural makeup of your cities and any consequent effects on happiness in the City dialog, on the Happiness tab. <br><br> Cities may be enhanced with a wide variety of buildings, which can improve their productivity, their military strength, or give them new abilities. See the sections on City Improvements and Wonders of the World for more information."},help_specialists:{name:"Specialists",text:"The first citizens of each city usually work the land, each toiling to yield up the resources of one terrain tile. However, there may be other specialist roles citizens can assume, in fact, taking another role is the only way they can stop working. A city may outgrow the land available for it to work, in which case some citizens must become specialists. <br><br> All specialists enjoy enough privilege to remain perpetually content -- they do not contribute to unhappiness or to celebration. See the section on Happiness for more details. <br><br> This section describes the available specialist roles, their effects, and their requirements, if any."},help_gen_specialists:{generate:'"  Specialists"'},help_happiness:{name:"Happiness",text:"Keeping your citizens happy (or at least content) is one of the most important objectives in Freeciv. When your citizens become unhappy, your cities will fall into disorder, which disrupts production, but when your citizens are happy, your cities will celebrate, and your production will increase greatly. (If migration is enabled, happiness also affects the relative desirability of cities, see the section on Migration for details.) <br><br> Each citizen working the land is either happy, content, unhappy, or angry. The normal state of a working citizen is contentment. However, as your cities grow larger, crowding causes citizens to become unhappy. In the classic rules, each citizen in a city after the fourth will be generated unhappy, instead of content. <br><br> If the number of unhappy citizens in a city exceeds the number of happy citizens, the city falls into disorder. A city in disorder produces no food or production surplus, science, or taxes, only luxury production remains. Cities which are in disorder are also easier for enemy agents to incite to revolt. Prolonged disorder under certain governments can lead to a spontaneous national revolution, overthrowing your government. <br><br> It should be stressed that only citizens working the land vary in morale -- specialists enjoy enough privilege to remain perpetually content (see the section on Specialists). Thus one solution to the problem of an unhappy citizen is simply to assign that citizen to the role of a specialist. But if cities are ever to work more than four terrain tiles at once, the problem of morale must be confronted more directly. <br><br> There are many ways of making unhappy citizens content, which does prevent disorder but is without further benefit. Producing happy citizens can balance the effect of unhappy citizens and also bring other benefits. <br><br> Cities that are sufficiently large celebrate when at least half their citizens are happy and none remain unhappy. The effects of celebration vary, in the classic ruleset, they depend on your government type: <br><br>  - Under Anarchy or Despotism, you will not suffer the normal production penalty for tiles which produce more than 2 points of any resource (food, production, or trade). <br><br>  - Under Monarchy or Communism, your city will gain the trade bonus of Republican/Democratic governments: 1 bonus trade point in any tile which already produces at least 1 trade. <br><br>  - Under a Republic or a Democracy, your city will enter 'rapture': its population will increase by 1 each turn until there is no excess food or until the number of happy citizens is no longer sufficient for celebration. Without rapture, large cities can grow only by struggling to produce a food surplus -- which can be difficult enough -- and then waiting dozens of turns for their granary to fill. <br><br> In small empires, as already stated, the fifth citizen in each city is the first unhappy one. As you gain more cities, this limit actually decreases, to simulate the difficulty of imposing order upon a large empire. The precise thresholds depend on government type, see the section on Government for details. <br><br>Thus, you may find that founding or conquering a city triggers widespread disorder across your empire. Continued empire growth may lead to further penalty steps. In empires that grow beyond the point where no citizens are naturally content, angry citizens will appear, these must all be made merely unhappy before any unhappy citizens can be made content, but in all other respects behave as unhappy citizens. <br><br>Luxury makes citizens happy. For every two luxury points a city produces, one content citizen is made happy (if there are no content citizens left, unhappy citizens become content then happy). Each city receives back some of the trade points it produces as luxury points according to your empire's tax rates, see the section on Trade. Luxury points may also be produced by other means, such as entertainer specialists in the classic ruleset. <br><br> There are several city improvements that will make content those remaining citizens that are unhappy due to crowding, such as Temples and Colosseums in the classic rules. Some wonders of the world can also have this effect. See the appropriate sections for details. <br><br> Military units can affect city happiness. Under authoritarian regimes this is helpful, as military units stationed in a city can prevent unhappiness by imposing martial law. However, under representative governments, citizens become unhappy when their city is supporting military units which have been deployed into an aggressive stance. This includes units not inside your national borders, a friendly city (including the cities of your allies), or a suitable base within three tiles of a friendly city, however, certain units ('field units') are inherently aggressive and cause unhappiness regardless of location. <br><br> If you are at war with a civilization and some of your citizens are of that nationality, those citizens may also become unhappy. <br><br> These forms of unhappiness are distinct from that caused by overcrowding, and cannot be offset by luxuries, or by most city improvements. In the classic ruleset, Police Stations and the Women's Suffrage wonder can offset unhappiness caused by units, and only a few wonders -- such as J.S. Bach's Cathedral -- can offset any kind of unhappiness, even that caused by military or diplomatic tensions. <br><br> The Happiness tab on the city dialog will give detailed insight into the mood of the citizenry and its causes."},help_plague:{name:"Plague",text:"Plague is a ruleset option, and is not enabled in the classic ruleset. <br><br> When plague strikes a city, its population is reduced by one. Unless action is taken to reduce the risk of plague, this tends to act as a natural limit on city size. Rulesets which enable plague will typically have city improvements or other means to reduce the risk of plague. <br><br> The risk of plague depends on city size (overcrowding leads to insanitary conditions) and on the pollution generated in a city. Also, plague can spread via trade routes (without regard for nationality)after a city has been struck by plague, it will remain infectious to its trade partners for several turns, increasing the risk of plague in those cities by a factor depending on the size of both cities. <br><br> If migration is enabled, citizens will tend to prefer cities with a lower risk of plague."},help_migration:{name:"Migration",text:"Migration is the movement of citizens from one city to another based on the relative attractions of living in each city. Whether migration is enabled is controlled by the server option 'migration'disabled by default. <br><br> When migration is enabled, every few turns, a citizen of each city in the game may migrate to a nearby, more attractive city, either within the same nation or even across national borders (to a lesser extent, by default). <br><br> You cannot directly prevent or direct the migration of citizens. However, you can influence the attractiveness of your cities. The following factors affect the perceived desirability of each city, in approximately decreasing order of importance. (Each factor counts for much more in the citizen's current city, as they prefer not to move without a compelling reason.) <br><br>  - City size. <br><br>  - The number of happy citizens. (To a lesser extent, unhappy and angry citizens reduce the desirability of a city.) <br><br>  - In rulesets where nationality is enabled, citizens have a strong preference to move to cities of their own nationality. <br><br>  - The presence of any wonder in a city will greatly increase its desirability (further wonders do not contribute except by the lesser effect of their build cost). <br><br>  - Capital cities are more attractive than other cities, all other factors being equal, in addition, citizens will never migrate out of a capital city. <br><br>  - A high risk of plague reduces a city's attractiveness. <br><br>  - Food surplus. (A food deficit reduces the desirability of a city.) <br><br>  - Cities that are further away are less desirable. The absolute maximum distance that a citizen is prepared to migrate is controlled by the server option 'mgr_dist'. <br><br>  - Trade surplus. <br><br>  - Luxury and science output. <br><br> - The quantity of city improvements (and wonders), measured by build cost. <br><br>  - Depending on the ruleset, a number of other factors such as government type and city improvements may increase or decrease the desirability of cities, these are noted in other sections of the help. (The classic ruleset contains no such effects.) <br><br> Citizens will not migrate to cities which cannot increase in size to support them, for instance due to lack of a city improvement such as an Aqueduct. If the server option 'mgr_foodneeded' is set, they will not migrate to cities which would not have enough food to support them. <br><br> Migration can even cause cities to be completely abandoned (ownership of any units being transferred to your nearest remaining city). However, cities with wonders will never be disbanded (so the wonder will not be destroyed), and the last citizen from your only remaining city will never migrate to another nation. <br><br> Several of the details of migration can be changed with the 'mgr_*' server options."},help_city_improvements:{name:"City Improvements",text:"Cities may be improved with a wide variety of buildings, each with a different effect. Each city may have only one of each improvement, and some improvements require others to have been built first. <br><br> It costs production points to build improvements, and once completed, many improvements require an upkeep of one or more gold pieces per turn. You may dismantle and sell an improvement, receiving one gold piece for each production point used in its construction, although you may only sell one improvement per city per turn. If a turn comes on which you cannot pay the upkeep on all of your improvements, some of them will be automatically sold, obviously this should be avoided as the improvements chosen might not be ones you would have preferred to sell. <br><br> Most improvements become available only when you achieve certain technologies, and some improvements can become obsolete, at which point they are automatically sold."},help_gen_improvements:{generate:'" Improvements"'},help_wonders_of_the_world:{name:"Wonders of the World",text:"Wonders are special buildings which can each be completed by only one player each game, and which often enhance their entire civilization. Unlike ordinary city improvements, which must be built with local production points, certain special units built in one city (Caravans and Freight in the classic ruleset) can contribute their full cost in production points towards the construction of a wonder in another city. <br><br> Once built, a wonder is placed in the city that constructed it, and cannot be sold or destroyed (unless the entire city is destroyed). However, some wonders are made obsolete under certain, ruleset dependant, circumstances, and lose their effect. Note the asymmetry under many rulesets: while you must personally achieve the advance required by each wonder to build it, it will be disabled when any player achieves the obsoleting advance."},help_gen_wonders:{generate:'" Wonders"'},help_units:{name:"Units",text:"Units provide both the mobility your civilization needs, and the violence with which it will survive and expand. The available units may be classified as military units, whose talents are those of defense and aggression, and a few noncombatants which support expansion, diplomacy, and trade. <br><br> Units are usually built in cities using production points. Once built, units are owned by the city that built them (although they can later be re-homed while visiting a different city) and demand support from that city, this will be one of your major expenses. Most units require upkeep such as production points from their home city every turn, although some autocratic styles of government can force cities to support several units for free. If the upkeep of a unit outweighs its benefit, you can disband it, see the section on Production. A few units, particularly those that you start the game with, have no home city and thus require no upkeep. <br><br> Most units begin every turn with one or more movement points. Every action undertaken by a unit consumes movement points. <br><br> The most basic action is movement, units can move into any of the tiles surrounding their current location, subject to restrictions imposed by their physical nature (the terrain they are 'native' to), by diplomatic obligations (see the section on Diplomacy), and by enemy units (see the section on Zones of Control). The number of movement points consumed may depend on the type of terrain, see the Terrain help. <br><br> A unit cannot move onto a tile occupied by an enemy unit, and when directed to do so will attack instead (if capable of attack), locking the two units in combat until one is destroyed. The outcome depends on the attributes of the units in question (hit points, attack and defense strength, and firepower)process in detail, and the following sections list specific units' attributes. <br><br> Units' attributes can be further boosted by being veteran. Units may be built as veteran by means of certain city improvements or other influences, once built, units can also become veteran through experience (such as surviving combat), which may provide further levels of bonuses beyond those available from their initial training. <br><br> \"$VeteranLevels \", Units which have been damaged in combat will regain hit points each turn in which they are not moved. Normally, a unit which has not moved will regain one hit point per turn. Units which are fortified gain an extra hit point. A unit which spends a turn in a city regains one third of its base hit points, and city improvements appropriate to the unit type can improve this further. In the field, bases on tiles can improve the recovery rate (for instance, fortresses in the classic ruleset have this effect)for a whole turn to get this recovery bonus. Wonders can also boost recovery (such as the United Nations in the classic ruleset). Damaged units in Sentry mode will wake up when they have regained all of their hit points. <br><br> As technology advances, new types of units become available which obsolete existing types. When you discover such a new technology, your existing units remain intact, but you can no longer build new units of the obsolete type. While an obsolete unit is in one of your cities, you can choose to upgrade it to the latest equivalent by spending gold, with the cost increasing with the difference in production point cost between the two types. When a unit is upgraded, its hit points and movement points are preserved as a fraction of the total, however, in some rulesets (but not the classic rules) it will lose some or all of its veteran levels."},help_gen_units:{generate:'" Units"'},help_combat:{name:"Combat",text:"In standard combat, when one unit attacks another unit, either the attacker will be destroyed, or the defender will be destroyed -- never both (unless the attacker was a missile). <br><br> (In some rulesets, certain units sometimes use a different style of attack called 'bombardment', which works rather differently: the attacker sustains no damage, and damages every unit in the target tile or city, but defenders are never completely destroyed.) <br><br> The outcome of combat depends on several factors, including chance. <br><br> The description below is for the classic ruleset, but the principles are similar for any ruleset. Notice that many bonuses are possible for defenders, but few for attackers, aside from veteran status, an attacking unit can mostly expect circumstance to work against it. <br><br>First, the attacker's strength is modified. <br><br>  - If the attacker is a veteran, its strength is multiplied by the bonus associated with its veteran level. <br><br>  - Some rulesets (but not the classic rules) have 'tired attacks': a unit that attacks with less than a full movement point will have its strength proportionally reduced. <br><br>Next, the defender's strength is modified. <br><br>  - If the defender is a veteran, then its strength is multiplied by the bonus associated with its veteran level. <br><br> - Then the defender's strength is multiplied by the defense factor of the terrain it occupies. <br><br> - If the defender is fortified, or is of a type that could fortify and is inside a city, its strength is multiplied by 1.5. <br><br>  - Ruleset-specific bonuses are applied: <br><br>   - The defender's strength is doubled if it is a Pikeman unit defending against a mounted unit. <br><br>   - If the defender is an AEGIS Cruiser defending against airborne units (including missiles and Helicopters), the defense is quintupled. <br><br>   - The defender's strength is doubled again if it is in a city with a SAM Battery and the attacker is an air unit (other than a Helicopter or a missile). <br><br>   - An SDI Defense doubles the defender's strength against missile attacks. <br><br>   - If the attacker is a ship and the defender is in a city with a Coastal Defense, the defender's strength is doubled. <br><br>   - Against land units (other than Howitzers) and Helicopters, defending units in a city with City Walls have their strength tripled. <br><br>   - If the defender is in a fortress (and not a city), its strength is doubled. <br><br>   - Finally, if the attacker is a fighter and the defender is a helicopter, the defender's strength is halved. <br><br> If, after these modifications, the attacker has a strength of 0, it automatically loses. Otherwise, if the defender has a strength of 0, the defender loses. <br><br>The firepower of the attacker and defender are also modified. <br><br> - If the defender is a ship and is inside a city the firepower of the attacker is doubled and the firepower of the ship is set to 1. <br><br> - If a fighter is attacking a helicopter the firepower of the helicopter is set to 1. <br><br> - If neither unit could move to where the other is, such as a ship attacking a land unit on land, the firepower of both is set to 1. <br><br> After these preliminaries, combat occurs, as long as both units are still alive (i.e., hit points are greater than 0). Each round, a random number between 1 and the sum of the attacker's and defender's strengths is generated. If this number is greater than the defender's strength, the defender loses hit points equal to the attacker's firepower. Otherwise, the attacker loses hit points equal to the defender's firepower. The first unit to reach 0 hit points (or negative hit points) loses. <br><br>Whichever unit survives the fight has a chance of being promoted a veteran level. In the classic ruleset, if the winner's civilization has the Sun Tzu's War Academy (and if it isn't obsolete), the chance is increased by half in case of land units. <br><br>If the attacker is a land unit and wins, and the defender is in a city without City Walls, the city is reduced in size by 1. (This can be changed with the 'killcitizen' server option.) <br><br>If the defender loses, and is not inside a city, fortress, or airbase, all other units at the defender's location may be destroyed along with the defender. (This can be changed with the 'killstack' server option.)"},help_combat_example_1:{name:"Combat example 1",text:"Suppose a Cannon (A:8, D:1, HP:20, FP:1) attacks a Musketeer (A:3, D:3, HP:20, FP:1) inside a city with City Walls built on a Forest tile.  Neither are veteran. <br><br> The defender's base strength is 3.  Because it is on a Forest tile, its strength becomes 4.5.  It is behind City Walls, so its strength is tripled, to 13.5.  It is a ground unit inside a city, so its strength is increased to 20.25. <br><br> Strength values inside the game are actually multiplied by 10, with fractions dropped, so the attacker's strength is 80, and the defender's strength is 202. <br><br> Both units keep their firepower of 1 unchanged. <br><br> Each round of combat, a random number between 1 and 282 is generated.  If the number is greater than 202 (about a 28% chance), the defender loses 1 hit point.  Otherwise (about a 72% chance), the attacker loses 1 point. <br><br> Since both units have 20 hit points, the odds favor a victory for the defender.  The defender will probably lose somewhere around 40% of its hit points during the fight.  But the outcome is never certain as long as both units have non-zero strengths, the defender might emerge untouched, or it might lose most of its hit points, or it might even lose the battle."},help_combat_example_2:{name:"Combat example 2",text:"Suppose a veteran Battleship (A:12, D:12, HP:40, FP:2) with 3 movement points attacks a veteran Alpine Troops (A:5, D:5, HP:20, FP:1) inside a city built on a Grassland tile, with City Walls and a Coastal Defense. <br><br> The attacker's strength is 12, raised to 18 because of veteran status. <br><br> The defender's strength is 5, raised to 7.5 due to veteran status. The terrain's defense factor is 1 (no effect).  The Coastal Defense doubles the defender's strength to 15. (The City Walls have no effect against attacking sea units.) The defender is a ground unit inside a city, so its total strength is 22.5. <br><br> Internally, the values used for attacker and defender strength are  180 and 225, respectively. <br><br> The firepower of the Battleship is set from 2 to 1. <br><br> Each round, a random number from 1 to 405 is generated.  If it is greater than 225 (about a 44% chance) the defender loses 1 hit point.  Otherwise, the attacker loses 1 hit point. <br><br> In this case, the odds greatly favor the attacker winning.  The Battleship is 25% less likely to score a hit in any given round, but the Battleship has twice as many hit points. The Battleship should expect to lose about 60% of its hit points during the fight, and should expect to have no movement points left."},help_zones_of_control:{name:"Zones of Control",text:"Zones of Control, abbreviated as ZOC, is a game concept which prevents you moving freely in zones controlled (or partially controlled) by enemy forces. <br><br> Zones of control are only enforceable on some terrain -- in the classic rules, only on land tiles. When ZOC applies, the general rule is that a unit which is adjacent to an enemy occupied tile cannot move directly to another tile which is also adjacent to an enemy occupied tile. An enemy occupied tile is one with a foreign unit of a type that imposes ZOC, unless you have an Alliance pact with that nation. Adjacency means any of the eight tiles surrounding a unit for rectangular grids, or six tiles for hexagonal grids. <br><br> In the following special cases, units can move regardless of ZOC:<br>- A unit moving directly into or out of a city.<br>- A unit moving onto a tile already occupied by a friendly unit.<br>- A unit moving to or from a terrain where ZOC cannot be enforced, for instance, in the classic rules, a land unit disembarking from a boat which is on an ocean tile.<br>- A unit type which explicitly ignores ZOC, such as Diplomats and Spies in the classic rules. <br><br> Notes: <br><br> - ZOC does not restrict unit attacks, only movement. <br><br> - Units may only impose ZOC when they are on terrain that supports it. Thus, units that are not native to terrain effectively cannot impose ZOC except for the special case where they are in a city. <br><br> - An enemy city counts as an enemy occupied tile if there are any units inside the city, but not if the city is empty. <br><br> TIP:  You can infiltrate enemy zones by first moving in a Diplomat (or some other unit which ignores ZOC), and then moving regular units onto the tile now occupied by the Diplomat. By repeating this process (and optionally leaving some units behind to keep tiles occupied), you can make a path through enemy territory."},help_government:{name:"Government",text:"Your government type influences your cities' productivity and commerce, your citizens' happiness, and many other game factors. <br><br> In the classic rules, your start out ruling your civilization through Despotism. As your technology improves, you can select other forms of government (listed below). In order to change your form of government, you must start a revolution. This will cause your civilization to undergo a period of Anarchy (lasting 1-5 turns)at the end of this time, you will be able to choose your new government. <br><br> TIP 1:  Offensive military campaigns are difficult under Republican and Democratic governments unless you give your citizens lots of luxuries to keep them happy. When conquering other civilizations, it may be helpful to switch to one of the more militant styles of government. <br><br> TIP 2:  Scientific advancement requires high levels of trade, which are much easier to achieve under Republican and Democratic governments. Consider switching to the Republic as soon as you can, gaining advanced technology early in the game puts you at an advantage."},help_gen_governments:{generate:'" Governments"'},help_civil_war:{name:"Civil War",text:"Civil war is devastating to any empire. In rulesets with civil war, it is triggered by the loss of your capital. Up to half of your cities will rebel and declare allegiance to a new (AI) leader, who will loot half of your treasury and retain all of your scientific advances. <br><br> Players remain in the civil war state for just one turn, after which the empire enters a state of anarchy. <br><br> The capture of your capital does not always lead to civil war. If you have treated your people with kindness, you are more likely to retain their loyalty. Each city that is celebrating reduces the chance of civil war, while each city in disorder increases the likelihood. <br><br> In addition, the form of government directly contributes to the chance of civil war. Governments with universal franchise are far less likely to revolt than those more despotic in nature. <br><br> The number of cities an empire needs before it can erupt into civil war is by default 10. That is, empires with fewer than 10 cities are immune from civil war. However, this is a server option ('civilwarsize'), and may vary upwards from a minimum of 6."},help_policies:{name:"Policies",text:"Some rulesets define 'policies'. These are empire-wide settings, usually trade-offs similar to tax rates. If the current ruleset defines any policies, they are described in the following sections. <br><br> You may change policy values at any time, but any changes only take effect at the next turn."},help_gen_policies:{generate:'" Multipliers"'},help_diplomacy:{name:"Diplomacy",text:"There are five diplomatic states between players: War, Cease-fire, Armistice, Peace, and Alliance. The first is the natural state, while the others can be achieved by signing diplomatic treaties. <br><br> During War, you can freely move your units inside enemy territory and attack their units and cities at will. <br><br> When two players decide to end hostilities between them, they can agree on a Cease-fire treaty. This prevents each player from attacking the other, but you can still move your units inside the other player's borders. After a set number of turns, the Cease-fire will lead back to War. Upon first contact with an AI player, it will automatically offer you a Cease-fire treaty. <br><br> If you wish for a more permanent peaceful coexistence with another player, you may sign a peace pact. This will enter a transitional Armistice state, which after another set number of turns will turn into a permanent Peace. Breaking an Armistice will drop you directly back to War. <br><br> At the moment two players enter into the diplomatic state of Peace, all military units belonging to either player that happen to be within the other's borders will be automatically disbanded according to the treaty. After this, you may not move military units into the other's territory until you either declare War, or forge an Alliance. Breaking a Peace treaty will drop you directly back to War. <br><br> An Alliance is the ultimate diplomatic relationship between two players. In this state, you may move units into each other's cities and your units may share the same tile, units no longer impose zones of control. However, alliance treaties come with obligations, you won't be able to ally with a player that is at war with a current ally unless you break the first treaty. If one of your allies declares war on another, the alliance with the aggressor is automatically broken. Breaking an Alliance will drop you to an Armistice treaty. An allied AI player will freely give you its world maps and shared vision, and will seriously consider trading technologies and cities, but in return will expect you to join its wars against other players."},help_technology:{name:"Technology",text:"Research into technology is a necessity for improving the ability of your civilization to develop new military units and city improvements. <br><br> There are a few ways to gain advances from other civilizations: you will sometimes discover enemy technology when you capture a city, your agents can steal advances, wonders can provide you with technology, and another player might grant technology in the terms of a pact. But otherwise advances must be discovered through the efforts of your own people. <br><br> Most technology progress comes from trade (see the Trade section) and, in the classic ruleset, from scientist specialists (see the Specialists section). While it is possible to change which advance you are currently researching, by default all progress is lost by doing so. <br><br> While the majority of the resulting research output ('bulbs') usually goes toward advancing technology, in some rulesets (but not the classic rules), some of it may be diverted to maintain expertise in existing technologies, the quantity required for technology upkeep increases with the total research cost of all advances known to you. The state of advancement at which you start paying this upkeep may depend on factors such as your government type. If research output drops below that required for upkeep, your civilization will forget an advance, requiring it to be researched again. <br><br> Technological advances can render units, city improvements, and wonders obsolete. While obsolete units merely become impossible for you to make -- leaving the ones you have already made intact -- obsolete improvements are immediately sold, and obsolete wonders lose their effect. See the relevant sections for more information."},help_gen_techs:{generate:'" Techs"'},help_space_race:{name:"Space Race",text:"The Space Race is a second option to win the game, besides eliminating all other civilizations. If your spaceship arrives first at Alpha Centauri, the game is over and you have won. (However it is possible for this to be disabled on the server.) <br><br> In the classic rules, before you can build spaceship parts, the Apollo Program wonder must have been built by any player. You also need specific technologies to build the different spaceship parts: see the help texts for Space Structural, Space Component, and Space Module, under City Improvements. (If there are no help texts for these items, it probably means the 'SPACERACE' victory type is not enabled in the 'victories' server setting for your game.) <br><br> When you have started building your spaceship, you can see it with the 'Spaceship' command in the Report menu. To see spaceships of other players, select the player in the Nations report and click 'Spaceship'. <br><br> If the success probability is below 100%, some fraction of the people on board may not survive the journey. This reduces the score bonus from the spaceship, but it still counts as a win. <br><br> If the capital of a civilization is captured, a spaceship that has been launched will be lost, so defend your capital well! <br><br> TIP:  If an enemy civilization has launched a spaceship, try to quickly build a light spaceship with many propulsion units that will arrive earlier. The only other option is to capture their capital."},help_gen_ruleset:{generate:'"Ruleset"'},help_gen_tileset:{generate:'"Tileset"'},help_nations:{name:"About Nations",text:"Each player in the game is represented by a nation. A nation can be a modern-day nation state, a historical state or empire, an ethnic group, or even a fictional nation. <br><br> Nations are distinguished by their flags, leaders and city names, in the classic rules they are identical in all other aspects and play by the same rules, but other rules may have nation-specific behavior."},help_gen_nations:{generate:'" Nations"'},help_connecting:{},help_controls:{name:"Controls",text:"Unit Orders:<br>============<br>  a: (a)uto-settler  (settler/worker units)<br>  b: (b)uild city  (settler units)<br>  b: help (b)uild wonder  (caravan units)<br>  B: go to and (B)uild city on target tile  (settler units)<br>  d: (d)o an action to the selected tile (press twice to target own tile)<br>  D: (D)isband unit<br>  E: build airbas(e)  (airbase units)<br>  f: (f)ortify unit  (military units)<br>  F: build (f)ortress  (settler/worker units)<br>  g: (g)o to tile  (then left-click mouse to select target tile)<br>  g: add a (g)o-to waypoint  (when in go-to mode)<br>  G: return unit to nearest friendly city<br>  h: set unit's (h)omecity  (to city on current tile)<br>  i: build (i)rrigation or convert terrain  (settler/worker units)<br>  I: change terrain by cultivating<br>  Ctrl+I: connect current and target tile with (I)rrigation<br>  Ctrl+I: set an (I)rrigation waypoint  (when connecting with irrigation)<br>  l: (l)oad unit on transporter<br>  Ctrl+L: connect current and target tile with rai(L)<br>  Ctrl+L: set a rai(L) waypoint  (when connecting with rail)<br>  m: build (m)ine or convert terrain  (settler/worker units)<br>  M: change terrain by planting<br>  n: clean (n)uclear fallout<br>  N: explode (N)uclear<br>  o: transf(o)rm terrain  (engineer unit)<br>  O: c(O)nvert to another kind of unit<br>  p: clean (p)ollution  (settler/worker units)<br>  p: drop (p)aratrooper  (paratroop units)<br>  P: (P)illage  (destroy terrain alteration)<br>  q: patrol with unit  (then left-click mouse to select other endpoint)<br>  q: add a patrol waypoint  (when in patrol mode)<br>  r: build (r)oad/railroad  (settler/worker units)<br>  r: establish trade (r)oute  (caravan units)<br>  Ctrl+R: connect current and target tile with (R)oad<br>  Ctrl+R: set a (R)oad waypoint  (when connecting with road)<br>  s: (s)entry unit<br>  S: un(S)entry all units on tile<br>  t: unit go (t)o/airlift to city<br>  T: unload all units from (T)ransporter<br>  u: (u)nload unit from transporter<br>  U: (U)pgrade unit<br>  x: unit auto e(x)plore<br> <br><br> Unit Selection:<br>==============<br>  z: select only first unit of selected group<br>  v: select all units on tile<br>  V: (on tile) select all units of the same type as the active unit<br>  C: (on continent) select all units of the same type as the active unit<br>  X: (everywhere) select all units of the same type as the active unit<br><br>  w: (w)ait: focus on next unit<br>  5: focus on previous unit<br>space: done giving orders  (unit stays put)<br> <br><br> Unit Movement:<br>==============<br>  1: move south-west<br>  2: move south<br>  3: move south-east<br>  4: move west<br>  6: move east<br>  7: move north-west<br>  8: move north<br>  9: move north-east<br> <br><br> Main Map (Keys):<br>================<br>  Some clients support zooming/scaling the map graphics with the + and - keys.<br>  c: (c)enter view on active unit<br>    Shift-home: center view on capital<br>  Shift-arrows: scroll map<br><br>  Ctrl-B: show/hide national borders<br>  Ctrl-D: show/hide city trade routes<br>  Ctrl-G: show/hide map grid lines<br>  Ctrl-N: show/hide city names<br>  Ctrl-P: show/hide city production<br>  Ctrl-O: show/hide city growth<br>  Ctrl-W: show/hide city output<br>  Ctrl-Y: show/hide city outlines<br> <br><br> Main Map (Mouse):<br>=================<br>  Left-click on city:            Pop up city dialog<br>  Left-click on unit:            Select a single unit<br>                                 (cancels any current activity if 'clear<br>                                 unit orders on selection' is set)<br>  Shift-left-click on unit:      Add unit to selection (GTK)<br>  Left-click-and-drag on unit:   Go-to command for unit<br>                                 (if 'keyboardless goto' enabled in options)<br>  Center-click, Alt-left-click:  Show tile info<br>  Right-click:                   Center tile in view<br>  Ctrl-center-click:             Wake up sentried units <br><br>   Quick unit selection:<br>  =====================<br>  Ctrl-left-click on tile:       Select a sea unit (prefers transporters)<br>  Ctrl-right-click on tile:      Select a land unit (prefers military)<br><br>  These combinations choose and select a single unit from those on a tile. All other things being equal, units which have movement points left are preferred. If keyboardless goto is enabled, dragging allows the unit to be selected and moved in one gesture. <br><br>   City manipulation (GTK):<br>  ========================<br>  Shift-Ctrl-left-click:         Adjust city workers<br>  Shift-Alt-right-click:         Show city workers (mouse over or near city)<br>  Shift-right-click:             Copy production (from city or unit)<br>  Shift-Ctrl-right-click:        Paste production into city <br><br>   Area Selection mode (GTK):<br>  ==========================<br>  Right-click-and-drag:          Select units/cities by area<br>  Shift-right-click-and-drag:    Append area contents to existing selection<br><br>  In this mode, multiple units and/or cities are selected. If the selection rectangle contains any cities, and 'Select cities before units' is set in the options, only the cities are selected and the current unit selection is left alone, otherwise, both cities and units are selected.<br><br>  Selected cities are highlighted on the map and in the Cities report for further mass actions. Immediately after selecting, the set of cities can be adjusted by left-clicking on individual cities, and the production for all the highlighted cities can be changed with Shift-Ctrl-right-click (see previous section). Right-clicking leaves this mode. <br><br>   Chatline (GTK):<br>  ===============<br>  ' (apostrophe):                Focus chatline<br>  Ctrl-Alt-right-click:          Paste city or tile link into chatline<br>  Shift-Ctrl-Alt-right-click:    Paste unit link into chatline<br><br>  These controls allow map elements to be referred to in chat. See the Chatline help for more details.<br> <br><br> Overview Map (Mouse):<br>=====================<br>  Left-click, Shift-left-click, and Right-click have the same functions as they do on the main map.<br> <br><br> Dialogs and Reports:<br>====================<br>     F1: show Map View<br>     F2: open Units Report<br>     F3: open Nations Report<br>     F4: open Cities Report<br>     F5: open Economy Report<br>     F6: open Research Report<br>     F7: open World Wonders<br>     F8: open Top Five Cities<br>     F9: open Messages dialog<br>    F11: open Demographics<br>    F12: open Spaceship<br><br>        Ctrl-F: open Find City dialog<br>        Ctrl-L: open Worklists dialog<br>        Ctrl-T: open Tax/Lux/Sci Rates dialog<br>  Shift-Ctrl-R: open Revolution dialog<br><br>Shift-Return: Turn done <br><br> Editing Mode (GTK):<br>===================<br>    Ctrl-E: toggle editing mode<br>    Ctrl-M: toggle fog of war in editing mode<br>"},help_governor:{},help_chatline:{},help_worklist_editor:{},help_languages:{},help_copying:{},help_about:{}};(function(){var template=Handlebars.template,templates=Handlebars.templates=Handlebars.templates||{};templates["city"]=template({compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1;return'<div id="city_tabs">\n  <ul id="city_tabs_panel">\n    <li class="city_tab">\n      <div id="ixtjkiller2" style="color: rgb(0, 0, 0); position: absolute; cursor: pointer; background: rgba(0, 0, 0, 0); overflow: hidden; left: 0px; top: 0px; z-index: 999 !important;" onclick="clickMask(event, 2)"><img id="ixtjkiller22" src="/images/ixtjkiller.png"></div>\n      <a id="ct0" href="#city_tabs-0" onclick="city_change_tab(0);">&#x2191;<u><b style=\'font-family:FreecivBlack\'>M</b></u>ain</a></li>\n    <li class="city_tab"><a id="ct1" href="#city_tabs-1" onclick="city_change_tab(1);">&#x2193;Pro<u><b style=\'font-family:FreecivBlack\'>d</b></u>uction</a></li>\n    <li class="city_tab"><a id="ct2" href="#city_tabs-2" onclick="city_change_tab(2);"><u><b style=\'font-family:FreecivBlack\'>R</b></u>outes</a></li> \n    <li class="city_tab extra_tabs_big" onclick="city_change_tab(3);"><a id="ct3" href="#city_tabs-3"><u><b style=\'font-family:FreecivBlack\'>O</b></u>ptions</a></li>\n    <li class="city_tab"><a id="ct4" href="#city_tabs-h" onclick="city_change_tab(4);"><u><b style=\'font-family:FreecivBlack\'>H</b></u>appy</a></li> \n    <li class="city_tab"><a id="ctg" href="#city_tabs-g" onclick="city_change_tab(5);"><u><b style=\'font-family:FreecivBlack\'>G</b></u>overnor</a></li>\n    <li class="city_tab extra_tabs_small" onclick="city_change_tab(6);"><a id="cti" href="#city_tabs-i">Inside</a></li>\n  </ul>\n\n  <div id="city_tabs-0">\n    <div id="city_overview_tab" class="citydlg_tabs">\n    <div id="city_viewport">\n    <div id="specialist_panel"></div>\n    \n    <div class="city_panel">\n            <div id="city_canvas_top_div" class="city_panel" style=\'float:left;margin-top:0px\'>\n            <div id="city_canvas_div">\n                    <canvas id="city_canvas" width="505" height="265" moz-opaque="true"></canvas>\n            </div>\n        </div>\n    </div>\n\n    <div id="city_panel_top" class="city_panel">\n      <div id="city_panel_stats" class="city_panel" style=\'float:left;margin-top:0px\'>\n      <div id="city_dialog_info">\n      <div id="city_panel_left_info" style=\'float:left;\'> \n      <div id="rapture_citizen_panel" style=\'height:20px;\'></div>\n\t  <div><b>City information:</b></div>\n        <div id="city_size_production_info" style="float:left;">\n\t  </div>\n\t  <span id="city_size"></span>\n\t  <div id=\'city_production_overview\'></div>\n\t  <div id=\'city_production_turns_overview\'></div>\n\t  <div id=\'city_airlift_capacity\' class=\'airlift\' style=\'padding-top:2px\'>'+((stack1=container.lambda(depth0!=null?depth0.airlift:depth0,depth0))!=null?stack1:"")+'</div>\n\t</div>\n    <div style=\'float:left; margin-top: -23px;\'> \n\t<div style=\'float: left; padding-left: 20px;\'> \n\t  <table id="city_stats">\n\t  <tr style=\'line-height:17.5px;\'><td id="rapture_food" style=\'padding-bottom:8px;\'></td><td id="rapture_status" title=\'The city status (Celebrating, Peace or Disorder)\'></td><td></td></tr>\n\t  <tr><td>Food: </td><td id="city_food"></td><td id="city_food2"></td></tr>\n\t  <tr><td>Prod: </td><td id="city_prod"></td><td id="city_prod2"></td></tr>\n\t  <tr><td>Trade: </td><td id="city_trade"></td><td id="city_trade2"></td></tr>\n\t  <tr><td>Gold: </td><td id="city_gold"></td><td id="city_gold2"></td></tr>\n\t  <tr><td>Luxury: </td><td id="city_luxury"></td><td id="city_luxury2"></td></tr>\n\t  <tr><td>Science: </td><td id="city_science"></td><td id="city_science2"></td></tr>\n\t  <tr><td>Corruption: </td><td id="city_corruption"></td><td></td></tr>\n\t  <tr id="city_waste_row"><td>Waste: </td><td id="city_waste"></td><td></td></tr>\n    <tr id="city_steal_row"><td>Tech theft: </td><td id="city_steal"></td><td></td></tr>\n\t  <tr><td>Pollution: </td><td id="city_pollution"></td><td></td></tr>\n  \t  </table>\n        </div>\n     </div>\n     </div>\n     </div>\n\n    </div>\n    <div id="city_improvements_panel" class="city_panel">\n      <div style="clear: left;"></div>\n      <div id="city_improvements">\n        <div id="city_improvements_title">City Improvements:</div>\n        <div id="city_improvements_list"></div>\n      </div>\n      \n      <div id="city_present_units" >\n        <div id="city_present_units_title">Present Units:</div>\n        <div class="noscrollbars" id="city_present_units_list"></div>\n      </div>\n\n      <div id="city_supported_units" >\n        <div id="city_supported_units_title">Supported Units:</div>\n        <div class="noscrollbars" id="city_supported_units_list"></div>\n      </div>\n\n    </div>\n\n\n  </div>\n  </div>\n  </div> \n  <div id="city_tabs-1">\n    <div id="city_production_tab" class="citydlg_tabs">\n      <div id=\'worklist_left\'>\n        <div id=\'worklist_dialog_headline\' title="Click to remove from worklist. Remaining worklist will move up."></div>\n        <div id=\'worklist_heading\'>Worklist:</div><div id=\'city_current_worklist\'></div>\n      </div>\n      <div id=\'worklist_right\'>\n        <div id=\'tasks_heading\'>\n          <input id=\'show_unreachable_items\' type=\'checkbox\' class="css-checkbox" name=\'show_unreachable_items\' checked>\n          <label for="show_unreachable_items" name="show_unreachable_items_lbl" class="css-label dark-check-orange">Unreachable items</label>\n          <input id=\'show_improvements_only\' type=\'checkbox\'/ class="css-checkbox" name=\'show_unreachable_items\'>\n          <label for="show_improvements_only" name="show_improvements_only_lbl" class="css-label dark-check-blue">Improvements only</label><span id=\'info_city_prod\' style=\'float:right;\'></span>\n          <br/>\n          Choices:\n        </div>\n        <div id=\'worklist_production_choices\'></div>\n      </div>\n      <div id=\'prod_buttons\'>\n        <button type="button" class="button" onClick="city_change_production();" \n         id="city_change_production_btn" title="or: ALT-click a selection above">Change Production</button>\n        <button type="button" class="button" onClick="city_add_to_worklist();"\n         id="city_add_to_worklist_btn" title="or SHIFT-click item to append, ALT-SHIFT-click to insert above.">Add to worklist</button>\n      </div>\n      <div id="worklist_control">\n        <button type="button" class="button" onClick="city_insert_in_worklist();" id="city_worklist_insert_btn" title="Insert before first selected task, or first in the list"><i class="fa fa-chevron-left fa-fw"></i></button>\n        <button type="button" class="button" onClick="city_add_to_worklist();" id="city_worklist_append_btn" title="Append to end of worklist"><i class="fa fa-download fa-fw"></i></button>        \n        <div class="wc_spacer"></div>\n        <button type="button" class="button" onClick="city_worklist_task_up();" id="city_worklist_up_btn" style="height: 20%;" title="Move selected tasks up"><i class="fa fa-chevron-up fa-fw"></i></button>\n        <button type="button" class="button" onClick="city_worklist_task_down();" id="city_worklist_down_btn" style="height: 20%;" title="Move selected tasks down"><i class="fa fa-chevron-down fa-fw"></i></button>\n        <div class="wc_spacer"></div>\n        <button type="button" class="button" onClick="city_exchange_worklist_task();" id="city_worklist_exchange_btn" title="Change selected tasks"><i class="fa fa-exchange fa-fw"></i></button>\n        <div class="wc_spacer"></div>\n        <button type="button" class="button" onClick="city_worklist_task_remove();" id="city_worklist_remove_btn" title="Remove selected tasks"><i class="fa fa-trash fa-fw"></i></button>\n      </div>\n    </div>\n  </div> \n  <div id="city_tabs-2">\n    <div id="city_traderoutes_tab" class="citydlg_tabs"></div>\n  </div> \n  <div id="city_tabs-3">\n    <div id="city_settings_tab" class="citydlg_tabs">\n      <div id="city_disband_options" >\n        <input id=\'disbandable_city\' type=\'checkbox\' class="css-checkbox" name=\'disband_city0\' value="disband_city0"/>\n        <label for="disbandable_city" name="disbandable_city_lbl" class="css-label dark-check-red">Disband city if Settlers built at size 1.</label>\n      </div>\n\n    </div>\n  </div>\n\n   <div id="city_tabs-h" class="citydlg_tabs">\n      <div id="city_happy_tab">           \n      </div>\n   </div>\n\n  <div id="city_tabs-g" class="citydlg_tabs">\n      <div id="city_governor_tab">\n        <header><div id="cma_status" style="font-size: 150%">&#x274c;  City Governor <b>Disabled</b>.</div></header>\n        <button type="button" class="button ui-button ui-corner-all" onclick="button_pushed_toggle_cma();" id="btn_toggle_cma" title="Enable city governor in this city"><b>Enable</b></button><button type="button" class="button ui-button ui-corner-all mobile_remove" onclick="button_pushed_refresh_cma();" id="btn_refresh_cma" title="Reset or refresh the On-Screen Settings back to the saved state of the City Governor Settings.">Reload</button><button id="btn_cma_help" type="button" class="button ui-button ui-corner-all" style="float:right" onclick="show_governor_help();" title="How to use City Governors">Help</button>\n        <form name="cma_vals"><table border="0"><tbody><tr><th id="cma_priorities_hdr" style="color: rgb(164, 190, 146); text-shadow: 1px 2px #000; font-size:133%">Output Priorities</th></tr><tr> <td><span style="margin-left:-30px; float:right"><b>Food </b><img style="" class="lowered_gov" src="/images/wheat.png"></span></td> <td><div class="cma_slider" id="cma-val-slider-Food"></div> </td><td> <div class="food_text cma_slider no_bg" id="Food_val_result" style="text-shadow: 2px 1px #000; float:left;"></div> </td></tr><tr> <td><span style="margin-left:-30px; float:right"><b>Shield </b><img style="" class="lowered_gov" src="/images/shield14x18.png"></span></td> <td><div class="cma_slider" id="cma-val-slider-Shield"></div> </td><td> <div class="prod_text cma_slider no_bg" id="Shield_val_result" style="text-shadow: 2px 1px #000; float:left;"></div> </td></tr><tr> <td><span style="margin-left:-30px; float:right"><b>Trade </b><img style="" class="lowered_gov" src="/images/trade.png"></span></td> <td><div class="cma_slider" id="cma-val-slider-Trade"></div> </td><td> <div class="trade_text cma_slider no_bg" id="Trade_val_result" style="text-shadow: 2px 1px #000; float:left;"></div> </td></tr><tr> <td><span style="margin-left:-30px; float:right"><b>Gold </b><img style="" class="lowered_gov" src="/images/gold.png"></span></td> <td><div class="cma_slider" id="cma-val-slider-Gold"></div> </td><td> <div class="gold_text cma_slider no_bg" id="Gold_val_result" style="text-shadow: 2px 1px #000; float:left;"></div> </td></tr><tr> <td><span style="margin-left:-30px; float:right"><b>Luxury </b><img style="" class="lowered_gov" src="/images/lux.png"></span></td> <td><div class="cma_slider" id="cma-val-slider-Luxury"></div> </td><td> <div class="lux_text cma_slider no_bg" id="Luxury_val_result" style="text-shadow: 2px 1px #000; float:left;"></div> </td></tr><tr> <td><span style="margin-left:-30px; float:right"><b>Science </b><img style="" class="lowered_gov" src="/images/sci.png"></span></td> <td><div class="cma_slider" id="cma-val-slider-Science"></div> </td><td> <div class="sci_text cma_slider no_bg" id="Science_val_result" style="text-shadow: 2px 1px #000; float:left;"></div> </td></tr><tr> <td><span style="margin-left:-30px; float:right"><b><span title="The relative importance of celebration vs. the other raw outputs. Use the Force Celebration checkbox to ensure celebration.">Happy Factor</span> </b>😊</span></td> <td><div class="cma_slider" id="cma-happy-slider"></div> </td><td> <div class="negative_food_text cma_slider no_bg" id="happy_result" style="text-shadow: 2px 1px #000; float:left;">0</div> </td></tr></tbody></table></form><br class="mobile_remove"><input type="checkbox" onchange="cma_user_input();" id="cma_celebrate" class="css-checkbox"><label for="cma_celebrate" name="cma_celebrate_lbl" class="css-label dark-check-green"><span style="font-size:110%;" class="mobile_shrink">Force Celebration</span></label> <input type="checkbox" title="Suppress all specialists who do not prevent disorder." onchange="cma_user_input();" id="cma_specialists" class="css-checkbox"><label for="cma_specialists" name="cma_specialists_lbl" class="css-label dark-check-white"><span style="font-size:110%;" class="mobile_shrink">Suppress Specialists</span></label><span class="mobile_remove"> <input type="checkbox" onchange="cma_user_input();" id="cma_disorder" class="css-checkbox"><label for="cma_disorder" name="cma_disorder_lbl" class="css-label dark-check-red"><span style="font-size:110%;">Allow Disorder</span></label><br><br></span><form name="cma_min_vals"><table border="0"><tbody><tr><th id="cma_surplus_hdr" style="color: rgb(211, 173, 143); text-shadow: 1px 2px #000; font-size:133%">Minimum Surplus</th></tr><tr> <td><span style="margin-left:-30px; float:right"><b>Food </b><img style="" class="lowered_gov" src="/images/wheat.png"></span></td> <td><div class="cma_slider" id="cma-min-slider-Food"></div> </td><td> <div class="food_text cma_slider no_bg" id="Food_min_result" style="text-shadow: 2px 1px #000; float:left;"></div> </td></tr><tr> <td><span style="margin-left:-30px; float:right"><b>Shield </b><img style="" class="lowered_gov" src="/images/shield14x18.png"></span></td> <td><div class="cma_slider" id="cma-min-slider-Shield"></div> </td><td> <div class="prod_text cma_slider no_bg" id="Shield_min_result" style="text-shadow: 2px 1px #000; float:left;"></div> </td></tr><tr> <td><span style="margin-left:-30px; float:right"><b>Trade </b><img style="" class="lowered_gov" src="/images/trade.png"></span></td> <td><div class="cma_slider" id="cma-min-slider-Trade"></div> </td><td> <div class="trade_text cma_slider no_bg" id="Trade_min_result" style="text-shadow: 2px 1px #000; float:left;"></div> </td></tr><tr> <td><span style="margin-left:-30px; float:right"><b>Gold </b><img style="" class="lowered_gov" src="/images/gold.png"></span></td> <td><div class="cma_slider" id="cma-min-slider-Gold"></div> </td><td> <div class="gold_text cma_slider no_bg" id="Gold_min_result" style="text-shadow: 2px 1px #000; float:left;"></div> </td></tr><tr> <td><span style="margin-left:-30px; float:right"><b>Luxury </b><img style="" class="lowered_gov" src="/images/lux.png"></span></td> <td><div class="cma_slider" id="cma-min-slider-Luxury"></div> </td><td> <div class="lux_text cma_slider no_bg" id="Luxury_min_result" style="text-shadow: 2px 1px #000; float:left;"></div> </td></tr><tr> <td><span style="margin-left:-30px; float:right"><b>Science </b><img style="" class="lowered_gov" src="/images/sci.png"></span></td> <td><div class="cma_slider" id="cma-min-slider-Science"></div> </td><td> <div class="sci_text cma_slider no_bg" id="Science_min_result" style="text-shadow: 2px 1px #000; float:left;"></div> </td></tr></tbody></table></form><br class="mobile_remove"><button class="mobile_shrink" type="button" class="button ui-button ui-corner-all" onclick="button_pushed_cma_save();" id="btn_set_cma" title="Save On-Screen Settings as the new City Governor Setttings for this city.">Save</button><button class="mobile_shrink" type="button" class="button ui-button ui-corner-all" onclick="button_pushed_cma_apply();" id="btn_apply_cma" title="Set city tiles to match On-Screen Settings without changing the current City Governor Settings.">Set Once</button><button class="mobile_shrink" type="button" class="button ui-button ui-corner-all" onclick="cma_copy_current();" title="Copy On-Screen Settings to Clipboard.">Copy</button><button class="mobile_shrink" type="button" class="button ui-button ui-corner-all" onclick="cma_paste_clipboard();" title="Paste Clipboard to the On-Screen Settings.">Paste</button><button id="btn_cma_setall" class="mobile_shrink" type="button" class="button ui-button ui-corner-all" onclick="cma_all_cities(true);" title="Set tiles in all cities to match the Clipboard, without changing City Governor Settings.">&#x26A0;&#xFE0F;Set All</button><button id="btn_cma_saveall" class="mobile_shrink" type="button" class="button ui-button ui-corner-all" onclick="cma_all_cities(false);" title="Paste and save Clipboard as the new City Governor Settings, for all cities.">&#x26A0;&#xFE0F;Save All</button><button id="btn_cma_refreshall" class="mobile_shrink" type="button" class="button ui-button ui-corner-all" onclick="cma_clipboard_macro(null,true);" title="Auto-arrange tiles in all cities with a Governor">&#x26A0;&#xFE0F;Refresh All</button><div id="cma_unsaved_warning" style="display: none;"></div></header></header>\n      </div>\n  </div> \n\n  <div id="city_tabs-i" class="citydlg_tabs">\n    <div id="city_units_tab"></div>\n  </div> \n\n\n</div>\n'},useData:true});templates["diplomacy_meeting"]=template({1:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=depth0!=null?depth0:container.nullContext||{},alias2=container.lambda,alias3=container.escapeExpression;return"<div class='diplomacy_player_box'>\n"+((stack1=helpers["if"].call(alias1,(stack1=depth0!=null?depth0.player:depth0)!=null?stack1.flag:stack1,{name:"if",hash:{},fn:container.program(2,data,0,blockParams,depths),inverse:container.program(4,data,0,blockParams,depths),data:data,loc:{start:{line:10,column:2},end:{line:14,column:9}}}))!=null?stack1:"")+"  <div class='agree_"+alias3(alias2(depth0!=null?depth0.box:depth0,depth0))+"' id='agree_"+alias3(alias2(depth0!=null?depth0.box:depth0,depth0))+"_"+alias3(alias2((stack1=depth0!=null?depth0.counterpart:depth0)!=null?stack1.pid:stack1,depth0))+"'></div>\n  <h3>"+alias3(alias2((stack1=depth0!=null?depth0.player:depth0)!=null?stack1.adjective:stack1,depth0))+" "+alias3(alias2((stack1=depth0!=null?depth0.player:depth0)!=null?stack1.name:stack1,depth0))+"</h3>\n  <div class='dipl_div' >\n    <div id='hierarchy_"+alias3(alias2(depth0!=null?depth0.box:depth0,depth0))+"_"+alias3(alias2((stack1=depth0!=null?depth0.counterpart:depth0)!=null?stack1.pid:stack1,depth0))+"'><a tabindex='0' class='menu-button-activator ui-button ui-widget ui-state-default ui-corner-all'><span class='ui-icon ui-icon-triangle-1-s'></span>Add Clause&nbsp;</a>\n      <ul class='dipl_add'>"+((stack1=helpers.each.call(alias1,(stack1=depth0!=null?depth0.player:depth0)!=null?stack1.clauses:stack1,{name:"each",hash:{},fn:container.program(6,data,0,blockParams,depths),inverse:container.noop,data:data,loc:{start:{line:19,column:27},end:{line:29,column:15}}}))!=null?stack1:"")+"</ul>\n    </div>\n    <span class='diplomacy_gold'>Gold <input id='"+alias3(alias2(depth0!=null?depth0.box:depth0,depth0))+"_gold_"+alias3(alias2((stack1=depth0!=null?depth0.counterpart:depth0)!=null?stack1.pid:stack1,depth0))+"' type='number' step='1' size='3' value='0'></span>\n  </div>\n</div>\n"},2:function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"  <img src='/images/flags/"+alias2(alias1((stack1=depth0!=null?depth0.player:depth0)!=null?stack1.flag:stack1,depth0))+"' class='flag_"+alias2(alias1(depth0!=null?depth0.box:depth0,depth0))+"' id='flag_"+alias2(alias1(depth0!=null?depth0.box:depth0,depth0))+"_"+alias2(alias1((stack1=depth0!=null?depth0.counterpart:depth0)!=null?stack1.pid:stack1,depth0))+"'>\n"},4:function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"  <canvas class='flag_"+alias2(alias1(depth0!=null?depth0.box:depth0,depth0))+"' id='flag_"+alias2(alias1(depth0!=null?depth0.box:depth0,depth0))+"_"+alias2(alias1((stack1=depth0!=null?depth0.counterpart:depth0)!=null?stack1.pid:stack1,depth0))+"' width='58' height='40'></canvas>\n"},6:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"\n"+((stack1=helpers["if"].call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.title:depth0,{name:"if",hash:{},fn:container.program(7,data,0,blockParams,depths),inverse:container.program(10,data,0,blockParams,depths),data:data,loc:{start:{line:20,column:8},end:{line:28,column:15}}}))!=null?stack1:"")+"      "},7:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return"          <li><div>"+container.escapeExpression(container.lambda(depth0!=null?depth0.title:depth0,depth0))+"</div>\n          <ul>"+((stack1=helpers.each.call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.clauses:depth0,{name:"each",hash:{},fn:container.program(8,data,0,blockParams,depths),inverse:container.noop,data:data,loc:{start:{line:22,column:14},end:{line:24,column:19}}}))!=null?stack1:"")+"</ul>\n          </li>\n"},8:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"\n            <li><div onclick='create_clause_req("+alias2(alias1((stack1=depths[2]!=null?depths[2].counterpart:depths[2])!=null?stack1.pid:stack1,depth0))+", "+alias2(alias1((stack1=depths[2]!=null?depths[2].player:depths[2])!=null?stack1.pid:stack1,depth0))+", "+alias2(alias1(depth0!=null?depth0.type:depth0,depth0))+", "+alias2(alias1(depth0!=null?depth0.value:depth0,depth0))+");'><a href='#'>"+alias2(alias1(depth0!=null?depth0.name:depth0,depth0))+"</a></div></li>\n          "},10:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"          <li><div onclick='create_clause_req("+alias2(alias1((stack1=depths[1]!=null?depths[1].counterpart:depths[1])!=null?stack1.pid:stack1,depth0))+", "+alias2(alias1((stack1=depths[1]!=null?depths[1].player:depths[1])!=null?stack1.pid:stack1,depth0))+", "+alias2(alias1(depth0!=null?depth0.type:depth0,depth0))+", "+alias2(alias1(depth0!=null?depth0.value:depth0,depth0))+");'><a href='#'>"+alias2(alias1(depth0!=null?depth0.name:depth0,depth0))+"</a></div></li>\n"},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"\n<div id='diplomacy_dialog_"+alias2(alias1((stack1=depth0!=null?depth0.counterpart:depth0)!=null?stack1.pid:stack1,depth0))+"'>\n  <div>\n    Treaty clauses:<br>\n    <div class='diplomacy_messages' id='diplomacy_messages_"+alias2(alias1((stack1=depth0!=null?depth0.counterpart:depth0)!=null?stack1.pid:stack1,depth0))+"'></div>\n"+((stack1=container.invokePartial(partials.diplomacy_player_box,depth0,{name:"diplomacy_player_box",hash:{player:depth0!=null?depth0.self:depth0,box:"self"},data:data,indent:"    ",helpers:helpers,partials:partials,decorators:container.decorators}))!=null?stack1:"")+((stack1=container.invokePartial(partials.diplomacy_player_box,depth0,{name:"diplomacy_player_box",hash:{player:depth0!=null?depth0.counterpart:depth0,box:"counterpart"},data:data,indent:"    ",helpers:helpers,partials:partials,decorators:container.decorators}))!=null?stack1:"")+"  </div>\n</div>\n"},main_d:function(fn,props,container,depth0,data,blockParams,depths){var decorators=container.decorators;fn=decorators.inline(fn,props,container,{name:"inline",hash:{},fn:container.program(1,data,0,blockParams,depths),inverse:container.noop,args:["diplomacy_player_box"],data:data,loc:{start:{line:1,column:0},end:{line:34,column:11}}})||fn;return fn},useDecorators:true,usePartial:true,useData:true,useDepths:true});templates["intel"]=template({1:function(container,depth0,helpers,partials,data){var stack1;return"\n    <li>"+container.escapeExpression(container.lambda(depth0!=null?depth0.state:depth0,depth0))+"<ul>\n    "+((stack1=helpers.each.call(depth0!=null?depth0:container.nullContext||{},depth0!=null?depth0.nations:depth0,{name:"each",hash:{},fn:container.program(2,data,0),inverse:container.noop,data:data,loc:{start:{line:28,column:4},end:{line:28,column:47}}}))!=null?stack1:"")+"\n    </ul></li>\n"},2:function(container,depth0,helpers,partials,data){return"<li>"+container.escapeExpression(container.lambda(depth0,depth0))+"</li>"},4:function(container,depth0,helpers,partials,data){return"    No contact with other nations\n    "},6:function(container,depth0,helpers,partials,data){var alias1=container.lambda,alias2=container.escapeExpression;return'\n    <li class="tech-'+alias2(alias1(depth0!=null?depth0.who:depth0,depth0))+'">'+alias2(alias1(depth0!=null?depth0.name:depth0,depth0))+"</li>\n"},8:function(container,depth0,helpers,partials,data){return"    This exciting tribe does not seem to invest in technology.\n    "},10:function(container,depth0,helpers,partials,data){var alias1=container.lambda,alias2=container.escapeExpression;return'\n    <li style="cursor:default" title="'+alias2(alias1(depth0!=null?depth0.helptext:depth0,depth0))+'"">'+alias2(alias1(depth0!=null?depth0.name:depth0,depth0))+"</li>\n"},12:function(container,depth0,helpers,partials,data){return"    This exciting tribe does not seem to have any wonders.\n    "},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression,alias3=depth0!=null?depth0:container.nullContext||{};return'<div id="intel_tabs">\n  <ul>\n    <div id="ixtjkiller3" style="max-width:100%; height:inherit; position: absolute; cursor: pointer; background: rgba(0, 0, 0, 0); overflow: hidden; left: 0px; top: 0px; z-index: 999 !important;" onclick="clickMask(event, 3)"><img style="max-width:inherit; height:100%" id="ixtjkiller33" src="/images/ixtjkiller.png"></div>\n    <li><a href="#intel_tabs-overview">Nation</a></li>\n    <li><a href="#intel_tabs-diplomacy">Diplomacy</a></li>\n    <li><a href="#intel_tabs-technology">Tech</a></li>\n    <li><a href="#intel_tabs-wonders">Wonders</a></li>\n  </ul>\n\n  <div id="intel_tabs-overview" class="inteldlg_tabs">\n    <table class="vert-attr-list">\n    <tr><th>Ruler</th><td id="intel_ruler">'+alias2(alias1(depth0!=null?depth0.ruler:depth0,depth0))+'</td></tr>\n    <tr><th>Government</th><td id="intel_gov">'+alias2(alias1(depth0!=null?depth0.government:depth0,depth0))+'</td></tr>\n    <tr><th>Capital</th><td id="intel_capital">'+alias2(alias1(depth0!=null?depth0.capital:depth0,depth0))+'</td></tr>\n    <tr><th>Gold</th><td class="gold_text">'+alias2(alias1(depth0!=null?depth0.gold:depth0,depth0))+'</td></tr>\n    <tr><th>&nbsp;</th><td></td></tr>\n    <tr><th>Tax</th><td class="gold_text">'+alias2(alias1(depth0!=null?depth0.tax:depth0,depth0))+'</td></tr>\n    <tr><th>Science</th><td class="sci_text">'+alias2(alias1(depth0!=null?depth0.science:depth0,depth0))+'</td></tr>\n    <tr><th>Luxury</th><td class="lux_text">'+alias2(alias1(depth0!=null?depth0.luxury:depth0,depth0))+'</td></tr>\n    <tr><th>&nbsp;</th><td></td></tr>\n    <tr><th>Researching</th><td id="intel_researching">'+alias2(alias1(depth0!=null?depth0.researching:depth0,depth0))+'</td></tr>\n    </table>\n  </div> \n\n  <div id="intel_tabs-diplomacy" class="inteldlg_tabs">\n    <ul>'+((stack1=helpers.each.call(alias3,depth0!=null?depth0.dipl:depth0,{name:"each",hash:{},fn:container.program(1,data,0),inverse:container.program(4,data,0),data:data,loc:{start:{line:26,column:8},end:{line:33,column:13}}}))!=null?stack1:"")+'</ul>\n  </div> \n\n  <div id="intel_tabs-technology" class="inteldlg_tabs">\n    <ul>'+((stack1=helpers.each.call(alias3,depth0!=null?depth0.tech:depth0,{name:"each",hash:{},fn:container.program(6,data,0),inverse:container.program(8,data,0),data:data,loc:{start:{line:37,column:8},end:{line:41,column:13}}}))!=null?stack1:"")+'</ul>\n  </div> \n \n  <div id="intel_tabs-wonders" class="inteldlg_tabs">\n    <ul>'+((stack1=helpers.each.call(alias3,depth0!=null?depth0.wndr:depth0,{name:"each",hash:{},fn:container.program(10,data,0),inverse:container.program(12,data,0),data:data,loc:{start:{line:45,column:8},end:{line:49,column:13}}}))!=null?stack1:"")+"</ul>\n  </div>\n\n</div>  \n"},useData:true})})();var packet_server_join_req=4;var packet_authentication_reply=7;var packet_nation_select_req=10;var packet_player_ready=11;var packet_chat_msg_req=26;var packet_city_sell=33;var packet_city_buy=34;var packet_city_change=35;var packet_city_worklist=36;var packet_city_make_specialist=37;var packet_city_make_worker=38;var packet_city_change_specialist=39;var packet_city_rename=40;var packet_city_options_req=41;var packet_city_refresh=42;var packet_city_name_suggestion_req=43;var packet_city_manager=139;var packet_city_rally_point=138;var packet_worker_task=241;var packet_player_phase_done=52;var packet_player_rates=53;var packet_player_change_government=54;var packet_player_place_infra=61;var packet_player_attribute_block=57;var packet_player_attribute_chunk=58;var packet_player_multiplier=242;var packet_player_research=55;var packet_player_tech_goal=56;var packet_unit_sscs_set=71;var packet_unit_orders=73;var packet_unit_autosettlers=74;var packet_unit_action_query=82;var packet_unit_type_upgrade=83;var packet_unit_do_action=84;var packet_unit_get_actions=87;var packet_unit_change_activity=222;var packet_diplomacy_init_meeting_req=95;var packet_diplomacy_cancel_meeting_req=97;var packet_diplomacy_create_clause_req=99;var packet_diplomacy_remove_clause_req=101;var packet_diplomacy_accept_treaty_req=103;var packet_diplomacy_cancel_pact=105;var packet_report_req=111;var packet_conn_pong=89;var packet_client_heartbeat=254;var packet_client_info=119;var packet_spaceship_launch=135;var packet_spaceship_place=136;var packet_single_want_hack_req=160;var packet_save_scenario=181;var packet_vote_submit=189;var packet_edit_mode=190;var packet_edit_recalculate_borders=197;var packet_edit_check_tiles=198;var packet_edit_toggle_fogofwar=199;var packet_edit_tile_terrain=200;var packet_edit_tile_extra=202;var packet_edit_startpos=204;var packet_edit_startpos_full=205;var packet_edit_tile=206;var packet_edit_unit_create=207;var packet_edit_unit_remove=208;var packet_edit_unit_remove_by_id=209;var packet_edit_unit=210;var packet_edit_city_create=211;var packet_edit_city_remove=212;var packet_edit_city=213;var packet_edit_player_create=214;var packet_edit_player_remove=215;var packet_edit_player=216;var packet_edit_player_vision=217;var packet_edit_game=218;var packet_edit_scenario_desc=14;var packet_goto_path_req=287;var packet_info_text_req=289;var packet_ongoing_longturn_nation_select_req=291;function client_handle_packet(p){if(p==null)return;try{for(var i=0;i<p.length;i++){if(p[i]==null)continue;if(DEBUG_LOG_PACKETS){var packet_str=JSON.stringify(p[i],null,4);console.log("PACKET: "+packet_str)}var packet_type=p[i]["pid"];switch(packet_type){case 0:handle_processing_started(p[i]);break;case 1:handle_processing_finished(p[i]);break;case 5:handle_server_join_reply(p[i]);break;case 6:handle_authentication_req(p[i]);break;case 8:handle_server_shutdown(p[i]);break;case 12:handle_endgame_report(p[i]);break;case 223:handle_endgame_player(p[i]);break;case 15:handle_tile_info(p[i]);break;case 16:handle_game_info(p[i]);break;case 255:handle_calendar_info(p[i]);break;case 244:handle_timeout_info(p[i]);break;case 17:handle_map_info(p[i]);break;case 18:handle_nuke_tile_info(p[i]);break;case 19:handle_team_name_info(p[i]);break;case 238:handle_achievement_info(p[i]);break;case 25:handle_chat_msg(p[i]);break;case 28:handle_early_chat_msg(p[i]);break;case 27:handle_connect_msg(p[i]);break;case 29:handle_server_info(p[i]);break;case 30:handle_city_remove(p[i]);break;case 31:handle_city_info(p[i]);break;case 32:handle_city_short_info(p[i]);break;case 249:handle_traderoute_info(p[i]);break;case 44:handle_city_name_suggestion_info(p[i]);break;case 45:handle_city_sabotage_list(p[i]);break;case 241:handle_worker_task(p[i]);break;case 50:handle_player_remove(p[i]);break;case 51:handle_player_info(p[i]);break;case 58:handle_player_attribute_chunk(p[i]);break;case 59:handle_player_diplstate(p[i]);break;case 60:handle_research_info(p[i]);break;case 62:handle_unit_remove(p[i]);break;case 63:handle_unit_info(p[i]);break;case 64:handle_unit_short_info(p[i]);break;case 65:handle_unit_combat_info(p[i]);break;case 85:handle_unit_action_answer(p[i]);break;case 90:handle_unit_actions(p[i]);break;case 96:handle_diplomacy_init_meeting(p[i]);break;case 98:handle_diplomacy_cancel_meeting(p[i]);break;case 100:handle_diplomacy_create_clause(p[i]);break;case 102:handle_diplomacy_remove_clause(p[i]);break;case 104:handle_diplomacy_accept_treaty(p[i]);break;case 110:handle_page_msg(p[i]);break;case 250:handle_page_msg_part(p[i]);break;case 115:handle_conn_info(p[i]);break;case 116:handle_conn_ping_info(p[i]);break;case 88:handle_conn_ping(p[i]);break;case 125:handle_end_phase(p[i]);break;case 126:handle_start_phase(p[i]);break;case 127:handle_new_year(p[i]);break;case 128:handle_begin_turn(p[i]);break;case 129:handle_end_turn(p[i]);break;case 130:handle_freeze_client(p[i]);break;case 131:handle_thaw_client(p[i]);break;case 137:handle_spaceship_info(p[i]);break;case 140:handle_ruleset_unit(p[i]);break;case 228:handle_ruleset_unit_bonus(p[i]);break;case 229:handle_ruleset_unit_flag(p[i]);break;case 230:handle_ruleset_unit_class_flag(p[i]);break;case 141:handle_ruleset_game(p[i]);break;case 142:handle_ruleset_specialist(p[i]);break;case 143:handle_ruleset_government_ruler_title(p[i]);break;case 144:handle_ruleset_tech(p[i]);break;case 9:handle_ruleset_tech_class(p[i]);break;case 234:handle_ruleset_tech_flag(p[i]);break;case 145:handle_ruleset_government(p[i]);break;case 146:handle_ruleset_terrain_control(p[i]);break;case 225:handle_rulesets_ready(p[i]);break;case 236:handle_ruleset_nation_sets(p[i]);break;case 147:handle_ruleset_nation_groups(p[i]);break;case 148:handle_ruleset_nation(p[i]);break;case 237:handle_nation_availability(p[i]);break;case 239:handle_ruleset_style(p[i]);break;case 149:handle_ruleset_city(p[i]);break;case 150:handle_ruleset_building(p[i]);break;case 151:handle_ruleset_terrain(p[i]);break;case 231:handle_ruleset_terrain_flag(p[i]);break;case 152:handle_ruleset_unit_class(p[i]);break;case 232:handle_ruleset_extra(p[i]);break;case 226:handle_ruleset_extra_flag(p[i]);break;case 153:handle_ruleset_base(p[i]);break;case 220:handle_ruleset_road(p[i]);break;case 248:handle_ruleset_goods(p[i]);break;case 224:handle_ruleset_disaster(p[i]);break;case 233:handle_ruleset_achievement(p[i]);break;case 227:handle_ruleset_trade(p[i]);break;case 246:handle_ruleset_action(p[i]);break;case 235:handle_ruleset_action_enabler(p[i]);break;case 252:handle_ruleset_action_auto(p[i]);break;case 240:handle_ruleset_music(p[i]);break;case 243:handle_ruleset_multiplier(p[i]);break;case 512:handle_ruleset_clause(p[i]);break;case 155:handle_ruleset_control(p[i]);break;case 251:handle_ruleset_summary(p[i]);break;case 247:handle_ruleset_description_part(p[i]);break;case 161:handle_single_want_hack_reply(p[i]);break;case 162:handle_ruleset_choices(p[i]);break;case 163:handle_game_load(p[i]);break;case 164:handle_server_setting_control(p[i]);break;case 165:handle_server_setting_const(p[i]);break;case 166:handle_server_setting_bool(p[i]);break;case 167:handle_server_setting_int(p[i]);break;case 168:handle_server_setting_str(p[i]);break;case 169:handle_server_setting_enum(p[i]);break;case 170:handle_server_setting_bitwise(p[i]);break;case 253:handle_set_topology(p[i]);break;case 175:handle_ruleset_effect(p[i]);break;case 177:handle_ruleset_resource(p[i]);break;case 180:handle_scenario_info(p[i]);break;case 13:handle_scenario_description(p[i]);break;case 185:handle_vote_new(p[i]);break;case 186:handle_vote_update(p[i]);break;case 187:handle_vote_remove(p[i]);break;case 188:handle_vote_resolve(p[i]);break;case 204:handle_edit_startpos(p[i]);break;case 205:handle_edit_startpos_full(p[i]);break;case 219:handle_edit_object_created(p[i]);break;case 245:handle_play_music(p[i]);break;case 256:handle_web_city_info_addition(p[i]);break;case 257:handle_web_player_info_addition(p[i]);break;case 258:handle_web_ruleset_unit_addition(p[i]);break;case 288:handle_goto_path(p[i]);break;case 290:handle_info_text_message(p[i]);break}}if(p.length>0){if(debug_active)clinet_debug_collect();update_map_canvas_check()}}catch(err){console.error(err)}}var soundset={f_generic:"generic-soft-attack.ogg",f_aegis_cruiser:"LrgCan.ogg",f_alpine_troops:"MgBar2.ogg",f_anti_aircraft:"MgBar2.ogg",f_archers:"archerattack.ogg",f_armor:"Mortar.ogg",f_artillery:"MedCan.ogg",f_battleship:"LrgExpl.ogg",f_bomber:"LrgExpl.ogg",f_cannon:"SmlExpl.ogg",f_caravel:"splash-attack.ogg",f_carrier:"Splash.ogg",f_catapult:"wall01.ogg",f_cavalry:"dragoon-cav-attack.ogg",f_chariot:"generic-attack2.ogg",f_cruise_missile:"LrgExpl.ogg",f_cruiser:"LrgCan.ogg",f_crusaders:"generic-attack2.ogg",f_destroyer:"MedCan.ogg",f_dive_bomber:"stuka-attack.ogg",f_dragoons:"musket.ogg",f_elephants:"elephant-scream.ogg",f_falconeers:"SmlExpl.ogg",f_fanatics:"MgBar1.ogg",f_fighter:"MgHeavy.ogg",f_frigate:"Splash.ogg",f_galleon:"splash-attack.ogg",f_helicopter:"f_helicopter.ogg",f_howitzer:"LrgExpl.ogg",f_ironclad:"MedCan.ogg",f_jet_fighter:"soft-explosion.ogg",f_jet_bomber:"soft-explosion.ogg",f_knights:"generic-attack2.ogg",f_legion:"metal-strike.ogg",f_marines:"MgBar2.ogg",f_mech_inf:"MgHeavy.ogg",f_medium_bomber:"soft-explosion.ogg",f_missile_destroyer:"soft-explosion.ogg",f_mobile_sam:"soft-explosion.ogg",f_musketeers:"musket.ogg",f_nuclear:"nuclear_distant.ogg",f_paratroopers:"MgBar1.ogg",f_partisan:"MgBar1.ogg",f_phalanx:"metal-strike.ogg",f_pikemen:"metal-strike.ogg",f_riflemen:"dragoon-cav-attack.ogg",f_settlers:"generic-soft-attack.ogg",f_stealth_bomber:"soft-explosion.ogg",f_stealth_fighter:"soft-explosion.ogg",f_strategic_bomber:"LrgExpl.ogg",f_submarine:"Splash.ogg",f_transport:"splash-attack.ogg",f_trireme:"splash-attack.ogg",f_warriors:"f_warrior.ogg",f_zealots:"dragoon-cav-attack.ogg",ground_strike:"soft-explosion.ogg",pm_prop_fighters:"pm_prop_fighters.ogg",pm_prop_bombers:"pm_prop_bombers.ogg",pm_small_jets:"pm_large_jets.ogg",pm_large_jets:"pm_large_jets.ogg",pm_heli:"pm_heli.ogg",pm_train:"pm_train.ogg",m_generic:"footstep.ogg",m_aegis_cruiser:"splash-move2.ogg",m_anti_aircraft:"generic-move.ogg",m_armor:"Tread.ogg",m_armor_ii:"Tread.ogg",m_artillery:"generic-move.ogg",m_atom_bomb:"generic-move.ogg",m_awacs:"large-jet1.ogg",m_balloon:"generic-move.ogg",m_battleship:"splash-move2.ogg",m_bomber:"heavy-bomber.ogg",m_cannon:"generic-move.ogg",m_caravan:"camel-walk.ogg",m_caravel:"splash-move.ogg",m_carrier:"inh2o.ogg",m_catapult:"generic-move.ogg",m_cavalry:"chariot1.ogg",m_chariot:"chariot2.ogg",m_cruise_missile:"jet5.ogg",m_cruiser:"splash-move2.ogg",m_crusaders:"horse.ogg",m_destroyer:"splash-move2.ogg",m_dive_bomber:"escort-fighter.ogg",m_dragoons:"horse.ogg",m_elephants:"elephant_move.ogg",m_escort_fighter:"escort-fighter.ogg",m_explorer:"explorer.ogg",m_fighter:"prop-fighter.ogg",m_freight:"truck1.ogg",m_frigate:"splash-move.ogg",m_galleon:"splash-move.ogg",m_helicopter:"THover.ogg",m_horsemen:"horse.ogg",m_howitzer:"truck2.ogg",m_ironclad:"ironclad2.ogg",m_jet_bomber:"large-jet2.ogg",m_jet_fighter:"jet3.ogg",m_knights:"horse.ogg",m_legion:"marching.ogg",m_mech_inf:"truck1.ogg",m_medium_bomber:"med-bomber.ogg",m_missile_destroyer:"splash-move2.ogg",m_nuclear:"jet5.ogg",m_stealth_bomber:"jet2.ogg",m_stealth_fighter:"jet1.ogg",m_strategic_bomber:"strategic-bomber.ogg",m_strike_fighter:"jet3.ogg",m_submarine:"sub-move1.ogg",m_train:"m_train.ogg",m_transport:"splash-move.ogg",m_tribesmen:"m_lightsteps.ogg",m_trireme:"splash-move.ogg",e_bad_command:"illegal.ogg",e_log_error:"LrgCan.ogg",e_log_fatal:"LrgExpl.ogg",e_conquer:"wardrums.ogg",e_fail:"fail.ogg",e_imp_sold:"sell-improv.ogg",e_liberate:"fanfare.ogg",e_player_wake:"wakeup.ogg",e_success:"success.ogg",e_victor:"warconquest.ogg",last:null};var actions={};var auto_attack=false;var active_dialogs=[];var action_selection_restart=false;var did_not_decide=false;function act_sel_queue_may_be_done(actor_unit_id){if(!is_more_user_input_needed){if(action_selection_restart){action_selection_restart=false}else{action_selection_no_longer_in_progress(actor_unit_id)}if(did_not_decide){did_not_decide=false}else{action_decision_clear_want(actor_unit_id);action_selection_next_in_focus(actor_unit_id)}}}function act_sel_queue_done(actor_unit_id){is_more_user_input_needed=false;act_sel_queue_may_be_done(actor_unit_id);action_selection_restart=false;did_not_decide=false}function action_prob_possible(aprob){return 0<aprob["max"]||action_prob_not_impl(aprob)}function action_prob_not_impl(probability){return probability["min"]==254&&probability["max"]==0}function can_actor_unit_move(actor_unit,target_tile){var tgt_owner_id;if(index_to_tile(actor_unit["tile"])==target_tile){return false}if(-1==get_direction_for_step(tiles[actor_unit["tile"]],target_tile)){return FALSE}for(var i=0;i<tile_units(target_tile).length;i++){tgt_owner_id=unit_owner(tile_units(target_tile)[i])["playerno"];if(tgt_owner_id!=unit_owner(actor_unit)["playerno"]&&diplstates[tgt_owner_id]!=DS_ALLIANCE&&diplstates[tgt_owner_id]!=DS_TEAM){return false}}if(tile_city(target_tile)!=null){tgt_owner_id=city_owner(tile_city(target_tile))["playerno"];if(tgt_owner_id==unit_owner(actor_unit)["playerno"]){return true}if(diplstates[tgt_owner_id]==DS_ALLIANCE||diplstates[tgt_owner_id]==DS_TEAM){return true}return false}return true}function format_act_prob_part(prob){return prob/2+"%"}function format_action_probability(probability){if(probability["min"]==probability["max"]){return" ("+format_act_prob_part(probability["max"])+")"}else if(probability["min"]<probability["max"]){return" (["+format_act_prob_part(probability["min"])+", "+format_act_prob_part(probability["max"])+"])"}else{return""}}function format_action_label(action_id,action_probabilities){return actions[action_id]["ui_name"].replace("%s","").replace("%s",format_action_probability(action_probabilities[action_id]))}function format_action_tooltip(act_id,act_probs){var out;if(act_probs[act_id]["min"]==act_probs[act_id]["max"]){out="The probability of success is ";out+=format_act_prob_part(act_probs[act_id]["max"])+"."}else if(act_probs[act_id]["min"]<act_probs[act_id]["max"]){out="The probability of success is ";out+=format_act_prob_part(act_probs[act_id]["min"]);out+=", ";out+=format_act_prob_part(act_probs[act_id]["max"]);out+=" or somewhere in between.";if(act_probs[act_id]["max"]-act_probs[act_id]["min"]>1){out+=" (This is the most precise interval I can calculate ";out+="given the information our nation has access to.)"}}return out}function act_sel_click_function(parent_id,actor_unit_id,tgt_id,sub_tgt_id,action_id,action_probabilities){switch(action_id){case ACTION_SPY_TARGETED_STEAL_TECH:case ACTION_SPY_TARGETED_STEAL_TECH_ESC:return function(){popup_steal_tech_selection_dialog(units[actor_unit_id],cities[tgt_id],action_probabilities,action_id);is_more_user_input_needed=true;remove_action_selection_dialog(parent_id,actor_unit_id,true)};case ACTION_SPY_TARGETED_SABOTAGE_CITY:case ACTION_SPY_TARGETED_SABOTAGE_CITY_ESC:case ACTION_SPY_INCITE_CITY:case ACTION_SPY_INCITE_CITY_ESC:case ACTION_SPY_BRIBE_UNIT:case ACTION_UPGRADE_UNIT:return function(){var packet={pid:packet_unit_action_query,actor_id:actor_unit_id,target_id:tgt_id,action_type:action_id,disturb_player:true};send_request(JSON.stringify(packet));is_more_user_input_needed=true;remove_action_selection_dialog(parent_id,actor_unit_id,true)};case ACTION_FOUND_CITY:return function(){var packet={pid:packet_city_name_suggestion_req,unit_id:actor_unit_id};send_request(JSON.stringify(packet));is_more_user_input_needed=true;remove_action_selection_dialog(parent_id,actor_unit_id,true)};case ACTION_PILLAGE:case ACTION_ROAD:case ACTION_BASE:case ACTION_MINE:case ACTION_IRRIGATE:return function(){request_unit_do_action(action_id,actor_unit_id,tgt_id,sub_tgt_id);remove_action_selection_dialog(parent_id,actor_unit_id)};case ACTION_ATTACK:return function(){request_unit_do_action(action_id,actor_unit_id,tgt_id,sub_tgt_id);setTimeout(update_active_units_dialog,update_focus_delay);remove_action_selection_dialog(parent_id,actor_unit_id)};default:return function(){request_unit_do_action(action_id,actor_unit_id,tgt_id,sub_tgt_id);remove_action_selection_dialog(parent_id,actor_unit_id)}}}function create_act_sel_button(parent_id,actor_unit_id,tgt_id,sub_tgt_id,action_id,action_probabilities){var button_text=format_action_label(action_id,action_probabilities);if(button_text.includes("Conquer")){var pcity=cities[tgt_id];if(pcity&&pcity["size"]==1)button_text=button_text.replace("Conquer","Raze")}var button={id:"act_sel_"+action_id+"_"+actor_unit_id,class:"act_sel_button",text:button_text,title:format_action_tooltip(action_id,action_probabilities),click:act_sel_click_function(parent_id,actor_unit_id,tgt_id,sub_tgt_id,action_id,action_probabilities)};return button}function popup_action_selection(actor_unit,action_probabilities,target_tile,target_extra,target_unit,target_city){var id="#act_sel_dialog_"+actor_unit["id"];remove_active_dialog(id);$("<div id='act_sel_dialog_"+actor_unit["id"]+"'></div>").appendTo("div#game_page");if(action_selection_in_progress_for!=IDENTITY_NUMBER_ZERO&&action_selection_in_progress_for!=actor_unit["id"]){console.log("Looks like unit %d has an action selection dialog open"+" but a dialog for unit %d is about to be opened.",action_selection_in_progress_for,actor_unit["id"]);console.log("Closing the action selection dialog for unit %d",action_selection_in_progress_for);action_selection_close()}var actor_homecity=cities[actor_unit["homecity"]];var buttons=[];var dhtml="";var dialog_width="390px";if(target_city!=null){dhtml+="Your "+unit_types[actor_unit["type"]]["name"];if(actor_homecity!=null){dhtml+=" from "+decodeURIComponent(actor_homecity["name"])}dhtml+=" has arrived at "+decodeURIComponent(target_city["name"])+". What is your command?"}else if(target_unit!=null){dhtml+="Your "+unit_types[actor_unit["type"]]["name"]+" is ready to act against "+nations[unit_owner(target_unit)["nation"]]["adjective"]+" "+unit_types[target_unit["type"]]["name"]+"."}else{dhtml+="Your "+unit_types[actor_unit["type"]]["name"]+" is waiting for your command."}$(id).html(dhtml);for(var tgt_kind=ATK_CITY;tgt_kind<ATK_COUNT;tgt_kind++){var tgt_id=-1;var sub_tgt_id=-1;switch(tgt_kind){case ATK_CITY:if(target_city!=null){tgt_id=target_city["id"]}break;case ATK_UNIT:if(target_unit!=null){tgt_id=target_unit["id"]}break;case ATK_UNITS:if(target_tile!=null){tgt_id=target_tile["index"]}break;case ATK_TILE:if(target_tile!=null){tgt_id=target_tile["index"]}if(target_extra!=null){sub_tgt_id=target_extra["id"]}break;case ATK_SELF:if(actor_unit!=null){tgt_id=actor_unit["id"]}break;default:console.log("Unsupported action target kind "+tgt_kind);break}for(var action_id=0;action_id<ACTION_COUNT;action_id++){if(actions[action_id]["tgt_kind"]==tgt_kind&&action_prob_possible(action_probabilities[action_id])){if(action_id==ACTION_CAPTURE_UNITS&&is_longturn()){var sunits=tile_units(tiles[tgt_id]);if(sunits&&sunits.length==1){var player_id=sunits[0].owner;if(players[player_id]["nturns_idle"]>1&&!players[player_id]["flags"].isSet(PLRF_AI)){if(tiles[tgt_id].owner!=client.conn.playing.playerno){add_client_message("Info: capture order unavailable on idle human player.");continue}}}}buttons.push(create_act_sel_button(id,actor_unit["id"],tgt_id,sub_tgt_id,action_id,action_probabilities))}}}if(can_actor_unit_move(actor_unit,target_tile)){buttons.push({id:"act_sel_move"+actor_unit["id"],class:"act_sel_button",text:"Keep moving",click:function(){var dir=get_direction_for_step(tiles[actor_unit["tile"]],target_tile);var order={order:ORDER_MOVE,dir:dir,activity:ACTIVITY_LAST,sub_target:0,action:ACTION_COUNT};var packet={pid:packet_unit_orders,unit_id:actor_unit["id"],src_tile:actor_unit["tile"],length:1,repeat:false,vigilant:false,orders:[order],dest_tile:target_tile["index"]};if(dir==-1){console.log("Action selection move: bad target tile")}else{send_request(JSON.stringify(packet))}remove_action_selection_dialog(id,actor_unit["id"])}})}if(target_unit!=null&&tile_units(target_tile).length>1){buttons.push({id:"act_sel_tgt_unit_switch"+actor_unit["id"],class:"act_sel_button",text:"Change unit target",click:function(){select_tgt_unit(actor_unit,target_tile,tile_units(target_tile));action_selection_restart=true;remove_action_selection_dialog(id,actor_unit["id"],true)}})}if(target_extra!=null){buttons.push({id:"act_sel_tgt_extra_switch"+actor_unit["id"],class:"act_sel_button",text:"Change extra target",click:function(){select_tgt_extra(actor_unit,target_unit,target_tile,list_potential_target_extras(actor_unit,target_tile));action_selection_restart=true;remove_action_selection_dialog(id,actor_unit["id"],true)}})}if(action_prob_possible(action_probabilities[ACTION_ATTACK])){if(!auto_attack){var button={id:"act_sel_"+ACTION_ATTACK+"_"+actor_unit["id"],class:"act_sel_button",text:"Auto attack from now on!",title:"Attack without showing this attack dialog in the future",click:function(){request_unit_do_action(ACTION_ATTACK,actor_unit["id"],target_tile["index"]);setTimeout(update_active_units_dialog,update_focus_delay);auto_attack=true;remove_action_selection_dialog(id,actor_unit["id"])}};buttons.push(button)}else{request_unit_do_action(ACTION_ATTACK,actor_unit["id"],target_tile["index"]);setTimeout(update_active_units_dialog,update_focus_delay);return}}buttons.push({id:"act_sel_wait"+actor_unit["id"],class:"act_sel_button",text:"Wait",click:function(){did_not_decide=true;remove_action_selection_dialog(id,actor_unit["id"],true)}});buttons.push({id:"act_sel_cancel"+actor_unit["id"],class:"act_sel_button",text:"Cancel (𝗪)",click:function(){remove_action_selection_dialog(id,actor_unit["id"])}});$(id).attr("title","Action for "+unit_types[actor_unit["type"]]["name"]+":");var SP=client_rules_flag[CRF_SURGICAL_PILLAGE];var SUA=client_rules_flag[CRF_SPECIAL_UNIT_ATTACKS];if(SP){if(unit_can_iPillage(actor_unit)){for(button_id in buttons){if(buttons[button_id].text.startsWith("Pillage")){buttons[button_id].text=unit_get_pillage_name(actor_unit)}}}}var ptype=unit_type(actor_unit);if(SUA){switch(ptype["rule_name"]){case"Siege Ram":for(button_id in buttons){if(buttons[button_id].text.startsWith("Ranged Attack")){buttons[button_id].text=utype_get_bombard_name(ptype)+" (100%)";buttons[button_id].title="Odds of survival:  100%\n"+"Combat:                4 rounds\n"+"Targets:                 ALL\n"+"Attack bonus:        8.75x\n"+"Move cost:            1 move\n"+"Min. moves:          1 1/9 moves\n"+"Casualties:             --\n"+'\n"Damage" to the Fortress is represented by HP loss to all\n'+"units (up to 40%/turn): emulating damage reduction to the\n"+"Fortress defense bonus. HP healing of units (up to 40%/turn),\n"+"emulates resistance and repairing Fortress damage over the\n"+"course of a long siege.\n"}else if(buttons[button_id].text.startsWith("Targeted Sabotage")){buttons[button_id].text="Attack City Walls ([25%, 50%])";buttons[button_id].title="Odds of survival:  50%  (halved if city is capital)\n"+"Targets:                 City Walls\n"+"Move cost:            1/9 move\n"+"Min. moves:          1 move\n"+"Attacks the City Walls, resulting in destruction\n"+"of the City Walls or the loss of the Siege Ram."}}break;case"Phalanx":for(button_id in buttons){if(buttons[button_id].text.startsWith("Ranged Attack")){buttons[button_id].text=utype_get_bombard_name(ptype)+" (100%)";buttons[button_id].title="Odds of survival:  100%\n"+"Combat:                3 rounds\n"+"Targets:                 1 unit\n"+"Move cost:            5/9 move\n"+"Min. moves:          fortified OR hasn't moved\n"+"Casualties:             --\n"+"\nA 3 round rumble against one unit on the target tile\n"+"represents the Phalanx safely pushing from a held\n"+"position vs. a weak defender who comes too close.\n"}}break;case"Archers":for(button_id in buttons){if(buttons[button_id].text.startsWith("Ranged Attack")){buttons[button_id].text=utype_get_bombard_name(ptype)+" (100%)";buttons[button_id].title="Odds of survival:  100%\n"+"Combat:                2 rounds\n"+"Targets:                 7 units\n"+"Move cost:            1 5/9 moves\n"+"Casualties:             --\n"+"\n2 rounds of arrows against up to 7 units,\n"+"represents Archers raining arrows from a\n"+"safe distance over an adjacent force."}}break;case"Legion":for(button_id in buttons){if(buttons[button_id].text.startsWith("Ranged Attack")){buttons[button_id].text=utype_get_bombard_name(ptype)+" (100%)";buttons[button_id].title="Odds of survival:  100%\n"+"Attack bonus:        2x\n"+"Combat:                1 round\n"+"Targets:                 2 units\n"+"Move cost:            1 move\n"+"Max. casualties:     2\n"+"\nPila easily disable shields in the enemy front line, represented by\n"+"1hp damage caused to up to 2 units. This helps the odds of success\n"+'of follow-up attack if done before the units heal ("fix their shields.")'}}break;case"Fanatics":for(button_id in buttons){if(buttons[button_id].text.startsWith("Ranged Attack")){buttons[button_id].text=utype_get_bombard_name(ptype)+" (100%)";buttons[button_id].title="Odds of survival:  100%\n"+"Combat:                3 rounds\n"+"Targets:                 4 units\n"+"Move cost:            1 5/9 moves\n"+"Casualties:             --\n"+"\nFanatics opportunistically damage and degrade foreign occupants\n"+"of their native land, for 3 rounds of combat on up to 4 foreign\n"+"occupants of a city or tile."}}break;case"Zealots":for(button_id in buttons){if(buttons[button_id].text.startsWith("Ranged Attack")){buttons[button_id].text=utype_get_bombard_name(ptype)+" (100%)";buttons[button_id].title="Odds of survival:  100%\n"+"Combat:                3 rounds\n"+"Targets:                 4 units\n"+"Move cost:            1 5/9 moves\n"+"Casualties:             --\n"+"Zealots opportunistically damage and degrade foreign occupants\n"+"of their native land, for 3 rounds of combat on up to 4 foreign\n"+"occupants of a city or tile."}}break;case"Marines":for(button_id in buttons){if(buttons[button_id].text.startsWith("Ranged Attack")){buttons[button_id].text=utype_get_bombard_name(ptype)+" (100%)";buttons[button_id].title="Odds of survival:  100%\n"+"Combat:                3 rounds\n"+"Targets:                 4 units\n"+"Move cost:            1 5/9 moves\n"+"Max. casualties:     1\n"+"\nV3 Marines use agility/mobility over terrain features to improvise hit-and-run\n"+"ballistic attacks: 3 rounds of combat on up to 4 occupants of a tile.\n"}}break;case"Battleship":for(button_id in buttons){if(buttons[button_id].text.startsWith("Ranged Attack")){buttons[button_id].text=utype_get_bombard_name(ptype)+" (100%)";buttons[button_id].title="Odds of survival:  100%\n"+"Combat:                3 rounds\n"+"Targets:                 4 units\n"+"Move cost:            5 moves\n"+"Max. casualties:     1\n"+"\nUses the range advantage of massive large guns to safely\n"+"shell and degrade up to 4 distant targets on a tile or city.\n"}}break;case"Zeppelin":for(button_id in buttons){if(buttons[button_id].text.startsWith("Ranged Attack")){buttons[button_id].text=utype_get_bombard_name(ptype)+" (100%)";buttons[button_id].title="Odds of survival:  100%\n"+"Combat:                4 rounds\n"+"Targets:                 2 units\n"+"Move cost:            2 moves\n"+"Max. casualties:     1\n"+"\nDrops shrapnel bombs in the vicinity of enemies,\n"+"affecting up to 2 units and possibly killing one.\n"}}break}}$(id).dialog({bgiframe:true,dialogClass:"act_sel_dialog",width:is_small_screen()?"99%":dialog_width,buttons:buttons});$(id).dialog("open");is_more_user_input_needed=false;$(id).dialog("widget").position({my:"center top",at:"center top",of:window});dialog_register(id,actor_unit["id"],true)}function popup_bribe_dialog(actor_unit,target_unit,cost,act_id){var bribe_possible=false;var dhtml="";var id="#bribe_unit_dialog_"+actor_unit["id"];remove_active_dialog(id);$("<div id='bribe_unit_dialog_"+actor_unit["id"]+"'></div>").appendTo("div#game_page");dhtml+="Treasury contains "+unit_owner(actor_unit)["gold"]+" gold. ";dhtml+="The price of bribing "+nations[unit_owner(target_unit)["nation"]]["adjective"]+" "+unit_types[target_unit["type"]]["name"]+" is "+cost+". ";bribe_possible=cost<=unit_owner(actor_unit)["gold"];if(!bribe_possible){dhtml+="Traitors Demand Too Much!";dhtml+="<br>"}$(id).html(dhtml);var close_button={"Close (𝗪)":function(){remove_action_selection_dialog(id,actor_unit["id"])}};var bribe_close_button={"Cancel (𝗪)":function(){remove_action_selection_dialog(id,actor_unit["id"])},"Do it!":function(){request_unit_do_action(act_id,actor_unit["id"],target_unit["id"]);remove_action_selection_dialog(id,actor_unit["id"])}};$(id).attr("title","Bribery Action");$(id).dialog({bgiframe:true,modal:true,buttons:bribe_possible?bribe_close_button:close_button,height:"auto",width:"auto"});$(id).dialog("open");$(id).dialog("widget").position({my:"center top",at:"center top",of:window});dialog_register(id,actor_unit["id"])}function popup_incite_dialog(actor_unit,target_city,cost,act_id){var incite_possible;var id;var dhtml;id="#incite_city_dialog_"+actor_unit["id"];remove_active_dialog(id);$("<div id='incite_city_dialog_"+actor_unit["id"]+"'></div>").appendTo("div#game_page");dhtml="";dhtml+="Treasury contains "+unit_owner(actor_unit)["gold"]+" gold.";dhtml+=" ";dhtml+="The price of inciting "+decodeURIComponent(target_city["name"])+" is "+cost+".";incite_possible=cost!=INCITE_IMPOSSIBLE_COST&&cost<=unit_owner(actor_unit)["gold"];if(!incite_possible){dhtml+=" ";dhtml+="Traitors Demand Too Much!";dhtml+="<br>"}$(id).html(dhtml);var close_button={"Close (𝗪)":function(){remove_action_selection_dialog(id,actor_unit["id"])}};var incite_close_buttons={"Cancel (𝗪)":function(){remove_action_selection_dialog(id,actor_unit["id"])},"Do it!":function(){request_unit_do_action(act_id,actor_unit["id"],target_city["id"]);remove_action_selection_dialog(id,actor_unit["id"])}};$(id).attr("title","Incite Revolt");$(id).dialog({bgiframe:true,modal:true,buttons:incite_possible?incite_close_buttons:close_button,height:"auto",width:"auto"});$(id).dialog("open");$(id).dialog("widget").position({my:"center top",at:"center top",of:window});dialog_register(id,actor_unit["id"])}function popup_unit_upgrade_dlg(actor_unit,target_city,cost,act_id){var upgrade_possible;var id;var dhtml;id="#upgrade_unit_dialog_"+actor_unit["id"];remove_active_dialog(id);$("<div id='upgrade_unit_dialog_"+actor_unit["id"]+"'></div>").appendTo("div#game_page");dhtml="";dhtml+="Treasury contains "+unit_owner(actor_unit)["gold"]+" gold.";dhtml+=" ";dhtml+="The price of upgrading our "+unit_types[actor_unit["type"]]["name"]+" is "+cost+".";upgrade_possible=cost<=unit_owner(actor_unit)["gold"];$(id).html(dhtml);var close_button={"Close (𝗪)":function(){remove_action_selection_dialog(id,actor_unit["id"])}};var upgrade_close_buttons={"Cancel (𝗪)":function(){remove_action_selection_dialog(id,actor_unit["id"])},"Do it!":function(){request_unit_do_action(act_id,actor_unit["id"],target_city["id"]);remove_action_selection_dialog(id,actor_unit["id"])}};$(id).attr("title","Unit upgrade");$(id).dialog({bgiframe:true,modal:true,buttons:upgrade_possible?upgrade_close_buttons:close_button,height:"auto",width:"auto"});$(id).dialog("open");$(id).dialog("widget").position({my:"center top",at:"center top",of:window});dialog_register(id,actor_unit["id"])}function create_steal_tech_button(parent_id,tech,actor_id,city_id,action_id){var button={text:tech["name"],click:function(){request_unit_do_action(action_id,actor_id,city_id,tech["id"]);send_request(JSON.stringify(packet));remove_action_selection_dialog("#"+parent_id,actor_id)}};return button}function popup_steal_tech_selection_dialog(actor_unit,target_city,act_probs,action_id){var id="stealtech_dialog_"+actor_unit["id"];var buttons=[];var untargeted_action_id=ACTION_COUNT;remove_active_dialog("#"+id);$("<div id='"+id+"'></div>").appendTo("div#game_page");$("#"+id).attr("title","Pick Tech to Steal");for(var tech_id in techs){var tech=techs[tech_id];var act_kn=player_invention_state(client.conn.playing,tech_id);var tgt_kn=player_invention_state(city_owner(target_city),tech_id);if(tgt_kn==TECH_KNOWN&&(act_kn==TECH_PREREQS_KNOWN||game_info["tech_steal_allow_holes"]&&act_kn==TECH_UNKNOWN)){buttons.push(create_steal_tech_button(id,tech,actor_unit["id"],target_city["id"],action_id))}}if(action_id==ACTION_SPY_TARGETED_STEAL_TECH_ESC){untargeted_action_id=ACTION_SPY_STEAL_TECH_ESC}else if(action_id==ACTION_SPY_TARGETED_STEAL_TECH){untargeted_action_id=ACTION_SPY_STEAL_TECH}if(untargeted_action_id!=ACTION_COUNT&&action_prob_possible(act_probs[untargeted_action_id])){buttons.push({text:"At "+unit_types[actor_unit["type"]]["name"]+"'s Discretion",click:function(){request_unit_do_action(untargeted_action_id,actor_unit["id"],target_city["id"]);remove_action_selection_dialog("#"+id,actor_unit["id"])}})}buttons.push({text:"Cancel (𝗪)",click:function(){remove_action_selection_dialog("#"+id,actor_unit["id"])}});$("#"+id).dialog({modal:true,buttons:buttons,width:"90%"});$("#"+id).dialog("open");$("#"+id).dialog("widget").position({my:"center top",at:"center top",of:window});dialog_register("#"+id,actor_unit["id"])}function create_sabotage_impr_button(improvement,parent_id,actor_id,city_id,act_id){return{text:improvement["name"],click:function(){request_unit_do_action(act_id,actor_id,city_id,improvement["id"]);remove_action_selection_dialog("#"+parent_id,actor_id)}}}function popup_sabotage_dialog(actor_unit,target_city,city_imprs,act_id){var id="sabotage_impr_dialog_"+actor_unit["id"];var buttons=[];var battering_event=false;if(client_rules_flag[CRF_SIEGE_RAM]==true){var punit=units[actor_unit["id"]];var ptype=unit_type(punit);if(ptype["name"]=="Siege Ram")battering_event=true}remove_active_dialog("#"+id);$("<div id='"+id+"'></div>").appendTo("div#game_page");$("#"+id).attr("title","Pick Sabotage Target");for(var i=0;i<ruleset_control["num_impr_types"];i++){var improvement=improvements[i];if(battering_event){if(improvement["name"]!="City Walls")continue;if(city_imprs.isSet(i)&&improvement["sabotage"]>0){request_unit_do_action(act_id,actor_unit["id"],target_city["id"],improvement["id"]);return}}if(city_imprs.isSet(i)&&improvement["sabotage"]>0){buttons.push(create_sabotage_impr_button(improvement,id,actor_unit["id"],target_city["id"],act_id))}}if(battering_event){swal("City has no City Walls.");setSwalTheme();return}buttons.push({text:"Cancel (𝗪)",click:function(){remove_action_selection_dialog("#"+id,actor_unit["id"])}});$("#"+id).dialog({modal:true,buttons:buttons,width:"90%"});$("#"+id).dialog("open");$("#"+id).dialog("widget").position({my:"center top",at:"center top",of:window});dialog_register("#"+id,actor_unit["id"])}function create_select_tgt_unit_button(parent_id,actor_unit_id,target_tile_id,target_unit_id){var button={};var text="";var target_unit=units[target_unit_id];var ttype=unit_type(target_unit);var punit=units[actor_unit_id];var ptype=unit_type(punit);var ptile=index_to_tile(target_unit["tile"]);var units_on_tile=tile_units(ptile);var carrying=0;var cargo_text="";var show_transport_info=false;var normal_ruleset=client_rules_flag[CRF_CARGO_HEURISTIC];var title_text=get_unit_city_info(target_unit,true);var moves_text=move_points_text(target_unit["movesleft"],false);if(moves_text=="-"){moves_text=" ALLY "}else{moves_text="M:"+moves_text+" "}if(target_unit["id"]!=punit["id"]){tclass=unit_classes[ttype.unit_class_id];if(ttype["transport_capacity"]>0){if(!normal_ruleset||unit_could_possibly_load(punit,ptype,ttype,tclass)){show_transport_info=true;for(t=0;t<units_on_tile.length;t++){var aunit=units_on_tile[t];if(aunit["transported"]&&aunit["transported_by"]==target_unit_id){if(carrying)cargo_text+=",";carrying++;cargo_text+=" "+unit_type(aunit)["name"]}}if(carrying>1)cargo_text="Carrying "+carrying+" units: "+cargo_text;else if(carrying==1)cargo_text="Carrying "+cargo_text;else cargo_text="No Cargo"}}}text+=html_emoji_from_universal(ttype["name"])+" ";if(show_transport_info)text+="T"+target_unit_id+" ";text+=ttype["name"]+" ";if(target_unit["transported_by"])text+="on T"+target_unit["transported_by"]+" ";if(show_transport_info){text+=moves_text;text+="<span style='cursor:help' title='"+cargo_text+"'>"+"L:"+carrying+" </span> ";text+="C:"+ttype["transport_capacity"]+" "}if(get_unit_homecity_name(target_unit)!=null)text+=" ("+get_unit_homecity_name(target_unit)+")";text+=unit_get_shield_image(target_unit);button={html:text,title:title_text,click:function(){var packet={pid:packet_unit_get_actions,actor_unit_id:actor_unit_id,target_unit_id:target_unit_id,target_tile_id:target_tile_id,target_extra_id:EXTRA_NONE,disturb_player:true};send_request(JSON.stringify(packet));remove_active_dialog(parent_id)}};return button}function select_tgt_unit(actor_unit,target_tile,potential_tgt_units){var i;var rid="sel_tgt_unit_dialog_"+actor_unit["id"];var id="#"+rid;var dhtml="";var buttons=[];remove_active_dialog(id);$("<div id='"+rid+"'></div>").appendTo("div#game_page");dhtml+="Select target unit for your ";dhtml+=unit_types[actor_unit["type"]]["name"]+":";$(id).html(dhtml);for(i=0;i<potential_tgt_units.length;i++){var tgt_unit=potential_tgt_units[i];buttons.push(create_select_tgt_unit_button(id,actor_unit["id"],target_tile["index"],tgt_unit["id"]))}var close_button={text:"Cancel (𝗪)",click:function(){remove_action_selection_dialog(id,actor_unit["id"])}};buttons.push(close_button);var dialog_width=buttons.length>20?"90%":"875px";$(id).dialog({title:"Target unit selection",bgiframe:true,style:"text-align:center",width:is_small_screen()?"99%":dialog_width,modal:true,buttons:buttons});$(id).dialog("open");$(id).dialog("widget").position({my:"center top",at:"center top",of:window});dialog_register(id,actor_unit["id"])}function list_potential_target_extras(act_unit,target_tile){var potential_targets=[];for(var i=0;i<ruleset_control.num_extra_types;i++){var pextra=extras[i];if(tile_has_extra(target_tile,pextra.id)){if(is_extra_removed_by(pextra,ERM_PILLAGE)&&unit_can_do_action(act_unit,ACTION_PILLAGE)){potential_targets.push(pextra)}}else{if(pextra.buildable&&(is_extra_caused_by(pextra,EC_IRRIGATION)&&unit_can_do_action(act_unit,ACTION_IRRIGATE)||is_extra_caused_by(pextra,EC_MINE)&&unit_can_do_action(act_unit,ACTION_MINE)||is_extra_caused_by(pextra,EC_BASE)&&unit_can_do_action(act_unit,ACTION_BASE)||is_extra_caused_by(pextra,EC_ROAD)&&unit_can_do_action(act_unit,ACTION_ROAD))){potential_targets.push(pextra)}}}return potential_targets}function create_select_tgt_extra_button(parent_id,actor_unit_id,target_unit_id,target_tile_id,target_extra_id){var text="";var button={};var target_tile=index_to_tile(target_tile_id);text+=extras[target_extra_id]["name"];text+=" (";if(tile_has_extra(target_tile,target_extra_id)){if(extra_owner(target_tile)!=null){text+=nations[extra_owner(target_tile)["nation"]]["adjective"]}else{text+="target"}}else{text+="create"}text+=")";button={text:text,click:function(){var packet={pid:packet_unit_get_actions,actor_unit_id:actor_unit_id,target_unit_id:target_unit_id,target_tile_id:target_tile_id,target_extra_id:target_extra_id,disturb_player:true};send_request(JSON.stringify(packet));remove_active_dialog(parent_id)}};return button}function create_load_transport_button(actor,ttile,tid,tmoves,tloaded,tcapacity,dialog_id,dialog_num,last_dialog){var disable=false;var target_unit=units[tid];var ttype=unit_type(target_unit);var title_text=get_unit_city_info(target_unit,true);var ptile=index_to_tile(target_unit["tile"]);var units_on_tile=tile_units(ptile);var carrying=0;var cargo_text="";var text="";if(tloaded>=tcapacity){tloaded=" FULL";disable=true}else tloaded=" L:"+tloaded;for(t=0;t<units_on_tile.length;t++){var aunit=units_on_tile[t];if(aunit["transported"]&&aunit["transported_by"]==tid){if(carrying)cargo_text+=",";carrying++;cargo_text+=" "+unit_type(aunit)["name"]}}if(carrying>1)cargo_text="Carrying "+carrying+" units: "+cargo_text;else if(carrying==1)cargo_text="Carrying "+cargo_text;else cargo_text="No Cargo";var moves_text=move_points_text(tmoves,false);if(moves_text=="-"){moves_text=" ALLY"}else{moves_text=" M:"+moves_text}text+=html_emoji_from_universal(ttype["name"])+" ";text+="T"+tid+" "+unit_type(target_unit)["name"]+" ";if(target_unit["transported_by"])text+="on T"+target_unit["transported_by"]+" ";text+=moves_text+"<span style='cursor:help' title='"+cargo_text+"'>"+tloaded+"</span>"+" C:"+tcapacity;if(get_unit_homecity_name(target_unit)!=null)text+=" ("+get_unit_homecity_name(target_unit)+")";text+=unit_get_shield_image(target_unit);var load_button={title:title_text,html:text,disabled:disable,click:function(){request_unit_do_action(ACTION_TRANSPORT_BOARD,actor,tid);remove_unit_id_from_waiting_list(actor["id"]);actor["done_moving"]=true;setTimeout(update_active_units_dialog,600);if(dialog_num==last_dialog)setTimeout(function(){advance_unit_focus(false)},700);remove_action_selection_dialog(dialog_id,actor["id"])}};return load_button}function select_tgt_extra(actor_unit,target_unit,target_tile,potential_tgt_extras){var i;var rid="sel_tgt_extra_dialog_"+actor_unit["id"];var id="#"+rid;var dhtml="";var buttons=[];remove_active_dialog(id);$("<div id='"+rid+"'></div>").appendTo("div#game_page");dhtml+="Select target extra for your ";dhtml+=unit_types[actor_unit["type"]]["name"];$(id).html(dhtml);for(i=0;i<potential_tgt_extras.length;i++){var tgt_extra=potential_tgt_extras[i];buttons.push(create_select_tgt_extra_button(id,actor_unit["id"],target_unit==null?IDENTITY_NUMBER_ZERO:target_unit["id"],target_tile["index"],tgt_extra["id"]))}$(id).dialog({title:"Target extra selection",bgiframe:true,modal:true,buttons:buttons});$(id).dialog("open");$(id).dialog("widget").position({my:"center top",at:"center top",of:window});dialog_register(id,actor_unit["id"])}function dialog_register(id,actor_id,input_maybe_needed){$(id).dialog("widget").keydown(dialog_key_listener);active_dialogs.push(id);$(id).dialog({autoOpen:true}).bind("dialogclose",function(event,ui){if(actor_id){remove_action_selection_dialog(id,actor_id,input_maybe_needed)}else{remove_active_dialog(id)}});$(id).css("color",default_dialog_text_color)}function create_a_close_button(parent_id){var close_button={text:"Cancel (𝗪)",click:function(){remove_active_dialog(parent_id)}};return close_button}function remove_active_dialog(id){const index=active_dialogs.indexOf(id);if(index>-1){active_dialogs.splice(index,1)}$(id).remove()}function remove_action_selection_dialog(id,actor_id,inp_maybe_needed){remove_active_dialog(id);if(!inp_maybe_needed){act_sel_queue_done(actor_id)}else{act_sel_queue_may_be_done(actor_id)}}function dialog_key_listener(ev){var keyboard_key=String.fromCharCode(ev.keyCode).toUpperCase();var key_code=ev.keyCode;if($("input:focus").length>0||!keyboard_input)return;if(C_S_RUNNING!=client_state())return;if(!active_dialogs)return;if(key_code==27){ev.stopPropagation();return}switch(keyboard_key){case"W":if(active_dialogs.length){ev.stopPropagation();remove_active_dialog_handler()}break}}function remove_active_dialog_handler(){kill_dialog_id=active_dialogs.pop();if(action_selection_in_progress_for&&kill_dialog_id.endsWith("_"+action_selection_in_progress_for)){did_not_decide=true;remove_action_selection_dialog(kill_dialog_id,action_selection_in_progress_for,false)}else{remove_active_dialog(kill_dialog_id)}}function action_selection_close(not_over){var id;var actor_unit_id=action_selection_in_progress_for;if(not_over){did_not_decide=true}id="#act_sel_dialog_"+actor_unit_id;if($(id).length)remove_action_selection_dialog(id,actor_unit_id);id="#bribe_unit_dialog_"+actor_unit_id;if($(id).length)remove_action_selection_dialog(id,actor_unit_id);id="#incite_city_dialog_"+actor_unit_id;if($(id).length)remove_action_selection_dialog(id,actor_unit_id);id="#upgrade_unit_dialog_"+actor_unit_id;if($(id).length)remove_action_selection_dialog(id,actor_unit_id);id="stealtech_dialog_"+actor_unit_id;if($(id).length)remove_action_selection_dialog(id,actor_unit_id);id="sabotage_impr_dialog_"+actor_unit_id;if($(id).length)remove_action_selection_dialog(id,actor_unit_id);id="#"+"sel_tgt_unit_dialog_"+actor_unit_id;if($(id).length)remove_action_selection_dialog(id,actor_unit_id);id="#"+"sel_tgt_extra_dialog_"+actor_unit_id;if($(id).length)remove_action_selection_dialog(id,actor_unit_id);id=$("#city_name_dialog");if($(id).length)$(id).remove();if(not_over){did_not_decide=false}}var banned_users=["Rayray","Blank","DMX","empmarkus","Vladimir"];function check_text_with_banlist(text){if(text==null||text.length==0)return false;for(var i=0;i<banned_users.length;i++){if(text.toLowerCase().indexOf(banned_users[i].toLowerCase())!=-1)return false}return true}function check_text_with_banlist_exact(text){if(text==null||text.length==0)return false;for(var i=0;i<banned_users.length;i++){if(text.toLowerCase()==banned_users[i].toLowerCase())return false}return true}function BitVector(raw){this.raw=raw;this.isSet=function(bitNumber){return(this.raw[Math.floor(bitNumber/8)]&1<<bitNumber%8)!=0};this.set=function(bitNumber){var byteNumber=Math.floor(bitNumber/8);this.raw[byteNumber]=this.raw[byteNumber]|1<<bitNumber%8};this.unset=function(bitNumber,value){var byteNumber=Math.floor(bitNumber/8);this.raw[byteNumber]=this.raw[byteNumber]&~(1<<bitNumber%8)};this.toString=function(){var out="";for(var i=0;i<this.raw.length*8;i++){out+=this.isSet(i)?"1":0}return out};this.toBitSet=function(){var out=[];for(var i=0;i<this.raw.length*8;i++){if(this.isSet(i)){out.push(i)}}return out}}income_calculated_by_client=false;var cities={};var city_rules={};var city_trade_routes={};var city_checkbox_states={};var master_checkbox=false;var retain_checkboxes_on_update=false;var goods={};var active_city=null;var closed_dialog_already=false;var inactive_city=null;var prod_selection_city=null;var worklist_dialog_active=false;var production_selection=[];var worklist_selection=[];var city_user_row_val=0;const CURV_NOTHING=0;const CURV_CORRUPTION=1;const CURV_POLLUTION=2;const CURV_TRADE_REVENUE=3;const CURV_GOLD_PER_SHIELD=4;const CURV_FOREIGNERS=5;const CURV_TURN_FOUNDED=6;const CURV_LAST=7;const clkmsg="\n\nClick column to change info category.";const CURV_icons=["/images/city_user_row.png","/images/corrupt.png","/images/pollution.png","/images/camel.png","/images/goldpershield.png","/images/foreigner.png","/images/stone_henge.png"];const CURV_title=["User Info Column:\nClick column below to choose","Corruption"+clkmsg,"Pollution Probability"+clkmsg,"Trade from Trade Routes"+clkmsg,"Gold cost per Shield"+clkmsg,"Foreign Citizens"+clkmsg,"Turn Founded"+clkmsg];var CITYO_DISBAND=0;var CITYO_NEW_EINSTEIN=1;var CITYO_NEW_TAXMAN=2;var CITYO_LAST=3;var FEELING_BASE=0;var FEELING_LUXURY=1;var FEELING_EFFECT=2;var FEELING_NATIONALITY=3;var FEELING_MARTIAL=4;var FEELING_FINAL=5;var selected_specialist=-1;var show_specialist_pane=false;var MAX_LEN_WORKLIST=64;var INCITE_IMPOSSIBLE_COST=1e3*1e3*1e3;var city_tab_index=0;var city_prod_clicks=0;var city_screen_updater=new EventAggregator(update_city_screen,250,EventAggregator.DP_NONE,250,3,250);var city_tile_map=null;var opt_show_unreachable_items=false;var opt_show_improvements_only=false;var active_superpanel_cityid=-1;var active_superpanel_dialog_refresh_delay=false;function city_tile(pcity){if(pcity==null)return null;return index_to_tile(pcity["tile"])}function city_owner_player_id(pcity){if(pcity==null)return null;return pcity["owner"]}function city_owner(pcity){return players[city_owner_player_id(pcity)]}function remove_city(pcity_id){if(pcity_id==null||client.conn.playing==null)return;var pcity=cities[pcity_id];if(pcity==null)return;var update=client.conn.playing.playerno&&city_owner(pcity).playerno==client.conn.playing.playerno;var ptile=city_tile(cities[pcity_id]);delete cities[pcity_id];if(update){city_screen_updater.update();bulbs_output_updater.update()}}function is_city_center(city,tile){return city["tile"]==tile["index"]}function is_free_worked(city,tile){return city["tile"]==tile["index"]}function is_capital(city){return city_has_building(city,improvement_id_by_name(B_PALACE_NAME))}function show_city_dialog_by_id(pcity_id){show_city_dialog(cities[pcity_id])}function findLongestWord(str){var strSplit=str.split(" ");var longestWord=0;for(var i=0;i<strSplit.length;i++){if(strSplit[i].length>longestWord){longestWord=strSplit[i].length}}return longestWord}function city_force_income_update(){if(observing)return;var income=0;for(cid in cities){var pcity=cities[cid];if(pcity["owner"]==client.conn.playing.playerno&&pcity["surplus"]!=null){income+=pcity["surplus"][O_GOLD];if(pcity["production_kind"]==VUT_IMPROVEMENT){if(improvements[pcity["production_value"]]["name"]=="Coinage"){var multiplier=1;if(client_rules_flag[CRF_MP2_C]){multiplier=1.5;multiplier+=city_has_building(pcity,improvement_id_by_name("Marketplace"))?.25:0;multiplier+=city_has_building(pcity,improvement_id_by_name("Bank"))?.25:0;multiplier+=city_has_building(pcity,improvement_id_by_name("Stock Exchange"))?.25:0;if(has_wonder(B_MEDICI_BANK))multiplier*=1.07}income+=multiplier*pcity["surplus"][O_SHIELD];if(Math.round(income)-income!=.5)income=Math.round(income);income_calculated_by_client=true}}}}client.conn.playing["expected_income"]=income;income_needs_refresh=false}function show_city_dialog(pcity){const playerno=pcity.owner;var turns_to_complete;var sprite;var punit;var the_time=(new Date).getTime();var from_tab=null;if(the_time-gov_refresh_timer<1100){city_tab_index=6;$("#ctg").click()}if(active_city!=pcity||active_city==null){city_prod_clicks=0;production_selection=[];worklist_selection=[]}if(active_city!=null)close_city_dialog_trigger();active_city=pcity;if(pcity==null)return;$("#city_dialog").remove();$("<div id='city_dialog'></div>").appendTo("div#game_page");var city_data={};$("#city_dialog").html(Handlebars.templates["city"](city_data));$("#city_canvas").click(city_mapview_mouse_click);show_city_traderoutes();show_city_happy_tab();if(show_city_governor_tab()==false){$("#ctg").parent().hide()}var dialog_buttons={};if(!is_small_screen()&&!touch_device){dialog_buttons=$.extend(dialog_buttons,{"Previous city":function(){previous_city()},"Next city":function(){next_city()},Buy:function(){request_city_buy()},Rename:function(){rename_city()}});dialog_buttons=$.extend(dialog_buttons,{"Exit (𝗪)":close_city_dialog_trigger})}else{dialog_buttons=$.extend(dialog_buttons,{"<":function(){previous_city()},">":function(){next_city()},B:function(){request_city_buy()},N:function(){rename_city()}});dialog_buttons=$.extend(dialog_buttons,{Exit:close_city_dialog_trigger})}var city_dialog_title="<div><span style='float:left;margin-right:70px;'>"+decodeURIComponent(pcity["name"])+" ("+pcity["size"]+")</span>";if(!is_small_screen()&&!client_is_observer()&&client.conn.playing.playerno==pcity["owner"]&&specialists!=null&&Object.keys(specialists)!=null){var num_specialists=Object.keys(specialists).length;if(client_rules_flag[CRF_ASMITH_SPECIALISTS]){if(!player_has_wonder(playerno,improvement_id_by_name(B_ADAM_SMITH_NAME))){num_specialists=3}}var specialist_control_html="<div style='padding-top:4px;' id='SC_pane'>";for(var u=0;u<num_specialists;u++){var spec_type_name=specialists[u]["plural_name"];var spec_gfx_key="specialist."+specialists[u]["rule_name"]+"_0";var border=selected_specialist==u?specialist_border_select:specialist_border_normal;var htitle=selected_specialist==u?"Unselect "+spec_type_name:"Assign "+spec_type_name;sprite=get_specialist_image_sprite(spec_gfx_key);specialist_control_html=specialist_control_html+"<span id='sp_t"+u+"' class='specialist_item' style='border-bottom:"+border+";margin-bottom:1px;cursor:"+"pointer; background: transparent url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float:left; '"+" onclick='city_select_specialist(event, "+specialists[u]["id"]+");'"+" title='"+htitle+"'></span>"}specialist_control_html+="</div>";if(show_specialist_pane){city_dialog_title+=specialist_control_html}else{city_dialog_title+="<div id='scp_show' style='font-size:95%;cursor:copy;' title='Specialist Control Pane' "+"onclick='toggle_specialist_control_pane();'"+"><img class='lowered_gov' style='border-radius:2px' src='/images/specialistpane.png'></div>"}}city_dialog_title+="</div>";$("#city_dialog").dialog({bgiframe:true,titleIsHtml:true,modal:false,width:is_small_screen()?"99%":"80%",height:is_small_screen()?$(window).height()+10:$(window).height()-80,close:close_city_dialog,buttons:dialog_buttons}).dialogExtend({minimizable:true,closable:true,minimize:function(evt,dlg){set_default_mapview_active()},icons:{minimize:"ui-icon-circle-minus",restore:"ui-icon-bullet"}});var dialogTitle=$("#city_dialog").closest(".ui-dialog").find(".ui-dialog-title");dialogTitle.html(city_dialog_title);$("#city_dialog").dialog("widget").keydown(city_keyboard_listener);if(is_small_screen()){$("#city_dialog").dialog("widget").children().children().children().css({"padding-top":"2px","padding-bottom":"3px","padding-right":"6px","padding-left":"6px","margin-bottom":"3px","margin-right":"0px"});$("#city_dialog").next().children()[0].children[0].innerHTML="&#9194;Last";$("#city_dialog").next().children()[0].children[1].innerHTML="Next&#9193;";$("#city_dialog").next().children()[0].children[2].innerHTML="Buy";$("#city_dialog").next().children()[0].children[3].innerHTML="Name";$("#city_canvas_top_div").css("padding","0px");$("#city_canvas_top_div").css("margin","0px");$("#city_canvas_top_div").css("width","100%");$("#city_canvas_top_div").css("margin-left","-5px");$("#city_panel").css("padding","0px");$("#city_dialog").addClass("noscrollbars");$("#city_dialog").css("overflow-y","hidden");$("#city_dialog").css("overflow-x","hidden");$("#city_dialog_info").css("width","100%");$("#city_dialog_info").addClass("noscrollbars");$("#city_viewport").addClass("noscrollbars");$("#city_tabs_0").css("padding","0px");$("#city_dialog").css("margin-left","-3px")}else{$("#prod_buttons").css({"margin-top":"39px","margin-right":"2px"});if(!touch_device){$("#city_dialog").next().children().children().first().html("<u><b style='font-family: FreecivBlack'>P</b></u>revious City");$("#city_dialog").next().children().children().first().next().html("<u><b style='font-family: FreecivBlack'>N</b></u>ext City");$("#city_dialog").next().children().children().first().next().next().html("<u><b style='font-family: FreecivBlack'>B</b></u>uy")}}$("#city_dialog").dialog("open");$("#city_dialog").parent().css("overflow-y","hidden");$("#game_text_input").blur();document.activeElement.blur();document.activeElement=$("#city_dialog").parent();$("#city_dialog").parent().focus();if(!is_small_screen()){$("#city_tabs-i").hide();$(".extra_tabs_small").remove();$("#mobile_cma_checkbox").remove();$("#ctg").html("<u><b style='font-family:FreecivBlack'>G</b></u>overnor"+(pcity.cma_enabled?" &#x1F539;":""))}else{$("#cma_surplus_hdr").css("font-size","105%");$("#cma_priorities_hdr").css("font-size","105%");$("#cma_status").css({"font-size":"100%","margin-top":"-8px"});$("#btn_toggle_cma").prependTo($("#cma_status"));$("#btn_cma_help").prependTo($("#cma_status"));$("#btn_toggle_cma").css("padding","4px");$("#btn_cma_help").css("padding","4px");$(".mobile_remove").hide();$(".mobile_shrink").css({padding:"2px",margin:"1px","margin-right":"-2px"});$(".mobile_shrink").css("font-size","100%");$("#btn_apply_cma").html("Set");$("#btn_cma_refreshall").html("Refresh All");$("#btn_cma_setall").html("Set All");$("#btn_cma_saveall").html("Save All");var units_element=$("#city_improvements_panel").detach();$("#city_units_tab").append(units_element);$("#city_tabs").css({margin:"-21px","margin-top":"-11px"});$("#ct0").html("Main");$("#ct1").html("Prod");$("#ct2").html("Routes");$("#ct3").html("Option");$("#ct4").html("Happy");$("#cti").html("Inside");$("#ctg").html("Gov"+(pcity.cma_enabled?"&#x1F539;":""));$("#cma_allow_disorder").remove()}$("#city_tabs").tabs({active:city_tab_index});$(".citydlg_tabs").height(is_small_screen()?$(window).height()-110:$(window).height()-225);city_worklist_dialog(pcity);$("#worklist_dialog_headline").unbind("click");$("#worklist_dialog_headline").click(function(ev){ev.stopImmediatePropagation();city_remove_current_prod()});set_city_mapview_active();center_tile_mapcanvas(city_tile(pcity));update_map_canvas(0,0,mapview["store_width"],mapview["store_height"]);var pop_string=is_small_screen()?city_population(pcity)+"K":numberWithCommas(city_population(pcity)*1e3);var change_string=pcity["granary_turns"]<0?"Starves in: ":"Growth in: ";$("#city_size").html("Population: "+pop_string+"<br>"+"Size: "+pcity["size"]+"<br>"+"Grain: "+pcity["food_stock"]+"/"+pcity["granary_size"]+"<br>"+change_string+city_turns_to_growth_text(pcity));var prod_type=get_city_production_type_sprite(pcity);var prod_string="";if(prod_type!=null){prod_string+=html_emoji_from_universal(prod_type["type"]["name"])+"&thinsp;"}prod_string+="<b style='color:#fed'>"+(prod_type!=null?prod_type["type"]["name"]+"</b>":"None</b>");if(is_small_screen()&&prod_type!=null&&prod_type["type"]["name"]!=null&&prod_type["type"]["name"].length>16)prod_string="<span style='font-size:90%'>"+prod_string+"</span>";$("#city_production_overview").html("<span style='cursor:pointer' onclick='city_prod_tab();'>"+prod_string+"</span>");turns_to_complete=get_city_production_time(pcity);if(turns_to_complete!=FC_INFINITY){$("#city_production_turns_overview").html(turns_to_complete+" turns &nbsp;&nbsp;("+get_production_progress(pcity)+")")}else{$("#city_production_turns_overview").html("-")}if(city_has_building(pcity,improvement_id_by_name(B_AIRPORT_NAME))){$("#city_dialog_info").css("padding-bottom","3px");var airlift_send_text;var airlift_font_size="1em;";if(game_info["airlifting_style"]&4){airlift_send_text="&infin;";airlift_font_size="2em;"}else{airlift_send_text=Math.max(0,pcity["airlift"])+"/"+effects[1][0]["effect_value"]}var city_airlift_capacity_html='<div id="airlift_send_capacity" title="Airlift send capacity"><div style="float:left"><img src="/images/orders/airlift.png" height="26" width="26"></div><div style="font-size:'+airlift_font_size+'float:left;height:26px;line-height:26px;margin-left:1px">'+airlift_send_text+"</div></div>";if(game_info["airlift_dest_divisor"]>0){airlift_font_size="1em;";var airlift_receive_text;if(game_info["airlifting_style"]&8){airlift_receive_text="&infin;";airlift_font_size="2em;"}else{var airlift_receive_max_capacity=Math.round(pcity["size"]/game_info["airlift_dest_divisor"]);airlift_receive_text=Math.max(0,pcity["airlift"]+airlift_receive_max_capacity-effects[1][0]["effect_value"])+"/"+airlift_receive_max_capacity}city_airlift_capacity_html+='<div id="airlift_receive_capacity" title="Airlift receive capacity"><div style="float:left;"><img src="/images/airlift-dest.png" height="26" width="26"></div><div style="font-size:'+airlift_font_size+'float:left;height:26px;line-height:26px;margin-left:1px">'+airlift_receive_text+"</div></div>"}$("#city_airlift_capacity").html(city_airlift_capacity_html);$("#airlift_send_capacity").tooltip();$("#airlift_receive_capacity").tooltip()}var uk_bonus=get_player_building_upkeep_bonus(pcity["owner"]);var reduction_pct;var longest_word;var long_name_font_reducer="";var improvements_html="";for(var z=0;z<ruleset_control.num_impr_types;z++){if(pcity["improvements"]!=null&&pcity["improvements"].isSet(z)){sprite=get_improvement_image_sprite(improvements[z]);if(sprite==null){console.log("Missing sprite for improvement "+z);continue}long_name_font_reducer="<div>";longest_word=findLongestWord(improvements[z]["name"]);if(improvements[z]["name"]!=null&&improvements[z]["name"].length==10)longest_word=10;reduction_pct=100-(longest_word-7)*5;if(reduction_pct<70)reduction_pct=70;if(longest_word>7)long_name_font_reducer="<div style='margin-left:-6px; font-size:"+reduction_pct+"%;'>";var upkeep=improvements[z]["upkeep"]-uk_bonus<=0&&improvements[z]["upkeep"]>=0?"none":improvements[z]["upkeep"];improvements_html=improvements_html+"<div id='city_improvement_element'><div class='buildings_present' style='background: transparent url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float:left; '"+'title="'+html_safe(cleaned_text(improvements[z]["helptext"]))+"\n\nUpkeep: "+upkeep+'" '+"onclick='city_sell_improvement("+z+");'>"+"</div>"+long_name_font_reducer+improvements[z]["name"]+"</div>"+"</div>"}}$("#city_improvements_list").html(improvements_html);var punits=tile_units(city_tile(pcity));if(punits!=null){var present_units_html="";for(var r=0;r<punits.length;r++){punit=punits[r];sprite=get_unit_image_sprite(punit);if(sprite==null){console.log("Missing sprite for "+punit);continue}if(punit["owner"]==client.conn.playing.playerno){present_units_html=present_units_html+"<div class='game_unit_list_item' title='"+html_safe(get_unit_city_info(punit))+"' style='cursor:pointer;cursor:hand; background: transparent url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float:left; '"+" onclick='city_dialog_activate_unit(units["+punit["id"]+"]);'"+"></div>"}else{var tag=nations[players[punit["owner"]]["nation"]]["graphic_str"];var civ_flag_url="";if(!nations[players[punit["owner"]]["nation"]]["customized"]){civ_flag_url+="/images/flags/"+tag+"-web"+get_tileset_file_extention();present_units_html=present_units_html+"<div class='game_unit_list_item' title='"+nations[players[punit["owner"]]["nation"]]["adjective"]+"' style='cursor:pointer;cursor:hand; background: transparent url("+civ_flag_url+"); background-size:contain; width:21px; height:14px; float:left; ' "+"onclick='city_dialog_activate_unit(units["+punit["id"]+"]);'"+"></div>";present_units_html=present_units_html+"<div class='game_unit_list_item' title='"+html_safe(get_unit_city_info(punit))+"' style='cursor:pointer;cursor:hand; background: transparent url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float:left; margin-left:-21px; martin-top:-14px;'"+" onclick='city_dialog_activate_unit(units["+punit["id"]+"]);'"+"></div>"}}present_units_html=present_units_html+get_html_vet_sprite(punit);present_units_html=present_units_html+get_html_hp_sprite(punit,false);present_units_html=present_units_html+get_html_activity_sprite(punit)}$("#city_present_units_list").html(present_units_html);$("#city_present_units_list").css({"margin-top":"-10px","padding-top":"20px"})}var sunits=get_supported_units(pcity);if(sunits!=null){var supported_units_html="";for(var t=0;t<sunits.length;t++){punit=sunits[t];sprite=get_unit_image_sprite(punit);if(sprite==null){console.log("Missing sprite for "+punit);continue}supported_units_html=supported_units_html+"<div class='game_unit_list_item' title='"+html_safe(get_unit_city_info(punit))+"' style='cursor:pointer;cursor:hand; background: transparent url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float:left; '"+" onclick='city_dialog_activate_unit(units["+punit["id"]+"]);'"+"></div>";supported_units_html=supported_units_html+get_html_vet_sprite(punit)+get_html_hp_sprite(punit,false)+get_html_activity_sprite(punit)}$("#city_supported_units_list").html(supported_units_html);$("#city_supported_units_list").css({"margin-top":"-10px","padding-top":"20px"})}$(".game_unit_list_item").tooltip();$(".buildings_present").tooltip();if("prod"in pcity&&"surplus"in pcity){var food_txt="";if(pcity["surplus"][O_FOOD]>0)food_txt+="+<b class='food_text'>";else if(pcity["surplus"][O_FOOD]<0)food_txt+="<b class='negative_food_text'>";else food_txt+="<b>";food_txt+=pcity["surplus"][O_FOOD]+"</b>";var food_txt2=pcity["surplus"][O_FOOD]==pcity["prod"][O_FOOD]?"":"("+pcity["prod"][O_FOOD]+")";var shield_txt="";if(pcity["surplus"][O_SHIELD]>0)shield_txt+="+<b class='prod_text'>";else shield_txt+="<b>";shield_txt+=pcity["surplus"][O_SHIELD]+"</b>";var shield_txt2=pcity["surplus"][O_SHIELD]==pcity["prod"][O_SHIELD]?"":"("+pcity["prod"][O_SHIELD]+")";var trade_txt="";if(pcity["surplus"][O_TRADE]>0)trade_txt+="+<b class='trade_text'>";else trade_txt+="<b>";trade_txt+=pcity["surplus"][O_TRADE]+"</b>";var trade_txt2=pcity["surplus"][O_TRADE]==pcity["prod"][O_TRADE]?"":"("+pcity["prod"][O_TRADE]+")";var gold_txt="";if(pcity["surplus"][O_GOLD]>0)gold_txt+="+<b class='gold_text'>";else gold_txt+="<b>";gold_txt+=pcity["surplus"][O_GOLD]+"</b>";var gold_txt2=pcity["surplus"][O_GOLD]==pcity["prod"][O_GOLD]?"":"("+pcity["prod"][O_GOLD]+")";var luxury_txt=pcity["surplus"][O_LUXURY]>0?"<b class='lux_text'>":"";luxury_txt+=pcity["surplus"][O_LUXURY]+"</b>";var luxury_txt2=pcity["surplus"][O_LUXURY]==pcity["prod"][O_LUXURY]?"":"("+pcity["prod"][O_LUXURY]+")";var science_txt=pcity["surplus"][O_SCIENCE]>0?"<b class='sci_text'>":"";science_txt+=pcity["surplus"][O_SCIENCE]+"</b>";var science_txt2=pcity["surplus"][O_SCIENCE]==pcity["prod"][O_SCIENCE]?"":"("+pcity["prod"][O_SCIENCE]+")";$("#city_food").html(food_txt);$("#city_food2").html(food_txt2);$("#city_prod").html(shield_txt);$("#city_prod2").html(shield_txt2);$("#city_trade").html(trade_txt);$("#city_trade2").html(trade_txt2);$("#city_gold").html(gold_txt);$("#city_gold2").html(gold_txt2);$("#city_luxury").html(luxury_txt);$("#city_luxury2").html(luxury_txt2);$("#city_science").html(science_txt);$("#city_science2").html(science_txt2);$("#city_corruption").html(pcity["waste"][O_TRADE]);if(client_rules_flag[CRF_NO_WASTE])$("#city_waste_row").remove();else $("#city_waste").html(pcity["waste"][O_SHIELD]);if(pcity["steal"]&&pcity["owner"]==client.conn.playing.playerno){$("#city_steal").html(pcity["steal"]);$("#city_steal_row").show()}else $("#city_steal_row").hide();$("#city_pollution").html(pcity["pollution"])}var specialist_html="";var citizen_types=["angry","unhappy","content","happy"];for(var s=0;s<citizen_types.length;s++){if(pcity==null||pcity["ppl_"+citizen_types[s]]!=null&&pcity["ppl_"+citizen_types[s]].length<1||pcity["ppl_"+citizen_types[s]]==null)continue;if(pcity["ppl_"+citizen_types[s]]==null)continue;for(var i=0;i<pcity["ppl_"+citizen_types[s]][FEELING_FINAL];i++){sprite=get_specialist_image_sprite("citizen."+citizen_types[s]+"_"+i%2);specialist_html=specialist_html+"<div class='specialist_item' style='background: transparent url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float:left; '"+" title='One "+citizen_types[s]+" citizen'></div>"}}for(var u=0;u<pcity["specialists_size"];u++){var spec_type_name=specialists[u]["plural_name"];var spec_gfx_key="specialist."+specialists[u]["rule_name"]+"_0";for(var j=0;j<pcity["specialists"][u];j++){sprite=get_specialist_image_sprite(spec_gfx_key);specialist_html=specialist_html+"<div class='specialist_item' style='cursor:pointer;cursor:hand; background: transparent url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float:left; '"+" onclick='city_change_specialist(event, "+pcity["id"]+","+specialists[u]["id"]+");'"+" title='"+spec_type_name+" (click to change)'></div>"}}$("#specialist_panel").html(specialist_html);var rapture_citizen_html="";for(var i=0;i<4;i++){if(pcity["ppl_"+citizen_types[i]][FEELING_FINAL]>0){sprite=get_specialist_image_sprite("citizen."+citizen_types[i]+"_"+Math.floor(i/2));rapture_citizen_html+="<div class='city_dialog_rapture_citizen' style='margin-right:auto;' title='"+citizen_types[i].charAt(0).toUpperCase()+citizen_types[i].slice(1)+" citizens'><div style='float:left;background: transparent url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;'>"+"</div><div style='float:left;height: "+sprite["height"]+"px;margin-left:2px;'>"+pcity["ppl_"+citizen_types[i]][FEELING_FINAL]+"</div></div>"}}$("#rapture_citizen_panel").html(rapture_citizen_html);$(".city_dialog_rapture_citizen").tooltip({position:{my:"center bottom",at:"center top-4"}});var city_surplus_colour="#d7d4cf";var city_surplus_sign="";if(pcity["surplus"][O_FOOD]>0){city_surplus_colour="#9bff7d";city_surplus_sign="+"}else if(pcity["surplus"][O_FOOD]<0){city_surplus_colour="#c55c55"}var rapture_food_status_html="<div><div style='float:left;background: transparent url(/images/wheat.png);width:20px;height:20px;'></div><div style='margin-left:4px;float:left;color:"+city_surplus_colour+";'</div><b>"+city_surplus_sign+pcity["surplus"][O_FOOD]+"</b></div></div>";var rapture_status_class="";var happy_people=pcity["ppl_happy"][FEELING_FINAL];var unhappy_angry_people=pcity["ppl_unhappy"][FEELING_FINAL]+pcity["ppl_angry"][FEELING_FINAL];if(happy_people>=pcity["size"]*.4999&&unhappy_angry_people==0&&pcity["size"]>2){$("#rapture_status").attr("title","Celebration next turn");rapture_status_class="city_dialog_celeb"}else if(unhappy_angry_people>happy_people){$("#rapture_status").attr("title","Disorder: will not produce next turn");rapture_status_class="city_dialog_disorder"}else{$("#rapture_status").attr("title","Peace next turn")}$("#rapture_food").html(rapture_food_status_html);$("#rapture_status").html("<div class='"+rapture_status_class+"' style='font-weight:bold;padding-bottom:9px;'>"+get_city_state(pcity)+"</div>");$("#rapture_status").tooltip({tooltipClass:"wider-tooltip",position:{my:"center bottom",at:"center top-3"}});if(pcity["size"]>=27)$("#city_canvas_top_div").width(pcity["size"]*15-30);$("#disbandable_city").off();$("#disbandable_city").prop("checked",pcity["city_options"]!=null&&pcity["city_options"].isSet(CITYO_DISBAND));$("#disbandable_city").click(function(){var options=pcity["city_options"];var packet={pid:packet_city_options_req,city_id:active_city["id"],options:options.raw};if($("#disbandable_city").prop("checked")){options.set(CITYO_DISBAND)}else{options.unset(CITYO_DISBAND)}send_request(JSON.stringify(packet))});var spacer=is_small_screen()?"":"<br>";var foreigners_html="<div id='city_foreigners'>"+spacer+"Citizen nationality:";if(pcity["nationalities_count"]>0){for(ethnicity in pcity["nation_id"]){var epop=pcity["nation_citizens"][ethnicity]==pcity["size"]?"<font color='#55cc55''>ALL</font>":pcity["nation_citizens"][ethnicity];foreigners_html+=" &bull; "+nations[players[pcity["nation_id"][ethnicity]]["nation"]]["adjective"]+": <b>"+epop+"</b>"}foreigners_html+="</div>";$("#city_overview_tab").append(foreigners_html)}if($("#city_improvements").parent().width()-$("#city_improvements").width()<50){$("#city_improvements").css({width:"100%"});$("#city_improvements").css({height:"100%"});$("#city_improvements_title").css({width:"4096px"});$("#city_improvements_list").css({width:"4096px"});$("#city_improvements").css({"padding-bottom":"0px"})}if(is_small_screen()){$(".ui-tabs-anchor").css("padding","2px");$("#city_panel_stats").css({width:"100%","margin-top":"17px",padding:"0px"});$("#city_panel_top").css({width:"100%"});$("#city_improvements").css({width:"100%"});$("#city_improvements_title").css({width:"4096px"});$("#city_improvements_list").css({width:"4096px"});$("#city_present_units").css({width:"100%"});$("#city_present_units_title").css({width:"4096px"});$("#city_present_units_list").css({width:"4096px"});$("#city_supported_units").css({width:"100%"});$("#city_supported_units_title").css({width:"4096px"});$("#city_supported_units_list").css({width:"4096px"});$("#city_tabs-i").css({"margin-top":"-20px",padding:"0px"});$("#city_dialog_info").css({width:"100%",padding:"0px"});$("#city_overview_tab").css("height",$("#city_overview_tab").height()-9);$("#dialog-extend-fixed-container").hide()}if(is_small_screen()||touch_device){if(window.innerHeight<window.innerWidth){$("#city_tabs").css({position:"static"})}}}function city_change_tab(tab_num){city_tab_index=tab_num}function get_city_production_type_sprite(pcity){if(pcity==null)return null;if(pcity["production_kind"]==VUT_UTYPE){var punit_type=unit_types[pcity["production_value"]];return{type:punit_type,sprite:get_unit_type_image_sprite(punit_type)}}if(pcity["production_kind"]==VUT_IMPROVEMENT){var improvement=improvements[pcity["production_value"]];return{type:improvement,sprite:get_improvement_image_sprite(improvement)}}return null}function get_city_production_type(pcity){if(pcity==null)return null;if(pcity["production_kind"]==VUT_UTYPE){var punit_type=unit_types[pcity["production_value"]];return punit_type}if(pcity["production_kind"]==VUT_IMPROVEMENT){var improvement=improvements[pcity["production_value"]];return improvement}return null}function get_city_production_time(pcity){if(pcity==null)return FC_INFINITY;if(pcity["production_kind"]==VUT_UTYPE){var punit_type=unit_types[pcity["production_value"]];return city_turns_to_build(pcity,punit_type,true,true)}if(pcity["production_kind"]==VUT_IMPROVEMENT){var improvement=improvements[pcity["production_value"]];if(improvement["name"]=="Coinage"){return FC_INFINITY}return city_turns_to_build(pcity,improvement,true,false)}return FC_INFINITY}function get_production_progress(pcity){if(pcity==null)return" ";if(touch_device){if(pcity["production_kind"]==VUT_UTYPE){return"<span style='font-size:70%;'>("+pcity["shield_stock"]+")</span>"}if(pcity["production_kind"]==VUT_IMPROVEMENT){var improvement=improvements[pcity["production_value"]];if(improvement["name"]=="Coinage"){return" "}return"<span style='font-size:70%;'>("+pcity["shield_stock"]+")</span>"}}else{if(pcity["production_kind"]==VUT_UTYPE){var punit_type=unit_types[pcity["production_value"]];return pcity["shield_stock"]+"/"+universal_build_shield_cost(pcity,punit_type)}if(pcity["production_kind"]==VUT_IMPROVEMENT){var improvement=improvements[pcity["production_value"]];if(improvement["name"]=="Coinage"){return" "}return pcity["shield_stock"]+"/"+universal_build_shield_cost(pcity,improvement)}}return" "}function get_gold_cost_per_shield(pcity){var accumulated=pcity["shield_stock"],buy_cost=pcity["buy_cost"],total_shields=0,remaining=0,gcps=0;if(buy_cost==0)return"No";if(pcity["production_kind"]==VUT_UTYPE){var punit_type=unit_types[pcity["production_value"]];total_shields=universal_build_shield_cost(pcity,punit_type)}else if(pcity["production_kind"]==VUT_IMPROVEMENT){var improvement=improvements[pcity["production_value"]];if(improvement["name"]!="Coinage")total_shields=universal_build_shield_cost(pcity,improvement)}remaining=total_shields-accumulated;gcps=buy_cost/remaining;return gcps.toFixed(2)}function get_shields_remaining(pcity){var accumulated=pcity["shield_stock"],total_shields=0,remaining=0;if(pcity["production_kind"]==VUT_UTYPE){var punit_type=unit_types[pcity["production_value"]];total_shields=universal_build_shield_cost(pcity,punit_type)}else if(pcity["production_kind"]==VUT_IMPROVEMENT){var improvement=improvements[pcity["production_value"]];if(improvement["name"]!="Coinage")total_shields=universal_build_shield_cost(pcity,improvement)}remaining=total_shields-accumulated;return remaining>0?remaining:0}function generate_production_list(){var production_list=[];const gov_id=players[client.conn.playing.playerno].government;for(var unit_type_id in unit_types){var punit_type=unit_types[unit_type_id];if(utype_has_flag(punit_type,UTYF_NOBUILD))continue;if(punit_type.government_req<GOV_LAST){if(punit_type.goverment_req!=gov_id)continue}if(utype_has_flag(punit_type,UTYF_NUCLEAR)){if(!server_settings["nukes_minor"]["val"])continue;if(!server_settings["nukes_major"]["val"]){if(punit_type["bombard_rate"]>0)continue;if(punit_type["bombard_rate"]<-1)continue}}if(is_small_screen()){production_list.push({kind:VUT_UTYPE,value:punit_type["id"],text:punit_type["name"],helptext:cleaned_text(punit_type["helptext"]),rule_name:punit_type["rule_name"],build_cost:get_universal_discount_price(punit_type),unit_details:"A<b style='font-family:Arial'>"+fractionalize(utype_real_base_attack_strength(punit_type))+"</b>D<b style='font-family:Arial'>"+fractionalize(utype_real_base_defense_strength(punit_type))+(punit_type["firepower"]>1?"F<b style='font-family:Arial'>"+punit_type["firepower"]+"</b> ":"")+"</b>H<b style='font-family:Arial'>"+punit_type["hp"],sprite:get_unit_type_image_sprite(punit_type)})}else{var move_bonus=parseInt(punit_type["move_bonus"][0])?parseInt(punit_type["move_bonus"][0]):0;production_list.push({kind:VUT_UTYPE,value:punit_type["id"],text:punit_type["name"],helptext:cleaned_text(punit_type["helptext"]),rule_name:punit_type["rule_name"],build_cost:get_universal_discount_price(punit_type),unit_details:"A<b style='font-family:Arial'>"+fractionalize(utype_real_base_attack_strength(punit_type))+"</b> "+"D<b style='font-family:Arial'>"+fractionalize(utype_real_base_defense_strength(punit_type))+"</b> "+(punit_type["firepower"]>1?"F<b style='font-family:Arial'>"+punit_type["firepower"]+"</b> ":"")+"H<b style='font-family:Arial'>"+punit_type["hp"]+"</b> "+"M<b style='font-family:Arial'>"+move_points_text(parseInt(punit_type["move_rate"])+move_bonus,true)+""+(punit_type["fuel"]?"</b><sub>"+punit_type["fuel"]+"</sub>":"</b>")+(punit_type["transport_capacity"]?" C<b style='font-family:Arial'>"+punit_type["transport_capacity"]+"</b>":"")+"",sprite:get_unit_type_image_sprite(punit_type)})}}for(var improvement_id in improvements){var pimprovement=improvements[improvement_id];var build_cost=universal_build_shield_cost(active_city,pimprovement);var building_details=pimprovement["upkeep"];if(pimprovement["name"]=="Coinage"){build_cost="-";building_details="-"}if(!server_settings["nukes_major"]["val"]&&pimprovement["name"]=="Enrichment Facility"){continue}else if(!server_settings["nukes_minor"]["val"]&&pimprovement["name"]=="Manhattan Project"){continue}if((ruleset_control["name"]=="Multiplayer-Evolution ruleset"||ruleset_control["name"].startsWith("Avant-garde")||ruleset_control["name"].startsWith("MP2"))&&pimprovement["name"]=="Great Wall"&&player_invention_state(client.conn.playing,tech_id_by_name("Machine Tools"))==TECH_KNOWN){continue}production_list.push({kind:VUT_IMPROVEMENT,value:pimprovement["id"],text:pimprovement["name"],helptext:cleaned_text(pimprovement["helptext"]),rule_name:pimprovement["rule_name"],build_cost:build_cost,unit_details:building_details,sprite:get_improvement_image_sprite(pimprovement)})}return production_list}function can_city_build_unit_direct(pcity,punittype){return true}function can_city_build_unit_now(pcity,punittype_id){return pcity!=null&&pcity["can_build_unit"]!=null&&pcity["can_build_unit"][punittype_id]=="1"}function can_city_build_improvement_now(pcity,pimprove_id){return pcity!=null&&pcity["can_build_improvement"]!=null&&pcity["can_build_improvement"][pimprove_id]=="1"}function can_city_queue_improvement(pcity,pimprove_id){if(city_has_building(pcity,pimprove_id))return false;if(city_has_building_in_queue(pcity,pimprove_id))return false;if(can_city_build_improvement_now(pcity,pimprove_id))return true;if(improvements[pimprove_id]["reqs"].length>0){if(player_invention_state(client.conn.playing,improvements[pimprove_id]["reqs"][0]["value"])==TECH_KNOWN){if(improvements[pimprove_id]["reqs"].length>1){if(improvements[pimprove_id]["reqs"][1]["kind"]==VUT_IMPROVEMENT){if(city_has_building_in_queue(pcity,improvements[pimprove_id]["reqs"][1]["value"])){return true}}}}}return false}function can_city_build_now(pcity,kind,value){return kind!=null&&value!=null&&(kind==VUT_UTYPE?can_city_build_unit_now(pcity,value):can_city_build_improvement_now(pcity,value))}function city_has_building(pcity,improvement_id){return 0<=improvement_id&&improvement_id<ruleset_control.num_impr_types&&pcity["improvements"]&&pcity["improvements"].isSet(improvement_id)}function city_has_building_in_queue(pcity,improvement_id){if(pcity==null||pcity["worklist"]==null)return false;for(var z=-1;z<pcity["worklist"].length;z++){var prod_kind,prod_value;if(z==-1){prod_kind=pcity["production_kind"];prod_value=pcity["production_value"]}else{prod_kind=pcity["worklist"][z]["kind"];prod_value=pcity["worklist"][z]["value"]}if(prod_kind==VUT_IMPROVEMENT&&prod_value==improvement_id)return true}return false}function city_turns_to_build(pcity,target,include_shield_stock,is_unit){var city_shield_surplus=pcity["surplus"][O_SHIELD];var city_shield_stock=include_shield_stock?pcity["shield_stock"]:0;var cost=universal_build_shield_cost(pcity,target);if(include_shield_stock==true&&pcity["shield_stock"]>=cost){return 1}else if(pcity["surplus"][O_SHIELD]>0){return Math.floor((cost-city_shield_stock-1)/city_shield_surplus+1)}else{return FC_INFINITY}}function city_change_prod(city_id){active_city=city_id;city_tab_index=1;show_city_dialog_by_id(active_city)}function request_city_id_buy(city_id){active_city=null;inactive_city=cities[city_id];request_city_buy();active_superpanel_cityid=city_id}function request_city_buy(){var pcity=null;if(active_city==null){pcity=inactive_city}else{pcity=active_city}var pplayer=client.conn.playing;remove_active_dialog("#dialog");$("<div id='dialog'></div>").appendTo("div#game_page");var buy_price_string="";var buy_question_string="";if(pcity["production_kind"]==VUT_UTYPE){var punit_type=unit_types[pcity["production_value"]];if(punit_type!=null){buy_price_string=punit_type["name"]+" costs "+pcity["buy_cost"]+" gold.";buy_question_string="Buy "+punit_type["name"]+" for <b>"+pcity["buy_cost"]+"</b> gold"}}else{var improvement=improvements[pcity["production_value"]];if(improvement!=null){buy_price_string=improvement["name"]+" costs "+pcity["buy_cost"]+" gold.";buy_question_string="Buy "+improvement["name"]+" for <b>"+pcity["buy_cost"]+"</b> gold"}}var cost_per_shield_text=" @ "+get_gold_cost_per_shield(pcity)+"g/shield ?";var treasury_text="<br>Treasury contains "+pplayer["gold"]+" gold.";if(pcity["buy_cost"]==0||pcity["buy_cost"]>pplayer["gold"]){show_dialog_message("Purchase not possible",buy_price_string+treasury_text);return}var dhtml=buy_question_string+cost_per_shield_text+treasury_text;$("#dialog").html(dhtml);$("#dialog").attr("title","Buy It!");$("#dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"95%":"50%",buttons:{Yes:function(){send_city_buy();remove_active_dialog("#dialog")},"No (𝗪)":function(){remove_active_dialog("#dialog")}}});$("#dialog").dialog("open");dialog_register("#dialog")}function send_city_buy(){if(active_city!=null){var packet={pid:packet_city_buy,city_id:active_city["id"]};send_request(JSON.stringify(packet))}else if(inactive_city!=null){var packet={pid:packet_city_buy,city_id:inactive_city["id"]};send_request(JSON.stringify(packet))}else show_dialog_message("Please Report bug:","send_city_buy() in city.js has no active or inactive city specified. Code:767")}function send_city_change(city_id,kind,value){var packet={pid:packet_city_change,city_id:city_id,production_kind:kind,production_value:value};send_request(JSON.stringify(packet))}function close_city_dialog_trigger(){closed_dialog_already=true;$("#city_dialog").dialog("close")}function close_city_dialog(){if(closed_dialog_already==false)$("#city_dialog").dialog("close");else closed_dialog_already=false;var active_tab=$("#tabs").tabs("option","active");if(active_tab!=TAB_MAP){keyboard_input=false;setTimeout(function(){keyboard_input=true},250)}else set_default_mapview_active();worklist_dialog_active=false;setup_window_size();if(active_city){center_tile_mapcanvas(city_tile(active_city));active_city=null;update_map_canvas_full()}if(is_small_screen())$("#dialog-extend-fixed-container").show()}function do_city_map_click(ptile){var updated=true;var packet=null;var city_id=active_city["id"];if(ptile["worked"]==city_id){if(updated){var s=selected_specialist;if(s>=4){city_id+=32768;s-=4}if(s>=2){city_id+=16384;s-=2}if(s>=1){city_id+=8192}}packet={pid:packet_city_make_specialist,city_id:city_id,tile_id:ptile["index"]}}else{packet={pid:packet_city_make_worker,city_id:city_id,tile_id:ptile["index"]}}send_request(JSON.stringify(packet))}function does_city_have_improvement(pcity,improvement_name){if(pcity==null||pcity["improvements"]==null)return false;for(var z=0;z<ruleset_control.num_impr_types;z++){if(pcity["improvements"]!=null&&pcity["improvements"].isSet(z)&&improvements[z]!=null&&improvements[z]["name"]==improvement_name){return true}}return false}function city_name_dialog(suggested_name,unit_id){$("#city_name_dialog").remove();$("<div id='city_name_dialog'></div>").appendTo("div#game_page");$("#city_name_dialog").html($("<div>What shall we call our new city?</div>"+"<input id='city_name_req' type='text' spellcheck='false'>"));$("#city_name_req").attr("value",suggested_name);$("#city_name_dialog").attr("title","Build New City");$("#city_name_dialog").dialog({bgiframe:true,modal:true,width:"300",close:function(){keyboard_input=true;act_sel_queue_done(unit_id)},buttons:[{text:"Cancel",click:function(){$("#city_name_dialog").remove();keyboard_input=true;act_sel_queue_done(unit_id)}},{text:"Ok",click:function(){var name=alphanumeric_cleaner_city_names($("#city_name_req").val());if(name.length==0||name.length>=MAX_LEN_CITYNAME-6||encodeURIComponent(name).length>=MAX_LEN_CITYNAME-6){swal("City name is invalid. Please try a different shorter name.");setSwalTheme();return}var actor_unit=game_find_unit_by_number(unit_id);request_unit_do_action(ACTION_FOUND_CITY,unit_id,actor_unit["tile"],0,encodeURIComponent(name));$("#city_name_dialog").remove();keyboard_input=true;act_sel_queue_done(unit_id)}}]});$("#city_name_req").attr("maxlength","30");$("#city_name_dialog").dialog("open");$("#city_name_dialog").css("color",default_dialog_text_color);$("#city_name_dialog").keyup(function(e){if(e.keyCode==13){var name=alphanumeric_cleaner_city_names($("#city_name_req").val());if(name.length==0||name.length>=MAX_LEN_CITYNAME-6||encodeURIComponent(name).length>=MAX_LEN_CITYNAME-6){swal("City name is invalid. Please try a different shorter name.");setSwalTheme();return}var actor_unit=game_find_unit_by_number(unit_id);request_unit_do_action(ACTION_FOUND_CITY,unit_id,actor_unit["tile"],0,encodeURIComponent(name));$("#city_name_dialog").remove();keyboard_input=true;act_sel_queue_done(unit_id)}});blur_input_on_touchdevice();keyboard_input=false}function next_city(){if(!client.conn.playing)return;update_city_screen();var next_row=$("#cities_list_"+active_city["id"]).next();if(next_row.length===0){next_row=$("#city_table tbody tr").first()}if(next_row.length>0){show_city_dialog(cities[next_row.attr("id").substr(12)])}}function previous_city(){if(!client.conn.playing)return;update_city_screen();var prev_row=$("#cities_list_"+active_city["id"]).prev();if(prev_row.length===0){prev_row=$("#city_table tbody tr").last()}if(prev_row.length>0){show_city_dialog(cities[prev_row.attr("id").substr(12)])}}function city_sell_improvement(improvement_id){city_sell_improvement_in(active_city["id"],improvement_id)}function city_sell_improvement_in(city_id,improvement_id){swal({title:"Sell Building",text:"Sell "+improvements[improvement_id].name+" in "+cities[city_id]["name"]+"?",type:"warning",showCancelButton:true,confirmButtonColor:"#308030",confirmButtonText:"SELL",closeOnConfirm:true},function(){var packet={pid:packet_city_sell,city_id:cities[city_id]["id"],build_id:improvement_id};send_request(JSON.stringify(packet));active_superpanel_cityid=city_id});setSwalTheme()}function city_turns_to_growth_text(pcity){var turns=pcity["granary_turns"];var small=is_small_screen();if(turns==0){return"blocked"}else if(turns>1e6){return" "}else if(turns==-1){return small?"&#9662; <b><u>1 turn</u></b>":"&#9662; <b><u>1 turn</u></b>"}else if(turns<-1){return small?"&#9662; "+Math.abs(turns):"&#9662; "+Math.abs(turns)+" turns"}else if(turns==1){return small?"<b>&nbsp;1 turn</b>":"<b>&nbsp;1 turn</b>"}else{return turns+" turns"}}function dxy_to_center_index(dx,dy,r){return(dx+r)*(2*r+1)+dy+r}function get_city_dxy_to_index(dx,dy,pcity){build_city_tile_map(pcity.city_radius_sq);var city_tile_map_index=dxy_to_center_index(dx,dy,city_tile_map.radius);var ctile=city_tile(pcity);return get_city_tile_map_for_pos(ctile.x,ctile.y)[city_tile_map_index]}function build_city_tile_map(radius_sq){if(city_tile_map==null||city_tile_map.radius_sq<radius_sq){var r=Math.floor(Math.sqrt(radius_sq));var vectors=[];for(var dx=-r;dx<=r;dx++){for(var dy=-r;dy<=r;dy++){var d_sq=map_vector_to_sq_distance(dx,dy);if(d_sq<=radius_sq){vectors.push([dx,dy,d_sq,dxy_to_center_index(dx,dy,r)])}}}vectors.sort(function(a,b){var d=a[2]-b[2];if(d!==0)return d;d=a[0]-b[0];if(d!==0)return d;return a[1]-b[1]});var base_map=[];for(var i=0;i<vectors.length;i++){base_map[vectors[i][3]]=i}city_tile_map={radius_sq:radius_sq,radius:r,base_sorted:vectors,maps:[base_map]}}}function delta_tile_helper(pos,r,size){var d_min=-pos;var d_max=size-1-pos;var i=0;if(d_min>-r){i=r+d_min}else if(d_max<r){i=2*r-d_max}return[d_min,d_max,i]}function build_city_tile_map_with_limits(dx_min,dx_max,dy_min,dy_max){var clipped_map=[];var v=city_tile_map.base_sorted;var vl=v.length;var index=0;for(var vi=0;vi<vl;vi++){var tile_data=v[vi];if(tile_data[0]>=dx_min&&tile_data[0]<=dx_max&&tile_data[1]>=dy_min&&tile_data[1]<=dy_max){clipped_map[tile_data[3]]=index;index++}}return clipped_map}function get_city_tile_map_for_pos(x,y){if(topo_has_flag(TF_WRAPX)){if(topo_has_flag(TF_WRAPY)){get_city_tile_map_for_pos=function(x,y){return city_tile_map.maps[0]}}else{get_city_tile_map_for_pos=function(x,y){var r=city_tile_map.radius;var d=delta_tile_helper(y,r,map.ysize);if(city_tile_map.maps[d[2]]==null){var m=build_city_tile_map_with_limits(-r,r,d[0],d[1]);city_tile_map.maps[d[2]]=m}return city_tile_map.maps[d[2]]}}}else{if(topo_has_flag(TF_WRAPY)){get_city_tile_map_for_pos=function(x,y){var r=city_tile_map.radius;var d=delta_tile_helper(x,r,map.xsize);if(city_tile_map.maps[d[2]]==null){var m=build_city_tile_map_with_limits(d[0],d[1],-r,r);city_tile_map.maps[d[2]]=m}return city_tile_map.maps[d[2]]}}else{get_city_tile_map_for_pos=function(x,y){var r=city_tile_map.radius;var dx=delta_tile_helper(x,r,map.xsize);var dy=delta_tile_helper(y,r,map.ysize);var map_i=(2*r+1)*dx[2]+dy[2];if(city_tile_map.maps[map_i]==null){var m=build_city_tile_map_with_limits(dx[0],dx[1],dy[0],dy[1]);city_tile_map.maps[map_i]=m}return city_tile_map.maps[map_i]}}}return get_city_tile_map_for_pos(x,y)}function toggle_specialist_control_pane(){if(show_specialist_pane==false){show_specialist_pane=!show_specialist_pane;$("#scp_show").hide();show_city_dialog(active_city)}else{selected_specialist=-1;show_specialist_pane=!show_specialist_pane;$("#scp_show").show();show_city_dialog(active_city)}}var specialist_border_select="2px solid #fff";var specialist_border_normal="2px solid #000";function city_select_specialist(event,to_specialist_id){const num_specialists=Object.keys(specialists).length;var spec_type_name;for(i=0;i<num_specialists;i++){spec_type_name=specialists[i]["plural_name"];$("#sp_t"+i).css({"border-bottom":specialist_border_normal});$("#sp_t"+i).attr({title:"Assign "+spec_type_name})}if(selected_specialist!=to_specialist_id){selected_specialist=to_specialist_id;spec_type_name=specialists[selected_specialist]["plural_name"];$("#sp_t"+selected_specialist).css({"border-bottom":specialist_border_select});$("#sp_t"+selected_specialist).attr({title:"Unselect "+spec_type_name})}else{selected_specialist=-1;toggle_specialist_control_pane()}}function city_change_specialist(event,city_id,from_specialist_id){var updated=1;var city_message;var to_specialist_id;var num_specialists=Object.keys(specialists).length;if(!client_rules_flag[CRF_ASMITH_SPECIALISTS]){to_specialist_id=selected_specialist==-1?(from_specialist_id+1)%num_specialists:selected_specialist;city_message={pid:packet_city_change_specialist,city_id:city_id,from:from_specialist_id,to:to_specialist_id}}else{to_specialist_id=selected_specialist==-1?from_specialist_id+1:selected_specialist;if(player_has_wonder(client.conn.playing.playerno,improvement_id_by_name(B_ADAM_SMITH_NAME))){if(to_specialist_id==num_specialists)to_specialist_id=0;if((event.ctrlKey||event.altKey||event.metaKey)&&to_specialist_id>=3)to_specialist_id=0}else{if(to_specialist_id==3)to_specialist_id=0}city_message={pid:packet_city_change_specialist,city_id:city_id,from:from_specialist_id,to:event.shiftKey?to_specialist_id+100*updated:to_specialist_id}}send_request(JSON.stringify(city_message));if(!updated){if(event.shiftKey){for(var s=1;s<cities[city_id].specialists[from_specialist_id];s++){send_request(JSON.stringify(city_message))}}}}function city_can_buy(pcity){var improvement=improvements[pcity["production_value"]];return!pcity["did_buy"]&&pcity["turn_founded"]!=game_info["turn"]&&improvement["name"]!="Coinage"}function city_population(pcity){return pcity["size"]*(pcity["size"]+1)*5}function rename_city(){if(active_city==null)return;$("#city_name_dialog").remove();$("<div id='city_name_dialog'></div>").appendTo("div#game_page");$("#city_name_dialog").html($("<div>What should we call this city?</div>"+"<input id='city_name_req' type='text' spellcheck='false'>"));$("#city_name_req").attr("value",active_city["name"]);$("#city_name_dialog").attr("title","Rename City");$("#city_name_dialog").dialog({bgiframe:true,modal:true,width:"300",close:function(){keyboard_input=true},buttons:[{text:"Cancel",click:function(){$("#city_name_dialog").remove();keyboard_input=true}},{text:"Ok",click:function(){var name=alphanumeric_cleaner_city_names($("#city_name_req").val());if(name.length==0||name.length>=MAX_LEN_NAME-4||encodeURIComponent(name).length>=MAX_LEN_NAME-4){swal("City name is invalid");setSwalTheme();return}var packet={pid:packet_city_rename,name:encodeURIComponent(name),city_id:active_city["id"]};send_request(JSON.stringify(packet));$("#city_name_dialog").remove();keyboard_input=true}}]});$("#city_name_req").attr("maxlength","30");$("#city_name_dialog").dialog("open");$("#city_name_dialog").css("color",default_dialog_text_color);$("#city_name_dialog").keyup(function(e){if(e.keyCode==13){var name=alphanumeric_cleaner_city_names($("#city_name_req").val());var packet={pid:packet_city_rename,name:encodeURIComponent(name),city_id:active_city["id"]};send_request(JSON.stringify(packet));$("#city_name_dialog").remove();keyboard_input=true}})}function show_city_happy_tab(){if(active_city==null){return}const pcity=active_city;var citizen_types=["angry","unhappy","content","happy"];var causes=["Cities","Luxury","Buildings","Nationality","Units","Wonders"];var cause_titles=["The more cities a nation has, the harder it is to govern cities with higher population. This might cause unhappiness. Details depend on government type. See help on Governments.","Each city allots Luxury according to the national luxury rate, and also through Entertainers. Luxury can also be boosted indirectly by buildings such as Marketplaces.","Some types of buildings directly appease citizenry without giving Luxury; for example: Temples","In some rulesets, foreign nationals may be displeased if you are at war with their home nation.","In some governments, military units in the city can keep order by martial law. In other governments, units deployed abroad cause unhappiness.","Wonders and Palaces in the city may give bonus effects on happiness. Wonders elsewhere in the nation may give bonuses to all cities in the nation."];var happy_tab_html="<header><div style='font-size: 150%'><b>Citizen Happiness</b></div><br></header>";happy_tab_html+="<table id='happy_table' style='border=3px;border-spacing=3;padding=30;'>"+"<thead id='happy_table_head'><tr>"+"<th style='text-align:left;'>Cause</th><th style='text-align:left;'>Citizens</th>"+"</tr></thead><tbody>";for(cause in causes){happy_tab_html+="<tr><td><div class='happy_cause_help' title='"+html_safe(cause_titles[cause])+"'>";happy_tab_html+=causes[cause]+"</div></td>";happy_tab_html+="<td><div>";var citizen_html="";for(var s=0;s<citizen_types.length;s++){if(pcity==null||!pcity["ppl_"+citizen_types[s]]||pcity["ppl_"+citizen_types[s]].length<1)continue;if(pcity["ppl_"+citizen_types[s]]==null)continue;for(var i=0;i<pcity["ppl_"+citizen_types[s]][cause];i++){sprite=get_specialist_image_sprite("citizen."+citizen_types[s]+"_"+i%2);citizen_html=citizen_html+"<div class='specialist_item' style='background: transparent url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float:left; '"+" title='One "+citizen_types[s]+" citizen'></div>"}}for(var u=0;u<pcity["specialists_size"];u++){var spec_type_name=specialists[u]["plural_name"];var spec_gfx_key="specialist."+specialists[u]["rule_name"]+"_0";for(var j=0;j<pcity["specialists"][u];j++){sprite=get_specialist_image_sprite(spec_gfx_key);citizen_html=citizen_html+"<div class='specialist_item' style='cursor:pointer;cursor:hand; background: transparent url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float:left; '"+" onclick='city_change_specialist(event, "+pcity["id"]+","+specialists[u]["id"]+");'"+" title='"+spec_type_name+" (click to change)'></div>"}}happy_tab_html+=citizen_html+"</div></td></tr>"}happy_tab_html+="</tbody></table>";$("#city_happy_tab").html(happy_tab_html);$(".happy_cause_help").tooltip()}function show_city_traderoutes(){var msg;var routes;if(active_city==null){return}routes=city_trade_routes[active_city["id"]];if(active_city["traderoute_count"]!=0&&routes==null){console.log("Can't find the trade routes "+active_city["name"]+" is said to have");return}msg="";for(var i=0;i<active_city["traderoute_count"];i++){var tcity_id;var tcity;var good;if(routes[i]==null)continue;tcity_id=routes[i]["partner"];if(tcity_id==0||tcity_id==null){continue}good=goods[routes[i]["goods"]];if(good==null){console.log("Missing goods type "+routes[i]["goods"]);good={name:"Unknown"}}tcity=cities[tcity_id];if(tcity==null)continue;msg+=good["name"]+" trade with "+tcity["name"];msg+=" gives +"+routes[i]["value"]+" base trade each turn."+"<br>"}if(msg==""){msg="No traderoutes.";msg+=" (Open the Manual, select Economy and then Trade ";msg+="if you want to learn more about trade and trade routes.)"}$("#city_traderoutes_tab").html(msg)}function get_city_traderoute_revenue(city_id){var pcity=cities[city_id],total_revenue=0;if(pcity==null)return 0;var routes=city_trade_routes[city_id];if(pcity["traderoute_count"]!=0&&routes==null){console.log("Can't find the trade routes "+pcity["name"]+" is said to have");return 0}for(var i=0;i<pcity["traderoute_count"];i++){var tcity_id;if(routes[i]==null)continue;tcity_id=routes[i]["partner"];if(tcity_id==0||tcity_id==null)continue;total_revenue+=routes[i]["value"]}return total_revenue}function city_worklist_dialog(pcity){if(pcity==null)return;var universals_list=[];var kind;var value;if(pcity["worklist"]!=null&&pcity["worklist"].length!=0){var work_list=pcity["worklist"];for(var i=0;i<work_list.length;i++){var work_item=work_list[i];kind=work_item["kind"];value=work_item["value"];if(kind==null||value==null||work_item.length==0)continue;if(kind==VUT_IMPROVEMENT){var pimpr=improvements[value];var build_cost=universal_build_shield_cost(pcity,pimpr);if(pimpr["name"]=="Coinage")build_cost="-";universals_list.push({name:pimpr["name"],kind:kind,value:value,helptext:cleaned_text(pimpr["helptext"]),build_cost:build_cost,sprite:get_improvement_image_sprite(pimpr)})}else if(kind==VUT_UTYPE){var putype=unit_types[value];universals_list.push({name:putype["name"],kind:kind,value:value,helptext:cleaned_text(putype["helptext"]),build_cost:get_universal_discount_price(putype,pcity),sprite:get_unit_type_image_sprite(putype)})}else{console.log("unknown kind: "+kind)}}}var worklist_html="<table class='worklist_table'><tr style='background-color:#0004'><td>Type</td><td>Name</td><td>Cost</td></tr>";for(var j=0;j<universals_list.length;j++){var universal=universals_list[j];var sprite=universal["sprite"];if(sprite==null){console.log("Missing sprite for "+universal[j]["name"]);continue}worklist_html+="<tr class='prod_choice_list_item"+(can_city_build_now(pcity,universal["kind"],universal["value"])?"":" cannot_build_item")+"' data-wlitem='"+j+"' "+' title="'+html_safe(cleaned_text(universal["helptext"]))+'">'+"<td><div class='production_list_item_sub' "+"style=' background: transparent url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;'"+"></div></td>"+"<td class='prod_choice_name'>"+universal["name"]+"</td>"+"<td class='prod_choice_cost'>"+universal["build_cost"]+"</td></tr>"}worklist_html+="</table>";$("#city_current_worklist").html(worklist_html);populate_worklist_production_choices(pcity);$("#show_unreachable_items").off("click");$("#show_unreachable_items").click(function(){opt_show_unreachable_items=!opt_show_unreachable_items;$("#show_unreachable_items").prop("checked",opt_show_unreachable_items);if(production_selection.length!==0){production_selection=[];update_worklist_actions()}populate_worklist_production_choices(pcity)});$("#show_improvements_only").off("click");$("#show_improvements_only").click(function(){opt_show_improvements_only=!opt_show_improvements_only;$("#show_improvements_only").prop("checked",opt_show_improvements_only);if(production_selection.length!==0){production_selection=[];update_worklist_actions()}populate_worklist_production_choices(pcity)});$("#show_unreachable_items").prop("checked",opt_show_unreachable_items);$("#show_improvements_only").prop("checked",opt_show_improvements_only);worklist_dialog_active=true;var turns_to_complete=get_city_production_time(pcity);var prod_type=get_city_production_type_sprite(pcity);var prod_img_html="";if(prod_type!=null){sprite=prod_type["sprite"];prod_img_html="<div style='background: transparent url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float: left; '>"+"</div>"}var headline=prod_img_html+"<div id='prod_descr'>"+(is_small_screen()?"":"<b>")+(prod_type!=null?prod_type["type"]["name"]:"None")+(is_small_screen()?"":"</b>");if(!is_small_screen())headline+=" &nbsp; ("+get_production_progress(pcity)+")";else headline+=" "+get_production_progress(pcity);if(turns_to_complete!=FC_INFINITY&&!is_small_screen()){headline+=", turns: "+turns_to_complete}if(is_small_screen())headline="<span style='font-size:70%;'>"+headline+"</span>";$("#worklist_dialog_headline").html(headline+"</div>");$("#worklist_dialog_headline").css({title:"Click to:\n1.Remove from worklist and move remaining worklist up.\n"+"2. If no worklist below, replace with highlighted selection from right.\n"});$(".production_list_item_sub").tooltip();if(is_touch_device()){$("#prod_buttons").html("<x-small>1st&thinsp;tap:&thinsp;change. Next&thinsp;taps:&thinsp;add. Tap-tap:&thinsp;clear</x-small>")}$(".button").button();var tab_h=$("#city_production_tab").height();$("#city_current_worklist").height(tab_h-150);$("#worklist_production_choices").height(tab_h-121);if(tab_h>250){$("#worklist_control").height(tab_h-148).css("padding-top",73)}else{$("#worklist_control").height(tab_h-77)}var worklist_items=$("#city_current_worklist .prod_choice_list_item");var max_selection=Math.min(MAX_LEN_WORKLIST,worklist_items.length);for(var k=0;k<worklist_selection.length;k++){if(worklist_selection[k]>=max_selection){worklist_selection.splice(k,worklist_selection.length-k);break}worklist_items.eq(worklist_selection[k]).addClass("ui-selected")}if(!touch_device){$("#city_current_worklist .worklist_table").selectable({filter:"tr",selected:handle_current_worklist_select,unselected:handle_current_worklist_unselect})}else{worklist_items.click(handle_current_worklist_click)}worklist_items.dblclick(handle_current_worklist_direct_remove);update_worklist_actions()}function populate_worklist_production_choices(pcity){const gov_id=players[client.conn.playing.playerno].government;var small=is_small_screen();var production_list=generate_production_list();var production_html="<table class='worklist_table'><tr style='background-color:#0004'><td>Type</td><td>Name</td><td style='padding-right:30px; text-align:right'>Info</td><td>Cost</td></tr>";for(var a=0;a<production_list.length;a++){var sprite=production_list[a]["sprite"];if(sprite==null){console.log("Missing sprite for "+production_list[a]["value"]);continue}var kind=production_list[a]["kind"];var value=production_list[a]["value"];if(kind==VUT_UTYPE&&opt_show_improvements_only)continue;var can_build=can_city_build_now(pcity,kind,value);if(can_build&&kind==VUT_IMPROVEMENT){if(improvements[value]["name"]!="Coinage"&&city_has_building_in_queue(pcity,value)){can_build=false}}var can_build_later=false;if(!can_build&&techs[client.conn.playing["researching"]]){if(kind==VUT_IMPROVEMENT){if(improvements[value]["reqs"].length>0&&client.conn.playing["researching"]){if(improvements[value]["reqs"][0]["value"]==techs[client.conn.playing["researching"]]["id"]){if(!city_has_building_in_queue(pcity,value)){if(improvements[value]["reqs"].length>1){var req_type=improvements[value]["reqs"][1]["kind"];if(req_type>3)can_build_later=false;else can_build_later=true}else can_build_later=true}}}}else if(kind==VUT_UTYPE){if(unit_types[value]["tech_requirement"]==techs[client.conn.playing["researching"]]["id"]){if(unit_types[value].gov_requirement<GOV_LAST&&unit_types[value].gov_requirement!=gov_id){can_build_later=false}else can_build_later=true;var class_name=unit_classes[unit_types[value]["unit_class_id"]]["name"].replace("?unitclass:","");if(class_name=="Sea"||class_name=="RiverShip"||class_name=="Submarine"||class_name=="Trireme")can_build_later=false}}}if(!can_build&&kind==VUT_IMPROVEMENT){if(can_city_queue_improvement(pcity,production_list[a]["value"]))can_build_later=true}if(can_build||can_build_later||opt_show_unreachable_items){production_html+="<tr class='prod_choice_list_item kindvalue_item"+(can_build?"":" cannot_build_item")+"' data-value='"+value+"' data-kind='"+kind+"'>"+"<td><div class='production_list_item_sub' title=\""+html_safe(cleaned_text(production_list[a]["helptext"]))+"\" style=' background: transparent url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;'"+"></div></td>"+"<td class='prod_choice_name'>"+production_list[a]["text"]+"</td>";if(kind==VUT_UTYPE){production_html+="<td title='Attack/Defence/Firepower, Hitpoints' class='prod_choice_info' "+"style='padding-right:30px; text-align:right'>"+production_list[a]["unit_details"]+"</td>"+"<td class='prod_choice_cost'>"+get_universal_discount_price(unit_types[value],pcity)+"</td></tr>"}else if(kind==VUT_IMPROVEMENT){production_html+="<td title='Upkeep' class='prod_choice_info' "+"style='padding-right:30px; text-align:right'>"+production_list[a]["unit_details"]+"</td>"+"<td class='prod_choice_cost'>"+production_list[a]["build_cost"]+"</td></tr>"}}}production_html+="</table>";$("#worklist_production_choices").html(production_html);$("#worklist_production_choices .production_list_item_sub").tooltip();$("#worklist_production_choices .prod_choice_info").tooltip();if(!touch_device){$("#worklist_production_choices .worklist_table").selectable({filter:"tr",selected:handle_worklist_select,unselected:handle_worklist_unselect});if(production_selection.length>0){var prod_items=$("#worklist_production_choices .kindvalue_item");var sel=[];production_selection.forEach(function(v){sel.push("[data-value='"+v.value+"']"+"[data-kind='"+v.kind+"']")});prod_items.filter(sel.join(",")).addClass("ui-selected")}$(".kindvalue_item").dblclick(function(e){var value=parseFloat($(this).data("value"));var kind=parseFloat($(this).data("kind"));if(e.ctrlKey||e.metaKey){city_change_production();return}send_city_worklist_add(pcity["id"],kind,value)})}else{$(".kindvalue_item").click(function(){var value=parseFloat($(this).data("value"));var kind=parseFloat($(this).data("kind"));if(city_prod_clicks==0){send_city_change(pcity["id"],kind,value)}else{send_city_worklist_add(pcity["id"],kind,value)}city_prod_clicks+=1})}if(small)$("#info_city_prod").hide();else{$("#info_city_prod").html("&#x2753;");$("#info_city_prod").css("cursor","help");var city_prod_help="CLICK Current Production    Remove\n"+"DOUBLE CLICK Worklist       Remove Item\n"+"ALT CLICK Prod.Choice         Replace Current Production\n"+"SHIFT CLICK Prod.Choice      Add to Worklist\n"+'DOUBLE CLICK Prod.Choice    "     "        "\n'+"CTRL CLICK Items                  Select multiple items\n"+'DOUBLE-TAP DRAG Items         "           "       "\n'+"/\\  UP ARROW                       Flip to City Overview\n"+"\\/  DOWN ARROW                Flip to City Production\n"+"<SPACE>                             Flip Overview/Production\n"+"B     Buy Current Production\n"+"N    Next City\n"+"P     Previous City\n"+"\n"+"Top Left:    Current Production\n"+"Left Side:   Worklist Items\n"+"Right Side: Production Choices";$("#info_city_prod").prop("title",city_prod_help)}}function extract_universal(element){return{value:parseFloat($(element).data("value")),kind:parseFloat($(element).data("kind"))}}function find_universal_in_worklist(universal,worklist){for(var i=0;i<worklist.length;i++){if(worklist[i].kind===universal.kind&&worklist[i].value===universal.value){return i}}return-1}function handle_worklist_select(event,ui){var selected=extract_universal(ui.selected);var idx=find_universal_in_worklist(selected,production_selection);if(idx<0){production_selection.push(selected);update_worklist_actions()}if(event.altKey&&event.shiftKey){city_insert_in_worklist();worklist_selection=[]}else if(event.shiftKey){city_add_to_worklist()}else if(event.altKey){city_change_production()}}function handle_worklist_unselect(event,ui){var selected=extract_universal(ui.unselected);var idx=find_universal_in_worklist(selected,production_selection);if(idx>=0){production_selection.splice(idx,1);update_worklist_actions()}}function handle_current_worklist_select(event,ui){var idx=parseInt($(ui.selected).data("wlitem"),10);var i=worklist_selection.length-1;while(i>=0&&worklist_selection[i]>idx)i--;if(i<0||worklist_selection[i]<idx){worklist_selection.splice(i+1,0,idx);update_worklist_actions()}}function handle_current_worklist_unselect(event,ui){var idx=parseInt($(ui.unselected).data("wlitem"),10);var i=worklist_selection.length-1;while(i>=0&&worklist_selection[i]>idx)i--;if(i>=0&&worklist_selection[i]===idx){worklist_selection.splice(i,1);update_worklist_actions()}}function handle_current_worklist_click(event){event.stopPropagation();var element=$(this);var item=parseInt(element.data("wlitem"),10);if(worklist_selection.length===1&&worklist_selection[0]===item){element.removeClass("ui-selected");worklist_selection=[]}else{element.siblings().removeClass("ui-selected");element.addClass("ui-selected");worklist_selection=[item]}update_worklist_actions()}function update_worklist_actions(){if(worklist_selection.length>0){$("#city_worklist_up_btn").button("enable");$("#city_worklist_remove_btn").button("enable");if(worklist_selection[worklist_selection.length-1]===active_city["worklist"].length-1){$("#city_worklist_down_btn").button("disable")}else{$("#city_worklist_down_btn").button("enable")}}else{$("#city_worklist_up_btn").button("disable");$("#city_worklist_down_btn").button("disable");$("#city_worklist_exchange_btn").button("disable");$("#city_worklist_remove_btn").button("disable")}if(production_selection.length>0){$("#prod_buttons").show();$("#city_add_to_worklist_btn").button("enable");$("#city_worklist_insert_btn").button("enable");$("#city_worklist_append_btn").button("enable");if(production_selection.length==1)$("#city_worklist_change_btn").button("enable");else $("#city_worklist_change_btn").button("disable");if(production_selection.length==worklist_selection.length||worklist_selection.length==1){$("#city_worklist_exchange_btn").button("enable")}else{$("#city_worklist_exchange_btn").button("disable")}}else{$("#prod_buttons").hide();$("#city_add_to_worklist_btn").button("disable");$("#city_worklist_insert_btn").button("disable");$("#city_worklist_change_btn").button("disable");$("#city_worklist_append_btn").button("disable");$("#city_worklist_exchange_btn").button("disable")}if(production_selection.length===1){$("#city_change_production_btn").button("enable")}else{$("#city_change_production_btn").button("disable")}}function send_city_worklist(city_id){if(cities[city_id]==null)return;var worklist=cities[city_id]["worklist"];var overflow=worklist.length-MAX_LEN_WORKLIST;if(overflow>0){worklist.splice(MAX_LEN_WORKLIST,overflow)}send_request(JSON.stringify({pid:packet_city_worklist,city_id:city_id,worklist:worklist}))}function send_city_worklist_add(city_id,kind,value){var pcity=cities[city_id];if(pcity["worklist"].length>=MAX_LEN_WORKLIST){return}pcity["worklist"].push({kind:kind,value:value});send_city_worklist(city_id)}function city_change_production(){if(production_selection.length===1){send_city_change(active_city["id"],production_selection[0].kind,production_selection[0].value);unselect_improvements()}set_mass_prod_city(active_city["id"]);save_city_checkbox_states();retain_checkboxes_on_update=true}function city_add_to_worklist(){if(production_selection.length>0){active_city["worklist"]=active_city["worklist"].concat(production_selection);send_city_worklist(active_city["id"]);unselect_improvements()}}function unselect_improvements(){production_selection=production_selection.filter(function(element,index,arr){if(arr[index].kind==VUT_UTYPE)return element;if(arr[index].kind==VUT_IMPROVEMENT&&improvements[arr[index].value]["name"]=="Coinage")return element})}function city_add_improv_to_worklist(city_id,z){send_city_worklist_add(city_id,3,z);swal("Sent order to add "+improvements[z]["name"]+" to Worklist in "+cities[city_id]["name"]);setSwalTheme();active_superpanel_cityid=city_id}function city_remove_current_prod(){var wl=active_city["worklist"];if(wl.length>0){var next_item=wl[0];send_city_change(active_city["id"],next_item.kind,next_item.value);wl.splice(worklist_selection[0],1);send_city_worklist(active_city["id"])}else{}}function handle_current_worklist_direct_remove(){var idx=parseInt($(this).data("wlitem"),10);active_city["worklist"].splice(idx,1);var i=worklist_selection.length-1;while(i>=0&&worklist_selection[i]>idx){worklist_selection[i]--;i--}if(i>=0&&worklist_selection[i]===idx){worklist_selection.splice(i,1)}send_city_worklist(active_city["id"])}function city_insert_in_worklist(){var count=Math.min(production_selection.length,MAX_LEN_WORKLIST);if(count===0)return;var i;var wl=active_city["worklist"];if(worklist_selection.length===0){wl.splice.apply(wl,[0,0].concat(production_selection));for(i=0;i<count;i++){worklist_selection.push(i)}}else{wl.splice.apply(wl,[worklist_selection[0],0].concat(production_selection));for(i=0;i<worklist_selection.length;i++){worklist_selection[i]+=count}}send_city_worklist(active_city["id"]);unselect_improvements()}function city_worklist_task_up(){var count=worklist_selection.length;if(count===0)return;var swap;var wl=active_city["worklist"];if(worklist_selection[0]===0){worklist_selection.shift();if(wl[0].kind!==active_city["production_kind"]||wl[0].value!==active_city["production_value"]){swap=wl[0];wl[0]={kind:active_city["production_kind"],value:active_city["production_value"]};send_city_change(active_city["id"],swap.kind,swap.value)}count--}for(var i=0;i<count;i++){var task_idx=worklist_selection[i];swap=wl[task_idx-1];wl[task_idx-1]=wl[task_idx];wl[task_idx]=swap;worklist_selection[i]--}send_city_worklist(active_city["id"])}function city_worklist_task_down(){var count=worklist_selection.length;if(count===0)return;var swap;var wl=active_city["worklist"];if(worklist_selection[--count]===wl.length-1)return;while(count>=0){var task_idx=worklist_selection[count];swap=wl[task_idx+1];wl[task_idx+1]=wl[task_idx];wl[task_idx]=swap;worklist_selection[count]++;count--}send_city_worklist(active_city["id"])}function city_exchange_worklist_task(){var prod_l=production_selection.length;if(prod_l===0)return;var i;var same=true;var wl=active_city["worklist"];var task_l=worklist_selection.length;if(prod_l===task_l){for(i=0;i<prod_l;i++){if(same&&wl[worklist_selection[i]]!=null&&(wl[worklist_selection[i]].kind!==production_selection[i].kind||wl[worklist_selection[i]].value!==production_selection[i].value)){same=false}wl[worklist_selection[i]]=production_selection[i]}}else if(task_l===1){i=worklist_selection[0];wl.splice.apply(wl,[i,1].concat(production_selection));same=false;while(--prod_l){worklist_selection.push(++i)}}if(!same){send_city_worklist(active_city["id"])}unselect_improvements()}function city_worklist_task_remove(){var count=worklist_selection.length;if(count===0)return;var wl=active_city["worklist"];while(--count>=0){wl.splice(worklist_selection[count],1)}worklist_selection=[];send_city_worklist(active_city["id"])}function show_city_improvement_pane(city_id){var pcity=cities[city_id];var improvements_html="";var opacity=1;var border="";var mag_factor=($(window).width()-519)/2470;var magnification="transform:scale("+mag_factor+"); transform-origin: top left;";var bg="background:#335 ";var title_text="";var right_click_action="oncontextmenu='city_sell_improvement_in("+city_id+","+z+");' ";var shift_click_text="\n\nSHIFT-CLICK: Highlight ON/OFF cities with this building.\n\nCTRL-CLICK: &#x2611; select ON/OFF cities with this building.' ";for(var z=0;z<ruleset_control.num_impr_types;z++){if(pcity["improvements"]!=null&&improvements[z].genus==GENUS_IMPROVEMENT){sprite=get_improvement_image_sprite(improvements[z]);if(sprite==null){continue}if(improvements[z]["obs_count"]>0){if(player_invention_state(client.conn.playing,improvements[z]["obs_reqs"][0]["value"])==TECH_KNOWN){continue}}if(improvements[z]["reqs"].length>0){if(player_invention_state(client.conn.playing,improvements[z]["reqs"][0]["value"])==TECH_UNKNOWN){continue}}if(!server_settings["nukes_major"]["val"]&&improvements[z]["name"]=="Enrichment Facility")continue;var product_finished=false;var verb=" is making ";var is_city_making=pcity["production_kind"]==VUT_IMPROVEMENT&&pcity["production_value"]==z;if(is_city_making){var shields_invested=pcity["shield_stock"];if(shields_invested>=universal_build_shield_cost(pcity,improvements[z])){product_finished=true;var verb=" is finishing "}}if(pcity["improvements"].isSet(z)){opacity=1;border="border:3px solid #000000;";bg="background:#FEED ";title_text="title='"+html_safe(pcity["name"])+":\n\nRIGHT-CLICK: Sell "+html_safe(improvements[z]["name"])+"."+shift_click_text;right_click_action="oncontextmenu='city_sell_improvement_in("+city_id+","+z+");' "}else{if(!can_city_build_improvement_now(pcity,z)){opacity=.35;border="border:3px solid #231A13;";bg="background:#9873 ";title_text="title='"+html_safe(pcity["name"])+": "+html_safe(improvements[z]["name"])+" unavailable.\n\nRIGHT-CLICK: Add to worklist."+shift_click_text;right_click_action="oncontextmenu='city_add_improv_to_worklist("+city_id+","+z+");' "}else{opacity=1;border=is_city_making?product_finished?"border:3px solid #308000;":"border:3px solid #80E0FF;":"border:3px solid #000000;";bg=is_city_making?product_finished?"background:#BFBE ":"background:#8D87 ":"background:#147F ";right_click_action="oncontextmenu='city_change_prod_and_buy(null,"+city_id+","+z+");' ";title_text=is_city_making?"title='"+html_safe(pcity["name"])+verb+html_safe(improvements[z]["name"])+".\n\nRIGHT_CLICK: Buy "+html_safe(improvements[z]["name"])+shift_click_text:"title='"+html_safe(pcity["name"])+":\n\nCLICK: Change production\n\nRIGHT-CLICK: Buy "+html_safe(improvements[z]["name"])+shift_click_text}}improvements_html=improvements_html+"<div style='padding:0px; opacity:"+opacity+"; "+"' id='city_improvement_element' class='cip'><span style='padding:0px; margin:0px; "+border+" "+bg+" url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float:left;"+magnification+"' "+title_text+right_click_action+"onclick='change_city_prod_to(event,"+city_id+","+z+");'>"+"</span></div>"}}$("#city_improvements_hover_list").html(improvements_html);$(".cip").width(mag_factor*64);$(".cip").height(mag_factor*48)}function city_change_prod_and_buy(event,city_id,z){change_city_prod_to(null,city_id,z);setTimeout(function(){request_city_id_buy(city_id)},300);active_superpanel_dialog_refresh_delay=true;active_superpanel_cityid=city_id}function city_filter_prod_type(event,city_id){var kind=null,z=null;pcity=cities[city_id];if(pcity==null)return;kind=pcity["production_kind"];z=pcity["production_value"];if(event.shiftKey){highlight_rows_by_output(kind,z,false)}else if(event.ctrlKey){select_rows_by_output(kind,z,false)}else city_change_prod(city_id)}function change_city_prod_to(event,city_id,z){if(event){if(event.shiftKey){highlight_rows_by_improvement(z,false);return}else if(event.ctrlKey){select_rows_by_improvement(z,false);return}}var pcity=cities[city_id];send_city_change(pcity["id"],VUT_IMPROVEMENT,z);set_mass_prod_city(pcity["id"]);save_city_checkbox_states();retain_checkboxes_on_update=true;active_superpanel_dialog_refresh_delay=true;active_superpanel_cityid=city_id}function highlight_rows_by_output(kind,z,clear){for(var city_id in cities){var pcity=cities[city_id];if(client.conn.playing!=null&&city_owner(pcity)!=null&&city_owner(pcity).playerno==client.conn.playing.playerno){if(clear||kind==pcity["production_kind"]&&z==pcity["production_value"]){if(clear||$("#cities_list_"+city_id).css("background-color")=="rgb(0, 0, 255)"){$("#cities_list_"+city_id).css({"background-color":"rgba(0, 0, 0, 0)"})}else $("#cities_list_"+city_id).css({"background-color":"rgb(0, 0, 255)"})}}}}function select_rows_by_output(kind,z,clear){for(var city_id in cities){var pcity=cities[city_id];if(client.conn.playing!=null&&city_owner(pcity)!=null&&city_owner(pcity).playerno==client.conn.playing.playerno){if(clear||kind==pcity["production_kind"]&&z==pcity["production_value"]){if(clear||$("#cb"+city_id).prop("checked")==true){$("#cb"+city_id).prop("checked",false)}else $("#cb"+city_id).prop("checked",true)}}}}function highlight_rows_by_improvement(z,clear){for(var city_id in cities){var pcity=cities[city_id];if(client.conn.playing!=null&&city_owner(pcity)!=null&&city_owner(pcity).playerno==client.conn.playing.playerno){if(clear||city_has_building(pcity,z)){if(clear||$("#cities_list_"+city_id).css("background-color")=="rgb(0, 0, 255)"){$("#cities_list_"+city_id).css({"background-color":"rgba(0, 0, 0, 0)"})}else $("#cities_list_"+city_id).css({"background-color":"rgb(0, 0, 255)"})}}}}function select_rows_by_improvement(z,clear){for(var city_id in cities){var pcity=cities[city_id];if(client.conn.playing!=null&&city_owner(pcity)!=null&&city_owner(pcity).playerno==client.conn.playing.playerno){if(clear||city_has_building(pcity,z)){if(clear||$("#cb"+city_id).prop("checked")==true){$("#cb"+city_id).prop("checked",false)}else $("#cb"+city_id).prop("checked",true)}}}}function update_city_screen(){if(observing||freeze)return;$("#cities_scroll").css("width","100%");var wide_screen=$(window).width()<1340?false:true;var narrow_screen=$(window).width()<1e3?true:false;var small_screen=is_small_screen();var landscape_screen=$(window).width()>$(window).height()?true:false;var tiny_screen=false;var redux_screen=false;if(small_screen||narrow_screen&&!scroll_narrow_x){if(scroll_narrow_x){tiny_screen=true;redux_screen=true;wide_screen=false;if(scroll_narrow_x&&narrow_screen&&!landscape_screen)$("#cities_scroll").css("width","110%")}else{tiny_screen=true;redux_screen=false;wide_screen=false}}else if(!wide_screen){if(narrow_screen){redux_screen=true;tiny_screen=true;wide_screen=false}else{redux_screen=true;tiny_screen=false;wide_screen=false}}var sortList=[];var headers=$("#city_table thead th");headers.filter(".tablesorter-headerAsc").each(function(i,cell){sortList.push([cell.cellIndex,0])});headers.filter(".tablesorter-headerDesc").each(function(i,cell){sortList.push([cell.cellIndex,1])});var citizen_types=["unhappy","content","happy"];var sprite;var city_list_citizen_html="";var updown_sort_arrows="<img class='lowered_gov' src='data:image/gif;base64,R0lGODlhFQAJAIAAAP///////yH5BAEAAAEALAAAAAAVAAkAAAIXjI+AywnaYnhUMoqt3gZXPmVg94yJVQAAOw=='>";var prod_sprite;var prod_img_html;for(var i=0;i<3;i++){sprite=get_specialist_image_sprite("citizen."+citizen_types[i]+"_1");city_list_citizen_html="<th id='city_list_citizen_"+citizen_types[i]+"' class='' style='padding-right:0px; margin-right:-3px;' title=''><div style='float:right; background: transparent url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;'></div></th>"+city_list_citizen_html}var city_list_html="";if(wide_screen){city_list_html="<table class='tablesorter-dark' id='city_table' style='border=0px;border-spacing=0;padding=0;'>"+"<thead id='city_table_head'><tr>"+"<th style='text-align:right;'>Name"+updown_sort_arrows+"</th><th style='text-align:right;'>Size"+updown_sort_arrows+"</th>"+city_list_citizen_html+"<th style='text-align:right;' title='Text: Current state. Color: Next turn state'>State<img class='lowered_gov' src='data:image/gif;base64,R0lGODlhFQAJAIAAAP///////yH5BAEAAAEALAAAAAAVAAkAAAIXjI+AywnaYnhUMoqt3gZXPmVg94yJVQAAOw=='></img> </th>"+"<th id='food' title='Food surplus' class='food_text' style='text-align:right;padding-right:0px'><img style='margin-right:-6px; margin-top:-3px;' class='lowered_gov' src='/images/wheat.png'></th>"+"<th title='Production surplus (shields)' class='prod_text' style='text-align:right;padding-right:0px'> <img class='lowered_gov' src='/images/shield14x18.png'></th>"+"<th title='Trade' class='trade_text' style='text-align:right;padding-right:0px;'><img class='lowered_gov' src='/images/trade.png'></th>"+"<th title='"+CURV_title[city_user_row_val]+"' class='non_priority' style='text-align:right;padding-left:0px;padding-right:30px;'><img class='lowered_gov' src='"+CURV_icons[city_user_row_val]+"'></th>"+"<th title='Gold' class='gold_text' style='text-align:right;padding-right:0px;'><img class='lowered_gov' src='/images/gold.png'></th>"+"<th title='Luxury' class='lux_text' style='text-align:right;padding-right:0px'><img class='lowered_gov' src='/images/luxury2.png'></th>"+"<th title='Science (bulbs)' class='sci_text' style='text-align:right'><img class='lowered_gov' src='/images/sci.png'></th>"+"<th style='text-align:right;'>Grows In"+updown_sort_arrows+"</th><th style='text-align:right;'>Granary"+updown_sort_arrows+"</th><th style='text-align:right;' title='Click to change'>Producing"+updown_sort_arrows+"</th>"+"<th style='text-align:right;' title='Turns to finish &nbsp;&nbsp; Prod completed/needed'>Turns"+updown_sort_arrows+"&nbsp; Progress</th><th style='text-align:right;' title='Click to buy'>Cost"+updown_sort_arrows+"</th>"+"<th style='text-align:left;'><input type='checkbox' class='css-checkbox' id='master_checkbox' title='CLICK:  Toggle all cities\n\nSHIFT-CLICK:  Toggle highlighted cities' name='cbAll' value='false' onclick='toggle_city_row_selections(event);'>"+"<label title='CLICK:  Toggle all cities\n\nSHIFT-CLICK:  Toggle highlighted cities' for='master_checkbox' name='master_checkbox_lbl' class='css-label dark-check-white'></label></th>"+"</tr></thead><tbody class='alternate-row-color'>"}else if(redux_screen){city_list_html="<table class='tablesorter-dark' id='city_table' style='border=0px;border-spacing=0;padding=0;'>"+"<thead id='city_table_head'><tr>"+"<th style='text-align:right;'>Name"+"</th><th style='text-align:center;'>Pop"+"</th>"+city_list_citizen_html+"<th style='text-align:center;' title='Text: Current state. Color: Next turn state'>Mood</th>"+"<th id='food' title='Food surplus' class='food_text' style='text-align:right;padding-right:0px'><img style='margin-right:-6px; margin-top:-3px;' class='lowered_gov' src='/images/wheat.png'></th>"+"<th title='Production surplus (shields)' class='prod_text' style='text-align:right;padding-right:0px'> <img class='lowered_gov' src='/images/shield14x18.png'></th>"+"<th title='Trade' class='trade_text' style='text-align:right;padding-right:0px;'><img class='lowered_gov' src='/images/trade.png'></th>"+"<th>&nbsp;&nbsp;&nbsp;&nbsp;</th>"+"<th title='Gold' class='gold_text' style='text-align:right;padding-right:0px;'><img class='lowered_gov' src='/images/gold.png'></th>"+"<th title='Luxury' class='lux_text' style='text-align:right;padding-right:0px'><img class='lowered_gov' src='/images/luxury2.png'></th>"+"<th title='Science (bulbs)' class='sci_text' style='text-align:right'><img class='lowered_gov' src='/images/sci.png'></th>"+(!tiny_screen?"<th style='text-align:right;'>Grows"+"</th><th style='text-align:right;'>Grain":"<th style='text-align:center;'>Grow"+"</th><th style='text-align:right;'>Food")+(!tiny_screen?"</th><th style='text-align:right;' title='Click to change'>Making"+"</th>":"</th><th style='text-align:right;'>Build"+"</th>")+"<th style='text-align:right;' title='Turns to finish &nbsp;&nbsp; Prod completed/needed'>"+(!tiny_screen?"Progress</th><th style='padding-right:1em; text-align:right;' title='Click to buy'>Cost"+"</th>":"in</th><th style='padding-right:1em; text-align:right;'>Cost"+"</th>")+(!tiny_screen?"<th style='text-align:left;'><input type='checkbox' class='css_checkbox' id='master_checkbox' title='CLICK:  Toggle all cities\n\nSHIFT-CLICK:  Toggle highlighted cities' name='cbAll' value='false' onclick='toggle_city_row_selections(event);'></th>":"")+"</tr></thead><tbody>"}else{city_list_html="<table class='tablesorter-dark' id='city_table' style='border=0px;border-spacing=0;padding=0;'>"+"<thead id='city_table_head'><tr>"+"<th style='text-align:right;'>Name"+"</th><th style='text-align:center;'>Pop"+"</th>"+city_list_citizen_html+"<th style='text-align:center;' title='Text: Current state. Color: Next turn state'>Mood</th>"+"<th id='food' title='Food surplus' class='food_text' style='text-align:right;padding-right:0px'><img style='margin-right:-6px; margin-top:-3px;' class='lowered_gov' src='/images/wheat.png'></th>"+"<th title='Production surplus (shields)' class='prod_text' style='text-align:right;padding-right:0px'> <img class='lowered_gov' src='/images/shield14x18.png'></th>"+"<th title='Trade' class='trade_text' style='text-align:right;padding-right:0px;'><img class='lowered_gov' src='/images/trade.png'></th>"+"<th>&nbsp;&nbsp;&nbsp;</th>"+"<th title='Gold' class='gold_text' style='text-align:right;padding-right:0px;'><img class='lowered_gov' src='/images/gold.png'></th>"+"<th title='Luxury' class='lux_text' style='text-align:right;padding-right:0px'><img class='lowered_gov' src='/images/luxury2.png'></th>"+"<th title='Science (bulbs)' class='sci_text' style='text-align:right'><img class='lowered_gov' src='/images/sci.png'></th>"+"<th style='text-align:center;'>Grow"+"</th><th style='text-align:right;'>Food"+"</th><th style='text-align:right;' title='Click to change'>Build"+"</th>"+"<th style='text-align:right;' title='Turns to finish &nbsp;&nbsp; Prod completed/needed'>in</th>"+"</tr></thead><tbody>"}var count=0;var happy_people,content_people,unhappy_angry_people;var city_name;var city_food,city_prod,city_trade;var city_gold,city_lux,city_sci;var city_user="";var city_growth,city_food_stock;var city_granary_size,city_buy_cost;var city_state;var shield_cost;var adjust_oversize="";for(var city_id in cities){var pcity=cities[city_id];var td_hover_html=wide_screen?"<td class='tdc1' style='padding-right:1em; text-align:right;' onmouseover='show_city_improvement_pane("+pcity["id"]+");' onclick='javascript:show_city_dialog_by_id("+pcity["id"]+");'>":"<td class='tdc1' style='padding-right:1em; text-align:right;' onclick='javascript:show_city_dialog_by_id("+pcity["id"]+");'>";var td_click_html="<td class='tdc1' style='padding-right:1em; text-align:right;' onclick='javascript:show_city_dialog_by_id("+pcity["id"]+");'>";var td_click2_html="<td class='tdc2' style='text-align:right;' onclick='javascript:show_city_dialog_by_id("+pcity["id"]+");'>";var td_buy_html="<td style='padding-right:1em; text-align:right;' onclick='javascript:request_city_id_buy("+pcity["id"]+");'>";var td_change_prod_html="<td title='Click to change' style='text-align:right;' onclick='javascript:city_filter_prod_type(event,"+pcity["id"]+");'>";if(client.conn.playing!=null&&city_owner(pcity)!=null&&city_owner(pcity).playerno==client.conn.playing.playerno){count++;var prod_type=get_city_production_type(pcity);var turns_to_complete_str;var progress_string;var city_size_string="";if(wide_screen)city_size_string="<span class='mobile_centre non_priority'>"+pcity["size"]+"</span>";else city_size_string="<span class='mobile_centre redux_centre non_priority'>"+pcity["size"]+"</span>";turns_to_complete=get_city_production_time(pcity);if(get_city_production_time(pcity)==FC_INFINITY){turns_to_complete_str="<span class='non_priority'>&nbsp;&nbsp; </span>"}else{if(wide_screen)turns_to_complete_str="<span class='non_priority'>"+turns_to_complete+"</span>";else turns_to_complete_str="<span class='non_priority'>"+turns_to_complete+"</span>";if(turns_to_complete==1)turns_to_complete_str=wide_screen?"<span style='font-size:1%; color:rgba(0,0,0,0);'>0</span>"+"<b>next</b>":"<span style='font-size:1%; color:rgba(0,0,0,0);'>0</span>"+"<b>1</b>"}var purchase;var shields_invested=pcity["shield_stock"];if(pcity["production_kind"]==VUT_UTYPE){purchase=unit_types[pcity["production_value"]]}else if(pcity["production_kind"]==VUT_IMPROVEMENT){purchase=improvements[pcity["production_value"]]}if(purchase["name"]=="Coinage")progress_string=" ";else{shields_invested=shields_invested.toString();if(shields_invested.length<3)shields_invested="&nbsp;&nbsp;".repeat(3-shields_invested.length)+shields_invested;progress_string=shields_invested+"<span class='contrast_text'>/</span>";shield_cost=universal_build_shield_cost(pcity,purchase).toString();if(shield_cost.length<3)shield_cost="&nbsp;&nbsp;".repeat(3-shield_cost.length)+shield_cost;progress_string="<span class='non_priority'>"+progress_string+shield_cost+"</span>"}happy_people=pcity["ppl_happy"][FEELING_FINAL];content_people=pcity["ppl_content"][FEELING_FINAL];unhappy_angry_people=pcity["ppl_unhappy"][FEELING_FINAL]+pcity["ppl_angry"][FEELING_FINAL];city_state=get_city_state(pcity);if(tiny_screen){switch(city_state){case"Peace":city_state="&#x262E;";break;case"Disorder":city_state="&#x270A;";break;case"Celebrating":city_state="&#x1F388;";break}}city_state+="</span>";if(happy_people>=pcity["size"]*.4999&&unhappy_angry_people==0&&pcity["size"]>2)city_state="<span class='redux_centre mobile_centre hint_of_green' style='text-align:center;'>"+city_state;else if(unhappy_angry_people>happy_people)city_state="<span class='redux_centre mobile_centre negative_text' style='text-align:center;'>"+city_state;else city_state="<span class='redux_centre mobile_centre non_priority' style='text-align:center;'>"+city_state;happy_people="<span class='hint_of_green'>"+happy_people+"</span>";content_people="<span class='hint_of_blue'>"+content_people+"</span>";unhappy_angry_people="<span class='hint_of_orange'>"+unhappy_angry_people+"</span>";var food_check=pcity["surplus"][O_FOOD];if(food_check>0){city_food="<td style='text-align:right;' class='food_text' onclick='javascript:show_city_dialog_by_id("+pcity["id"]+");'>"+"<span class='food_text'>"+pcity["surplus"][O_FOOD]+"</span>"+"</td>"}else if(food_check==0){city_food="<td style='text-align:right;' class='food_text' onclick='javascript:show_city_dialog_by_id("+pcity["id"]+");'>"+" "+"</td>"}else if(food_check<0){city_food="<td style='text-align:right;' class='negative_food_text' onclick='javascript:show_city_dialog_by_id("+pcity["id"]+");'>"+"<span class='negative_food_text'>"+pcity["surplus"][O_FOOD]+"</span>"+"</td>"}city_prod="<td style='text-align:right;' class='prod_text' onclick='javascript:show_city_dialog_by_id("+pcity["id"]+");'>"+"<span class='prod_text'>"+pcity["surplus"][O_SHIELD]+"</span>"+"</td>";city_trade="<td style='text-align:right;' class='trade_text' onclick='javascript:show_city_dialog_by_id("+pcity["id"]+");'>"+"<span class='trade_text'>"+pcity["surplus"][O_TRADE]+"</span>"+"</td>";city_gold="<td style='text-align:right;' class='gold_text' onclick='javascript:show_city_dialog_by_id("+pcity["id"]+");'>"+"<span class='gold_text'>"+pcity["prod"][O_GOLD]+"</span>"+"</td>";city_lux="<td style='text-align:right;' class='lux_text' onclick='javascript:show_city_dialog_by_id("+pcity["id"]+");'>"+"<span class='lux_text'>"+pcity["prod"][O_LUXURY]+"</span>"+"</td>";city_sci="<td style='text-align:right;' class='sci_text' onclick='javascript:show_city_dialog_by_id("+pcity["id"]+");'>"+"<span class='sci_text'>"+pcity["prod"][O_SCIENCE]+"</span>"+"</td>";switch(city_user_row_val){case CURV_CORRUPTION:city_user="<td class='non_priority' style='text-align:right; padding-right:32px' onclick='javascript:change_city_user_row("+pcity["id"]+");'>"+"<span style='color:#d65'>"+(pcity["waste"][O_TRADE]<1?" ":pcity["waste"][O_TRADE])+"</span>"+"</td>";break;case CURV_POLLUTION:city_user="<td class='non_priority' style='text-align:right; padding-right:32px' onclick='javascript:change_city_user_row("+pcity["id"]+");'>"+"<span style='color:#A73'>"+(pcity["pollution"]<1?" ":pcity["pollution"])+"</span>"+"</td>";break;case CURV_TRADE_REVENUE:const rev=get_city_traderoute_revenue(pcity["id"]);city_user="<td class='non_priority' style='text-align:right; padding-right:32px' onclick='javascript:change_city_user_row("+pcity["id"]+");'>"+"<span style='color:#fdff7d;'>"+(rev<1?" ":rev)+"</span>"+"</td>";break;case CURV_GOLD_PER_SHIELD:const gcps=get_gold_cost_per_shield(pcity);city_user="<td class='non_priority' style='text-align:right; padding-right:32px' onclick='javascript:change_city_user_row("+pcity["id"]+");'>"+"<span style='color:#fdff7d;'>"+(gcps=="No"?" ":gcps)+"</span>"+"</td>";break;case CURV_TURN_FOUNDED:city_user="<td class='non_priority' style='text-align:right; padding-right:32px' onclick='javascript:change_city_user_row("+pcity["id"]+");'>"+"<span style='color:#999'>"+pcity["turn_founded"]+"</span>"+"</td>";break;case CURV_FOREIGNERS:city_user="<td class='non_priority' style='text-align:right; padding-right:32px' onclick='javascript:change_city_user_row("+pcity["id"]+");'>"+"<span style='color:#F92'>"+(pcity["nationalities_count"]<2?" ":pcity["size"]-pcity["nation_citizens"][0]+"</span>"+"</td>");break;default:city_user="<td class='non_priority' style='text-align:right; padding-right:32px' onclick='javascript:change_city_user_row("+pcity["id"]+");'>"+"<span style='color:#ffff'>0</span></td>"}if(tiny_screen){city_growth=pcity["granary_turns"];if(city_growth>1e3)city_growth=" ";else if(city_growth!=1&&city_growth!=-1)city_growth="<span class='mobile_centre non_priority'>"+city_growth+"</span>";else city_growth="<span class='mobile_centre'>"+city_growth+"</span>"}else{city_growth=city_turns_to_growth_text(pcity);if(city_growth.startsWith("<b>")){}else{city_growth="<span class='non_priority'>"+city_growth+"</span>"}}if(!wide_screen){city_food_stock="<span class='non_priority'>"+pcity["food_stock"]+"</span>";city_granary_size="<span class='non_priority'>"+pcity["granary_size"]+"</span>"}else{city_food_stock="<span class='non_priority'>"+pcity["food_stock"]+"</span>";city_granary_size=pcity["granary_size"].toString();if(city_granary_size.length<3)city_granary_size="&nbsp;&nbsp;".repeat(3-city_granary_size.length)+city_granary_size;city_granary_size="<span class='non_priority'>"+city_granary_size+"</span>"}if(pcity["buy_cost"]==0){city_buy_cost=" "}else if(wide_screen){city_buy_cost="<u>"+pcity["buy_cost"]+"</u>";city_buy_cost="<div title='Click to buy' style='padding-right:10px;'>"+city_buy_cost+"</div>"}else{city_buy_cost="<u>"+pcity["buy_cost"]+"</u>";city_buy_cost="<div style='text-align:right; title='Click to buy' style='padding-right:1em;'>"+city_buy_cost+"</div>"}prod_sprite=get_city_production_type_sprite(pcity);prod_img_html="";if(prod_sprite!=null){sprite=prod_sprite["sprite"];adjust_oversize=sprite["width"]>64?"margin-right:-20px;":"";prod_img_html="<div class='prod_img' oncontextmenu='set_mass_prod_city("+pcity["id"]+");' "+"title='RIGHT-CLICK:  Set mass-selection target\n\nSHIFT-CLICK:  Highlight ON/OFF cities making this item\n\n"+"CTRL-CLICK:   Select ON/OFF cities making this item' "+"style='max-height:24px; float:right; padding-left:0px padding-right:0px; content-align:right; margin-top:-14px;"+adjust_oversize+"'>"+"<div style='float:right; content-align:right;"+"background: transparent url("+sprite["image-src"]+");transform: scale(0.625); background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;"+" content-align: right;"+"vertical-align:top; float:right;'>"+"</div></div>"}city_name="";if(is_capital(pcity))city_name+="<span title='Capital' style='color:cyan'>&#9733; </span>";if(city_has_building(pcity,improvement_id_by_name(B_ECC_PALACE_NAME)))city_name+="<span title='Ecclesiastic Capital' style='color:yellow'>&#x2CE9; </span>";city_name+=tiny_screen&&pcity["name"].length>11?pcity["name"].substring(0,10)+"<span style='font-size:66%;'>&#x22ef;</span></td>":pcity["name"]+(pcity.cma_enabled?"<span title='Governor controlled'> &#x1F539;</span>":"")+"</td>";city_list_html+="<tr class='cities_row' id='cities_list_"+pcity["id"]+"'>"+td_hover_html+city_name+"</td>"+td_click_html+city_size_string+"</td>"+td_click2_html+happy_people+"</td>"+td_click2_html+content_people+"</td>"+td_click2_html+unhappy_angry_people+"</td>"+td_click_html+city_state+"</td>"+city_food+city_prod+city_trade+(wide_screen?city_user:td_click_html+"</td>")+city_gold+city_lux+city_sci+td_click_html+city_growth+"</td>"+td_click_html+city_food_stock+"<span class='contrast_text'>/</span>"+city_granary_size+"</td>"+td_change_prod_html+(wide_screen?"&nbsp;&nbsp;<u>"+prod_type["name"]+"</u> "+prod_img_html+"</td>":"<span style='font-size:1%; color: rgba(0, 0, 0, 0);'>"+prod_type["name"].charAt(0)+"</span>"+prod_img_html+"</td>")+td_click_html+(wide_screen?turns_to_complete_str+" &nbsp;&nbsp;&nbsp;&nbsp; "+progress_string+"</td>":redux_screen&&!tiny_screen?"("+turns_to_complete_str+") "+progress_string+"</td>":turns_to_complete_str.replace("turns","")+"</td>")+(wide_screen||redux_screen?td_buy_html+city_buy_cost+"</td>":"")+(!tiny_screen?"<td style='text-align:left;'><input type='checkbox' class='css-checkbox' oncontextmenu='set_mass_prod_city("+pcity["id"]+");' id='cb"+pcity["id"]+"' value=''><label for='cb"+pcity["id"]+"' name='cb_lbl"+pcity["id"]+"' class='css-label dark-check-cyan'></label></td>":"");city_list_html+="</tr>"}}var title_text="<span id='cities_title_cma_panel' style='text-align:left; float:left; padding-right:10px;'>Your Cities ("+count+")</span>";if(!is_small_screen()){title_text+=" <span id='city_improvements_hover_list'></span>"+" <span id='mass_production'></span>"+" <button title='Change production in selected cities' class='button ui-button ui-corner-all ui-widget' style='padding:5px; margin:4px; font-size:70%; float:right;' onclick='mass_change_prod();'>Change &#x2611; to:</button>"+" <button title='BUY in selected cities' class='button ui-button ui-corner-all ui-widget' style='padding:5px; margin:4px; font-size:70%; float:right;' onclick='request_buy_all_selected_cities();'>&#x2611; Buy selected</button>"}else $("#cities_title").css({"font-size":"100%"});$("#cities_title").html(title_text);if(power_cma==true){var power_panel="<button title='Click: Refresh tile arrangement in selected cities.\nCTRL-Click: Save Governor Clipboard to selected cities.\nShift-Click: Use Governor Clipboard to arrange tiles, without saving.' class='button ui-button ui-corner-all ui-widget' style='padding:1px; margin:1px; font-size:100%; float:left;' onclick='cma_clipboard_macro(event,false);'>&#x1F4CB; "+count+" Cities</button>";$("#cities_title_cma_panel").html(power_panel)}city_list_html+="</tbody></table>";$("#cities_list").html(city_list_html);$("#city_list_citizen_unhappy").tooltip({content:"Unhappy + angry citizens",position:{my:"center bottom",at:"center top+10"}});$("#city_list_citizen_content").tooltip({content:"Content citizens",position:{my:"center bottom",at:"center top+10"}});$("#city_list_citizen_happy").tooltip({content:"Happy citizens",position:{my:"center bottom",at:"center top+10"}});if(count==0){$("#city_table").html("You have no cities. Build new cities with the Settlers unit.")}$("#cities_scroll").css("height",$(window).height()-200);$("#city_table").tablesorter({theme:"dark",sortList:sortList});if(tiny_screen){$("#city_table").css({transform:"scale(0.6)","transform-origin":"0 0"});$("#cities").css({width:"166.66%"});if(scroll_narrow_x){}else{$("#cities_scroll").css({"overflow-x":"hidden"})}$("#city_table_head").css({"font-size":"85%"});$(".prod_img").css({"margin-top":"-19px"});$(".tdc1").css({"padding-right":"0px"});$(".tdc2").css({"padding-right":"0px"});$(".mobile_centre").parent().css({"text-align":"center"});$(".mobile_centre").css({"text-align":"center"})}else if(redux_screen){$("#city_table").css({transform:"scale(0.91)","transform-origin":"0 0"});$("#cities").css({width:"110%"});$("#cities_scroll").css({"overflow-x":"hidden"});$("#city_table_head").css({"font-size":"95%"});$(".tdc1").css({"padding-right":"0px"});$(".tdc2").css({"padding-right":"0px"});$(".redux_centre").parent().css({"text-align":"center"});$(".redux_centre").css({"text-align":"center"})}else if(wide_screen){$("#cities").css({width:"100%"})}if(retain_checkboxes_on_update){retain_checkboxes_on_update=false;restore_city_checkboxes()}set_mass_prod_city(prod_selection_city);if(active_superpanel_cityid>0){show_city_improvement_pane(active_superpanel_cityid);if(active_superpanel_dialog_refresh_delay==true)active_superpanel_dialog_refresh_delay=false;else active_superpanel_cityid=-1}}function change_city_user_row(city_id){city_user_row_val++;if(city_user_row_val>=CURV_LAST)city_user_row_val=0;update_city_screen()}function restore_city_checkboxes(){if(city_checkbox_states!=null){for(var city_id in cities){if(city_checkbox_states[city_id]==true){$("#cb"+city_id).prop("checked",true)}}}$("#master_checkbox").prop("checked",master_checkbox)}function save_city_checkbox_states(){for(var city_id in cities){if($("#cb"+city_id).is(":checked")){city_checkbox_states[city_id]=true}else city_checkbox_states[city_id]=false}}function toggle_city_row_selections(event){if(event.shiftKey){for(var city_id in cities){if($("#cities_list_"+city_id).css("background-color")=="rgb(0, 0, 255)"){$("#cb"+city_id).prop("checked",!$("#cb"+city_id).is(":checked"))}}}else{for(var city_id in cities){$("#cb"+city_id).prop("checked",!$("#cb"+city_id).is(":checked"))}master_checkbox=$("#master_checkbox").is(":checked")}}function cma_clipboard_macro(event,called_by_CMA){var apply_once=false,save=false;if(!event)event=new Event("");if(event.ctrlKey)save=true;else if(event.shiftKey)apply_once=true;var autoarrange=!(apply_once||save)||called_by_CMA;var sent_orders=false;if(apply_once||save){for(var city_id in cities){if($("#cb"+city_id).is(":checked")){cma_paste_to_city_id(parseInt(city_id),apply_once);city_checkbox_states[city_id]=true;sent_orders=true}else city_checkbox_states[city_id]=false}play_sound(sent_orders?soundset["e_success"]:soundset["e_fail"]);retain_checkboxes_on_update=true;return}else if(autoarrange){var cities_string="";var count=0;for(var city_id in cities){if($("#cb"+city_id).is(":checked")||called_by_CMA&&cities[city_id].cma_enabled){var packet={pid:packet_city_make_specialist,city_id:parseInt(city_id),tile_id:city_tile(cities[city_id]).index};send_request(JSON.stringify(packet));city_checkbox_states[city_id]=true;count++;cities_string+=cities[city_id].name+", "}else city_checkbox_states[city_id]=false}retain_checkboxes_on_update=true;if(count){if(count>5)cities_string=""+count+" cities, ";cities_string="&#x1F539; Ordered Governor to refresh tiles in <font color='yellow'>"+cities_string+"</font>using existing Governor settings.";packet={pid:25,message:cities_string,event:E_CITY_CMA_RELEASE};handle_chat_msg(packet);play_sound(soundset["e_success"]);if(called_by_CMA){$("#cma_unsaved_warning").html(cities_string);global_governor_message=cities_string}}else{packet={pid:25,message:"&#x26A0;&#xFE0F; <b>Failed:</b> no cities were selected for tile refresh.",event:E_CITY_CMA_RELEASE};handle_chat_msg(packet);play_sound(soundset["e_fail"]);global_governor_message="&#x26A0;&#xFE0F; <b>Failed:</b> no goverened cities were found."}}}function request_buy_all_selected_cities(){var pplayer=client.conn.playing;var total_cost=0;var item_count=0;var cost=0;var total_shields=0;for(var city_id in cities){if($("#cb"+city_id).is(":checked")){cost=cities[city_id]["buy_cost"];total_cost+=cost;total_shields+=get_shields_remaining(cities[city_id]);if(cost>0){item_count+=1}}}var plural=item_count>1?true:false;if(total_cost==0||total_cost>pplayer["gold"]){var title_string=total_cost==0?"Nothing to Buy!":"Not Enough Gold!";var rejection_string=total_cost==0?"Cost of selected purchase is 0.":total_cost+" gold for "+item_count+" item"+(plural?"s":"")+" exceeds "+pplayer["gold"]+" treasury gold.";swal({title:title_string,text:rejection_string,type:"warning",showCancelButton:false,confirmButtonColor:"#803030",confirmButtonText:"OK",closeOnConfirm:true});setSwalTheme();return}remove_active_dialog("#dialog");$("<div id='dialog'></div>").appendTo("div#game_page");var gcps=total_cost/total_shields;var buy_question_string="Buy "+item_count+" item"+(plural?"s":"")+" for <b>"+total_cost+"</b> gold @ "+gcps.toFixed(2)+"g/shield ?";var treasury_text="<br>Treasury contains "+pplayer["gold"]+" gold.";var dhtml=buy_question_string+treasury_text;$("#dialog").html(dhtml);$("#dialog").attr("title","Buy It!");$("#dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"95%":"50%",buttons:{Yes:function(){send_buy_all_selected_cities();remove_active_dialog("#dialog")},"No (𝗪)":function(){remove_active_dialog("#dialog")}}});$("#dialog").dialog("open");dialog_register("#dialog")}function send_buy_all_selected_cities(){for(var city_id in cities){if($("#cb"+city_id).is(":checked")){var packet={pid:packet_city_buy,city_id:cities[city_id].id};send_request(JSON.stringify(packet));city_checkbox_states[city_id]=true}else city_checkbox_states[city_id]=false}retain_checkboxes_on_update=true}function mass_change_prod(){var c=prod_selection_city;for(var city_id in cities){if($("#cb"+city_id).is(":checked")&&cities[city_id]!=null&&cities[c]!=null){send_city_change(cities[city_id].id,cities[c].production_kind,cities[c].production_value);city_checkbox_states[city_id]=true}else city_checkbox_states[city_id]=false}retain_checkboxes_on_update=true}function set_mass_prod_city(city_id){prod_selection_city=city_id;pcity=cities[city_id];var prod_type=get_city_production_type_sprite(pcity);var prod_img_html="";if(prod_type!=null){sprite=prod_type["sprite"];prod_img_html="<span title='"+(prod_type!=null?"Selected cities will change production to: "+prod_type["type"]["name"]:"")+"' style='background: transparent url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px; float:right; transform:scale(0.7); "+" cursor:pointer; margin-bottom:-20px;' "+"onclick='javascript:city_change_prod("+pcity["id"]+");'"+">"+"</span>"}$("#mass_production").html(prod_img_html)}function city_unhappy(pcity){return pcity["ppl_happy"][FEELING_FINAL]<pcity["ppl_unhappy"][FEELING_FINAL]+2*pcity["ppl_angry"][FEELING_FINAL]}function get_city_state(pcity){if(pcity==null)return;if(pcity["was_happy"]&&pcity["size"]>=3){return"Celebrating"}else if(pcity["unhappy"]){return"Disorder"}else{return"Peace"}}function city_keyboard_listener(ev){if($("input:focus").length>0||!keyboard_input)return;if(C_S_RUNNING!=client_state())return;var keyboard_key=String.fromCharCode(ev.keyCode);var key_code=ev.keyCode;if(active_city!=null){switch(key_code){case 38:case 104:ev.stopImmediatePropagation();setTimeout(function(){city_tab_index=0;$("#city_tabs").tabs({active:city_tab_index})},300);break;case 40:case 98:ev.stopImmediatePropagation();setTimeout(function(){city_tab_index=1;$("#city_tabs").tabs({active:city_tab_index})},300);break;case 27:ev.stopPropagation();close_city_dialog();chatbox_scroll_to_bottom(false);break;case 32:ev.stopImmediatePropagation();if(city_tab_index>1)city_tab_index=0;else city_tab_index=1-city_tab_index;$("#city_tabs").tabs({active:city_tab_index});break}switch(keyboard_key){case"P":ev.stopPropagation();previous_city();break;case"V":case"M":ev.stopPropagation();city_tab_index=0;$("#city_tabs").tabs({active:city_tab_index});break;case"D":ev.stopPropagation();city_tab_index=1;$("#city_tabs").tabs({active:city_tab_index});break;case"T":case"R":ev.stopPropagation();city_tab_index=2;$("#city_tabs").tabs({active:city_tab_index});break;case"O":ev.stopPropagation();city_tab_index=3;$("#city_tabs").tabs({active:city_tab_index});break;case"H":ev.stopPropagation();city_tab_index=4;$("#city_tabs").tabs({active:city_tab_index});break;case"G":ev.stopPropagation();city_tab_index=5;$("#city_tabs").tabs({active:city_tab_index});$("#ctg").click();break;case"I":ev.stopPropagation();city_tab_index=6;$("#city_tabs").tabs({active:city_tab_index});$("#cti").click();break;case"W":ev.stopPropagation();close_city_dialog_trigger();chatbox_scroll_to_bottom(false);break;case"N":ev.stopPropagation();next_city();break;case"B":ev.stopPropagation();request_city_buy();break}}}function city_prod_tab(){city_tab_index=1;$("#city_tabs").tabs({active:city_tab_index})}function get_citywalls_scale(pcity){var scale=8;if(pcity["size"]>=3&&pcity["size"]<=6){scale=9}else if(pcity["size"]>6&&pcity["size"]<=9){scale=10}else if(pcity["size"]>9&&pcity["size"]<=11){scale=11}else if(pcity["size"]>11){scale=12}return scale}var client={};client.conn={};var client_frozen=false;var phase_start_time=0;var debug_active=false;var autostart=false;var username=null;var fc_seedrandom=null;var game_type="";var link_game_type="";var music_list=["battle-epic","andrewbeck-ancient","into_the_shadows","andrewbeck-stings","trap_a_space_odyssey_battle_for_the_planet","elvish-theme","cullambruce-lockhart-dawning_fanfare"];var audio=null;var audio_enabled=false;var last_turn_change_time=0;var turn_change_elapsed=0;var seconds_to_phasedone=0;var seconds_to_phasedone_sync=0;var dialog_close_trigger="";var dialog_message_close_task;$(document).ready(function(){civclient_init()});function civclient_init(){$.blockUI.defaults["css"]["backgroundColor"]="#222";$.blockUI.defaults["css"]["color"]=default_dialog_text_color;$.blockUI.defaults["theme"]=true;var action=$.getUrlVar("action");link_game_type=$.getUrlVar("type");if(link_game_type==null){if(action==null||action=="multi"){swal({title:"Unknown game type",text:"For some reason the client can't determine what kind of game this is. Please <a href='https://github.com/freeciv/freeciv-web/issues'>open an issue</a> detailing how you got here",html:true,type:"error"},function(unused){window.location.href="/"});setSwalTheme();return}else if(action=="pbem"){link_game_type="pbem"}else{link_game_type="singleplayer"}}if(action=="observe"){observing=true;$("#civ_tab").remove();$("#empire_tab").remove();$("#cities_tab").remove();$("#pregame_buttons").remove();$("#game_unit_orders_default").remove();$("#civ_dialog").remove()}fc_seedrandom=new Math.seedrandom("freeciv-web");if(window.requestAnimationFrame==null){swal("Please upgrade your browser.");setSwalTheme();return}if(is_longturn()&&observing){swal("LongTurn games can't be observed.");setSwalTheme();return}init_mapview();game_init();$("#tabs").tabs({heightStyle:"fill"});control_init();init_replay();timeoutTimerId=setInterval(update_timeout,1e3);update_game_status_panel();statusTimerId=setInterval(update_game_status_panel,6e3);if(overviewTimerId==-1){OVERVIEW_REFRESH=6e3;overviewTimerId=setInterval(redraw_overview,OVERVIEW_REFRESH)}motd_init();$("#tabs").css("height",$(window).height());$("#tabs-map").height("auto");$("#tabs-empire").height("auto");$("#tabs-warcalc").height("auto");$("#tabs-civ").height("auto");$("#tabs-tec").height("auto");$("#tabs-nat").height("auto");$("#tabs-cities").height("auto");$("#tabs-opt").height("100%");$("#tabs-hel").height("auto");$(".button").button();sounds_enabled=simpleStorage.get("sndFX");if(sounds_enabled==null){if(platform.name=="Safari"){sounds_enabled=false}else{sounds_enabled=true}}draw_map_grid=simpleStorage.get("mapgrid");if(draw_map_grid==null)draw_map_grid=false;map_drag_enabled=simpleStorage.get("mapdrag");if(map_drag_enabled==null)map_drag_enabled=true;enable_goto_drag=simpleStorage.get("gotodrag");if(enable_goto_drag==null)enable_goto_drag=true;enable_autoexplore=simpleStorage.get("explorekey");if(enable_autoexplore==null)enable_autoexplore=true;unit_click_menu=simpleStorage.get("unitclickmenu");if(unit_click_menu==null)if(is_small_screen()||is_touch_device())unit_click_menu=true;else unit_click_menu=false;draw_city_airlift_counter=simpleStorage.get("airlift");if(draw_city_airlift_counter==null)draw_city_airlift_counter=false;draw_city_mood=simpleStorage.get("drawMood");if(draw_city_mood==null)draw_city_mood=false;draw_stacked_unit_mode=simpleStorage.get("stackmode");if(draw_stacked_unit_mode==null)draw_stacked_unit_mode=3;draw_city_output=simpleStorage.get("drawTiles");if(draw_city_output==null)draw_city_output=false;scroll_narrow_x=simpleStorage.get("xScroll");if(scroll_narrow_x==null)scroll_narrow_x=false;show_empire_tab=simpleStorage.get("showEmpire");if(show_empire_tab==null)show_empire_tab=false;show_compass=simpleStorage.get("showCompass");if(show_compass==null||show_compass==true){show_compass=true;$("#compass").show()}else $("#compass").hide();var tmp=simpleStorage.get("chatDlg");if(tmp!=null){restore_chatbox_vals=tmp}draw_highlighted_pollution=simpleStorage.get("showpollution");if(draw_highlighted_pollution==null)draw_highlighted_pollution=false;focuslock=simpleStorage.get("focuslock");if(focuslock==null){if(is_small_screen()||is_touch_device())focuslock=true;else focuslock=false}show_unit_movepct=simpleStorage.get("showMoves");if(show_unit_movepct==null)show_unit_movepct=false;if(show_unit_movepct){hp_bar_offset=-5}else hp_bar_offset=0;draw_border_flags=simpleStorage.get("borderFlags");if(draw_border_flags==null)draw_border_flags=false;draw_tertiary_colors=simpleStorage.get("tricolore");if(draw_tertiary_colors==null)draw_tertiary_colors=false;draw_border_mode|=draw_tertiary_colors;draw_thick_borders=simpleStorage.get("thickBorders");if(draw_thick_borders==null)draw_thick_borders=false;draw_dashed_borders=simpleStorage.get("dashedBorders");if(draw_dashed_borders==null)draw_dashed_borders=false;draw_moving_borders=simpleStorage.get("movingBorders");if(draw_moving_borders==null)draw_moving_borders=false;audiojs.events.ready(function(){var as=audiojs.createAll({trackEnded:function(){if(!supports_mp3()){audio.load("/music/"+music_list[Math.floor(Math.random()*music_list.length)]+".ogg")}else{audio.load("/music/"+music_list[Math.floor(Math.random()*music_list.length)]+".mp3")}audio.play()}});audio=as[0]});if(link_game_type=="singleplayer#")link_game_type="singleplayer";var game_port=$.getUrlVar("civserverport");var game_host=$.getUrlVar("civserverhost");var multi=$.getUrlVar("multi");if((link_game_type=="pbem"||link_game_type=="singleplayer")&&game_port==null&&game_host==null&&multi==null){game_type=link_game_type;init_common_intro_dialog()}else{$.ajax({type:"GET",url:"/get_game_type?host="+$.getUrlVar("civserverhost")+"&port="+game_port,success:function(data,textStatus,request){game_type=data;if(link_game_type!=""&&game_type=="longturn"&&link_game_type!=game_type){if(link_game_type.includes("#"))link_game_type=link_game_type.replace(/#/g,"%23");var stored_username=simpleStorage.get("username","");if(stored_username==null||stored_username==false)stored_username="blank";$.ajax({type:"POST",url:"/validate_twit?username="+stored_username+"&type=type%3D"+link_game_type+"&port="+game_port})}init_common_intro_dialog()},error:function(request,textStatus,errorThrown){swal("Error, can't get the game type!");setSwalTheme()}})}setup_window_size();update_turn_change_timer();$(".ui-dialog-titlebar-minimize").css({background:"none","background-image":"none","margin-top":"1px","margin-left":"0px","margin-right":"2px",border:"none",height:"16px"});$(".ui-dialog-titlebar-maximize").css({background:"none","background-image":"none","margin-top":"1px","margin-left":"0px","margin-right":"2px",border:"none",height:"16px"});$(".ui-dialog-titlebar-restore").css({background:"none","background-image":"none","margin-top":"1px","margin-left":"0px","margin-right":"2px",border:"none",height:"16px"});$(".ui-dialog-titlebar-close").css({background:"none","background-image":"none","margin-top":"1px","margin-left":"0px","margin-right":"2px",border:"none",height:"16px"});if(is_small_screen())document.body.classList.add("mobile")}function init_common_intro_dialog(){if(observing){show_intro_dialog("Welcome to Freeciv","You have joined the game as an observer. Please enter your name:");$("#turn_done_button").button("option","disabled",true)}else if($.getUrlVar("action")=="pbem"){show_pbem_dialog()}else if($.getUrlVar("action")=="hotseat"){show_hotseat_dialog()}else if(is_small_screen()){if(is_longturn()){setTimeout(show_longturn_intro_dialog,300)}else{show_intro_dialog("Welcome to Freeciv","You are about to join the game. Please enter your name:")}}else if($.getUrlVar("action")=="earthload"){show_intro_dialog("Welcome to Freeciv","You can now play Freeciv-web on the earth map you have chosen. "+"Please enter your name: ")}else if($.getUrlVar("action")=="load"){show_intro_dialog("Welcome to Freeciv","You are about to join this game server, where you can "+"load a savegame, tutorial, custom map generated from an image or a historical scenario map. "+"Please enter your name: ")}else if($.getUrlVar("action")=="multi"){if(is_longturn()){setTimeout(show_longturn_intro_dialog,300)}else{var msg="After you Join Game, click the <b>Game</b> button to select rules and settings.<br>"+"Wait for other players <b>before</b> clicking <b>Start</b>.";show_intro_dialog("Multiplayer Game",msg)}}else if($.getUrlVar("action")=="hack"){var hack_port;var hack_username;if($.getUrlVar("civserverport")!=null){hack_port=$.getUrlVar("civserverport")}else{show_intro_dialog("Welcome to Freeciv","Hack mode disabled because civserverport wasn't specified. "+"Falling back to regular mode.");return}if($.getUrlVar("username")!=null){hack_username=$.getUrlVar("username")}else if(simpleStorage.hasKey("username")){hack_username=simpleStorage.get("username")}else{show_intro_dialog("Welcome to Freeciv",'Hack mode disabled because "username" wasn\'t specified and no '+"stored user name was found. "+"Falling back to regular mode.");return}$.ajax({type:"POST",url:"/validate_twit?username="+hack_username+"&type=action_hack&port="+hack_port})}else{show_intro_dialog("Singleplayer vs. Freeciv AI","<br>Creating an account is optional. Saved games need an account.")}$("#pregame_message_area").html("<b>Game</b>: Select rules and game settings.<br>"+"<b>Load</b>: Load saved game.<br>"+"<b>Nation</b>: Pick nation.<br>"+"<b>Start</b>: Do <u>after</u> you set rules and settings.<br><br>"+($.getUrlVar("action")!="multi"?"<b>WARNING:</b> Default rules for Singleplayer are Classic (old).</b><br><br>"+"<u>All rulesets are suitable for Singleplayer.</u><br><br>"+"<b>NOTE:</b> Rulesets named 'Multiplayer' are simply the more modern rulesets that work well with any number of players.<br>"+"You can play Singleplayer with a Multiplayer ruleset if you wish to improve for multiplayer games with other humans.<br>"+"&nbsp;&bull; If you do this, try: &nbsp; <b>/set sciencebox 80</b> &nbsp; (or similar) to set a singleplayer research pace. <b>/help sciencebox</b> for more info.<br>":"<b>WARNING:</b> Default rules for Multiplayer are Multiplayer+.</b><br><br>")+"Click <b>Game</b> button to select Game Version (ruleset).<br><br>"+"Advanced: You can tune more settings with the command line.<br>"+"&nbsp;&nbsp;&nbsp;To see all options: <b>/show all</b><br>"+"&nbsp;&nbsp;&nbsp;Set option to ####: <b>/set</b> option_name ####<br>"+"&nbsp;&nbsp;&nbsp;To see option help: <b>/help</b> option_name<br><br><br>")}function close_dialog_message(){remove_active_dialog("#generic_dialog");$(this).off("keypress")}function closing_dialog_message(){clearTimeout(dialog_message_close_task);$("#game_text_input").blur()}function show_dialog_message(title,message){if(title=="Tile Information"||title=="Tile Info")message=improve_tile_info_dialog(message);remove_active_dialog("#generic_dialog");$("<div id='generic_dialog'></div>").appendTo("div#game_page");speak(title);speak(message);$("#generic_dialog").html(message);$("#generic_dialog").attr("title",title);$("#generic_dialog").dialog({bgiframe:true,modal:false,width:is_small_screen()?"90%":"50%",close:closing_dialog_message,buttons:{"OK (𝗪)":close_dialog_message}}).dialogExtend({minimizable:true,closable:true,icons:{minimize:"ui-icon-circle-minus",restore:"ui-icon-bullet"}});$(this).keypress(function(e){if(e.which==119||e.keyCode==119){close_dialog_message()}});$("#generic_dialog").dialog("open");dialog_register("#generic_dialog");$("#game_text_input").blur();if(title=="Tile Information")$("#calc_tip").tooltip();$("#generic_dialog").css("max-height","450px")}function validate_username(){username=$("#username_req").val();if(!is_username_valid_show(username)){return false}simpleStorage.set("username",username);return true}function is_username_valid_show(username){var reason=get_invalid_username_reason(username);if(reason!=null){$("#username_validation_result").html("The username '"+username.replace(/&/g,"&amp;").replace(/</g,"&lt;")+"' is "+reason+".");$("#username_validation_result").show();return false}return true}function is_server(){return false}function update_timeout(){var now=(new Date).getTime();var is_small=is_small_screen();if(game_info!=null&&current_turn_timeout()!=null&&current_turn_timeout()>0){var remaining=Math.floor(seconds_to_phasedone-(now-seconds_to_phasedone_sync)/1e3);if(remaining>=0&&turn_change_elapsed==0){if(is_small&&!is_longturn()){$("#turn_done_button").button("option","label","T "+remaining);$("#turn_done_button .ui-button-text").css("padding","3px")}else if(is_small){$("#turn_done_button").button("option","label",""+seconds_to_human_time(remaining)+"")}else{$("#turn_done_button").button("option","label","Turn Done ("+seconds_to_human_time(remaining)+")")}if(!is_touch_device())$("#turn_done_button").tooltip({disabled:false})}}}function update_turn_change_timer(){turn_change_elapsed+=1;if(turn_change_elapsed<last_turn_change_time){setTimeout(update_turn_change_timer,1e3);$("#turn_done_button").button("option","label","Please wait ("+(last_turn_change_time-turn_change_elapsed)+")")}else{turn_change_elapsed=0;if(is_small_screen()){$("#turn_done_button").button("option","label","Done");$("#turn_done_button").css("font-size","90%");$("#turn_done_button_div").css("padding-right","0px");$("#turn_done_button").css("padding-left","3px");$("#turn_done_button").css("padding-right","3px")}else{$("#turn_done_button").button("option","label","Turn Done");$("#turn_done_button_div").css("padding-right","1px")}}}function set_phase_start(){phase_start_time=(new Date).getTime()}function request_observe_game(){send_message("/observe ")}function surrender_game(){send_surrender_game();$("#tabs-map").removeClass("ui-tabs-hide");$("#tabs-opt").addClass("ui-tabs-hide");$("#map_tab").addClass("ui-state-active");$("#map_tab").addClass("ui-tabs-selected");$("#map_tab").removeClass("ui-state-default")}function send_surrender_game(){if(!client_is_observer()&&ws!=null&&ws.readyState===1){send_message("/surrender ")}}function show_fullscreen_window(){if(BigScreen.enabled){BigScreen.toggle()}else{show_dialog_message("Fullscreen","Press F11 for fullscreen mode.")}}function show_debug_info(){console.log("Freeciv version: "+freeciv_version);console.log("Browser useragent: "+navigator.userAgent);console.log("jQuery version: "+$().jquery);console.log("jQuery UI version: "+$.ui.version);console.log("simpleStorage version: "+simpleStorage.version);console.log("Touch device: "+is_touch_device());console.log("HTTP protocol: "+document.location.protocol);if(ws!=null&&ws.url!=null)console.log("WebSocket URL: "+ws.url);debug_active=true;var sum=0;var max=0;for(var i=0;i<debug_ping_list.length;i++){sum+=debug_ping_list[i];if(debug_ping_list[i]>max)max=debug_ping_list[i]}console.log("Network PING average (server): "+sum/debug_ping_list.length+" ms. (Max: "+max+"ms.)");sum=0;max=0;for(var j=0;j<debug_client_speed_list.length;j++){sum+=debug_client_speed_list[j];if(debug_client_speed_list[j]>max)max=debug_client_speed_list[j]}console.log("Network PING average (client): "+sum/debug_client_speed_list.length+" ms.  (Max: "+max+"ms.)")}function motd_init(){$.getScript("/motd.js");setTimeout(motd_init,1e3*60*30)}function show_auth_dialog(packet){$("#dialog").remove();$("<div id='dialog'></div>").appendTo("div#game_page");var intro_html=packet["message"]+"<br><br> Password: <input id='password_req' type='text' size='25'>";$("#dialog").html(intro_html);$("#dialog").attr("title","Private server needs password to enter");$("#dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"80%":"60%",buttons:{Ok:function(){var pwd_packet={pid:packet_authentication_reply,password:$("#password_req").val()};var myJSONText=JSON.stringify(pwd_packet);send_request(myJSONText);$("#dialog").dialog("close")}}});$("#dialog").dialog("open")}function is_longturn(){return game_type=="longturn"}function is_supercow(){return client.conn["access_level"]>=5}function is_ongoing_longturn(){return is_longturn()&&game_info!=null&&game_info["turn"]>0}function is_loaded_game(){var chatbox_text=get_chatbox_text();return chatbox_text!==null&&chatbox_text.indexOf("Load complete")!=-1}var C_S_INITIAL=0;var C_S_PREPARING=1;var C_S_RUNNING=2;var C_S_OVER=3;var civclient_state=C_S_INITIAL;var endgame_player_info=[];var height_offset=43;var width_offset=0;function set_client_state(newstate){if(civclient_state!=newstate){civclient_state=newstate;switch(civclient_state){case C_S_RUNNING:$.unblockUI();show_new_game_message();insert_pregame_messages();set_client_page(PAGE_GAME);setup_window_size();update_metamessage_on_gamestart();if(is_pbem()){setTimeout(function(){set_human_pbem_players();advance_unit_focus(false)},1500)}$(".context-menu-root").remove();if(observing||$.getUrlVar("action")=="multi"||is_longturn()||game_loaded){center_on_any_city();advance_unit_focus(false)}break;case C_S_OVER:setTimeout(show_endgame_dialog,500);break;case C_S_PREPARING:break;default:break}}}function setup_window_size(){var winWidth=$(window).width();var winHeight=$(window).height();var new_mapview_width=winWidth-width_offset;var new_mapview_height=winHeight-height_offset;mapview_canvas.width=new_mapview_width;mapview_canvas.height=new_mapview_height;buffer_canvas.width=Math.floor(new_mapview_width*1.5);buffer_canvas.height=Math.floor(new_mapview_height*1.5);mapview["width"]=new_mapview_width;mapview["height"]=new_mapview_height;mapview["store_width"]=new_mapview_width;mapview["store_height"]=new_mapview_height;mapview_canvas_ctx.font=canvas_text_font;buffer_canvas_ctx.font=canvas_text_font;$("#pregame_message_area").height(new_mapview_height-105-$("#pregame_game_info").outerHeight());$("#pregame_player_list").height(new_mapview_height-80);$("#nations").height(new_mapview_height-100);$("#nations").width(new_mapview_width);$("#tabs").css("height",$(window).height());$("#tabs-map").height("auto");$("#city_viewport").height(new_mapview_height-20);$("#opt_tab").show();$("#players_tab").show();$("#cities_tab").show();$("#freeciv_logo").show();$("#tabs-hel").hide();if(is_small_screen()){$("#turn_done_button").css({"padding-left":"7px","padding-right":"7px","padding-bottom":"8px"});$("#tabs_menu").css("margin-left","-3px");$(".ui-tabs-anchor").css("padding","7px");$("#freeciv_logo").hide();$("#map_tab").children().html("<img style='float:left' src='/images/map_tab_icon_m.png'>");$("#empire_tab").children().html("<img style='float:left' src='/images/empire_tab_icon.png'>");$("#civ_tab").children().html("<img style='float:left' src='/images/gov_tab_icon.png'>");$("#tech_tab").children().html("<img style='float:left' src='/images/tech_tab_icon_m.png'>");$("#players_tab").children().html("<img style='float:left' src='/images/nation_tab_icon.png'>");$("#cities_tab").children().html("<img style='float:left' src='/images/cities_tab_icon.png'>");$("#opt_tab").children().html("<img style='float:left' src='/images/prefs_tab_icon.png'>");$("#hel_tab").children().html("<img style='float:left' src='/images/help_tab_icon_m.png'>");$("#warcalc_tab").children().html("&#x1F3B2;");$("#button_national_units").html("&#9823;");$("#button_unit_homecity").html("&#x1F3E0;");$("#button_unit_deployment").html("&#x2299;");$("#button_city_buildings").html("&#x1F3E2;");$("#button_empire_upkeep").html("&#x1f4b0;");$("#button_empire_prod").html("&#x1F528;");$(".overview_dialog").hide();overview_active=false;$(".not_mobile").remove();$("#game_unit_orders_default").css("position","absolute");$("#game_unit_orders_default").css("top","48px");$(".order_button").css("padding","1px 1px 0px 6px");if($("#game_unit_orders_settlers").length>0)$("#game_unit_orders_settlers").remove();$("#game_unit_panel").css({transform:"scale(0.95)",float:"left","margin-top":"-12px","margin-left":"-22px",width:"100%;"});$("#game_unit_info").css({float:"left",width:"2000%"});$("#help_footer").hide();$(".ui-dialog-titlebar").show();$(".ui-dialog-titlebar").find("#ui-id-12").parent().css({background:"none","border-style":"none",height:"16px",width:"1px"});$("#ui-id-12").parent().show();$(".ui-dialog-titlebar").css({"font-size":"70%","margin-left":"-3px"});$("#game_status_panel_bottom").css("font-size","0.8em")}else{$("#map_tab").children().html("<img style='float:left; margin-right:5px;' src='/images/map_tab_icon.png'> Map");$("#empire_tab").children().html("<img style='float:left; margin-right:5px;' src='/images/empire_tab_icon.png'> Empire");$("#civ_tab").children().html("<img style='float:left; margin-right:5px;' src='/images/gov_tab_icon.png'> Gov.");$("#tech_tab").children().html("<img style='float:left; margin-right:5px;' src='/images/tech_tab_icon.png'> Tech");$("#players_tab").children().html("<img style='float:left; margin-right:5px;' src='/images/nation_tab_icon.png'> Nations");$("#cities_tab").children().html("<img style='float:left; margin-right:5px;' src='/images/cities_tab_icon.png'> Cities");$("#opt_tab").children().html("<img style='float:left; margin-right:5px;' src='/images/prefs_tab_icon.png'> Prefs");$("#hel_tab").children().html("<img style='float:left; margin-right:5px;' src='/images/help_tab_icon.png'> Help")}if(overview_active)init_overview();if(unitpanel_active)init_game_unit_panel();$(".ui-tabs-tab").css("border-color","#404040");if(client_is_observer()){observing=true;$("#tabs-cities").hide();$("#tabs-empire").hide()}}function client_state(){return civclient_state}function can_client_change_view(){return(client.conn.playing!=null||client_is_observer())&&(C_S_RUNNING==client_state()||C_S_OVER==client_state())}function can_client_control(){return null!=client.conn.playing&&!client_is_observer()}function can_client_issue_orders(){return can_client_control()&&C_S_RUNNING==client_state()}function client_is_observer(){return client.conn["observer"]||observing}function show_new_game_message(){var message=null;clear_chatbox();if(observing||$.getUrlVar("autostart")=="true"){return}else if(is_hotseat()){show_hotseat_new_phase();return}else if(is_pbem()){message="Welcome, "+capitalize(username)+"! It is now your turn to play. Each player will "+"get an e-mail when it is their turn to play, and can only play one turn at a time. "+"Click the end turn button to end your turn and let the next opponent play.";setTimeout(check_queued_tech_gained_dialog,2500)}else if(client.conn.access_level==5){return}else if(is_longturn()){message="Welcome, "+capitalize(username)+"! This is a Longturn game, where you play one turn per day. "+"Make your moves and come back tomorrow when the timer advances to the next turn! You may "+"bookmark this page to return. You can also find the game again at "+window.location.host+".<br> "+"<font color='#90FFFF'>Freeciv is a game of diplomacy. Your nation is encouraged to talk to other nations. "+"Please join the <a href='https://discord.gg/BrpzgpgMAF' target='_new'>community Discord chat</a>. "+"Players are responsible for following the #rules posted there. Be polite; please keep talk related "+"to the game; do not post spam or advertisements if you wish to remain in the game.</font> Good luck and have fun!";if(is_small_screen){message+="This is your message window that reports ongoing game events. "+"<u style='color:#fde'>Tap the yellow <b>minimize button</b> at the top to enter the game</u>. You can return here to view "+"game messages by hitting the maximize button."}}else if(is_small_screen()){message="Welcome, "+capitalize(username)+"! You have just become ruler of a young but promising civilization!\n"+"You must balance expansion, education, economy, military and diplomacy to thrive.\n"+"Can you lead your people to glory? Can you dominate all others? Only time can tell..\n"+"Please join the <a href='https://discord.gg/BrpzgpgMAF' target='_new'>community Discord chat</a>. "+"This message window reports game events.\n Do not post spam or offsite advertisements."+"<u style='color:#fde'>Tap the yellow <b>minimize button</b> at the top to enter the game</u>. You can return here to view "+"game messages by hitting the maximize button."}else if(client.conn.playing!=null&&!game_loaded){var pplayer=client.conn.playing;var player_nation_text="Welcome, "+capitalize(username)+", ruler of the "+nations[pplayer["nation"]]["adjective"]+" empire.";if(is_touch_device()){message=player_nation_text+" Your\n"+"task is to create a great empire! You should start by\n"+"exploring the land around you with your explorer,\n"+"and using your settlers to find a good place to build\n"+"a city. Click on units to get a list of available orders. \n"+"To move your units around, carefully drag the units to the \n"+"place you want it to go.\n"+"Please join the <a href='https://discord.gg/BrpzgpgMAF' target='_new'>community Discord chat</a>.\n"+"Good luck and have fun!"}else{message=player_nation_text+" Your\n"+"task is to create a great empire! You should start by\n"+"exploring the land around you with your explorer,\n"+"and using your settlers to find a good place to build\n"+"a city. Right-click with the mouse on your units for a list of available \n"+"orders such as move, explore, build cities and attack. \n"+"Please join the <a href='https://discord.gg/BrpzgpgMAF' target='_new'>community Discord chat</a>.\n"+"Good luck and have fun!"}}else if(game_loaded){message="Welcome back, "+capitalize(username);if(client.conn.playing!=null){message+=" ruler of the "+nations[client.conn.playing["nation"]]["adjective"]+" empire."}}else{return}message_log.update({event:E_FIRST_CONTACT,message:message})}function alert_war(player_no){var pplayer=players[player_no];message_log.update({event:E_DIPLOMACY,message:"War: You are now at war with the "+nations[pplayer["nation"]]["adjective"]+" leader "+pplayer["name"]+"!"})}function show_endgame_dialog(){var title="Final Report: The Greatest Civilizations in the world!";var message="<p id='hof_msg'></p>";for(var i=0;i<endgame_player_info.length;i++){var pplayer=players[endgame_player_info[i]["player_id"]];var nation_adj=nations[pplayer["nation"]]["adjective"];message+=i+1+": The "+nation_adj+" ruler "+pplayer["name"]+" scored "+endgame_player_info[i]["score"]+" points"+"<br>"}$("#dialog").remove();$("<div id='dialog'></div>").appendTo("div#game_page");$("#dialog").html(message);$("#dialog").attr("title",title);$("#dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"90%":"50%",buttons:{"Game replay":function(){show_replay()},"Show Scores":function(){$("#dialog").dialog("close");view_game_scores()},Ok:function(){$("#dialog").dialog("close");$("#game_text_input").blur()}}});$("#dialog").dialog("open");$("#game_text_input").blur();$("#dialog").css("max-height","500px");setTimeout(submit_game_to_hall_of_fame,1e3)}function update_metamessage_on_gamestart(){if(!observing&&!metamessage_changed&&client.conn.playing!=null&&client.conn.playing["pid"]==players[0]["pid"]&&$.getUrlVar("action")=="new"){var pplayer=client.conn.playing;var metasuggest=capitalize(username)+" ruler of the "+nations[pplayer["nation"]]["adjective"]+".";send_message("/metamessage "+metasuggest);setInterval(update_metamessage_game_running_status,2e5)}if($.getUrlVar("action")=="new"||$.getUrlVar("action")=="earthload"||$.getUrlVar("scenario")=="true"){$.post("/freeciv_time_played_stats?type=single2d").fail(function(){})}if($.getUrlVar("action")=="multi"&&client.conn.playing!=null&&client.conn.playing["pid"]==players[0]["pid"]&&!is_longturn()){$.post("/freeciv_time_played_stats?type=multi").fail(function(){})}if($.getUrlVar("action")=="hotseat"){$.post("/freeciv_time_played_stats?type=hotseat").fail(function(){});send_message("/metamessage hotseat game")}}function update_metamessage_game_running_status(){if(client.conn.playing!=null&&!metamessage_changed){var pplayer=client.conn.playing;var rules=ruleset_control["name"];var metasuggest=rules+" | "+nations[pplayer["nation"]]["adjective"]+" | "+(governments[client.conn.playing["government"]]!=null?governments[client.conn.playing["government"]]["name"]:"-")+" | People:"+civ_population(client.conn.playing.playerno)+" | Score:"+pplayer["score"]+" | "+"Research:"+(techs[client.conn.playing["researching"]]!=null?techs[client.conn.playing["researching"]]["name"]:"-");send_message("/metamessage "+metasuggest)}}var game_launch_timer=(new Date).getTime();const event_sound_suppress_delay=15e3;var error_shown=false;var syncTimerId=-1;var clinet_last_send=0;var debug_client_speed_list=[];var freeciv_version="+Freeciv.Web.Devel-3.1";var ws=null;var civserverport=null;var ping_last=(new Date).getTime();var pingtime_check=24e4;var ping_timer=null;var last_user_action_time=(new Date).getTime();var kick_inactive_time=40*6e4;var last_ping_measurement=0;function network_init_manual_hack(civserverport_manual,username_manual,savegame){$.ajax({type:"POST",url:"/validate_twit?username="+username_manual+"&type=manual_hack&port="+civserverport_manual})}function network_init(){if(!("WebSocket"in window)){swal("WebSockets not supported","","error");setSwalTheme();return}var civclient_request_url=freeciv_api_server_url+"/civclientlauncher";if($.getUrlVar("action")!=null)civclient_request_url+="?action="+$.getUrlVar("action");if($.getUrlVar("action")==null&&$.getUrlVar("civserverport")!=null)civclient_request_url+="?";if($.getUrlVar("civserverport")!=null)civclient_request_url+="&civserverport="+$.getUrlVar("civserverport");$.ajax({type:"POST",url:civclient_request_url,success:function(data,textStatus,request){civserverport=request.getResponseHeader("port");var connect_result=request.getResponseHeader("result");if(civserverport!=null&&connect_result=="success"){websocket_init();load_game_check()}else{show_dialog_message("Network error","Invalid server port. Error: "+connect_result)}},error:function(request,textStatus,errorThrown){show_dialog_message("Network error","Unable to communicate with civclientlauncher servlet . Error: "+textStatus+" "+errorThrown+" "+request.getResponseHeader("result"))}})}function websocket_init(){$.blockUI({message:"<h1 style='text-align:center'><font color='#ccc'>Connecting...</font></h1>"});var proxyport=1e3+parseFloat(civserverport);var ws_protocol="https:"==window.location.protocol?"wss:":"ws:";var port=window.location.port?":"+window.location.port:"";ws=new WebSocket(ws_protocol+freeciv_api_server_url+"/civsocket/"+proxyport);ws.onopen=check_websocket_ready;ws.onmessage=function(event){if(typeof client_handle_packet!=="undefined"){client_handle_packet(JSON.parse(event.data));if(DEBUG_LOG_PACKETS)console.log("*** INCOMING PACKET>>>>>"+event.data)}else{console.error("Error, freeciv-web not compiled correctly. Please "+"run sync.sh in freeciv-proxy correctly.")}};ws.onclose=function(event){var cur_time=(new Date).getTime();if(cur_time-last_user_action_time>kick_inactive_time){swal("Inactivity Timeout","Session closed: "+kick_inactive_time/6e4+"min inactivity. Please reload the page to reconnect.","error");setSwalTheme()}else{swal("Network Error","Connection to server is closed. Please reload the page to restart. Sorry!","error");setSwalTheme();message_log.update({event:E_LOG_ERROR,message:"Error: connection to server is closed. Please reload the page to restart. Sorry!"})}console.info("WebSocket connection closed, code+reason: "+event.code+", "+event.reason);$("#turn_done_button").button("option","disabled",true);$("#save_button").button("option","disabled",true);pbem_phase_ended=true;$(window).unbind("beforeunload");clearInterval(ping_timer)};ws.onerror=function(evt){show_dialog_message("Network error","A problem occured with the "+document.location.protocol+" WebSocket connection to the server: "+ws.url);console.error("WebSocket error: Unable to communicate with server using "+document.location.protocol+" WebSockets. Error: "+evt)}}function check_websocket_ready(){if(ws!=null&&ws.readyState===1){var sha_password=null;var stored_password=simpleStorage.get("password","");if(stored_password!=null&&stored_password!=false){var shaObj=new jsSHA("SHA-512","TEXT");shaObj.update(stored_password);sha_password=encodeURIComponent(shaObj.getHash("HEX"))}if(is_longturn()&&google_user_token==null){swal("Login failed.");setSwalTheme();return}var login_message={pid:4,username:username,capability:freeciv_version,version_label:"-dev",major_version:3,minor_version:0,patch_version:92,port:civserverport,password:google_user_token==null?sha_password:google_user_token};send_request(JSON.stringify(login_message));$(window).bind("beforeunload",function(){return"Do you really want to leave your nation behind now?"});ping_timer=setInterval(ping_check,pingtime_check);$.unblockUI()}else{setTimeout(check_websocket_ready,500)}}function network_stop(){if(ws!=null)ws.close();ws=null}function send_request(packet_payload){if(ws!=null){var object_packet=JSON.parse(packet_payload);if(object_packet["pid"]==packet_unit_do_action&&(object_packet["action_type"]==ACTION_CLEAN_POLLUTION||object_packet["action_type"]==ACTION_CLEAN_FALLOUT)){console.log("Client forced to circumvent server's suggested packet_unit_do_action as a packet_unit_change_activity.");object_packet["pid"]=packet_unit_change_activity;object_packet["unit_id"]=object_packet["actor_id"];object_packet["activity"]=object_packet["action_type"]==ACTION_CLEAN_POLLUTION?ACTIVITY_POLLUTION:ACTIVITY_FALLOUT;object_packet["target"]=-1;delete object_packet.actor_id;delete object_packet.target_id;delete object_packet.extra_id;delete object_packet.value;delete object_packet.name;delete object_packet.action_type;packet_payload=JSON.stringify(object_packet)}ws.send(packet_payload)}if(DEBUG_LOG_PACKETS)console.log("OUTGOING PACKET>>>>>"+packet_payload);if(debug_active){clinet_last_send=(new Date).getTime()}var packet_type=jQuery.parseJSON("["+packet_payload+"]")[0]["pid"];if(packet_type==packet_conn_pong||packet_type==packet_chat_msg_req)return;set_last_user_action_time()}function clinet_debug_collect(){var time_elapsed=(new Date).getTime()-clinet_last_send;debug_client_speed_list.push(time_elapsed);clinet_last_send=(new Date).getTime()}function ping_check(){var time_since_last_ping=(new Date).getTime()-ping_last;var time_since_last_action=(new Date).getTime()-last_user_action_time;if(time_since_last_ping>pingtime_check){console.log("Error: Missing PING message from server, "+"indicates server connection problem.")}if(time_since_last_action>kick_inactive_time){console.log("Session closed. User inactivity exceeded "+kick_inactive_time/6e4+" minutes.");clinet_disconnect_from_server()}}function clinet_disconnect_from_server(){ws.close()}function set_last_user_action_time(){last_user_action_time=(new Date).getTime()}function send_message_delayed(message,delay){setTimeout("send_message('"+message+"');",delay)}function send_message(message){var packet={pid:packet_chat_msg_req,message:message};send_request(JSON.stringify(packet))}var power_cma=true;var cma_val_sliders=[1,0,0,0,0,0];var cma_min_sliders=[1,0,0,0,0,0];var cma_happy_slider=0;var cma_celebrate=false;var cma_allow_disorder=false;var cma_allow_specialists=true;var cma_apply_once=false;var cma_enabled=false;var cma_max_growth=false;var _cma_val_sliders=[1,0,0,0,0,0];var _cma_min_sliders=[1,0,0,0,0,0];var _cma_happy_slider=0;var _cma_celebrate=false;var _cma_allow_disorder=false;var _cma_allow_specialists=true;var _cma_max_growth=false;var cma_user_changed=false;var gov_refresh_timer=0;var global_governor_message="";const gov_help="<b>BASICS:</b><br>City Governors help you manage cities. When city population changes, they arrange citizens to work the tiles "+" that best achieve the goals of the On-Screen Settings. Governors can also change citizens to specialists and prevent disorder."+" Saving the On-Screen Settings is how you hire a Governor to achieve certain output goals. There are two kinds"+" of sliders: (<b>1</b>) <b>Minimum Surplus</b> sliders set the minimum floor to achieve. For example, {Food=3} tells the Governor to gather"+" at least +3 food. (<b>2</b>) <b>Output Priorities</b> tell the Governor the priorities of outputs relative to each other. For example, setting"+" {Science=2, Shield=1} will value science at 2x the value of shields. The Governor would select shields over bulbs only when he gets more than 2"+" shields in exchange for 1 bulb. If you set goals the Governor can't fulfill, he resigns and passes control back to you. In general,"+" use 'Minimum Surpluses' as a fail-safe floor, and 'Output Priorities' to target preferred output.<br>"+" The <b>Force Celebrate</b> option orders your Governor to achieve celebration. Usually this needs a higher "+" national Luxury rate. You can less forcefully tune celebration with the Happy Factor slider.<br><b>NOTE:</b> In cities with"+" overlapping tiles, it's best to avoid competing with your Governor: manage both cities manually, or give both a Governor.<br><br>"+" <b>ADVANCED:</b><br><b>I. <u>TILE REFRESH</u>.</b> The Governor only re-arranges tiles when population changes or a foreign military unit occupies"+" a worked tile. The City Governor Tab can help you optimally refresh the tile arrangement"+" at other important times, such as: (<b>1</b>) New tile improvements"+" finished, such as Irrigation. (<b>2</b>) A new Building changes output bonuses. (<b>3</b>) Pollution. (<b>4</b>) Migration of wild animals. "+"  (<b>5</b>) Change in tax rates. (<b>6</b>) The turn before growth, to collect other resources instead of exceeding"+" the food surplus needed to grow.<br>You can manually request cities to refresh tiles: (<b>a</b>) In single cities, refresh tiles with the On-Screen"+" settings by clicking <b>Set Once</b>. In the city tile view, clicking the city-center-tile will also auto-arrange, using the existing Governor settings."+" If the preference <b>Show Worked Tiles on Map</b>(SHIFT-W) is selected, CTRL-SHIFT-click on a city will do the same from the main map view."+"(<b>2</b>) You can click <b>Refresh All</b> to make all cities refresh their tiles according to their saved City Governor Settings."+" (<b>c</b>) In the City List, click the upper-left Clipboard button to <i>selectively</i> refresh tiles in checkbox-selected cities.<br>"+" <b>II. <u>COPY/PASTE CLIPBOARD</u>.<br></b> You may want to apply specific City Governor Settings to multiple cities."+" Advanced buttons let you do this. (<b>1</b>) <b>Copy</b> copies On-Screen Settings to the Clipboard."+" (<b>2</b>) <b>Paste</b> pastes the Clipboard to On-Screen Settings. (<b>3</b>) <b>Set Once</b> tells the Governor to refresh tiles according to"+" On-Screen Settings, <i>without</i> changing his ongoing saved orders. (<b>4</b>) <b>Set All</b> dangerously tells ALL Governors in ALL Cities to"+" refresh their tiles according to the <u>Clipboard</u> Settings, <i>without</i> changing their current saved orders. (<b>5</b>) <b>Save All</b> dangerously"+" tells ALL Governors in ALL Cities to immediately adopt the <u>Clipboard</u> Settings as their new orders. (<b>6</b>) Instead of 'Set All'"+" or 'Save All', you can selectively Set or Save multiple cities via the upper-left Clipboard in the City List: (<b>a</b>) SHIFT-CLICK to <b>set</b>"+" selected cities to Clipboard Settings <i>without</i> changing orders. (<b>b</b>) CTRL-CLICK to <b>save</b> the Clipboard Settings to every checkbox-selected city."+" <b>NOTE:</b> Be careful with advanced macro buttons! It's easy to confuse multiple origins (Clipboard or On-Screen Settings) and multiple destinations"+" (interim order, permanent order; one city, some cities, all cities, etc.)";function show_city_governor_tab(){if(client_is_observer()||client.conn.playing==null)return false;if(!active_city)return false;if(!active_city["cm_parameter"]){$("#city_governor_tab").html("Game was started before City Governor feature was added.");return false}if(city_owner_player_id(active_city)!=client.conn.playing.playerno){$("#city_governor_tab").html("City Governor available only for domestic cities.");return false}cma_init_data();$("#cma_status").html(cma_get_status_icon()+" City Governor <b>"+cma_get_status_text(cma_enabled)+"d</b><br>");$("#btn_toggle_cma").prop("title",cma_get_status_text(!cma_enabled)+" city governor in this city");$("#btn_toggle_cma").html("<b>"+cma_get_status_text(!cma_enabled)+"</b></button>");create_cma_sliders();create_cma_page();update_cma_state();$(".ui-slider-handle").css("background","url('/images/slider_prod.png')");$(".ui-slider").css("background","url('/images/string.png')");$("#cma-val-slider-Food").children().css("background-image","url('/images/slider_food.png')");$("#cma-val-slider-Shield").children().css("background-image","url('/images/slider_prod.png')");$("#cma-val-slider-Trade").children().css("background-image","url('/images/slider_trade.png')");$("#cma-val-slider-Gold").children().css("background-image","url('/images/slider_gold.png')");$("#cma-val-slider-Luxury").children().css("background-image","url('/images/slider_lux.png')");$("#cma-val-slider-Science").children().css("background-image","url('/images/slider_sci.png')");$("#cma-happy-slider").children().css("background-image","url('/images/slider_happy.png')");$("#cma-min-slider-Food").children().css("background-image","url('/images/slider_food.png')");$("#cma-min-slider-Shield").children().css("background-image","url('/images/slider_prod.png')");$("#cma-min-slider-Trade").children().css("background-image","url('/images/slider_trade.png')");$("#cma-min-slider-Gold").children().css("background-image","url('/images/slider_gold.png')");$("#cma-min-slider-Luxury").children().css("background-image","url('/images/slider_lux.png')");$("#cma-min-slider-Science").children().css("background-image","url('/images/slider_sci.png')");return true}function cma_init_data(){const pcity=active_city;cma_user_changed=false;cma_enabled=pcity["cma_enabled"];if(cma_enabled){cma_val_sliders=[...pcity["cm_parameter"]["factor"]];cma_min_sliders=[...pcity["cm_parameter"]["minimal_surplus"]];cma_happy_slider=pcity["cm_parameter"]["happy_factor"];cma_celebrate=pcity["cm_parameter"]["require_happy"];cma_allow_specialists=pcity["cm_parameter"]["allow_specialists"];cma_allow_disorder=pcity["cm_parameter"]["allow_disorder"];cma_max_growth=cma_allow_disorder}else{cma_set_default_city_manager()}}function create_cma_sliders(){if(client_is_observer()||client.conn.playing==null)return;for(i=0;i<O_LAST;i++){const name=O_NAME[i];$("#cma-val-slider-"+name).slider({value:cma_val_sliders[i],min:0,max:25});$("#cma-val-slider-"+name).slider("enable");$("#cma-min-slider-"+name).slider({value:cma_min_sliders[i],min:-20,max:20});$("#cma-min-slider-"+name).slider("enable");$("#cma-val-slider-"+name).css("width",160);$("#cma-min-slider-"+name).css("width",160);$("#cma-val-slider-"+name).slider({slide:cma_user_slide,change:cma_user_input});$("#cma-min-slider-"+name).slider({slide:cma_user_slide,change:cma_user_input})}$("#cma-happy-slider").slider({value:cma_happy_slider,min:0,max:50});$("#cma-happy-slider").slider("enable");$("#cma-val-slider-"+name).css("width",160);$("#cma-happy-slider"+name).slider({slide:cma_user_slide,change:cma_user_input})}function create_cma_page(){$("#cma_celebrate").prop("checked",cma_celebrate);$("#cma_celebrate").onchange=cma_user_input;$("#cma_specialists").prop("checked",!cma_allow_specialists);$("#cma_specialists").onchange=cma_user_input;$("#cma_disorder").prop("checked",cma_allow_disorder);$("#cma_disorder").onchange=cma_user_input;cma_set_title();update_dynamic_UI();update_cma_labels();return true}function update_dynamic_UI(){$("#btn_toggle_cma").html=cma_get_status_text(!cma_enabled)+" Governor";if(cma_user_changed){$("#cma_unsaved_warning").html("<b>Warning: current values are not yet saved.</b>");$("#cma_unsaved_warning").show();$("#btn_set_cma").html("<b>Save</b>");global_governor_message=""}else{if(!global_governor_message)$("#cma_unsaved_warning").hide()}}function update_cma_labels(){for(var i=0;i<O_LAST;i++){var name=O_NAME[i];cma_val_sliders[i]=$("#cma-val-slider-"+name).slider("option","value");cma_min_sliders[i]=$("#cma-min-slider-"+name).slider("option","value");$("#"+name+"_val_result").html("<b>"+cma_val_sliders[i]+"</b>");$("#"+name+"_min_result").html("<b>"+cma_min_sliders[i]+"</b>")}cma_happy_slider=$("#cma-happy-slider").slider("option","value");$("#happy_result").html("<b>"+cma_happy_slider+"</b>");cma_set_title();update_dynamic_UI()}function cma_user_input(){cma_user_changed=true;update_cma_state()}function cma_user_slide(){var h,v,m;cma_user_changed=true;for(var i=0;i<O_LAST;i++){var name=O_NAME[i];v=$("#cma-val-slider-"+name).slider("option","value");m=$("#cma-min-slider-"+name).slider("option","value");if(v<cma_val_sliders[i])v--;else if(v>cma_val_sliders[i])v++;if(m<cma_min_sliders[i])m--;else if(m>cma_min_sliders[i])m++;$("#"+name+"_val_result").html("<b>"+v+"</b>");$("#"+name+"_min_result").html("<b>"+m+"</b>")}h=$("#cma-happy-slider").slider("option","value");if(h<cma_happy_slider)h--;else if(h>cma_happy_slider)h++;$("#happy_result").html("<b>"+h+"</b>");cma_set_title();update_dynamic_UI()}function update_cma_state(){cma_celebrate=$("#cma_celebrate").prop("checked");cma_allow_specialists=!$("#cma_specialists").prop("checked");cma_allow_disorder=$("#cma_disorder").prop("checked");update_cma_labels()}function button_pushed_toggle_cma(){cma_enabled=!cma_enabled;cma_apply_once=false;request_new_cma();$("#btn_set_cma").html("Save");gov_refresh_timer=(new Date).getTime()}function button_pushed_cma_save(){cma_enabled=true;cma_apply_once=false;update_cma_state();request_new_cma();$("#btn_set_cma").html("Save");gov_refresh_timer=(new Date).getTime()}function button_pushed_cma_apply(){cma_enabled=true;update_cma_state();cma_apply_once=true;request_new_cma();gov_refresh_timer=(new Date).getTime()}function button_pushed_refresh_cma(){show_city_governor_tab()}function cma_set_title(){dhtml=cma_get_status_icon()+" City Governor <b>"+cma_get_status_text(cma_enabled)+"d</b>.";$("#cma_status").html(dhtml)}function request_new_cma(){var cm_parameter={};cm_parameter["minimal_surplus"]=[...cma_min_sliders];cm_parameter["max_growth"]=cma_max_growth;cm_parameter["require_happy"]=cma_celebrate;cm_parameter["allow_disorder"]=cma_allow_disorder;cm_parameter["allow_specialists"]=cma_allow_specialists;cm_parameter["factor"]=[...cma_val_sliders];cm_parameter["happy_factor"]=cma_happy_slider;var packet={pid:packet_city_manager,city_id:active_city["id"],enabled:cma_enabled,apply_once:cma_apply_once,parameter:cm_parameter};send_request(JSON.stringify(packet));cma_user_changed=false}function cma_set_default_city_manager(){const pcity=active_city;cma_val_sliders=[0,0,0,0,0,0];cma_min_sliders=[0,0,0,0,0,0];cma_celebrate=false;cma_allow_disorder=false;cma_allow_specialists=true;cma_max_growth=false;if(pcity.size>1){if(pcity.size<=game_info.notradesize){cma_val_sliders[O_FOOD]=15}else{if(pcity.granary_size==pcity.food_stock){cma_val_sliders[O_FOOD]=0}else{cma_val_sliders[O_FOOD]=10}}}else{cma_val_sliders[O_FOOD]=20}cma_val_sliders[O_SHIELD]=5;cma_val_sliders[O_TRADE]=0;cma_val_sliders[O_GOLD]=2;cma_val_sliders[O_LUXURY]=0;cma_val_sliders[O_SCIENCE]=2;cma_happy_slider=pcity.size>=3?1:0;if(pcity.granary_size==pcity.food_stock){cma_min_sliders[O_FOOD]=0}else{cma_min_sliders[O_FOOD]=1}cma_min_sliders[O_SHIELD]=1;cma_min_sliders[O_TRADE]=0;cma_min_sliders[O_GOLD]=-20;cma_min_sliders[O_LUXURY]=0;cma_min_sliders[O_SCIENCE]=0}function cma_copy_current(){_cma_val_sliders=[...cma_val_sliders];_cma_min_sliders=[...cma_min_sliders];_cma_happy_slider=cma_happy_slider;_cma_celebrate=cma_celebrate;_cma_allow_disorder=cma_allow_disorder;_cma_allow_specialists=cma_allow_specialists;_cma_max_growth=cma_max_growth;$("#cma_unsaved_warning").html("On-screen settings copied to clipboard.")}function cma_paste_clipboard(){const maxval=25;const min_min=-20;const max_min=20;for(var i=0;i<O_LAST;i++){var name=O_NAME[i];$("#cma-val-slider-"+name).slider({value:_cma_val_sliders[i]});$("#cma-min-slider-"+name).slider({value:_cma_min_sliders[i]})}$("#cma-happy-slider").slider({value:_cma_happy_slider});$("#cma_celebrate").prop("checked",_cma_celebrate);$("#cma_specialists").prop("checked",!_cma_allow_specialists);$("#cma_disorder").prop("checked",_cma_allow_disorder);cma_set_title();update_dynamic_UI();update_cma_labels();cma_user_input()}function cma_paste_to_city_id(city_id,apply_once){var cm_parameter={};cm_parameter["minimal_surplus"]=[..._cma_min_sliders];cm_parameter["max_growth"]=_cma_max_growth;cm_parameter["require_happy"]=_cma_celebrate;cm_parameter["allow_disorder"]=_cma_allow_disorder;cm_parameter["allow_specialists"]=_cma_allow_specialists;cm_parameter["factor"]=[..._cma_val_sliders];cm_parameter["happy_factor"]=_cma_happy_slider;var packet={pid:packet_city_manager,city_id:city_id,enabled:true,apply_once:apply_once,parameter:cm_parameter};send_request(JSON.stringify(packet))}function show_governor_help(){show_dialog_message("Help",gov_help)}function cma_all_cities(apply_once){for(var city_id in cities){if(city_owner_player_id(cities[city_id])==client.conn.playing.playerno){cma_paste_to_city_id(parseInt(city_id),apply_once)}}}function cma_get_status_icon(){return cma_enabled?"&#x2705 ":"&#x274c "}function cma_get_status_text(state){return state?"Enable":"Disable"}function cma_select_tab(city_id){show_city_dialog_by_id(city_id);wait(300);$("#ctg").click()}const default_dialog_text_color="#ccc";const override_colors={Alsatian:{c1:"rgb(237, 41, 57)",c2:"rgb(255, 255, 255)",c3:"rgb(255, 210, 3)"},Armenian:{c1:null,c2:null,c3:"rgb(49, 79, 154)"},Assyrian:{c1:null,c2:"rgb(255, 102, 51)",c3:"rgb(0, 153, 255)"},Australian:{c1:null,c2:null,c3:"rgb(237, 33, 36)"},Austrian:{c1:null,c2:null,c3:"rgb(0, 0, 0)"},Aztec:{c1:null,c2:null,c3:"rgb(54, 74, 144)"},Barbadian:{c1:null,c2:null,c3:"rgb(10, 10, 0)"},Belizean:{c1:null,c2:null,c3:"rgb(207, 17, 38)"},Bhutanese:{c1:null,c2:"rgb(248, 230, 198)",c3:"rgb(226, 61, 40)"},Canadian:{c1:null,c2:null,c3:"rgb(206, 42, 29)"},Carantanian:{c1:null,c2:"rgb(0, 0, 0)",c3:"rgb(255, 0, 0)"},Carthaginian:{c1:null,c2:null,c3:"rgb(0, 25, 63)"},Chola:{c1:null,c2:"rgb(0, 0, 0)",c3:null},Cypriot:{c1:null,c2:null,c3:"rgb(0, 99, 77)"},Dahomean:{c1:null,c2:"rgb(20, 14, 5)",c3:null},Danish:{c1:null,c2:null,c3:"rgb(208, 12, 51)"},Dryad:{c1:null,c2:"rgb(137, 200, 49)",c3:null},Equatoguinean:{c1:null,c2:null,c3:"rgb(84, 103, 228)"},Fijian:{c1:null,c2:null,c3:"rgb(12, 10, 105)"},Flemish:{c1:null,c2:"rgb(0, 0, 0)",c3:null},Formosan:{c1:"rgb(83, 83, 103)",c2:"rgb(255, 212, 42)",c3:"rgb(128, 0, 5)"},Frankish:{c1:null,c2:null,c3:"rgb(0, 0, 153)"},Gaelic:{c1:null,c2:"rgb(231, 161, 10)",c3:null},Ghana:{c1:null,c2:"rgb(94, 48, 25)",c3:"rgb(170, 163, 157)"},"Golden Horde":{c1:null,c2:"rgb(0, 0, 0)",c3:"rgb(212, 0, 0)"},Gothic:{c1:null,c2:"rgb(253, 205, 0)",c3:null},Greek:{c1:null,c2:"rgb(0, 97, 243)",c3:"rgb(0, 102, 81)"},Guanche:{c1:null,c2:"rgb(251, 251, 255)",c3:null},Han:{c1:null,c2:null,c3:"rgb(246, 226, 4)"},Hessian:{c1:null,c2:null,c3:"rgb(0, 0, 0)"},"Holy Roman":{c1:null,c2:"rgb(0, 0, 0)",c3:null},"Indo-European":{c1:null,c2:"rgb(255, 204, 0)",c3:"rgb(214, 96, 22)"},"Italian Greek":{c1:null,c2:"rgb(33, 68, 120)",c3:null},Jaffna:{c1:null,c2:"rgb(255, 255, 255)",c3:null},Jolof:{c1:null,c2:"rgb(227, 27, 35)",c3:null},Khazar:{c1:null,c2:"rgb(223, 234, 248)",c3:null},"Knights Templar":{c1:null,c2:null,c3:"rgb(255, 255, 255)"},Korean:{c1:"rgb(244, 232, 212)",c2:"rgb(63, 56, 169)",c3:"rgb(215, 93, 80)"},Kushan:{c1:null,c2:"rgb(211, 209, 206)",c3:null},Khwarezmian:{c1:null,c2:null,c3:"rgb(35, 159, 67)"},Latvian:{c1:null,c2:"rgb(253, 250, 250)",c3:null},Lorrain:{c1:null,c2:null,c3:"rgb(255, 255, 250)"},Macedon:{c1:null,c2:"rgb(0, 0, 0)",c3:null},Marshallese:{c1:null,c2:"rgb(244, 245, 248)",c3:"rgb(221, 117, 0)"},Mauritian:{c1:"rgb(1, 42, 135)",c2:"rgb(22, 146, 83)",c3:null},Micronesian:{c1:null,c2:"rgb(255,255,255)",c3:null},Milanese:{c1:null,c2:null,c3:"rgb(53, 172, 174)"},Mitanni:{c1:null,c2:"rgb(210,210,210)",c3:"rgb(214, 158, 0)"},Mixtec:{c1:null,c2:null,c3:"rgb(128, 0, 128)"},Mughal:{c1:null,c2:"rgb(252, 209, 22)",c3:"rgb(206, 20, 15)"},Muscovite:{c1:null,c2:"rgb(237, 217, 219)",c3:null},Mwiska:{c1:null,c2:null,c3:"rgb(31, 26, 23)"},"New Zealand":{c1:null,c2:"rgb(207, 27, 26)",c3:"rgb(250, 250, 255)"},Norman:{c1:null,c2:"rgb(252, 239, 60)",c3:"rgb(209, 126, 30)"},Paeonian:{c1:null,c2:"rgb(186, 56, 74)",c3:null},Pictish:{c1:null,c2:null,c3:"rgb(106, 69, 69)"},"Rapa Nui":{c1:"rgb(248, 245, 224)",c2:"rgb(215, 43, 6)",c3:null},Romansh:{c1:"rgb(235, 230, 218)",c2:"rgb(0, 0, 0)",c3:"rgb(0, 57, 173)"},Ryukyuan:{c1:null,c2:null,c3:"rgb(0, 0, 200)"},Samogitian:{c1:null,c2:null,c3:"rgb(0, 0, 0)"},Saudi:{c1:null,c2:"rgb(228, 229, 229)",c3:null},Shan:{c1:null,c2:null,c3:"rgb(58, 119, 40)"},Somali:{c1:null,c2:"rgb(250, 253, 255)",c3:null},Soviet:{c1:null,c2:"rgb(255, 215, 0)",c3:"rgb(204, 0, 0)"},Silesian:{c1:null,c2:null,c3:"rgb(43, 82, 139)"},Sumerian:{c1:null,c2:"rgb(24, 72, 198)",c3:null},Toltec:{c1:null,c2:null,c3:"rgb(25, 13, 17)"},Tyrolian:{c1:null,c2:"rgb(172, 29, 34)",c3:null},UN:{c1:null,c2:"rgb(250, 250, 250)",c3:null},"Volga Bulgar":{c1:null,c2:"rgb(218, 37, 29)",c3:"rgb(243, 244, 208)"},Vampire:{c1:null,c2:"rgb(92, 0, 0)",c3:null},Venetian:{c1:null,c2:"rgb(243, 244, 208)",c3:null},Vermont:{c1:null,c2:"rgb(49, 71, 121)",c3:"rgb(240, 242, 245)"},"West Indian":{c1:null,c2:"rgb(255, 204, 0)",c3:null},LAST:{}};const gov_colors={Anarchy:{1:"#fca364",2:"#721100"},Tribal:{1:"#5cf2f2",2:"#bf8f00"},Tribalism:{1:"#5cf2f2",2:"#bf8f00"},Despotism:{1:"#b08ffb",2:"#240f61"},Monarchy:{1:"#6b72ee",2:"#0011c2"},"Constitutional Monarchy":{1:"#3276ee",2:"#83b0db"},Republic:{1:"#e2dc70",2:"#c00000"},Democracy:{1:"#6aa1e2",2:"#8789B6"},Fundamentalism:{1:"#ffff00",2:"#000"},Theocracy:{1:"#E22864",2:"#322487"},Communism:{1:"#EC0000",2:"#747200"},Nationalism:{1:"#ff720d",2:"#fff17170"},Federation:{1:"#d8d8d8",2:"#6565e5"}};function color_gov_color(gov_name,index){if(gov_colors[gov_name][index])return gov_colors[gov_name][index];else return default_dialog_text_color}function assign_nation_color(nation_id){const RED=0,GRN=1,BLU=2,OPQ=3;var nation=nations[nation_id];if(nation==null||nation["color"]!=null)return;var flag_key="f."+nation["graphic_str"]+"-large";var flag_sprite=sprites[flag_key];if(flag_sprite==null)return;var c=flag_sprite.getContext("2d");var width=tileset[flag_key][2];var height=tileset[flag_key][3];var color_counts={};if(c==null)return;var img_data=c.getImageData(1,1,width-2,height-2).data;for(var i=0;i<img_data.length;i+=4){var current_color="rgb("+img_data[i+RED]+","+img_data[i+GRN]+","+img_data[i+BLU]+")";if(current_color in color_counts){if(img_data[i+OPQ]>128)color_counts[current_color]++}else{if(img_data[i+OPQ]>128)color_counts[current_color]=1;else color_counts[current_color]=0}}var sorted_colors=[];for(var current_color in color_counts){var element={color:current_color,count:color_counts[current_color]};sorted_colors.push(element)}sorted_colors.sort(function(a,b){return b.count-a.count});const discrimination=70;for(i=1;i<sorted_colors.length;i++){for(j=0;j<i;j++){if(color_SSD(sorted_colors[i].color,sorted_colors[j].color)<discrimination){sorted_colors[j].count+=sorted_colors[i].count;sorted_colors[i].count=1}}}for(i=0;i<sorted_colors.length;i++){sorted_colors[i].count*=colorfulness(sorted_colors[i].color)}sorted_colors.sort(function(a,b){return b.count-a.count});if(sorted_colors.length==1)sorted_colors.push(sorted_colors[0]);if(sorted_colors.length==2)sorted_colors.push(sorted_colors[0]);nation["color"]=sorted_colors[0].color;nation["color2"]=sorted_colors[1].color;nation["color3"]=sorted_colors[2].color;color_counts=null;img_data=null;override_color(nation.rule_name,nation_id)}function color_SSD(color_a,color_b){const RED=0,GRN=1,BLU=2,OPQ=3;if(color_a==null||color_b==null)return false;var pcolor_a=color_rgb_to_list(color_a);var pcolor_b=color_rgb_to_list(color_b);var color_distance=Math.sqrt(Math.pow(pcolor_a[RED]-pcolor_b[RED],2)+Math.pow(pcolor_a[GRN]-pcolor_b[GRN],2)+Math.pow(pcolor_a[BLU]-pcolor_b[BLU],2));var hue1=get_hue(pcolor_a[RED],pcolor_a[GRN],pcolor_a[BLU]);var hue2=get_hue(pcolor_b[RED],pcolor_b[GRN],pcolor_b[BLU]);var diff=angular_difference(hue1,hue2);if(diff<60){color_distance/=1.33;if(diff<45)color_distance/=1.33;if(diff<30)color_distance/=1.33}else if(diff>120){color_distance*=1.33;if(diff>135)color_distance*=1.33;if(diff>150)color_distance*=1.33}return color_distance}function get_hue(red,green,blue){var min=Math.min(Math.min(red,green),blue);var max=Math.max(Math.max(red,green),blue);var hue=0;if(min==max)return 0;if(max==red)hue=(green-blue)/(max-min);else if(max==green)hue=2+(blue-red)/(max-min);else hue=4+(red-green)/(max-min);hue*=60;if(hue<0)hue+=360;return Math.round(hue)}function angular_difference(alpha,beta){var phi=Math.abs(beta-alpha)%360;var diff=phi>180?360-phi:phi;return diff}function colorfulness(color){const RED=0,GRN=1,BLU=2,OPQ=3;if(!color)return 0;color=color_rgb_to_list(color);var hue=get_hue(color[RED],color[GRN],color[BLU]);if(color[OPQ]<128)return 0;var colorishness=Math.abs(1-(color[RED]+1)/(color[GRN]+1))+Math.abs(1-(color[RED]+1)/(color[BLU]+1))+Math.abs(1-(color[GRN]+1)/(color[BLU]+1));var non_greyish=Math.abs(color[RED]-128)+Math.abs(color[GRN]-128)+Math.abs(color[RED]-128);var coef=1;if(colorishness<.15&&non_greyish<220)coef=.4285;else if(colorishness<.3&&non_greyish<60)coef=.5714;else if(colorishness<.8&&non_greyish<120)coef=.66;else if(colorishness<.8&&non_greyish>360)coef=.91;else if(colorishness<.8)coef=.8;if(angular_difference(hue,0)<30)coef*=.9;return coef}function color_rgb_to_list(pcolor){if(pcolor==null)return null;if(pcolor.length==3)return pcolor;var color_rgb=pcolor.match(/\d+/g);color_rgb[0]=parseFloat(color_rgb[0]);color_rgb[1]=parseFloat(color_rgb[1]);color_rgb[2]=parseFloat(color_rgb[2]);return color_rgb}function override_color(nation_name,nation_id){var nation=nations[nation_id];if(override_colors[nation_name]){if(override_colors[nation_name]["c1"])nations[nation_id]["color"]=override_colors[nation_name]["c1"];if(override_colors[nation_name]["c2"])nations[nation_id]["color2"]=override_colors[nation_name]["c2"];if(override_colors[nation_name]["c3"])nations[nation_id]["color3"]=override_colors[nation_name]["c3"]}}var connections={};var conn_ping_info={};var debug_ping_list=[];function find_conn_by_id(id){return connections[id]}function client_remove_cli_conn(connection){delete connections[connection["id"]]}function conn_list_append(connection){connections[connection["id"]]=connection}var show_order_buttons=1;const update_focus_delay=500;const update_mouse_cursor_delay=600;var mouse_x;var mouse_y;var prev_mouse_x;var prev_mouse_y;var prev_goto_tile;var mclick_tile;const FORCE_CHECKS_AGAIN=-4;const LAST_FORCED_CHECK=-1;var LAST_GOTO_TILE=null;var LAST_GOTO_TIMESTAMP=0;const GOTO_CLICK_COOLDOWN=475;var keyboard_input=true;var unitpanel_active=false;var allow_right_click=false;var DEBUG_UNITS=false;var touch_device=null;var mapview_mouse_movement=false;var real_mouse_move_mode=false;var touch_drag_mode=false;var last_unit_clicked=-1;var came_from_context_menu=false;var user_marking_mode=false;var last_saved_tile=null;var recent_saved_tile=null;var clicked_city=null;var selector_city=null;var city_paste_target={};var current_focus=[];var urgent_focus_queue=[];var last_focus=null;var goto_active=false;var rally_mode=false;var delayed_goto_active=false;var paradrop_active=false;var airlift_active=false;var connect_active=false;var connect_extra=-1;var connect_activity=ACTIVITY_LAST;var action_tgt_sel_active=false;var goto_last_order=-1;var goto_last_action=-1;var SELECT_POPUP=0;var SELECT_SEA=1;var SELECT_LAND=2;var SELECT_APPEND=3;var intro_click_description=true;var resize_enabled=true;var goto_request_map={};var goto_turns_request_map={};var current_goto_turns=0;var waiting_units_list=[];var show_citybar=true;var context_menu_active=true;var has_movesleft_warning_been_shown=false;var game_unit_panel_state=null;var chat_send_to=-1;var CHAT_ICON_EVERYBODY=String.fromCharCode(62075);var CHAT_ICON_ALLIES=String.fromCharCode(61746);var end_turn_info_message_shown=false;var action_selection_in_progress_for=0;var is_more_user_input_needed=false;function control_init(){urgent_focus_queue=[];touch_device=is_touch_device();mapctrl_init_2d();$(document).keydown(global_keyboard_listener);$(window).resize(mapview_window_resized);$(window).bind("orientationchange resize",orientation_changed);$("#turn_done_button").click(send_end_turn);if(!touch_device)$("#turn_done_button").tooltip();$("#freeciv_logo").click(function(event){window.open("/","_new")});$("#game_text_input").keydown(function(event){return check_text_input(event,$("#game_text_input"))});$("#game_text_input").focus(function(event){keyboard_input=false;resize_enabled=false});$("#game_text_input").blur(function(event){keyboard_input=true;resize_enabled=true});$("#chat_direction").click(function(event){chat_context_change()});$("#pregame_text_input").keydown(function(event){return check_text_input(event,$("#pregame_text_input"))});$("#pregame_text_input").blur(function(event){keyboard_input=true;if(this.value==""){$("#pregame_text_input").value=">"}});$("#pregame_text_input").focus(function(event){keyboard_input=false;if(this.value==">")this.value=""});$("#start_game_button").click(function(event){pregame_start_game()});$("#load_game_button").click(function(event){show_load_game_dialog()});$("#pick_nation_button").click(function(event){pick_nation(null)});$("#pregame_settings_button").click(function(event){pregame_settings()});$("#tech_canvas").mousedown(function(event){tech_mapview_mouse_click(event)});document.onselectstart=function(){return false};window.addEventListener("contextmenu",function(e){if(e.target!=null&&(e.target.id=="game_text_input"||e.target.id=="overview_map"||e.target.id=="replay_result"||e.target.parent!=null&&e.target.parent.id=="game_message_area"))return;if(!allow_right_click)e.preventDefault()},false);var context_options={selector:"#canvas",zIndex:5e3,autoHide:true,callback:function(key,options){handle_context_menu_callback(key)},build:function($trigger,e){if(!context_menu_active){context_menu_active=true;return false}var unit_actions=update_unit_order_commands();return{callback:function(key,options){handle_context_menu_callback(key)},items:unit_actions}}};if(!touch_device){context_options["position"]=function(opt,x,y){if(touch_device)return;var new_top=mouse_y+$("#canvas_div").offset().top;new_top=mouse_y+$("#canvas").offset().top;opt.$menu.css({top:new_top,left:mouse_x})}}$.contextMenu(context_options);$(window).on("unload",function(){network_stop()});$("#map_tab").click(function(event){setTimeout(set_default_mapview_active,5)});$("#empire_tab").click(function(event){set_default_mapview_inactive();update_empire_screen()});$("#civ_tab").click(function(event){set_default_mapview_inactive();init_civ_dialog()});$("#tech_tab").click(function(event){set_default_mapview_inactive();update_tech_screen()});$("#players_tab").click(function(event){set_default_mapview_inactive();update_nation_screen()});$("#cities_tab").click(function(event){set_default_mapview_inactive();update_city_screen()});$("#warcalc_tab").click(function(event){set_default_mapview_inactive();warcalc_screen()});$("#opt_tab").click(function(event){$("#tabs-hel").hide();init_options_dialog();set_default_mapview_inactive()});$("#hel_tab").click(function(event){set_default_mapview_inactive();show_help()});$("#chat_tab").click(function(event){set_default_mapview_inactive();$("widgetbot").height($(window).height()-100)});if(!touch_device){$("#game_unit_orders_default").tooltip()}$("#overview_map").click(function(e){var x=e.pageX-$(this).offset().left;var y=e.pageY-$(this).offset().top;overview_clicked(x,y)});$("#send_message_button").click(function(e){show_send_private_message_dialog()});$("#intelligence_report_button").click(function(e){show_intelligence_report_dialog()});$("#meet_player_button").click(nation_meet_clicked);$("#view_player_button").click(center_on_player);$("#cancel_treaty_button").click(cancel_treaty_clicked);$("#withdraw_vision_button").click(withdraw_vision_clicked);$("#take_player_button").click(take_player_clicked);$("#toggle_ai_button").click(toggle_ai_clicked);$("#game_scores_button").click(view_game_scores);$("#nations_list").on("click","tbody tr",handle_nation_table_select);$("#tabs>ul>li").off("keydown");$("#tabs>div").off("keydown");$("#game_unit_orders_default").hide();replace_capital_i=simpleStorage.get("capI");if(replace_capital_i==null){replace_capital_i=false;simpleStorage.set("capI",replace_capital_i)}empire_bldg_tab_saved_mag=simpleStorage.get("bldgZoom");if(empire_bldg_tab_saved_mag==null){empire_bldg_tab_saved_mag=0;simpleStorage.set("bldgZoom",empire_bldg_tab_saved_mag)}empire_upkp_tab_saved_mag=simpleStorage.get("upkpZoom");if(empire_upkp_tab_saved_mag==null){empire_upkp_tab_saved_mag=0;simpleStorage.set("upkpZoom",empire_upkp_tab_saved_mag)}empire_wklst_tab_saved_mag=simpleStorage.get("wklZoom");if(empire_wklst_tab_saved_mag==null){empire_wklst_tab_saved_mag=0;simpleStorage.set("wklZoom",empire_wklst_tab_saved_mag)}show_empire_tab=simpleStorage.get("showEmpire");if(show_empire_tab)$("#ui-id-2").show();else $("#ui-id-2").hide();$("#ui-id-8").hide()}function is_touch_device(){if("ontouchstart"in window||"onmsgesturechange"in window||window.DocumentTouch&&document instanceof DocumentTouch){return true}else{return false}}function blur_input_on_touchdevice(){if(touch_device||is_small_screen()){$("input[type=text], textarea").blur()}}function mouse_moved_cb(e){if(mapview_slide!=null&&mapview_slide["active"])return;mouse_x=0;mouse_y=0;if(e.pageX||e.pageY){mouse_x=e.pageX;mouse_y=e.pageY}else{if(e.clientX||e.clientY){mouse_x=e.clientX;mouse_y=e.clientY}}if(active_city==null&&mapview_canvas!=null&&$("#canvas").length){mouse_x=mouse_x-$("#canvas").offset().left;mouse_y=mouse_y-$("#canvas").offset().top;if(mapview_mouse_movement&&!goto_active){var diff_x=(touch_start_x-mouse_x)*2;var diff_y=(touch_start_y-mouse_y)*2;mapview["gui_x0"]+=diff_x;mapview["gui_y0"]+=diff_y;touch_start_x=mouse_x;touch_start_y=mouse_y;update_mouse_cursor()}}else if(active_city!=null&&city_canvas!=null&&$("#city_canvas").length){mouse_x=mouse_x-$("#city_canvas").offset().left;mouse_y=mouse_y-$("#city_canvas").offset().top}if(client.conn.playing==null)return;if(C_S_RUNNING==client_state()){update_mouse_cursor()}if(map_select_check&&Math.abs(mouse_x-map_select_x)>45&&Math.abs(mouse_y-map_select_y)>45&&(new Date).getTime()-map_select_check_started>200){map_select_active=true}}function update_mouse_cursor(){if(tech_dialog_active&&!touch_device){update_tech_dialog_cursor();real_mouse_move_mode=false;return}var ptile=canvas_pos_to_tile(mouse_x,mouse_y);if(ptile==null)return;real_mouse_move_mode=false;var punit=find_visible_unit(ptile);var pcity=tile_city(ptile);if(mapview_mouse_movement&&!goto_active&&!came_from_context_menu){$("#canvas_div").css("cursor","move");real_mouse_move_mode=true}else if(goto_active&&current_goto_turns!=null){$("#canvas_div").css("cursor","crosshair")}else if(goto_active&&current_goto_turns==null){$("#canvas_div").css("cursor","not-allowed")}else if(pcity!=null&&client.conn.playing!=null&&city_owner_player_id(pcity)==client.conn.playing.playerno){$("#canvas_div").css("cursor","pointer")}else if(punit!=null&&client.conn.playing!=null&&punit["owner"]==client.conn.playing.playerno){$("#canvas_div").css("cursor","pointer")}else{$("#canvas_div").css("cursor","default")}}function chat_context_change(){var recipients=chat_context_get_recipients();if(recipients.length<4){chat_context_set_next(recipients)}else{chat_context_dialog_show(recipients)}}function chat_context_get_recipients(){var allies=false;var pm=[];pm.push({id:null,flag:null,description:"Everybody"});var self=-1;if(client.conn.playing!=null){self=client.conn.playing["playerno"]}for(var player_id in players){if(player_id==self)continue;var pplayer=players[player_id];if(pplayer["flags"].isSet(PLRF_AI))continue;if(!pplayer["is_alive"])continue;if(is_longturn()&&pplayer["name"].indexOf("NewAvailablePlayer")!=-1)continue;var nation=nations[pplayer["nation"]];if(nation==null)continue;pm.push({id:player_id,description:pplayer["name"]+" of the "+nation["adjective"],flag:sprites["f."+nation["graphic_str"]]});if(diplstates[player_id]==DS_ALLIANCE){allies=true}}if(allies&&self>=0){pm.push({id:self,flag:null,description:"Allies"})}pm.sort(function(a,b){if(a.id==null)return-1;if(b.id==null)return 1;if(a.id==self)return-1;if(b.id==self)return 1;if(a.description<b.description)return-1;if(a.description>b.description)return 1;return 0});return pm}function chat_context_set_next(recipients){var next=0;while(next<recipients.length&&recipients[next].id!=chat_send_to){next++}next++;if(next>=recipients.length){next=0}set_chat_direction(recipients[next].id)}function chat_context_dialog_show(recipients){var dlg=$("#chat_context_dialog");if(dlg.length>0){remove_active_dialog("#chat_context_dialog")}$("<div id='chat_context_dialog' title='Choose chat recipient'></div>").appendTo("div#game_page");var self=-1;if(client.conn.playing!=null){self=client.conn.playing["playerno"]}var tbody_el=document.createElement("tbody");var add_row=function(id,flag,description){var flag_canvas,ctx,row,cell;row=document.createElement("tr");cell=document.createElement("td");flag_canvas=document.createElement("canvas");flag_canvas.width=30;flag_canvas.height=20;ctx=flag_canvas.getContext("2d");if(flag!=null){ctx.drawImage(flag,0,0)}cell.appendChild(flag_canvas);row.appendChild(cell);cell=document.createElement("td");cell.appendChild(document.createTextNode(description));row.appendChild(cell);if(id!=null){$(row).data("chatSendTo",id)}tbody_el.appendChild(row);return ctx};for(var i=0;i<recipients.length;i++){if(recipients[i].id!=chat_send_to){var ctx=add_row(recipients[i].id,recipients[i].flag,recipients[i].description);if(recipients[i].id==null||recipients[i].id==self){ctx.font="18px FontAwesome";ctx.fillStyle="rgba(32, 32, 32, 1)";if(recipients[i].id==null){ctx.fillText(CHAT_ICON_EVERYBODY,5,15)}else{ctx.fillText(CHAT_ICON_ALLIES,8,16)}}}}var table=document.createElement("table");table.appendChild(tbody_el);$(table).on("click","tbody tr",handle_chat_direction_chosen);$(table).appendTo("#chat_context_dialog");$("#chat_context_dialog").dialog({bgiframe:true,modal:false,maxHeight:.9*$(window).height()}).dialogExtend({minimizable:true,closable:true,icons:{minimize:"ui-icon-circle-minus",restore:"ui-icon-bullet"}});$("#chat_context_dialog").dialog("open");dialog_register("#chat_context_dialog")}function handle_chat_direction_chosen(ev){var new_send_to=$(this).data("chatSendTo");remove_active_dialog("#chat_context_dialog");if(new_send_to==null){set_chat_direction(null)}else{set_chat_direction(parseFloat(new_send_to))}}function set_chat_direction(player_id){if(player_id==chat_send_to)return;var player_name;var icon=$("#chat_direction");if(icon.length<=0)return;var ctx=icon[0].getContext("2d");if(player_id==null||player_id<0){player_id=null;ctx.clearRect(0,0,30,20);ctx.font="18px FontAwesome";ctx.fillStyle="rgba(192, 192, 192, 1)";ctx.fillText(CHAT_ICON_EVERYBODY,7,15);player_name="everybody"}else if(client.conn.playing!=null&&player_id==client.conn.playing["playerno"]){ctx.clearRect(0,0,30,20);ctx.font="18px FontAwesome";ctx.fillStyle="rgba(192, 192, 192, 1)";ctx.fillText(CHAT_ICON_ALLIES,10,16);player_name="allies"}else{var pplayer=players[player_id];if(pplayer==null)return;player_name=pplayer["name"]+" of the "+nations[pplayer["nation"]]["adjective"];ctx.clearRect(0,0,30,20);var flag=sprites["f."+nations[pplayer["nation"]]["graphic_str"]];if(flag!=null){ctx.drawImage(flag,0,0)}}icon.attr("title","Sending messages to "+player_name);chat_send_to=player_id;if(player_id!=null||player_name!="everybody")$("#game_text_input").focus()}function encode_message_text(message){if(message.includes("%%%tile")||message.includes("%%%unit")){message=message.replace(new RegExp("%%%tile","g"),"%%tile");message=message.replace(new RegExp("%%%unit","g"),"%%unit");if(client.conn.playing&&client.conn.playing["name"]){message=client.conn.playing["name"]+": "+message}}message=message.replace(/^\s+|\s+$/g,"");message=message.replace(/&/g,"&amp;");message=message.replace(/'/g,"&apos;");message=message.replace(/"/g,"&quot;");message=message.replace(/</g,"&lt;");message=message.replace(/>/g,"&gt;");return encodeURIComponent(message)}function is_unprefixed_message(message){if(message===null)return false;if(message.length===0)return true;var first=message.charAt(0);if(first==="/"||first==="."||first===":")return false;var quoted_pos=-1;if(first==='"'||first==="'"){quoted_pos=message.indexOf(first,1)}var private_mark=message.indexOf(":",quoted_pos);if(private_mark<0)return true;var space_pos=message.indexOf(" ",quoted_pos);return space_pos!==-1&&space_pos<private_mark}function check_text_input(event,chatboxtextarea){if(event.keyCode==13&&event.shiftKey==0){var message=$(chatboxtextarea).val();if(chat_send_to!=null&&chat_send_to>=0&&is_unprefixed_message(message)){if(client.conn.playing!=null&&chat_send_to==client.conn.playing["playerno"]){message=". "+encode_message_text(message)}else{var pplayer=players[chat_send_to];if(pplayer==null){set_chat_direction(null);return}var player_name=pplayer["name"];var badchars=[" ",'"',"'"];for(var c in badchars){var i=player_name.indexOf(badchars[c]);if(i>0){player_name=player_name.substring(0,i)}}message=player_name+encode_message_text(": "+message)}}else{message=encode_message_text(message)}$(chatboxtextarea).val("");if(!touch_device)$(chatboxtextarea).focus();keyboard_input=true;if(message.length>=4&&message===message.toUpperCase()){return}if(message.length>=max_chat_message_length){message_log.update({event:E_LOG_ERROR,message:"Error! The message is too long. Limit: "+max_chat_message_length});return}send_message(message);return false}}function should_ask_server_for_actions(punit){return punit["action_decision_want"]===ACT_DEC_ACTIVE||punit["action_decision_want"]===ACT_DEC_PASSIVE&&popup_actor_arrival}function can_ask_server_for_actions(){return action_selection_in_progress_for===IDENTITY_NUMBER_ZERO}function ask_server_for_actions(punit){var ptile;if(observing||punit==null){return false}if(action_selection_in_progress_for!=IDENTITY_NUMBER_ZERO){console.log("Unit %d started action selection before unit %d was done",action_selection_in_progress_for,punit.id)}action_selection_in_progress_for=punit.id;ptile=index_to_tile(punit["action_decision_tile"]);if(punit!=null&&ptile!=null){var packet={pid:packet_unit_get_actions,actor_unit_id:punit["id"],target_unit_id:IDENTITY_NUMBER_ZERO,target_tile_id:punit["action_decision_tile"],target_extra_id:EXTRA_NONE,disturb_player:true};send_request(JSON.stringify(packet))}}function action_selection_no_longer_in_progress(old_actor_id){if(old_actor_id!=action_selection_in_progress_for&&old_actor_id!=IDENTITY_NUMBER_ZERO&&action_selection_in_progress_for!=IDENTITY_NUMBER_ZERO){console.log("Decision taken for %d but selection is for %d.",old_actor_id,action_selection_in_progress_for)}action_selection_in_progress_for=IDENTITY_NUMBER_ZERO;is_more_user_input_needed=false}function action_decision_clear_want(old_actor_id){var old=game_find_unit_by_number(old_actor_id);if(old!=null&&old["action_decision_want"]!==ACT_DEC_NOTHING){var unqueue={pid:packet_unit_sscs_set,unit_id:old_actor_id,type:USSDT_UNQUEUE,value:IDENTITY_NUMBER_ZERO};send_request(JSON.stringify(unqueue))}}function action_selection_next_in_focus(old_actor_id){for(var i=0;i<current_focus.length;i++){var funit=current_focus[i];if(old_actor_id!=funit["id"]&&should_ask_server_for_actions(funit)){ask_server_for_actions(funit);return}}}function action_decision_request(actor_unit){if(actor_unit==null){console.log("action_decision_request(): No actor unit");return}if(!unit_is_in_focus(actor_unit)){unit_focus_urgent(actor_unit)}else if(can_client_issue_orders()&&can_ask_server_for_actions()){ask_server_for_actions(actor_unit)}}function get_focus_unit_on_tile(ptile){var funits=get_units_in_focus();if(funits==null)return null;for(var i=0;i<funits.length;i++){var punit=funits[i];if(punit["tile"]==ptile["index"]){return punit}}return null}function unit_is_in_focus(cunit){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];if(punit["id"]==cunit["id"]){return true}}return false}function unit_is_only_unit_in_focus(cunit){var funits=get_units_in_focus();if(funits.length==0||funits.length>=2)return false;var punit=funits[0];if(punit["id"]==cunit["id"]){return true}return false}function get_units_in_focus(){return current_focus}function unit_focus_urgent(punit){if(punit==null||punit["activity"]==null){console.log("unit_focus_urgent(): not a unit");console.log(punit);return}urgent_focus_queue.push(punit)}function control_unit_killed(punit){if(unit_is_in_focus(punit)){current_focus=unit_list_without(current_focus,punit);update_active_units_dialog();update_unit_order_commands()}if(urgent_focus_queue!=null){urgent_focus_queue=unit_list_without(urgent_focus_queue,punit)}if(current_focus!=null&&current_focus.length<1){advance_unit_focus(false)}}function unit_may_have_lost_focus(){if(action_selection_in_progress_for!=IDENTITY_NUMBER_ZERO&&current_focus.findIndex(unit=>unit.id==action_selection_in_progress_for)==-1){action_selection_close(true)}}function update_unit_focus(){if(active_city!=null)return;if(C_S_RUNNING!=client_state())return;if(!can_ask_server_for_actions()){if(get_units_in_focus().length<1){console.log("update_unit_focus(): action selection dialog open for"+" unit %d but unit not in focus?",action_selection_in_progress_for)}else{return}}var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];if(punit["movesleft"]>0&&punit["done_moving"]==false&&punit["ai"]==false&&punit["activity"]==ACTIVITY_IDLE){return}}advance_unit_focus(false)}function advance_unit_focus(same_type){var candidate=null;var i;console.log("T%d. advance_unit_focus(). urgent_focus_queue[%d] waiting_units_list[%d]",game_info.turn,urgent_focus_queue.length,waiting_units_list.length);if(client_is_observer())return;if(urgent_focus_queue.length>0){console.log("  urgent_focus_queue[%d] processing...",urgent_focus_queue.length);var focus_tile=current_focus!=null&&current_focus.length>0?current_focus[0]["tile"]:-1;for(i=0;i<urgent_focus_queue.length;i++){var punit=units[urgent_focus_queue[i]["id"]];if((ACTIVITY_IDLE!=punit.activity||punit.has_orders)&&!should_ask_server_for_actions(punit)){urgent_focus_queue=unit_list_without(urgent_focus_queue,punit);i--}else if(-1==focus_tile||focus_tile==punit["tile"]){candidate=punit;break}else if(null==candidate){candidate=punit}}if(null!=candidate){urgent_focus_queue=unit_list_without(urgent_focus_queue,punit);console.log("    removed candidate:%d urgent_focus_queue[%d]",candidate.id,urgent_focus_queue.length)}console.log("    finished urgent_focus_queue[%d]. candidate:%d",urgent_focus_queue.length,candidate?candidate.id:"null")}if(candidate==null){candidate=find_best_focus_candidate(false,same_type);console.log("  non-urgent processing #1. urgent_focus_queue[%d] waiting_units_list[%d]",urgent_focus_queue.length,waiting_units_list.length);console.log("    find_best_focus_candidate(false) yields candidate:%d",candidate?candidate.id:"null")}if(candidate==null){candidate=find_best_focus_candidate(true,same_type);console.log("  non-urgent processing #2. candidate:%d",candidate?candidate.id:"null");console.log("    find_best_focus_candidate(true) yields candidate:%d",candidate?candidate.id:"null")}came_from_context_menu=false;if(candidate!=null){console.log("CLEAN-UP and EXIT for successful new candidate:%d\n",candidate?candidate.id:"null");console.log(" ");clear_all_modes();clear_goto_tiles();save_last_unit_focus();set_unit_focus_and_redraw(candidate)}else{console.log("NO FOCUS CANDIDATE FOUND. It's the end of the road, time for a drink.\n");console.log(" ");deactivate_goto(false);save_last_unit_focus();current_focus=[];unit_may_have_lost_focus();update_active_units_dialog();$("#game_unit_orders_default").hide();if(touch_device||is_small_screen()){$("#turn_done_button").button("option","label","<i class='fa fa-check-circle-o' style='color: green;'aria-hidden='true'></i>Done")}else{$("#turn_done_button").button("option","label","<i class='fa fa-check-circle-o' style='color: green;'aria-hidden='true'></i> Turn Done")}console.log("Reached END OF WAITING LISTS. end_turn_info_message_shown == (%s) ",end_turn_info_message_shown);if(!end_turn_info_message_shown){end_turn_info_message_shown=true;message_log.update({event:E_BEGINNER_HELP,message:'All units have moved, click the "Turn Done" button to end your turn.'})}}}function clear_all_modes(){goto_active=false;rally_mode=false;connect_active=false;connect_extra=-1;connect_activity=ACTIVITY_LAST;action_tgt_sel_active=false;delayed_goto_active=false;paradrop_active=false;airlift_active=false;goto_last_order=ORDER_LAST;goto_last_action=ACTION_COUNT}function advance_focus_inactive_units(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];waiting_units_list.push(punit["id"])}if(client_is_observer()){return}var candidate=find_inactive_focus_candidate();came_from_context_menu=false;if(candidate!=null){clear_all_modes();clear_goto_tiles();save_last_unit_focus();set_unit_focus_and_redraw(candidate)}else{deactivate_goto(false);save_last_unit_focus();current_focus=[];unit_may_have_lost_focus();waiting_units_list=[];update_active_units_dialog();$("#game_unit_orders_default").hide()}}function button_more_orders(){show_order_buttons=2;update_unit_order_commands()}function button_less_orders(){show_order_buttons=1;update_unit_order_commands()}function button_hide_panels(){show_order_buttons=0;$("#game_unit_orders_default").hide();$("#game_status_panel_bottom").hide()}function update_unit_order_commands(){if(client_is_observer()||client.conn.playing==null){$("#game_unit_orders_default").hide();return}var i,r;var punit;var ptype;var pcity;var ptile;var unit_actions={};var disband_type=0;var funits=get_units_in_focus();if(funits!=null){for(i=0;i<funits.length;i++){punit=funits[i];ptile=index_to_tile(punit["tile"]);if(ptile==null)continue;pcity=tile_city(ptile);if(pcity!=null){unit_actions["show_city"]={name:"Show city"}}}}if(funits.length<1){$("#game_unit_orders_default").hide();return}switch(show_order_buttons){case 0:$("#game_unit_orders_default").hide();$("#game_status_panel_bottom").hide();break;case 1:$("#game_unit_orders_default").show();$("#order_more").show();$("#order_less").hide();$("#order_disband").hide();break;case 2:$("#game_unit_orders_default").show();$("#order_less").show();$("#order_more").hide();$("#order_disband").show();break}$("#order_upgrade").hide();$("#order_convert").hide();$("#order_maglev").hide();$("#order_quay").hide();$("#order_canal").hide();$("#order_well").hide();$("#order_fortress").hide();$("#order_buoy").hide();$("#order_hideout").hide();$("#order_navalbase").hide();$("#order_airbase").hide();$("#order_radar").hide();$("#order_road").hide();$("#order_seabridge").hide();$("#order_railroad").hide();$("#order_mine").hide();$("#order_fortify").hide();$("#order_vigil").hide();$("#order_irrigate").hide();$("#order_transform").hide();$("#order_build_farmland").hide();$("#order_auto_settlers").hide();$("#order_explore").hide();$("#order_pollution").hide();$("#order_fallout").hide();$("#order_forest_remove").hide();$("#order_plant_forest").hide();$("#order_oil_well").hide();$("#order_make_swamp").hide();$("#order_noorders").hide();$("#order_cancel_orders").hide();$("#order_wait").hide();$("#order_sentry").hide();$("#order_load").hide();$("#order_unload").hide();$("#order_activate_cargo").hide();$("#order_airlift").hide();$("#order_airlift_disabled").hide();if(funits==null)return;var terrain_name;var oceanic=false;for(i=0;i<funits.length;i++){punit=funits[i];ptype=unit_type(punit);ptile=index_to_tile(punit["tile"]);terrain_name=tile_terrain(ptile)["name"];if(ptile==null)continue;pcity=tile_city(ptile);if(utype_can_do_action(ptype,ACTION_FOUND_CITY)&&pcity==null){$("#order_build_city").show();$("#order_build_city").attr("title","Build new city (B)");unit_actions["build"]={name:"Build City (B)"}}else if(utype_can_do_action(ptype,ACTION_JOIN_CITY)&&pcity!=null){$("#order_build_city").show();$("#order_build_city").attr("title","Join city (B)");unit_actions["build"]={name:"Join City (B)"}}else{$("#order_build_city").hide()}if(ptype["name"]=="Explorer"){unit_actions["explore"]={name:"Auto Explore (X)"};$("#order_explore").show()}if(client_rules_flag[CRF_MP2_UNIT_CONVERSIONS]){if(ptype["name"]=="Leader"||ptype["name"]=="Queen"||governments[client.conn.playing["government"]]["name"]=="Communism"&&(ptype["name"]=="Workers"||ptype["name"]=="Riflemen")&&tech_known("Communism")||ptype["name"]=="Anti-Aircraft Artillery"&&pcity!=null&&city_owner_player_id(pcity)==client.conn.playing.playerno&&tech_known("Space Flight")&&(city_has_building(pcity,improvement_id_by_name(B_PALACE_NAME))||city_has_building(pcity,improvement_id_by_name(B_ECC_PALACE_NAME)))){$("#order_convert").show();unit_actions["convert"]={name:"Convert (shift-O)"}}}}if(touch_device)unit_actions=$.extend(unit_actions,{exit:{name:"Exit Menu"}});unit_actions=$.extend(unit_actions,{goto:{name:"Goto (G)"},tile_info:{name:"Tile info"}});for(i=0;i<funits.length;i++){punit=funits[i];ptype=unit_type(punit);var worker_type=false;var infra_type=false;if(ptype["name"]=="Workers"||ptype["name"]=="Migrants"||ptype["name"]=="Tribesmen"&&client_rules_flag[CRF_MP2_C]||ptype["name"]=="Proletarians"&&governments[client.conn.playing["government"]]["name"]=="Communism"){worker_type=true;infra_type=true}else if(ptype["name"]=="Settlers"||ptype["name"]=="Engineers"){infra_type=true}ptile=index_to_tile(punit["tile"]);terrain_name=tile_terrain(ptile)["name"];oceanic=is_ocean_tile(ptile);if(ptile==null)continue;pcity=tile_city(ptile);const HIDEOUTS=typeof EXTRA_!=="undefined"&&client_rules_flag[CRF_EXTRA_HIDEOUT]&&server_settings["hideouts"]["val"];const FORTS=typeof EXTRA_FORT!=="undefined";const FORTRESSES=typeof EXTRA_FORTRESS!=="undefined";const NAVALBASES=typeof EXTRA_NAVALBASE!=="undefined";const CASTLES=typeof EXTRA_CASTLE!=="undefined";const BUNKERS=typeof EXTRA_BUNKER!=="undefined";const AIRBASES=typeof EXTRA_AIRBASE!=="undefined";const BUOYS=typeof EXTRA_BUOY!=="undefined";const RADAR=typeof EXTRA_RADAR!=="undefined";const QUAYS=typeof EXTRA_QUAY!=="undefined";const HIDEOUT_TECH=tech_known("Warrior Code");const FORT_TECH=tech_known("Construction")||tech_known("Masonry")&&client_rules_flag[CRF_MASONRY_FORT];const FORTRESS_TECH=tech_known("Construction");const NAVALBASE_TECH=tech_known("Engineering");const CASTLE_TECH=tech_known("Construction")&&tech_known("Feudalism")&&!tech_known("Gunpowder");const BUNKER_TECH=tech_known("Steel");const AIRBASE_TECH=tech_known("Radio");const BUOY_TECH=tech_known("Radio");const RADAR_TECH=tech_known("Radar");const TILE_HAS_HIDEOUT=HIDEOUTS&&tile_has_extra(ptile,EXTRA_);const TILE_HAS_FORT=FORTS&&tile_has_extra(ptile,EXTRA_FORT);const TILE_HAS_FORTRESS=FORTRESSES&&tile_has_extra(ptile,EXTRA_FORTRESS);const TILE_HAS_NAVALBASE=NAVALBASES&&tile_has_extra(ptile,EXTRA_NAVALBASE);const TILE_HAS_CASTLE=CASTLES&&tile_has_extra(ptile,EXTRA_CASTLE);const TILE_HAS_BUNKER=BUNKERS&&tile_has_extra(ptile,EXTRA_BUNKER);const TILE_HAS_AIRBASE=AIRBASES&&tile_has_extra(ptile,EXTRA_AIRBASE);const TILE_HAS_BUOY=BUOYS&&tile_has_extra(ptile,EXTRA_BUOY);const TILE_HAS_RADAR=RADAR&&tile_has_extra(ptile,EXTRA_RADAR);const TILE_HAS_RIVER=tile_has_extra(ptile,EXTRA_RIVER);const NO_RIVER_BASE=client_rules_flag[CRF_NO_BASES_ON_RIVERS];const TILE_HAS_OVERFORT=TILE_HAS_FORTRESS||TILE_HAS_NAVALBASE||TILE_HAS_CASTLE||TILE_HAS_BUNKER;const CAN_TILE_HIDEOUT=!pcity&&!oceanic&&HIDEOUTS&&!TILE_HAS_HIDEOUT&&!does_tile_have_base(ptile)&&(!QUAYS||!tile_has_extra(ptile,EXTRA_QUAY))&&(ptile["owner"]==UNCLAIMED_LAND||ptile["owner"]==client.conn.playing.playerno)&&(terrain_name=="Mountains"||terrain_name=="Forest"||terrain_name=="Jungle"||terrain_name=="Swamp")&&!(TILE_HAS_RIVER&&NO_RIVER_BASE);const CAN_TILE_FORT=!pcity&&!oceanic&&FORTS&&!TILE_HAS_FORT&&!TILE_HAS_OVERFORT&&!(TILE_HAS_RIVER&&NO_RIVER_BASE);const CAN_TILE_FORTRESS=!pcity&&!oceanic&&FORTRESSES&&(!FORTS||TILE_HAS_FORT)&&(!TILE_HAS_FORTRESS||TILE_HAS_BUNKER)&&!TILE_HAS_NAVALBASE&&!TILE_HAS_CASTLE&&!(TILE_HAS_RIVER&&NO_RIVER_BASE);const CAN_TILE_NAVALBASE=!pcity&&!oceanic&&NAVALBASES&&TILE_HAS_FORT&&!TILE_HAS_OVERFORT&&!(TILE_HAS_RIVER&&NO_RIVER_BASE);const CAN_TILE_CASTLE=!pcity&&!oceanic&&CASTLES&&!TILE_HAS_CASTLE&&!TILE_HAS_BUNKER&&TILE_HAS_FORTRESS&&!(TILE_HAS_RIVER&&NO_RIVER_BASE);const CAN_TILE_BUNKER=!pcity&&!oceanic&&BUNKERS&&!TILE_HAS_BUNKER&&!TILE_HAS_CASTLE&&TILE_HAS_FORTRESS&&!(TILE_HAS_RIVER&&NO_RIVER_BASE);const CAN_TILE_AIRBASE=!pcity&&!oceanic&&AIRBASES&&!TILE_HAS_AIRBASE&&!(TILE_HAS_RIVER&&NO_RIVER_BASE);const CAN_TILE_BUOY=!pcity&&oceanic&&BUOYS&&!TILE_HAS_BUOY&&!(TILE_HAS_RIVER&&NO_RIVER_BASE);const CAN_TILE_RADAR=!pcity&&!oceanic&&RADAR&&!TILE_HAS_RADAR&&TILE_HAS_AIRBASE&&!(TILE_HAS_RIVER&&NO_RIVER_BASE);const UNIT_CAN_HIDEOUT=CAN_TILE_HIDEOUT&&HIDEOUT_TECH&&utype_has_flag(ptype,UTYF_FOOTSOLDIER);const UNIT_CAN_FORT=CAN_TILE_FORT&&FORT_TECH&&(worker_type||infra_type||ptype["name"]=="Legion"&&client_rules_flag[CRF_LEGION_WORK]||ptype["name"]=="Marines"&&client_rules_flag[CRF_MARINE_BASES]);const UNIT_CAN_FORTRESS=CAN_TILE_FORTRESS&&FORTRESS_TECH&&(worker_type||infra_type||ptype["name"]=="Legion"&&client_rules_flag[CRF_LEGION_WORK]);const UNIT_CAN_NAVALBASE=CAN_TILE_NAVALBASE&&NAVALBASE_TECH&&(worker_type||infra_type||ptype["name"]=="Legion"&&client_rules_flag[CRF_LEGION_WORK])&&can_build_naval_base(punit,ptile);const UNIT_CAN_CASTLE=CAN_TILE_CASTLE&&CASTLE_TECH&&(worker_type||infra_type);const UNIT_CAN_BUNKER=CAN_TILE_BUNKER&&BUNKER_TECH&&(worker_type||infra_type);const UNIT_CAN_AIRBASE=CAN_TILE_AIRBASE&&AIRBASE_TECH&&(worker_type||infra_type||ptype["name"]=="Marines"&&client_rules_flag[CRF_MARINE_BASES])&&ptype["name"]!="Settlers";const UNIT_CAN_BUOY=CAN_TILE_BUOY&&BUOY_TECH&&(worker_type||infra_type)&&ptype["name"]!="Settlers";const UNIT_CAN_RADAR=CAN_TILE_RADAR&&RADAR_TECH&&(worker_type||infra_type)&&ptype["name"]!="Settlers";if(UNIT_CAN_HIDEOUT){unit_actions["hideout"]={name:"Hideout (Shift-H)"};$("#order_hideout").show()}if(UNIT_CAN_FORT){unit_actions["fortress"]={name:"Build Fort (Shift-F)"};$("#order_fortress").show();$("#order_fortress").prop("title","Build Fort (Shift-F)")}else if(UNIT_CAN_FORTRESS){if(TILE_HAS_BUNKER){unit_actions["fortress"]={name:"Remove Bunker (Shift-F)"};$("#order_fortress").prop("title","Remove Bunker (Shift-F)")}else{unit_actions["fortress"]={name:"Build Fortress (Shift-F)"};$("#order_fortress").prop("title","Build Fortress (Shift-F)")}$("#order_fortress").show()}else if(UNIT_CAN_CASTLE){unit_actions["fortress"]={name:"Build Castle (Shift-F)"};$("#order_fortress").show();$("#order_fortress").prop("title","Build Castle (Shift-F)")}else if(UNIT_CAN_BUNKER){unit_actions["fortress"]={name:"Build Bunker (Shift-F)"};$("#order_fortress").show();$("#order_fortress").prop("title","Build Bunker (Shift-F)")}else if(UNIT_CAN_BUOY){unit_actions["fortress"]={name:"Lay Buoy (Shift-F)"};$("#order_buoy").show()}if(UNIT_CAN_NAVALBASE){unit_actions["navalbase"]={name:"Naval Base (Shift-N)"};$("#order_navalbase").show()}if(UNIT_CAN_AIRBASE){unit_actions["airbase"]={name:"Build Airbase (Shift-E)"};if(worker_type||infra_type){if(show_order_buttons==2)$("#order_airbase").show()}else $("#order_airbase").show()}if(UNIT_CAN_RADAR){unit_actions["airbase"]={name:"Build Radar (Shift-E)"};$("#order_radar").show()}if(pcity){disband_type=1;$("#order_disband").prop("title","Recycle Unit (Shift-D)");$("#order_disband").html("<a href='#' onclick='key_unit_disband();'><img src='/images/orders/disband_recycle.png' name='disband_button' alt='' border='0' width='30' height='30'></a>");if(client_rules_flag[CRF_MP2_C]){if(ptype["name"]=="Goods"||ptype["name"]=="Well-Digger"||ptype["name"]=="Tribesmen"||ptype["name"]=="Freight"){$("#order_disband").show();var city_prod_name=get_city_production_type(pcity)["name"];if(!city_prod_name)city_prod_name="Production";$("#order_disband").prop("title","Help Build "+city_prod_name+" (Shift-D)")}}}else{disband_type=0;$("#order_disband").prop("title","Disband (Shift-D)");$("#order_disband").html("<a href='#' onclick='key_unit_disband();'><img src='/images/orders/disband_default.png' name='disband_button' alt='' border='0' width='30' height='30'></a>")}if(client_rules_flag[CRF_LEGION_WORK]&&ptype["name"]=="Legion"){if(!tile_has_extra(ptile,EXTRA_ROAD)){const domestic=ptile["owner"]==client.conn.playing.playerno;const has_river=tile_has_extra(ptile,EXTRA_RIVER);const knows_bridges=tech_known("Bridge Building");var show=false;if(!domestic)show=true;else if(tile_has_extra(ptile,EXTRA_FORT))show=true;if(has_river&&!knows_bridges)show=false;if(show){$("#order_road").show();unit_actions["road"]={name:"Road (R)"}}else $("#order_road").hide()}}if(get_what_can_unit_pillage_from(punit,ptile).length>0&&(pcity==null||city_owner_player_id(pcity)!==client.conn.playing.playerno)){var pillage_title=unit_has_dual_pillage_options(punit)?"Pillage / "+unit_get_pillage_name(punit):unit_get_pillage_name(punit);$("#order_pillage").prop("title",pillage_title+" (Shift-P)");$("#order_pillage").show();unit_actions["pillage"]={name:pillage_title+" (Shift-P)"}}else{$("#order_pillage").hide()}if(punit.activity!=ACTIVITY_IDLE||punit.ai||punit.has_orders){unit_actions["idle"]={name:"Cancel orders (Shift-J)"};$("#order_cancel_orders").show()}else{unit_actions["noorders"]={name:"No orders (J)"};$("#order_noorders").show();$("#order_wait").show()}if(infra_type||worker_type){if(ptype["name"]=="Settlers")unit_actions["autosettlers"]={name:"Auto settler (A)"};if(worker_type==true)unit_actions["autosettlers"]={name:"Auto workers (A)"};if(ptype["name"]=="Engineers")unit_actions["autosettlers"]={name:"Auto engineers (A)"};if(show_order_buttons==1)$("#order_pillage").hide();if(show_order_buttons==1)$("#order_noorders").hide();if(!tile_has_extra(ptile,EXTRA_ROAD)){if(!client_rules_flag[CRF_SEABRIDGE]||!tile_has_extra(ptile,EXTRA_SEABRIDGE)){$("#order_road").show();$("#order_railroad").hide();if(!(tile_has_extra(ptile,EXTRA_RIVER)&&!tech_known("Bridge Building"))){unit_actions["road"]={name:"Road (R)"}}}}else if(tech_known("Railroad")&&(tile_has_extra(ptile,EXTRA_ROAD)||client_rules_flag[CRF_SEABRIDGE]&&tile_has_extra(ptile,EXTRA_SEABRIDGE))&&!tile_has_extra(ptile,EXTRA_RAIL)){$("#order_road").hide();$("#order_railroad").show();unit_actions["railroad"]={name:"Railroad (R)"}}else if(can_build_maglev(punit,ptile)){$("#order_road").hide();$("#order_railroad").hide();$("#order_maglev").show();unit_actions["maglev"]={name:"MagLev (R)"}}else{$("#order_road").hide();$("#order_railroad").hide()}if(can_build_sea_bridge(punit,ptile)){unit_actions["road"]={name:"Sea Bridge (R)"};$("#order_seabridge").prop("title","Build Sea Bridge (R)");$("#order_seabridge").show();$("#order_road").hide()}else $("#order_road").prop("title","Build Road (R)");if(tile_has_extra(ptile,EXTRA_RIVER)&&!tech_known("Bridge Building")){$("#order_road").hide()}$("#order_fortify").hide();if(show_order_buttons==1)$("#order_explore").hide();if(show_order_buttons==2)$("#order_sentry").show();if(show_order_buttons==2)$("#order_auto_settlers").show();if((terrain_name=="Hills"||terrain_name=="Mountains")&&!tile_has_extra(ptile,EXTRA_MINE)){$("#order_mine").show();unit_actions["mine"]={name:"Mine (M)"}}else if(terrain_name=="Desert"&&!tile_has_extra(ptile,EXTRA_OIL_WELL)&&tech_known("Construction")){$("#order_oil_well").show();unit_actions["mine"]={name:"Oil Well (M)"}}else if(terrain_name=="Grassland"||terrain_name=="Plains"||terrain_name=="Swamp"||terrain_name=="Jungle"){unit_actions["mine"]={name:"plant Forest (M)"};$("#order_plant_forest").show()}else if(terrain_name=="Forest"){unit_actions["mine"]={name:"make Swamp (M)"};if(show_order_buttons==2)$("#order_make_swamp").show()}if(tile_has_extra(ptile,EXTRA_FALLOUT)){unit_actions["fallout"]={name:"clean Fallout (N)"};$("#order_fallout").show()}if(tile_has_extra(ptile,EXTRA_POLLUTION)){$("#order_pollution").show();unit_actions["pollution"]={name:"clean Pollution (P)"}}else{$("#order_pollution").hide()}if(terrain_name=="Forest"){$("#order_forest_remove").show();$("#order_irrigate").hide();$("#order_build_farmland").hide();unit_actions["forest"]={name:"Chop Forest (I)"}}else if(can_irrigate(punit,ptile)){$("#order_irrigate").show();$("#order_forest_remove").hide();$("#order_build_farmland").hide();if(terrain_name=="Swamp")unit_actions["irrigation"]={name:"drain Swamp (I)"};else unit_actions["irrigation"]={name:"Irrigation (I)"}}else if(tile_has_extra(ptile,EXTRA_IRRIGATION)&&!tile_has_extra(ptile,EXTRA_FARMLAND)&&tech_known("Refrigeration")){$("#order_build_farmland").show();$("#order_irrigate").hide();$("#order_forest_remove").hide();unit_actions["irrigation"]={name:"Farmland (I)"}}else{$("#order_forest_remove").hide();$("#order_irrigate").hide();$("#order_build_farmland").hide()}}else{if(utype_can_do_action(ptype,ACTION_FORTIFY)){$("#order_fortify").show();unit_actions["fortify"]={name:"Fortify (F)"}}$("#order_sentry").show();if(unit_can_vigil(punit)){$("#order_vigil").show();unit_actions["vigil"]={name:"Vigil (Shift-I)"}}}if(show_order_buttons==2)$("#order_explore").show();if(client_rules_flag[CRF_CANALS]){if(can_build_canal(punit,ptile)){$("#order_canal").show();unit_actions["canal"]={name:"Canal"}}}if(client_rules_flag[CRF_EXTRA_QUAY]){if(can_build_quay(punit,ptile)){$("#order_quay").show();unit_actions["quay"]={name:"Build Quay (Q)"}}}if(unit_types[punit["type"]]["name"]=="Well-Digger"){$("#order_fortify").hide();delete unit_actions["fortify"];if(show_order_buttons==1){$("#order_sentry").hide();$("#order_noorders").hide()}if(can_build_well(punit,ptile)){$("#order_well").show();unit_actions["well"]={name:"dig Well"}}var is_lowland=terrain_name!="Hills"&&terrain_name!="Mountains";if(is_lowland&&tile_owner(ptile)==punit["owner"]&&can_irrigate(punit,ptile)){$("#order_irrigate").show();unit_actions["irrigation"]={name:"Irrigation (I)"}}}unit_actions["action_selection"]={name:"Do... (D)"};if(utype_can_do_action(ptype,ACTION_TRANSFORM_TERRAIN)){$("#order_transform").show();unit_actions["transform"]={name:"Transform terrain (O)"}}else{$("#order_transform").hide()}if(utype_can_do_action(ptype,ACTION_NUKE)){$("#order_nuke").show();unit_actions["nuke"]={name:"Detonate Nuke At (Shift-N)"}}else{$("#order_nuke").hide()}if(utype_can_do_action(ptype,ACTION_PARADROP)&&punit["movesleft"]>0){$("#order_paradrop").show();unit_actions["paradrop"]={name:"Paradrop (P)"}}else{$("#order_paradrop").hide()}if(pcity==null||punit["homecity"]===0||punit["homecity"]===pcity["id"]){$("#order_change_homecity").hide()}else if(pcity!=null&&punit["homecity"]!=pcity["id"]){$("#order_change_homecity").show();unit_actions["homecity"]={name:"Homecity (H)"}}if(pcity!=null&&city_has_building(pcity,improvement_id_by_name(B_AIRPORT_NAME))){if(pcity["airlift"]>0&&punit["movesleft"]>0){unit_actions["airlift"]={name:"Airlift (Shift-L)"};$("#order_airlift").show()}else{$("#order_airlift_disabled").show()}}if(pcity!=null&&ptype!=null&&unit_types[ptype["obsoleted_by"]]!=null&&can_player_build_unit_direct(client.conn.playing,unit_types[ptype["obsoleted_by"]])){var upgrade_type=unit_types[ptype["obsoleted_by"]];for(var upgrade_counter=1;upgrade_counter<=7;upgrade_counter++){if(upgrade_type!=null&&unit_types[upgrade_type["obsoleted_by"]]!=null){if(can_player_build_unit_direct(client.conn.playing,unit_types[upgrade_type["obsoleted_by"]])){upgrade_type=unit_types[upgrade_type["obsoleted_by"]]}else{break}}}var upgrade_name=upgrade_type["name"];var upgrade_cost=Math.floor(upgrade_type["build_cost"]-Math.floor(ptype["build_cost"]/2));upgrade_cost=2*upgrade_cost+Math.floor(upgrade_cost*upgrade_cost/20);var cost_adjust=0;if(client_rules_flag[CRF_TESLA_UPGRADE_DISCOUNT]){if(player_has_wonder(client.conn.playing.playerno,improvement_id_by_name(B_TESLAS_LABORATORY))){cost_adjust-=20}}if(client_rules_flag[CRF_RECYCLING_DISCOUNT]){if(tech_known("Recycling")){cost_adjust-=20}}if(client_rules_flag[CRF_MP2_C]&&governments[client.conn.playing["government"]]["name"]=="Nationalism"){cost_adjust-=25}upgrade_cost=Math.floor(upgrade_cost*(100+cost_adjust)/100);unit_actions["upgrade"]={name:"Upgrade to "+upgrade_name+" for "+upgrade_cost+" (U)"};$("#order_upgrade").attr("title","Upgrade to "+upgrade_name+" for "+upgrade_cost+" (U)");$("#order_upgrade").show()}if(ptype!=null&&ptype["name"]!="Explorer"){unit_actions["explore"]={name:"Auto explore (X)"}}var uclass=get_unit_class_name(punit);var never_transportable=uclass=="Sea"||uclass=="RiverShip"||uclass=="Submarine"||uclass=="Trireme";if(true&&!punit["transported"]&&!never_transportable){var units_on_tile=tile_units(ptile);for(var r=0;r<units_on_tile.length;r++){var tunit=units_on_tile[r];if(tunit["id"]==punit["id"])continue;var ntype=unit_type(tunit);if(ntype["transport_capacity"]>0){unit_actions["unit_load"]={name:"Load on transport (L)"};$("#order_load").show()}}}var units_on_tile=tile_units(ptile);if(units_on_tile){if(ptype["transport_capacity"]>0&&units_on_tile.length>=2){for(var r=0;r<units_on_tile.length;r++){var tunit=units_on_tile[r];if(tunit["transported"]){unit_actions["unit_show_cargo"]={name:"Select Cargo (Shift-U)"};if(utype_has_flag(unit_types[tunit["type"]],UTYF_MARINES)&&!is_ocean_tile(ptile)){unit_actions["unit_unload"]={name:"Unload Transport (T)"};$("#order_unload").show()}else if(pcity!=null){unit_actions["unit_unload"]={name:"Unload Transport (T)"};$("#order_unload").show()}else{if(typeof EXTRA_NAVALBASE!=="undefined"){if(tile_has_extra(ptile,EXTRA_NAVALBASE)){unit_actions["unit_unload"]={name:"Unload Transport (T)"};$("#order_unload").show()}}if(client_rules_flag[CRF_EXTRA_QUAY]){if(tile_has_extra(ptile,EXTRA_QUAY)){unit_actions["unit_unload"]={name:"Unload Transport (T)"};$("#order_unload").show()}}if(unit_types[punit["type"]]["name"]=="Airplane"&&tile_has_extra(ptile,EXTRA_AIRBASE)){unit_actions["unit_unload"]={name:"Unload Transport (T)"};$("#order_unload").show()}$("#order_activate_cargo").show()}}}}}}var num_tile_units=tile_units(ptile);if(num_tile_units!=null){if(num_tile_units.length>=2&&!touch_device){unit_actions=$.extend(unit_actions,{select_all_tile:{name:"Select all on tile (V)"},select_all_type:{name:"Select same type (Shift-V)"}})}}if(is_longturn()&&ptype["move_rate"]!=punit["movesleft"]){unit_actions["delaygoto"]={name:"delay Goto (shift-G)"}}unit_actions=$.extend(unit_actions,{sentry:{name:"Sentry (S)"},wait:{name:"Wait (W)"},disband:{name:disband_type?"Recycle Unit (Shift-D)":"Disband (Shift-D)"}});$(".context-menu-list").css("z-index",5e3);return unit_actions}function init_game_unit_panel(){if(observing)return;unitpanel_active=true;$("#game_unit_panel").dialog({bgiframe:true,modal:false,width:is_small_screen()?$(window).width():"370px",maxWidth:"100%",height:"auto",resizable:false,closeOnEscape:false,dialogClass:"unit_dialog  no-close",position:{my:"right bottom",at:"right bottom",of:window,within:$("#tabs-map")},appendTo:"#tabs-map",close:function(event,ui){unitpanel_active=false}}).dialogExtend({minimizable:true,closable:false,minimize:function(evt,dlg){game_unit_panel_state=$("#game_unit_panel").dialogExtend("state");$(".unit_dialog").css("float","right");$(".unit_dialog").css({height:"25",width:25});unobstruct_minimized_dialog_continer()},restore:function(evt,dlg){game_unit_panel_state=$("#game_unit_panel").dialogExtend("state");$(".unit_dialog").css({height:"auto",width:"140"});$(".unit_dialog").css("float","left");$(".unit_dialog").css({position:{my:"right bottom",at:"right bottom",of:window,within:$("#tabs-map")}});update_active_units_dialog()},icons:{minimize:"ui-icon-circle-minus",restore:"ui-icon-bullet"}});if(is_small_screen())$("#game_unit_panel").parent().css({"max-width":"100%"});$("#game_unit_panel").dialog("open");$("#game_unit_panel").parent().css("overflow","hidden");if(game_unit_panel_state=="minimized")$("#game_unit_panel").dialogExtend("minimize");$("#game_unit_panel").parent().children().not("#game_unit_panel").children().get(0).innerHTML="<div style='font-size:90%; vertical-align:top;'>&#x265F;</div>";update_active_units_dialog()}function find_best_focus_candidate(accept_current,same_type){try{var punit;var i;if(client_is_observer())return null;var sorted_units=[];for(var unit_id in units){punit=units[unit_id];if(client.conn.playing!=null&&punit["owner"]==client.conn.playing.playerno){sorted_units.push(punit)}}sorted_units.sort(unit_distance_compare);for(i=0;i<sorted_units.length;i++){punit=sorted_units[i];if((!unit_is_in_focus(punit)||accept_current)&&client.conn.playing!=null&&punit["owner"]==client.conn.playing.playerno&&punit["activity"]==ACTIVITY_IDLE&&punit["movesleft"]>0&&punit["done_moving"]==false&&punit["ai"]==false&&waiting_units_list.indexOf(punit["id"])<0&&punit["transported"]==false&&(!same_type||unit_type(punit)["name"]==unit_type(current_focus[0])["name"])){return punit}}for(i=0;i<waiting_units_list.length;i++){punit=game_find_unit_by_number(waiting_units_list[i]);if(punit!=null&&punit["movesleft"]>0&&(!same_type||unit_type(punit)["name"]==unit_type(current_focus[0])["name"])){waiting_units_list.splice(i,1);return punit}}}catch(err){waiting_units_list=[];console.log(err);console.log("error in find_best_focus_candidate");console.log(unit_type(last_focus)["name"]);console.log(unit_type(punit)["name"])}return null}function find_inactive_focus_candidate(){var punit;var i;if(client_is_observer())return null;var sorted_units=[];for(var unit_id in units){punit=units[unit_id];if(client.conn.playing!=null&&punit["owner"]==client.conn.playing.playerno){sorted_units.push(punit)}}sorted_units.sort(unit_distance_compare);for(i=0;i<sorted_units.length;i++){punit=sorted_units[i];if(!unit_is_in_focus(punit)&&client.conn.playing!=null&&punit["owner"]==client.conn.playing.playerno&&waiting_units_list.indexOf(punit["id"])<0&&(punit["activity"]!=ACTIVITY_IDLE||punit["transported"]==true||punit["movesleft"]<=0||punit["done_moving"]==true)&&punit["ai"]==false){return punit}}return null}function unit_distance_compare(unit_a,unit_b){if(unit_a==null||unit_b==null){if(unit_a!=null)return-1;if(unit_b!=null)return 1;return 0}var ptile_a=index_to_tile(unit_a["tile"]);var ptile_b=index_to_tile(unit_b["tile"]);if(ptile_a==null||ptile_b==null){if(ptile_a!=null)return-1;if(ptile_b!=null)return 1;return 0}if(ptile_a["x"]==ptile_b["x"]&&ptile_a["y"]==ptile_b["y"]){return 0}else{var i_focus=0;var ref_tile=null;while(i_focus<current_focus.length&&(ref_tile=tiles[current_focus[i_focus].tile])==null){i_focus++}if(ref_tile==null){ref_tile=canvas_pos_to_nearest_tile(mapview.width/2,mapview.height/2)}var ref_a=map_distance_vector(ref_tile,ptile_a);var ref_b=map_distance_vector(ref_tile,ptile_b);ref_a=map_vector_to_distance(ref_a[0],ref_a[1]);ref_b=map_vector_to_distance(ref_b[0],ref_b[1]);if(ref_a!=ref_b)return ref_a-ref_b;if(ptile_a.x!=ptile_b.x)return ptile_a.x-ptile_b.x;return ptile_a.y-ptile_b.y}}function set_unit_id_focus(id){if(units[id]){set_unit_focus(units[id]);auto_center_on_focus_unit()}}function set_unit_focus(punit){save_last_unit_focus();current_focus=[];unit_may_have_lost_focus();if(punit==null){current_focus=[]}else{current_focus[0]=punit;action_selection_next_in_focus(IDENTITY_NUMBER_ZERO)}if(punit)warcalc_set_default_vals(punit);update_active_units_dialog();update_unit_order_commands()}function click_unit_in_panel(e,punit){if(e.shiftKey){if(client.conn.playing!=null&&punit["owner"]==client.conn.playing.playerno){var index=current_focus.findIndex(x=>x.id==punit.id);if(index===-1){current_focus.push(punit)}else{current_focus.splice(index,1);unit_may_have_lost_focus()}}auto_center_on_focus_unit();update_active_units_dialog();update_unit_order_commands();if(current_focus.length>0&&$("#game_unit_orders_default").length>0&&show_order_buttons){$("#game_unit_orders_default").show()}}else set_unit_focus_and_redraw(punit)}function set_unit_focus_and_redraw(punit){save_last_unit_focus();current_focus=[];if(punit==null){current_focus=[];unit_may_have_lost_focus()}else{current_focus[0]=punit;unit_may_have_lost_focus();action_selection_next_in_focus(IDENTITY_NUMBER_ZERO);warcalc_set_default_vals(punit)}last_saved_tile=recent_saved_tile;if(punit!=null)recent_saved_tile=index_to_tile(punit["tile"]);auto_center_on_focus_unit();update_active_units_dialog();update_unit_order_commands();if(current_focus.length>0&&$("#game_unit_orders_default").length>0&&show_order_buttons){$("#game_unit_orders_default").show()}}function set_unit_focus_and_activate(punit){if(punit!=null){set_unit_focus_and_redraw(punit)}}function city_dialog_activate_unit(punit){if(TAB_MAP===$("#tabs").tabs("option","active")){close_city_dialog_trigger()}else{$("#ui-id-1").trigger("click");close_city_dialog_trigger()}set_unit_focus_and_redraw(punit)}function auto_center_on_focus_unit(){if(active_city!=null)return;var ptile=find_a_focus_unit_tile_to_center_on();if(ptile!=null&&auto_center_on_unit){center_tile_mapcanvas(ptile)}}function auto_center_last_location(){map_select_active=false;map_select_check=false;mapview_mouse_movement=false;if(active_city!=null)return;if(last_saved_tile==null)return;center_tile_mapcanvas(last_saved_tile);var temp=last_saved_tile;last_saved_tile=recent_saved_tile;recent_saved_tile=temp}function find_a_focus_unit_tile_to_center_on(){var funit=current_focus[0];if(funit==null)return null;return index_to_tile(funit["tile"])}function find_visible_unit(ptile){var i;if(ptile==null||unit_list_size(tile_units(ptile))==0){return null}var pfocus=get_focus_unit_on_tile(ptile);if(pfocus!=null){return pfocus}if(tile_city(ptile)!=null){return null}var vunits=tile_units(ptile);for(i=0;i<vunits.length;i++){var aunit=vunits[i];if(aunit["anim_list"]!=null&&aunit["anim_list"].length>0){return aunit}}for(i=0;i<vunits.length;i++){var tunit=vunits[i];if(tunit["transported"]==false){return tunit}}return tile_units(ptile)[0]}function get_drawable_unit(ptile,citymode){var punit=find_visible_unit(ptile);if(punit==null)return null;if(!unit_is_in_focus(punit)||current_focus.length>0){return punit}else{return null}}function order_wants_direction(order,act_id,ptile){var action=actions[act_id];if(order==ORDER_PERFORM_ACTION&&action==null){console.log("Asked to put invalid action "+act_id+" in an order.");return false}switch(order){case ORDER_MOVE:case ORDER_ACTION_MOVE:return true;case ORDER_PERFORM_ACTION:if(action["min_distance"]>0){return true}if(action["max_distance"]<1){return false}if(tile_city(ptile)!=null||tile_units(ptile).length!=0){return true}return false;default:return false}}function copy_tile_target_for_prod(canvas_x,canvas_y){if(client.conn.playing==null)return;var ptile=canvas_pos_to_tile(canvas_x,canvas_y);if(ptile==null||client.conn.playing==null)return;var pcity=tile_city(ptile);var name="Target unable to be";if(pcity!=null&&pcity["owner"]==client.conn.playing.playerno){city_paste_target={};city_paste_target["production_kind"]=pcity["production_kind"];city_paste_target["production_value"]=pcity["production_value"];if(pcity["production_kind"]==VUT_UTYPE)name=unit_types[pcity["production_value"]]["name"];else if(pcity["production_kind"]==VUT_IMPROVEMENT)name=improvements[pcity["production_value"]]["name"];add_client_message(name+" copied to clipboard.")}else{var sunits=tile_units(ptile);var own_unit_index=-1;var player_has_own_unit_present=false;if(sunits!=null&&sunits.length>0){var own_unit_index=-1;for(var u=0;u<sunits.length;u++){if(sunits[u]["owner"]==client.conn.playing.playerno){own_unit_index=u;player_has_own_unit_present=true}if(player_has_own_unit_present)break}var selected_index=own_unit_index==-1?0:own_unit_index;city_paste_target["production_kind"]=VUT_UTYPE;city_paste_target["production_value"]=sunits[selected_index]["type"];name=unit_types[sunits[selected_index]["type"]]["name"];add_client_message(name+" copied to clipboard.")}}}function paste_tile_target_for_prod(canvas_x,canvas_y){if(client.conn.playing==null)return;if(!city_paste_target||client.conn.playing==null)return;if(!city_paste_target["production_kind"]||!city_paste_target["production_value"])return;var ptile=canvas_pos_to_tile(canvas_x,canvas_y);if(ptile==null)return;var pcity=tile_city(ptile);if(!pcity||pcity["owner"]!=client.conn.playing.playerno)return;send_city_change(pcity["id"],city_paste_target["production_kind"],city_paste_target["production_value"])}function worked_tile_click(ptile){var work_city_id=ptile["worked"];if(work_city_id)selector_city=work_city_id;if(!selector_city)return;draw_city_output=true;var packet=null;if(ptile["worked"]!=0){packet={pid:packet_city_make_specialist,city_id:work_city_id,tile_id:ptile["index"]}}else{packet={pid:packet_city_make_worker,city_id:selector_city,tile_id:ptile["index"]}}send_request(JSON.stringify(packet))}function do_map_click(ptile,qtype,first_time_called){var punit;var packet;var pcity=tile_city(ptile);var player_has_own_unit_present=false;if(real_mouse_move_mode==true)return;if(ptile==null||client_is_observer())return;if(mouse_click_mod_key["shiftKey"]&&mouse_click_mod_key["ctrlKey"]&&!mouse_click_mod_key["altKey"]){worked_tile_click(ptile);return}if(!mouse_click_mod_key["shiftKey"]&&mouse_click_mod_key["ctrlKey"]&&!mouse_click_mod_key["altKey"]){pcity=null}if(user_marking_mode){if(!ptile)return;var usermark=null;const tkey="cPlan"+ptile["index"];if(myGameVars[tkey]){usermark=null}else{if(mouse_click_mod_key["shiftKey"])usermark=USER_MARK_2;else if(mouse_click_mod_key["altKey"])usermark=USER_MARK_4;else if(mouse_click_mod_key["ctrlKey"])usermark=USER_MARK_3;else usermark=USER_MARK_1}if(usermark)myGameVars[tkey]=usermark;else delete myGameVars[tkey];simpleStorage.set(Game_UID,myGameVars);return}if(action_tgt_sel_active&&current_focus.length>0){request_unit_act_sel_vs(ptile);clear_all_modes();action_tgt_sel_active=false;paradrop_active=false;airlift_active=false;return}if(current_focus.length>0&&current_focus[0]["tile"]==ptile["index"]){if(goto_active){deactivate_goto(false)}if(!mouse_click_mod_key["shiftKey"]){if(!should_ask_server_for_actions(current_focus[0])&&(pcity||unit_click_menu||last_unit_clicked==current_focus[0]["id"])){if(pcity){if(city_click_goto_cooldown(ptile))$("#canvas").contextMenu()}else $("#canvas").contextMenu();if(touch_device||!touch_device){last_unit_clicked=-2;came_from_context_menu=true}}}else if(!mouse_click_mod_key["shiftKey"]&&unit_click_menu&&!should_ask_server_for_actions(current_focus[0])){if(pcity){if(city_click_goto_cooldown(ptile))$("#canvas_div").contextMenu()}else $("#canvas_div").contextMenu()}if(!mouse_click_mod_key["shiftKey"]){last_unit_clicked=last_unit_clicked==-2?-1:current_focus[0]["id"];if(focuslock&&current_focus)center_tile_mapcanvas(unit_tile(current_focus[0]));return}}var sunits=tile_units(ptile);last_unit_clicked=-1;if(!$(".context-menu-list").is(":visible")){came_from_context_menu=false}if(goto_active){if(current_focus.length>0){if(pcity){LAST_GOTO_TILE=ptile;LAST_GOTO_TIMESTAMP=Date.now()}for(var s=0;s<current_focus.length;s++){punit=current_focus[s];var goto_path=goto_request_map[punit["id"]+","+ptile["x"]+","+ptile["y"]];if(goto_path){if(unit_has_type_flag(punit,UTYF_COAST)&&punit["fuel"]>0&&!delayed_goto_active){if(goto_path["dir"]&&goto_path["dir"][0]&&goto_path["dir"][0]==-1){goto_path["dir"].shift();goto_path["length"]--}}else if(delayed_goto_active){if(!unit_has_moved(punit)){add_client_message(unit_type(punit)["name"]+" must first move and have less than full moves left.");goto_path=null;return}else{goto_path["dir"].unshift(-1);goto_path["length"]++}}}var old_tile=index_to_tile(punit["tile"]);var tile_dx=ptile["x"]-old_tile["x"];var tile_dy=ptile["y"]-old_tile["y"];var true_goto_path_length;if(goto_path!=null&&goto_path.length!=null)true_goto_path_length=unit_types[punit["type"]]["fuel"]==0?goto_path.length:goto_path.length-1;else true_goto_path_length=0;if(Math.abs(tile_dx)<=1&&Math.abs(tile_dy)<=1&&goto_last_action!=ACTION_NUKE&&!connect_active&&true_goto_path_length<=1){console.log("GO TO overridden because adjacent tile.");switch(tile_dy){case 0:switch(tile_dx){case 0:break;case-1:key_unit_move_focus_index(DIR8_WEST,s);break;case 1:key_unit_move_focus_index(DIR8_EAST,s);break}break;case 1:switch(tile_dx){case 0:key_unit_move_focus_index(DIR8_SOUTH,s);break;case-1:key_unit_move_focus_index(DIR8_SOUTHWEST,s);break;case 1:key_unit_move_focus_index(DIR8_SOUTHEAST,s);break}break;case-1:switch(tile_dx){case 0:key_unit_move_focus_index(DIR8_NORTH,s);break;case-1:key_unit_move_focus_index(DIR8_NORTHWEST,s);break;case 1:key_unit_move_focus_index(DIR8_NORTHEAST,s);break}break}continue}if(goto_path==null){continue}packet={pid:packet_unit_orders,unit_id:punit["id"],src_tile:old_tile["index"],length:goto_path["length"],repeat:false,vigilant:false,dest_tile:ptile["index"]};var order={order:ORDER_LAST,activity:ACTIVITY_LAST,sub_target:0,action:ACTION_COUNT,dir:-1};packet["orders"]=[];for(var i=0;i<goto_path["length"];i++){if(goto_path["dir"][i]==-1){order["order"]=ORDER_FULL_MP}else if(i+1!=goto_path["length"]){order["order"]=ORDER_MOVE}else{order["order"]=ORDER_ACTION_MOVE}order["dir"]=goto_path["dir"][i];order["activity"]=ACTIVITY_LAST;order["sub_target"]=0;order["action"]=ACTION_COUNT;packet["orders"][i]=Object.assign({},order)}if(goto_last_order!=ORDER_LAST){var pos;if(!order_wants_direction(goto_last_order,goto_last_action,ptile)){pos=packet["length"];packet["length"]=packet["length"]+1;order["order"]=ORDER_LAST;order["dir"]=-1;order["activity"]=ACTIVITY_LAST;order["sub_target"]=0;order["action"]=ACTION_COUNT}else{pos=packet["length"]-1}order["order"]=goto_last_order;order["action"]=goto_last_action;packet["orders"][pos]=Object.assign({},order)}goto_last_order=ORDER_LAST;goto_last_action=ACTION_COUNT;if(punit["id"]!=goto_path["unit_id"]){console.log("Error: Tried to order unit "+punit["id"]+" to move along a path made for unit "+goto_path["unit_id"]);return}if(connect_active){packet=create_connect_packet(packet);connect_active=false;connect_activity=ACTIVITY_LAST;connect_extra=-1}send_request(JSON.stringify(packet));if(punit["movesleft"]>0&&!delayed_goto_active&&punit["owner"]==client.conn.playing.playerno){unit_move_sound_play(punit)}else if(!has_movesleft_warning_been_shown){has_movesleft_warning_been_shown=true;var ptype=unit_type(punit);message_log.update({event:E_BAD_COMMAND,message:ptype["name"]+" has no moves left. Press turn done for the next turn."})}}clear_goto_tiles()}else if(touch_device){if(current_focus.length>0){request_goto_path(current_focus[0]["id"],ptile["x"],ptile["y"]);if(first_time_called){setTimeout(function(){do_map_click(ptile,qtype,false)},250)}return}}deactivate_goto(true)}else if(paradrop_active&&current_focus.length>0){punit=current_focus[0];action_decision_clear_want(punit["id"]);packet={pid:packet_unit_do_action,actor_id:punit["id"],target_id:ptile["index"],extra_id:EXTRA_NONE,sub_tgt_id:0,name:"",action_type:ACTION_PARADROP};send_request(JSON.stringify(packet));if(focuslock)focuslock_unit();paradrop_active=false}else if(airlift_active&&current_focus.length>0){for(var a=0;a<current_focus.length;a++){punit=current_focus[a];pcity=tile_city(ptile);if(pcity!=null){action_decision_clear_want(punit["id"]);packet={pid:packet_unit_do_action,actor_id:punit["id"],target_id:pcity["id"],extra_id:EXTRA_NONE,sub_tgt_id:0,name:"",action_type:ACTION_AIRLIFT};send_request(JSON.stringify(packet))}}airlift_active=false}else{if(pcity!=null){if(pcity["owner"]==client.conn.playing.playerno&&!mouse_click_mod_key["shiftKey"]){if(sunits!=null&&sunits.length>0&&sunits[0]["activity"]==ACTIVITY_IDLE&&sunits[0]["owner"]==client.conn.playing.playerno&&sunits[0]["movesleft"]>0){set_unit_focus_and_redraw(sunits[0]);if(city_click_goto_cooldown(ptile)&&!should_ask_server_for_actions(sunits[0])){$("#canvas").contextMenu()}return}else if(!goto_active){if(sunits.length&&sunits[0]["owner"]!=client.conn.playing.playerno){if(city_click_goto_cooldown(ptile))show_city_dialog(pcity);return}else{if(city_click_goto_cooldown(ptile))show_city_dialog(pcity);return}}console.log("Clicked our own city but we didn't select a unit, it wasn't a GOTO move order click,"+" and for some reason we're still not showing the city dialog.");return}}if(sunits!=null&&sunits.length==0){if(!mouse_click_mod_key["shiftKey"]){set_unit_focus_and_redraw(null)}}else if(sunits!=null&&sunits.length>0){var own_unit_index=-1;for(var u=0;u<sunits.length;u++){if(sunits[u]["owner"]==client.conn.playing.playerno){own_unit_index=u;player_has_own_unit_present=true;if(!mouse_click_mod_key["shiftKey"]&&focuslock)center_tile_mapcanvas(unit_tile(sunits[u]))}if(player_has_own_unit_present)break}if(player_has_own_unit_present){if(mouse_click_mod_key["shiftKey"]){var preclick_current_focus_length=current_focus.length;for(var i=0;i<sunits.length;i++){var clicked_unit=sunits[i];if(clicked_unit["owner"]==client.conn.playing.playerno){var index=current_focus.findIndex(x=>x.id==clicked_unit.id);if(index===-1){current_focus.push(clicked_unit)}else{if(preclick_current_focus_length!=1)current_focus.splice(index,1)}}}update_active_units_dialog()}else if(sunits.length==1){var unit=sunits[0];set_unit_focus_and_activate(unit)}else{if(own_unit_index>=0){set_unit_focus_and_redraw(sunits[own_unit_index])}else{set_unit_focus_and_redraw(sunits[0]);console.log("Logic fault: player has own unit supposedly present but we're selecting sunit[0] instead.")}update_active_units_dialog()}if(touch_device){if(pcity){if(city_click_goto_cooldown(ptile))$("#canvas").contextMenu()}else{$("#canvas").contextMenu()}}}else if(pcity==null&&!mouse_click_mod_key["shiftKey"]){save_last_unit_focus();current_focus=[];unit_may_have_lost_focus();for(i=0;i<sunits.length;i++)current_focus.push(sunits[i]);if(current_focus.length>0)warcalc_set_default_vals(current_focus[0]);$("#game_unit_orders_default").hide();update_active_units_dialog()}}}paradrop_active=false;airlift_active=false;action_tgt_sel_active=false}function find_active_dialog(){const permanent_widgets=["game_overview_panel","game_unit_panel","game_chatbox_panel"];const dialogs=$(".ui-dialog");for(var i=0;i<dialogs.length;i++){const dialog=$(dialogs[i]);if(dialog.css("display")=="none"){continue}const children=dialog.children();if(children.length>=2&&permanent_widgets.indexOf(children[1].id)<0){return dialog}}return null}function global_keyboard_listener(ev){if($("input:focus").length>0||!keyboard_input)return;if(C_S_RUNNING!=client_state())return;var keyboard_key=String.fromCharCode(ev.keyCode);if(TAB_MAP===$("#tabs").tabs("option","active")){if(find_active_dialog()==null){map_handle_key(keyboard_key,ev.keyCode,ev["ctrlKey"],ev["altKey"],ev["shiftKey"],ev)}}civclient_handle_key(keyboard_key,ev.keyCode,ev["ctrlKey"],ev["altKey"],ev["shiftKey"],ev);$("#canvas").contextMenu("hide")}function civclient_handle_key(keyboard_key,key_code,ctrl,alt,shift,the_event){switch(keyboard_key){case"C":if(alt&&!ctrl&&!shift){the_event.preventDefault();$("#ui-id-5").trigger("click")}break;case"H":if(!shift&&ctrl){the_event.preventDefault();show_debug_info()}else if(alt&&!ctrl&&!shift)$("#ui-id-7").trigger("click");break;case"E":if(alt&&!ctrl&&!shift){the_event.preventDefault();$("#ui-id-2").trigger("click")}break;case"G":if(alt&&!ctrl&&!shift){the_event.preventDefault();$("#ui-id-3").trigger("click")}break;case"M":if(alt&&!ctrl&&!shift){the_event.preventDefault();$("#ui-id-1").trigger("click")}break;case"N":if(alt&&!ctrl&&!shift){the_event.preventDefault();$("#ui-id-4").trigger("click")}break;case"P":if(alt&&!ctrl&&!shift){the_event.preventDefault();$("#ui-id-6").trigger("click")}break;case"Q":if(alt)civclient_benchmark(0);break;case"S":if(ctrl&&!shift&&!alt){the_event.preventDefault();quicksave()}else if(alt){the_event.preventDefault();show_fullscreen_window()}break;case"T":if(alt&&!ctrl&&!shift){the_event.preventDefault();$("#tech_tab_item").trigger("click")}break;case"W":if(!alt&&!ctrl&&!shift){$("#ui-id-1").trigger("click");chatbox_scroll_to_bottom(false);if(active_dialogs.length){the_event.stopPropagation();remove_active_dialog_handler()}}else if(alt&&!ctrl&&!shift){$("#ui-id-8").trigger("click");warcalc_screen()}break}switch(key_code){case 13:if(shift&&C_S_RUNNING==client_state()){send_end_turn()}break;case 27:the_event.preventDefault();$("#ui-id-1").trigger("click");break;case 32:if(!alt&&!shift&&!ctrl){if($("#tabs-cities").is(":visible")){highlight_rows_by_improvement(0,true);select_rows_by_improvement(0,true)}}break}}function map_handle_key(keyboard_key,key_code,ctrl,alt,shift,the_event){switch(keyboard_key){case"A":if(shift){auto_attack=!auto_attack;add_client_message("<b>Shift-A</b>. Auto-attack set to "+(auto_attack?"ON.":"OFF."))}else key_unit_auto_settle();break;case"B":if(ctrl&&!alt&&!shift){the_event.stopPropagation();draw_border_flags=!draw_border_flags;simpleStorage.set("borderFlags",draw_border_flags)}else if(alt&&!shift&&!ctrl){the_event.stopPropagation();draw_border_mode++;if(draw_border_mode>=3)draw_border_mode=0;draw_tertiary_colors=draw_border_mode&1;simpleStorage.set("tricolore",draw_tertiary_colors)}else if(alt&&shift&&!ctrl){the_event.stopPropagation();draw_moving_borders=!draw_moving_borders;simpleStorage.set("movingBorders",draw_moving_borders)}else if(shift&&!alt&&!ctrl){minimap_color++;if(minimap_color>=4){minimap_color=0}palette=generate_palette();force_redraw_overview()}else if(current_focus.length==1&&(utype_can_do_action(unit_type(current_focus[0]),ACTION_JOIN_CITY)||utype_can_do_action(unit_type(current_focus[0]),ACTION_FOUND_CITY))){request_unit_build_city()}else{var ptile=canvas_pos_to_tile(mouse_x,mouse_y);var pcity=tile_city(ptile);if(pcity!=null)request_city_id_buy(pcity["id"])}break;case"C":if(ctrl&&!shift&&!alt){the_event.preventDefault();show_citybar=show_citybar-1;if(show_citybar<0)show_citybar=2}else if(shift&&!ctrl&&!alt){key_select_same_global_type(true)}else if(ctrl&&shift&&!alt){the_event.preventDefault();mapview_cycle_city_display_mode()}else if(current_focus.length>0){auto_center_on_focus_unit()}break;case"D":if(shift&&!ctrl&&!alt){key_unit_disband()}else if(!shift&&ctrl&&alt){the_event.preventDefault();clinet_disconnect_from_server()}else if(!(alt||ctrl)){key_unit_action_select()}break;case"E":if(shift&&!ctrl&&!alt){key_unit_airbase()}if(ctrl&&shift){the_event.preventDefault();$(".e_log_error").toggle()}break;case"F":if(alt&&shift&&!ctrl){focuslock=!focuslock;the_event.preventDefault();add_client_message("<b>Alt-Shift-F</b>. Focus-lock set to "+(focuslock?"ON.":"OFF."));simpleStorage.set("focuslock",focuslock)}else if(shift){key_unit_fortress()}else{key_unit_fortify()}break;case"G":if(ctrl){the_event.preventDefault();draw_map_grid=!draw_map_grid;simpleStorage.set("mapgrid",draw_map_grid)}else if(current_focus.length>0){activate_goto();delayed_goto_active=false;if(shift)delayed_goto_active=true}break;case"H":if(shift){key_unit_hideout()}else key_unit_homecity();break;case"K":key_unit_wait(true);break;case"N":if(shift){if(current_focus.length>0){if(unit_types[current_focus[0]["type"]]["name"].includes("Atom")||unit_types[current_focus[0]["type"]]["name"].includes("Nuclear")||unit_types[current_focus[0]["type"]]["name"].includes("Nuke")||unit_types[current_focus[0]["type"]]["name"].includes("Bomb")){key_unit_nuke()}else key_unit_naval_base()}}else{key_unit_fallout()}break;case"P":if(shift){key_unit_pillage()}else if(ctrl&&alt&&!shift){the_event.preventDefault();draw_highlighted_pollution=!draw_highlighted_pollution;simpleStorage.set("showpollution",draw_highlighted_pollution)}else{if(current_focus.length>0){if(unit_types[current_focus[0]["type"]]["name"]=="Paratroopers")key_unit_paradrop();else key_unit_pollution()}}break;case"Q":if(shift){key_filter_for_units_in_queue()}else{key_unit_quay()}break;case"R":if(shift&&!ctrl&&!alt){show_revolution_dialog()}else if(alt&&shift&&!ctrl){key_unit_connect(EXTRA_ROAD)}else if(ctrl&&!alt){the_event.preventDefault();var ptile=canvas_pos_to_tile(mouse_x,mouse_y);var pcity=tile_city(ptile);if(pcity!=null){activate_rally_goto(pcity,shift)}}else key_unit_road();break;case"S":if(!ctrl&&!alt&&!shift){key_unit_sentry()}else if(shift&&!ctrl&&!alt){draw_stacked_unit_mode++;if(draw_stacked_unit_mode>3)draw_stacked_unit_mode=0;simpleStorage.set("stackmode",draw_stacked_unit_mode)}break;case"T":if(shift&&!alt&&!ctrl){show_tax_rates_dialog()}else if(ctrl&&alt){draw_city_traderoutes=!draw_city_traderoutes}else key_unit_unload();break;case"V":if(shift&&!alt&&!ctrl){key_select_same_type_units_on_tile()}else if(alt&&!shift&&!ctrl){the_event.preventDefault();key_select_different_units_on_tile()}else{key_select_all_units_on_tile()}break;case"W":if(shift){draw_city_output=!draw_city_output}else if(!alt&&!ctrl)key_unit_wait(false);break;case"X":if(shift&&!ctrl&&!alt){key_select_same_global_type(false)}else if(alt&&!shift&&!ctrl){the_event.preventDefault();user_marking_mode=!user_marking_mode;if(user_marking_mode){handle_game_uid();add_client_message("Chalkboard is ON.  Alt-X to toggle.")}else add_client_message("Chalkboard is OFF.")}else if(enable_autoexplore&&!ctrl&&!shift&&!alt){key_unit_auto_explore()}else if(!enable_autoexplore)add_client_message("X hotkey was disabled in user PREFS.");break;case"U":if(alt){the_event.preventDefault();key_unit_move(DIR8_WEST)}else if(shift)key_unit_show_cargo();else key_unit_upgrade();break;case"I":if(alt){if(ctrl&&shift){the_event.preventDefault();replace_capital_i=!replace_capital_i;simpleStorage.set("capI",replace_capital_i)}else if(shift&&!ctrl){key_unit_connect(EXTRA_IRRIGATION)}else{the_event.preventDefault();key_unit_move(DIR8_NORTHWEST)}}else if(shift)key_unit_vigil();else if(!shift&&!alt&&!ctrl)key_unit_irrigate();break;case"O":if(alt){the_event.preventDefault();key_unit_move(DIR8_NORTH)}else if(shift){key_unit_convert()}else key_unit_transform();break;case"J":if(shift){key_unit_idle()}else if(alt){the_event.preventDefault();key_unit_move(DIR8_SOUTHWEST)}else{key_unit_noorders()}break;case"L":if(shift){key_unit_airlift()}else if(alt)key_unit_move(DIR8_NORTHEAST);else if(ctrl){the_event.preventDefault();draw_city_airlift_counter=!draw_city_airlift_counter}else{key_unit_load()}break;case"M":if(shift&&!ctrl&&!alt){show_unit_movepct=!show_unit_movepct;if(show_unit_movepct)hp_bar_offset=-5;else hp_bar_offset=0;simpleStorage.set("showMoves",show_unit_movepct)}else if(alt&&!shift&&!ctrl){the_event.preventDefault();key_unit_move(DIR8_SOUTH)}else if(ctrl&&!alt&&!shift){the_event.preventDefault();draw_city_mood=!draw_city_mood;simpleStorage.set("drawMood",draw_city_mood)}else key_unit_mine();break}switch(key_code){case 46:if(user_marking_mode){myGameVars={};simpleStorage.set(Game_UID,myGameVars);add_client_message("Chalkboard erased.")}break;case 35:case 97:key_unit_move(DIR8_SOUTH);break;case 40:case 98:case 188:if(key_code==188&&shift){var penultimate_focus=last_focus;save_last_unit_focus();current_focus=[];unit_may_have_lost_focus();if(penultimate_focus!=null){set_unit_focus_and_redraw(penultimate_focus)}}if(key_code==188&&!alt)break;the_event.preventDefault();key_unit_move(DIR8_SOUTHEAST);break;case 34:case 99:case 190:if(key_code==190&&shift){advance_focus_inactive_units()}if(key_code==190&&!alt)break;the_event.preventDefault();key_unit_move(DIR8_EAST);break;case 37:case 100:key_unit_move(DIR8_SOUTHWEST);break;case 12:var penultimate_focus=last_focus;save_last_unit_focus();current_focus=[];unit_may_have_lost_focus();if(penultimate_focus!=null){set_unit_focus_and_redraw(penultimate_focus)}break;case 39:case 102:key_unit_move(DIR8_NORTHEAST);break;case 36:case 103:key_unit_move(DIR8_WEST);break;case 38:case 104:key_unit_move(DIR8_NORTHWEST);break;case 33:case 105:key_unit_move(DIR8_NORTH);break;case 27:deactivate_goto(false);clear_all_modes();map_select_active=false;map_select_check=false;mapview_mouse_movement=false;came_from_context_menu=false;context_menu_active=true;$("#canvas").contextMenu(true);paradrop_active=false;airlift_active=false;action_tgt_sel_active=false;break;case 32:if(shift)auto_center_last_location();else if(ctrl&&alt){the_event.preventDefault();key_paste_link_under_cursor()}else{save_last_unit_focus();current_focus=[];unit_may_have_lost_focus();clear_all_modes();$("#canvas_div").css("cursor","default");goto_request_map={};goto_turns_request_map={};clear_goto_tiles();update_active_units_dialog();map_select_active=false;map_select_check=false;mapview_mouse_movement=false;came_from_context_menu=false}break;case 222:the_event.preventDefault();if(current_message_dialog_state=="minimized")$(".chatbox_dialog .ui-icon-bullet").click();$("#game_text_input").focus();break;case 107:break;case 109:break}}function handle_context_menu_callback(key){switch(key){case"exit":break;case"build":request_unit_build_city();break;case"select_all_type":key_select_same_type_units_on_tile();break;case"select_all_tile":key_select_all_units_on_tile();break;case"tile_info":var ptile=find_a_focus_unit_tile_to_center_on();if(ptile!=null){mclick_tile=ptile;popit_req(ptile)}came_from_context_menu=false;break;case"goto":activate_goto();break;case"delaygoto":activate_goto();delayed_goto_active=true;break;case"explore":key_unit_auto_explore();break;case"fortify":key_unit_fortify();break;case"vigil":key_unit_vigil();break;case"road":key_unit_road();break;case"railroad":key_unit_road();break;case"maglev":key_unit_road();break;case"quay":key_unit_quay();break;case"canal":key_unit_canal();break;case"well":key_unit_well();break;case"mine":key_unit_mine();break;case"autosettlers":key_unit_auto_settle();break;case"fallout":key_unit_fallout();break;case"pollution":key_unit_pollution();break;case"forest":key_unit_irrigate();break;case"irrigation":key_unit_irrigate();break;case"fort":case"fortress":key_unit_fortress();break;case"hideout":key_unit_hideout();break;case"navalbase":key_unit_naval_base();break;case"airbase":key_unit_airbase();break;case"transform":key_unit_transform();break;case"nuke":key_unit_nuke();break;case"paradrop":key_unit_paradrop();break;case"pillage":key_unit_pillage();break;case"homecity":key_unit_homecity();break;case"airlift":key_unit_airlift();break;case"sentry":key_unit_sentry();break;case"wait":key_unit_wait(false);break;case"noorders":key_unit_noorders();break;case"idle":key_unit_idle();break;case"upgrade":key_unit_upgrade();break;case"convert":key_unit_convert();break;case"disband":key_unit_disband();break;case"unit_load":key_unit_load();break;case"unit_unload":key_unit_unload();break;case"unit_show_cargo":key_unit_show_cargo();break;case"action_selection":key_unit_action_select();break;case"show_city":if(clicked_city!=null){show_city_dialog(clicked_city)}else{var stile=find_a_focus_unit_tile_to_center_on();if(stile!=null){show_city_dialog(tile_city(stile))}}came_from_context_menu=false;break}if(key!="goto"&&key!="delaygoto"&&touch_device){deactivate_goto(false)}}function activate_goto(){clear_goto_tiles();prev_mouse_x=null;prev_mouse_y=null;prev_goto_tile=null;activate_goto_last(ORDER_LAST,ACTION_COUNT)}function activate_rally_goto(pcity,persist){clear_goto_tiles();rally_mode=true;message_log.update({event:E_BEGINNER_HELP,message:"Click tile to set "+pcity["name"]+"'s "+(persist?"persistent ":"temporary ")+"rally point. <b>SPACE</b> aborts."});prev_mouse_x=null;prev_mouse_y=null;prev_goto_tile=null;activate_goto_last(ORDER_LAST,ACTION_COUNT)}function save_last_unit_focus(){if(current_focus==null)return;if(current_focus.length>0)last_focus=current_focus[0]}function activate_goto_last(last_order,last_action){goto_active=true;$("#canvas_div").css("cursor","crosshair");goto_last_order=last_order;goto_last_action=last_action;if(current_focus.length>0){if(intro_click_description){if(touch_device){message_log.update({event:E_BEGINNER_HELP,message:"Carefully drag unit to the tile you want it to go to."})}else{message_log.update({event:E_BEGINNER_HELP,message:"Click on the tile to send this unit to."})}intro_click_description=false}}else{message_log.update({event:E_BEGINNER_HELP,message:"First select a unit to move by clicking on it, then click on the"+" goto button or the 'G' key, then click on the position to move to."});deactivate_goto(false)}}function deactivate_goto(will_advance_unit_focus){goto_active=false;delayed_goto_active=false;connect_active=false;connect_activity=ACTIVITY_LAST;connect_extra=-1;$("#canvas_div").css("cursor","default");goto_request_map={};goto_turns_request_map={};prev_goto_tile=null;clear_goto_tiles();if(will_advance_unit_focus&&!(goto_last_action==ACTION_NUKE))setTimeout(update_unit_focus,update_focus_delay);else update_active_units_dialog();goto_last_order=ORDER_LAST;goto_last_action=ACTION_COUNT}function send_end_turn(){if(game_info==null)return;$("#turn_done_button").button("option","disabled",true);if(!touch_device)$("#turn_done_button").tooltip({disabled:true});var packet={pid:packet_player_phase_done,turn:game_info["turn"]};send_request(JSON.stringify(packet));update_turn_change_timer();if(is_pbem()){setTimeout(pbem_end_phase,2e3)}if(is_longturn()){show_dialog_message("Turn done!","Your turn in this Freeciv-web: One Turn per Day game is now over. In this game one turn is played every day. "+"To play your next turn in this game, go to "+window.location.host+" and click <b>Games</b> in the menu, then <b>Multiplayer</b> "+"and there you will find this Freeciv-web: One Turn per Day game in the list. You can also bookmark this page.<br>"+"See you again soon!")}}function key_unit_auto_explore(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];request_new_unit_activity(punit,ACTIVITY_EXPLORE,EXTRA_NONE);if(punit["movesleft"]>0&&punit["owner"]==client.conn.playing.playerno)unit_move_sound_play(punit);remove_unit_id_from_waiting_list(punit["id"])}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_load(){var normal_ruleset=client_rules_flag[CRF_CARGO_HEURISTIC];var funits=get_units_in_focus();var scoop_happened=false;var sunits=current_focus;if(!sunits||sunits.length==0)return;if(sunits.length==1){for(var s=0;s<sunits.length;s++){var stype=unit_type(sunits[s]);if(stype&&stype.transport_capacity>0&&unit_has_cargo_room(sunits[s])){var ptile=unit_tile(sunits[s]);units_on_tile=tile_units(ptile);for(var i=0;i<units_on_tile.length;i++){var punit=units_on_tile[i];if(!punit["transported"]&&punit!=sunits[s]&&unit_could_possibly_load(punit,unit_type(punit),stype,get_unit_class(sunits[s]))){request_unit_do_action(ACTION_TRANSPORT_BOARD,punit["id"],sunits[s]["id"]);remove_unit_id_from_waiting_list(punit["id"]);punit["done_moving"]=true;scoop_happened=true}}}}}if(scoop_happened){setTimeout(update_active_units_dialog,update_focus_delay*1.35);return}for(var i=0;i<funits.length;i++){var punit=funits[i];var ptype=unit_type(punit);var ptile=index_to_tile(punit["tile"]);var transporter_unit_id=0;var transporter_units=[];var has_transport_unit=false;var units_on_tile=tile_units(ptile);var t,r,b,candidate,tunit,ttype,tclass;for(t=0;t<units_on_tile.length;t++){tunit=units_on_tile[t];if(tunit["id"]==punit["id"])continue;ttype=unit_type(tunit);tclass=unit_classes[ttype.unit_class_id];if(punit["transported_by"]==tunit["id"])continue;if(ttype["transport_capacity"]>0){if(!normal_ruleset||unit_could_possibly_load(punit,ptype,ttype,tclass)){transporter_units.push({id:tunit["id"],capacity:ttype["transport_capacity"],moves:tunit["movesleft"],carrying:0})}}}if(transporter_units.length>=2){for(t=0;t<units_on_tile.length;t++){tunit=units_on_tile[t];if(tunit["transported"]==true){candidate=transporter_units.findIndex(i=>i.id===tunit["transported_by"]);if(candidate!=-1)transporter_units[candidate]["carrying"]+=1}}var id="";var buttons=[];id="#load_unit_dialog_"+punit["id"];remove_active_dialog(id);$("<div id='load_unit_dialog_"+punit["id"]+"'></div>").appendTo("div#game_page");var home_city_name="";var home_city;if(punit["homecity"])home_city=punit["homecity"];if(home_city&&cities[home_city]&&cities[home_city]["name"]){home_city_name=" from "+cities[home_city]["name"]}$(id).attr("title","Board "+unit_type(punit)["name"]+home_city_name+" on:");$(id).html("<b>M</b>:Moves <b>L</b>:Loaded <b>C</b>:Capacity<br>");for(b=0;b<transporter_units.length;b++){if(true){var actor=punit["id"];var ttile=punit["tile"];var dialog_num=i;var dialog_id=id;var last_dialog=funits.length;buttons.push(create_load_transport_button(actor,ttile,transporter_units[b]["id"],transporter_units[b]["moves"],transporter_units[b]["carrying"],transporter_units[b]["capacity"],dialog_id,dialog_num,last_dialog))}}buttons.push(create_a_close_button(dialog_id));var dialog_width=buttons.length>20?"90%":"875";$(id).dialog({bgiframe:true,modal:true,position:{my:"center+"+i*3+" center+"+i*3,at:"center"},buttons:buttons,height:"auto",zIndex:9999,width:is_small_screen()?$(window).width():dialog_width,fluid:true});$(id).dialog("open");$(id).dialog("widget").position({my:"center top",at:"center top",of:window});dialog_register(id)}else if(transporter_units.length==1){for(r=0;r<transporter_units.length;r++){tunit=units[transporter_units[r]["id"]];if(tunit["id"]==punit["id"])continue;ttype=unit_type(tunit);if(ttype["transport_capacity"]>0){has_transport_unit=true;transporter_unit_id=tunit["id"]}}if(has_transport_unit&&transporter_unit_id>0&&punit["tile"]>0){request_unit_do_action(ACTION_TRANSPORT_BOARD,punit["id"],transporter_unit_id);remove_unit_id_from_waiting_list(punit["id"]);punit["done_moving"]=true;setTimeout(update_active_units_dialog,update_focus_delay)}}}if(funits.length<2)setTimeout(function(){advance_unit_focus(false)},update_focus_delay)}function key_unit_unload(){var unloaded=0;if(current_focus!=null&&current_focus.length>0){var sunit=current_focus[0];var sunits=current_focus;var ptile=index_to_tile(sunit["tile"])}if(!sunit)return;var funits=get_units_in_focus();var units_on_tile=[];for(var i=0;i<funits.length;i++){var punit=funits[i];var ptile=index_to_tile(punit["tile"]);units_on_tile=tile_units(ptile)}for(var s=0;s<sunits.length;s++){var stype=unit_types[sunits[s]["type"]];if(sunits[s]&&stype.transport_capacity>0&&!sunits[s].transported){for(var i=0;i<units_on_tile.length;i++){var punit=units_on_tile[i];if(punit["transported"]&&punit["transported_by"]==sunits[s]["id"]){if(unit_can_do_unload(punit)){request_unit_do_action(ACTION_TRANSPORT_UNLOAD,punit["transported_by"],punit["id"]);unloaded++}}}}else if(sunits[s]["transported"]){if(unit_can_do_unload(sunits[s])){request_unit_do_action(ACTION_TRANSPORT_DEBOARD,sunits[s]["id"],sunits[s]["transported_by"]);unloaded++}}else{}}deactivate_goto(false);if(unloaded){add_client_message("Unloaded "+unloaded+" unit"+(unloaded>1?"s.":"."));setTimeout(function(){advance_unit_focus(false)},update_focus_delay)}else{if(sunits.length==1){add_client_message(unit_type(sunits[0]).rule_name+" couldn't unload here.")}else{add_client_message("Can't unload here.")}}}function key_select_all_units_on_tile(){var punits=[];if(current_focus!=null&&current_focus.length>0){var punit=current_focus[0];var ptile=index_to_tile(punit["tile"]);var ptype=punit["type"];punits=tile_units(ptile);for(var i=0;i<punits.length;i++){if(true){var index=current_focus.findIndex(x=>x.id==punits[i].id);if(index===-1){if(punits[i]["owner"]==client.conn.playing.playerno)current_focus.push(punits[i])}}}update_active_units_dialog()}}function key_select_same_type_units_on_tile(){var punits=[];if(current_focus!=null&&current_focus.length>0){var punit=current_focus[0];var ptile=index_to_tile(punit["tile"]);var ptype=punit["type"];punits=tile_units(ptile);for(var i=0;i<punits.length;i++){if(unit_types[punits[i]["type"]]["name"]==unit_types[ptype]["name"]){var index=current_focus.findIndex(x=>x.id==punits[i].id);if(index===-1){if(punits[i]["owner"]==client.conn.playing.playerno)current_focus.push(punits[i])}}}update_active_units_dialog()}}function key_select_different_units_on_tile(){var punits=[];if(current_focus!=null&&current_focus.length>0){var punit=current_focus[0];save_last_unit_focus();current_focus=[];unit_may_have_lost_focus();var ptile=index_to_tile(punit["tile"]);var ptype=punit["type"];punits=tile_units(ptile);for(var i=0;i<punits.length;i++){if(unit_types[punits[i]["type"]]["name"]!=unit_types[ptype]["name"]){var index=current_focus.findIndex(x=>x.id==punits[i].id);if(index===-1){current_focus.push(punits[i])}}}update_active_units_dialog()}}function key_select_same_global_type(continent_only){if(current_focus!=null&&current_focus.length>0){var punit=current_focus[0];var ptile=index_to_tile(punit["tile"]);var ptype=punit["type"];save_last_unit_focus();current_focus=[];unit_may_have_lost_focus();for(var unit_id in units){var aunit=units[unit_id];if(aunit["owner"]==client.conn.playing.playerno){if(tiles[aunit["tile"]]["continent"]==ptile["continent"]||!continent_only){if(unit_types[aunit["type"]]["name"]==unit_types[ptype]["name"]){current_focus.push(units[unit_id])}}}}}update_active_units_dialog()}function key_filter_for_units_in_queue(){if(client_is_observer())return null;var punit;if(current_focus.length>0){var funits=get_units_in_focus();for(var i=funits.length-1;i>=0;i--){punit=funits[i];if(client.conn.playing!=null&&!(punit["owner"]==client.conn.playing.playerno&&punit["activity"]==ACTIVITY_IDLE&&punit["movesleft"]>0&&punit["done_moving"]==false&&punit["ai"]==false&&punit["transported"]==false)){current_focus.splice(i,1);unit_may_have_lost_focus()}}}else{for(var unit_id in units){punit=units[unit_id];if(client.conn.playing!=null&&(punit["owner"]==client.conn.playing.playerno&&punit["activity"]==ACTIVITY_IDLE&&punit["movesleft"]>0&&punit["done_moving"]==false&&punit["ai"]==false&&punit["transported"]==false)){current_focus.push(punit)}}}update_active_units_dialog()}function key_unit_show_cargo(){var sunits=current_focus;var new_current_focus=[];var do_full_exit=false;if(!sunits||sunits.length==0)return;save_last_unit_focus();for(var s=0;s<sunits.length;s++){var ptile=index_to_tile(sunits[s]["tile"]);var units_on_tile=tile_units(ptile);stype=unit_type(sunits[s]);if(stype.transport_capacity>0){for(var i=0;i<units_on_tile.length;i++){var punit=units_on_tile[i];if(punit["transported"]&&punit["transported_by"]==sunits[s]["id"]){new_current_focus.push(punit)}}}else{new_current_focus=[];for(var i=0;i<units_on_tile.length;i++){var punit=units_on_tile[i];if(punit["transported"]&&punit["transported_by"]>0){new_current_focus.push(punit)}}do_full_exit=true}if(do_full_exit)break}if(new_current_focus&&new_current_focus.length>0){current_focus=new_current_focus;unit_may_have_lost_focus()}deactivate_goto(false);update_active_units_dialog();if(current_focus.length>0)warcalc_set_default_vals(current_focus[0]);update_unit_order_commands()}function key_unit_wait(same_type){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];if(waiting_units_list.indexOf(punit["id"]==-1))waiting_units_list.push(punit["id"])}deactivate_goto(false);advance_unit_focus(same_type)}function key_unit_noorders(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];punit["done_moving"]=true}deactivate_goto(false);advance_unit_focus(false)}function unit_noorders(punit){if(!punit)return;punit["done_moving"]=true;deactivate_goto(false);remove_unit_id_from_waiting_list(punit["id"])}function key_unit_idle(){came_from_context_menu=false;var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];request_new_unit_activity(punit,ACTIVITY_IDLE,EXTRA_NONE)}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_vigil(){came_from_context_menu=false;var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];if(unit_can_vigil(punit)){request_new_unit_activity(punit,ACTIVITY_VIGIL,EXTRA_NONE);remove_unit_id_from_waiting_list(punit["id"]);punit["done_moving"]=true}}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_sentry(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];if(unit_can_sentry(punit)){request_new_unit_activity(punit,ACTIVITY_SENTRY,EXTRA_NONE);remove_unit_id_from_waiting_list(punit["id"])}else{unit_noorders(punit);advance_unit_focus(false)}}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function unit_can_sentry(punit){var class_name=get_unit_class_name(punit);var ptile=unit_tile(punit);var pcity=tile_city(ptile);if(client_rules_flag[CRF_TRIREME_FUEL]&&class_name=="Trireme"){var no_coast_near=tile_terrain(ptile)["tclass"];for(var dir=0;dir<8;dir++){var checktile=mapstep(ptile,dir);var pterrain=tile_terrain(checktile);if(pterrain["tclass"]==0)no_coast_near=false}if(no_coast_near==true){return false}}if(class_name=="Helicopter"||class_name=="Air"||class_name=="AirProtect"||class_name=="AirPillage"||class_name=="Air_High_Altitude"||class_name=="Balloon"||class_name=="Zeppelin"||class_name=="Missile"){if(pcity||punit["transported"]||tile_has_extra(ptile,EXTRA_AIRBASE)){return true}else{return false}}else{return true}}function remove_unit_id_from_waiting_list(uid){var w=waiting_units_list.indexOf(uid);if(w>=0){var deleted_elements;do{deleted_elements=waiting_units_list.splice(w,1)}while(deleted_elements.length>0);return true}return false}function force_clear_unit(uid){var w=current_focus.indexOf(uid);if(w>=0){current_focus.splice(w,1)}remove_unit_id_from_waiting_list(uid);units[uid].done_moving=true}function key_unit_fortify(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];var can_sentry=unit_can_sentry(punit);if(!unit_has_class_flag(punit,UCF_CAN_FORTIFY)||unit_has_type_flag(punit,UTYF_CANT_FORTIFY)){if(can_sentry){request_new_unit_activity(punit,ACTIVITY_SENTRY,EXTRA_NONE)}else{unit_noorders(punit)}}else if(punit["transported"]){if(can_sentry){request_new_unit_activity(punit,ACTIVITY_SENTRY,EXTRA_NONE)}else{unit_noorders(punit)}}else{request_new_unit_activity(punit,ACTIVITY_FORTIFYING,EXTRA_NONE)}force_clear_unit(punit["id"],0)}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay*.8)}function key_unit_fortress(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];var ptile=tiles[punit["tile"]];if(typeof EXTRA_FORT!=="undefined"&&client_rules_flag[CRF_MARINE_BASES]){var ptype=unit_type(punit);if(ptype["name"]=="Marines"&&(punit["transported"]||tile_has_extra(ptile,EXTRA_FORT))){continue}}var activity=EXTRA_NONE;request_new_unit_activity(punit,ACTIVITY_BASE,activity);remove_unit_id_from_waiting_list(punit["id"])}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_hideout(){var hideout_rules=false;if(server_settings["hideouts"]){hideout_rules=client_rules_flag[CRF_EXTRA_HIDEOUT]&&server_settings["hideouts"]["val"]}var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];var ptile=tiles[punit["tile"]];var activity=EXTRA_NONE;if(hideout_rules)activity=EXTRA_;request_new_unit_activity(punit,ACTIVITY_BASE,activity);remove_unit_id_from_waiting_list(punit["id"])}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_airbase(){var radar_rules=client_rules_flag[CRF_RADAR_TOWER];var activity=EXTRA_AIRBASE;var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];var ptile=tiles[punit["tile"]];if(client_rules_flag[CRF_MARINE_BASES]){var ptype=unit_type(punit);if(ptype["name"]=="Marines"&&punit["transported"]){continue}}activity=EXTRA_AIRBASE;if(radar_rules&&tile_has_extra(ptile,EXTRA_AIRBASE))activity=EXTRA_RADAR;request_new_unit_activity(punit,ACTIVITY_BASE,activity);remove_unit_id_from_waiting_list(punit["id"])}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_irrigate(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];if(tile_terrain(unit_tile(punit))["cultivate_time"]>0){request_new_unit_activity(punit,ACTIVITY_CULTIVATE,EXTRA_NONE)}else{request_new_unit_activity(punit,ACTIVITY_IRRIGATE,EXTRA_NONE)}remove_unit_id_from_waiting_list(punit["id"])}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_cultivate(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];request_new_unit_activity(punit,ACTIVITY_CULTIVATE,EXTRA_NONE);remove_unit_id_from_waiting_list(punit["id"])}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_pollution(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];request_new_unit_activity(punit,ACTIVITY_POLLUTION,EXTRA_NONE);remove_unit_id_from_waiting_list(punit["id"])}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_connect(extra_id){if(current_focus.length<1)return;connect_active=true;connect_extra=extra_id;switch(connect_extra){case EXTRA_ROAD:connect_activity=ACTIVITY_GEN_ROAD;break;case EXTRA_IRRIGATION:connect_activity=ACTIVITY_IRRIGATE;break}activate_goto();delayed_goto_active=false}function create_connect_packet(packet){if(!packet)return;var order={order:ORDER_LAST,activity:ACTIVITY_LAST,sub_target:0,action:ACTION_COUNT,dir:-1};var new_packet={pid:packet["pid"],unit_id:packet["unit_id"],src_tile:packet["src_tile"],length:packet["length"]*2+1,repeat:packet["repeat"],vigilant:packet["vigilant"],dest_tile:packet["dest_tile"]};new_packet["orders"]=[];var punit=units[packet["unit_id"]];var ptile=tiles[punit["tile"]];var length=new_packet["length"];for(i=0;i<packet["length"]+1;i++){var upgrade_extra=extra_dep(punit,ptile,connect_extra);if(upgrade_extra!=CONNECT_ACTION_ILLEGAL){order["order"]=ORDER_ACTIVITY;order["dir"]=0;if(upgrade_extra==-2){}else order["activity"]=connect_activity;order["target"]=-1;if(upgrade_extra==EXTRA_ROAD||upgrade_extra==EXTRA_RIVER||upgrade_extra==EXTRA_FARMLAND||upgrade_extra==EXTRA_RAIL||upgrade_extra==EXTRA_MAGLEV)order["sub_target"]=upgrade_extra;else order["sub_target"]=0;order["action"]=ACTION_COUNT;new_packet["orders"].push(Object.assign({},order))}else{length--}if(i<packet["length"]){new_packet["orders"].push(packet["orders"][i]);ptile=mapstep(ptile,packet["orders"][i]["dir"])}}new_packet["length"]=length;return new_packet}function extra_dep(punit,ptile,extra_id){if(extra_id==EXTRA_ROAD&&unit_type(punit)["name"]=="Well-Digger")extra_id=EXTRA_RIVER;if(extra_id==EXTRA_ROAD){if(tile_has_extra(ptile,EXTRA_RIVER)){if(player_invention_state(client.conn.playing,tech_id_by_name("Bridge Building"))<TECH_KNOWN)if(!tile_has_extra(ptile,EXTRA_ROAD)){return CONNECT_ACTION_ILLEGAL}}if(!tile_has_extra(ptile,EXTRA_ROAD))return EXTRA_ROAD;if(player_invention_state(client.conn.playing,tech_id_by_name("Railroad"))<TECH_KNOWN)return EXTRA_ROAD;if(!tile_has_extra(ptile,EXTRA_RAIL))return EXTRA_RAIL;if(!client_rules_flag[CRF_MAGLEV])return EXTRA_RAIL;if(player_invention_state(client.conn.playing,tech_id_by_name("Superconductors"))<TECH_KNOWN)return EXTRA_RAIL;return EXTRA_MAGLEV}else if(extra_id==EXTRA_RIVER){if(tile_has_extra(ptile,EXTRA_RIVER)){return CONNECT_ACTION_ILLEGAL}return EXTRA_RIVER}else if(extra_id==EXTRA_IRRIGATION){var can_irr=can_irrigate(punit,ptile);if(player_invention_state(client.conn.playing,tech_id_by_name("Refrigeration"))<TECH_KNOWN){if(can_irr)return EXTRA_IRRIGATION;else return CONNECT_ACTION_ILLEGAL}if(!tile_has_extra(ptile,EXTRA_IRRIGATION)){if(can_irr&&tile_terrain(ptile)["name"]!="Swamp")return EXTRA_IRRIGATION;else return CONNECT_ACTION_ILLEGAL}if(tile_has_extra(ptile,EXTRA_IRRIGATION)&&!tile_has_extra(ptile,EXTRA_FARMLAND))return EXTRA_FARMLAND;else return CONNECT_ACTION_ILLEGAL}return extra_id}function key_unit_nuke(){var funits=get_units_in_focus();if(funits==null)return;var punit=funits[0];if(unit_can_do_action(punit,ACTION_NUKE)){message_log.update({event:E_BEGINNER_HELP,message:"** WARNING!! ** Unit will detonate upon arrival. Choose target location..."});if(!touch_device)message_log.update({event:E_BEGINNER_HELP,message:"...or hit 'D' twice to detonate current location.<br>"});activate_goto_last(ORDER_PERFORM_ACTION,ACTION_NUKE)}}function key_unit_upgrade(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];var pcity=tile_city(index_to_tile(punit["tile"]));var target_id=pcity!=null?pcity["id"]:0;request_unit_do_action(ACTION_UPGRADE_UNIT,punit["id"],target_id)}deactivate_goto(false);setTimeout(update_active_units_dialog,update_focus_delay*.85);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_paradrop(){paradrop_active=true;message_log.update({event:E_BEGINNER_HELP,message:"Click on the tile to send this paratrooper to."})}function key_unit_airlift(){airlift_active=true;message_log.update({event:E_BEGINNER_HELP,message:"Click on the city to airlift this unit to."})}function key_unit_fallout(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];request_new_unit_activity(punit,ACTIVITY_FALLOUT,EXTRA_NONE);remove_unit_id_from_waiting_list(punit["id"])}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_transform(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];request_new_unit_activity(punit,ACTIVITY_TRANSFORM,EXTRA_NONE);remove_unit_id_from_waiting_list(punit["id"])}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_pillage(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];var ptile=unit_tile(punit);if(typeof EXTRA_BUNKER!=="undefined"){if(tile_has_extra(ptile,EXTRA_BUNKER)){add_client_message("Bunkers prevent Pillage. Build Fortress to remove Bunker.");return}}var pstats=unit_get_extra_stats(punit);var tgt=get_what_can_unit_pillage_from(punit,null);if(tgt.length>0){if(pstats.iPillage_random_targets){for(i=0;i<pstats.iPillage_random_targets;i++){request_new_unit_activity(punit,ACTIVITY_PILLAGE,EXTRA_NONE);setTimeout(update_unit_focus,update_focus_delay)}}else{if(tgt.length==1&&!unit_has_dual_pillage_options(punit)){request_new_unit_activity(punit,ACTIVITY_PILLAGE,EXTRA_NONE);setTimeout(update_unit_focus,update_focus_delay)}else{popup_pillage_selection_dialog(punit)}}}}deactivate_goto(false)}function key_unit_convert(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];request_new_unit_activity(punit,ACTIVITY_CONVERT,-1);remove_unit_id_from_waiting_list(punit["id"])}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_mine(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];if(tile_terrain(unit_tile(punit))["plant_time"]>0){request_new_unit_activity(punit,ACTIVITY_PLANT,EXTRA_NONE)}else{request_new_unit_activity(punit,ACTIVITY_MINE,EXTRA_NONE)}remove_unit_id_from_waiting_list(punit["id"])}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_plant(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];request_new_unit_activity(punit,ACTIVITY_PLANT,EXTRA_NONE);remove_unit_id_from_waiting_list(punit["id"])}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function unit_can_vigil(punit){var ptype=unit_type(punit);var name=ptype["name"];var moves_used=parseFloat(ptype["move_rate"])/parseFloat(SINGLE_MOVE)-parseFloat(punit["movesleft"])/parseFloat(SINGLE_MOVE);if(server_settings["autoattack"]["val"]!=true)return false;if(server_settings["autoattack_style"]["val"]==0)return false;switch(name){case"Fighter":if(moves_used<=2)return true;break;case"Escort Fighter":if(moves_used<=3)return true;break;case"Jet Fighter":if(moves_used<=3)return true;break;case"Stealth Fighter":if(moves_used<=4)return true;break}return false}function can_build_sea_bridge(punit,ptile){var land_near;if(!unit_can_do_action(punit,ACTION_ROAD))return false;if(!is_ocean_tile(ptile))return false;for(var dir=1;dir<7;dir++){if(dir==2||dir==5)continue;var cadj_tile=mapstep(ptile,dir);if(cadj_tile!=null){var tclass=tile_terrain(cadj_tile)["tclass"];if(tclass==0){land_near=true;break}}}return typeof EXTRA_SEABRIDGE!=="undefined"&&(punit!=null&&ptile!=null)&&!tile_has_extra(ptile,EXTRA_SEABRIDGE)&&tech_known("Steel")&&unit_can_do_action(punit,ACTION_ROAD)&&land_near}function can_build_maglev(punit,ptile){return typeof EXTRA_MAGLEV!=="undefined"&&(punit!=null&&ptile!=null)&&!tile_has_extra(ptile,EXTRA_MAGLEV)&&tile_has_extra(ptile,EXTRA_RAIL)&&unit_can_do_action(punit,ACTION_ROAD)&&tech_known("Superconductors")}function can_build_well(punit,ptile){return punit!=null&&ptile!=null&&!tile_has_extra(ptile,EXTRA_RIVER)&&tile_owner(ptile)==punit["owner"]&&unit_types[punit["type"]]["name"]=="Well-Digger"&&!tech_known("Pottery")&&!tech_known("Alphabet")}function key_unit_well(){const funits=get_units_in_focus();for(var i=0;i<funits.length;i++){const punit=funits[i];const ptile=index_to_tile(punit["tile"]);if(can_build_well(punit,ptile)){request_new_unit_activity(punit,ACTIVITY_GEN_ROAD,extras["River"]["id"]);remove_unit_id_from_waiting_list(punit["id"])}}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function can_build_canal(punit,ptile){if(typeof EXTRA_CANAL==="undefined")return 0;if(tile_terrain(ptile)==null)return 0;if(punit==null||ptile==null)return 0;var is_lowland=tile_terrain(ptile)["name"]!="Hills"&&tile_terrain(ptile)["name"]!="Mountains";var water_near=0;for(var dir=0;dir<8;dir++){if(client_rules_flag[CRF_MP2_C]&&!is_cardinal_dir(dir))continue;var tile1=mapstep(ptile,dir);if(tile1!=null&&terrains[tile1["terrain"]]!=null){if(terrains[tile1["terrain"]]["name"]=="Lake"||terrains[tile1["terrain"]]["name"]=="Ocean"||terrains[tile1["terrain"]]["name"]=="Deep Ocean"){water_near=EXTRA_CANAL;break}else if(client_rules_flag[CRF_EXTRA_QUAY]&&tile_has_extra(tile1,EXTRA_RIVER)||client_rules_flag[CRF_MP2_C]&&tile_has_extra(tile1,EXTRA_CANAL)){water_near=EXTRA_WATERWAY;break}}}if(!tile_has_extra(ptile,EXTRA_CANAL)&&unit_can_do_action(punit,ACTION_ROAD)&&is_lowland&&water_near&&tech_known("Engineering")){return water_near}return 0}function can_build_quay(punit,ptile){const domestic=ptile["owner"]==client.conn.playing.playerno;var ptype=unit_type(punit);if(ptype["name"]=="Legion"){if(domestic&&!tile_has_extra(ptile,EXTRA_FORT))return false}return typeof EXTRA_QUAY!=="undefined"&&(punit!=null&&ptile!=null)&&!tile_has_extra(ptile,EXTRA_QUAY)&&!tile_has_extra(ptile,EXTRA_)&&(tile_has_extra(ptile,EXTRA_RIVER)||tile_has_extra(ptile,EXTRA_CANAL)||tile_has_extra(ptile,EXTRA_WATERWAY))&&unit_can_do_action(punit,ACTION_ROAD)&&tech_known("Pottery")}function can_irrigate(punit,ptile){if(punit==null||ptile==null)return false;if(!unit_can_do_action(punit,ACTION_IRRIGATE))return false;var terrain_name=tile_terrain(ptile)["name"];if(terrain_name=="Swamp"||terrain_name=="Jungle")return true;var invalid_terrain=terrain_name=="Mountains"||terrain_name=="Lake"||terrain_name=="Ocean"||terrain_name=="Deep Ocean"||terrain_name=="Forest"||terrain_name=="Glacier";invalid_terrain=invalid_terrain||tile_has_extra(ptile,EXTRA_IRRIGATION);if(invalid_terrain)return false;var water_near=tile_has_extra(ptile,EXTRA_RIVER)||tile_has_extra(ptile,EXTRA_OASIS)&&client_rules_flag[CRF_OASIS_IRRIGATE]||client_rules_flag[CRF_MP2_C]&&tile_has_extra(ptile,EXTRA_CANAL)||client_rules_flag[CRF_MP2_C]&&tile_has_extra(ptile,EXTRA_WATERWAY);if(!water_near){for(var dir=1;dir<7;dir++){if(dir==2||dir==5)continue;var cadj_tile=mapstep(ptile,dir);if(cadj_tile!=null){terrain_name=tile_terrain(cadj_tile)["name"];if(terrain_name=="Lake"||terrain_name=="Ocean"||terrain_name=="Deep Ocean"||tile_has_extra(cadj_tile,EXTRA_IRRIGATION)||tile_has_extra(cadj_tile,EXTRA_RIVER)||client_rules_flag[CRF_MP2_C]&&tile_has_extra(cadj_tile,EXTRA_CANAL)||client_rules_flag[CRF_MP2_C]&&tile_has_extra(cadj_tile,EXTRA_WATERWAY)||tile_has_extra(cadj_tile,EXTRA_OASIS)&&client_rules_flag[CRF_OASIS_IRRIGATE]){water_near=true;break}}}}if(water_near)return true;if(unit_types[punit["type"]]["name"]=="Well-Digger")return true;return false}function can_build_naval_base(punit,ptile){if(typeof EXTRA_NAVALBASE==="undefined")return false;if(!tile_has_extra(ptile,EXTRA_FORT))return false;if(tile_has_extra(ptile,EXTRA_FORTRESS))return false;if(!punit||!ptile)return false;var is_lowland=tile_terrain(ptile)["name"]!="Hills"&&tile_terrain(ptile)["name"]!="Mountains";var water_near=false;for(var dir=1;dir<7;dir++){if(dir==2||dir==5)continue;var tile1=mapstep(ptile,dir);if(tile1!=null){if(terrains[tile1["terrain"]]["name"]=="Lake"||terrains[tile1["terrain"]]["name"]=="Ocean"||terrains[tile1["terrain"]]["name"]=="Deep Ocean"){water_near=true;break}}}return unit_can_do_action(punit,ACTION_BASE)&&is_lowland&&water_near&&tech_known("Engineering")}function key_unit_canal(){if(typeof EXTRA_CANAL==="undefined")return;const funits=get_units_in_focus();for(var i=0;i<funits.length;i++){const punit=funits[i];const ptile=index_to_tile(punit["tile"]);var allowed_type=can_build_canal(punit,ptile);if(allowed_type){request_new_unit_activity(punit,ACTIVITY_GEN_ROAD,allowed_type);remove_unit_id_from_waiting_list(punit["id"])}}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_naval_base(){if(typeof EXTRA_NAVALBASE==="undefined")return;const funits=get_units_in_focus();for(var i=0;i<funits.length;i++){const punit=funits[i];request_new_unit_activity(punit,ACTIVITY_IDLE,EXTRA_NONE)}setTimeout(function(){for(var i=0;i<funits.length;i++){const punit=funits[i];const ptile=index_to_tile(punit["tile"]);if(can_build_naval_base(punit,ptile)){request_new_unit_activity(punit,ACTIVITY_BASE,EXTRA_NAVALBASE);remove_unit_id_from_waiting_list(punit["id"])}}},200);deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_road(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];var ptile=index_to_tile(punit["tile"]);if(unit_types[punit["type"]]["name"]=="Well-Digger"){request_new_unit_activity(punit,ACTIVITY_GEN_ROAD,extras["River"]["id"]);remove_unit_id_from_waiting_list(punit["id"])}else if(is_ocean_tile(ptile)){if(can_build_sea_bridge(punit,ptile)&&!tile_has_extra(ptile,EXTRA_SEABRIDGE)){request_new_unit_activity(punit,ACTIVITY_GEN_ROAD,extras["Sea Bridge"]["id"]);remove_unit_id_from_waiting_list(punit["id"])}else if(typeof EXTRA_SEABRIDGE!=="undefined"&&tile_has_extra(ptile,EXTRA_SEABRIDGE)&&!tile_has_extra(ptile,EXTRA_RAIL)){request_new_unit_activity(punit,ACTIVITY_GEN_ROAD,extras["Railroad"]["id"]);remove_unit_id_from_waiting_list(punit["id"])}else if(can_build_maglev(punit,ptile)){request_new_unit_activity(punit,ACTIVITY_GEN_ROAD,extras["Maglev"]["id"]);remove_unit_id_from_waiting_list(punit["id"])}}else if(!tile_has_extra(ptile,EXTRA_ROAD)){request_new_unit_activity(punit,ACTIVITY_GEN_ROAD,extras["Road"]["id"]);remove_unit_id_from_waiting_list(punit["id"])}else if(!tile_has_extra(ptile,EXTRA_RAIL)){request_new_unit_activity(punit,ACTIVITY_GEN_ROAD,extras["Railroad"]["id"]);remove_unit_id_from_waiting_list(punit["id"])}else if(can_build_maglev(punit,ptile)){request_new_unit_activity(punit,ACTIVITY_GEN_ROAD,extras["Maglev"]["id"]);remove_unit_id_from_waiting_list(punit["id"])}}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_quay(){var quay_rules=client_rules_flag[CRF_EXTRA_QUAY];var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];var ptile=tiles[punit["tile"]];var activity=EXTRA_NONE;if(quay_rules)activity=EXTRA_QUAY;request_new_unit_activity(punit,ACTIVITY_GEN_ROAD,activity);remove_unit_id_from_waiting_list(punit["id"])}deactivate_goto(false);setTimeout(update_unit_focus,update_focus_delay)}function key_unit_homecity(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];var ptile=index_to_tile(punit["tile"]);var pcity=tile_city(ptile);if(pcity!=null){request_unit_do_action(ACTION_HOME_CITY,punit["id"],pcity["id"]);$("#order_change_homecity").hide()}}deactivate_goto(false)}function key_unit_action_select(){if(action_tgt_sel_active==true){action_tgt_sel_active=false;request_unit_act_sel_vs_own_tile()}else{action_tgt_sel_active=true;message_log.update({event:E_BEGINNER_HELP,message:"Click target tile. "+"(<b>D</b> = own tile. <b>SPACE</b> aborts)"})}deactivate_goto(false)}function request_unit_act_sel_vs(ptile){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];var packet={pid:packet_unit_sscs_set,unit_id:punit["id"],type:USSDT_QUEUE,value:ptile["index"]};send_request(JSON.stringify(packet))}}function request_unit_act_sel_vs_own_tile(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];var packet={pid:packet_unit_sscs_set,unit_id:punit["id"],type:USSDT_QUEUE,value:punit["tile"]};send_request(JSON.stringify(packet))}}function key_unit_auto_settle(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];request_unit_autosettlers(punit);remove_unit_id_from_waiting_list(punit["id"])}setTimeout(update_unit_focus,update_focus_delay);deactivate_goto(false)}function request_unit_cancel_orders(punit){if(punit!=null&&(punit.ai||punit.has_orders)){punit.ai=false;punit.has_orders=false;var packet={pid:packet_unit_orders,unit_id:punit.id,src_tile:punit.tile,length:0,repeat:false,vigilant:false,dest_tile:punit.tile};packet.orders=packet.dir=packet.activity=packet.sub_target=packet.action=[];send_request(JSON.stringify(packet))}}function request_new_unit_activity(punit,activity,target){request_unit_cancel_orders(punit);action_decision_clear_want(punit["id"]);var packet={pid:packet_unit_change_activity,unit_id:punit["id"],activity:activity,target:target};send_request(JSON.stringify(packet))}function request_unit_autosettlers(punit){if(punit!=null){request_unit_cancel_orders(punit);action_decision_clear_want(punit["id"]);var packet={pid:packet_unit_autosettlers,unit_id:punit["id"]};send_request(JSON.stringify(packet))}}function request_unit_build_city(){if(current_focus.length>0){var punit=current_focus[0];if(punit!=null){if(punit["movesleft"]==0){message_log.update({event:E_BAD_COMMAND,message:unit_type(punit).rule_name+" have no moves left to build city"});return}var ptype=unit_type(punit);if(true){var packet=null;var target_city=tile_city(index_to_tile(punit["tile"]));if(target_city==null){packet={pid:packet_city_name_suggestion_req,unit_id:punit["id"]};send_request(JSON.stringify(packet))}else{action_decision_clear_want(punit["id"]);packet={pid:packet_unit_do_action,actor_id:punit["id"],target_id:target_city["id"],extra_id:EXTRA_NONE,sub_tgt_id:0,name:"",action_type:ACTION_JOIN_CITY};swal({title:"Add "+ptype["name"]+" to \n"+target_city["name"]+"?",text:"Unit will add +1 population and re-arrange citizen tile workers.",type:"info",background:"#a19886",showCancelButton:true,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes",cancelButtonText:"No"},function(){send_request(JSON.stringify(packet));setTimeout(update_active_units_dialog,update_focus_delay)});setSwalTheme()}}}}}function request_unit_do_action(action_id,actor_id,target_id,sub_tgt_id,name){send_request(JSON.stringify({pid:packet_unit_do_action,action_type:action_id,actor_id:actor_id,target_id:target_id,sub_tgt_id:sub_tgt_id||0,name:name||""}));action_decision_clear_want(actor_id)}function key_unit_disband(){var plural=false,recycle=true,swaltype="info";var ptitle,ptext,cb_text,cb_color="#DD6B55";var focus_units=get_units_in_focus();for(var i=0;i<focus_units.length;i++){if(i>=1)plural=true;var pcity=tile_city(index_to_tile(focus_units[i]["tile"]));if(!pcity){recycle=false;swaltype="warning"}}if(recycle){if(plural){ptitle="Recycle units?";ptext="Recycle these units into city production?";cb_color="#55DD6B";cb_text="Yes, recycle units."}else{ptitle="Recycle unit?";ptext="Recycle this unit into city production?";cb_color="#55DD6B";cb_text="Yes, recycle unit."}}else{if(plural){ptitle="Disband units?";ptext="Do you want to destroy these units?";cb_text="Yes, disband units."}else{ptitle="Disband unit?";ptext="Do you want to destroy this unit?";cb_text="Yes, disband unit."}}swal({title:ptitle,text:ptext,type:swaltype,showCancelButton:true,confirmButtonColor:cb_color,confirmButtonText:cb_text,closeOnConfirm:true,html:true},function(){var funits=get_units_in_focus();for(var i=0;i<funits.length;i++){var punit=funits[i];var packet=null;var target_city=tile_city(index_to_tile(punit["tile"]));action_decision_clear_want(punit["id"]);packet={pid:packet_unit_do_action,actor_id:punit["id"],target_id:target_city==null?punit["id"]:target_city["id"],extra_id:EXTRA_NONE,sub_tgt_id:0,name:"",action_type:target_city==null?ACTION_DISBAND_UNIT:ACTION_RECYCLE_UNIT};send_request(JSON.stringify(packet));force_clear_unit(punit["id"])}setTimeout(update_unit_focus,update_focus_delay);setTimeout(update_active_units_dialog,update_focus_delay+100)});setSwalTheme();deactivate_goto(false)}function key_unit_move(dir){var funits=get_units_in_focus();if(!funits||funits.length<1)return;for(var i=0;i<funits.length;i++){var punit=funits[i];if(punit==null){return}var ptile=index_to_tile(punit["tile"]);if(ptile==null){return}var newtile=mapstep(ptile,dir);if(newtile==null){return}var order={order:ORDER_ACTION_MOVE,dir:dir,activity:ACTIVITY_LAST,sub_target:0,action:ACTION_COUNT};if(punit["transported"]&&newtile["units"].every(function(ounit){return ounit["owner"]==client.conn.playing.playerno})&&(tile_city(newtile)==null||tile_city(newtile)["owner"]==client.conn.playing.playerno)&&!tile_has_extra(newtile,EXTRA_HUT)&&(newtile["extras_owner"]==client.conn.playing.playerno||!tile_has_territory_claiming_extra(newtile))){order["order"]=ORDER_MOVE}var packet={pid:packet_unit_orders,unit_id:punit["id"],src_tile:ptile["index"],length:1,repeat:false,vigilant:false,orders:[order],dest_tile:newtile["index"]};send_request(JSON.stringify(packet));remove_unit_id_from_waiting_list(punit["id"]);if(punit["movesleft"]>0&&punit["owner"]==client.conn.playing.playerno)unit_move_sound_play(punit)}deactivate_goto(true);if(focuslock)focuslock_unit()}function key_unit_move_focus_index(dir,s){if(current_focus.length>0){var punit=current_focus[s];if(punit==null){return}var ptile=index_to_tile(punit["tile"]);if(ptile==null){return}var newtile=mapstep(ptile,dir);if(newtile==null){return}if(punit["transported"]){if(unit_can_do_action(punit,ACTION_TRANSPORT_DISEMBARK1)){request_new_unit_activity(punit,ACTIVITY_IDLE,EXTRA_NONE);request_unit_do_action(ACTION_TRANSPORT_DISEMBARK1,punit["id"],newtile["index"]);unit_move_sound_play(punit)}else if(unit_can_do_action(punit,ACTION_TRANSPORT_DISEMBARK2)){request_new_unit_activity(punit,ACTIVITY_IDLE,EXTRA_NONE);request_unit_do_action(ACTION_TRANSPORT_DISEMBARK2,punit["id"],newtile["index"]);unit_move_sound_play(punit)}return}var order={order:ORDER_ACTION_MOVE,dir:dir,activity:ACTIVITY_LAST,sub_target:0,action:ACTION_COUNT};var packet={pid:packet_unit_orders,unit_id:punit["id"],src_tile:ptile["index"],length:1,repeat:false,vigilant:false,orders:[order],dest_tile:newtile["index"]};send_request(JSON.stringify(packet));if(focuslock)focuslock_unit();remove_unit_id_from_waiting_list(punit["id"]);if(punit["movesleft"]>0&&punit["owner"]==client.conn.playing.playerno)unit_move_sound_play(punit)}deactivate_goto(true)}function focuslock_unit(){setTimeout(auto_center_on_focus_unit,420)}function key_paste_link_under_cursor(){var ptile=canvas_pos_to_tile(mouse_x,mouse_y);var pcity=tile_city(ptile);var sunits=tile_units(ptile);var own_unit_index=-1;var player_has_own_unit_present=false;if(pcity==null&&sunits!=null&&sunits.length>0){var own_unit_index=-1;for(var u=0;u<sunits.length;u++){if(sunits[u]["owner"]==client.conn.playing.playerno){own_unit_index=u;player_has_own_unit_present=true}if(player_has_own_unit_present)break}var selected_index=own_unit_index==-1?0:own_unit_index;var name=unit_types[sunits[selected_index]["type"]]["name"];var nationality=nations[players[sunits[selected_index]["owner"]]["nation"]]["adjective"];$("#game_text_input").val($("#game_text_input").val()+"%%unit"+sunits[selected_index]["id"]+"_%"+nationality+" "+name+"~~ ");copy_string_to_clipboard("%%%unit"+sunits[selected_index]["id"]+"_%"+nationality+" "+name+"~~ ")}else{$("#game_text_input").val($("#game_text_input").val()+"%%tile"+ptile["index"]+"~% ");copy_string_to_clipboard("%%%tile"+ptile["index"]+"~% ")}add_client_message("Link copied to clipboard.");$("#game_text_input").focus()}function request_goto_path(unit_id,dst_x,dst_y){if(goto_request_map[unit_id+","+dst_x+","+dst_y]==null){goto_request_map[unit_id+","+dst_x+","+dst_y]=true;var packet={pid:packet_goto_path_req,unit_id:unit_id,goal:map_pos_to_tile(dst_x,dst_y)["index"]};send_request(JSON.stringify(packet));current_goto_turns=null;$("#unit_text_details").html("Choose unit goto");setTimeout(update_mouse_cursor,update_mouse_cursor_delay)}else{update_goto_path(goto_request_map[unit_id+","+dst_x+","+dst_y])}}function check_request_goto_path(){var ptile;if(goto_active&&current_focus.length>0&&(prev_mouse_x!=mouse_x||prev_mouse_y!=mouse_y||prev_goto_tile<=LAST_FORCED_CHECK)){ptile=canvas_pos_to_tile(mouse_x,mouse_y);if(ptile!=null){if(ptile["tile"]!=prev_goto_tile){clear_goto_tiles();for(var i=0;i<current_focus.length;i++){request_goto_path(current_focus[i]["id"],ptile["x"],ptile["y"])}}if(prev_goto_tile<=LAST_FORCED_CHECK){prev_goto_tile++;if(prev_goto_tile>LAST_FORCED_CHECK){if(ptile)prev_goto_tile=ptile["tile"]}}else prev_goto_tile=FORCE_CHECKS_AGAIN}}prev_mouse_x=mouse_x;prev_mouse_y=mouse_y}function update_goto_path(goto_packet){var punit=units[goto_packet["unit_id"]];if(punit==null)return;var t0=index_to_tile(punit["tile"]);var ptile=t0;var goaltile=index_to_tile(goto_packet["dest"]);var refuel=0;if(ptile==goaltile)return;for(var i=0;i<goto_packet["dir"].length;i++){if(ptile==null)break;var dir=goto_packet["dir"][i];if(dir==-1){refuel++;continue}ptile["goto_dir"]=dir;ptile=mapstep(ptile,dir)}current_goto_turns=goto_packet["turns"];goto_request_map[goto_packet["unit_id"]+","+goaltile["x"]+","+goaltile["y"]]=goto_packet;goto_turns_request_map[goto_packet["unit_id"]+","+goaltile["x"]+","+goaltile["y"]]=current_goto_turns;if(current_goto_turns!=="undefined"){var path_length=goto_packet["length"];if(refuel)path_length-=refuel;$("#active_unit_info").html("Path: "+path_length+" tiles")}update_mouse_cursor()}function show_goto_path(goto_packet){update_goto_path(goto_packet)}function center_tile_mapcanvas(ptile){center_tile_mapcanvas_2d(ptile)}function popit(){var ptile=canvas_pos_to_tile(mouse_x,mouse_y);if(ptile==null)return;mclick_tile=ptile;setTimeout(popit_req(ptile),150)}function popit_req(ptile){$("#canvas").contextMenu(false);$(".context-menu-list").trigger("contextmenu:hide");setTimeout(function(){$("#canvas").contextMenu(true)},450);if(ptile==null)return;copy_string_to_clipboard("%%%"+"tile"+ptile["index"]+"~%");if(tile_get_known(ptile)==TILE_KNOWN_UNSEEN){show_dialog_message("Tile info","Location: x:"+ptile["x"]+" y:"+ptile["y"]);return}else if(tile_get_known(ptile)==TILE_UNKNOWN){show_dialog_message("Tile info","Location: x:"+ptile["x"]+" y:"+ptile["y"]);return}var punit_id=0;var punit=find_visible_unit(ptile);if(punit!=null)punit_id=punit["id"];var focus_unit_id=0;if(current_focus.length>0){focus_unit_id=current_focus[0]["id"]}var packet={pid:packet_info_text_req,visible_unit:punit_id,loc:ptile["index"],focus_unit:focus_unit_id};send_request(JSON.stringify(packet));if(punit_id){var tunits=tile_units(ptile);for(u=0;u<tunits.length;u++){if(tunits[u]["goto_tile"]!=="undefined"){var goto_tile_id=tunits[u]["goto_tile"];if(goto_tile_id>0){request_goto_path(tunits[u]["id"],tiles[goto_tile_id]["x"],tiles[goto_tile_id]["y"])}}}}}function center_on_any_city(){var fallback_city;if(!client_is_observer()){for(var city_id in cities){var pcity=cities[city_id];if(pcity["owner"]==client.conn.playing.playerno){fallback_city=pcity;if(city_has_building(pcity),improvement_id_by_name("Palace")){center_tile_mapcanvas(city_tile(pcity));return}}}if(fallback_city){center_tile_mapcanvas(city_tile(fallback_city));return}for(var unit_id in units){var punit=units[unit_id];if(punit["owner"]==client.conn.playing.playerno){center_tile_mapcanvas(unit_tile(punit));return}}}for(var city_id in cities){var pcity=cities[city_id];center_tile_mapcanvas(city_tile(pcity));return}}function update_active_units_dialog(){var unit_info_html="";var ptile=null;var punits=[];var width=0;var mobile_mode=is_small_screen();var unit_name="";if(!unitpanel_active)return;if(current_focus.length==1){ptile=index_to_tile(current_focus[0]["tile"]);punits.push(current_focus[0]);var tmpunits=tile_units(ptile);for(var i=0;i<tmpunits.length;i++){var kunit=tmpunits[i];if(kunit["id"]==current_focus[0]["id"])continue;punits.push(kunit)}}else if(current_focus.length>1){ptile=index_to_tile(current_focus[0]["tile"]);for(var i=0;i<current_focus.length;i++){punits.push(current_focus[i])}var tmpunits=tile_units(ptile);for(var i=0;i<tmpunits.length;i++){var index=punits.findIndex(x=>x.id==tmpunits[i].id);if(index===-1){punits.push(tmpunits[i])}}}punits.sort(function(u1,u2){if(u1["transported"]==true)return 1;if(u2["transported"]==true)return-1;if(u1["type"]<u2["type"])return-1;if(u1["type"]>u2["type"])return 1;if(u1["movesleft"]>u2["movesleft"])return-1;if(u1["movesleft"]<u2["movesleft"])return 1;if(u1["hp"]>u2["hp"])return-1;if(u1["hp"]<u2["hp"])return 1;if(u1["veteran"]>u2["veteran"])return-1;if(u1["veteran"]<u2["veteran"])return 1;if(u1["id"]>u2["id"])return-1;if(u1["id"]<u2["id"])return 1;return 0});var fromIndex=punits.length-1;var already_moved=[];var exit_while=false;var sanity_assert=0;while(punits[fromIndex]&&punits[fromIndex]["transported"]&&exit_while==false){var tunit_id=punits[fromIndex]["transported_by"];sanity_assert++;var trIndex=0;if(sanity_assert>1e3){console.log("Unit panel sort could not break from loop.");break}for(trIndex=0;trIndex<punits.length;trIndex++){if(punits[trIndex]["id"]==tunit_id){var insertIndex=trIndex+1;var element=punits.pop();if(insertIndex>=fromIndex){punits.push(element)}else{punits.splice(insertIndex,0,element)}if(already_moved.includes(element)){exit_while=true}else{already_moved.push(element)}}}}for(var i=0;i<punits.length;i++){var punit=punits[i];var sprite=get_unit_image_sprite(punit);if(sprite==null){add_client_message("Uncached graphics didn't have time to load. Please refresh browser to reload site.");alert("Warning - Site was rebuilt.\nGraphical sprites do not match cache.\nPlease reload page to fix.\n\n"+"If that doesn't work, wiping the browser cache for the site forces graphics to reset.");continue}var active=false;var index=current_focus.findIndex(x=>x.id==punit.id);if(index===-1){active=false}else active=true;var display_background_css;var trans_help_title="";if(active){display_background_css=punit["transported"]&&punit["transported_by"]>0?"transported_focus_unit":"current_focus_unit"}else{display_background_css=punit["transported"]&&punit["transported_by"]>0?"transported_nonfocus_unit":"nonfocus_unit"}if(unit_type(punit)["transport_capacity"]>0)trans_help_title+="T"+punit["id"]+" &#010;";if(punit["transported_by"])trans_help_title+="on "+punit["transported_by"];unit_info_html+="<div id='unit_info_div' title='"+trans_help_title+"' class='"+display_background_css+"'><div id='unit_info_image' onclick='click_unit_in_panel(event, units["+punit["id"]+"])' "+" style='margin-right:1px; background: transparent url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px; width:64px;height:48px;'"+"'></div></div>";unit_info_html+=get_html_vet_sprite(punit);unit_info_html+=get_html_hp_sprite(punit,true);width=64}var active_uinfo="";if(current_focus.length==1){var aunit=current_focus[0];var ptype=unit_type(aunit);active_uinfo+="<div id='active_unit_info' title=''>";if(client.conn.playing!=null&&current_focus[0]["owner"]!=client.conn.playing.playerno){unit_name=nations[players[current_focus[0]["owner"]]["nation"]]["adjective"]+" ";if(!mobile_mode)unit_name="<b>"+unit_name+"<b>";else unit_name="<span style='font-size:90%'>"+unit_name+"&nbsp;</span>"}if(ptype["transport_capacity"]>0){if(mobile_mode){unit_name+="<span style='font-size:90%'>"+ptype["name"]+"<font color='#C8E8FF'>#"+aunit["id"]+"</font></span>"}else{unit_name+="<b>"+ptype["name"]+"</b> <font title='Transport ID' style='font-size:90%' color='#C8E8FF'>#"+aunit["id"]+"</font>"}}else{if(mobile_mode){unit_name+="<span style='font-size:90%'>"+ptype["name"]+"</span>"}else{if(DEBUG_UNITS)unit_name+=aunit["id"]+".";unit_name+="<b>"+ptype["name"]+"</b>"}}if(get_unit_homecity_name(aunit)!=null){if(mobile_mode){unit_name+="<span style='font-size:90%'>: "+get_unit_homecity_name(aunit)+"</span>"}else{unit_name+=": "+get_unit_homecity_name(aunit)+" "}}else unit_name+=" ";if(!mobile_mode)active_uinfo+=unit_name;if(client.conn.playing!=null&&current_focus[0]["owner"]==client.conn.playing.playerno){if(mobile_mode){active_uinfo+="<span style='color:white'> &nbsp; M:<span style='color:lightgreen;font-size:110%'><b>"+move_points_text(aunit["movesleft"],false)+"</b></span></span>"}else{active_uinfo+="<span style='color:white'>Moves:<span style='color:lightgreen;font-size:120%;'><b>"+move_points_text(aunit["movesleft"],false)+"</b></span></span> "}}if(mobile_mode){active_uinfo+="<span>&nbsp;H:<span style='color:lightpink;font-size:110%'><b>"+aunit["hp"]+" </b> </span> </span>"+unit_name}else{active_uinfo+="<span title='Attack'>A:<span style='color:gainsboro;font-size:100%;'><b>"+utype_real_base_attack_strength(ptype)+"</b></span></span> <span title='Defense'>D:<span style='color:gainsboro;font-size:100%;'><b>"+utype_real_base_defense_strength(ptype)+"</b></span></span> <span title='Firepower'>FP:<span style='color:gainsboro;font-size:100%;'><b>"+ptype["firepower"]+"</b></span></span> <span title='Health'>H:<span style='color:lightpink;font-size:120%;'><b>"+aunit["hp"]+"</b></span></span>"}if(aunit["veteran"]>0){if(mobile_mode){}else{active_uinfo+=" <span title='Vet-level'>V:<span style='color:gainsboro;font-size:100%;'><b>"+aunit["veteran"]+"</b></span></span>"}}if(ptype["transport_capacity"]>0){if(mobile_mode){}else{active_uinfo+=" <span title='Cargo Capacity'>C:<span style='color:gainsboro;font-size:100%;'><b>"+ptype["transport_capacity"]+"</b></span></span>"}}if(aunit["transported"]&&aunit["transported_by"]>0){active_uinfo+=" <span title='Transporter ID' style='color:lightskyblue'><b>On </b>#"+aunit["transported_by"]+"</span>"}if(client.conn.playing!=null&&ptype["fuel"]>0&&current_focus[0]["owner"]==client.conn.playing.playerno){var fuel_left=aunit["fuel"]-1+aunit["movesleft"]/ptype["move_rate"];var fuel_color="";var size_adj=mobile_mode?"font-size:100%":"font-size:100%;";if(aunit["movesleft"]==0)fuel_color="<span style='color:gainsboro;"+size_adj+"'><b>";else if(fuel_left>2.001)fuel_color="<span style='color:deepskyblue;"+size_adj+"'><b>";else if(fuel_left>1.001)fuel_color="<span style='color:darkturquoise;"+size_adj+"'><b>";else if(fuel_left>.85)fuel_color="<span style='color:lawngreen;"+size_adj+"'><b>";else if(fuel_left>.67)fuel_color="<span style='color:greenyellow;"+size_adj+"'><b>";else if(fuel_left>.63)fuel_color="<span style='color:yellow;"+size_adj+"'><b>";else if(fuel_left>.59)fuel_color="<span style='color:gold;"+size_adj+"'><b>";else if(fuel_left>.55)fuel_color="<span style='color:orange;"+size_adj+"'><b>";else if(fuel_left>.5)fuel_color="<span style='color:orangered;"+size_adj+"'><b>";else fuel_color="<span style='color:red;"+size_adj+"'><b>";if(aunit["movesleft"]==0&&fuel_left<1.0001){fuel_left=""}else{if(mobile_mode){active_uinfo+=" <span>F:"+fuel_color+fuel_left.toFixed(fuel_left<1?2:1)+"</b></span></span>"}else{active_uinfo+=" <span title='Fuel Left'>Fuel:"+fuel_color+fuel_left.toFixed(fuel_left<1?2:1)+"</b></span></span>"}}}active_uinfo+="</div>"}else if(current_focus.length>=1&&client.conn.playing!=null&&current_focus[0]["owner"]!=client.conn.playing.playerno){active_uinfo+="<div id='active_unit_info'>"+current_focus.length+" foreign units  ("+nations[players[current_focus[0]["owner"]]["nation"]]["adjective"]+")</div> "}else if(current_focus.length>1){active_uinfo+="<div id='active_unit_info'>"+current_focus.length+" units selected.</div> "}if(current_focus.length>0){var newwidth=32+punits.length*(width+2)+11;if(newwidth<140)newwidth=140;var newheight=75+normal_tile_height;if(!mobile_mode&&punits.length>1){newwidth-=8;if(punits.length>2){newheight-=13;if(punits.length>3){newheight-=13}}}var max_units_per_row=mobile_mode?5:8;if(punits.length>max_units_per_row){var columns=5;var vertical_room=window.innerHeight-45-28-24;var max_rows=Math.floor(vertical_room/50);var max_units=columns*max_rows;if(punits.length>max_units){columns+=Math.ceil((punits.length-max_units)/max_rows)}newwidth=32+columns*(width+2)+1;newheight=(normal_tile_height+1)*Math.ceil(punits.length/columns)+50}unit_info_html+=active_uinfo;$("#game_unit_info").html(unit_info_html);if(mobile_mode)newwidth-=40;if(mobile_mode&&newwidth>=$(window).width()-40){$("#active_unit_info").html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+$("#active_unit_info").html())}$("#game_unit_panel").parent().show();if(mobile_mode){$("#game_unit_panel").parent().width(newwidth);$("#game_unit_panel").parent().height(71);$("#game_unit_panel").parent().css("left",$(window).width()>newwidth?$(window).width()-newwidth+"px":"0px");$("#game_unit_panel").parent().css("top",$(window).height()-81+"px");$("#game_unit_panel").parent().css("background","rgba(50,50,40,0.95)")}else{$("#game_unit_panel").parent().width(newwidth);$("#game_unit_panel").parent().height(newheight+6);$("#game_unit_panel").parent().css("left",$(window).width()-newwidth-3+"px");$("#game_unit_panel").parent().css("top",$(window).height()-newheight-20+"px");$("#game_unit_panel").parent().css("background","rgba(50,50,40,0.5)")}if(game_unit_panel_state=="minimized")$("#game_unit_panel").dialogExtend("minimize")}else{$("#game_unit_panel").parent().hide()}$("#active_unit_info").tooltip()}function set_mouse_touch_started_on_unit(ptile){if(ptile==null)return;if(!enable_goto_drag){mouse_touch_started_on_unit=false;return}var sunit=find_visible_unit(ptile);if(sunit!=null&&client.conn.playing!=null&&sunit["owner"]==client.conn.playing.playerno){mouse_touch_started_on_unit=true}else{mouse_touch_started_on_unit=false}}function check_mouse_drag_unit(ptile){if(ptile==null||!mouse_touch_started_on_unit)return;var sunit=find_visible_unit(ptile);if(sunit!=null){if(client.conn.playing!=null&&sunit["owner"]==client.conn.playing.playerno){set_unit_focus(sunit);if(!$(".context-menu-list").is(":visible"))activate_goto()}}var ptile_units=tile_units(ptile);if(ptile_units.length>1){update_active_units_dialog()}}function popup_fullscreen_enter_game_dialog(){if(is_small_screen())return;id="#fullscreen_dialog";remove_active_dialog(id);$("#fullscreen_dialog").css("white-space","pre-wrap");$("<div id='fullscreen_dialog'></div>").appendTo("div#game_page");if(!is_small_screen())$(id).html("<b>Enters Full Screen when you interact with game.</b><br><br><b>ALT-S</b> toggles Full Screen.<br><b>ESC</b> exits full screen.");else $(id).html("<b>Play in Full Screen Mode.");var buttons={"Yes!":function(){openFullscreen();remove_active_dialog(id)},No:function(){remove_active_dialog(id)}};$(id).attr("title","Full Immersion Mode");var dwidth=is_small_screen()?"90%":"480";$(id).dialog({bgiframe:true,modal:true,buttons:buttons,height:"auto",width:dwidth});$(id).dialog("open");$(id).dialog("widget").position({my:"center",at:"center",of:window});dialog_register(id)}function openFullscreen(){var elem=document.documentElement;if(!elem){if(active_dialogs.length){var dialog_id=active_dialogs.pop();remove_active_dialog(dialog_id)}return}if(elem.requestFullscreen){elem.requestFullscreen()}else if(elem.webkitRequestFullscreen){elem.webkitRequestFullscreen()}else if(elem.msRequestFullscreen){elem.msRequestFullscreen()}$("html").click(function(){if(!document.fullscreenElement&&$("html").length>0&&$("html")[0].requestFullscreen!=="undefined"){$("html")[0].requestFullscreen()}})}function setSwalTheme(){$(".confirm").css("color","#5C5");$(".cancel").css("color","#C55");$(".sweet-alert").children().css("color","#d4cfb9")}function clickMask(ev,pane){x1=ev.clientX;y1=ev.clientY;ev.stopPropagation();if(x1==0&&y1==0)return;if(x1!==undefined&&y1!==undefined){$("#ixtjkiller"+pane).css("pointer-events","none");jQuery(document.elementFromPoint(x1,y1)).click();$("#ixtjkiller"+pane).css("pointer-events","auto")}}var CLAUSE_ADVANCE=0;var CLAUSE_GOLD=1;var CLAUSE_MAP=2;var CLAUSE_SEAMAP=3;var CLAUSE_CITY=4;var CLAUSE_CEASEFIRE=5;var CLAUSE_PEACE=6;var CLAUSE_ALLIANCE=7;var CLAUSE_VISION=8;var CLAUSE_EMBASSY=9;var SPECENUM_COUNT=10;var clause_infos={};var diplomacy_clause_map={};var last_dialog_counterpart=-1;function diplomacy_init_meeting_req(counterpart){var packet={pid:packet_diplomacy_init_meeting_req,counterpart:counterpart};send_request(JSON.stringify(packet))}function show_diplomacy_dialog(counterpart){var pplayer=players[counterpart];create_diplomacy_dialog(pplayer,Handlebars.templates["diplomacy_meeting"])}function accept_treaty_req(counterpart_id){var packet={pid:packet_diplomacy_accept_treaty_req,counterpart:counterpart_id};send_request(JSON.stringify(packet))}function accept_treaty(counterpart,I_accepted,other_accepted){if(I_accepted==true&&other_accepted==true){diplomacy_clause_map[counterpart]=[];cleanup_diplomacy_dialog(counterpart)}else{var agree_sprite=get_treaty_agree_thumb_up();var disagree_sprite=get_treaty_disagree_thumb_down();var agree_html="<div style='float:left; background: transparent url("+agree_sprite["image-src"]+"); background-position:-"+agree_sprite["tileset-x"]+"px -"+agree_sprite["tileset-y"]+"px;  width: "+agree_sprite["width"]+"px;height: "+agree_sprite["height"]+"px; margin: 5px; '>"+"</div>";var disagree_html="<div style='float:left; background: transparent url("+disagree_sprite["image-src"]+"); background-position:-"+disagree_sprite["tileset-x"]+"px -"+disagree_sprite["tileset-y"]+"px;  width: "+disagree_sprite["width"]+"px;height: "+disagree_sprite["height"]+"px; margin: 5px; '>"+"</div>";if(I_accepted==true){$("#agree_self_"+counterpart).html(agree_html)}else{$("#agree_self_"+counterpart).html(disagree_html)}if(other_accepted){$("#agree_counterpart_"+counterpart).html(agree_html)}else{$("#agree_counterpart_"+counterpart).html(disagree_html)}}}function cancel_meeting_req(counterpart_id){var packet={pid:packet_diplomacy_cancel_meeting_req,counterpart:counterpart_id};send_request(JSON.stringify(packet))}function create_clause_req(counterpart_id,giver,type,value){if(type==CLAUSE_CEASEFIRE||type==CLAUSE_PEACE||type==CLAUSE_ALLIANCE){var clauses=diplomacy_clause_map[counterpart_id];for(var i=0;i<clauses.length;i++){var clause=clauses[i];if(clause["type"]==CLAUSE_CEASEFIRE||clause["type"]==CLAUSE_PEACE||clause["type"]==CLAUSE_ALLIANCE){remove_clause_req(counterpart_id,i)}}}var packet={pid:packet_diplomacy_create_clause_req,counterpart:counterpart_id,giver:giver,type:type,value:value};send_request(JSON.stringify(packet))}function cancel_meeting(counterpart){diplomacy_clause_map[counterpart]=[];cleanup_diplomacy_dialog(counterpart)}function cleanup_diplomacy_dialog(counterpart_id){var diplomacy_dialog="diplomacy_dialog_"+counterpart_id;$("#"+diplomacy_dialog).empty();$("#"+diplomacy_dialog).remove();$("#dialog-extend-fixed-container > [aria-describedby="+diplomacy_dialog+"]").remove()}function discard_diplomacy_dialogs(){for(var counterpart in diplomacy_clause_map){cleanup_diplomacy_dialog(counterpart)}diplomacy_clause_map={}}function show_diplomacy_clauses(counterpart_id){var clauses=diplomacy_clause_map[counterpart_id];var diplo_html="";for(var i=0;i<clauses.length;i++){var clause=clauses[i];var diplo_str=client_diplomacy_clause_string(clause["counterpart"],clause["giver"],clause["type"],clause["value"]);diplo_html+="<a href='#' onclick='remove_clause_req("+counterpart_id+", "+i+");'>"+diplo_str+"</a><br>"}$("#diplomacy_messages_"+counterpart_id).html(diplo_html)}function remove_clause_req(counterpart_id,clause_no){var clauses=diplomacy_clause_map[counterpart_id];var clause=clauses[clause_no];var packet={pid:packet_diplomacy_remove_clause_req,counterpart:clause["counterpart"],giver:clause["giver"],type:clause["type"],value:clause["value"]};send_request(JSON.stringify(packet))}function remove_clause(remove_clause_obj){var counterpart_id=remove_clause_obj["counterpart"];var clause_list=diplomacy_clause_map[counterpart_id];for(var i=0;i<clause_list.length;i++){var check_clause=clause_list[i];if(counterpart_id==check_clause["counterpart"]&&remove_clause_obj["giver"]==check_clause["giver"]&&remove_clause_obj["type"]==check_clause["type"]&&remove_clause_obj["value"]==check_clause["value"]){clause_list.splice(i,1);break}}show_diplomacy_clauses(counterpart_id)}function client_diplomacy_clause_string(counterpart,giver,type,value){var pplayer=players[giver];var nation=nations[pplayer["nation"]]["adjective"];var cb1=players[counterpart].diplstates[giver]["has_reason_to_cancel"];var cb2=players[giver].diplstates[counterpart]["has_reason_to_cancel"];const casus_belli=cb1||cb2;switch(type){case CLAUSE_ADVANCE:var ptech=techs[value];return"The "+nation+" give "+ptech["name"];case CLAUSE_CITY:var pcity=cities[value];if(pcity!=null){return"The "+nation+" give "+decodeURIComponent(pcity["name"])}else{return"The "+nation+" give unknown city."}break;case CLAUSE_GOLD:if(giver==client.conn.playing["playerno"]){$("#self_gold_"+counterpart).val(value)}else{$("#counterpart_gold_"+counterpart).val(value)}return"The "+nation+" give "+value+" gold";case CLAUSE_MAP:return"The "+nation+" give their worldmap";case CLAUSE_SEAMAP:return"The "+nation+" give their seamap";case CLAUSE_CEASEFIRE:return casus_belli?"The parties re-affirm cease-fire.":"The parties agree on a cease-fire";case CLAUSE_PEACE:return casus_belli?"The parties re-affirm peace":"The parties agree on a peace";case CLAUSE_ALLIANCE:return casus_belli?"The parties re-affirm the alliance":"The parties create an alliance";case CLAUSE_VISION:return"The "+nation+" give shared vision";case CLAUSE_EMBASSY:return"The "+nation+" give an embassy"}return""}function diplomacy_cancel_treaty(player_id){var packet={pid:packet_diplomacy_cancel_pact,other_player_id:player_id,clause:DS_CEASEFIRE};send_request(JSON.stringify(packet));update_nation_screen();setTimeout(update_nation_screen,500);setTimeout(update_nation_screen,1500)}function create_diplomacy_dialog(counterpart,template){var pplayer=client.conn.playing;var counterpart_id=counterpart["playerno"];var embassy_meeting;if(!client_rules_flag[CRF_PACTS_SANS_EMBASSY])embassy_meeting=true;else embassy_meeting=pplayer.real_embassy[counterpart["playerno"]]||counterpart.real_embassy[pplayer["playerno"]];$("#game_page").append(template({self:meeting_template_data(embassy_meeting,pplayer,counterpart),counterpart:meeting_template_data(embassy_meeting,counterpart,pplayer)}));var title="Diplomacy: "+counterpart["name"]+" of the "+nations[counterpart["nation"]]["adjective"];var dialog_id="#diplomacy_dialog_"+counterpart_id;var diplomacy_dialog=$(dialog_id);var dialog_height=500;if($(window).height()>550)dialog_height=$(window).height()-50;if(dialog_height>600)dialog_height=600;diplomacy_dialog.dialog({title:title,bgiframe:true,modal:false,width:is_small_screen()?"95%":"50%",height:dialog_height,buttons:{"Accept treaty":function(){accept_treaty_req(counterpart_id)},"Cancel meeting (𝗪)":function(){cancel_meeting_req(counterpart_id)}},close:function(){cancel_meeting_req(counterpart_id)}}).dialogExtend({minimizable:true,closable:true,minimize:function(evt,dlg){unobstruct_minimized_dialog_continer()},icons:{minimize:"ui-icon-circle-minus",restore:"ui-icon-bullet"}});diplomacy_dialog_register(dialog_id,counterpart_id);if(is_small_screen()){$(dialog_id).css("padding","0px");$(dialog_id).parent().children().first().css("font-size","70%");$(".dipl_div").first().children().last().prependTo($(".dipl_div").first());$(".dipl_div").last().children().last().prependTo($(".dipl_div").last());$(".dipl_div").first().css("float","left");$(".dipl_div").last().css("float","right");$("div.dipl_div a").css("margin","0px");$(".diplomacy_player_box h3").css("font-size","100%");$(".diplomacy_player_box h3").first().css("text-align","left");$(".diplomacy_player_box h3").last().css("text-align","right");$(".flag_self,.flag_counterpart").css("transform","scale(.90)");$(".diplomacy_messages").css("font-size","100%")}var nation=nations[pplayer["nation"]];if(nation["customized"]){meeting_paint_custom_flag(nation,document.getElementById("flag_self_"+counterpart_id))}nation=nations[counterpart["nation"]];if(nation["customized"]){meeting_paint_custom_flag(nation,document.getElementById("flag_counterpart_"+counterpart_id))}create_clauses_menu($("#hierarchy_self_"+counterpart_id));create_clauses_menu($("#hierarchy_counterpart_"+counterpart_id));if(game_info.trading_gold&&embassy_meeting&&clause_infos[CLAUSE_GOLD]["enabled"]){$("#self_gold_"+counterpart_id).attr({max:pplayer["gold"],min:0});$("#counterpart_gold_"+counterpart_id).attr({max:counterpart["gold"],min:0});var wto;$("#counterpart_gold_"+counterpart_id).change(function(){clearTimeout(wto);wto=setTimeout(function(){meeting_gold_change_req(counterpart_id,counterpart_id,parseFloat($("#counterpart_gold_"+counterpart_id).val()))},500)});$("#self_gold_"+counterpart_id).change(function(){clearTimeout(wto);wto=setTimeout(function(){meeting_gold_change_req(counterpart_id,pplayer["playerno"],parseFloat($("#self_gold_"+counterpart_id).val()))},500)})}else{$("#self_gold_"+counterpart_id).prop("disabled",true).parent().hide();$("#counterpart_gold_"+counterpart_id).prop("disabled",true).parent().hide()}diplomacy_dialog.css("overflow","visible");diplomacy_dialog.parent().css("z-index",1e3)}function diplomacy_dialog_register(id,counterpart_id){$(id).dialog("widget").keydown(function(){last_dialog_counterpart=counterpart_id;diplomacy_dialog_key_listener(event)});$(id).dialog({autoOpen:true}).bind("dialogclose",function(event,ui){cancel_meeting_req(counterpart_id)});$(id).dialog("widget").position({my:"center top",at:"center top",of:window});$(id).css("color",default_dialog_text_color)}function diplomacy_dialog_key_listener(ev){counterpart_id=last_dialog_counterpart;if($("input:focus").length>0||!keyboard_input)return;if(C_S_RUNNING!=client_state())return;var keyboard_key=String.fromCharCode(ev.keyCode).toUpperCase();if(keyboard_key=="W"){ev.stopPropagation();cancel_meeting_req(counterpart_id)}}function meeting_paint_custom_flag(nation,flag_canvas){var tag="f."+nation["graphic_str"];var flag_canvas_ctx=flag_canvas.getContext("2d");flag_canvas_ctx.scale(1.5,1.5);flag_canvas_ctx.drawImage(sprites[tag],0,0)}function create_clauses_menu(content){content.css({position:"relative",color:default_dialog_text_color});var children=content.children();var button=children.eq(0);var menu=children.eq(1);menu.menu();menu.hide();menu.css({position:"absolute",top:button.height()+parseFloat(button.css("paddingTop"))+parseFloat(button.css("paddingBottom"))+parseFloat(button.css("borderTopWidth")),left:parseFloat(button.css("marginLeft")),color:default_dialog_text_color});var menu_open=function(){menu.show();menu.data("diplAdd","open")};var menu_close=function(){menu.hide();menu.data("diplAdd","closed")};button.click(function(){if(menu.data("diplAdd")=="open"){menu_close()}else{menu_open()}});menu.click(function(e){if(e&&e.target&&e.target.tagName=="A"){menu_close()}});content.hover(menu_open,menu_close)}function meeting_gold_change_req(counterpart_id,giver,gold){var clauses=diplomacy_clause_map[counterpart_id];if(clauses!=null){for(var i=0;i<clauses.length;i++){var clause=clauses[i];if(clause["giver"]==giver&&clause["type"]==CLAUSE_GOLD){if(clause["value"]==gold)return;remove_clause_req(counterpart_id,i)}}}if(gold!=0){var packet={pid:packet_diplomacy_create_clause_req,counterpart:counterpart_id,giver:giver,type:CLAUSE_GOLD,value:gold};send_request(JSON.stringify(packet))}}function meeting_template_data(embassy_meeting,giver,taker){var data={};var nation=nations[giver["nation"]];if(!nation["customized"]){data.flag=nation["graphic_str"]+"-web"+get_tileset_file_extention()}data.adjective=nation["adjective"];data.name=giver["name"];data.pid=giver["playerno"];var all_clauses=[];var clauses=[];if(embassy_meeting&&clause_infos[CLAUSE_MAP]["enabled"]){clauses.push({type:CLAUSE_MAP,value:1,name:"World-map"})}if(embassy_meeting&&clause_infos[CLAUSE_SEAMAP]["enabled"]){clauses.push({type:CLAUSE_SEAMAP,value:1,name:"Sea-map"})}if(clauses.length>0){all_clauses.push({title:"Maps...",clauses:clauses})}if(embassy_meeting&&game_info.trading_tech&&clause_infos[CLAUSE_ADVANCE]["enabled"]){clauses=[];for(var tech_id in techs){if(player_invention_state(giver,tech_id)==TECH_KNOWN&&(player_invention_state(taker,tech_id)==TECH_UNKNOWN&&game_info["tech_trade_allow_holes"]||player_invention_state(taker,tech_id)==TECH_PREREQS_KNOWN)){clauses.push({type:CLAUSE_ADVANCE,value:tech_id,name:techs[tech_id]["name"]})}}if(clauses.length>0){all_clauses.push({title:"Advances...",clauses:clauses})}}if(embassy_meeting&&game_info.trading_city&&clause_infos[CLAUSE_CITY]["enabled"]){clauses=[];for(var city_id in cities){var pcity=cities[city_id];if(city_owner(pcity)==giver&&!does_city_have_improvement(pcity,"Palace")){clauses.push({type:CLAUSE_CITY,value:city_id,name:decodeURIComponent(pcity["name"])})}}if(clauses.length>0){all_clauses.push({title:"Cities...",clauses:clauses})}}if(embassy_meeting&&clause_infos[CLAUSE_VISION]["enabled"]){all_clauses.push({type:CLAUSE_VISION,value:1,name:"Give shared vision"})}if(embassy_meeting&&clause_infos[CLAUSE_EMBASSY]["enabled"]){all_clauses.push({type:CLAUSE_EMBASSY,value:1,name:"Give embassy"})}if(giver==client.conn.playing){clauses=[];if(clause_infos[CLAUSE_CEASEFIRE]["enabled"]){clauses.push({type:CLAUSE_CEASEFIRE,value:1,name:"Cease-fire"})}if(clause_infos[CLAUSE_PEACE]["enabled"]){clauses.push({type:CLAUSE_PEACE,value:1,name:"Peace"})}if(embassy_meeting&&clause_infos[CLAUSE_ALLIANCE]["enabled"]){clauses.push({type:CLAUSE_ALLIANCE,value:1,name:"Alliance"})}if(clauses.length>0){all_clauses.push({title:"Pacts...",clauses:clauses})}}data.clauses=all_clauses;return data}var effects={};var units_sorted_by_type=[];var master_empire_checkbox;var empire_checkbox_states={};var empire_show_hitpoints=false;var empire_show_movesleft=false;var empire_show_present_buildings=true;var empire_show_absent_buildings=false;var empire_show_wonders_only=false;var empire_worklist_clipboard=[];var empire_bldg_tab_saved_mag=0;var empire_upkp_tab_saved_mag=0;var empire_wklst_tab_saved_mag=0;var EMPIRE_UNIT_TYPE_MODE=0;var EMPIRE_UNIT_HOMECITY_MODE=1;var EMPIRE_UNIT_IN_CITY_MODE=2;var EMPIRE_ECON_IMPROVEMENTS=3;var EMPIRE_ECON_UPKEEP=4;var EMPIRE_ECON_WORKLISTS=5;var empire_mode=EMPIRE_UNIT_TYPE_MODE;const SORT_NONE=0;const SORT_HP=1;const SORT_MOVES=2;const SORT_VET=3;const DO_NO_SORT=-1;var empire_sort_mode=SORT_NONE;var empire_upkeep_show_food=true;var empire_upkeep_show_gold=true;var empire_upkeep_show_shields=true;var empire_upkeep_show_free=true;empire_screen_updater=new EventAggregator(update_empire_screen,250,EventAggregator.DP_NONE,250,3,250);function update_empire_screen(){if(observing||freeze)return;$("#empire_scroll").css("width","100%");var wide_screen=$(window).width()<1340?false:true;var narrow_screen=$(window).width()<1e3?true:false;var small_screen=is_small_screen();var landscape_screen=$(window).width()>$(window).height()?true:false;var tiny_screen=false;var redux_screen=false;if(small_screen||narrow_screen&&!scroll_narrow_x){if(scroll_narrow_x){tiny_screen=true;redux_screen=true;wide_screen=false;if(scroll_narrow_x&&narrow_screen&&!landscape_screen)$("#cities_scroll").css("width","110%")}else{tiny_screen=true;redux_screen=false;wide_screen=false}}else if(!wide_screen){if(narrow_screen){redux_screen=true;tiny_screen=true;wide_screen=false}else{redux_screen=true;tiny_screen=false;wide_screen=false}}switch(empire_mode){case EMPIRE_UNIT_TYPE_MODE:empire_unittype_screen(wide_screen,narrow_screen,small_screen,landscape_screen,tiny_screen,redux_screen);break;case EMPIRE_UNIT_HOMECITY_MODE:empire_unit_homecity_screen(wide_screen,narrow_screen,small_screen,landscape_screen,tiny_screen,redux_screen);break;case EMPIRE_UNIT_IN_CITY_MODE:empire_unitcity_screen(wide_screen,narrow_screen,small_screen,landscape_screen,tiny_screen,redux_screen);break;case EMPIRE_ECON_IMPROVEMENTS:empire_econ_improvements_screen(wide_screen,narrow_screen,small_screen,landscape_screen,tiny_screen,redux_screen);break;case EMPIRE_ECON_UPKEEP:empire_econ_upkeep_screen(wide_screen,narrow_screen,small_screen,landscape_screen,tiny_screen,redux_screen);break;case EMPIRE_ECON_WORKLISTS:empire_econ_worklists_screen(wide_screen,narrow_screen,small_screen,landscape_screen,tiny_screen,redux_screen);break}}function empire_unit_homecity_screen(wide_screen,narrow_screen,small_screen,landscape_screen,tiny_screen,redux_screen){$("#empire_title").html("Unit Home Cites and Upkeep");if(small_screen)$("#empire_title").hide();else $("#empire_title").show();var panel_html="<input id='show_hp' type='checkbox' class='css-checkbox' title='Show hit points' name='chHP' value='false' onclick='toggle_empire_show_hitpoints();'>"+"<label for='show_hp' name='show_hp_lbl' class='css-label dark-check-red'>HP</label>&ensp;"+"<input id='show_mp' type='checkbox' class='css-checkbox' title='Show movement points' name='chMP' value='false' onclick='toggle_empire_show_movepoints();'>"+"<label for='show_mp' name='show_mp_lbl' class='css-label dark-check-green'>Moves</label>";panel_html+="&nbsp;&nbsp;<button id='button_sorthp' type='button' class='button ui-button ui-corner-all ui-widget' onclick='empire_sort_hp();'"+"title='Sort units rows by Hitpoints' style='padding:5px; margin-bottom:2px;'>&#x2943HP</button>";panel_html+="<button id='button_sortmp' type='button' class='button ui-button ui-corner-all ui-widget' onclick='empire_sort_mp();'"+"title='Sort unit rows by Moves Left' style='padding:5px; margin-bottom:2px;'>&#x2943Moves</button>";panel_html+="<button id='button_sortvet' type='button' class='button ui-button ui-corner-all ui-widget' onclick='empire_sort_vet();'"+"title='Sort unit rows by Vet level' style='padding:5px; margin-bottom:2px;'>&#x2943Vet</button>";panel_html+="&nbsp;&nbsp;&nbsp;&nbsp; show upkeep: &nbsp;"+"<input type='checkbox' class='css-checkbox' id='show_food' title='Show food upkeep' name='cbFU' value='false' onclick='toggle_empire_show_upkeep(\"food\");'>"+"<label for='show_food' name='show_food_lbl' class='css-label dark-check-green'>Food</label>&ensp;"+"<input type='checkbox' class='css-checkbox' id='show_gold' title='Show gold upkeep' name='cbGU' value='false' onclick='toggle_empire_show_upkeep(\"gold\");'>"+"<label for='show_gold' name='show_gold_lbl' class='css-label dark-check-orange'>Gold</label>&ensp;"+"<input type='checkbox' class='css-checkbox' id='show_shield' title='Show shield upkeep' name='cbSU' value='false' onclick='toggle_empire_show_upkeep(\"shields\");'>"+"<label for='show_shield' name='show_shield_lbl' class='css-label dark-check-red'>Shield</label>&ensp;";panel_html+="<input type='checkbox' class='css-checkbox' id='show_free' title='Show units with no upkeep' name='cbFR' value='false' onclick='toggle_empire_show_upkeep(\"free\");'>"+"<label for='show_free' name='show_free_lbl' class='css-label dark-check-white'>Free</label>";$("#empire_mode_panel").html(panel_html);$("#show_hp").prop("checked",empire_show_hitpoints);$("#show_mp").prop("checked",empire_show_movesleft);$("#show_food").prop("checked",empire_upkeep_show_food);$("#show_gold").prop("checked",empire_upkeep_show_gold);$("#show_shield").prop("checked",empire_upkeep_show_shields);$("#show_free").prop("checked",empire_upkeep_show_free);$("#empire_scroll").css({height:$(window).height()-160,"overflow-y":"scroll","overflow-x":"hidden"});var sortList=[];var headers=$("#empire_table thead th");headers.filter(".tablesorter-headerAsc").each(function(i,cell){sortList.push([cell.cellIndex,0])});headers.filter(".tablesorter-headerDesc").each(function(i,cell){sortList.push([cell.cellIndex,1])});if(narrow_screen||tiny_screen)$("#empire_prompt").hide();else $("#empire_prompt").show();const updown_sort_arrows="<img class='lowered_gov' src='data:image/gif;base64,R0lGODlhFQAJAIAAAP///////yH5BAEAAAEALAAAAAAVAAkAAAIXjI+AywnaYnhUMoqt3gZXPmVg94yJVQAAOw=='>";var empire_list_html="";if(true){empire_list_html="<table class='tablesorter-dark' id='empire_table' style='border=0px;border-spacing=0;padding=0;'>"+"<thead id='empire_table_head'>"+"<tr>"+"<th title='Sort alphabetically' style='text-align:right; font-size:93%;'><span style='white-space:nowrap'>Home City"+updown_sort_arrows+"</span></th>"+"<th id='food_upkeep'   class='food_upkeep_column'   title='Sort FOOD UPKEEP'   style='text-align:center; width:28px'><img style='margin-top:-3px;' class='lowered_gov' src='/images/wheat.png'></th>"+"<th id='gold_upkeep'   class='gold_upkeep_column'   title='Sort GOLD UPKEEP'   style='text-align:center; width:28px'><img class='lowered_gov' src='/images/gold.png'></th>"+"<th id='shield_upkeep' class='shield_upkeep_column' title='Sort SHIELD UPKEEP' style='text-align:center; width:28px'><img class='lowered_gov' src='/images/shield14x18.png'></th>"+"<th title='Home city units' style='padding-left:10px; font-size:93%;'>&nbsp;Units</th>"+"</tr>"+"</thead><tbody>"}else if(redux_screen){}else{}empire_list_html+="<tr class='cities_row;' style='height:"+rheight+"px;'>"+"<td style='font-size:85%; color:#d0d0d0; text-align:right; padding-right:10px;'>"+"<span style='font-size:1%; color: rgba(0, 0, 0, 0);'>!</span>"+"TOTAL UPKEEP</td>"+"<td class='food_upkeep_column'   font-size:95%; style='text-align:right; padding-right:10px; color:#ced434; font-weight:520;' id='f_upkeep_total'> </td>"+"<td class='gold_upkeep_column'   font-size:95%; style='text-align:right; padding-right:10px; color:#ffd52c; font-weight:520;' id='g_upkeep_total'> </td>"+"<td class='shield_upkeep_column' font-size:95%; style='text-align:right; padding-right:10px; color:#ff4030; font-weight:520;' id='s_upkeep_total'> </td>"+"<td style='padding-left:10px;'></tr>";var adjust_oversize="";var unit_row_html="";var city_count=0;if(empire_sort_mode){}else{units_sorted_by_type=[];for(var unit_type_id in unit_types){units_sorted_by_type[unit_type_id]=[]}for(var unit_id in units){var sunit=units[unit_id];if(client.conn.playing!=null&&unit_owner(sunit).playerno==client.conn.playing.playerno){var show_unit=false;var f,g,s,l;if(sunit["upkeep"]!=null){s=parseInt(sunit["upkeep"][O_SHIELD],10);f=parseInt(sunit["upkeep"][O_FOOD],10);g=parseInt(sunit["upkeep"][O_GOLD],10);l=f+g+s;if(empire_upkeep_show_shields&&s>0)show_unit=true;else if(empire_upkeep_show_food&&f>0)show_unit=true;else if(empire_upkeep_show_gold&&g>0)show_unit=true;else if(empire_upkeep_show_free&&l==0)show_unit=true}else if(empire_upkeep_show_free)show_unit=true;if(show_unit){units_sorted_by_type[sunit["type"]].push(sunit)}}}}var ptype_img_html="";var hit_point_html="";var moves_left_html="";var vet_badge_html="";var ukf=new Array(cities.length);var ukg=new Array(cities.length);var uks=new Array(cities.length);for(var city_id in cities){var pcity=cities[city_id];ukf[city_id]=0;ukg[city_id]=0;uks[city_id]=0;if(client.conn.playing==null||city_owner(pcity)==null||city_owner(pcity).playerno!=client.conn.playing.playerno){continue}else city_count++;var rheight=28*Math.ceil(11*40/($(window).width()-140));unit_row_html="<tr class='cities_row;' style='height:"+rheight+"px;'>";unit_row_html+="<td style='cursor:pointer; font-size:85%; text-align:right; padding-right:10px;' onclick='javascript:show_city_dialog_by_id("+pcity["id"]+")' id='citycell"+city_id+"'>"+pcity["name"]+"</td>";unit_row_html+="<td class='food_upkeep_column'   style='font-size:95%; font-weight:520; text-align:right; padding-right:10px; color:#ced434;' id='f_upkeep"+city_id+"'> </td>";unit_row_html+="<td class='gold_upkeep_column'   style='font-size:95%; font-weight:520; text-align:right; padding-right:10px; color:#ffd52c;' id='g_upkeep"+city_id+"'> </td>";unit_row_html+="<td class='shield_upkeep_column' style='font-size:95%; font-weight:520; text-align:right; padding-right:10px; color:#ff4030;' id='s_upkeep"+city_id+"'> </td>";unit_row_html+="<td style='padding-left:10px;' id='u"+city_id+"'>";for(unit_type_id in units_sorted_by_type){for(var unit_index in units_sorted_by_type[unit_type_id]){var punit=units_sorted_by_type[unit_type_id][unit_index];if(punit["homecity"]!=city_id)continue;if(punit["upkeep"]!=null){ukf[city_id]+=parseInt(punit["upkeep"][O_FOOD],10);ukg[city_id]+=parseInt(punit["upkeep"][O_GOLD],10);uks[city_id]+=parseInt(punit["upkeep"][O_SHIELD],10)}var ptype=unit_type(punit);var ptype_sprite={type:ptype,sprite:get_unit_type_image_sprite(ptype)};var hptype_sprite={type:ptype,sprite:get_full_hp_sprite(punit)};var mptype_sprite={type:ptype,sprite:get_full_mp_sprite(punit)};var vtype_sprite={type:ptype,sprite:get_full_vet_sprite(punit)};if(ptype_sprite!=null){sprite=ptype_sprite["sprite"];var hp_sprite=hptype_sprite["sprite"];var mp_sprite=mptype_sprite["sprite"];var vet_sprite=vtype_sprite["sprite"];adjust_oversize=sprite["width"]>64?-34:-26;ptype_img_html="<span class='prod_img' title='"+html_safe(get_unit_city_info(punit))+"' style='float:left; padding-left:0px padding-right:0px; content-align:right; margin-top:-8px;"+"margin-left:"+adjust_oversize+"px' margin-right:-4px; onclick='city_dialog_activate_unit(units["+punit["id"]+"]);'>"+"<div style='float:left; content-align:left;"+"background: transparent url("+sprite["image-src"]+");transform: scale(0.625); background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;"+" content-align: left;"+"vertical-align:top; float:left;'>"+"</div>";hit_point_html="<div style='margin-left:-83px; margin-top:-10px; margin-right:-24px; float:left; content-align:left;"+"background: transparent url("+hp_sprite["image-src"]+");transform: scale(0.625); background-position:-"+hp_sprite["tileset-x"]+"px -"+hp_sprite["tileset-y"]+"px;  width: "+hp_sprite["width"]+"px;height: "+hp_sprite["height"]+"px;"+" content-align: left;"+"vertical-align:top; float:left;'>"+"</div>";moves_left_html="<div style='margin-left:-83px; margin-top:-6px; margin-right:-24px; float:left; content-align:left;"+"background: transparent url("+mp_sprite["image-src"]+");transform: scale(0.625); background-position:-"+mp_sprite["tileset-x"]+"px -"+mp_sprite["tileset-y"]+"px;  width: "+mp_sprite["width"]+"px;height: "+mp_sprite["height"]+"px;"+" content-align: left;"+"vertical-align:top; float:left;'>"+"</div>";if(punit["veteran"]>0){vet_badge_html="<div style='margin-left:-50px; margin-top:-16px; margin-right: -24px; float:left; content-align:left;"+"background: transparent url("+vet_sprite["image-src"]+");transform: scale(0.7); background-position:-"+vet_sprite["tileset-x"]+"px -"+vet_sprite["tileset-y"]+"px;  width: "+vet_sprite["width"]+"px;height: "+vet_sprite["height"]+"px;"+" content-align: left;"+"vertical-align:top; float:left;'>"+"</div>"}else vet_badge_html=""}if(empire_show_movesleft)ptype_img_html+=moves_left_html;if(empire_show_hitpoints)ptype_img_html+=hit_point_html;if(punit["veteran"]>0)ptype_img_html+=vet_badge_html;unit_row_html+="<span id='u_img"+unit_type_id+"'>"+ptype_img_html+"</span>"}}empire_list_html+=unit_row_html+"</td></tr>"}empire_list_html+="</tbody></table>";$("#empire_list").html(empire_list_html);var sum_ukf=0;sum_ukg=0;sum_uks=0;for(city_id in cities){if(client.conn.playing==null||city_owner(cities[city_id])==null||city_owner(cities[city_id]).playerno!=client.conn.playing.playerno){continue}sum_ukf+=ukf[city_id];sum_ukg+=ukg[city_id];sum_uks+=uks[city_id];if(ukf[city_id]>0)$("#f_upkeep"+city_id).html(ukf[city_id]);if(ukg[city_id]>0)$("#g_upkeep"+city_id).html(ukg[city_id]);if(uks[city_id]>0)$("#s_upkeep"+city_id).html(uks[city_id])}if(sum_ukf>0)$("#f_upkeep_total").html(sum_ukf);else $(".food_upkeep_column").remove();if(sum_ukg>0)$("#g_upkeep_total").html(sum_ukg);else $(".gold_upkeep_column").remove();if(sum_uks>0)$("#s_upkeep_total").html(sum_uks);else if(sum_ukf+sum_ukg>0||!empire_upkeep_show_shields)$(".shield_upkeep_column").remove();if(city_count==0){$("#empire_table").html("You have no cities.")}$("#empire_table").tablesorter({theme:"dark",sortList:sortList});if(tiny_screen){}else if(redux_screen){}else if(wide_screen){}}function empire_unitcity_screen(wide_screen,narrow_screen,small_screen,landscape_screen,tiny_screen,redux_screen){$("#empire_title").html("City Deployment");if(small_screen)$("#empire_title").hide();else $("#empire_title").show();var panel_html="<input id='show_hp' type='checkbox' class='css-checkbox' title='Show hit points' name='chHP' value='false' onclick='toggle_empire_show_hitpoints();'>"+"<label for='show_hp' name='show_hp_lbl' class='css-label dark-check-red'>HP</label>&ensp;"+"<input id='show_mp' type='checkbox' class='css-checkbox' title='Show movement points' name='chMP' value='false' onclick='toggle_empire_show_movepoints();'>"+"<label for='show_mp' name='show_mp_lbl' class='css-label dark-check-green'>Moves</label>";panel_html+="&nbsp;&nbsp;<button id='button_sorthp' type='button' class='button ui-button ui-corner-all ui-widget' onclick='empire_sort_hp();'"+"title='Sort units rows by Hitpoints' style='padding:5px; margin-bottom:2px;'>&#x2943HP</button>";panel_html+="<button id='button_sortmp' type='button' class='button ui-button ui-corner-all ui-widget' onclick='empire_sort_mp();'"+"title='Sort unit rows by Moves Left' style='padding:5px; margin-bottom:2px;'>&#x2943Moves</button>";panel_html+="<button id='button_sortvet' type='button' class='button ui-button ui-corner-all ui-widget' onclick='empire_sort_vet();'"+"title='Sort unit rows by Vet level' style='padding:5px; margin-bottom:2px;'>&#x2943Vet</button>";$("#empire_mode_panel").html(panel_html);$("#show_hp").prop("checked",empire_show_hitpoints);$("#show_mp").prop("checked",empire_show_movesleft);$("#empire_scroll").css({height:$(window).height()-160,"overflow-y":"scroll","overflow-x":"hidden"});var sortList=[];var headers=$("#empire_table thead th");headers.filter(".tablesorter-headerAsc").each(function(i,cell){sortList.push([cell.cellIndex,0])});headers.filter(".tablesorter-headerDesc").each(function(i,cell){sortList.push([cell.cellIndex,1])});if(narrow_screen||tiny_screen)$("#empire_prompt").hide();else $("#empire_prompt").show();const updown_sort_arrows="<img class='lowered_gov' src='data:image/gif;base64,R0lGODlhFQAJAIAAAP///////yH5BAEAAAEALAAAAAAVAAkAAAIXjI+AywnaYnhUMoqt3gZXPmVg94yJVQAAOw=='>";var empire_list_html="";if(true){empire_list_html="<table class='tablesorter-dark' id='empire_table' style='border=0px;border-spacing=0;padding=0;'>"+"<thead id='empire_table_head'>"+"<tr>"+"<th style='text-align:right;' title='Defense Strength in Warrior Equivalent Units (WEU).\n"+"\nIncludes: Veteran, Terrain, Inside-city.\n"+"\nLacks where the Attacker must be known:\n"+"City Improvements, BadCityDefender, Versus Type.'><span style='text-align:right; color:#c8c8c8; font-size:85%; width:80px'>WEU</span></th>"+"<th title='Sort alphabetically' style='text-align:right; font-size:93%;'><span style='white-space:nowrap'>City"+updown_sort_arrows+"</span></th>"+"<th title='Units present in city' style='padding-left:10px; font-size:93%;'>&nbsp;Present Units</th>"+"</tr>"+"</thead><tbody>"}else if(redux_screen){}else{}var adjust_oversize="";var unit_row_html="";var city_count=0;if(empire_sort_mode){}else{units_sorted_by_type=[];for(var unit_type_id in unit_types){units_sorted_by_type[unit_type_id]=[]}for(var unit_id in units){var sunit=units[unit_id];if(client.conn.playing!=null&&unit_owner(sunit).playerno==client.conn.playing.playerno){units_sorted_by_type[sunit["type"]].push(sunit)}}}var ptype_img_html="";var hit_point_html="";var moves_left_html="";var vet_badge_html="";var sumHPD=new Array(cities.length);for(var city_id in cities){var pcity=cities[city_id];if(client.conn.playing==null||city_owner(pcity)==null||city_owner(pcity).playerno!=client.conn.playing.playerno){continue}else city_count++;sumHPD[city_id]=0;var rheight=28*Math.ceil(11*40/($(window).width()-140));unit_row_html="<tr class='cities_row;' style='height:"+rheight+"px;'>";unit_row_html+="<td style='cursor:default; font-size:95%; font-weight:520; text-align:right; padding-right:10px; color:#a8a8a8;' id='sumHPD"+city_id+"'> </td>";unit_row_html+="<td style='cursor:pointer; font-size:85%; text-align:right; padding-right:10px;' onclick='javascript:show_city_dialog_by_id("+pcity["id"]+")' id='citycell"+city_id+"'>"+pcity["name"]+"</td>";unit_row_html+="<td style='padding-left:10px;' id='u"+city_id+"'>";for(unit_type_id in units_sorted_by_type){for(var unit_index in units_sorted_by_type[unit_type_id]){var punit=units_sorted_by_type[unit_type_id][unit_index];if(!punit["tile"]||punit["tile"]!=pcity["tile"])continue;var ptype=unit_type(punit);var power_fact=warcalc_get_defense_bonus(punit);if(unit_has_class_flag(punit,UCF_TERRAIN_DEFENSE)){power_fact*=1.5}sumHPD[city_id]+=power_fact/100*(parseInt(punit["hp"],10)*parseInt(ptype["defense_strength"],10)*parseInt(ptype["firepower"],10));var ptype_sprite={type:ptype,sprite:get_unit_type_image_sprite(ptype)};var hptype_sprite={type:ptype,sprite:get_full_hp_sprite(punit)};var mptype_sprite={type:ptype,sprite:get_full_mp_sprite(punit)};var vtype_sprite={type:ptype,sprite:get_full_vet_sprite(punit)};if(ptype_sprite!=null){sprite=ptype_sprite["sprite"];var hp_sprite=hptype_sprite["sprite"];var mp_sprite=mptype_sprite["sprite"];var vet_sprite=vtype_sprite["sprite"];adjust_oversize=sprite["width"]>64?-34:-26;ptype_img_html="<span class='prod_img' title='"+html_safe(get_unit_city_info(punit))+"' style='float:left; padding-left:0px padding-right:0px; content-align:right; margin-top:-8px;"+"margin-left:"+adjust_oversize+"px' margin-right:-4px; onclick='city_dialog_activate_unit(units["+punit["id"]+"]);'>"+"<div style='float:left; content-align:left;"+"background: transparent url("+sprite["image-src"]+");transform: scale(0.625); background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;"+" content-align: left;"+"vertical-align:top; float:left;'>"+"</div>";hit_point_html="<div style='margin-left:-83px; margin-top:-10px; margin-right:-24px; float:left; content-align:left;"+"background: transparent url("+hp_sprite["image-src"]+");transform: scale(0.625); background-position:-"+hp_sprite["tileset-x"]+"px -"+hp_sprite["tileset-y"]+"px;  width: "+hp_sprite["width"]+"px;height: "+hp_sprite["height"]+"px;"+" content-align: left;"+"vertical-align:top; float:left;'>"+"</div>";moves_left_html="<div style='margin-left:-83px; margin-top:-6px; margin-right:-24px; float:left; content-align:left;"+"background: transparent url("+mp_sprite["image-src"]+");transform: scale(0.625); background-position:-"+mp_sprite["tileset-x"]+"px -"+mp_sprite["tileset-y"]+"px;  width: "+mp_sprite["width"]+"px;height: "+mp_sprite["height"]+"px;"+" content-align: left;"+"vertical-align:top; float:left;'>"+"</div>";if(punit["veteran"]>0){vet_badge_html="<div style='margin-left:-50px; margin-top:-16px; margin-right: -24px; float:left; content-align:left;"+"background: transparent url("+vet_sprite["image-src"]+");transform: scale(0.7); background-position:-"+vet_sprite["tileset-x"]+"px -"+vet_sprite["tileset-y"]+"px;  width: "+vet_sprite["width"]+"px;height: "+vet_sprite["height"]+"px;"+" content-align: left;"+"vertical-align:top; float:left;'>"+"</div>"}else vet_badge_html=""}if(empire_show_movesleft)ptype_img_html+=moves_left_html;if(empire_show_hitpoints)ptype_img_html+=hit_point_html;if(punit["veteran"]>0)ptype_img_html+=vet_badge_html;unit_row_html+="<span id='u_img"+unit_type_id+"'>"+ptype_img_html+"</span>"}}empire_list_html+=unit_row_html+"</td></tr>"}empire_list_html+="</tbody></table>";$("#empire_list").html(empire_list_html);for(city_id in cities){if(client.conn.playing==null||city_owner(cities[city_id])==null||city_owner(cities[city_id]).playerno!=client.conn.playing.playerno){continue}if(sumHPD[city_id]>0){var weu=parseFloat((sumHPD[city_id]/10).toFixed(1));$("#sumHPD"+city_id).html(weu);$("#sumHPD"+city_id).prop("title",weu+" Warrior Equivalent Units")}else{$("#sumHPD"+city_id).html("<span style='color:#ff4030'>0</span>")}}if(city_count==0){$("#empire_table").html("You have no cities.")}$("#empire_table").tablesorter({theme:"dark",sortList:sortList});if(tiny_screen){}else if(redux_screen){}else if(wide_screen){}}function emp_bldgs_mag_plus1(mag){empire_bldg_tab_saved_mag=mag*(100/99);update_empire_screen();simpleStorage.set("bldgZoom",empire_bldg_tab_saved_mag)}function emp_bldgs_mag_less1(mag){empire_bldg_tab_saved_mag=mag*(99/100);update_empire_screen();simpleStorage.set("bldgZoom",empire_bldg_tab_saved_mag)}function emp_upkp_mag_plus2(mag){empire_upkp_tab_saved_mag=mag*(101/99);update_empire_screen();simpleStorage.set("upkpZoom",empire_upkp_tab_saved_mag)}function emp_upkp_mag_less2(mag){empire_upkp_tab_saved_mag=mag*(99/101);update_empire_screen();simpleStorage.set("upkpZoom",empire_upkp_tab_saved_mag)}function emp_wklst_mag_plus2(mag){empire_wklst_tab_saved_mag=mag*(101/99);update_empire_screen();simpleStorage.set("wklZoom",empire_wklst_tab_saved_mag)}function emp_wklst_mag_less2(mag){empire_wklst_tab_saved_mag=mag*(99/101);update_empire_screen();simpleStorage.set("wklZoom",empire_wklst_tab_saved_mag)}function reset_mag(){empire_bldg_tab_saved_mag=0;simpleStorage.set("bldgZoom",0);empire_upkp_tab_saved_mag=0;simpleStorage.set("upkpZoom",0);empire_wklst_tab_saved_mag=0;simpleStorage.set("wklZoom",0)}function empire_econ_improvements_screen(wide_screen,narrow_screen,small_screen,landscape_screen,tiny_screen,redux_screen){$("#empire_title").html("National Buildings");if(small_screen)$("#empire_title").hide();else $("#empire_title").show();var real_width=$(window).width()-230;var mag_factor=real_width/38/67;if(empire_bldg_tab_saved_mag>0){mag_factor=empire_bldg_tab_saved_mag}else{for(var n=1;n<100;n++){if(mag_factor<.4)mag_factor=mag_factor*((n+1)/n);else break}if(mag_factor<.4)mag_factor=.45}var magnification="zoom:"+mag_factor+"; -moz-transform:"+mag_factor+";";var abs_chxbox="Absent Buildings";var pres_chxbox="Present Buildings";var wndr_chxbox="Wonders only &nbsp;";if(small_screen){abs_chxbox="Absent";pres_chxbox="Present";wndr_chxbox="Wonders "}var panel_html="<input id='show_pb' type='checkbox' class='css-checkbox' title='Show present buildings' name='cbPB' value='true' onclick='toggle_empire_show_present_buildings();'>"+"<label for='show_pb' name='show_pb_lbl' class='css-label dark-check-green'>"+pres_chxbox+"</label>&ensp;"+"<input id='show_ab' type='checkbox' class='css-checkbox' title='Show absent buildings' name='cbAB' value='false' onclick='toggle_empire_show_absent_buildings();'>"+"<label for='show_ab' name='show_ab_lbl' class='css-label dark-check-red'>"+abs_chxbox+"</label>&ensp;"+"<input id='show_wonders' type='checkbox' class='css-checkbox' title='Show wonders instead of buildings' name='cbSW' value='false' onclick='toggle_empire_show_wonders_only();'>"+"<label for='show_wonders' name='show_wonders_lbl' class='css-label dark-check-cyan'>"+wndr_chxbox+"</label>&ensp;"+"<input class='tiny_button' type='button' style='font-size:90%; padding:2px;' value='+1%' onclick='emp_bldgs_mag_plus1("+mag_factor+");'> "+"<input class='tiny_button' type='button' style='font-size:90%; padding:2px;' value='-1%' onclick='emp_bldgs_mag_less1("+mag_factor+");'>Zoom ";$("#empire_mode_panel").html(panel_html);$("#show_pb").prop("checked",empire_show_present_buildings);$("#show_ab").prop("checked",empire_show_absent_buildings);$("#show_wonders").prop("checked",empire_show_wonders_only);$("#empire_scroll").css({height:$(window).height()-160,"overflow-y":"scroll","overflow-x":"hidden"});var sortList=[];var headers=$("#empire_table thead th");headers.filter(".tablesorter-headerAsc").each(function(i,cell){sortList.push([cell.cellIndex,0])});headers.filter(".tablesorter-headerDesc").each(function(i,cell){sortList.push([cell.cellIndex,1])});if(narrow_screen||tiny_screen)$("#empire_prompt").hide();else $("#empire_prompt").show();const updown_sort_arrows="<img class='lowered_gov' src='data:image/gif;base64,R0lGODlhFQAJAIAAAP///////yH5BAEAAAEALAAAAAAVAAkAAAIXjI+AywnaYnhUMoqt3gZXPmVg94yJVQAAOw=='>";var empire_list_html="";if(true){empire_list_html="<table class='tablesorter-dark' id='empire_table' style='border=0px;border-spacing=0;padding=0;'>"+"<thead id='empire_table_head'>"+"<tr>"+"<th title='Sort alphabetically' style='text-align:right; font-size:93%;'><span style='white-space:nowrap'>City"+updown_sort_arrows+"</span></th>"+"<th style='padding-left:10px; font-size:93%;'>&nbsp;Buildings</th>"+"</tr>"+"</thead><tbody>"}var alt_click_method="oncontextmenu";if(small_screen)alt_click_method="ondblclick";var improvements_html="";var city_count=0;for(var city_id in cities){var pcity=cities[city_id];if(client.conn.playing==null||city_owner(pcity)==null||city_owner(pcity).playerno!=client.conn.playing.playerno){continue}else city_count++;var rheight=28*Math.ceil(22*40/($(window).width()-140));improvements_html="<tr class='cities_row;' style='border-bottom: 3px solid #000; height:"+rheight+"px;'>";improvements_html+="<td style='cursor:pointer; font-size:85%; text-align:right; padding-right:10px;' onclick='javascript:show_city_dialog_by_id("+pcity["id"]+")' id='citycell"+city_id+"'>"+pcity["name"]+"</td>";improvements_html+="<td style='padding-left:10px;' id='u"+city_id+"'>";for(var z=0;z<ruleset_control.num_impr_types-1;z++){var genus=improvements[z]["genus"];var is_wonder=genus<=GENUS_SMALL_WONDER?true:false;if(is_wonder!=empire_show_wonders_only)continue;var present=city_has_building(pcity,z);var show_building=false;if(present&&empire_show_present_buildings)show_building=true;if(!present&&empire_show_absent_buildings)show_building=true;var sprite=get_improvement_image_sprite(improvements[z]);var opacity=1;var border="";var bg="background:#335 ";var title_text="";var right_click_action=alt_click_method+"='city_sell_improvement_in("+city_id+","+z+");' ";var product_finished=false;var verb=" is making ";var is_city_making=pcity["production_kind"]==VUT_IMPROVEMENT&&pcity["production_value"]==z;if(is_city_making){var shields_invested=pcity["shield_stock"];if(shields_invested>=improvements[z]["build_cost"]){product_finished=true;var verb=" is finishing "}}if(pcity["improvements"].isSet(z)){opacity=1;border="border:3px solid #000000;";bg="background:#FEED ";title_text="title='"+html_safe(pcity["name"])+":\n\nRIGHT-CLICK: Sell "+html_safe(improvements[z]["name"])+".'";right_click_action=alt_click_method+"='city_sell_improvement_in("+city_id+","+z+");' "}else{if(!can_city_build_improvement_now(pcity,z)){opacity=.19;border="border:3px solid #231a13;";bg="background:#F43F ";title_text="title='"+pcity["name"]+": "+improvements[z]["name"]+" unavailable.\n\nRIGHT-CLICK: Add to worklist.'";right_click_action=alt_click_method+"='city_add_improv_to_worklist("+city_id+","+z+");' "}else{opacity=1;border=is_city_making?product_finished?"border:3px solid #308000;":"border:3px solid #80E0FF;":"border:3px solid #000000;";bg=is_city_making?product_finished?"background:#BFBE ":"background:#8D87 ":"background:#AD68 ";right_click_action=alt_click_method+"='city_change_prod_and_buy(null,"+city_id+","+z+");' ";title_text=is_city_making?"title='"+html_safe(pcity["name"])+verb+improvements[z]["name"]+".\n\nRIGHT_CLICK: Buy "+html_safe(improvements[z]["name"])+"'":"title='"+html_safe(pcity["name"])+":\n\nCLICK: Change production\n\nRIGHT-CLICK: Buy "+html_safe(improvements[z]["name"])+"'"}}if(!show_building)opacity=.21;if(is_city_making)opacity=1;improvements_html=improvements_html+"<div style='padding:0px; opacity:"+opacity+"; "+magnification+"' id='city_improvement_element'><span style='padding:0px; margin:0px; "+border+" "+bg+" url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float:left;' "+title_text+right_click_action+"onclick='change_city_prod_to(event,"+city_id+","+z+");'>"+"</span></div>"}empire_list_html+=improvements_html+"</td></tr>"}empire_list_html+="</tbody></table>";$("#empire_list").html(empire_list_html);if(city_count==0){$("#empire_table").html("You have no cities.")}$("#empire_table").tablesorter({theme:"dark",sortList:sortList});if(tiny_screen){}else if(redux_screen){}else if(wide_screen){}}function get_player_building_upkeep_bonus(player_id){var bonus=0;const gov=governments[players[player_id]["government"]]["name"];if(player_has_wonder(player_id,improvement_id_by_name(B_ADAM_SMITH_NAME))){bonus+=1}if(client_rules_flag[CRF_COMMIE_BLDG_UPKEEP]){if(gov=="Communism"){bonus+=1}}return bonus}function empire_econ_upkeep_screen(wide_screen,narrow_screen,small_screen,landscape_screen,tiny_screen,redux_screen){$("#empire_title").html("Building Upkeep");if(small_screen)$("#empire_title").hide();else $("#empire_title").show();upkeep_gold_bonus=get_player_building_upkeep_bonus(client.conn.playing.playerno);estimated_max_bldgs=5+28*(game_info["turn"]/130);if(estimated_max_bldgs>38)estimated_max_bldgs=38;var real_width=$(window).width()-250;var mag_factor=real_width/estimated_max_bldgs/67;if(empire_upkp_tab_saved_mag>0){mag_factor=empire_upkp_tab_saved_mag}else{for(var n=1;n<100;n++){if(mag_factor<.4)mag_factor=mag_factor*((n+1)/n);else break}if(mag_factor<.4)mag_factor=.45;if(mag_factor>1)mag_factor=1}var magnification="zoom:"+mag_factor+"; -moz-transform:"+mag_factor+";";var panel_html="<input class='tiny_button' type='button' style='font-size:90%; padding:2px;' value='+2%' onclick='emp_upkp_mag_plus2("+mag_factor+");'> "+"<input class='tiny_button' type='button' style='font-size:90%; padding:2px;' value='-2%' onclick='emp_upkp_mag_less2("+mag_factor+");'>Zoom ";$("#empire_mode_panel").html(panel_html);$("#empire_scroll").css({height:$(window).height()-160,"overflow-y":"scroll","overflow-x":"hidden"});var sortList=[];var headers=$("#empire_table thead th");headers.filter(".tablesorter-headerAsc").each(function(i,cell){sortList.push([cell.cellIndex,0])});headers.filter(".tablesorter-headerDesc").each(function(i,cell){sortList.push([cell.cellIndex,1])});if(narrow_screen||tiny_screen)$("#empire_prompt").hide();else $("#empire_prompt").show();const updown_sort_arrows="<img class='lowered_gov' src='data:image/gif;base64,R0lGODlhFQAJAIAAAP///////yH5BAEAAAEALAAAAAAVAAkAAAIXjI+AywnaYnhUMoqt3gZXPmVg94yJVQAAOw=='>";var empire_list_html="";if(true){empire_list_html="<table class='tablesorter-dark' id='empire_table' style='border=0px;border-spacing=0;padding=0;'>"+"<thead id='empire_table_head'>"+"<tr>"+"<th title='Sort alphabetically' style='text-align:right; font-size:93%;'><span style='white-space:nowrap'>City"+updown_sort_arrows+"</span></th>"+"<th id='gold_upkeep' class='gold_upkeep_column' title='Sort GOLD UPKEEP' style='text-align:center; width:28px'><img class='lowered_gov' src='/images/gold.png'></th>"+"<th style='padding-left:10px; font-size:93%;'>&nbsp;Buildings</th>"+"</tr>"+"</thead><tbody>"}empire_list_html+="<tr class='cities_row;' style='height:"+rheight+"px;'>"+"<td style='font-size:85%; color:#d0d0d0; text-align:right; padding-right:10px;'>"+"<span style='font-size:1%; color: rgba(0, 0, 0, 0);'>!</span>"+"TOTAL UPKEEP</td>"+"<td class='gold_upkeep_column'   font-size:95%; style='text-align:right; padding-right:10px; color:#ffd52c; font-weight:520;' id='g_upkeep_total'> </td>"+"<td style='padding-left:10px;'></td></tr>";var alt_click_method="oncontextmenu";if(small_screen)alt_click_method="ondblclick";var improvements_html="";var city_count=0;let city_upkeep=new Array(cities.length);for(var city_id in cities){var pcity=cities[city_id];city_upkeep[city_id]=0;if(client.conn.playing==null||city_owner(pcity)==null||city_owner(pcity).playerno!=client.conn.playing.playerno){continue}else city_count++;var rheight=28*Math.ceil(22*40/($(window).width()-140));improvements_html="<tr class='cities_row;' style='border-bottom: 3px solid #000; height:"+rheight+"px;'>";improvements_html+="<td style='cursor:pointer; font-size:85%; text-align:right; padding-right:10px;' onclick='javascript:show_city_dialog_by_id("+pcity["id"]+")' id='citycell"+city_id+"'>"+pcity["name"]+"</td>";improvements_html+="<td class='gold_upkeep_column' font-size:85%; style='text-align:right; padding-right:10px; color:#ffd52c; font-weight:520;' id='g_upkeep_total"+city_id+"'> </td>";improvements_html+="<td style='padding-left:10px;' id='u"+city_id+"'>";for(var z=0;z<ruleset_control.num_impr_types-1;z++){var present=city_has_building(pcity,z);var show_building=present;if(!show_building)continue;var upkeep=improvements[z]["upkeep"];if(upkeep>=0&&upkeep<=upkeep_gold_bonus)upkeep=0;city_upkeep[city_id]+=upkeep;if(upkeep==0)upkeep="";var sprite=get_improvement_image_sprite(improvements[z]);var opacity=1;const border="border:1px solid #000000;";var bg=upkeep>0?"background:#FEED ":"background:#FEED ";var upkp_color=upkeep<0?"#77EF77":"#FFD52C";var title_text="title='"+html_safe(pcity["name"])+":\n\nRIGHT-CLICK: Sell "+html_safe(improvements[z]["name"])+".'";var right_click_action=alt_click_method+"='city_sell_improvement_in("+city_id+","+z+");' ";improvements_html=improvements_html+"<div style='padding:0px; opacity:"+opacity+"; "+magnification+"' id='city_improvement_element'><span style='padding:0px; margin:0px; "+border+" "+bg+" url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float:left;' "+title_text+right_click_action+"onclick='change_city_prod_to(event,"+city_id+","+z+");'>"+"</span><span style='font-size:90%; color:"+upkp_color+"'>"+upkeep+"</span></div>"}empire_list_html+=improvements_html+"</td></tr>"}empire_list_html+="</tbody></table>";$("#empire_list").html(empire_list_html);var total_upkeep=0;for(city_id in cities){if(client.conn.playing==null||city_owner(cities[city_id])==null||city_owner(cities[city_id]).playerno!=client.conn.playing.playerno){continue}if(city_upkeep[city_id]>0){total_upkeep+=city_upkeep[city_id];$("#g_upkeep_total"+city_id).html(city_upkeep[city_id]);$("#g_upkeep_total"+city_id).prop("title",city_upkeep[city_id]+" gold upkeep for buildings in "+cities[city_id]["name"])}}$("#g_upkeep_total").html(total_upkeep);$("#g_upkeep_total").prop("title"," Total national upkeep");if(city_count==0){$("#empire_table").html("You have no cities.")}$("#empire_table").tablesorter({theme:"dark",sortList:sortList});if(tiny_screen){}else if(redux_screen){}else if(wide_screen){}}function redraw_improv_clipboard(){var clipboard_html="";var bg="background:#FEED ";const border="border:2px solid #FFFFFF;";var mag_factor=($(window).width()-70)/(67*39);if(mag_factor>1)mag_factor=1;else if(mag_factor<.3597){mag_factor*=2;if(mag_factor<.3597)mag_factor=.3597}var magnification="zoom:"+mag_factor+"; -moz-transform:"+mag_factor+";";const title_text="title='CLICK: Remove from clipboard' ";for(var z=0;z<empire_worklist_clipboard.length;z++){if(empire_worklist_clipboard[z]["kind"]==VUT_IMPROVEMENT){sprite=get_improvement_image_sprite(improvements[empire_worklist_clipboard[z]["value"]]);bg="background:#EFFD "}else{sprite=get_unit_type_image_sprite(unit_types[empire_worklist_clipboard[z]["value"]]);bg="background:#EFFD "}if(sprite==null)continue;var marginleft=z==0?10:-1;var opacity=1;const click_action="onclick='cut_improv_clipboard(event, "+z+");' ";clipboard_html=clipboard_html+"<div style='cursor:pointer; padding:0px; opacity:"+opacity+"; "+magnification+"'><span style='padding:0px; margin:0px; margin-left:"+marginleft+"px; "+border+" "+bg+" url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float:left;' "+title_text+click_action+"</span></div>"}const plural=empire_worklist_clipboard.length>1?"s":"";if(empire_worklist_clipboard.length>0)clipboard_html+=empire_worklist_clipboard.length+"&nbsp;item"+plural;$("#empire_worklist_clipboard").html(clipboard_html)}function cut_improv_clipboard(event,z){empire_worklist_clipboard.splice(z,1);redraw_improv_clipboard()}function handle_improv_clipboard(event,kind,z){if(event.ctrlKey){}else if(event.shiftKey){empire_worklist_clipboard.push({kind:kind,value:z})}else{empire_worklist_clipboard=[{kind:kind,value:z}]}redraw_improv_clipboard()}function empire_econ_worklists_screen(wide_screen,narrow_screen,small_screen,landscape_screen,tiny_screen,redux_screen){$("#empire_title").html("National Production");$("#empire_title").hide();var real_width=$(window).width()-270;var mag_factor=real_width/8/67;if(empire_wklst_tab_saved_mag>0){mag_factor=empire_wklst_tab_saved_mag}else{for(var n=1;n<100;n++){if(mag_factor<.4)mag_factor=mag_factor*((n+1)/n);else break}if(mag_factor<.4)mag_factor=.45;if(mag_factor>1)mag_factor=1}if(small_screen)mag_factor=.8;var magnification="zoom:"+mag_factor+"; -moz-transform:"+mag_factor+";";if(true)var panel_html=create_worklist_improv_div()+(small_screen?"":create_worklist_wonder_div())+create_worklist_unit_div()+"<div><span>"+"</span>"+"<span style='margin-top:3px' id='empire_worklist_clipboard'></span></div>";$("#empire_mode_panel").html(panel_html);redraw_improv_clipboard();$("#empire_scroll").css({height:$(window).height()-160,"overflow-y":"scroll","overflow-x":"hidden"});var sortList=[];var headers=$("#empire_table thead th");headers.filter(".tablesorter-headerAsc").each(function(i,cell){sortList.push([cell.cellIndex,0])});headers.filter(".tablesorter-headerDesc").each(function(i,cell){sortList.push([cell.cellIndex,1])});if(narrow_screen||tiny_screen)$("#empire_prompt").hide();else $("#empire_prompt").show();const updown_sort_arrows="<img class='lowered_gov' src='data:image/gif;base64,R0lGODlhFQAJAIAAAP///////yH5BAEAAAEALAAAAAAVAAkAAAIXjI+AywnaYnhUMoqt3gZXPmVg94yJVQAAOw=='>";var empire_list_html="";if(true){empire_list_html="<table class='tablesorter-dark' id='empire_table' style='border=0px;border-spacing=0;padding=0;'>"+"<thead id='empire_table_head'>"+"<tr>"+"<th title='Sort alphabetically' style='text-align:right; font-size:93%; width:10px;'><span style='white-space:nowrap'>City"+updown_sort_arrows+"</span></th>"+"<th style='padding-left:10px; font-size:93%;'>&nbsp;Worklist</th>"+"</tr>"+"</thead><tbody>"}var alt_click_method="oncontextmenu";if(small_screen)alt_click_method="ondblclick";var queue_html="";var city_count=0;for(var city_id in cities){var pcity=cities[city_id];if(client.conn.playing==null||city_owner(pcity)==null||city_owner(pcity).playerno!=client.conn.playing.playerno){continue}else city_count++;var rheight=10;var empty_row_click=is_small_screen()?" onclick='tap_empty_production_row(event, "+city_id+")'":" title='CLICK: paste worklist\nCTRL-CLICK: clear worklist\nSHIFT-CLICK: copy worklist' onclick='tap_empty_production_row(event, "+city_id+")'";queue_html="<tr class='cities_row;' style='border-bottom: 3px solid #000; height:"+rheight+"px;'>";queue_html+="<td style='cursor:pointer; font-size:85%; text-align:right; padding-right:10px;' onclick='javascript:show_city_dialog_by_id("+pcity["id"]+")' id='citycell"+city_id+"'>"+pcity["name"]+"</td>";queue_html+="<td style='padding-left:10px;' id='WL"+city_id+"'"+empty_row_click+">";for(var z=-1;z<pcity["worklist"].length;z++){var prod_kind,prod_value;if(z==-1){prod_kind=pcity["production_kind"];prod_value=pcity["production_value"]}else{prod_kind=pcity["worklist"][z]["kind"];prod_value=pcity["worklist"][z]["value"]}var sprite,req_state;if(prod_kind==VUT_IMPROVEMENT){sprite=get_improvement_image_sprite(improvements[prod_value]);if(improvements[prod_value]["reqs_count"]==0){req_state=TECH_KNOWN}else{req_state=player_invention_state(client.conn.playing,improvements[prod_value]["reqs"][0]["value"])}}else if(prod_kind==VUT_UTYPE){sprite=get_unit_type_image_sprite(unit_types[prod_value]);req_state=player_invention_state(client.conn.playing,unit_types[prod_value]["tech_requirement"])}var border="border:2px solid #000000;";var bg=req_state==TECH_KNOWN?"background:#FEED ":"background:#A769 ";var title_text="title='";var right_click_action="";if(z==-1){var finish_turns=get_city_production_time(pcity);var shields_invested=pcity["shield_stock"];var shields_needed=-1;if(pcity["production_kind"]==VUT_UTYPE){const punit_type=unit_types[pcity["production_value"]];shields_needed=universal_build_shield_cost(pcity,punit_type)}if(pcity["production_kind"]==VUT_IMPROVEMENT){var improvement=improvements[pcity["production_value"]];if(improvement["name"]!="Coinage"){shields_needed=universal_build_shield_cost(pcity,improvement)}}title_text+=finish_turns+" turns &nbsp;&nbsp;("+get_production_progress(pcity)+")\n\n";if(shields_needed!=-1){if(shields_invested>=shields_needed){bg="background:#BFBE ";border="border:2x solid 308000;"}else{title_text+="RIGHT-CLICK: Buy\n";right_click_action="oncontextmenu='request_city_id_buy("+pcity["id"]+")'";if(finish_turns==1){bg="background:#DFDD ";border="border:2x solid 002000;"}}}}title_text+="CLICK: Remove\nCTRL-CLICK: Insert before\nSHIFT-CLICK: Add after'";if(is_small_screen())title_text="";queue_html=queue_html+"<div style='padding:0px; "+magnification+"' id='worklist_element'><span style='padding:0px; margin:0px; "+border+" "+bg+" url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float:left;' "+title_text+right_click_action+"onclick='handle_worklist_action(event,"+city_id+","+z+");' "+"</span></div>"}empire_list_html+=queue_html+"</td></tr>"}empire_list_html+="</tbody></table>";$("#empire_list").html(empire_list_html);if(city_count==0){$("#empire_table").html("You have no cities.")}$("#empire_table").tablesorter({theme:"dark",sortList:sortList});if(tiny_screen){}else if(redux_screen){}else if(wide_screen){}}function handle_worklist_action(event,city_id,z){event.stopPropagation();active_city=cities[city_id];production_selection=empire_worklist_clipboard.slice();if(event.ctrlKey){if(z!=-1){worklist_selection=[z];city_insert_in_worklist()}else{console.log(production_selection);const cur_prod={kind:active_city["production_kind"],value:active_city["production_value"]};production_selection.push(cur_prod);console.log(production_selection);worklist_selection=[0];city_insert_in_worklist();worklist_selection=[0];city_remove_current_prod()}}else if(event.shiftKey){worklist_selection=[z+1];city_insert_in_worklist()}else{if(z==-1){worklist_selection=[0];city_remove_current_prod()}else{worklist_selection=[z];city_worklist_task_remove()}}active_city=null;return}function tap_empty_production_row(event,city_id){event.stopPropagation();active_city=cities[city_id];if(event.shiftKey){empire_worklist_clipboard=Array.from(active_city["worklist"]);redraw_improv_clipboard()}else if(event.ctrlKey){active_city["worklist"]=[];send_city_worklist(active_city["id"])}else{production_selection=empire_worklist_clipboard.slice();var z=active_city["worklist"].length-1;worklist_selection=[z+1];city_insert_in_worklist()}active_city=null}function create_worklist_improv_div(){var improvements_html="";var bg="";const border="border:2px solid #000000;";var mag_factor=($(window).width()-70)/(67*39);if(mag_factor>1)mag_factor=1;else if(mag_factor<.3597){mag_factor*=2;if(mag_factor<.3597)mag_factor=.3597}var magnification="zoom:"+mag_factor+"; -moz-transform:"+mag_factor+";";const constant_title="CLICK: Copy to clipboard\n\nSHIFT-CLICK: Add to clipboard' ";for(var z=0;z<ruleset_control.num_impr_types;z++){if(improvements[z].genus<=GENUS_SMALL_WONDER)continue;sprite=get_improvement_image_sprite(improvements[z]);if(sprite==null)continue;if(improvements[z]["obs_count"]>0){if(player_invention_state(client.conn.playing,improvements[z]["obs_reqs"][0]["value"])==TECH_KNOWN){continue}}if(improvements[z]["reqs"].length>0){var req_state=player_invention_state(client.conn.playing,improvements[z]["reqs"][0]["value"]);if(req_state!=TECH_KNOWN){if(req_state!=TECH_PREREQS_KNOWN)continue}}if(improvements[z]["reqs"].length>0){if(player_invention_state(client.conn.playing,improvements[z]["reqs"][0]["value"])!=TECH_KNOWN){bg="background:#5003 "}else bg="background:#EFF4 "}else bg="background:#EFF4 ";var title_text="title='"+html_safe(improvements[z]["name"])+"\n\n"+constant_title;var opacity=1;const click_action="onclick='handle_improv_clipboard(event, "+VUT_IMPROVEMENT+","+z+");' ";improvements_html=improvements_html+"<div style='cursor:pointer; padding:0px; opacity:"+opacity+"; "+magnification+"'><span style='padding:0px; margin:0px; margin-left:-1px; "+border+" "+bg+" url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float:left;' "+title_text+click_action+"</span></div>"}return improvements_html}function create_worklist_wonder_div(){var improvements_html="";var bg="background:#0000 ";const border="border:2px solid #000000;";var mag_factor=($(window).width()-70)/(67*39);if(mag_factor>1)mag_factor=1;else if(mag_factor<.3597){mag_factor*=2;if(mag_factor<.3597)mag_factor=.3597}var magnification="zoom:"+mag_factor+"; -moz-transform:"+mag_factor+";";const constant_title="CLICK: Copy to clipboard\n\nSHIFT-CLICK: Add to clipboard' ";var owned_wonders=new Array(ruleset_control.num_impr_types).fill(0);for(var w=0;w<ruleset_control.num_impr_types;w++){owned_wonders[w]=player_has_wonder(client.conn.playing.playerno,w)}for(var z=0;z<ruleset_control.num_impr_types;z++){if(improvements[z].genus>GENUS_SMALL_WONDER)continue;sprite=get_improvement_image_sprite(improvements[z]);if(sprite==null)continue;if(owned_wonders[z]){continue}if(improvements[z]["obs_count"]>0){if(player_invention_state(client.conn.playing,improvements[z]["obs_reqs"][0]["value"])==TECH_KNOWN){continue}}if(improvements[z]["reqs"].length>0){if(player_invention_state(client.conn.playing,improvements[z]["reqs"][0]["value"])==TECH_UNKNOWN){continue}}if(improvements[z].genus==GENUS_GREAT_WONDER&&world_has_wonder(improvements[z]["name"])){continue}if(client_rules_flag[CRF_MP2_C]){if(improvements[z]["name"]=="Women's Suffrage"&&!world_has_wonder("Women's Suffrage​")){continue}}var title_text="title='"+html_safe(improvements[z]["name"])+"\n\n"+constant_title;const click_action="onclick='handle_improv_clipboard(event, "+VUT_IMPROVEMENT+","+z+");' ";improvements_html=improvements_html+"<div style='cursor:pointer; opacity: 1.0; padding:0px; "+magnification+"'><span style='padding:0px; margin:0px; margin-left:-1px; "+border+" "+bg+" url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float:left;' "+title_text+click_action+"</span></div>"}return improvements_html}function create_worklist_unit_div(){const cur_gov=governments[client.conn.playing["government"]];const gov_id=players[client.conn.playing.playerno].government;var units_html="";var bg="";const border="border:2px solid #000000;";var mag_factor=($(window).width()-70)/(67*39);if(mag_factor>1)mag_factor=1;else if(mag_factor<.3597){mag_factor*=2;if(mag_factor<.3597)mag_factor=.3597}var magnification="zoom:"+mag_factor+"; -moz-transform:"+mag_factor+";";const constant_title="CLICK: Copy to clipboard\n\nSHIFT-CLICK: Add to clipboard' ";for(var z=0;z<ruleset_control.num_unit_types;z++){if(utype_has_flag(unit_types[z],UTYF_NOBUILD))continue;if(unit_types[z].government_req<GOV_LAST){if(unit_types[z].goverment_req!=gov_id)continue;if(unit_types[z]["name"]=="Peasants"&&!player_has_wonder(client.conn.playing.playerno,B_MAGNA_CARTA))continue}const obs_by_type=unit_types[z]["obsoleted_by"];if(obs_by_type<ruleset_control.num_unit_types){if(unit_types[obs_by_type]["tech_requirement"]>0){if(player_invention_state(client.conn.playing,unit_types[obs_by_type]["tech_requirement"])==TECH_KNOWN){continue}}}var req_state=player_invention_state(client.conn.playing,unit_types[z]["tech_requirement"]);if(req_state!=TECH_KNOWN){if(req_state!=TECH_PREREQS_KNOWN)continue}sprite=get_unit_type_image_sprite(unit_types[z]);if(sprite==null)continue;if(unit_types[z]["tech_requirement"]>0){if(req_state==TECH_PREREQS_KNOWN){bg="background:#5003 "}else bg="background:#EFF4 "}else bg="background:#EFF4 ";var opacity=1;var title_text="title='"+unit_types[z]["name"]+"\n\n"+constant_title;const click_action="onclick='handle_improv_clipboard(event, "+VUT_UTYPE+","+z+");' ";units_html=units_html+"<div style='cursor:pointer; padding:0px; opacity:"+opacity+"; "+magnification+"'><span style='padding:0px; margin:0px; margin-left:-1px; "+border+" "+bg+" url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;float:left;' "+title_text+click_action+"</span></div>"}return units_html}function toggle_empire_show_upkeep(upkeep_type){switch(upkeep_type){case"food":empire_upkeep_show_food=!empire_upkeep_show_food;$("#show_food").prop("checked",empire_upkeep_show_food);break;case"gold":empire_upkeep_show_gold=!empire_upkeep_show_gold;$("#show_gold").prop("checked",empire_upkeep_show_gold);break;case"shields":empire_upkeep_show_shields=!empire_upkeep_show_shields;$("#show_shield").prop("checked",empire_upkeep_show_shields);break;case"free":empire_upkeep_show_free=!empire_upkeep_show_free;$("#show_free").prop("checked",empire_upkeep_show_free);break}empire_sort_mode=SORT_NONE;update_empire_screen();empire_sort_mode=SORT_NONE}function toggle_empire_show_present_buildings(){empire_show_present_buildings=!empire_show_present_buildings;$("#show_pb").prop("checked",empire_show_present_buildings);empire_sort_mode=DO_NO_SORT;update_empire_screen();empire_sort_mode=SORT_NONE}function toggle_empire_show_absent_buildings(){empire_show_absent_buildings=!empire_show_absent_buildings;$("#show_ab").prop("checked",empire_show_absent_buildings);empire_sort_mode=DO_NO_SORT;update_empire_screen();empire_sort_mode=SORT_NONE}function toggle_empire_show_wonders_only(){empire_show_wonders_only=!empire_show_wonders_only;$("#show_wonders").prop("checked",empire_show_wonders_only);empire_sort_mode=DO_NO_SORT;update_empire_screen();empire_sort_mode=SORT_NONE}function toggle_empire_show_hitpoints(){empire_show_hitpoints=!empire_show_hitpoints;$("#show_hp").prop("checked",empire_show_hitpoints);empire_sort_mode=DO_NO_SORT;update_empire_screen();empire_sort_mode=SORT_NONE}function toggle_empire_show_movepoints(){empire_show_movesleft=!empire_show_movesleft;$("#show_mp").prop("checked",empire_show_movesleft);empire_sort_mode=DO_NO_SORT;update_empire_screen();empire_sort_mode=SORT_NONE}function empire_sort_hp(){empire_sort_mode=SORT_HP;for(unit_type_id in unit_types){units_sorted_by_type[unit_type_id].sort(compare_hp_sort)}update_empire_screen();empire_sort_mode=SORT_NONE}function compare_hp_sort(u1,u2){if(u1["hp"]<u2["hp"])return 1;if(u2["hp"]<u1["hp"])return-1;if(u1["veteran"]<u2["veteran"])return 1;if(u2["veteran"]<u1["veteran"])return-1;if(u1["movesleft"]<u2["movesleft"])return 1;if(u2["movesleft"]<u1["movesleft"])return-1;return 0}function empire_sort_mp(){empire_sort_mode=SORT_MOVES;for(unit_type_id in unit_types){units_sorted_by_type[unit_type_id].sort(compare_mp_sort)}update_empire_screen();empire_sort_mode=SORT_NONE}function compare_mp_sort(u1,u2){if(u1["movesleft"]<u2["movesleft"])return 1;if(u2["movesleft"]<u1["movesleft"])return-1;if(u1["hp"]<u2["hp"])return 1;if(u2["hp"]<u1["hp"])return-1;if(u1["veteran"]<u2["veteran"])return 1;if(u2["veteran"]<u1["veteran"])return-1;return 0}function empire_sort_vet(){empire_sort_mode=SORT_VET;for(unit_type_id in unit_types){units_sorted_by_type[unit_type_id].sort(compare_vet_sort)}update_empire_screen();empire_sort_mode=SORT_NONE}function compare_vet_sort(u1,u2){if(u1["veteran"]<u2["veteran"])return 1;if(u2["veteran"]<u1["veteran"])return-1;if(u1["hp"]<u2["hp"])return 1;if(u2["hp"]<u1["hp"])return-1;if(u1["movesleft"]<u2["movesleft"])return 1;if(u2["movesleft"]<u1["movesleft"])return-1;return 0}function empire_unittype_screen(wide_screen,narrow_screen,small_screen,landscape_screen,tiny_screen,redux_screen){$("#empire_title").html("National Units");if(small_screen)$("#empire_title").hide();else $("#empire_title").show();var panel_html="<input id='show_hp' type='checkbox' class='css-checkbox' title='Show hit points' name='chHP' value='false' onclick='toggle_empire_show_hitpoints();'>"+"<label for='show_hp' name='show_hp_lbl' class='css-label dark-check-red'>HP</label>&ensp;"+"<input id='show_mp' type='checkbox' class='css-checkbox' title='Show movement points' name='chMP' value='false' onclick='toggle_empire_show_movepoints();'>"+"<label for='show_mp' name='show_mp_lbl' class='css-label dark-check-green'>Moves</label>";panel_html+="&nbsp;&nbsp;<button id='button_sorthp' type='button' class='button ui-button ui-corner-all ui-widget' onclick='empire_sort_hp();'"+"title='Sort units rows by Hitpoints' style='padding:5px; margin-bottom:2px;'>&#x2943HP</button>";panel_html+="<button id='button_sortmp' type='button' class='button ui-button ui-corner-all ui-widget' onclick='empire_sort_mp();'"+"title='Sort unit rows by Moves Left' style='padding:5px; margin-bottom:2px;'>&#x2943Moves</button>";panel_html+="<button id='button_sortvet' type='button' class='button ui-button ui-corner-all ui-widget' onclick='empire_sort_vet();'"+"title='Sort unit rows by Vet level' style='padding:5px; margin-bottom:2px;'>&#x2943Vet</button>";$("#empire_mode_panel").html(panel_html);$("#show_hp").prop("checked",empire_show_hitpoints);$("#show_mp").prop("checked",empire_show_movesleft);$("#empire_scroll").css({height:$(window).height()-160,"overflow-y":"scroll","overflow-x":"hidden"});var sortList=[];var headers=$("#empire_table thead th");headers.filter(".tablesorter-headerAsc").each(function(i,cell){sortList.push([cell.cellIndex,0])});headers.filter(".tablesorter-headerDesc").each(function(i,cell){sortList.push([cell.cellIndex,1])});if(narrow_screen||tiny_screen)$("#empire_prompt").hide();else $("#empire_prompt").show();const updown_sort_arrows="<img class='lowered_gov' src='data:image/gif;base64,R0lGODlhFQAJAIAAAP///////yH5BAEAAAEALAAAAAAVAAkAAAIXjI+AywnaYnhUMoqt3gZXPmVg94yJVQAAOw=='>";var empire_list_html="";if(true){empire_list_html="<table class='tablesorter-dark' id='empire_table' style='border=0px;border-spacing=0;padding=0;'>"+"<thead id='empire_table_head'>"+"<tr>"+"<th title='Sort by total' style='text-align:right;'>"+updown_sort_arrows+"</th>"+"<th title='Sort alphabetically' style=''>Type"+updown_sort_arrows+"</th>"+"<th title='Sort by similar types' style='text-align:left; padding-left:10px;'>&nbsp;Units"+updown_sort_arrows+"</th>"+"</tr>"+"</thead><tbody>"}else if(redux_screen){}else{}var adjust_oversize="";var unit_row_html="";var type_count=0;if(empire_sort_mode){}else{units_sorted_by_type=[];for(var unit_type_id in unit_types){units_sorted_by_type[unit_type_id]=[]}for(var unit_id in units){var sunit=units[unit_id];if(client.conn.playing!=null&&unit_owner(sunit).playerno==client.conn.playing.playerno){units_sorted_by_type[sunit["type"]].push(sunit)}}}var ptype_img_html="";var hit_point_html="";var moves_left_html="";var vet_badge_html="";var count=new Array(unit_types.length);for(var unit_type_id in unit_types){count[unit_type_id]=0;var rheight=28*Math.ceil(units_sorted_by_type[unit_type_id].length*40/($(window).width()-140));unit_row_html="<tr class='cities_row;' style='height:"+rheight+"px;'>";unit_row_html+="<td style='font-size:85%; text-align:right;' id='ucount"+unit_type_id+"'></td>";unit_row_html+="<td style='padding-left:10px; padding-right:10px; font-size:85%; color:#d0d0d0'>"+unit_types[unit_type_id]["name"]+"</td>";unit_row_html+="<td style='padding-left:10px;' id='u"+unit_type_id+"'>";for(var unit_index in units_sorted_by_type[unit_type_id]){var punit=units_sorted_by_type[unit_type_id][unit_index];count[unit_type_id]++;var ptype=unit_type(punit);var ptype_sprite={type:ptype,sprite:get_unit_type_image_sprite(ptype)};var hptype_sprite={type:ptype,sprite:get_full_hp_sprite(punit)};var mptype_sprite={type:ptype,sprite:get_full_mp_sprite(punit)};var vtype_sprite={type:ptype,sprite:get_full_vet_sprite(punit)};if(ptype_sprite!=null){sprite=ptype_sprite["sprite"];var hp_sprite=hptype_sprite["sprite"];var mp_sprite=mptype_sprite["sprite"];var vet_sprite=vtype_sprite["sprite"];adjust_oversize=sprite["width"]>64?-34:-26;ptype_img_html="<span class='prod_img' title='"+html_safe(get_unit_city_info(punit))+"' style='float:left; padding-left:0px padding-right:0px; content-align:right; margin-top:-8px;"+"margin-left:"+adjust_oversize+"px' margin-right:-4px; onclick='city_dialog_activate_unit(units["+punit["id"]+"]);'>"+"<div style='float:left; content-align:left;"+"background: transparent url("+sprite["image-src"]+");transform: scale(0.625); background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;"+" content-align: left;"+"vertical-align:top; float:left;'>"+"</div>";hit_point_html="<div style='margin-left:-83px; margin-top:-10px; margin-right:-24px; float:left; content-align:left;"+"background: transparent url("+hp_sprite["image-src"]+");transform: scale(0.625); background-position:-"+hp_sprite["tileset-x"]+"px -"+hp_sprite["tileset-y"]+"px;  width: "+hp_sprite["width"]+"px;height: "+hp_sprite["height"]+"px;"+" content-align: left;"+"vertical-align:top; float:left;'>"+"</div>";moves_left_html="<div style='margin-left:-83px; margin-top:-6px; margin-right:-24px; float:left; content-align:left;"+"background: transparent url("+mp_sprite["image-src"]+");transform: scale(0.625); background-position:-"+mp_sprite["tileset-x"]+"px -"+mp_sprite["tileset-y"]+"px;  width: "+mp_sprite["width"]+"px;height: "+mp_sprite["height"]+"px;"+" content-align: left;"+"vertical-align:top; float:left;'>"+"</div>";if(punit["veteran"]>0){vet_badge_html="<div style='margin-left:-50px; margin-top:-16px; margin-right: -24px; float:left; content-align:left;"+"background: transparent url("+vet_sprite["image-src"]+");transform: scale(0.7); background-position:-"+vet_sprite["tileset-x"]+"px -"+vet_sprite["tileset-y"]+"px;  width: "+vet_sprite["width"]+"px;height: "+vet_sprite["height"]+"px;"+" content-align: left;"+"vertical-align:top; float:left;'>"+"</div>"}else vet_badge_html=""}if(empire_show_movesleft)ptype_img_html+=moves_left_html;if(empire_show_hitpoints)ptype_img_html+=hit_point_html;if(punit["veteran"]>0)ptype_img_html+=vet_badge_html;unit_row_html+="<span id='u_img"+unit_type_id+"'>"+"<span style='font-size:1%; color: rgba(0, 0, 0, 0);'>"+String.fromCharCode(65+unit_type_id)+"</span>"+ptype_img_html+"</span></span>"}if(count[unit_type_id]>0){type_count++;empire_list_html+=unit_row_html+"</td></tr>"}}empire_list_html+="</tbody></table>";$("#empire_list").html(empire_list_html);for(unit_type_id in unit_types){if(count[unit_type_id]>0)$("#ucount"+unit_type_id).html(count[unit_type_id]+"&nbsp;")}if(type_count==0){$("#empire_table").html("You have no units.")}$("#empire_table").tablesorter({theme:"dark",sortList:sortList});if(tiny_screen){}else if(redux_screen){}else if(wide_screen){}}function change_empire_mode(mode_selected){empire_mode=mode_selected;update_empire_screen()}var extras={};const EXTRA_NONE=-1;const RS_DEFAULT_EXTRA_DISAPPEARANCE=15;const RS_DEFAULT_EXTRA_APPEARANCE=15;function extra_by_number(id){if(id==EXTRA_NONE){return null}if(id>=0&&id<MAX_EXTRA_TYPES){return extras[id]}else{console.log("extra_by_number(): Invalid extra id: "+id);return null}}function extra_owner(ptile){return player_by_number(ptile["extras_owner"])}function is_extra_caused_by(pextra,cause){return pextra.causes.isSet(cause)}function is_extra_removed_by(pextra,rmcause){return pextra.rmcauses.isSet(rmcause)}var TRUE=true;var FALSE=false;var TRI_NO=0;var TRI_YES=1;var TRI_MAYBE=2;var MAX_NUM_ITEMS=200;var MAX_NUM_ADVANCES=250;var MAX_NUM_UNITS=250;var MAX_NUM_BUILDINGS=200;var MAX_EXTRA_TYPES=128;var MAX_LEN_NAME=48;var MAX_LEN_CITYNAME=60;const UNCLAIMED_LAND=255;var FC_INFINITY=1e3*1e3*1e3;const CONNECT_ACTION_ILLEGAL=-1;var ACTIVITY_IDLE=0;var ACTIVITY_POLLUTION=1;var ACTIVITY_MINE=3;var ACTIVITY_IRRIGATE=4;var ACTIVITY_FORTIFIED=5;var ACTIVITY_SENTRY=7;var ACTIVITY_PILLAGE=9;var ACTIVITY_GOTO=10;var ACTIVITY_EXPLORE=11;var ACTIVITY_TRANSFORM=12;var ACTIVITY_UNUSED=13;var ACTIVITY_VIGIL=13;var ACTIVITY_FORTIFYING=15;var ACTIVITY_FALLOUT=16;var ACTIVITY_BASE=18;var ACTIVITY_GEN_ROAD=19;var ACTIVITY_CONVERT=20;var ACTIVITY_CULTIVATE=21;var ACTIVITY_PLANT=22;var ACTIVITY_LAST=23;var IDENTITY_NUMBER_ZERO=0;var ATK_CITY=0;var ATK_UNIT=1;var ATK_UNITS=2;var ATK_TILE=3;var ATK_SELF=4;var ATK_COUNT=5;var ACTION_ESTABLISH_EMBASSY=0;var ACTION_ESTABLISH_EMBASSY_STAY=1;var ACTION_SPY_INVESTIGATE_CITY=2;var ACTION_INV_CITY_SPEND=3;var ACTION_SPY_POISON=4;var ACTION_SPY_POISON_ESC=5;var ACTION_SPY_STEAL_GOLD=6;var ACTION_SPY_STEAL_GOLD_ESC=7;var ACTION_SPY_SABOTAGE_CITY=8;var ACTION_SPY_SABOTAGE_CITY_ESC=9;var ACTION_SPY_TARGETED_SABOTAGE_CITY=10;var ACTION_SPY_TARGETED_SABOTAGE_CITY_ESC=11;var ACTION_SPY_SABOTAGE_CITY_PRODUCTION=12;var ACTION_SPY_SABOTAGE_CITY_PRODUCTION_ESC=13;var ACTION_SPY_STEAL_TECH=14;var ACTION_SPY_STEAL_TECH_ESC=15;var ACTION_SPY_TARGETED_STEAL_TECH=16;var ACTION_SPY_TARGETED_STEAL_TECH_ESC=17;var ACTION_SPY_INCITE_CITY=18;var ACTION_SPY_INCITE_CITY_ESC=19;var ACTION_TRADE_ROUTE=20;var ACTION_MARKETPLACE=21;var ACTION_HELP_WONDER=22;var ACTION_SPY_BRIBE_UNIT=23;var ACTION_SPY_SABOTAGE_UNIT=24;var ACTION_SPY_SABOTAGE_UNIT_ESC=25;var ACTION_CAPTURE_UNITS=26;var ACTION_FOUND_CITY=27;var ACTION_JOIN_CITY=28;var ACTION_STEAL_MAPS=29;var ACTION_STEAL_MAPS_ESC=30;var ACTION_BOMBARD=31;var ACTION_BOMBARD2=32;var ACTION_BOMBARD3=33;var ACTION_SPY_NUKE=34;var ACTION_SPY_NUKE_ESC=35;var ACTION_NUKE=36;var ACTION_NUKE_CITY=37;var ACTION_NUKE_UNITS=38;var ACTION_DESTROY_CITY=39;var ACTION_EXPEL_UNIT=40;var ACTION_RECYCLE_UNIT=41;var ACTION_DISBAND_UNIT=42;var ACTION_HOME_CITY=43;var ACTION_UPGRADE_UNIT=44;var ACTION_PARADROP=45;var ACTION_AIRLIFT=46;var ACTION_ATTACK=47;var ACTION_SUICIDE_ATTACK=48;var ACTION_STRIKE_BUILDING=49;var ACTION_STRIKE_PRODUCTION=50;var ACTION_CONQUER_CITY=51;var ACTION_CONQUER_CITY2=52;var ACTION_HEAL_UNIT=53;var ACTION_TRANSFORM_TERRAIN=54;var ACTION_CULTIVATE=55;var ACTION_PLANT=56;var ACTION_PILLAGE=57;var ACTION_FORTIFY=58;var ACTION_ROAD=59;var ACTION_CONVERT=60;var ACTION_BASE=61;var ACTION_MINE=62;var ACTION_IRRIGATE=63;var ACTION_TRANSPORT_DEBOARD=64;var ACTION_TRANSPORT_UNLOAD=65;var ACTION_TRANSPORT_DISEMBARK1=66;var ACTION_TRANSPORT_DISEMBARK2=67;var ACTION_TRANSPORT_BOARD=68;var ACTION_TRANSPORT_EMBARK=69;var ACTION_SPY_SPREAD_PLAGUE=70;var ACTION_SPY_ATTACK=71;var ACTION_USER_ACTION1=72;var ACTION_USER_ACTION2=73;var ACTION_USER_ACTION3=74;var ACTION_CLEAN_POLLUTION=75;var ACTION_CLEAN_FALLOUT=76;var ACTION_COUNT=77;var ACT_DEC_NOTHING=0;var ACT_DEC_PASSIVE=1;var ACT_DEC_ACTIVE=2;var VUT_NONE=0;var VUT_ADVANCE=1;var VUT_GOVERNMENT=2;var VUT_IMPROVEMENT=3;var VUT_TERRAIN=4;var VUT_NATION=5;var VUT_UTYPE=6;var VUT_UTFLAG=7;var VUT_UCLASS=8;var VUT_UCFLAG=9;var VUT_OTYPE=10;var VUT_SPECIALIST=11;var VUT_MINSIZE=12;var VUT_AI_LEVEL=13;var VUT_TERRAINCLASS=14;var VUT_MINYEAR=15;var VUT_TERRAINALTER=16;var VUT_CITYTILE=17;var VUT_GOOD=18;var VUT_TERRFLAG=19;var VUT_NATIONALITY=20;var VUT_BASEFLAG=21;var VUT_ROADFLAG=22;var VUT_EXTRA=23;var VUT_TECHFLAG=24;var VUT_ACHIEVEMENT=25;var VUT_DIPLREL=26;var VUT_MAXTILEUNITS=27;var VUT_STYLE=28;var VUT_MINCULTURE=29;var VUT_UNITSTATE=30;var VUT_MINMOVES=31;var VUT_MINVETERAN=32;var VUT_MINHP=33;var VUT_AGE=34;var VUT_NATIONGROUP=35;var VUT_TOPO=36;var VUT_IMPR_GENUS=37;var VUT_ACTION=38;var VUT_MINTECHS=39;var VUT_EXTRAFLAG=40;var VUT_MINCALFRAG=41;var VUT_SERVERSETTING=42;var VUT_COUNT=43;var GUI_STUB=0;var GUI_GTK2=1;var GUI_GTK3=2;var GUI_GTK3_22=3;var GUI_SDL=4;var GUI_QT=5;var GUI_SDL2=6;var GUI_WEB=7;var GUI_GTK3x=8;var RPT_POSSIBLE=0;var RPT_CERTAIN=1;const O_FOOD=0;const O_SHIELD=1;const O_TRADE=2;const O_GOLD=3;const O_LUXURY=4;const O_SCIENCE=5;const O_LAST=6;const O_NAME=["Food","Shield","Trade","Gold","Luxury","Science"];const O_PIC=["/images/wheat.png","/images/shield14x18.png","/images/trade.png","/images/gold.png","/images/lux.png","/images/sci.png"];var V_MAIN=0;var V_INVIS=1;var V_SUBSURFACE=2;var V_COUNT=3;var EC_IRRIGATION=0;var EC_MINE=1;var EC_ROAD=2;var EC_BASE=3;var EC_POLLUTION=4;var EC_FALLOUT=5;var EC_HUT=6;var EC_APPEARANCE=7;var EC_RESOURCE=8;var ERM_PILLAGE=0;var ERM_CLEANPOLLUTION=1;var ERM_CLEANFALLOUT=2;var ERM_DISAPPEARANCE=3;var NOT_A_BARBARIAN=0;var LAND_BARBARIAN=1;var SEA_BARBARIAN=2;var ANIMAL_BARBARIAN=3;var LAND_AND_SEA_BARBARIAN=4;const GENUS_GREAT_WONDER=0;const GENUS_SMALL_WONDER=1;const GENUS_IMPROVEMENT=2;const GENUS_COINAGE=3;var freeciv_wiki_docs={"A.Smith's Trading Co.":{image:"Adam Smith.jpg",summary:"Adam Smith  (16 June 1723 NS (5 June 1723 OS) – 17 July 1790) was a Scottish economist, philosopher and author as well as a moral philosopher, a pioneer of political economy and a key figure during the Scottish Enlightenment era. Smith is best known for two classic works: The Theory of Moral Sentiments (1759) and An Inquiry into the Nature and Causes of the Wealth of Nations (1776). The latter, usually abbreviated as The Wealth of Nations, is considered his magnum opus and the first modern work of economics.\nSmith studied social philosophy at the University of Glasgow and at Balliol College, Oxford, where he was one of the first students to benefit from scholarships set up by fellow Scot, John Snell. After graduating, he delivered a successful series of public lectures at Edinburgh, leading him to collaborate with David Hume during the Scottish Enlightenment. Smith obtained a professorship at Glasgow teaching moral philosophy and during this time wrote and published The Theory of Moral Sentiments. In his later life, he took a tutoring position that allowed him to travel throughout Europe, where he met other intellectual leaders of his day.\nSmith laid the foundations of classical free market economic theory. The Wealth of Nations was a precursor to the modern academic discipline of economics. In this and other works, he developed the concept of division of labour and expounded upon how rational self-interest and competition can lead to economic prosperity. Smith was controversial in his own day and his general approach and writing style were often satirised by Tory writers in the moralising tradition of William Hogarth and Jonathan Swift. In 2005, The Wealth of Nations was named among the 100 Best Scottish Books of all time. The minor planet 12838 Adamsmith was named in his memory.",title:"Adam Smith"},"AEGIS Cruiser":{image:"Ticonderoga-class cruiser.jpg",summary:"The Ticonderoga class of guided missile cruisers is a class of warships in the United States Navy, first ordered and authorized in the 1978 fiscal year. The class uses passive phased-array radar and was originally planned as a class of destroyers. However, the increased combat capability offered by the Aegis Combat System and the AN/SPY-1 radar system, together with the capability of operating as a flagship, were used to justify the change of the classification from DDG (guided missile destroyer) to CG (guided-missile cruiser) shortly before the keels were laid down for Ticonderoga and Yorktown.\nTiconderoga-class guided-missile cruisers are multi-role warships. Their Mk 41 VLS can launch Tomahawk cruise missiles to strike strategic or tactical targets, or fire long-range antiaircraft Standard Missiles for defense against aircraft or anti-ship missiles. Their LAMPS III helicopters and sonar systems allow them to perform antisubmarine missions. Ticonderoga-class ships are designed to be elements of carrier battle groups or amphibious ready groups, as well as performing missions such as interdiction or escort. With upgrades to their to AN/SPY-1 phased radar systems and their associated missile payloads as part of the Aegis Ballistic Missile Defense System, members of this class have also begun to demonstrate some promise as mobile anti-ballistic missile and anti-satellite weaponry platforms.\nOf the 27 completed vessels, 19 were built by Ingalls Shipbuilding and eight by Bath Iron Works (BIW). All but one (Thomas S. Gates) of the ships in the class are named for noteworthy events in U.S. military history, and at least twelve—Ticonderoga, Cowpens, Anzio, Yorktown, Valley Forge, Bunker Hill, Antietam, San Jacinto, Lake Champlain, Philippine Sea, Princeton, Monterey, and Vella Gulf—share their names with World War II aircraft carriers. 22 ships were active in 2016, and expected to serve for 35 years since commissioning.\n\n",title:"Ticonderoga-class cruiser"},AWACS:{image:"Boeing E-3 Sentry.jpg",summary:"The Boeing E-3 Sentry, commonly known as AWACS, is an American airborne early warning and control (AEW&C) aircraft developed by Boeing. Derived from the Boeing 707, it provides all-weather surveillance, command, control, and communications, and is used by the United States Air Force, NATO, Royal Air Force, French Air Force, and Royal Saudi Air Force. The E-3 is distinguished by the distinctive rotating radar dome above the fuselage. Production ended in 1992 after 68 aircraft had been built.\nIn the mid-1960s, the US Air Force (USAF) was seeking an aircraft to replace its piston-engined Lockheed EC-121 Warning Star, which had been in service for over a decade. After issuing preliminary development contracts to three companies, the USAF picked Boeing to construct two airframes to test Westinghouse Electric and Hughes's competing radars. Both radars used pulse-Doppler technology, with Westinghouse's design emerging as the contract winner. Testing on the first production E-3 began in October 1975.\nThe first USAF E-3 was delivered in March 1977, and during the next seven years, a total of 34 aircraft were manufactured. NATO, as a single identity, also had 18 aircraft manufactured, basing them in Germany. The E-3 was also sold to the United Kingdom (seven) and France (four) and Saudi Arabia (five, plus eight E-3-derived tanker aircraft). In 1991, when the last aircraft had been delivered, E-3s participated in Operation Desert Storm, playing a crucial role of directing coalition aircraft against the enemy. Throughout the aircraft's service life, numerous upgrades were performed to enhance its capabilities. In 1996, Westinghouse Electric's Defense & Electronic Systems division, was acquired by Northrop Corporation before its being renamed Northrop Grumman Electronic Systems, which currently supports the E-3's radar.",title:"Boeing E-3 Sentry"},"Advanced Flight":{image:"Aeronautics.jpg",summary:'Aeronautics (from the ancient Greek words ὰήρ āēr, which means "air", and ναυτική nautikē which means "navigation", i.e. "navigation into the air") is the science or art involved with the study, design, and manufacturing of air flight capable machines, and the techniques of operating aircraft and rockets within the atmosphere. The British Royal Aeronautical Society identifies the aspects of "aeronautical Art, Science and Engineering" and "the profession of Aeronautics (which expression includes Astronautics)." \nWhile the term—literally meaning "sailing the air"—originally referred solely to the science of operating the aircraft, it has since been expanded to include technology, business, and other aspects related to aircraft. The term "aviation" is sometimes used interchangeably with aeronautics, although "aeronautics" includes lighter-than-air craft such as airships, and includes ballistic vehicles while "aviation" technically does not.\nA significant part of aeronautical science is a branch of dynamics called aerodynamics, which deals with the motion of air and the way that it interacts with objects in motion, such as an aircraft.',title:"Aeronautics"},Airport:{image:"Airport.jpg",summary:"An airport is an aerodrome with extended facilities, mostly for commercial air transport. Airports often have facilities to store and maintain aircraft, and a control tower. An airport consists of a landing area, which comprises an aerially accessible open space including at least one operationally active surface such as a runway for a plane to take off or a helipad, and often includes adjacent utility buildings such as control towers, hangars and terminals. Larger airports may have fixed-base operator services, airport aprons, taxiway bridges, air traffic control centres, passenger facilities such as restaurants and lounges, and emergency services.\nAn airport with a helipad for rotorcraft but no runway is called a heliport. An airport for use by seaplanes and amphibious aircraft is called a seaplane base. Such a base typically includes a stretch of open water for takeoffs and landings, and seaplane docks for tying-up.\nAn international airport has additional facilities for customs and passport control.\nIn warfare, airports can become the focus of intense fighting, for example the Battle of Tripoli Airport or the Battle for Donetsk Airport, both taking place in 2014. An airport primarily for military use is called an airbase or air station.\nMost of the world's airports are owned by local, regional, or national government bodies.",title:"Airport"},Alphabet:{image:"Alphabet.jpg",summary:'An alphabet is a standard set of letters (basic written symbols or graphemes) that is used to write one or more languages based upon the general principle that the letters represent phonemes (basic significant sounds) of the spoken language. This is in contrast to other types of writing systems, such as syllabaries (in which each character represents a syllable) and logographies (in which each character represents a word, morpheme, or semantic unit).\nThe Proto-Canaanite script, later known as the Phoenician alphabet, is the first fully phonemic script. Thus the Phoenician alphabet is considered to be the first alphabet. The Phoenician alphabet is the ancestor of most modern alphabets, including Arabic, Greek, Latin, Cyrillic, Hebrew, and possibly Brahmic. Under a terminological distinction promoted by Peter T. Daniels, an "alphabet" is a script that represents both vowels and consonants as letters equally. In this narrow sense of the word the first "true" alphabet was the Greek alphabet, which was developed on the basis of the earlier Phoenician alphabet. In other alphabetic scripts such as the original Phoenician, Hebrew or Arabic, letters predominantly or exclusively represent consonants; such a script is also called an abjad. A third type, called abugida or alphasyllabary, is one where vowels are shown by diacritics or modifications of consonantal base letters, as in Devanagari and other South Asian scripts. The Khmer alphabet (for Cambodian) is the longest, with 74 letters.\nThere are dozens of alphabets in use today, the most popular being the Latin alphabet (which was derived from the Greek). Many languages use modified forms of the Latin alphabet, with additional letters formed using diacritical marks. While most alphabets have letters composed of lines (linear writing), there are also exceptions such as the alphabets used in Braille.\nAlphabets are usually associated with a standard ordering of letters. This makes them useful for purposes of collation, specifically by allowing words to be sorted in alphabetical order. It also means that their letters can be used as an alternative method of "numbering" ordered items, in such contexts as numbered lists and number placements.',title:"Alphabet"},"Alpine Troops":{image:"Mountain warfare.jpg",summary:"Mountain warfare refers to warfare in the mountains or similarly rough terrain. This type of warfare is also called Alpine warfare, after the Alps mountains. Mountain warfare is one of the most dangerous types of combat as it involves surviving not only combat with the enemy but also the extreme weather and dangerous terrain.\nMountain ranges are of strategic importance since they often act as a natural border, and may also be the origin of a water source (e.g. Golan Heights – water conflict). Attacking a prepared enemy position in mountain terrain requires a greater ratio of attacking soldiers to defending soldiers than a war conducted on level ground. Mountains at any time of year are dangerous – lightning, strong gusts of wind, rock falls, avalanche, snow pack, ice, extreme cold, glaciers with their crevasses and the general uneven terrain and the slow pace of troop and material movement are all additional threats to combatants. Movement, reinforcements, and medical evacuation up and down steep slopes and areas where even pack animals cannot reach involves an enormous exertion of energy.\n\n",title:"Mountain warfare"},"Amphibious Warfare":{image:"Amphibious warfare.jpg",summary:'Amphibious warfare is a type of offensive military operation that today uses naval ships to project ground and air power onto a hostile or potentially hostile shore at a designated landing beach. Through history the operations were conducted using ship\'s boats as the primary method of delivering troops to shore. Since the Gallipoli Campaign specialised watercraft were increasingly designed for landing troops, materiel and vehicles, including by landing craft and for insertion of commandos, by fast patrol boats, zodiacs (rigid inflatable boats) and from mini-submersibles.\nThe term amphibious first emerged in the UK and the USA during the 1930s with introduction of vehicles such as Vickers-Carden-Loyd Light Amphibious Tank or the Landing Vehicle Tracked.\nAmphibious warfare includes operations defined by their type, purpose, scale and means of execution. In the British Empire at the time these were called combined operations which were defined as "...operations where naval, military or air forces in any combination are co-operating with each other, working independently under their respective commanders, but with a common strategic object." All armed forces that employ troops with special training and equipment for conducting landings from naval vessels to shore agree to this definition.\nSince the 20th century an amphibious landing of troops on a beachhead is acknowledged as the most complex of all military maneuvers. The undertaking requires an intricate coordination of numerous military specialties, including air power, naval gunfire, naval transport, logistical planning, specialized equipment, land warfare, tactics, and extensive training in the nuances of this maneuver for all personnel involved.\n\n',title:"Amphibious warfare"},Anarchy:{image:"Anarchy.jpg",summary:"Anarchy is the condition of a society, entity, group of people, or a single person that rejects hierarchy. The word originally meant leaderlessness, but in 1840 Pierre-Joseph Proudhon adopted the term in his treatise What Is Property? to refer to a new political philosophy: anarchism, which advocates stateless societies based on voluntary associations. In practical terms, anarchy can refer to the curtailment or abolition of traditional forms of government and institutions. It can also designate a nation (or anywhere on earth that is inhabited) that has no system of government or central rule.",title:"Anarchy"},"Apollo Program":{image:"Apollo program.jpg",summary:"The Apollo program, also known as Project Apollo, was the third United States human spaceflight program carried out by the National Aeronautics and Space Administration (NASA), which accomplished landing the first humans on the Moon from 1969 to 1972. First conceived during Dwight D. Eisenhower's administration as a three-man spacecraft to follow the one-man Project Mercury which put the first Americans in space, Apollo was later dedicated to President John F. Kennedy's national goal of \"landing a man on the Moon and returning him safely to the Earth\" by the end of the 1960s, which he proposed in an address to Congress on May 25, 1961.\nKennedy's goal was accomplished on the Apollo 11 mission when astronauts Neil Armstrong and Buzz Aldrin landed their Lunar Module (LM) on July 20, 1969, and walked on the lunar surface, while Michael Collins remained in lunar orbit in the Command/Service Module (CSM), and all three landed safely on Earth on July 24. Five subsequent Apollo missions also landed astronauts on the Moon, the last in December 1972. In these six spaceflights, twelve men walked on the Moon.\nApollo ran from 1961 to 1972, with the first manned flight in 1968. It achieved its goal of manned lunar landing, despite the major setback of a 1967 Apollo 1 cabin fire that killed the entire crew during a prelaunch test. After the first landing, sufficient flight hardware remained for nine follow-on landings with a plan for extended lunar geological and astrophysical exploration. Budget cuts forced the cancellation of three of these. Five of the remaining six missions achieved successful landings, but the Apollo 13 landing was prevented by an oxygen tank explosion in transit to the Moon, which damaged the CSM's propulsion and life support. The crew returned to Earth safely by using the Lunar Module as a \"lifeboat\" for these functions. Apollo used Saturn family rockets as launch vehicles, which were also used for an Apollo Applications Program, which consisted of Skylab, a space station that supported three manned missions in 1973–74, and the Apollo–Soyuz Test Project, a joint Earth orbit mission with the Soviet Union in 1975.\nApollo set several major human spaceflight milestones. It stands alone in sending manned missions beyond low Earth orbit. Apollo 8 was the first manned spacecraft to orbit another celestial body, while the final Apollo 17 mission marked the sixth Moon landing and the ninth manned mission beyond low Earth orbit. The program returned 842 pounds (382 kg) of lunar rocks and soil to Earth, greatly contributing to the understanding of the Moon's composition and geological history. The program laid the foundation for NASA's subsequent human spaceflight capability, and funded construction of its Johnson Space Center and Kennedy Space Center. Apollo also spurred advances in many areas of technology incidental to rocketry and manned spaceflight, including avionics, telecommunications, and computers.",title:"Apollo program"},Aqueduct:{image:"Aqueduct (water supply).jpg",summary:'An aqueduct is a watercourse constructed to convey water. In modern engineering, the term aqueduct is used for any system of pipes, ditches, canals, tunnels, and other structures used for this purpose. The term aqueduct also often refers specifically to a bridge on an artificial watercourse. The word is derived from the Latin aqua ("water") and ducere ("to lead"). Aqueducts were used in ancient Greece, ancient Egypt, and ancient Rome. In modern times, the largest aqueducts of all have been built in the United States to supply the country\'s biggest cities. The simplest aqueducts are small ditches cut into the earth. Much larger channels may be used in modern aqueducts. Aqueducts sometimes run for some or all of their path through tunnels constructed underground. Modern aqueducts may also use pipelines. Historically, agricultural societies have constructed aqueducts to irrigate crops and supply large cities with drinking water.',title:"Aqueduct (water supply)"},Archers:{image:"Archery.jpg",summary:"Archery is the sport, practice or skill of using a bow to propel arrows. The word comes from the Latin arcus. Historically, archery has been used for hunting and combat. In modern times, it is mainly a competitive sport and recreational activity. A person who participates in archery is typically called an archer or a bowman, and a person who is fond of or an expert at archery is sometimes called a toxophilite.",title:"Archery"},Armor:{image:"Armoured fighting vehicle.jpg",summary:"An armoured fighting vehicle (AFV) is an armed combat vehicle protected by armour, generally combining operational mobility with tactical offensive and defensive capabilities. AFVs can be wheeled or tracked. Tanks, armoured cars, armoured self-propelled guns, and armoured personnel carriers are all examples of AFVs. It is not uncommon for AFVs in general to be simply referred to as \"armour\".\nThe concept of a highly mobile and protected fighting unit has been around for centuries; from Hannibal's war elephants to Leonardo's war machines, military strategists endeavoured to maximize the mobility and survivability of their soldiers. Armoured fighting vehicles are classified according to their intended role on the battlefield and characteristics. This classification is not absolute; at different times different countries will classify the same vehicle in different roles. For example, armoured personnel carriers were generally replaced by infantry fighting vehicles in a similar role, but the latter has some capabilities lacking in the former. There may also be hybrid vehicles, such as the Stryker family of AFVs; the M1128 Mobile Gun System, an armoured car which mounts a large 105 mm gun normally used in tank destroyers and tanks, but can theoretically be reconfigured to the M1126 Infantry Carrier Vehicle.\nSuccessful general-purpose armoured fighting vehicles often also serve as the base of a whole family of specialized vehicles, for example, the M113 and MT-LB tracked carriers, and the MOWAG Piranha wheeled AFV.",title:"Armoured fighting vehicle"},Artillery:{image:"Artillery.jpg",summary:'Artillery is a class of large military weapons built to fire munitions far beyond the range and power of infantry\'s small arms. Early artillery development focused on the ability to breach fortifications, and led to heavy, fairly immobile siege engines. As technology improved, lighter, more mobile field artillery developed for battlefield use. This development continues today; modern self-propelled artillery vehicles are highly mobile weapons of great versatility providing the largest share of an army\'s total firepower.\nIn its earliest sense, the word artillery referred to any group of soldiers primarily armed with some form of manufactured weapon or armour. Since the introduction of gunpowder and cannon, the word "artillery" has largely meant cannon, and in contemporary usage, it usually refers to shell-firing guns, howitzers, mortars, rockets and guided missiles. In common speech, the word artillery is often used to refer to individual devices, along with their accessories and fittings, although these assemblages are more properly called "equipments". However, there is no generally recognised generic term for a gun, howitzer, mortar, and so forth: the United States uses "artillery piece", but most English-speaking armies use "gun" and "mortar". The projectiles fired are typically either "shot" (if solid) or "shell" (if not). "Shell" is a widely used generic term for a projectile, which is a component of munitions.\nBy association, artillery may also refer to the arm of service that customarily operates such engines. In some armies one arm has operated field, coast, anti-aircraft artillery and some anti-tank artillery, in others these have been separate arms and in some nations coast has been a naval or marine responsibility. In the 20th Century technology based target acquisition devices, such as radar, and systems, such as sound ranging and flash spotting, emerged to acquire targets, primarily for artillery. These are usually operated by one or more of the artillery arms. The widespread adoption of indirect fire in the early 20th century introduced the need for specialist data for field artillery, notably survey and meteorological, in some armies provision of these are the responsibility of the artillery arm.\nArtillery originated for use against ground targets—against infantry, cavalry and other artillery. An early specialist development was coastal artillery for use against enemy ships. The early 20th Century saw the development of a new class of artillery for use against aircraft: anti-aircraft guns.\nArtillery is arguably the most lethal form of land-based armament currently employed, and has been since at least the early Industrial Revolution. The majority of combat deaths in the Napoleonic Wars, World War I, and World War II were caused by artillery. In 1944, Joseph Stalin said in a speech that artillery was "the God of War".',title:"Artillery"},Astronomy:{image:"Astronomy.jpg",summary:"Astronomy (from Greek: ἀστρονομία) is a natural science that studies celestial objects and phenomena. It applies mathematics, physics, and chemistry, in an effort to explain the origin of those objects and phenomena and their evolution. Objects of interest include planets, moons, stars, galaxies, and comets; the phenomena include supernova explosions, gamma ray bursts, and cosmic microwave background radiation. More generally, all astronomical phenomena that originate outside Earth's atmosphere are within the purview of astronomy. A related but distinct subject, physical cosmology, is concerned with the study of the Universe as a whole.\nAstronomy is one of the oldest of the natural sciences. The early civilizations in recorded history, such as the Babylonians, Greeks, Indians, Egyptians, Nubians, Iranians, Chinese, Maya, and many ancient Indigenous Peoples of The Americas performed methodical observations of the night sky. Historically, astronomy has included disciplines as diverse as astrometry, celestial navigation, observational astronomy and the making of calendars, but professional astronomy is now often considered to be synonymous with astrophysics.\nDuring the 20th century, the field of professional astronomy split into observational and theoretical branches. Observational astronomy is focused on acquiring data from observations of astronomical objects, which is then analyzed using basic principles of physics. Theoretical astronomy is oriented toward the development of computer or analytical models to describe astronomical objects and phenomena. The two fields complement each other, with theoretical astronomy seeking to explain observational results and observations being used to confirm theoretical results.\nAstronomy is one of the few sciences where amateurs still play an active role, especially in the discovery and observation of transient phenomena. Amateur astronomers have made and contributed to many important astronomical discoveries, such as finding new comets.",title:"Astronomy"},"Atomic Theory":{image:"Atomic theory.jpg",summary:'In chemistry and physics, atomic theory is a scientific theory of the nature of matter, which states that matter is composed of discrete units called atoms. It began as a philosophical concept in ancient Greece and entered the scientific mainstream in the early 19th century when discoveries in the field of chemistry showed that matter did indeed behave as if it were made up of atoms.\nThe word atom comes from the Ancient Greek adjective atomos, meaning "indivisible". 19th century chemists began using the term in connection with the growing number of irreducible chemical elements. While seemingly apropos, around the turn of the 20th century, through various experiments with electromagnetism and radioactivity, physicists discovered that the so-called "uncuttable atom" was actually a conglomerate of various subatomic particles (chiefly, electrons, protons and neutrons) which can exist separately from each other. In fact, in certain extreme environments, such as neutron stars, extreme temperature and pressure prevents atoms from existing at all.\nSince atoms were found to be divisible, physicists later invented the term "elementary particles" to describe the "uncuttable", though not indestructible, parts of an atom. The field of science which studies subatomic particles is particle physics, and it is in this field that physicists hope to discover the true fundamental nature of matter.',title:"Atomic theory"},Automobile:{image:"Car.jpg",summary:"A car (or automobile) is a wheeled motor vehicle used for transportation. Most definitions of car say they run primarily on roads, seat one to eight people, have four tires, and mainly transport people rather than goods. Cars came into global use during the 20th century, and developed economies depend on them. The year 1886 is regarded as the birth year of the modern car, when German inventor Karl Benz built his Benz Patent-Motorwagen. Cars did not become widely available until the early 20th century. One of the first cars that was accessible to the masses was the 1908 Model T, an American car manufactured by the Ford Motor Company. Cars were rapidly adopted in the US, where they replaced animal-drawn carriages and carts, but took much longer to be accepted in Western Europe and other parts of the world.\nCars have controls for driving, parking, passenger comfort and safety, and controlling a variety of lights. Over the decades, additional features and controls have been added to vehicles, making them progressively more complex. Examples include rear reversing cameras, air conditioning, navigation systems, and in car entertainment. Most cars in use in the 2010s are propelled by an internal combustion engine, fueled by the combustion of fossil fuels. This causes air pollution and is also blamed for contributing to climate change and global warming. Vehicles using alternative fuels such as ethanol flexible-fuel vehicles and natural gas vehicles are also gaining popularity in some countries. Electric cars, which were invented early in the history of the car, began to become commercially available in 2008.\nThere are costs and benefits to car use. The costs include acquiring the vehicle, interest payments (if the car is financed), repairs and maintenance, fuel, depreciation, driving time, parking fees, taxes, and insurance. The costs to society include maintaining roads, land use, road congestion, air pollution, public health, health care, and disposing of the vehicle at the end of its life. Road traffic accidents are the largest cause of injury-related deaths worldwide.\nThe benefits include on-demand transportation, mobility, independence, and convenience. The societal benefits include economic benefits, such as job and wealth creation from the automotive industry, transportation provision, societal well-being from leisure and travel opportunities, and revenue generation from the taxes. The ability for people to move flexibly from place to place has far-reaching implications for the nature of societies. It was estimated in 2014 that the number of cars was over 1.25 billion vehicles, up from the 500 million of 1986. The numbers are increasing rapidly, especially in China, India and other newly industrialized countries.",title:"Car"},Bank:{image:"Bank.jpg",summary:"A bank is a financial institution where we can deposit or withdraw money on demand. Lending activities can be performed either directly or indirectly through capital markets. Due to their importance in the financial stability of a country, banks are highly regulated in most countries. Most nations have institutionalized a system known as fractional reserve banking under which banks hold liquid assets equal to only a portion of their current liabilities. In addition to other regulations intended to ensure liquidity, banks are generally subject to minimum capital requirements based on an international set of capital standards, known as the Basel Accords.\nBanking in its modern sense evolved in the 14th century in the prosperous cities of Renaissance Italy but in many ways was a continuation of ideas and concepts of credit and lending that had their roots in the ancient world. In the history of banking, a number of banking dynasties  – notably, the Medicis, the Fuggers, the Welsers, the Berenbergs and the Rothschilds  – have played a central role over many centuries. The oldest existing retail bank is Banca Monte dei Paschi di Siena, while the oldest existing merchant bank is Berenberg Bank.",title:"Bank"},Banking:{image:"Bank.jpg",summary:"A bank is a financial institution where we can deposit or withdraw money on demand. Lending activities can be performed either directly or indirectly through capital markets. Due to their importance in the financial stability of a country, banks are highly regulated in most countries. Most nations have institutionalized a system known as fractional reserve banking under which banks hold liquid assets equal to only a portion of their current liabilities. In addition to other regulations intended to ensure liquidity, banks are generally subject to minimum capital requirements based on an international set of capital standards, known as the Basel Accords.\nBanking in its modern sense evolved in the 14th century in the prosperous cities of Renaissance Italy but in many ways was a continuation of ideas and concepts of credit and lending that had their roots in the ancient world. In the history of banking, a number of banking dynasties  – notably, the Medicis, the Fuggers, the Welsers, the Berenbergs and the Rothschilds  – have played a central role over many centuries. The oldest existing retail bank is Banca Monte dei Paschi di Siena, while the oldest existing merchant bank is Berenberg Bank.",title:"Bank"},"Barbarian Leader":{image:"Barbarian.jpg",summary:'A barbarian is a human who is perceived to be either uncivilized or primitive. The designation is usually applied as generalization based on a popular stereotype; barbarians can be any member of a nation judged by some to be less civilised or orderly (such as a tribal society), but may also be part of a certain "primitive" cultural group (such as nomads) or social class (such as bandits) both within and outside one\'s own nation. Alternatively, they may instead be admired and romanticised as noble savages. In idiomatic or figurative usage, a "barbarian" may also be an individual reference to a brutal, cruel, warlike, insensitive person.\nThe term originates from the Greek: βάρβαρος (barbaros pl. βάρβαροι barbaroi), which in turn originates from the incomprehensible languages of early Anatolian nations that were heard by the Greeks as "bar..bar.." In ancient times, the Greeks used it mostly for people of different cultures, but there are examples where one Greek city or state would use the word to attack another. In the early modern period and sometimes later, Greeks used it for the Turks, in a clearly pejorative way. Comparable notions are found in non-European civilizations, notably China and Japan. During the Roman Empire, the Romans used the word "barbarian" for many people, such as the Germanics, Celts, Gauls, Iberians, Thracians, Illyrians, Parthians, Berbers and Sarmatians.',title:"Barbarian"},Barracks:{image:"Barracks.jpg",summary:'A barrack or barracks is a building or group of buildings built to house soldiers. The English word comes via French from an old Catalan word "barraca" (hut), originally referring to temporary shelters or huts for various people and animals, but today barracks are usually permanent buildings for military accommodation. The word may apply to separate housing blocks or to complete complexes, and the plural form often refers to a single structure and may be singular in construction.\nThe main object of barracks is to separate soldiers from the civilian population and reinforce discipline, training, and esprit de corps. They have been called "discipline factories for soldiers". Like industrial factories, some are considered to be shoddy or dull buildings, although others are known for their magnificent architecture such as Collins Barracks in Dublin and others in Paris, Berlin, Madrid, Vienna, or London. From the rough barracks of 19th-century conscript armies, filled with hazing and illness and barely differentiated from the livestock pens that housed the draft animals, to the clean and Internet-connected barracks of modern all-volunteer militaries, the word can have a variety of connotations.',title:"Barracks"},"Barracks II":{image:"Barracks.jpg",summary:'A barrack or barracks is a building or group of buildings built to house soldiers. The English word comes via French from an old Catalan word "barraca" (hut), originally referring to temporary shelters or huts for various people and animals, but today barracks are usually permanent buildings for military accommodation. The word may apply to separate housing blocks or to complete complexes, and the plural form often refers to a single structure and may be singular in construction.\nThe main object of barracks is to separate soldiers from the civilian population and reinforce discipline, training, and esprit de corps. They have been called "discipline factories for soldiers". Like industrial factories, some are considered to be shoddy or dull buildings, although others are known for their magnificent architecture such as Collins Barracks in Dublin and others in Paris, Berlin, Madrid, Vienna, or London. From the rough barracks of 19th-century conscript armies, filled with hazing and illness and barely differentiated from the livestock pens that housed the draft animals, to the clean and Internet-connected barracks of modern all-volunteer militaries, the word can have a variety of connotations.',title:"Barracks"},"Barracks III":{image:"Barracks.jpg",summary:'A barrack or barracks is a building or group of buildings built to house soldiers. The English word comes via French from an old Catalan word "barraca" (hut), originally referring to temporary shelters or huts for various people and animals, but today barracks are usually permanent buildings for military accommodation. The word may apply to separate housing blocks or to complete complexes, and the plural form often refers to a single structure and may be singular in construction.\nThe main object of barracks is to separate soldiers from the civilian population and reinforce discipline, training, and esprit de corps. They have been called "discipline factories for soldiers". Like industrial factories, some are considered to be shoddy or dull buildings, although others are known for their magnificent architecture such as Collins Barracks in Dublin and others in Paris, Berlin, Madrid, Vienna, or London. From the rough barracks of 19th-century conscript armies, filled with hazing and illness and barely differentiated from the livestock pens that housed the draft animals, to the clean and Internet-connected barracks of modern all-volunteer militaries, the word can have a variety of connotations.',title:"Barracks"},Battleship:{image:"Battleship.jpg",summary:'A battleship is a large armored warship with a main battery consisting of large caliber guns. During the late 19th and early 20th centuries the battleship was the most powerful type of warship, and a fleet of battleships was considered vital for any nation that desired to maintain command of the sea.\nThe word battleship was coined around 1794 and is a contraction of the phrase line-of-battle ship, the dominant wooden warship during the Age of Sail. The term came into formal use in the late 1880s to describe a type of ironclad warship, now referred to by historians as pre-dreadnought battleships. In 1906, the commissioning of HMS Dreadnought heralded a revolution in battleship design. Subsequent battleship designs, influenced by HMS Dreadnought, were referred to as "dreadnoughts".\nBattleships were a symbol of naval dominance and national might, and for decades the battleship was a major factor in both diplomacy and military strategy. A global arms race in battleship construction began in Europe in the 1890s and culminated at the decisive Battle of Tsushima in 1905; the outcome of which significantly influenced the design of HMS Dreadnought. The launch of Dreadnought in 1906 commenced a new naval arms race. Three major fleet actions between steel battleships took place: the decisive battles of the Yellow Sea (1904) and Tsushima (1905) during the Russo-Japanese War, and the inconclusive Battle of Jutland (1916) during the First World War. Jutland was the largest naval battle and the only full-scale clash of battleships in the war, and it was the last major battle fought primarily by battleships in world history.\nThe Naval Treaties of the 1920s and 1930s limited the number of battleships, though technical innovation in battleship design continued. Both the Allied and Axis powers built battleships during World War II, though the increasing importance of the aircraft carrier meant that the battleship played a less important role than had been expected.\nThe value of the battleship has been questioned, even during their heyday. There were few of the decisive fleet battles that battleship proponents expected, and used to justify the vast resources spent on building battlefleets. Even in spite of their huge firepower and protection, battleships were increasingly vulnerable to much smaller, cheaper weapons: initially the torpedo and the naval mine, and later aircraft and the guided missile. The growing range of naval engagements led to the aircraft carrier replacing the battleship as the leading capital ship during World War II, with the last battleship to be launched being HMS Vanguard in 1944. Battleships were retained by the United States Navy into the Cold War for fire support purposes before being stricken from the U.S. Naval Vessel Register in the 2000s.\n\n',title:"Battleship"},Bomber:{image:"Bomber.jpg",summary:"A bomber is a combat aircraft designed to attack ground and naval targets by dropping air-to-ground weaponry (such as bombs), firing torpedoes and bullets or deploying air-launched cruise missiles.\n\n",title:"Bomber"},"Bridge Building":{image:"Bridge.jpg",summary:"A bridge is a structure built to span physical obstacles without closing the way underneath such as a body of water, valley, or road, for the purpose of providing passage over the obstacle. There are many different designs that each serve a particular purpose and apply to different situations. Designs of bridges vary depending on the function of the bridge, the nature of the terrain where the bridge is constructed and anchored, the material used to make it, and the funds available to build it.",title:"Bridge"},"Bronze Working":{image:"Bronze Age.jpg",summary:"The Bronze Age is a historical period characterized by the use of bronze, proto-writing, and other early features of urban civilization. The Bronze Age is the second principal period of the three-age Stone-Bronze-Iron system, as proposed in modern times by Christian Jürgensen Thomsen, for classifying and studying ancient societies.\nAn ancient civilization is defined to be in the Bronze Age either by producing bronze by smelting its own copper and alloying with tin, arsenic, or other metals, or by trading for bronze from production areas elsewhere. Bronze itself is harder and more durable than other metals available at the time, allowing Bronze Age civilizations to gain a technological advantage.\nCopper-tin ores are rare, as reflected in the fact that there were no tin bronzes in Western Asia before trading in bronze began in the 3rd millennium BC. Worldwide, the Bronze Age generally followed the Neolithic period, with the Chalcolithic serving as a transition. Although the Iron Age generally followed the Bronze Age, in some areas (such as Sub-Saharan Africa), the Iron Age intruded directly on the Neolithic.\nBronze Age cultures differed in their development of the first writing. According to archaeological evidence, cultures in Mesopotamia (cuneiform script) and Egypt (hieroglyphs) developed the earliest viable writing systems.",title:"Bronze Age"},Cannon:{image:"Cannon.jpg",summary:'A cannon (plural: cannon or cannons) is a type of gun classified as artillery that launches a projectile using propellant. In the past, gunpowder was the primary propellant before the invention of smokeless powder in the 19th century. Cannon vary in caliber, range, mobility, rate of fire, angle of fire, and firepower; different forms of cannon combine and balance these attributes in varying degrees, depending on their intended use on the battlefield. The word cannon is derived from several languages, in which the original definition can usually be translated as tube, cane, or reed. In the modern era, the term cannon has fallen into decline, replaced by "guns" or "artillery" if not a more specific term such as "gun", "mortar" or "howitzer", except for in the field of aerial warfare, where it is often used as shorthand for autocannon.\nThe earliest known depiction of cannon appeared in Song dynasty China as early as the 12th century, however solid archaeological and documentary evidence of cannon do not appear until the 13th century. In 1288 Yuan dynasty troops are recorded to have used hand cannons in combat, and the earliest extant cannon bearing a date of production comes from the same period. Evidence of cannon next appeared in Europe. By 1326 depictions of cannon had also appeared in Europe and almost immediately recorded usage of cannon began appearing. By the end of the 14th century cannon were widespread throughout Eurasia. Cannon were used primarily as anti-infantry weapons until around 1374 when cannon were recorded to have breached walls for the first time in Europe. Cannon featured prominently as siege weapons and ever larger pieces appeared. In 1464 a 16,000 kg cannon known as the Great Turkish Bombard was created in the Ottoman Empire. Cannon as field artillery became more important after 1453 with the introduction of limber, which greatly improved cannon maneuverability and mobility. European cannon reached their longer, lighter, more accurate, and more efficient "classic form" around 1480. This classic European cannon design stayed relatively consistent in form with minor changes until the 1750s.',title:"Cannon"},Caravan:{image:"Camel train.jpg",summary:"A camel train or caravan is a series of camels carrying passengers and/or goods on a regular or semi-regular service between points. Although they rarely travelled faster than the walking speed of a man, camels' ability to withstand harsh conditions made them ideal for communication and trade in the desert areas of North Africa and the Arabian Peninsula for centuries, though they could only travel on routes with sufficient sources of food and water. Camel trains were also used sparingly elsewhere around the globe but during the 20th century they have been largely replaced by motorized vehicles or air traffic.\n\n",title:"Camel train"},Caravel:{image:"Caravel.jpg",summary:"A caravel (Portuguese: caravela, IPA: [kɐɾɐˈvɛlɐ]) is a small, highly maneuverable sailing ship developed in the 15th century by the Portuguese to explore along the West African coast and into the Atlantic Ocean. The lateen sails gave it speed and the capacity for sailing windward (beating). Caravels were used by the Portuguese for the oceanic exploration voyages during the 15th and 16th centuries in the Age of Discovery. Prince Henry, Vasco da Gama, Christopher Columbus, and Bartolomeu Dias all used caravels.",title:"Caravel"},Carrier:{image:"Aircraft carrier.jpg",summary:'An aircraft carrier is a warship that serves as a seagoing airbase, equipped with a full-length flight deck and facilities for carrying, arming, deploying, and recovering aircraft. Typically, it is the capital ship of a fleet, as it allows a naval force to project air power worldwide without depending on local bases for staging aircraft operations. Aircraft carriers are expensive to build and are critical assets. Carriers have evolved since their inception in the early twentieth century from wooden vessels used to deploy balloons to nuclear-powered warships that carry numerous fighter planes, strike aircraft, helicopters, and other types of aircraft. While it is possible to launch heavier aircraft such as fixed-wing gunships and bombers (it has been done) from aircraft carriers, it is virtually impossible to land them.\nThere is no single definition of an "aircraft carrier," and modern navies use several variants of the type. These variants are sometimes categorized as sub-types of aircraft carriers, and sometimes as distinct types of naval aviation-capable ships. Aircraft carriers may be classified according to the type of aircraft they carry and their operational assignments. Admiral Sir Mark Stanhope, RN; former First Sea Lord (head) of the British Royal Navy, has said, "To put it simply, countries that aspire to strategic international influence have aircraft carriers".\nAs of November 2017, there are 41 active aircraft carriers in the world operated by thirteen navies. The United States Navy has 11 large nuclear-powered fleet carriers (known as supercarriers, carrying up to around 80 fighter jets each), the largest carriers in the world; the total combined deckspace is over twice that of all other nations combined. As well as the fleet carrier / supercarrier fleet, the U.S. Navy has nine amphibious assault ships used primarily for helicopters, although these also carry up to 20 vertical or short take-off and landing (V/STOL) fighter jets and are similar in size to medium-sized fleet carriers. China, France, India and Russia each operate a single medium-size carrier, with capacity from 30 to 50 fighter jets. Italy operates two light fleet carriers and Spain operates one. Helicopter carriers are operated by Australia (2), Egypt (2), France (3), Japan (4), South Korea (1), Thailand (1) and the United Kingdom (1). The United Kingdom has a 280 m (920 ft) supercarrier, HMS Queen Elizabeth, undergoing sea trials, scheduled to enter active service in late 2017. Future supercarriers are under construction or in planning by China, India, Russia, the US, and the UK.',title:"Aircraft carrier"},Catapult:{image:"Catapult.jpg",summary:"A catapult is a ballistic device used to launch a projectile a great distance without the aid of explosive devices—particularly various types of ancient and medieval siege engines. In use since ancient times, the catapult has proven to be one of the most effective mechanisms during warfare. In modern times the term can apply to devices ranging from a simple hand-held implement (also called a “slingshot”) to a mechanism for launching aircraft from a ship.",title:"Catapult"},Cathedral:{image:"Cathedral.jpg",summary:'A cathedral is a Christian church which contains the seat of a bishop, thus serving as the central church of a diocese, conference, or episcopate. The counterpart term for such a church in German is Dom from Latin domus ecclesiae or domus episcopalis; also Italian Duomo, Dutch Domkerk and cognates in many other European languages. Churches with the function of "cathedral" are usually specific to those Christian denominations with an episcopal hierarchy, such as the Roman Catholic, Anglican, Orthodox, and some Lutheran and Methodist churches. Church buildings embodying the functions of a cathedral first appear in Italy, Gaul, Spain and North Africa in the 4th century, but cathedrals did not become universal within the Western Catholic Church until the 12th century, by which time they had developed architectural forms, institutional structures and legal identities distinct from parish churches, monastic churches and episcopal residences.\nIn respect of the church buildings in the Eastern Orthodox Church, the English word "cathedral" commonly translates katholikon (sobor in Slavic languages), meaning of "assembly"; but this title is also applied to monastic and other major churches without episcopal responsibilities. When the church at which an archbishop or "metropolitan" presides is specifically intended, the term kathedrikós naós (literally: "cathedral temple") is used.\nFollowing the Protestant Reformation, the Christian church in several parts of Western Europe, such as Scotland, the Netherlands, certain Swiss Cantons and parts of Germany, adopted a Presbyterian polity that did away with bishops altogether. Where ancient cathedral buildings in these lands are still in use for congregational worship, they generally retain the title and dignity of "cathedral", maintaining and developing distinct cathedral functions, but void of hierarchical supremacy. From the 16th century onwards, but especially since the 19th century, churches originating in Western Europe have undertaken vigorous programmes of missionary activity, leading to the founding of large numbers of new dioceses with associated cathedral establishments of varying forms in Asia, Africa, Australasia, Oceania and the Americas. In addition, both the Catholic Church and Orthodox churches have formed new dioceses within formerly Protestant lands for converts and migrant co-religionists. Consequently, it is not uncommon to find Christians in a single city being served by three or more cathedrals of differing denominations.\nIn the Catholic tradition, the term "cathedral" correctly applies only to a church that houses the seat of the bishop of a diocese. The abbey church of a territorial abbacy serves the same function (that is, houses the seat of the abbot), but does not acquire the title. In any other jurisdiction canonically equivalent to a diocese but not canonically erected as such (prelature, vicariate, ordinariate, prefecture, apostolic administration), the church which serves this function is correctly called the "principal church" of the respective entity—though some have coopted the term "cathedral" anyway. The Catholic Church also uses the following terms.\nA pro-cathedral is a parish or other church used temporarily as a cathedral, usually while the cathedral of a diocese is under construction, renovation, or repair. This designation applies only as long as the temporary use continues.\nA co-cathedral is a second cathedral in a diocese that has two sees. This situation can arise in various ways such as a merger of two former dioceses, preparation to split a diocese, or perceived need to perform cathedral functions in a second location due to the expanse of the diocesan territory.\nA proto-cathedral is the former cathedral of a transferred see.\nThe cathedral church of a metropolitan bishop is called the metropolitan cathedral.\nThe term "cathedral" actually carries no implication as to the size or ornateness of the building. Nevertheless, most cathedrals are particularly impressive edifices. Thus, the term "cathedral" is often applied colloquially to any large and impressive church, regardless of whether it functions as a cathedral, such as the Crystal Cathedral in California or the Arctic Cathedral in Tromsø, Norway. Although the builders of Crystal Cathedral never intended the building to be a true cathedral, the Roman Catholic Diocese of Orange purchased the building and the surrounding campus in February 2012 for use as a new cathedral church. The building is now under renovation and restoration for solemn dedication under the title "Christ Cathedral" in 2018.',title:"Cathedral"},Cavalry:{image:"Cavalry.jpg",summary:'Cavalry (from French cavalerie, cf. cheval \'horse\') or horsemen were soldiers or warriors who fought mounted on horseback. Cavalry were historically the most mobile of the combat arms. An individual soldier in the cavalry is known by a number of designations such as cavalryman, horseman, dragoon or trooper. The designation of cavalry was not usually given to any military forces that used other animals, such as camels, mules or elephants. Infantry who moved on horseback, but dismounted to fight on foot, were known in the 17th and early 18th centuries as dragoons, a class of mounted infantry which later evolved into cavalry proper while retaining their historic title.\nCavalry had the advantage of improved mobility, and a man fighting from horseback also had the advantages of greater height, speed, and inertial mass over an opponent on foot. Another element of horse mounted warfare is the psychological impact a mounted soldier can inflict on an opponent.\nThe speed, mobility and shock value of the cavalry was greatly appreciated and exploited in armed forces in the Ancient and Middle Ages; some forces were mostly cavalry, particularly in nomadic societies of Asia, notably the Mongol armies. In Europe cavalry became increasingly armoured (heavy), and eventually became known for the mounted knights. During the 17th century cavalry in Europe lost most of its armor, ineffective against the muskets and cannon which were coming into use, and by the mid-19th century armor had mainly fallen into disuse, although some regiments retained a small thickened cuirass that offered protection against lances and sabres and some protection against shot.\nIn the period between the World Wars, many cavalry units were converted into motorized infantry and mechanized infantry units, or reformed as tank troops. However, some cavalry still served during World War II, notably in the Red Army, the Mongolian People\'s Army, the Royal Italian Army, the Romanian Army, the Polish Land Forces, and light reconnaissance units within the Waffen SS. Most cavalry units that are horse-mounted in modern armies serve in purely ceremonial roles, or as mounted infantry in difficult terrain such as mountains or heavily forested areas. Modern usage of the term generally refers to specialist units equipped with tanks ("armored cavalry") or aircraft ("air cavalry").',title:"Cavalry"},"Ceremonial Burial":{image:"Burial.jpg",summary:'Burial or interment is the ritual act of placing a dead person or animal, sometimes with objects, into the ground. This is accomplished by excavating a pit or trench, placing the deceased and objects in it, and covering it over. Humans have been burying their dead for at least 100,000 years. Burial is often seen as indicating respect for the dead. It has been used to prevent the odor of decay, to give family members closure and prevent them from witnessing the decomposition of their loved ones, and in many cultures it has been seen as a necessary step for the deceased to enter the afterlife or to give back to the cycle of life.\nMethods of burial may be heavily ritualized and can include natural burial (sometimes called "green burial"); embalming or mummification; the use of containers for the dead such as shrouds, caskets, grave liners, and burial vaults all of which can retard decomposition of the body. Sometimes objects or grave goods are buried with the body, which may be dressed in fancy or ceremonial garb. Depending on the culture, the way the body is positioned may have great significance.\nThe location of the burial may be determined taking into account concerns surrounding health and sanitation, religious concerns, and cultural practices. Some cultures keep the dead close to provide guidance to the living, while others "banish" them by locating burial grounds at a distance from inhabited areas. Some religions consecrate special ground to bury the dead, and some families build private family cemeteries. Most modern cultures document the location of graves with headstones, which may be inscribed with information and tributes to the deceased. However, some people are buried in anonymous or secret graves for various reasons. Sometimes multiple bodies are buried in a single grave either by choice (as in the case of married couples), due to space concerns, or in the case of mass graves as a way to deal with many bodies at once.\nAlternatives to burial may include cremation, burial at sea, promession, cryopreservation, and others. Some human cultures may bury the remains of beloved animals. Humans are not the only species which bury their dead; the practice has been observed in chimpanzees, elephants, and possibly dogs.',title:"Burial"},Chariot:{image:"Chariot.jpg",summary:'A chariot is a type of carriage driven by a charioteer using primarily horses to provide rapid motive power. Chariots were used by armies as transport or mobile archery platforms, for hunting or for racing, and as a conveniently fast way to travel for many ancient people.\nThe word "chariot" comes from the Latin carrus, itself a loanword from Gaulish. A chariot of war or one used in military parades was called a car. In ancient Rome and some other ancient Mediterranean civilizations, a biga required two horses, a triga three, and a quadriga four.\nThe horse chariot was a fast, light, open, two-wheeled conveyance drawn by two or more horses that were hitched side by side, and was little more than a floor with a waist-high guard at the front and sides. It was initially used for ancient warfare during the Bronze and Iron Ages; but, after its military capabilities had been superseded by cavalry, as horses were gradually bred to be bigger, the chariot was used for travel, in processions, for games, and in races.\nThe critical invention that allowed the construction of light, horse-drawn chariots was the spoked wheel. The earliest spoke-wheeled chariots date to ca. 2000 BC. The use of chariots peaked around 1300 BC (see Battle of Kadesh). Chariots had lost their military importance by the 1st century AD, but chariot races continued to be popular in Constantinople until the 6th century.',title:"Chariot"},Chemistry:{image:"Chemistry.jpg",summary:"Chemistry is the scientific discipline involved with compounds composed of atoms, i.e. elements, and molecules, i.e. combinations of atoms: their composition, structure, properties, behavior and the changes they undergo during a reaction with other compounds. Chemistry addresses topics such as how atoms and molecules interact via chemical bonds to form new chemical compounds. There are four types of chemical bonds: covalent bonds, in which compounds share one or more electron(s); ionic bonds, in which a compound donates one or more electrons to another compound to produce ions: cations and anions; hydrogen bonds; and Van der Waals force bonds.\nChemistry occupies an intermediate position in a hierarchy of the sciences by reductive level between physics and biology. It is sometimes called the central science because it provides a foundation for understanding both basic and applied scientific disciplines at a fundamental level. Examples include plant chemistry (botany), the formation of igneous rocks (geology), how atmospheric ozone is formed and how environmental pollutants are degraded (ecology), the properties of the soil on the moon (astrophysics), how medications work (pharmacology), and how to collect DNA evidence at a crime scene (forensics).\nThe history of chemistry represents a time span from ancient history to the present. By 1000 BC, civilizations used technologies that would eventually form the basis of the various branches of chemistry. Examples include extracting metals from ores, making pottery and glazes, fermenting beer and wine, extracting chemicals from plants for medicine and perfume, rendering fat into soap, making glass, and making alloys like bronze. The protoscience of chemistry, alchemy, was unsuccessful in explaining the nature of matter and its transformations. However, by performing experiments and recording the results, alchemists set the stage for modern chemistry. The distinction began to emerge when a clear differentiation was made between chemistry and alchemy by Robert Boyle in his work The Sceptical Chymist (1661). While both alchemy and chemistry are concerned with matter and its transformations, chemists are seen as applying scientific method to their work. Chemistry is considered to have become an established science with the work of Antoine Lavoisier, who developed a law of conservation of mass that demanded careful measurement and quantitative observations of chemical phenomena. The history of chemistry is intertwined with the history of thermodynamics, especially through the work of Willard Gibbs. Chemistry was preceded by its protoscience, alchemy, which is an intuitive but non-scientific approach to understanding the elements, compounds, and their interactions. It was unsuccessful in explaining the nature of matter and its transformations, but by performing experiments and recording the results, alchemists set the stage for modern chemistry. The distinction began to emerge when a clear differentiation between alchemy and chemistry was made by Robert Boyle in 1661: the application of the scientific method in chemistry was the crucial difference.",title:"Chemistry"},Chivalry:{image:"Chivalry.jpg",summary:'Chivalry, or the chivalric code, is an informal, varying code of conduct developed between 1170 and 1220, never decided on or summarized in a single document, associated with the medieval institution of knighthood; knights’ and gentlewomen\'s behaviors were governed by chivalrous social codes. The ideals of chivalry were popularized in medieval literature, especially the Matter of Britain and Matter of France, the former based on Geoffrey of Monmouth\'s Historia Regum Britanniae which introduced the legend of King Arthur, written in the 1130s.\nThe code of chivalry that developed in medieval Europe had its roots in earlier centuries. It arose in the Holy Roman Empire from the idealisation of the cavalryman—involving military bravery, individual training, and service to others—especially in Francia, among horse soldiers in Charlemagne\'s cavalry. The term "chivalry" derives from the Old French term chevalerie, which can be translated to "horse soldiery". Gautier states that knighthood emerged from the Moors (Muslims) as well as the Teutonic forests and was nurtured into civilisation and chivalry by the Catholic Church.\nOver time, its meaning in Europe has been refined to emphasise social and moral virtues more generally. The code of chivalry, as it stood by the Late Middle Ages, was a moral system which combined a warrior ethos, knightly piety, and courtly manners, all conspiring to establish a notion of honour and nobility.',title:"Chivalry"},"City Walls":{image:"Defensive wall.jpg",summary:"A defensive wall is a fortification usually used to protect a city, town or other settlement from potential aggressors. In ancient to modern times, they were used to enclose settlements. Generally, these are referred to as city walls or town walls, although there were also walls, such as the Great Wall of China, Walls of Benin, Hadrian's Wall, Anastasian Wall, the Cyclopean Wall Rajgir and the metaphorical Atlantic Wall, which extended far beyond the borders of a city and were used to enclose regions or mark territorial boundaries. In mountainous terrain, defensive walls such as letzis were used in combination with castles to seal valleys from potential attack. Beyond their defensive utility, many walls also had important symbolic functions –  representing the status and independence of the communities they embraced.\nExisting ancient walls are almost always masonry structures, although brick and timber-built variants are also known. Depending on the topography of the area surrounding the city or the settlement the wall is intended to protect, elements of the terrain such as rivers or coastlines may be incorporated in order to make the wall more effective.\nWalls may only be crossed by entering the appropriate city gate and are often supplemented with towers. The practice of building these massive walls, though having its origins in prehistory, was refined during the rise of city-states, and energetic wall-building continued into the medieval period and beyond in certain parts of Europe.\nSimpler defensive walls of earth or stone, thrown up around hillforts, ringworks, early castles and the like, tend to be referred to as ramparts or banks.\n\n",title:"Defensive wall"},"Coastal Defense":{image:"Coastal defence and fortification.jpg",summary:"Coastal defence (or defense) and coastal fortification are measures taken to provide protection against military attack at or near a coastline (or other shoreline), for example, fortification and coastal artillery. Because an invading enemy normally requires a port or harbour to sustain operations, such defences are usually concentrated around such facilities, or places where such facilities could be constructed.\nIn littoral warfare, coastal defence counteracts naval offence, such as naval artillery, naval infantry (marines), or both.",title:"Coastal defence and fortification"},"Code of Laws":{image:"Code of law.jpg",summary:"A code of law, also called a law code or legal code, is a type of legislation that purports to exhaustively cover a complete system of laws or a particular area of law as it existed at the time the code was enacted, by a process of codification. Though the process and motivations for codification are similar in different common law and civil law systems, their usage is different.\nIn a civil law country, a code of law typically exhaustively covers the complete system of law, such as civil law or criminal law. By contrast, in a common law country with legislative practices in the English tradition, a code of law is a less common form of legislation, which differs from usual legislation that, when enacted, modify the existing common law only to the extent of its express or implicit provision, but otherwise leaves the common law intact. A code entirely replaces the common law in a particular area, leaving the common law inoperative unless and until the code is repealed. In a third case of slightly different usage, in the United States and other common law countries that have adopted similar legislative practices, a code of law is a standing body of statute law on a particular area, which is added to, subtracted from, or otherwise modified by individual legislative enactments.",title:"Code of law"},Coinage:{image:"Coining (mint).jpg",summary:'In minting, coining or coinage is the process of manufacturing coins using a kind of stamping which is now generically known in metalworking as "coining". This process is different from cast coinage, and can be classified in hammered coinage or hammering and milled coinage or milling.\nA coin die is one of the two metallic pieces that are used to strike a coin, one per each side of the coin. A die contains an inverse version of the image to be struck on the coin. Striking a coin refers to pressing an image into the blank metal disc, or planchet, and is a term descended from the days when the dies were struck with hammers to deform the metal into the image of the dies.\nModern dies made out of hardened steel are capable of producing many hundreds of thousands of coins before they are retired and defaced.\n\n',title:"Coining (mint)"},Colosseum:{image:"Colosseum.jpg",summary:"The Colosseum or Coliseum ( kol-ə-SEE-əm), also known as the Flavian Amphitheatre (Latin: Amphitheatrum Flavium; Italian: Anfiteatro Flavio [aŋfiteˈaːtro ˈflaːvjo] or Colosseo [kolosˈsɛːo]), is an oval amphitheatre in the centre of the city of Rome, Italy. Built of concrete and sand, it is the largest amphitheatre ever built. The Colosseum is situated just east of the Roman Forum. Construction began under the emperor Vespasian in AD 72, and was completed in AD 80 under his successor and heir Titus. Further modifications were made during the reign of Domitian (81–96). These three emperors are known as the Flavian dynasty, and the amphitheatre was named in Latin for its association with their family name (Flavius).\nThe Colosseum could hold, it is estimated, between 50,000 and 80,000 spectators, having an average audience of some 65,000; it was used for gladiatorial contests and public spectacles such as mock sea battles (for only a short time as the hypogeum was soon filled in with mechanisms to support the other activities), animal hunts, executions, re-enactments of famous battles, and dramas based on Classical mythology. The building ceased to be used for entertainment in the early medieval era. It was later reused for such purposes as housing, workshops, quarters for a religious order, a fortress, a quarry, and a Christian shrine.\nAlthough partially ruined because of damage caused by earthquakes and stone-robbers, the Colosseum is still an iconic symbol of Imperial Rome. It is one of Rome's most popular tourist attractions and also has links to the Roman Catholic Church, as each Good Friday the Pope leads a torchlit \"Way of the Cross\" procession that starts in the area around the Colosseum.\nThe Colosseum is also depicted on the Italian version of the five-cent euro coin.\n\nThe Colosseum's original Latin name was Amphitheatrum Flavium, often anglicized as Flavian Amphitheatre. The building was constructed by emperors of the Flavian dynasty, following the reign of Nero. This name is still used in modern English, but generally the structure is better known as the Colosseum. In antiquity, Romans may have referred to the Colosseum by the unofficial name Amphitheatrum Caesareum (with Caesareum an adjective pertaining to the title Caesar), but this name may have been strictly poetic as it was not exclusive to the Colosseum; Vespasian and Titus, builders of the Colosseum, also constructed an amphitheater of the same name in Puteoli (modern Pozzuoli).\nThe name Colosseum has long been believed to be derived from a colossal statue of Nero nearby (the statue of Nero was named after the Colossus of Rhodes). This statue was later remodeled by Nero's successors into the likeness of Helios (Sol) or Apollo, the sun god, by adding the appropriate solar crown. Nero's head was also replaced several times with the heads of succeeding emperors. Despite its pagan links, the statue remained standing well into the medieval era and was credited with magical powers. It came to be seen as an iconic symbol of the permanence of Rome.\nIn the 8th century, a famous epigram attributed to the Venerable Bede celebrated the symbolic significance of the statue in a prophecy that is variously quoted: Quamdiu stat Colisæus, stat et Roma; quando cadet colisæus, cadet et Roma; quando cadet Roma, cadet et mundus (\"as long as the Colossus stands, so shall Rome; when the Colossus falls, Rome shall fall; when Rome falls, so falls the world\"). This is often mistranslated to refer to the Colosseum rather than the Colossus (as in, for instance, Byron's poem Childe Harold's Pilgrimage). However, at the time that the Pseudo-Bede wrote, the masculine noun coliseus was applied to the statue rather than to what was still known as the Flavian amphitheatre.\nThe Colossus did eventually fall, possibly being pulled down to reuse its bronze. By the year 1000 the name \"Colosseum\" had been coined to refer to the amphitheatre. The statue itself was largely forgotten and only its base survives, situated between the Colosseum and the nearby Temple of Venus and Roma.\nThe name further evolved to Coliseum during the Middle Ages. In Italy, the amphitheatre is still known as il Colosseo, and other Romance languages have come to use similar forms such as Coloseumul (Romanian), le Colisée (French), el Coliseo (Spanish) and o Coliseu (Portuguese).",title:"Colosseum"},Colossus:{image:"Colossus of Rhodes.jpg",summary:"The Colossus of Rhodes  (Ancient Greek: ὁ Κολοσσὸς Ῥόδιος, translit. ho Kolossòs Rhódios) was a statue of the Greek titan-god of the sun Helios, erected in the city of Rhodes, on the Greek island of the same name, by Chares of Lindos in 280 BC. One of the Seven Wonders of the Ancient World, it was constructed to celebrate Rhodes' victory over the ruler of Cyprus, Antigonus I Monophthalmus, whose son unsuccessfully besieged Rhodes in 305 BC. According to most contemporary descriptions, the Colossus stood approximately 70 cubits, or 33 metres (108 feet) high—the approximate height of the modern Statue of Liberty from feet to crown—making it the tallest statue of the ancient world. It was destroyed during the earthquake of 226 BC, and never rebuilt.\nAs of 2015, there are tentative plans to build a new Colossus at Rhodes Harbour, although the actual location of the original remains in dispute.",title:"Colossus of Rhodes"},"Combined Arms":{image:"Combined arms.jpg",summary:'Combined arms is an approach to warfare which seeks to integrate different combat arms of a military to achieve mutually complementary effects (for example, using infantry and armor in an urban environment, where one supports the other, or both support each other). According to strategist William S. Lind, combined arms can be distinguished from the concept of "supporting arms" as follows:\n\nCombined arms hits the enemy with two or more arms simultaneously in such a manner that the actions he must take to defend himself from one make him more vulnerable to another. In contrast, supporting arms is hitting the enemy with two or more arms in sequence, or if simultaneously, then in such combination that the actions the enemy must take to defend himself from one also defends himself from the other(s).\n\nThough the lower-echelon units of a combined arms team may be of similar types, a balanced mixture of such units are combined into an effective higher-echelon unit, whether formally in a table of organization or informally in an ad hoc solution to a battlefield problem. For example, an armored division—the modern paragon of combined arms doctrine—consists of a mixture of infantry, tank, artillery, reconnaissance, and perhaps even helicopter units, all coordinated and directed by a unified command structure.\nAlso, most modern military units can, if the situation requires it, call on yet more branches of the military, such as fighter or bomber aircraft or naval forces, to support their operations. The mixing of arms is sometimes pushed down below the level where homogeneity ordinarily prevails, for example by temporarily attaching a tank company to an infantry battalion.',title:"Combined arms"},Combustion:{image:"Combustion.jpg",summary:"Combustion  or burning is a high-temperature exothermic redox chemical reaction between a fuel (the reductant) and an oxidant, usually atmospheric oxygen, that produces oxidized, often gaseous products, in a mixture termed as smoke. Combustion in a fire produces a flame, and the heat produced can make combustion self-sustaining. Combustion is often a complicated sequence of elementary radical reactions. Solid fuels, such as wood and coal, first undergo endothermic pyrolysis to produce gaseous fuels whose combustion then supplies the heat required to produce more of them. Combustion is often hot enough that light in the form of either glowing or a flame is produced. A simple example can be seen in the combustion of hydrogen and oxygen into water vapor, a reaction commonly used to fuel rocket engines. This reaction releases 242 kJ/mol of heat and reduces the enthalpy accordingly (at constant temperature and pressure):\n:2H\n2(g) + O\n2(g) → 2H\n2O(g)\nCombustion of an organic fuel in air is always exothermic because the double bond in O2 is much weaker than other double bonds or pairs of single bonds, and therefore the formation of the stronger bonds in the combustion products CO2 and H2O results in the release of energy. The bond energies in the fuel play only a minor role, since they are similar to those in the combustion products; e.g., the sum of the bond energies of CH4 is nearly the same as that of CO2. The heat of combustion is approximately -418 kJ per mole of O2 used up in the combustion reaction, and can be estimated from the elemental composition of the fuel.\nUncatalyzed combustion in air requires fairly high temperatures. Complete combustion is stoichiometric with respect to the fuel, where there is no remaining fuel, and ideally, no remaining oxidant. Thermodynamically, the chemical equilibrium of combustion in air is overwhelmingly on the side of the products. However, complete combustion is almost impossible to achieve, since the chemical equilibrium is not necessarily reached, or may contain unburnt products such as carbon monoxide, hydrogen and even carbon (soot or ash). Thus, the produced smoke is usually toxic and contains unburned or partially oxidized products. Any combustion at high temperatures in atmospheric air, which is 78 percent nitrogen, will also create small amounts of several nitrogen oxides, commonly referred to as NOx, since the combustion of nitrogen is thermodynamically favored at high, but not low temperatures. Since combustion is rarely clean, flue gas cleaning or catalytic converters may be required by law.\nFires occur naturally, ignited by lightning strikes or by volcanic products. Combustion (fire) was the first controlled chemical reaction discovered by humans, in the form of campfires and bonfires, and continues to be the main method to produce energy for humanity. Usually, the fuel is carbon, hydrocarbons or more complicated mixtures such as wood that contains partially oxidized hydrocarbons. The thermal energy produced from combustion of either fossil fuels such as coal or oil, or from renewable fuels such as firewood, is harvested for diverse uses such as cooking, production of electricity or industrial or domestic heating. Combustion is also currently the only reaction used to power rockets. Combustion is also used to destroy (incinerate) waste, both nonhazardous and hazardous.\nOxidants for combustion have high oxidation potential and include atmospheric or pure oxygen, chlorine, fluorine, chlorine trifluoride, nitrous oxide and nitric acid. For instance, hydrogen burns in chlorine to form hydrogen chloride with the liberation of heat and light characteristic of combustion. Although usually not catalyzed, combustion can be catalyzed by platinum or vanadium, as in the contact process.",title:"Combustion"},Communism:{image:"Communism.jpg",summary:'In political and social sciences, communism (from Latin communis, "common, universal") is the philosophical, social, political and economic ideology and movement whose ultimate goal is the establishment of the communist society, which is a socioeconomic order structured upon the common ownership of the means of production and the absence of social classes, money and the state.\nOpposed to liberalism, nationalism, capitalism, and populism, communism is usually placed on the far-left within the traditional left–right spectrum. Communism includes a variety of schools of thought, which broadly include Marxism, anarchism (anarchist communism) and the political ideologies grouped around both. All of these share the analysis that the current order of society stems from its economic system, capitalism; that in this system there are two major social classes: the working class—who must work to survive and who make up the majority within society—and the capitalist class—a minority who derives profit from employing the working class, through private ownership of the means of production—and that conflict between these two classes will trigger a revolution. The revolution will in turn establish social ownership of the means of production, which according to this analysis is the primary element in the transformation of society towards communism.\nCriticism of communism can be roughly divided into those concerning themselves with the practical aspects of 20th century communist states and those concerning themselves with communist principles and theory.\n\n',title:"Communism"},Computers:{image:"Computer.jpg",summary:"A computer is a device that can be instructed to carry out arbitrary sequences of arithmetic or logical operations automatically. The ability of computers to follow generalized sets of operations, called programs, enables them to perform an extremely wide range of tasks.\nSuch computers are used as control systems for a very wide variety of industrial and consumer devices. This includes simple special purpose devices like microwave ovens and remote controls, factory devices such as industrial robots and computer assisted design, but also in general purpose devices like personal computers and mobile devices such as smartphones. The Internet is run on computers and it connects millions of other computers.\nSince ancient times, simple manual devices like the abacus aided people in doing calculations. Early in the Industrial Revolution, some mechanical devices were built to automate long tedious tasks, such as guiding patterns for looms. More sophisticated electrical machines did specialized analog calculations in the early 20th century. The first digital electronic calculating machines were developed during World War II. The speed, power, and versatility of computers has increased continuously and dramatically since then.\nConventionally, a modern computer consists of at least one processing element, typically a central processing unit (CPU), and some form of memory. The processing element carries out arithmetic and logical operations, and a sequencing and control unit can change the order of operations in response to stored information. Peripheral devices include input devices (keyboards, mice, joystick, etc.), output devices (monitor screens, printers, etc.), and input/output devices that perform both functions (e.g., the 2000s-era touchscreen). Peripheral devices allow information to be retrieved from an external source and they enable the result of operations to be saved and retrieved.",title:"Computer"},Conscription:{image:"Conscription.jpg",summary:"Conscription, or drafting, is the compulsory enlistment of people in a national service, most often a military service. Conscription dates back to antiquity and continues in some countries to the present day under various names. The modern system of near-universal national conscription for young men dates to the French Revolution in the 1790s, where it became the basis of a very large and powerful military. Most European nations later copied the system in peacetime, so that men at a certain age would serve 1–8 years on active duty and then transfer to the reserve force.\nConscription is controversial for a range of reasons, including conscientious objection to military engagements on religious or philosophical grounds; political objection, for example to service for a disliked government or unpopular war; and ideological objection, for example, to a perceived violation of individual rights. Those conscripted may evade service, sometimes by leaving the country, and seeking asylum in another country. Some selection systems accommodate these attitudes by providing alternative service outside combat-operations roles or even outside the military, such as 'Siviilipalvelus' (alternative civil service) in Finland, Zivildienst (compulsory community service) in Austria and Switzerland. Most post-Soviet countries conscript soldiers not only for armed forces but also for paramilitary organizations which are dedicated to police-like domestic only service (Internal Troops) or non-combat rescue duties (Civil defence troops) – none of which is considered alternative to the military conscription.\nAs of the early 21st century, many states no longer conscript soldiers, relying instead upon professional militaries with volunteers enlisted to meet the demand for troops. The ability to rely on such an arrangement, however, presupposes some degree of predictability with regard to both war-fighting requirements and the scope of hostilities. Many states that have abolished conscription therefore still reserve the power to resume it during wartime or times of crisis. States involved in wars or interstate rivalries are most likely to implement conscription, whereas democracies are less likely than autocracies to implement conscription. Former British colonies are less likely to have conscription, as they are influenced by British anticonscription norms that can be traced back to the English Civil War.",title:"Conscription"},Construction:{image:"Construction.jpg",summary:"Construction is the process of constructing a building or infrastructure. Construction differs from manufacturing in that manufacturing typically involves mass production of similar items without a designated purchaser, while construction typically takes place on location for a known client. Construction as an industry comprises six to nine percent of the gross domestic product of developed countries. Construction starts with planning, design, and financing; and continues until the project is built and ready for use.\nLarge-scale construction requires collaboration across multiple disciplines. An architect normally manages the job, and a construction manager, design engineer, construction engineer or project manager supervises it. Those involved with the design and execution must consider zoning requirements, environmental impact of the job, scheduling, budgeting, construction-site safety, availability and transportation of building materials, logistics, inconvenience to the public caused by construction delays and bidding. Large construction projects are sometimes referred to as megaprojects.",title:"Construction"},"Copernicus' Observatory":{image:"Space telescope.jpg",summary:"A space telescope or space observatory is an instrument located in outer space to observe distant planets, galaxies and other astronomical objects. Space telescopes avoid many of the problems of ground-based observatories, such as light pollution and distortion of electromagnetic radiation (scintillation). In addition, ultraviolet frequencies, X-rays and gamma rays are blocked by the Earth's atmosphere, so they can only be observed from space.\nTheorized by Lyman Spitzer in 1946, the first operational space telescopes were the American Orbiting Astronomical Observatory OAO-2 launched in 1968 and the Soviet Orion 1 ultraviolet telescope aboard space station Salyut 1 in 1971.\nSpace telescopes are distinct from other imaging satellites pointed toward Earth for purposes of espionage, weather analysis and other types of information gathering.",title:"Space telescope"},Courthouse:{image:"Courthouse.jpg",summary:'A courthouse (sometimes spelled court house) is a building that is home to a local court of law and often the regional county government as well, although this is not the case in some larger cities. The term is common in North America. In most other English-speaking countries, buildings which house courts of law are simply called "courts" or "court buildings". In most of Continental Europe and former non-English-speaking European colonies, the equivalent term is a palace of justice (French: palais de justice, Italian: palazzo di giustizia, Portuguese: palácio da justiça).',title:"Courthouse"},"Cruise Missile":{image:"Cruise missile.jpg",summary:"A cruise missile is a guided missile used against terrestrial targets that remains in the atmosphere and flies the major portion of its flight path at approximately constant speed. Cruise missiles are designed to deliver a large warhead over long distances with high precision. Modern cruise missiles are capable of travelling at supersonic or high subsonic speeds, are self-navigating, and are able to fly on a non-ballistic, extremely low-altitude trajectory.",title:"Cruise missile"},Cruiser:{image:"Cruiser.jpg",summary:'A cruiser is a type of warship. The term has been in use for several hundred years, and has had different meanings throughout this period. During the Age of Sail, the term cruising referred to certain kinds of missions – independent scouting, commerce protection, or raiding – fulfilled by a frigate or sloop, which were the cruising warships of a fleet. Modern cruisers are generally the largest ships in a fleet after aircraft carriers, and can usually perform several roles.\nIn the middle of the 19th century, cruiser came to be a classification for the ships intended for cruising distant waters, commerce raiding, and scouting for the battle fleet. Cruisers came in a wide variety of sizes, from the medium-sized protected cruiser to large armored cruisers that were nearly as big (although not as powerful or as well-armored) as a pre-dreadnought battleship. With the advent of the dreadnought battleship before World War I, the armored cruiser evolved into a vessel of similar scale known as the battlecruiser. The very large battlecruisers of the World War I era that succeeded armored cruisers were now classified, along with dreadnought battleships, as capital ships.\nBy the early 20th century after World War I, the direct successors to protected cruisers could be placed on a consistent scale of warship size, smaller than a battleship but larger than a destroyer. In 1922, the Washington Naval Treaty placed a formal limit on these cruisers, which were defined as warships of up to 10,000 tons displacement carrying guns no larger than 8 inches in calibre; heavy cruisers had 8-inch guns, while those with guns of 6.1 inches or less were light cruisers, which shaped cruiser design until the end of World War II. Some variations on the Treaty cruiser design included the German Deutschland-class "pocket battleships" which had heavier armament at the expense of speed compared to standard heavy cruisers, and the US Alaska class, which was a scaled-up heavy cruiser design designated as a "cruiser-killer".\nIn the later 20th century, the obsolescence of the battleship left the cruiser as the largest and most powerful surface combatant after the aircraft carrier. The role of the cruiser varied according to ship and navy, often including air defense and shore bombardment. During the Cold War, the Soviet Navy\'s cruisers had heavy anti-ship missile armament designed to sink NATO carrier task forces via saturation attack. The U.S. Navy built guided-missile cruisers upon destroyer-style hulls (some called "destroyer leaders" or "frigates" prior to the 1975 reclassification) primarily designed to provide air defense while often adding anti-submarine capabilities, being larger and having longer-range surface-to-air missiles (SAMs) than early Charles F. Adams guided-missile destroyers tasked with the short-range air defense role. By the end of the Cold War, the line between cruisers and destroyers had blurred, with the Ticonderoga-class cruiser using the hull of the Spruance-class destroyer but receiving the cruiser designation due to their enhanced mission and combat systems. Indeed, the newest U.S. Navy destroyers (for instance the Arleigh Burke class and Zumwalt class) are more heavily armed than some of the cruisers that they succeeded.\nCurrently only two nations operate cruisers: the United States and Russia. (BAP Almirante Grau was still in service with the Peruvian Navy until 2017, and was the last gun cruiser currently in service in any navy.)',title:"Cruiser"},"Cure For Cancer":{image:"Cancer research.jpg",summary:"Cancer research is basic research into cancer to identify causes and develop strategies for prevention, diagnosis, treatment, and cure.\nCancer research ranges from epidemiology, molecular bioscience to the performance of clinical trials to evaluate and compare applications of the various cancer treatments. These applications include surgery, radiation therapy, chemotherapy, hormone therapy, immunotherapy and combined treatment modalities such as chemo-radiotherapy. Starting in the mid-1990s, the emphasis in clinical cancer research shifted towards therapies derived from biotechnology research, such as cancer immunotherapy and gene therapy.",title:"Cancer research"},Currency:{image:"Currency.jpg",summary:'A currency (from Middle English: curraunt, "in circulation", from Latin: currens, -entis), in the most specific use of the word, refers to money in any form when in actual use or circulation as a medium of exchange, especially circulating banknotes and coins. A more general definition is that a currency is a system of money (monetary units) in common use, especially in a nation. Under this definition, US dollars, British pounds, Australian dollars, and European euros are examples of currency. These various currencies are recognized stores of value and are traded between nations in foreign exchange markets, which determine the relative values of the different currencies. Currencies in this sense are defined by governments, and each type has limited boundaries of acceptance.\nOther definitions of the term "currency" are discussed in their respective synonymous articles banknote, coin, and money. The latter definition, pertaining to the currency systems of nations, is the topic of this article. Currencies can be classified into two monetary systems: fiat money and commodity money, depending on what guarantees the value (the economy at large vs. the government\'s physical metal reserves). Some currencies are legal tender in certain political jurisdictions, which means they cannot be refused as payment for debt. Others are simply traded for their economic value. Digital currency has arisen with the popularity of computers and the Internet.',title:"Currency"},"Darwin's Voyage":{image:"Second voyage of HMS Beagle.jpg",summary:"The second voyage of HMS Beagle, from 27 December 1831 to 2 October 1836, was the second survey expedition of HMS Beagle, under captain Robert FitzRoy who had taken over command of the ship on its first voyage after the previous captain committed suicide. FitzRoy had already thought of the advantages of having an expert in geology on board, and sought a gentleman naturalist to accompany them as a supernumerary. The young graduate Charles Darwin had hoped to see the tropics before becoming a parson, and accepted the opportunity. He was greatly influenced by reading Charles Lyell's Principles of Geology during the voyage. By the end of the expedition, Darwin had already made his name as a geologist and fossil collector, and the publication of his journal which became known as The Voyage of the Beagle gave him wide renown as a writer.\nThe Beagle sailed across the Atlantic Ocean, and then carried out detailed hydrographic surveys around the coasts of the southern part of South America, returning via Tahiti and Australia after having circumnavigated the Earth. While the expedition was originally planned to last two years, it lasted almost five.\nDarwin spent most of this time exploring on land: three years and three months on land, 18 months at sea. Early in the voyage he decided that he could write a book about geology, and he showed a gift for theorising. At Punta Alta he made a major find of gigantic fossils of extinct mammals, then known from only a very few specimens. He ably collected and made detailed observations of plants and animals, with results that shook his belief that species were fixed and provided the basis for ideas which came to him when back in England, and led to his theory of evolution by natural selection.",title:"Second voyage of HMS Beagle"},Democracy:{image:"Democracy.jpg",summary:'Democracy (Greek: δημοκρατία dēmokratía, literally "rule of the people"), in modern usage, is a system of government in which the citizens exercise power directly or elect representatives from among themselves to form a governing body, such as a parliament. Democracy is sometimes referred to as "rule of the majority". Democracy is a system of processing conflicts in which outcomes depend on what participants do, but no single force controls what occurs and its outcomes.\nThe uncertainty of outcomes is inherent in democracy, which makes all forces struggle repeatedly for the realization of their interests, being the devolution of power from a group of people to a set of rules. Western democracy, as distinct from that which existed in pre-modern societies, is generally considered to have originated in city states such as Classical Athens and the Roman Republic, where various schemes and degrees of enfranchisement of the free male population were observed before the form disappeared in the West at the beginning of late antiquity. The English word dates to the 16th century, from the older Middle French and Middle Latin equivalents.\nAccording to political scientist Larry Diamond, democracy consists of four key elements: (a) A political system for choosing and replacing the government through free and fair elections; (b) The active participation of the people, as citizens, in politics and civic life; (c) Protection of the human rights of all citizens, and (d) A rule of law, in which the laws and procedures apply equally to all citizens.\nThe term appeared in the 5th century BC, to denote the political systems then existing in Greek city-states, notably Athens, to mean "rule of the people", in contrast to aristocracy (ἀριστοκρατία, aristokratía), meaning "rule of an elite". While theoretically these definitions are in opposition, in practice the distinction has been blurred historically. The political system of Classical Athens, for example, granted democratic citizenship to free men and excluded slaves and women from political participation. In 1906, Finland became the first government to herald a more inclusive democracy at the national level. In virtually all democratic governments throughout ancient and modern history, democratic citizenship consisted of an elite class until full enfranchisement was won for all adult citizens in most modern democracies through the suffrage movements of the 19th and 20th centuries.\nDemocracy contrasts with forms of government where power is either held by an individual, as in an absolute monarchy, or where power is held by a small number of individuals, as in an oligarchy. Nevertheless, these oppositions, inherited from Greek philosophy, are now ambiguous because contemporary governments have mixed democratic, oligarchic, and monarchic elements. Karl Popper defined democracy in contrast to dictatorship or tyranny, thus focusing on opportunities for the people to control their leaders and to oust them without the need for a revolution.',title:"Democracy"},Despotism:{image:"Despotism.jpg",summary:"Despotism is a form of government in which a single entity rules with absolute power. Normally, that entity is an individual, the despot, as in an autocracy, but societies which limit respect and power to specific groups have also been called despotic.\nColloquially, the word despot applies pejoratively to those who abuse their power and authority to oppress their populace, subjects, or subordinates. More specifically, the term often applies to a head of state or government. In this sense, it is similar to the pejorative connotations that are associated with the terms tyrant and Dictator.",title:"Despotism"},Destroyer:{image:"Destroyer.jpg",summary:'In naval terminology, a destroyer is a fast, maneuverable long-endurance warship intended to escort larger vessels in a fleet, convoy or battle group and defend them against smaller powerful short-range attackers. They were originally developed in the late 19th century as a defence against torpedo boats, and by the time of the Russo-Japanese War in 1904, these "torpedo boat destroyers" (TBDs) were "large, swift, and powerfully armed torpedo boats designed to destroy other torpedo boats." Although the term "destroyer" had been used interchangeably with "TBD" and "torpedo boat destroyer" by navies since 1892, the term "torpedo boat destroyer" had been generally shortened to simply "destroyer" by nearly all navies by the First World War.\nBefore World War II, destroyers were light vessels with little endurance for unattended ocean operations; typically a number of destroyers and a single destroyer tender operated together. After the war, the advent of the guided missile allowed destroyers to take on the surface combatant roles previously filled by battleships and cruisers. This resulted in larger and more powerful guided missile destroyers more capable of independent operation.\nAt the start of the 21st century, destroyers are the global standard for surface combatant ships, with only two nations (United States and Russia) operating the heavier class cruisers, with no battleships or true battlecruisers remaining. Modern destroyers, also known as guided missile destroyers, are equivalent in tonnage but vastly superior in firepower to cruisers of the World War II era, and are capable of carrying nuclear tipped cruise missiles. At 510 feet (160 m) long, a displacement of 9200 tons, and with armament of more than 90 missiles, guided missile destroyers such as the Arleigh Burke class are actually larger and more heavily armed than most previous ships classified as guided missile cruisers.\nSome European navies such as the French, Spanish or German ones use the term "frigate" for their destroyers, which may lead to some confusion.',title:"Destroyer"},Diplomat:{image:"Diplomat.jpg",summary:"A diplomat is a person appointed by a state to conduct diplomacy with one or more other states or international organisations. The main functions of diplomats are: representation and protection of the interests and nationals of the sending state; initiation and facilitation of strategic agreements; treaties and conventions; promotion of information; trade and commerce; technology; and friendly relations. Seasoned diplomats of international repute are used in international organisations (e.g. United Nations) as well as multinational companies for their experience in management and negotiating skills. Diplomats are members of foreign services and diplomatic corps of various nations of the world.\nDiplomats are the oldest form of any of the foreign policy institutions of the state, predating by centuries foreign ministers and ministerial offices. They usually have diplomatic immunity.",title:"Diplomat"},Dragoons:{image:"Dragoon.jpg",summary:'Dragoons originally referred to a class of mounted infantry, who used horses for mobility but dismounted to fight on foot. From the early 18th century onward, dragoons were increasingly employed as conventional light or medium cavalry, trained for combat with swords from horseback.\nDragoon regiments were established in most European armies during the late 17th and early 18th centuries.\nThe name is derived from a type of firearm, called a "dragon", which was a handgun version of a blunderbuss, carried by dragoons of the French Army.\nThe title has been retained in modern times by a number of armoured or ceremonial mounted regiments.',title:"Dragoon"},Economics:{image:"Economics.jpg",summary:'Economics (UK English: , ; US English: , ) is "a social science concerned chiefly with description and analysis of the production, distribution, and consumption of goods and services".\nEconomics focuses on the behaviour and interactions of economic agents and how economies work. Microeconomics analyzes basic elements in the economy, including individual agents and markets, their interactions, and the outcomes of interactions. Individual agents may include, for example, households, firms, buyers, and sellers. Macroeconomics analyzes the entire economy (meaning aggregated production, consumption, savings, and investment) and issues affecting it, including unemployment of resources (labour, capital, and land), inflation, economic growth, and the public policies that address these issues (monetary, fiscal, and other policies).\nOther broad distinctions within economics include those between positive economics, describing "what is", and normative economics, advocating "what ought to be"; between economic theory and applied economics; between rational and behavioural economics; and between mainstream economics and heterodox economics.',title:"Economics"},"Eiffel Tower":{image:"Eiffel Tower.jpg",summary:"The Eiffel Tower ( EYE-fəl TOW-ər; French: tour Eiffel, pronounced [tuʁ‿ɛfɛl]  listen) is a wrought iron lattice tower on the Champ de Mars in Paris, France. It is named after the engineer Gustave Eiffel, whose company designed and built the tower.\nConstructed from 1887–89 as the entrance to the 1889 World's Fair, it was initially criticized by some of France's leading artists and intellectuals for its design, but it has become a global cultural icon of France and one of the most recognisable structures in the world. The Eiffel Tower is the most-visited paid monument in the world; 6.91 million people ascended it in 2015.\nThe tower is 324 metres (1,063 ft) tall, about the same height as an 81-storey building, and the tallest structure in Paris. Its base is square, measuring 125 metres (410 ft) on each side. During its construction, the Eiffel Tower surpassed the Washington Monument to become the tallest man-made structure in the world, a title it held for 41 years until the Chrysler Building in New York City was finished in 1930. Due to the addition of a broadcasting aerial at the top of the tower in 1957, it is now taller than the Chrysler Building by 5.2 metres (17 ft). Excluding transmitters, the Eiffel Tower is the second-tallest structure in France after the Millau Viaduct.\nThe tower has three levels for visitors, with restaurants on the first and second levels. The top level's upper platform is 276 m (906 ft) above the ground – the highest observation deck accessible to the public in the European Union. Tickets can be purchased to ascend by stairs or lift (elevator) to the first and second levels. The climb from ground level to the first level is over 300 steps, as is the climb from the first level to the second. Although there is a staircase to the top level, it is usually accessible only by lift.",title:"Eiffel Tower"},Electricity:{image:"Electricity.jpg",summary:"Electricity is the set of physical phenomena associated with the presence and motion of electric charge. Although initially considered a phenomenon separate from magnetism, since the development of Maxwell's equations, both are recognized as part of a single phenomenon: electromagnetism. Various common phenomena are related to electricity, including lightning, static electricity, electric heating, electric discharges and many others.\nThe presence of an electric charge, which can be either positive or negative, produces an electric field. On the other hand, the movement of electric charges, which is known as electric current, produces a magnetic field.\nWhen a charge is placed in a location with a non-zero electric field, a force will act on it. The magnitude of this force is given by Coulomb's law. Thus, if that charge were to move, the electric field would be doing work on the electric charge. Thus we can speak of electric potential at a certain point in space, which is equal to the work done by an external agent in carrying a unit of positive charge from an arbitrarily chosen reference point to that point without any acceleration and is typically measured in volts.\nElectricity is at the heart of many modern technologies, being used for:\nelectric power where electric current is used to energise equipment;\nelectronics which deals with electrical circuits that involve active electrical components such as vacuum tubes, transistors, diodes and integrated circuits, and associated passive interconnection technologies.\nElectrical phenomena have been studied since antiquity, though progress in theoretical understanding remained slow until the seventeenth and eighteenth centuries. Even then, practical applications for electricity were few, and it would not be until the late nineteenth century that electrical engineers were able to put it to industrial and residential use. The rapid expansion in electrical technology at this time transformed industry and society, becoming a driving force for the Second Industrial Revolution. Electricity's extraordinary versatility means it can be put to an almost limitless set of applications which include transport, heating, lighting, communications, and computation. Electrical power is now the backbone of modern industrial society.",title:"Electricity"},Electronics:{image:"Electronics.jpg",summary:'Electronics is the science of controlling electrical energy electrically, in which the electrons have a fundamental role. Electronics deals with electrical circuits that involve active electrical components (such as vacuum tubes, transistors, diodes, integrated circuits, optoelectronics, and sensors), associated passive electrical components, and interconnection technologies. Commonly, electronic devices contain circuitry consisting primarily or exclusively of active semiconductors supplemented with passive elements; such a circuit is described as an electronic circuit.\nThe science of electronics is considered to be a branch of physics and electrical engineering.\nThe nonlinear behaviour of active components and their ability to control electron flows makes amplification of weak signals possible. Electronics is widely used in information processing, telecommunication, and signal processing. The ability of electronic devices to act as switches makes digital information processing possible. Interconnection technologies such as circuit boards, electronics packaging technology, and other varied forms of communication infrastructure complete circuit functionality and transform the mixed components into a regular working system.\nElectronics is distinct from electrical and electro-mechanical science and technology, which deal with the generation, distribution, switching, storage, and conversion of electrical energy to and from other energy forms using wires, motors, generators, batteries, switches, relays, transformers, resistors, and other passive components. This distinction started around 1906 with the invention by Lee De Forest of the triode, which made electrical amplification of weak radio signals and audio signals possible with a non-mechanical device. Until 1950 this field was called "radio technology" because its principal application was the design and theory of radio transmitters, receivers, and vacuum tubes.\nToday, most electronic devices use semiconductor components to perform electron control. The study of semiconductor devices and related technology is considered a branch of solid-state physics, whereas the design and construction of electronic circuits to solve practical problems come under electronics engineering. This article focuses on engineering aspects of electronics.',title:"Electronics"},Engineering:{image:"Engineering.jpg",summary:'Engineering is the application of mathematics, science, economics, and social and practical knowledge to invent, innovate, design, build, maintain, research, and improve structures, machines, tools, systems, components, materials, processes, solutions, and organizations.\nThe discipline of engineering is extremely broad and encompasses a range of more specialized fields of engineering, each with a more specific emphasis on particular areas of applied science, technology and types of application.\nThe term engineering is derived from the Latin ingenium, meaning "cleverness" and ingeniare, meaning "to contrive, devise".',title:"Engineering"},Engineers:{image:"Engineer.jpg",summary:'Engineers are people who invent, design, analyse, build and test machines, systems, structures and materials to fulfil objectives and requirements while considering the limitations imposed by practicality, regulation, safety, and cost. The word engineer (Latin ingeniator) is derived from the Latin words ingeniare ("to contrive, devise") and ingenium ("cleverness"). The foundation education of an engineer is typically a 4-year bachelor\'s degree in an engineering discipline or in some countries, a master\'s degree in an engineering discipline plus 4–6 years of peer-reviewed professional practice culminating in a project report, thesis, or engineering board\'s examinations.\nThe work of engineers forms the link between scientific discoveries and their subsequent applications to human and business needs and quality of life.',title:"Engineer"},Environmentalism:{image:"Environmentalism.jpg",summary:"Environmentalism or environmental rights is a broad philosophy, ideology, and social movement regarding concerns for environmental protection and improvement of the health of the environment, particularly as the measure for this health seeks to incorporate the impact of changes to the environment on humans, animals, plants and non-living matter. While environmentalism focuses more on the environmental and nature-related aspects of green ideology and politics, ecologism combines the ideology of social ecology and environmentalism. Ecologism is more commonly used in continental European languages while ‘environmentalism’ is more commonly used in English but the words have slightly different connotations.\nEnvironmentalism advocates the lawful preservation, restoration and/or improvement of the natural environment, and may be referred to as a movement to control pollution or protect plant and animal diversity. For this reason, concepts such as a land ethic, environmental ethics, biodiversity, ecology, and the biophilia hypothesis figure predominantly.\nAt its crux, environmentalism is an attempt to balance relations between humans and the various natural systems on which they depend in such a way that all the components are accorded a proper degree of sustainability. The exact measures and outcomes of this balance is controversial and there are many different ways for environmental concerns to be expressed in practice. Environmentalism and environmental concerns are often represented by the color green, but this association has been appropriated by the marketing industries for the tactic known as greenwashing.\nEnvironmentalism is opposed by anti-environmentalism, which says that the Earth is less fragile than some environmentalists maintain, and portrays environmentalism as overreacting to the human contribution to climate change or opposing human advancement.",title:"Environmentalism"},Espionage:{image:"Espionage.jpg",summary:"Espionage (colloquially, spying) is the obtaining of secret or confidential information without the permission of the holder of the information. Spies help agencies uncover secret information. Any individual or spy ring (a cooperating group of spies), in the service of a government, company or independent operation, can commit espionage. The practice is clandestine, as it is by definition unwelcome and in many cases illegal and punishable by law. Espionage is a subset of \"intelligence\" gathering, which includes espionage as well as information gathering from public sources.\nEspionage is often part of an institutional effort by a government or commercial concern. However, the term tends to associate with state spying on potential or actual enemies for military purposes. Spying involving corporations is known as industrial espionage.\nOne of the most effective ways to gather data and information about the enemy (or potential enemy) is by infiltrating the enemy's ranks. This is the job of the spy (espionage agent). Spies can return all sorts of information concerning the size and strength of enemy forces. They can also find dissidents within the enemy's forces and influence them to defect. In times of crisis, spies can also oblige to steal technology and sabotage the enemy in various ways. Counterintelligence operatives can feed false information to enemy spies, protecting important domestic secrets, and preventing attempts at subversion. Almost all nations have strict laws concerning espionage and the penalty for being caught is often severe. However, the benefits through espionage are often great enough that most governments and many large corporations make use of it to varying degrees.\nFurther information on clandestine human intelligence and human intelligence information collection techniques is available, including discussions of operational techniques, asset recruiting, and the tradecraft used to collect this information.",title:"Espionage"},Explorer:{image:"Exploration.jpg",summary:"Exploration is the act of searching for the purpose of discovery of information or resources. Exploration occurs in all non-sessile animal species, including humans. In human history, its most dramatic rise was during the Age of Discovery when European explorers sailed and charted much of the rest of the world for a variety of reasons. Since then, major explorations after the Age of Discovery have occurred for reasons mostly aimed at information discovery.\nIn scientific research, exploration is one of three purposes of empirical research (the other two being description and explanation). The term is commonly used metaphorically. For example, an individual may speak of exploring the Internet, sexuality, etc.",title:"Exploration"},Explosives:{image:null,summary:'An explosive material, also called an explosive, is a reactive substance that contains a great amount of potential energy that can produce an explosion if released suddenly, usually accompanied by the production of light, heat, sound, and pressure. An explosive charge is a measured quantity of explosive material, which may be composed of a single ingredient or a combination of two or more.\nThe potential energy stored in an explosive material may, for example, be\nchemical energy, such as nitroglycerin or grain dust\npressurized gas, such as a gas cylinder or aerosol can\nnuclear energy, such as in the fissile isotopes uranium-235 and plutonium-239\nExplosive materials may be categorized by the speed at which they expand. Materials that detonate (the front of the chemical reaction moves faster through the material than the speed of sound) are said to be "high explosives" and materials that deflagrate are said to be "low explosives". Explosives may also be categorized by their sensitivity. Sensitive materials that can be initiated by a relatively small amount of heat or pressure are primary explosives and materials that are relatively insensitive are secondary or tertiary explosives.\nA wide variety of chemicals can explode; a smaller number are manufactured specifically for the purpose of being used as explosives. The remainder are too dangerous, sensitive, toxic, expensive, unstable, or prone to decomposition or degradation over short time spans.\nIn contrast, some materials are merely combustible or flammable if they burn without exploding.\nThe distinction, however, is not razor-sharp. Certain materials—dusts, powders, gasses, or volatile organic liquids—may be simply combustible or flammable under ordinary conditions, but become explosive in specific situations or forms, such as dispersed airborne clouds, or confinement or sudden release.',title:"Explosive material"},Factory:{image:"Factory.jpg",summary:'A factory (previously manufactory) or manufacturing plant is an industrial site, usually consisting of buildings and machinery, or more commonly a complex having several buildings, where workers manufacture goods or operate machines processing one product into another.\nFactories arose with the introduction of machinery during the Industrial Revolution when the capital and space requirements became too great for cottage industry or workshops. Early factories that contained small amounts of machinery, such as one or two spinning mules, and fewer than a dozen workers have been called "glorified workshops".\nMost modern factories have large warehouses or warehouse-like facilities that contain heavy equipment used for assembly line production. Large factories tend to be located with access to multiple modes of transportation, with some having rail, highway and water loading and unloading facilities.\nFactories may either make discrete products or some type of material continuously produced such as chemicals, pulp and paper, or refined oil products. Factories manufacturing chemicals are often called plants and may have most of their equipment – tanks, pressure vessels, chemical reactors, pumps and piping – outdoors and operated from control rooms. Oil refineries have most of their equipment outdoors.\nDiscrete products may be final consumer goods, or parts and sub-assemblies which are made into final products elsewhere. Factories may be supplied parts from elsewhere or make them from raw materials. Continuous production industries typically use heat or electricity to transform streams of raw materials into finished products.\nThe term mill originally referred to the milling of grain, which usually used natural resources such as water or wind power until those were displaced by steam power in the 19th century. Because many processes like spinning and weaving, iron rolling, and paper manufacturing were originally powered by water, the term survives as in steel mill, paper mill, etc.',title:"Factory"},Feudalism:{image:"Feudalism.jpg",summary:'Feudalism was a combination of legal and military customs in medieval Europe that flourished between the 9th and 15th centuries. Broadly defined, it was a way of structuring society around relationships derived from the holding of land in exchange for service or labour.\nAlthough derived from the Latin word feodum or feudum (fief), then in use, the term feudalism and the system it describes were not conceived of as a formal political system by the people living in the Middle Ages. In its classic definition, by François-Louis Ganshof (1944), feudalism describes a set of reciprocal legal and military obligations among the warrior nobility revolving around the three key concepts of lords, vassals and fiefs.\nA broader definition of feudalism, as described by Marc Bloch (1939), includes not only the obligations of the warrior nobility but also those of all three estates of the realm: the nobility, the clergy, and the peasantry bound by manorialism; this is sometimes referred to as a "feudal society". Since the publication of Elizabeth A. R. Brown\'s "The Tyranny of a Construct" (1974) and Susan Reynolds\'s Fiefs and Vassals (1994), there has been ongoing inconclusive discussion among medieval historians as to whether feudalism is a useful construct for understanding medieval society.',title:"Feudalism"},Fighter:{image:"Fighter aircraft.jpg",summary:"A fighter aircraft is a military aircraft designed primarily for air-to-air combat against other aircraft, as opposed to bombers and attack aircraft, whose main mission is to attack ground targets. The hallmarks of a fighter are its speed, maneuverability, and small size relative to other combat aircraft.\nMany fighters have secondary ground-attack capabilities, and some are designed as dual-purpose fighter-bombers; often aircraft that do not fulfill the standard definition are called fighters. This may be for political or national security reasons, for advertising purposes, or other reasons.\nA fighter's main purpose is to establish air superiority over a battlefield. Since World War I, achieving and maintaining air superiority has been considered essential for victory in conventional warfare. The success or failure of a belligerent's efforts to gain air supremacy hinges on several factors including the skill of its pilots, the tactical soundness of its doctrine for deploying its fighters, and the numbers and performance of those fighters. Because of the importance of air superiority, since the dawn of aerial combat armed forces have constantly competed to develop technologically superior fighters and to deploy these fighters in greater numbers, and fielding a viable fighter fleet consumes a substantial proportion of the defense budgets of modern armed forces.",title:"Fighter aircraft"},Flight:{image:"Flight.jpg",summary:"Flight is the process by which an object moves, through an atmosphere or beyond it, as in the case of spaceflight. This can be achieved by generating aerodynamic lift, propulsive thrust, aerostatically using buoyancy, or by ballistic movement.\nMany things fly, from natural aviators such as birds, bats and insects to human inventions such as missiles, aircraft such as airplanes, helicopters and balloons, to rockets such as spacecraft.\nThe engineering aspects of flight are the purview of aerospace engineering which is subdivided into aeronautics, the study of vehicles that travel through the air, and astronautics, the study of vehicles that travel through space, and in ballistics, the study of the flight of projectiles.",title:"Flight"},Freight:{image:"Cargo.jpg",summary:"In economics, cargo or freight are goods or produce being conveyed – generally for commercial gain – by water, air or land. Cargo was originally a shipload. Cargo now covers all types of freight, including that carried by train, van, truck, or intermodal container. The term cargo is also used in case of goods in the cold-chain, because the perishable inventory is always in transit towards a final end-use, even when it is held in cold storage or other similar climate-controlled facility.\nMulti-modal container units, designed as reusable carriers to facilitate unit load handling of the goods contained, are also referred to as cargo, specially by shipping lines and logistics operators. Similarly, aircraft ULD boxes are also documented as cargo, with associated packing list of the items contained within. When empty containers are shipped each unit is documented as a cargo and when goods are stored within, the contents are termed as containerised cargo.",title:"Cargo"},Frigate:{image:"Frigate.jpg",summary:'A frigate  is any of several types of warship, the term having been used for ships of various sizes and roles over the last few centuries.\nIn the 17th century, this term was used for any warship built for speed and maneuverability, the description often used being "frigate-built". These could be warships carrying their principal batteries of carriage-mounted guns on a single deck or on two decks (with further smaller carriage-mounted guns usually carried on the forecastle and quarterdeck of the vessel). The term was generally used for ships too small to stand in the line of battle, although early line-of-battle ships were frequently referred to as frigates when they were built for speed.\nIn the 18th century, the term referred to ships that were usually as long as a ship of the line and were square-rigged on all three masts (full rigged), but were faster and with lighter armament, used for patrolling and escort. In the definition adopted by the British Admiralty, they were rated ships of at least 28 guns, carrying their principal armaments upon a single continuous deck — the upper deck — while ships of the line possessed two or more continuous decks bearing batteries of guns.\nIn the late 19th century (beginning about 1858 with the construction of prototypes by the British and French navies), the armoured frigate was a type of ironclad warship that for a time was the most powerful type of vessel afloat. The term "frigate" was used because such ships still mounted their principal armaments on a single continuous upper deck.\nIn modern navies, frigates are used to protect other warships and merchant-marine ships, especially as anti-submarine warfare (ASW) combatants for amphibious expeditionary forces, underway replenishment groups, and merchant convoys. Ship classes dubbed "frigates" have also more closely resembled corvettes, destroyers, cruisers, and even battleships. Some European navies such as the French, German or Spanish ones use the term "frigate" for both their destroyers and frigates. The rank "frigate captain" derives from the name of this type of ship.',title:"Frigate"},"Fusion Power":{image:"Fusion power.jpg",summary:"Fusion power is a form of power generation in which energy is generated by using fusion reactions to produce heat for electricity generation. Fusion reactions fuse two lighter atomic nuclei to form a heavier nucleus, releasing energy. Devices designed to harness this energy are known as fusion reactors.\nThe fusion reaction normally takes place in a plasma of deuterium and tritium heated to millions of degrees. In stars, gravity contains these fuels. Outside of a star, the most researched way to confine the plasma at these temperatures is to use magnetic fields. The major challenge in realising fusion power is to engineer a system that can confine the plasma long enough at high enough temperature and density.\nAs a source of power, nuclear fusion has several theoretical advantages over fission. These advantages include reduced radioactivity in operation and as waste, ample fuel supplies, and increased safety. However, controlled fusion has proven to be extremely difficult to produce in a practical and economical manner. Research into fusion reactors began in the 1940s, but as of 2017, no design has produced more fusion energy than the energy needed to initiate the reaction, meaning all existing designs have a negative energy balance.\nOver the years, fusion researchers have investigated various confinement concepts. The early emphasis was on three main systems: z-pinch, stellarator and magnetic mirror. The current leading designs are the tokamak and inertial confinement (ICF) by laser. Both designs are being built at very large scales, most notably the ITER tokamak in France, and the National Ignition Facility laser in the USA. Researchers are also studying other designs that may offer cheaper approaches. Among these alternatives there is increasing interest in magnetized target fusion and inertial electrostatic confinement.",title:"Fusion power"},Galleon:{image:"Galleon.jpg",summary:"Galleons were large, multi-decked sailing ships used as armed cargo carriers primarily by European states from the 16th to 18th centuries during the age of sail and were the principal fleet units drafted for use as warships until the Anglo-Dutch Wars of the mid-1600s. Galleons generally carried three or more masts with a lateen fore-and-aft rig on the rear masts, were carvel built with a prominent squared off raised stern, and used square-rigged sail plans on their fore-mast and main-masts.\nSuch ships were the mainstay of maritime commerce into the early 19th century, and were often drafted into use as auxiliary naval war vessels—indeed, were the mainstay of contending fleets through most of the 150 years of the Age of Exploration — before the Anglo-Dutch wars begat purpose-built ship-rigged warships that thereafter dominated war at sea during the remainder of the Age of Sail.",title:"Galleon"},"Genetic Engineering":{image:"Genetic engineering.jpg",summary:'Genetic engineering, also called genetic modification, is the direct manipulation of an organism\'s genes using biotechnology. It is a set of technologies used to change the genetic makeup of cells, including the transfer of genes within and across species boundaries to produce improved or novel organisms. New DNA is obtained by either isolating and copying the genetic material of interest using molecular cloning methods or by artificially synthesizing the DNA. A construct is usually created and used to insert this DNA into the host organism. As well as inserting genes, the process can be used to remove, or "knock out", genes. The new DNA can be inserted randomly, or targeted to a specific part of the genome.\nAn organism that is generated through genetic engineering is considered to be genetically modified (GM) and the resulting entity is a genetically modified organism (GMO). The first GMOs were bacteria generated in 1973 and the first GM animals were mice in 1974. Insulin-producing bacteria were commercialized in 1982 and genetically modified food has been sold since 1994. GloFish, the first GMO designed as a pet, was sold in the United States in December 2003.\nGenetic engineering techniques have been applied in numerous fields including research, agriculture, industrial biotechnology, and medicine. Enzymes used in laundry detergent and medicines such as insulin and human growth hormone are now manufactured in GM cells, experimental GM cell lines and GM animals such as mice or zebrafish are being used for research purposes, and genetically modified crops have been commercialized.',title:"Genetic engineering"},Granary:{image:"Granary.jpg",summary:"A granary is a storehouse or room in a barn for threshed grain or animal feed. Ancient or primitive granaries are most often made out of pottery. Granaries are often built above the ground to keep the stored food away from mice and other animals.",title:"Granary"},"Great Library":{image:"Library of Alexandria.jpg",summary:'The Royal Library of Alexandria or Ancient Library of Alexandria in Alexandria, Egypt, was one of the largest and most significant libraries of the ancient world. It was dedicated to the Muses, the nine goddesses of the arts. It flourished under the patronage of the Ptolemaic dynasty and functioned as a major center of scholarship from its construction in the 3rd century BC until the Roman conquest of Egypt in 30 BC, with collections of works, lecture halls, meeting rooms, and gardens. The library was part of a larger research institution called the Musaeum of Alexandria, where many of the most famous thinkers of the ancient world studied.\nThe library was created by Ptolemy I Soter, who was a Macedonian general and the successor of Alexander the Great. Most of the books were kept as papyrus scrolls. It is unknown precisely how many such scrolls were housed at any given time, but estimates range from 40,000 to 400,000 at its height.\nArguably, this library is most famous for having been burned down resulting in the loss of many scrolls and books; its destruction has become a symbol for the loss of cultural knowledge. Sources differ on who was responsible for its destruction and when it occurred. The library may in truth have suffered several fires over many years. Possible occasions for the partial or complete destruction of the Library of Alexandria include a fire set by the army of Julius Caesar in 48 BC and an attack by Aurelian in the 270s AD.\nAfter the main library was destroyed, scholars used a "daughter library" in a temple known as the Serapeum of Alexandria, located in another part of the city. According to Socrates of Constantinople, Coptic Pope Theophilus destroyed the Serapeum in AD 391, although it is not certain what it contained or if it contained any significant fraction of the documents that were in the main library. The library may have finally been destroyed during (or after) the Muslim conquest of Egypt in AD 642.',title:"Library of Alexandria"},"Great Wall":{image:"Great Wall of China.jpg",summary:"The Great Wall of China is a series of fortifications made of stone, brick, tamped earth, wood, and other materials, generally built along an east-to-west line across the historical northern borders of China to protect the Chinese states and empires against the raids and invasions of the various nomadic groups of the Eurasian Steppe. Several walls were being built as early as the 7th century BC; these, later joined together and made bigger and stronger, are collectively referred to as the Great Wall. Especially famous is the system of fortifications built in 220–206 BC by Qin Shi Huang, the first Emperor of China. Little of that wall remains. The Great Wall has been rebuilt, maintained, and enhanced over various dynasties; the majority of the existing wall is from the Ming Dynasty (1368–1644).\nApart from defense, other purposes of the Great Wall have included border controls, allowing the imposition of duties on goods transported along the Silk Road, regulation or encouragement of trade and the control of immigration and emigration. Furthermore, the defensive characteristics of the Great Wall were enhanced by the construction of watch towers, troop barracks, garrison stations, signaling capabilities through the means of smoke or fire, and the fact that the path of the Great Wall also served as a transportation corridor.\nThe Great Wall stretches from Dandong in the east to Lop Lake in the west, along an arc that roughly delineates the southern edge of Inner Mongolia. A comprehensive archaeological survey, using advanced technologies, has concluded that the Ming walls measure 8,850 km (5,500 mi). This is made up of 6,259 km (3,889 mi) sections of actual wall, 359 km (223 mi) of trenches and 2,232 km (1,387 mi) of natural defensive barriers such as hills and rivers. Another archaeological survey found that the entire wall with all of its branches measure out to be 21,196 km (13,171 mi). Today, the Great Wall is generally recognized as one of the most impressive architectural feats in history.",title:"Great Wall of China"},"Guerilla Warfare":{image:"Guerrilla warfare.jpg",summary:"Guerrilla warfare is a form of irregular warfare in which a small group of combatants, such as paramilitary personnel, armed civilians, or irregulars, use military tactics including ambushes, sabotage, raids, petty warfare, hit-and-run tactics, and mobility to fight a larger and less-mobile traditional military.\n\n",title:"Guerrilla warfare"},Gunpowder:{image:"Gunpowder.jpg",summary:"Gunpowder, also known as black powder to distinguish it from modern smokeless gunpowder, is the earliest known chemical explosive. It consists of a mixture of sulfur, charcoal, and potassium nitrate (saltpeter). The sulfur and charcoal act as fuels while the saltpeter is an oxidizer. Because of its incendiary properties and the amount of heat and gas volume that it generates, gunpowder has been widely used as a propellant in firearms, rockets, fireworks, and as a blasting powder in quarrying, mining, and road building.\nGunpowder was invented in 9th-century China and spread throughout most parts of Eurasia by the end of the 13th century. Most arguments on early gunpowder developments now revolve around how much Chinese advancements in gunpowder influenced gunpowder warfare in Europe and the Middle East, but controversy over gunpowder's precise origins continue to be debated today.\nGunpowder is classified as a low explosive because of its relatively slow decomposition rate and consequently low brisance. Low explosives deflagrate (i.e., burn) at subsonic speeds, whereas high explosives detonate, producing a supersonic wave. Ignition of powder packed behind a bullet must generate enough pressure to force it from the muzzle at high speed, but not enough to rupture the gun barrel. Gunpowder thus makes a good propellant, but is less suitable for shattering rock or fortifications. Gunpowder was widely used to fill artillery shells and in mining and civil engineering to blast rock until the second half of the 19th century, when the first high explosives were put into use. Gunpowder is no longer used in modern weapons nor is it used for industrial purposes due to its relatively inefficient cost compared to newer alternatives such as dynamite and ammonium nitrate/fuel oil. Today gunpowder firearms are limited primarily to hunting, target shooting, and bulletless historical reenactments.",title:"Gunpowder"},"Hanging Gardens":{image:"Hanging Gardens of Babylon.jpg",summary:'The Hanging Gardens of Babylon were one of the Seven Wonders of the Ancient World, a term given to it by ancient Hellenic culture. The Hanging Gardens were described as a remarkable feat of engineering with an ascending series of tiered gardens containing a wide variety of trees, shrubs, and vines. The gardens were said to have looked like a large green mountain constructed of mud bricks.\nThe Hanging Gardens is the only one of the seven ancient wonders for which the location has not been definitively established. Traditionally they were said to have been built in the ancient city of Babylon, near present-day Hillah, Babil province, in Iraq. The Babylonian priest Berossus, writing in about 290 BC and quoted later by Josephus, attributed the gardens to Neo-Babylonian King Nebuchadnezzar II, who ruled between 605 and 562 BC. There are no extant Babylonian texts which mention the gardens, and no definitive archaeological evidence has been found in Babylon.\nBecause no physical evidence for the Hanging Gardens has been found at Babylon, two theories have been suggested. One is that they were purely mythical, and the descriptions found in ancient Greek and Roman writers including Strabo, Diodorus Siculus and Quintus Curtius Rufus represent a romantic ideal of an eastern garden. If it did indeed exist, it was destroyed sometime after the first century AD. The other theory is that they were actually in the city of Nineveh, constructed by the Assyrian king Sennacherib.\nAccording to one legend, Nebuchadnezzar II built the Hanging Gardens for his Median wife, Queen Amytis, because she missed the green hills and valleys of her homeland. He also built a grand palace that came to be known as "The Marvel of the Mankind". Stephanie Dalley suggests that the original garden may have been a well-documented one that Assyrian King Sennacherib (704–681 BC) built in his capital city of Nineveh on the River Tigris, near the modern city of Mosul.',title:"Hanging Gardens of Babylon"},Harbor:{image:"Harbor.jpg",summary:"A harbor or harbour (see spelling differences), also called a haven, is a body of water where ships, boats, and barges seek shelter from stormy weather, or are stored for future use. The term harbor, referring primarily to a sheltered body of water, is often used interchangeably with port, which is a man-made facility built for loading and unloading vessels and dropping off and picking up passengers. Ports usually include one or more harbors. Alexandria Port is an example of a port with two harbors.\nHarbors may be natural or artificial. An artificial harbor can have deliberately constructed breakwaters, sea walls, or jettys, or they can be constructed by dredging, which requires maintenance by further periodic dredging. An example of an artificial harbor is Long Beach Harbor, California, United States which was an array of salt marshes and tidal flats too shallow for modern merchant ships before it was first dredged in the early 20th century. In contrast, a natural harbor is surrounded on several sides by prominences of land. Examples of natural harbors include Sydney Harbour, Australia and Trincomalee Harbour in Sri Lanka.",title:"Harbor"},Helicopter:{image:"Helicopter.jpg",summary:'A helicopter is a type of rotorcraft in which lift and thrust are supplied by rotors. This allows the helicopter to take off and land vertically, to hover, and to fly forward, backward, and laterally. These attributes allow helicopters to be used in congested or isolated areas where fixed-wing aircraft and many forms of VTOL (vertical takeoff and landing) aircraft cannot perform.\nThe English word helicopter is adapted from the French word hélicoptère, coined by Gustave Ponton d\'Amécourt in 1861, which originates from the Greek helix (ἕλιξ) "helix, spiral, whirl, convolution" and pteron (πτερόν) "wing". English language nicknames for helicopter include "chopper", "copter", "helo", "heli", and "whirlybird".\nHelicopters were developed and built during the first half-century of flight, with the Focke-Wulf Fw 61 being the first operational helicopter in 1936. Some helicopters reached limited production, but it was not until 1942 that a helicopter designed by Igor Sikorsky reached full-scale production, with 131 aircraft built. Though most earlier designs used more than one main rotor, it is the single main rotor with anti-torque tail rotor configuration that has become the most common helicopter configuration. Tandem rotor helicopters are also in widespread use due to their greater payload capacity. Coaxial helicopters, tiltrotor aircraft, and compound helicopters are all flying today. Quadcopter helicopters pioneered as early as 1907 in France, and other types of multicopter have been developed for specialized applications such as unmanned drones.\n\n',title:"Helicopter"},"Hoover Dam":{image:"Hoover Dam.jpg",summary:"Hoover Dam is a concrete arch-gravity dam in the Black Canyon of the Colorado River, on the border between the U.S. states of Nevada and Arizona. It was constructed between 1931 and 1936 during the Great Depression and was dedicated on September 30, 1935, by President Franklin D. Roosevelt. Originally known as Boulder Dam from 1933, it was officially renamed Hoover Dam by a joint resolution of Congress in 1947. Its construction was the result of a massive effort involving thousands of workers, and cost over one hundred lives. The dam was named after President Herbert Hoover.\nSince about 1900, the Black Canyon and nearby Boulder Canyon had been investigated for their potential to support a dam that would control floods, provide irrigation water and produce hydroelectric power. In 1928, Congress authorized the project. The winning bid to build the dam was submitted by a consortium called Six Companies, Inc., which began construction on the dam in early 1931. Such a large concrete structure had never been built before, and some of the techniques were unproven. The torrid summer weather and lack of facilities near the site also presented difficulties. Nevertheless, Six Companies turned over the dam to the federal government on March 1, 1936, more than two years ahead of schedule.\nHoover Dam impounds Lake Mead, the largest reservoir in the United States by volume (when it is full). The dam is located near Boulder City, Nevada, a municipality originally constructed for workers on the construction project, about 30 mi (48 km) southeast of Las Vegas, Nevada. The dam's generators provide power for public and private utilities in Nevada, Arizona, and California. Hoover Dam is a major tourist attraction; nearly a million people tour the dam each year. The heavily traveled U.S. Route 93 (US 93) ran along the dam's crest until October 2010, when the Hoover Dam Bypass opened.",title:"Hoover Dam"},"Horseback Riding":{image:"Equestrianism.jpg",summary:"Equestrianism (from Latin equester, equestr-, equus, horseman, horse), more often known as riding, horse riding (British English) or horseback riding (American English), refers to the skill of riding, driving, steeplechasing or vaulting with horses. This broad description includes the use of horses for practical working purposes, transportation, recreational activities, artistic or cultural exercises and competitive sport.",title:"Equestrianism"},Horsemen:{image:"Equestrianism.jpg",summary:"Equestrianism (from Latin equester, equestr-, equus, horseman, horse), more often known as riding, horse riding (British English) or horseback riding (American English), refers to the skill of riding, driving, steeplechasing or vaulting with horses. This broad description includes the use of horses for practical working purposes, transportation, recreational activities, artistic or cultural exercises and competitive sport.",title:"Equestrianism"},Howitzer:{image:"Howitzer.jpg",summary:'A howitzer  is a type of artillery piece characterized by a relatively short barrel and the use of comparatively small propellant charges to propel projectiles over relatively high trajectories, with a steep angle of descent.\n\nIn the taxonomies of artillery pieces used by European (and European-style) armies in the 17th to 20th centuries, the howitzer stood between the "gun" (characterized by a longer barrel, larger propelling charges, smaller shells, higher velocities, and flatter trajectories) and the "mortar" (which was meant to fire at even higher angles of ascent and descent). Howitzers, like other artillery equipment, are usually organized in groups called batteries.',title:"Howitzer"},"Hydro Plant":{image:"Hydroelectricity.jpg",summary:"Hydroelectricity is electricity produced from hydropower. In 2015 hydropower generated 16.6% of the world's total electricity and 70% of all renewable electricity, and was expected to increase about 3.1% each year for the next 25 years.\nHydropower is produced in 150 countries, with the Asia-Pacific region generating 33 percent of global hydropower in 2013. China is the largest hydroelectricity producer, with 920 TWh of production in 2013, representing 16.9 percent of domestic electricity use.\nThe cost of hydroelectricity is relatively low, making it a competitive source of renewable electricity. The hydro station consumes no water, unlike coal or gas plants. The average cost of electricity from a hydro station larger than 10 megawatts is 3 to 5 U.S. cents per kilowatt-hour. With a dam and reservoir it is also a flexible source of electricity since the amount produced by the station can be changed up or down very quickly to adapt to changing energy demands. Once a hydroelectric complex is constructed, the project produces no direct waste, and has a considerably lower output level of greenhouse gases than fossil fuel powered energy plants.\n\n",title:"Hydroelectricity"},Industrialization:{image:"Industrialisation.jpg",summary:"Industrialisation or industrialization is the period of social and economic change that transforms a human group from an agrarian society into an industrial society, involving the extensive re-organisation of an economy for the purpose of manufacturing.\nAs industrial workers' incomes rise, markets for consumer goods and services of all kinds tend to expand and provide a further stimulus to industrial investment and economic growth.",title:"Industrialisation"},Invention:{image:"Invention.jpg",summary:"An invention is a unique or novel device, method, composition or process. The invention process is a process within an overall engineering and product development process. It may be an improvement upon a machine or product or a new process for creating an object or a result. An invention that achieves a completely unique function or result may be a radical breakthrough. Such works are novel and not obvious to others skilled in the same field. An inventor may be taking a big step in success or failure.\nSome inventions can be patented. A patent legally protects the intellectual property rights of the inventor and legally recognizes that a claimed invention is actually an invention. The rules and requirements for patenting an invention vary from country to country and the process of obtaining a patent is often expensive.\nAnother meaning of invention is cultural invention, which is an innovative set of useful social behaviours adopted by people and passed on to others. The Institute for Social Inventions collected many such ideas in magazines and books. Invention is also an important component of artistic and design creativity. Inventions often extend the boundaries of human knowledge, experience or capability.",title:"Invention"},"Iron Working":{image:"Ferrous metallurgy.jpg",summary:"Ferrous metallurgy is the metallurgy of iron and its alloys. It began far back in prehistory. The earliest surviving iron artifacts, from the 4th millennium BC in Egypt, were made from meteoritic iron-nickel. It is not known when or where the smelting of iron from ores began, but by the end of the 2nd millennium BC iron was being produced from iron ores from China to Sub-Saharan Africa. The use of wrought iron (worked iron) was known by the 1st millennium BC, and its spread marked the Iron Age. During the medieval period, means were found in Europe of producing wrought iron from cast iron (in this context known as pig iron) using finery forges. For all these processes, charcoal was required as fuel.\nSteel (with a carbon content between pig iron and wrought iron) was first produced in antiquity as an alloy. Its process of production, Wootz steel, was exported before the 4th century BC to ancient China, Africa, the Middle East and Europe. Archaeological evidence of cast iron appears in 5th century BC China. New methods of producing it by carburizing bars of iron in the cementation process were devised in the 17th century. During the Industrial Revolution, new methods of producing bar iron without charcoal were devised and these were later applied to produce steel, creating a new era of greatly increased use of iron and steel that some contemporaries described as a new Iron Age. In the late 1850s, Henry Bessemer invented a new steelmaking process, that involved blowing air through molten pig iron to burn off carbon, and so to produce mild steel. This and other 19th-century and later processes have displaced the use of wrought iron. Today, wrought iron is no longer produced on a commercial scale.",title:"Ferrous metallurgy"},Ironclad:{image:"Ironclad warship.jpg",summary:"An ironclad is a steam-propelled warship protected by iron or steel armor plates used in the early part of the second half of the 19th century. The ironclad was developed as a result of the vulnerability of wooden warships to explosive or incendiary shells. The first ironclad battleship, Gloire, was launched by the French Navy in November 1859. The British Admiralty had been considering armored warships since 1856 and prepared a draft design for an armored corvette in 1857; in early 1859 the Royal Navy started building two iron-hulled armored frigates, and by 1861 had made the decision to move to an all-armored battle fleet. After the first clashes of ironclads (both with wooden ships and with one another) took place in 1862 during the American Civil War, it became clear that the ironclad had replaced the unarmored ship of the line as the most powerful warship afloat. This type of ship would come to be very successful in the American Civil War.\nIronclads were designed for several roles, including as high seas battleships, coastal defense ships, and long-range cruisers. The rapid development of warship design in the late 19th century transformed the ironclad from a wooden-hulled vessel that carried sails to supplement its steam engines into the steel-built, turreted battleships and cruisers familiar in the 20th century. This change was pushed forward by the development of heavier naval guns (the ironclads of the 1880s carried some of the heaviest guns ever mounted at sea at the time), more sophisticated steam engines, and advances in metallurgy which made steel shipbuilding possible.\nThe quick pace of change meant that many ships were obsolete as soon as they were finished, and that naval tactics were in a state of flux. Many ironclads were built to make use of the ram or the torpedo, which a number of naval designers considered the important weapons of naval combat. There is no clear end to the ironclad period, but towards the end of the 1890s the term ironclad dropped out of use. New ships were increasingly constructed to a standard pattern and designated battleships or armored cruisers.",title:"Ironclad warship"},"Isaac Newton's College":{image:"Isaac Newton.jpg",summary:"Sir Isaac Newton  (; 25 December 1642 – 20 March 1726/27) was an English mathematician, astronomer, theologian and physicist (described in his own day as a \"natural philosopher\") who is widely recognised as one of the most influential scientists of all time and a key figure in the scientific revolution. His book Philosophiæ Naturalis Principia Mathematica (\"Mathematical Principles of Natural Philosophy\"), first published in 1687, laid the foundations of classical mechanics. Newton also made pathbreaking contributions to optics, and he shares credit with Gottfried Wilhelm Leibniz for developing the infinitesimal calculus.\nNewton's Principia formulated the laws of motion and universal gravitation that dominated scientists' view of the physical universe for the next three centuries. By deriving Kepler's laws of planetary motion from his mathematical description of gravity, and using the same principles to account for the trajectories of comets, the tides, the precession of the equinoxes, and other phenomena, Newton removed the last doubts about the validity of the heliocentric model of the Solar System and demonstrated that the motion of objects on Earth and of celestial bodies could be accounted for by the same principles. Newton's theoretical prediction that the Earth is shaped as an oblate spheroid was later vindicated by the geodetic measurements of Maupertuis, La Condamine, and others, thus convincing most Continental European scientists of the superiority of Newtonian mechanics over the earlier system of Descartes.\nNewton also built the first practical reflecting telescope and developed a sophisticated theory of colour based on the observation that a prism decomposes white light into the colours of the visible spectrum. Newton's work on light was collected in his highly influential book Opticks, first published in 1704. He also formulated an empirical law of cooling, made the first theoretical calculation of the speed of sound, and introduced the notion of a Newtonian fluid. In addition to his work on calculus, as a mathematician Newton contributed to the study of power series, generalised the binomial theorem to non-integer exponents, developed a method for approximating the roots of a function, and classified most of the cubic plane curves.\nNewton was a fellow of Trinity College and the second Lucasian Professor of Mathematics at the University of Cambridge. He was a devout but unorthodox Christian, who privately rejected the doctrine of the Trinity and who, unusually for a member of the Cambridge faculty of the day, refused to take holy orders in the Church of England. Beyond his work on the mathematical sciences, Newton dedicated much of his time to the study of alchemy and biblical chronology, but most of his work in those areas remained unpublished until long after his death. Politically and personally tied to the Whig party, Newton served two brief terms as Member of Parliament for the University of Cambridge, in 1689–90 and 1701–02. He was knighted by Queen Anne in 1705 and he spent the last three decades of his life in London, serving as Warden (1696–1700) and Master (1700–1727) of the Royal Mint, as well as president of the Royal Society (1703–1727).",title:"Isaac Newton"},"J.S. Bach's Cathedral":{image:"Johann Sebastian Bach.jpg",summary:"Johann Sebastian Bach (31 March [O.S. 21 March] 1685 – 28 July 1750) was a German composer and musician of the Baroque period. He is known for instrumental compositions such as the Brandenburg Concertos and the Goldberg Variations, and vocal music such as the St Matthew Passion and the Mass in B minor. Since the 19th-century Bach Revival he has been generally regarded as one of the greatest composers of all time.\nThe Bach family already counted several composers when Johann Sebastian was born as the last child of a city musician in Eisenach. Having become an orphan at age 10, he lived for five years with his eldest brother, after which he continued his musical formation in Lüneburg. From 1703 he was back in Thuringia, working as a musician for Protestant churches in Arnstadt and Mühlhausen and, for longer stretches of time, at courts in Weimar—where he expanded his repertoire for the organ—and Köthen—where he was mostly engaged with chamber music. From 1723 he was employed as Thomaskantor (cantor at St. Thomas) in Leipzig. He composed music for the principal Lutheran churches of the city, and for its university's student ensemble Collegium Musicum. From 1726 he published some of his keyboard and organ music. In Leipzig, as had happened in some of his earlier positions, he had a difficult relation with his employer, a situation that was little remedied when he was granted the title of court composer by the Elector of Saxony and King of Poland in 1736. In the last decades of his life he reworked and extended many of his earlier compositions. He died of complications after eye surgery in 1750.\nBach enriched established German styles through his mastery of counterpoint, harmonic and motivic organisation, and his adaptation of rhythms, forms, and textures from abroad, particularly from Italy and France. Bach's compositions include hundreds of cantatas, both sacred and secular. He composed Latin church music, Passions, oratorios and motets. He often adopted Lutheran hymns, not only in his larger vocal works, but for instance also in his four-part chorales and his sacred songs. He wrote extensively for organ and for other keyboard instruments. He composed concertos, for instance for violin and for harpsichord, and suites, as chamber music as well as for orchestra. Many of his works employ the genres of canon and fugue.\nThroughout the 18th century Bach was primarily valued as an organist, while his keyboard music, such as The Well-Tempered Clavier, was appreciated for its didactic qualities. The 19th century saw the publication of some major Bach-biographies, and by the end of that century all of his known music had been printed. Dissemination of scholarship on the composer continued through periodicals and websites exclusively devoted to him, and other publications such as the Bach-Werke-Verzeichnis (BWV, a numbered catalogue of his works) and new critical editions of his compositions. His music was further popularised through a multitude of arrangements, including for instance the Air on the G String, and of recordings, for instance three different box sets with complete performances of the composer's oeuvre marking the 250th anniversary of his death.",title:"Johann Sebastian Bach"},"King Richard's Crusade":{image:"Third Crusade.jpg",summary:"The Third Crusade (1189–1192), also known as The Kings' Crusade, was an attempt by European leaders to reconquer the Holy Land from Saladin (Ṣalāḥ ad-Dīn Yūsuf ibn Ayyūb). The campaign was largely successful in capturing the important cities of Acre and Jaffa, and reversing most of Saladin's conquests, but it failed to capture Jerusalem, the emotional and spiritual motivation of the Crusade.\nAfter the failure of the Second Crusade, the Zengid dynasty controlled a unified Syria and engaged in a conflict with the Fatimid rulers of Egypt. The Egyptian and Syrian forces were ultimately unified under Saladin, who employed them to reduce the Christian states and recapture Jerusalem in 1187. Spurred by religious zeal, King Henry II of England and King Philip II of France (known as Philip Augustus) ended their conflict with each other to lead a new crusade. The death of Henry in 1189, however, meant the English contingent came under the command of his successor, King Richard I of England (known as Richard the Lionheart, in French Cœur de Lion). The elderly Holy Roman Emperor Frederick Barbarossa also responded to the call to arms, leading a massive army across Anatolia, but he drowned in a river in Asia Minor on 10 June 1190 before reaching the Holy Land. His death caused tremendous grief among the German Crusaders, and most of his troops returned home.\nAfter the Crusaders had driven the Muslims from Acre, Philip in company with Frederick's successor, Leopold V, Duke of Austria (known as Leopold the Virtuous), left the Holy Land in August 1191. On 2 September 1192, Richard and Saladin finalized a treaty granting Muslim control over Jerusalem but allowing unarmed Christian pilgrims and merchants to visit the city. Richard departed the Holy Land on 9 October. The successes of the Third Crusade allowed the Crusaders to maintain considerable states in Cyprus and on the Syrian coast. However, the failure to recapture Jerusalem would lead to the Fourth Crusade.",title:"Third Crusade"},Knights:{image:"Knight.jpg",summary:"A knight is a person granted an honorary title of knighthood by a monarch or other political leader for service to the monarch or country, especially in a military capacity. Historically, in Europe, knighthood was conferred upon mounted warriors. During the High Middle Ages, knighthood was considered a class of lower nobility. By the Late Middle Ages, the rank had become associated with the ideals of chivalry, a code of conduct for the perfect courtly Christian warrior. Often, a knight was a vassal who served as a fighter for a lord, with payment in the form of land holdings. The lords trusted the knights, who were skilled in battle on horseback.\nKnighthood in the Middle Ages was closely linked with horsemanship (and especially the joust) from its origins in the 12th century until its final flowering as a fashion among the high nobility in the Duchy of Burgundy in the 15th century. This linkage is reflected in the etymology of chivalry, cavalier and related terms (see Etymology section below). The special prestige accorded to mounted warriors finds a parallel in the furusiyya in the Muslim world, and the Greek hippeus (ἱππεύς) and Roman eques of classical antiquity.\nIn the late medieval period, new methods of warfare began to render classical knights in armour obsolete, but the titles remained in many nations. Today, a number of orders of knighthood continue to exist in several countries, such as the English Order of the Garter, the Swedish Royal Order of the Seraphim, and the Royal Norwegian Order of St. Olav. Each of these orders has its own criteria for eligibility, but knighthood is generally granted by a head of state or monarch to selected persons to recognise some meritorious achievement, as in the British honours system, often for non-military service to the country. The modern female equivalent in the United Kingdom is Dame.\nHistorically, the ideals of chivalry were popularized in medieval literature, particularly the literary cycles known as the Matter of France, relating to the legendary companions of Charlemagne, and the Matter of Britain, relating to the legend of King Arthur.",title:"Knight"},"Labor Union":{image:"Trade union.jpg",summary:'A trade union or trades union, also called a labour union (Canada) or labor union (US), is an organization of workers who have come together to achieve common goals such as protecting the integrity of its trade, improving safety standards, achieving higher pay and benefits such as health care and retirement, increasing the number of employees an employer assigns to complete the work, and better working conditions. The trade union, through its leadership, bargains with the employer on behalf of union members (rank and file members) and negotiates labour contracts (collective bargaining) with employers. The most common purpose of these associations or unions is "maintaining or improving the conditions of their employment". This may include the negotiation of wages, work rules, complaint procedures, rules governing hiring, firing and promotion of workers, benefits, workplace safety and policies.\nUnions may organize a particular section of skilled workers (craft unionism), a cross-section of workers from various trades (general unionism), or attempt to organize all workers within a particular industry (industrial unionism). The agreements negotiated by a union are binding on the rank and file members and the employer and in some cases on other non-member workers. Trade unions traditionally have a constitution which details the governance of their bargaining unit and also have governance at various levels of government depending on the industry that binds them legally to their negotiations and functioning.\nOriginating in Great Britain, trade unions became popular in many countries during the Industrial Revolution. Trade unions may be composed of individual workers, professionals, past workers, students, apprentices or the unemployed. Trade union density, or the percentage of workers belonging to a trade union, is highest in the Nordic countries.',title:"Trade union"},Laser:{image:"Laser.jpg",summary:'A laser is a device that emits light through a process of optical amplification based on the stimulated emission of electromagnetic radiation. The term "laser" originated as an acronym for "light amplification by stimulated emission of radiation". The first laser was built in 1960 by Theodore H. Maiman at Hughes Research Laboratories, based on theoretical work by Charles Hard Townes and Arthur Leonard Schawlow.\nA laser differs from other sources of light in that it emits light coherently, spatially and temporally. Spatial coherence allows a laser to be focused to a tight spot, enabling applications such as laser cutting and lithography. Spatial coherence also allows a laser beam to stay narrow over great distances (collimation), enabling applications such as laser pointers. Lasers can also have high temporal coherence, which allows them to emit light with a very narrow spectrum, i.e., they can emit a single color of light. Temporal coherence can be used to produce pulses of light as short as a femtosecond.\nAmong their many applications, lasers are used in optical disk drives, laser printers, and barcode scanners; DNA sequencing instruments, fiber-optic and free-space optical communication; laser surgery and skin treatments; cutting and welding materials; military and law enforcement devices for marking targets and measuring range and speed; and laser lighting displays in entertainment.',title:"Laser"},Leader:{image:"Leadership.jpg",summary:'Leadership is both a research area and a practical skill encompassing the ability of an individual or organization to "lead" or guide other individuals, teams, or entire organizations. The literature debates various viewpoints: contrasting Eastern and Western approaches to leadership, and also (within the West) US vs. European approaches. US academic environments define leadership as "a process of social influence in which a person can enlist the aid and support of others in the accomplishment of a common task". Leadership seen from a European and non-academic perspective encompasses a view of a leader who can be moved not only by communitarian goals but also by the search for personal power. Leadership can derive from a combination of several factors, as the European researcher Daniele Trevisani highlights:\n\n"Leadership is a holistic spectrum that can arise from: (1) higher levels of physical power, need to display power and control others, force superiority, ability to generate fear, or group-member\'s need for a powerful group protector (Primal Leadership), (2) superior mental energies, superior motivational forces, perceivable in communication and behaviors, lack of fear, courage, determination (Psychoenergetic Leadership), (3) higher abilities in managing the overall picture (Macro-Leadership), (4) higher abilities in specialized tasks (Micro-Leadership), (5) higher ability in managing the execution of a task (Project Leadership), and (6) higher level of values, wisdom, and spirituality (Spiritual Leadership), where any Leader derives its Leadership Style from a unique mix of one or more of the former factors".\n\nStudies of leadership have produced theories involving traits, situational interaction, function, behavior, power, vision and values, charisma, and intelligence, among others.',title:"Leadership"},Leadership:{image:"Leadership.jpg",summary:'Leadership is both a research area and a practical skill encompassing the ability of an individual or organization to "lead" or guide other individuals, teams, or entire organizations. The literature debates various viewpoints: contrasting Eastern and Western approaches to leadership, and also (within the West) US vs. European approaches. US academic environments define leadership as "a process of social influence in which a person can enlist the aid and support of others in the accomplishment of a common task". Leadership seen from a European and non-academic perspective encompasses a view of a leader who can be moved not only by communitarian goals but also by the search for personal power. Leadership can derive from a combination of several factors, as the European researcher Daniele Trevisani highlights:\n\n"Leadership is a holistic spectrum that can arise from: (1) higher levels of physical power, need to display power and control others, force superiority, ability to generate fear, or group-member\'s need for a powerful group protector (Primal Leadership), (2) superior mental energies, superior motivational forces, perceivable in communication and behaviors, lack of fear, courage, determination (Psychoenergetic Leadership), (3) higher abilities in managing the overall picture (Macro-Leadership), (4) higher abilities in specialized tasks (Micro-Leadership), (5) higher ability in managing the execution of a task (Project Leadership), and (6) higher level of values, wisdom, and spirituality (Spiritual Leadership), where any Leader derives its Leadership Style from a unique mix of one or more of the former factors".\n\nStudies of leadership have produced theories involving traits, situational interaction, function, behavior, power, vision and values, charisma, and intelligence, among others.',title:"Leadership"},Legion:{image:"Roman legion.jpg",summary:'A Roman legion (from Latin legio "military levy, conscription", from legere "to choose") was the largest unit of the Roman army, evolving from 3000 men in early times to over 5200 men in imperial times, consisting of centuries as the basic units. Until the middle of the first century, 10 cohorts (about 5,000 men) made up a Roman Legion. This was later changed to nine cohorts of standard size (with 6 centuries at 80 men each) and one cohort, the first cohort, of double strength (5 double-strength centuries with 160 men each).\nIn the early Roman Kingdom the "legion" may have meant the entire Roman army but sources on this period are few and unreliable. The subsequent organization of legions varied greatly over time but legions were typically composed of around five thousand soldiers, divided during the republican era into three lines of ten maniples, and from about 100 BC into ten cohorts. Legions also included a small ala or cavalry unit. By the third century AD, the legion was a much smaller unit of about 1,000 to 1,500 men, and there were more of them. In the fourth century AD, East Roman border guard legions (limitanei) may have become even smaller.\nFor most of the Roman Imperial period, the legions formed the Roman army\'s elite heavy infantry, recruited exclusively from Roman citizens, while the remainder of the army consisted of auxiliaries, who provided additional infantry and the vast majority of the Roman army\'s cavalry. (Provincials who aspired to citizenship gained it when honourably discharged from the auxiliaries). The Roman army, for most of the Imperial period, consisted mostly of auxiliaries rather than legions.\nMany of the legions founded before 40 BC were still active until at least the fifth century, notably Legio V Macedonica, which was founded by Augustus in 43 BC and was in Egypt in the seventh century during the Islamic conquest of Egypt.',title:"Roman legion"},"Leonardo's Workshop":{image:"Leonardo da Vinci.jpg",summary:'Leonardo di ser Piero da Vinci (Italian: [leoˈnardo di ˌsɛr ˈpjɛːro da (v)ˈvintʃi] ( listen); 15 April 1452 – 2 May 1519), more commonly Leonardo da Vinci or simply Leonardo, was an Italian Renaissance polymath whose areas of interest included invention, painting, sculpting, architecture, science, music, mathematics, engineering, literature, anatomy, geology, astronomy, botany, writing, history, and cartography. He has been variously called the father of palaeontology, ichnology, and architecture, and is widely considered one of the greatest painters of all time. Sometimes credited with the inventions of the parachute, helicopter and tank, he epitomised the Renaissance humanist ideal.\nMany historians and scholars regard Leonardo as the prime exemplar of the "Universal Genius" or "Renaissance Man", an individual of "unquenchable curiosity" and "feverishly inventive imagination". According to art historian Helen Gardner, the scope and depth of his interests were without precedent in recorded history, and "his mind and personality seem to us superhuman, while the man himself mysterious and remote". Marco Rosci notes that while there is much speculation regarding his life and personality, his view of the world was logical rather than mysterious, and that the empirical methods he employed were unorthodox for his time.\nBorn out of wedlock to a notary, Piero da Vinci, and a peasant woman, Caterina, in Vinci in the region of Florence, Leonardo was educated in the studio of the renowned Florentine painter Andrea del Verrocchio. Much of his earlier working life was spent in the service of Ludovico il Moro in Milan. He later worked in Rome, Bologna and Venice, and he spent his last years in France at the home awarded to him by Francis I of France.\nLeonardo was, and is, renowned primarily as a painter. Among his works, the Mona Lisa is the most famous and most parodied portrait and The Last Supper the most reproduced religious painting of all time. Leonardo\'s drawing of the Vitruvian Man is also regarded as a cultural icon, being reproduced on items as varied as the euro coin, textbooks, and T-shirts. Perhaps fifteen of his paintings have survived. Nevertheless, these few works, together with his notebooks, which contain drawings, scientific diagrams, and his thoughts on the nature of painting, compose a contribution to later generations of artists rivalled only by that of his contemporary, Michelangelo.\nLeonardo is revered for his technological ingenuity. He conceptualised flying machines, a type of armoured fighting vehicle, concentrated solar power, an adding machine, and the double hull. Relatively few of his designs were constructed or even feasible during his lifetime, as the modern scientific approaches to metallurgy and engineering were only in their infancy during the Renaissance. Some of his smaller inventions, however, such as an automated bobbin winder and a machine for testing the tensile strength of wire, entered the world of manufacturing unheralded. A number of Leonardo\'s most practical inventions are nowadays displayed as working models at the Museum of Vinci. He made substantial discoveries in anatomy, civil engineering, geology, optics, and hydrodynamics, but he did not publish his findings and they had no direct influence on later science.\nToday, Leonardo is widely considered one of the most diversely talented individuals ever to have lived.',title:"Leonardo da Vinci"},Library:{image:"Library.jpg",summary:"A library is a collection of sources of information and similar resources, made accessible to a defined community for reference or borrowing. It provides physical or digital access to material, and may be a physical building or room, or a virtual space, or both. A library's collection can include books, periodicals, newspapers, manuscripts, films, maps, prints, documents, microform, CDs, cassettes, videotapes, DVDs, Blu-ray Discs, e-books, audiobooks, databases, and other formats. Libraries range in size from a few shelves of books to several million items. In Latin and Greek, the idea of a bookcase is represented by Bibliotheca and Bibliothēkē (Greek: βιβλιοθήκη): derivatives of these mean library in many modern languages, e.g. French bibliothèque.\nThe first libraries consisted of archives of the earliest form of writing—the clay tablets in cuneiform script discovered in Sumer, some dating back to 2600 BC. Private or personal libraries made up of written books appeared in classical Greece in the 5th century BC. In the 6th century, at the very close of the Classical period, the great libraries of the Mediterranean world remained those of Constantinople and Alexandria.\nA library is organized for use and maintained by a public body, an institution, a corporation, or a private individual. Public and institutional collections and services may be intended for use by people who choose not to—or cannot afford to—purchase an extensive collection themselves, who need material no individual can reasonably be expected to have, or who require professional assistance with their research. In addition to providing materials, libraries also provide the services of librarians who are experts at finding and organizing information and at interpreting information needs. Libraries often provide quiet areas for studying, and they also often offer common areas to facilitate group study and collaboration. Libraries often provide public facilities for access to their electronic resources and the Internet. Modern libraries are increasingly being redefined as places to get unrestricted access to information in many formats and from many sources. They are extending services beyond the physical walls of a building, by providing material accessible by electronic means, and by providing the assistance of librarians in navigating and analyzing very large amounts of information with a variety of digital tools.",title:"Library"},Lighthouse:{image:"Lighthouse.jpg",summary:"A lighthouse is a tower, building, or other type of structure designed to emit light from a system of lamps and lenses, and to serve as a navigational aid for maritime pilots at sea or on inland waterways.\nLighthouses mark dangerous coastlines, hazardous shoals, reefs, and safe entries to harbors, and can assist in aerial navigation. Once widely used, the number of operational lighthouses has declined due to the expense of maintenance and use of electronic navigational systems.",title:"Lighthouse"},Literacy:{image:"Literacy.jpg",summary:'Literacy is traditionally meant as the ability to read, write, and use arithmetic. The modern term\'s meaning has been expanded to include the ability to use language, numbers, images, computers, and other basic means to understand, communicate, gain useful knowledge and use the dominant symbol systems of a culture. The concept of literacy is expanding in OECD countries to include skills to access knowledge through technology and ability to assess complex contexts. A person who travels and resides in a foreign country but is unable to read or write in the language of the host country would also be regarded by the locals as being illiterate.\nThe key to literacy is reading development, a progression of skills that begins with the ability to understand spoken words and decode written words, and culminates in the deep understanding of text. Reading development involves a range of complex language underpinnings including awareness of speech sounds (phonology), spelling patterns (orthography), word meaning (semantics), grammar (syntax) and patterns of word formation (morphology), all of which provide a necessary platform for reading fluency and comprehension. Literacy takes place from birth to age three. If the time frame from birth to age three is missed it will be harder for literacy to take place\nOnce these skills are acquired, the reader can attain full language literacy, which includes the abilities to apply to printed material critical analysis, inference and synthesis; to write with accuracy and coherence; and to use information and insights from text as the basis for informed decisions and creative thought. The inability to do so is called illiteracy or analphabetism.\nThe United Nations Educational, Scientific and Cultural Organization (UNESCO) defines literacy as the "ability to identify, understand, interpret, create, communicate and compute, using printed and written materials associated with varying contexts. Literacy involves a continuum of learning in enabling individuals to achieve their goals, to develop their knowledge and potential, and to participate fully in their community and wider society".',title:"Literacy"},"Machine Tools":{image:"Machine tool.jpg",summary:'A machine tool is a machine for shaping or machining metal or other rigid materials, usually by cutting, boring, grinding, shearing, or other forms of deformation. Machine tools employ some sort of tool that does the cutting or shaping. All machine tools have some means of constraining the workpiece and provide a guided movement of the parts of the machine. Thus the relative movement between the workpiece and the cutting tool (which is called the toolpath) is controlled or constrained by the machine to at least some extent, rather than being entirely "offhand" or "freehand".\nThe precise definition of the term machine tool varies among users, as discussed below. While all machine tools are "machines that help people to make things", not all factory machines are machine tools.\nToday machine tools are typically powered other than by human muscle (e.g., electrically, hydraulically, or via line shaft), used to make manufactured parts (components) in various ways that include cutting or certain other kinds of deformation.\nWith their inherent precision, machine tools enabled the economical production of interchangeable parts.',title:"Machine tool"},"Magellan's Expedition":{image:"Ferdinand Magellan.jpg",summary:'Ferdinand Magellan ( or ; Portuguese: Fernão de Magalhães, IPA: [fɨɾˈnɐ̃w dɨ mɐɣɐˈʎɐ̃jʃ]; Spanish: Fernando de Magallanes, IPA: [ferˈnando ðe maɣaˈʎanes]; c. 1480 – 27 April 1521) was a Portuguese explorer who organised the Spanish expedition to the East Indies from 1519 to 1522, resulting in the first circumnavigation of the Earth, completed by Juan Sebastián Elcano.\nBorn into a Portuguese noble family in around 1480, Magellan became a skilled sailor and naval officer and was eventually selected by King Charles I of Spain to search for a westward route to the Maluku Islands (the "Spice Islands"). Commanding a fleet of five vessels, he headed south through the Atlantic Ocean to Patagonia, passing through the Strait of Magellan into a body of water he named the "peaceful sea" (the modern Pacific Ocean). Despite a series of storms and mutinies, the expedition reached the Spice Islands in 1521 and returned home via the Indian Ocean to complete the first circuit of the globe. Magellan did not complete the entire voyage, as he was killed during the Battle of Mactan in the Philippines in 1521.\nMagellan had already reached the Malay Archipelago in Southeast Asia on previous voyages traveling east (from 1505 to 1511-1512). By visiting this area again but now travelling west, Magellan achieved a nearly complete personal circumnavigation of the globe for the first time in history.\nThe Magellanic penguin is named after him, as he was the first European to note it. Magellan\'s navigational skills have also been acknowledged in the naming of objects associated with the stars, including the Magellanic Clouds, now known to be two nearby dwarf galaxies; the twin lunar craters of Magelhaens and Magelhaens A; and the Martian crater of Magelhaens.',title:"Ferdinand Magellan"},Magnetism:{image:"Magnetism.jpg",summary:"Magnetism is a class of physical phenomena that are mediated by magnetic fields. Electric currents and the magnetic moments of elementary particles give rise to a magnetic field, which acts on other currents and magnetic moments. The most familiar effects occur in ferromagnetic materials, which are strongly attracted by magnetic fields and can be magnetized to become permanent magnets, producing magnetic fields themselves. Only a few substances are ferromagnetic; the most common ones are iron, nickel and cobalt and their alloys. The prefix ferro- refers to iron, because permanent magnetism was first observed in lodestone, a form of natural iron ore called magnetite, Fe3O4.\nAlthough ferromagnetism is responsible for most of the effects of magnetism encountered in everyday life, all other materials are influenced to some extent by a magnetic field, by several other types of magnetism. Paramagnetic substances such as aluminum and oxygen are weakly attracted to an applied magnetic field; diamagnetic substances such as copper and carbon are weakly repelled; while antiferromagnetic materials such as chromium and spin glasses have a more complex relationship with a magnetic field. The force of a magnet on paramagnetic, diamagnetic, antiferromagnetic materials is usually too weak to be felt, and can be detected only by laboratory instruments, so in everyday life these substances are often described as non-magnetic.\nThe magnetic state (or magnetic phase) of a material depends on temperature and other variables such as pressure and the applied magnetic field. A material may exhibit more than one form of magnetism as these variables change.",title:"Magnetism"},"Manhattan Project":{image:"Manhattan Project.jpg",summary:"The Manhattan Project was a research and development undertaking during World War II that produced the first nuclear weapons. It was led by the United States with the support of the United Kingdom and Canada. From 1942 to 1946, the project was under the direction of Major General Leslie Groves of the U.S. Army Corps of Engineers. Nuclear physicist Robert Oppenheimer was the director of the Los Alamos Laboratory that designed the actual bombs. The Army component of the project was designated the Manhattan District; \"Manhattan\" gradually superseded the official codename, Development of Substitute Materials, for the entire project. Along the way, the project absorbed its earlier British counterpart, Tube Alloys. The Manhattan Project began modestly in 1939, but grew to employ more than 130,000 people and cost nearly US $2 billion (about $27 billion in 2016 dollars). Over 90% of the cost was for building factories and to produce fissile material, with less than 10% for development and production of the weapons. Research and production took place at more than 30 sites across the United States, the United Kingdom, and Canada.\nTwo types of atomic bombs were developed concurrently during the war: a relatively simple gun-type fission weapon and a more complex implosion-type nuclear weapon. The Thin Man gun-type design proved impractical to use with plutonium so a simpler gun-type called Little Boy was developed that used uranium-235, an isotope that makes up only 0.7 percent of natural uranium. Chemically identical to the most common isotope, uranium-238, and with almost the same mass, it proved difficult to separate the two. Three methods were employed for uranium enrichment: electromagnetic, gaseous and thermal. Most of this work was performed at the Clinton Engineer Works at Oak Ridge, Tennessee.\nIn parallel with the work on uranium was an effort to produce plutonium. After the feasibility of the world's first artificial nuclear reactor was demonstrated in Chicago at the Metallurgical Laboratory, it designed the X-10 Graphite Reactor at Oak Ridge and the production reactors in Hanford, Washington, in which uranium was irradiated and transmuted into plutonium. The plutonium was then chemically separated from the uranium. The Fat Man implosion-type weapon was developed in a concerted design and development effort by the Los Alamos Laboratory.\nThe project was also charged with gathering intelligence on the German nuclear weapon project. Through Operation Alsos, Manhattan Project personnel served in Europe, sometimes behind enemy lines, where they gathered nuclear materials and documents, and rounded up German scientists. Despite the Manhattan Project's tight security, Soviet atomic spies successfully penetrated the program.\nThe first nuclear device ever detonated was an implosion-type bomb at the Trinity test, conducted at New Mexico's Alamogordo Bombing and Gunnery Range on 16 July 1945. Little Boy and Fat Man bombs were used a month later in the atomic bombings of Hiroshima and Nagasaki, respectively. In the immediate postwar years, the Manhattan Project conducted weapons testing at Bikini Atoll as part of Operation Crossroads, developed new weapons, promoted the development of the network of national laboratories, supported medical research into radiology and laid the foundations for the nuclear navy. It maintained control over American atomic weapons research and production until the formation of the United States Atomic Energy Commission in January 1947.",title:"Manhattan Project"},"Map Making":{image:"Cartography.jpg",summary:'Cartography (from Greek χάρτης khartēs, "papyrus, sheet of paper, map"; and γράφειν graphein, "write") is the study and practice of making maps. Combining science, aesthetics, and technique, cartography builds on the premise that reality can be modeled in ways that communicate spatial information effectively.\nThe fundamental problems of traditional cartography are to:\nSet the map\'s agenda and select traits of the object to be mapped. This is the concern of map editing. Traits may be physical, such as roads or land masses, or may be abstract, such as toponyms or political boundaries.\nRepresent the terrain of the mapped object on flat media. This is the concern of map projections.\nEliminate characteristics of the mapped object that are not relevant to the map\'s purpose. This is the concern of generalization.\nReduce the complexity of the characteristics that will be mapped. This is also the concern of generalization.\nOrchestrate the elements of the map to best convey its message to its audience. This is the concern of map design.\nModern cartography constitutes many theoretical and practical foundations of geographic information systems.',title:"Cartography"},"Marco Polo's Embassy":{image:"Marco Polo.jpg",summary:"Marco Polo ( ( listen); Italian: [ˈmarko ˈpɔːlo]; Venetian: [ˈmaɾko ˈpo.lo] 1254 – January 8–9, 1324) was a Venetian merchant, explorer, and writer. His travels are recorded in Livres des merveilles du monde (Book of the Marvels of the World, also known as The Travels of Marco Polo, c. 1300), a book that described to Europeans the wealth and great size of China, its capital Peking, and other Asian cities and countries.\nHe learned the mercantile trade from his father and his uncle, Niccolò and Maffeo, who travelled through Asia and met Kublai Khan. In 1269, they returned to Venice to meet Marco for the first time. The three of them embarked on an epic journey to Asia, returning after 24 years to find Venice at war with Genoa; Marco was imprisoned and dictated his stories to a cellmate. He was released in 1299, became a wealthy merchant, married, and had three children. He died in 1324 and was buried in the church of San Lorenzo in Venice.\nMarco Polo was not the first European to reach China (see Europeans in Medieval China), but he was the first to leave a detailed chronicle of his experience. This book inspired Christopher Columbus and many other travellers. There is a substantial literature based on Polo's writings; he also influenced European cartography, leading to the introduction of the Fra Mauro map.",title:"Marco Polo"},Marines:{image:"Marines.jpg",summary:"Marines, also known as a marine corps or naval infantry, are typically an infantry force that specializes in the support of naval and army operations at sea and on land, as well as the execution of their own operations. In the majority of countries, the marine force is part of the navy, but it can also be under the army like the Troupes de marine (French Marines) and Givati Brigade (Israeli Marines), or form an independent service branch like the United States Marine Corps and the Royal Marines (although the United States Marine Corps is under the United States Department of the Navy and the Royal Marines come under Her Majesty's Naval Service respectively).\nHistorically, tasks undertaken by marines have included: helping maintain discipline and order aboard the ship (reflecting the pressed nature of the ships' company and the risk of mutiny), the boarding of vessels during combat or capture of prize ships, and providing manpower for raiding ashore in support of the naval objectives.\nWith the industrialization of warfare in the 20th century the scale of landing operations increased; this brought with it an increased likelihood of opposition and a need for co-ordination of various military elements. Marine forces evolved to specialize in the skills and capabilities required for amphibious warfare.",title:"Marines"},Marketplace:{image:"Marketplace.jpg",summary:"A market, or marketplace, is a location where people regularly gather for the purchase and sale of provisions, livestock, and other goods. In different parts of the world, a market place may be described as a souk (from the Arabic), bazaar (from the Persian), a fixed mercado (Spanish), or itinerant tianguis (Mexico), or palengke (Philippines). Some markets operate daily and are said to be permanent markets while others are held once a week or on less frequent specified days such as festival days and are said to be periodic markets. The form that a market adopts is depends on its locality's population, culture, ambient and geographic conditions.\nMarkets have existed for as long as humans have engaged in trade. The earliest bazaars are believed to have originated in Persia, from where they spread to the rest of the Middle East and Europe. Documentary sources suggest that zoning policies confined trading to particular parts of cities from around 3,000 BCE, creating the conditions necessary for the emergence of a bazaar. Middle Eastern bazaars were typically long strips with stalls on either side and a covered roof designed to protect traders and purchasers from the fierce sun. In Europe, informal, unregulated markets gradually made way for a system of formal, chartered markets from the 12th century. Throughout the Medieval period, increased regulation of marketplace practices, especially weights and measures, gave consumers confidence in the quality of market goods and the fairness of prices. Around the globe, markets have evolved in different ways depending on local ambient conditions, especially weather, tradition and culture. In the Middle East, markets tend to be covered, to protect traders and shoppers from the sun. In milder climates, markets are often open air. In Asia, a system of morning markets trading in fresh produce and night markets trading in non-perishables is common.\nIn many countries, shopping at a local market is a standard feature of daily life. Given the market's role in ensuring food supply for a population, markets are often highly regulated by a central authority. In many places, designated market places have become listed sites of historic and architectural significance and represent part of a town or nation's cultural assets. For these reasons, they are often popular tourist destinations.",title:"Marketplace"},Masonry:{image:"Masonry.jpg",summary:"Masonry is the building of structures from individual units, which are often laid in and bound together by mortar; the term masonry can also refer to the units themselves. The common materials of masonry construction are brick, building stone such as marble, granite, travertine, and limestone, cast stone, concrete block, glass block, and adobe. Masonry is generally a highly durable form of construction. However, the materials used, the quality of the mortar and workmanship, and the pattern in which the units are assembled can substantially affect the durability of the overall masonry construction. A person who constructs masonry is called a mason or bricklayer.",title:"Masonry"},"Mass Production":{image:"Mass production.jpg",summary:"Mass production, also known as flow production or continuous production, is the production of large amounts of standardized products, including and especially on assembly lines. Together with job production and batch production, it is one of the three main production methods.\nThe term mass production was popularized by a 1926 article in the Encyclopædia Britannica supplement that was written based on correspondence with Ford Motor Company. The New York Times used the term in the title of an article that appeared before publication of the Britannica article.\nThe concepts of mass production are applied to various kinds of products, from fluids and particulates handled in bulk (such as food, fuel, chemicals, and mined minerals) to discrete solid parts (such as fasteners) to assemblies of such parts (such as household appliances and automobiles).\nMass production is a diverse field, but it can generally be contrasted with craft production or distributed manufacturing. Some mass production techniques, such as standardized sizes and production lines, predate the Industrial Revolution by many centuries; however, it was not until the introduction of machine tools and techniques to produce interchangeable parts were developed in the mid 19th century that modern mass production was possible.\n\n",title:"Mass production"},"Mass Transit":{image:"Public transport.jpg",summary:'Public transport (also known as public transportation, public transit, or mass transit) is a shared passenger-transport service which is available for use by the general public, as distinct from modes such as taxicab, carpooling, hired buses, and transportation network companies, which are not shared by the general public without private arrangement.\nPublic transport modes include city buses, trolleybuses, trams (or light rail) and passenger trains, rapid transit (metro/subway/underground, etc.) and ferries. Public transport between cities is dominated by airlines, coaches, and intercity rail. High-speed rail networks are being developed in many parts of the world. Most public transport systems run along fixed routes with set embarkation/disembarkation points to a prearranged timetable, with the most frequent services running to a headway (e.g.: "every 5 minutes" as opposed to being scheduled for any specific time of the day). Share taxis offer on-demand services in many parts of the world, and some services will wait until the vehicle is full before it departs. Paratransit is sometimes used in areas of low demand and for people who need a door-to-door service.\nUrban public transit differs distinctly among Asia, North America, and Europe. In Asia, profit-driven, privately-owned and publicly traded mass transit and real estate conglomerates predominantly operate public transit systems  In North America, municipal transit authorities most commonly run mass transit operations. In Europe, both state-owned and private companies predominantly operate mass transit systems, Public transport services can be profit-driven by use of pay-by-the-distance fares or funded by government subsidies in which flat rate fares are charged to each passenger. Services can be fully profitable through high usership numbers and high farebox recovery ratios, or can be regulated and possibly subsidised from local or national tax revenue. Fully subsidised, free of charge services operate in some towns and cities.\nFor geographical, historical and economic reasons, differences exist internationally regarding use and extent of public transport. While countries in the Old World tend to have extensive and frequent systems serving their old and dense cities, many cities of the New World have more sprawl and much less comprehensive public transport. The International Association of Public Transport (UITP) is the international network for public transport authorities and operators, policy decision-makers, scientific institutes and the public transport supply and service industry. It has 3,400 members from 92 countries.',title:"Public transport"},Mathematics:{image:"Mathematics.jpg",summary:'Mathematics (from Greek μάθημα máthēma, "knowledge, study, learning") is the study of objects and their relations. Examples of objects are quantity (numbers), structure, space, and change. There is a range of views among mathematicians and philosophers as to the exact scope and definition of mathematics.\nMathematicians seek out patterns and use them to formulate new conjectures. Mathematicians resolve the truth or falsity of conjectures by mathematical proof. When mathematical structures are good models of real phenomena, then mathematical reasoning can provide insight or predictions about nature. Through the use of abstraction and logic, mathematics developed from counting, calculation, measurement, and the systematic study of the shapes and motions of physical objects. Practical mathematics has been a human activity from as far back as written records exist. The research required to solve mathematical problems can take years or even centuries of sustained inquiry.\nRigorous arguments first appeared in Greek mathematics, most notably in Euclid\'s Elements. Since the pioneering work of Giuseppe Peano (1858–1932), David Hilbert (1862–1943), and others on axiomatic systems in the late 19th century, it has become customary to view mathematical research as establishing truth by rigorous deduction from appropriately chosen axioms and definitions. Mathematics developed at a relatively slow pace until the Renaissance, when mathematical innovations interacting with new scientific discoveries led to a rapid increase in the rate of mathematical discovery that has continued to the present day.\nGalileo Galilei (1564–1642) said, "The universe cannot be read until we have learned the language and become familiar with the characters in which it is written. It is written in mathematical language, and the letters are triangles, circles and other geometrical figures, without which means it is humanly impossible to comprehend a single word. Without these, one is wandering about in a dark labyrinth." Carl Friedrich Gauss (1777–1855) referred to mathematics as "the Queen of the Sciences". Benjamin Peirce (1809–1880) called mathematics "the science that draws necessary conclusions". David Hilbert said of mathematics: "We are not speaking here of arbitrariness in any sense. Mathematics is not like a game whose tasks are determined by arbitrarily stipulated rules. Rather, it is a conceptual system possessing internal necessity that can only be so and by no means otherwise." Albert Einstein (1879–1955) stated that "as far as the laws of mathematics refer to reality, they are not certain; and as far as they are certain, they do not refer to reality."\nMathematics is essential in many fields, including natural science, engineering, medicine, finance and the social sciences. Applied mathematics has led to entirely new mathematical disciplines, such as statistics and game theory. Mathematicians also engage in pure mathematics, or mathematics for its own sake, without having any application in mind. There is no clear line separating pure and applied mathematics, and practical applications for what began as pure mathematics are often discovered.',title:"Mathematics"},"Mech. Inf.":{image:"Mechanized infantry.jpg",summary:'Mechanized infantry are infantry equipped with armored personnel carriers (APCs) or infantry fighting vehicles (IFVs) for transport and combat (see also mechanized force).\nMechanized infantry is distinguished from motorized infantry in that its vehicles provide a degree of protection from hostile fire, as opposed to "soft-skinned" wheeled vehicles (trucks or jeeps) for motorized infantry. Most APCs and IFVs are fully tracked or are all-wheel drive vehicles (6×6 or 8×8), for mobility across rough ground. Some nations distinguish between mechanized and armored infantry, designating troops carried by APCs as mechanized and those in IFVs as armored.\nThe support weapons for mechanized infantry are also provided with motorized transport, or they are built directly into combat vehicles to keep pace with the mechanized infantry in combat. For units equipped with most types of APC or any type of IFV, fire support weapons, such as machine guns, autocannons, small-bore direct-fire howitzers, and anti-tank guided missiles are often mounted directly on the infantry\'s own transport vehicles.\nCompared with "light" truck-mobile infantry, mechanized infantry can maintain rapid tactical movement and, if mounted in IFVs, have more integral firepower. It requires more combat supplies (ammunition and especially fuel) and ordnance supplies (spare vehicle components), and a comparatively larger proportion of manpower is required to crew and maintain the vehicles. For example, most APCs mount a section of seven or eight infantrymen but have a crew of two. Most IFVs carry only six or seven infantry but require a crew of three. To be effective in the field, mechanized units also require many mechanics, with specialized maintenance and recovery vehicles and equipment.',title:"Mechanized infantry"},Medicine:{image:"Medicine.jpg",summary:'Medicine is the science and practice of the diagnosis, treatment, and prevention of disease. Medicine encompasses a variety of health care practices evolved to maintain and restore health by the prevention and treatment of illness. Contemporary medicine applies biomedical sciences, biomedical research, genetics, and medical technology to diagnose, treat, and prevent injury and disease, typically through pharmaceuticals or surgery, but also through therapies as diverse as psychotherapy, external splints and traction, medical devices, biologics, and ionizing radiation, amongst others.\nMedicine has existed for thousands of years, during most of which it was an art (an area of skill and knowledge) frequently having connections to the religious and philosophical beliefs of local culture. For example, a medicine man would apply herbs and say prayers for healing, or an ancient philosopher and physician would apply bloodletting according to the theories of humorism. In recent centuries, since the advent of modern science, most medicine has become a combination of art and science (both basic and applied, under the umbrella of medical science). While stitching technique for sutures is an art learned through practice, the knowledge of what happens at the cellular and molecular level in the tissues being stitched arises through science.\nPrescientific forms of medicine are now known as traditional medicine and folk medicine. They remain commonly used with or instead of scientific medicine and are thus called alternative medicine. For example, evidence on the effectiveness of acupuncture is "variable and inconsistent" for any condition, but is generally safe when done by an appropriately trained practitioner. In contrast, treatments outside the bounds of safety and efficacy are termed quackery.',title:"Medicine"},Metallurgy:{image:"Metallurgy.jpg",summary:"Metallurgy is a domain of materials science and engineering that studies the physical and chemical behavior of metallic elements, their inter-metallic compounds, and their mixtures, which are called alloys. Metallurgy is also the technology of metals: the way in which science is applied to the production of metals, and the engineering of metal components for usage in products for consumers and manufacturers. The production of metals involves the processing of ores to extract the metal they contain, and the mixture of metals, sometimes with other elements, to produce alloys. Metallurgy is distinguished from the craft of metalworking, although metalworking relies on metallurgy, as medicine relies on medical science, for technical advancement.\nMetallurgy is subdivided into ferrous metallurgy (also known as black metallurgy) and non-ferrous metallurgy (also known as colored metallurgy).\nFerrous metallurgy involves processes and alloys based on iron while non-ferrous metallurgy involves processes and alloys based on other metals. The production of ferrous metals accounts for 95 percent of world metal production.",title:"Metallurgy"},"Mfg. Plant":{image:"Factory.jpg",summary:'A factory (previously manufactory) or manufacturing plant is an industrial site, usually consisting of buildings and machinery, or more commonly a complex having several buildings, where workers manufacture goods or operate machines processing one product into another.\nFactories arose with the introduction of machinery during the Industrial Revolution when the capital and space requirements became too great for cottage industry or workshops. Early factories that contained small amounts of machinery, such as one or two spinning mules, and fewer than a dozen workers have been called "glorified workshops".\nMost modern factories have large warehouses or warehouse-like facilities that contain heavy equipment used for assembly line production. Large factories tend to be located with access to multiple modes of transportation, with some having rail, highway and water loading and unloading facilities.\nFactories may either make discrete products or some type of material continuously produced such as chemicals, pulp and paper, or refined oil products. Factories manufacturing chemicals are often called plants and may have most of their equipment – tanks, pressure vessels, chemical reactors, pumps and piping – outdoors and operated from control rooms. Oil refineries have most of their equipment outdoors.\nDiscrete products may be final consumer goods, or parts and sub-assemblies which are made into final products elsewhere. Factories may be supplied parts from elsewhere or make them from raw materials. Continuous production industries typically use heat or electricity to transform streams of raw materials into finished products.\nThe term mill originally referred to the milling of grain, which usually used natural resources such as water or wind power until those were displaced by steam power in the 19th century. Because many processes like spinning and weaving, iron rolling, and paper manufacturing were originally powered by water, the term survives as in steel mill, paper mill, etc.',title:"Factory"},"Michelangelo's Chapel":{image:"Sistine Chapel.jpg",summary:"The Sistine Chapel (; Latin: Sacellum Sixtinum; Italian: Cappella Sistina [kapˈpɛlla siˈstiːna]) is a chapel in the Apostolic Palace, the official residence of the Pope, in Vatican City. Originally known as the Cappella Magna, the chapel takes its name from Pope Sixtus IV, who restored it between 1477 and 1480. Since that time, the chapel has served as a place of both religious and functionary papal activity. Today it is the site of the Papal conclave, the process by which a new pope is selected. The fame of the Sistine Chapel lies mainly in the frescos that decorate the interior, and most particularly the Sistine Chapel ceiling and The Last Judgment by Michelangelo.\nDuring the reign of Sixtus IV, a team of Renaissance painters that included Sandro Botticelli, Pietro Perugino, Pinturicchio, Domenico Ghirlandaio and Cosimo Roselli, created a series of frescos depicting the Life of Moses and the Life of Christ, offset by papal portraits above and trompe l’oeil drapery below. These paintings were completed in 1482, and on 15 August 1483 Sixtus IV celebrated the first mass in the Sistine Chapel for the Feast of the Assumption, at which ceremony the chapel was consecrated and dedicated to the Virgin Mary.\nBetween 1508 and 1512, under the patronage of Pope Julius II, Michelangelo painted the chapel's ceiling, a project which changed the course of Western art and is regarded as one of the major artistic accomplishments of human civilization. In a different climate after the Sack of Rome, he returned and between 1535 and 1541, painted The Last Judgment for Popes Clement VII and Paul III. The fame of Michelangelo's paintings has drawn multitudes of visitors to the chapel ever since they were revealed five hundred years ago.",title:"Sistine Chapel"},Miniaturization:{image:"Miniaturization.jpg",summary:"Miniaturization (Br.Eng.: Miniaturisation) is the trend to manufacture ever smaller mechanical, optical and electronic products and devices. Examples include miniaturization of mobile phones, computers and vehicle engine downsizing. In electronics, Moore's Law predicted that the number of transistors on an integrated circuit for minimum component cost doubles every 18 months. This enables processors to be built in smaller sizes.\n\n",title:"Miniaturization"},"Mobile Warfare":{image:"Maneuver warfare.jpg",summary:"Maneuver warfare, or manoeuvre warfare, is a military strategy that advocates attempting to defeat the enemy by incapacitating their decision-making through shock and disruption.",title:"Maneuver warfare"},Monarchy:{image:"Monarchy.jpg",summary:"A monarchy is a form of government in which a group, generally a family representing a dynasty, embodies the country's national identity and its head, the monarch, exercises the role of sovereignty. The actual power of the monarch may vary from purely symbolic (crowned republic), to partial and restricted (constitutional monarchy), to completely autocratic (absolute monarchy). Traditionally the monarch's post is inherited and lasts until death or abdication. In contrast, elective monarchies require the monarch to be elected. Both types have further variations as there are widely divergent structures and traditions defining monarchy. For example, in some elected monarchies only pedigrees are taken into account for eligibility of the next ruler, whereas many hereditary monarchies impose requirements regarding the religion, age, gender, mental capacity, etc. Occasionally this might create a situation of rival claimants whose legitimacy is subject to effective election. There have been cases where the term of a monarch's reign is either fixed in years or continues until certain goals are achieved: an invasion being repulsed, for instance.\n\nMonarchic rule was the most common form of government until the 19th century. It is now usually a constitutional monarchy, in which the monarch retains a unique legal and ceremonial role, but exercises limited or no official political power: under the written or unwritten constitution, others have governing authority. Currently, 45 sovereign nations in the world have monarchs acting as heads of state, 16 of which are Commonwealth realms that recognise Queen Elizabeth II as their head of state. Most modern European monarchies are constitutional and hereditary with a largely ceremonial role, with the exception of the Vatican which is an elective theocracy and the Principalities of Liechtenstein and Monaco where the monarchs exercise unrestricted authority. The monarchies of Cambodia and Malaysia are constitutional with a largely ceremonial role, despite possessing significantly more social and legal clout than their European counterparts. The monarchs of Brunei, Morocco, Oman, Qatar, Saudi Arabia and Swaziland have more political influence than any other single source of authority in their nations, either by tradition or a constitutional mandate.",title:"Monarchy"},Monotheism:{image:"Monotheism.jpg",summary:"Monotheism has been defined as the belief in the existence of only one god that created the world, is all-powerful and intervenes in the world. A broader definition of monotheism is the belief in one god. A distinction may be made between exclusive monotheism, and both inclusive monotheism and pluriform (panentheistic) monotheism which, while recognising various distinct gods, postulate some underlying unity.\nMonotheism is distinguished from henotheism, a religious system in which the believer worships one god without denying that others may worship different gods with equal validity, and monolatrism, the recognition of the existence of many gods but with the consistent worship of only one deity.\nThe broader definition of monotheism characterizes the traditions of Bábism, the Bahá'í Faith, Cao Dai (Caodaiism), Cheondoism (Cheondogyo), Christianity, Deism, Eckankar, Hindu sects such as Shaivism and Vaishnavism, Islam, Judaism, Mandaeism, Rastafari, Seicho no Ie, Sikhism, Tengrism (Tangrism), Tenrikyo (Tenriism), Yazidism, and Zoroastrianism, and elements of pre-monotheistic thought are found in early religions such as Atenism, Ancient Chinese religion, and Yahwism.",title:"Monotheism"},Musketeers:{image:"Musketeer.jpg",summary:'A musketeer (French: mousquetaire) was a type of soldier equipped with a musket. Musketeers were an important part of early modern armies, particularly in Europe and the west, as they normally comprised the majority of their infantry. The musketeer was a precursor to the rifleman. Muskets were replaced by rifles in most western armies during the mid-1850s. The traditional designation of "musketeer" for an infantry private survived in the Imperial German Army until World War I.',title:"Musketeer"},Mysticism:{image:"Mysticism.jpg",summary:'Mysticism is popularly known as becoming one with God or the Absolute, but may refer to any kind of ecstasy or altered state of consciousness which is given a religious or spiritual meaning. It may also refer to the attainment of insight in ultimate or hidden truths, and to human transformation supported by various practices and experiences.\nThe term "mysticism" has Ancient Greek origins with various historically determined meanings. Derived from the Greek word μυω, meaning "to conceal", mysticism referred to the biblical liturgical, spiritual, and contemplative dimensions of early and medieval Christianity. During the early modern period, the definition of mysticism grew to include a broad range of beliefs and ideologies related to "extraordinary experiences and states of mind".\nIn modern times, "mysticism" has acquired a limited definition, with broad applications, as meaning the aim at the "union with the Absolute, the Infinite, or God". This limited definition has been applied to a wide range of religious traditions and practices, valuing "mystical experience" as a key element of mysticism.\nBroadly defined, mysticism can be found in all religious traditions, from indigenous religions and folk religions like shamanism, to organised religions like the Abrahamic faiths and Indian religions, and modern spirituality, New Age and New Religious Movements.\nSince the 1960s scholars have debated the merits of perennial and constructionist approaches in the scientific research of "mystical experiences". The perennial position is now "largely dismissed by scholars", most scholars using a contextual approach, which takes the cultural and historical context into consideration.',title:"Mysticism"},Navigation:{image:"Navigation.jpg",summary:"Navigation is a field of study that focuses on the process of monitoring and controlling the movement of a craft or vehicle from one place to another. The field of navigation includes four general categories: land navigation, marine navigation, aeronautic navigation, and space navigation.\nIt is also the term of art used for the specialized knowledge used by navigators to perform navigation tasks. All navigational techniques involve locating the navigator's position compared to known locations or patterns.\nNavigation, in a broader sense, can refer to any skill or study that involves the determination of position and direction. In this sense, navigation includes orienteering and pedestrian navigation.",title:"Navigation"},Nuclear:{image:"Nuclear weapon.jpg",summary:'A nuclear weapon is an explosive device that derives its destructive force from nuclear reactions, either fission (fission bomb) or from a combination of fission and fusion reactions (thermonuclear bomb). Both bomb types release large quantities of energy from relatively small amounts of matter. The first test of a fission ("atomic") bomb released an amount of energy approximately equal to 20,000 tons of TNT (84 TJ). The first thermonuclear ("hydrogen") bomb test released energy approximately equal to 10 million tons of TNT (42 PJ). A thermonuclear weapon weighing little more than 2,400 pounds (1,100 kg) can release energy equal to more than 1.2 million tons of TNT (5.0 PJ). A nuclear device no larger than traditional bombs can devastate an entire city by blast, fire, and radiation. Since they are weapons of mass destruction, the proliferation of nuclear weapons is a focus of international relations policy.\nNuclear weapons have been used twice in war, both times by the United States against Japan near the end of World War II. On August 6, 1945, the U.S. Army Air Forces detonated a uranium gun-type fission bomb nicknamed "Little Boy" over the Japanese city of Hiroshima; three days later, on August 9, the U.S. Army Air Forces detonated a plutonium implosion-type fission bomb nicknamed "Fat Man" over the Japanese city of Nagasaki. These bombings resulted in the deaths of approximately 200,000 civilians and military personnel from injuries sustained from the explosions. The ethics of these bombings and their role in Japan\'s surrender are subjects of debate.\nSince the atomic bombings of Hiroshima and Nagasaki, nuclear weapons have been detonated over two thousand times for testing and demonstration. Only a few nations possess such weapons or are suspected of seeking them. The only countries known to have detonated nuclear weapons—and acknowledge possessing them—are (chronologically by date of first test) the United States, the Soviet Union (succeeded as a nuclear power by Russia), the United Kingdom, France, China, India, Pakistan, and North Korea. Israel is believed to possess nuclear weapons, though, in a policy of deliberate ambiguity, it does not acknowledge having them. Germany, Italy, Turkey, Belgium and the Netherlands are nuclear weapons sharing states. South Africa is the only country to have independently developed and then renounced and dismantled its nuclear weapons.\nThe Treaty on the Non-Proliferation of Nuclear Weapons aims to reduce the spread of nuclear weapons, but its effectiveness has been questioned, and political tensions remained high in the 1970s and 1980s. Modernisation of weapons continues to this day.',title:"Nuclear weapon"},"Nuclear Fission":{image:"Nuclear fission.jpg",summary:"In nuclear physics and nuclear chemistry, nuclear fission is either a nuclear reaction or a radioactive decay process in which the nucleus of an atom splits into smaller parts (lighter nuclei). The fission process often produces free neutrons and gamma photons, and releases a very large amount of energy even by the energetic standards of radioactive decay.\nNuclear fission of heavy elements was discovered on December 17, 1938 by German Otto Hahn and his assistant Fritz Strassmann, and explained theoretically in January 1939 by Lise Meitner and her nephew Otto Robert Frisch. Frisch named the process by analogy with biological fission of living cells. It is an exothermic reaction which can release large amounts of energy both as electromagnetic radiation and as kinetic energy of the fragments (heating the bulk material where fission takes place). In order for fission to produce energy, the total binding energy of the resulting elements must be less negative (higher energy) than that of the starting element.\nFission is a form of nuclear transmutation because the resulting fragments are not the same element as the original atom. The two nuclei produced are most often of comparable but slightly different sizes, typically with a mass ratio of products of about 3 to 2, for common fissile isotopes. Most fissions are binary fissions (producing two charged fragments), but occasionally (2 to 4 times per 1000 events), three positively charged fragments are produced, in a ternary fission. The smallest of these fragments in ternary processes ranges in size from a proton to an argon nucleus.\nApart from fission induced by a neutron, harnessed and exploited by humans, a natural form of spontaneous radioactive decay (not requiring a neutron) is also referred to as fission, and occurs especially in very high-mass-number isotopes. Spontaneous fission was discovered in 1940 by Flyorov, Petrzhak and Kurchatov in Moscow, when they decided to confirm that, without bombardment by neutrons, the fission rate of uranium was indeed negligible, as predicted by Niels Bohr; it was not.\nThe unpredictable composition of the products (which vary in a broad probabilistic and somewhat chaotic manner) distinguishes fission from purely quantum-tunneling processes such as proton emission, alpha decay, and cluster decay, which give the same products each time. Nuclear fission produces energy for nuclear power and drives the explosion of nuclear weapons. Both uses are possible because certain substances called nuclear fuels undergo fission when struck by fission neutrons, and in turn emit neutrons when they break apart. This makes possible a self-sustaining nuclear chain reaction that releases energy at a controlled rate in a nuclear reactor or at a very rapid uncontrolled rate in a nuclear weapon.\nThe amount of free energy contained in nuclear fuel is millions of times the amount of free energy contained in a similar mass of chemical fuel such as gasoline, making nuclear fission a very dense source of energy. The products of nuclear fission, however, are on average far more radioactive than the heavy elements which are normally fissioned as fuel, and remain so for significant amounts of time, giving rise to a nuclear waste problem. Concerns over nuclear waste accumulation and over the destructive potential of nuclear weapons are a counterbalance to the peaceful desire to use fission as an energy source, and give rise to ongoing political debate over nuclear power.",title:"Nuclear fission"},"Nuclear Plant":{image:"Nuclear power plant.jpg",summary:"A nuclear power plant or nuclear power station is a thermal power station in which the heat source is a nuclear reactor. As is typical in all conventional thermal power stations the heat is used to generate steam which drives a steam turbine connected to an electric generator which produces electricity. As of 23 April 2014, the IAEA report there are 449 nuclear power reactors in operation operating in 31 countries.\nNuclear power stations are usually considered to be base load stations since fuel is a small part of the cost of production. Their operations and maintenance (O&M) and fuel costs are, along with hydropower stations, at the low end of the spectrum and make them suitable as base-load power suppliers. The cost of spent fuel management, however, is somewhat uncertain.",title:"Nuclear power plant"},"Nuclear Power":{image:"Nuclear power.jpg",summary:"Nuclear power is the use of nuclear reactions that release nuclear energy to generate heat, which most frequently is then used in steam turbines to produce electricity in a nuclear power plant. The term includes nuclear fission, nuclear decay and nuclear fusion. Presently, the nuclear fission of elements in the actinide series of the periodic table produce the vast majority of nuclear energy in the direct service of humankind, with nuclear decay processes, primarily in the form of geothermal energy, and radioisotope thermoelectric generators, in niche uses making up the rest.\nOwing, fundamentally, to the control on the power or heat increase, that is inherent to the slow delayed critical fission process, Fission-electric power stations and engines have and continue to be built, as an alternative to the dominant fossil-fuel power systems of the world. Fission-electricity is one of the leading low carbon power generation methods of producing electricity, and in terms of total life-cycle greenhouse gas emissions per unit of energy generated, has emission values lower than renewable energy when the latter is taken as a single energy source. A 2014 analysis of the carbon footprint literature by the Intergovernmental Panel on Climate Change (IPCC) reported that the embodied total life-cycle emission intensity of fission electricity has a median value of 12 g CO2eq/kWh which is the lowest out of all commercial baseload energy sources. This is contrasted with coal and fossil gas at 820 and 490 g CO2 eq/kWh. From the beginning of fission-electric power station commercialization in the 1970s, nuclear power prevented the emission of about 64 billion tonnes of carbon dioxide equivalent that would have otherwise resulted from the burning of fossil fuels in thermal power stations.\nThere is a social debate about nuclear power. Proponents, such as the World Nuclear Association and Environmentalists for Nuclear Energy, contend that nuclear power is a safe, sustainable energy source that reduces carbon emissions. Opponents, such as Greenpeace International and NIRS, contend that nuclear power poses many threats to people and the environment. Far-reaching fission power reactor accidents, or accidents that resulted in medium to long-lived fission product contamination of inhabited areas, have occurred in Generation I and II reactor designs. These include the Chernobyl disaster in 1986, the Fukushima Daiichi nuclear disaster in 2011, and the more contained Three Mile Island accident in 1979. There have also been some nuclear submarine accidents. In terms of lives lost per unit of energy generated, analysis has determined that fission-electric reactors have caused fewer fatalities per unit of energy generated than the other major sources of energy generation. Energy production from coal, petroleum, natural gas and hydroelectricity has caused a greater number of fatalities per unit of energy generated due to air pollution and energy accident effects.\nAs of 2017, the International Atomic Energy Agency states that 60 reactors, mostly of Generation III reactor design, are under construction around the world, with the majority in Asia. Collaboration on research & developments towards greater passive nuclear safety, efficiency and recycling of spent fuel in future Generation IV reactors presently includes Euratom and the co-operation of more than 10 permanent countries globally.",title:"Nuclear power"},"Offshore Platform":{image:"Oil platform.jpg",summary:"An oil platform, offshore platform, or (colloquially) oil rig is a large structure with facilities for well drilling (optionally), to extract and process oil and natural gas, or to temporarily store product until it can be brought to shore for refining and marketing. In many cases, the platform contains facilities to house the workforce as well.\nDepending on the circumstances, the platform may be fixed to the ocean floor, may consist of an artificial island, or may float. Remote subsea wells may also be connected to a platform by flow lines and by umbilical connections. These sub-sea solutions may consist of one or more subsea wells, or of one or more manifold centres for multiple wells.",title:"Oil platform"},Oracle:{image:"Oracle.jpg",summary:"In classical antiquity, an oracle was a person or agency considered to provide wise and insightful counsel or prophetic predictions or precognition of the future, inspired by the gods. As such it is a form of divination.",title:"Oracle"},Palace:{image:"Palace.jpg",summary:"A palace is a grand residence, especially a royal residence, or the home of a head of state or some other high-ranking dignitary, such as a bishop or archbishop.\nThe word is derived from the Latin name Palātium, for Palatine Hill in Rome which housed the Imperial residences. In many parts of Europe, the term is also applied to ambitious private mansions of the aristocracy. Many historic palaces are now put to other uses such as parliaments, museums, hotels, or office buildings. The word is also sometimes used to describe a lavishly ornate building used for public entertainment or exhibitions.",title:"Palace"},Paratroopers:{image:"Paratrooper.jpg",summary:"Paratroopers are military parachutists — military personnel trained in parachuting into an operation and usually functioning as part of an airborne force. Military parachutists (troops) and parachutes were first used on a large scale during World War II for troop distribution and transportation. Paratroopers are often used to seize strategic objectives such as airfields or bridges.\n\n",title:"Paratrooper"},Partisan:{image:"Partisan (military).jpg",summary:"A partisan is a member of an irregular military force formed to oppose control of an area by a foreign power or by an army of occupation by some kind of insurgent activity. The term can apply to the field element of resistance movements, examples of which are the civilians who opposed Nazi German, Ustaše and Fascist Italian rule in several countries during World War II.",title:"Partisan (military)"},Phalanx:{image:"Phalanx.jpg",summary:'The phalanx (Ancient Greek: φάλαγξ; plural phalanxes or phalanges, φάλαγγες, phalanges) was a rectangular mass military formation, usually composed entirely of heavy infantry armed with spears, pikes, sarissas, or similar weapons. The term is particularly (and originally) used to describe the use of this formation in Ancient Greek warfare, although the ancient Greek writers used it to also describe any massed infantry formation, regardless of its equipment, as does Arrian in his Array against the Alans when he refers to his legions. In Greek texts, the phalanx may be deployed for battle, on the march, even camped, thus describing the mass of infantry or cavalry that would deploy in line during battle. They marched forward as one entity.\nThe term itself, as used today, does not refer to a distinctive military unit or division (e.g., the Roman legion or the contemporary Western-type battalion), but to the general formation of an army\'s troops. Thus a phalanx does not have a standard combat strength or composition but includes the total number of infantry, which is or will be deployed in action in a single phalanx formation.\n\nMany spear-armed troops historically fought in what might be termed phalanx-like formations. The word has come into use in common English to describe "a group of people standing, or moving forward closely together"; c.f. "a phalanx of police".\nThis article focuses on the use of the military phalanx formation in Ancient Greece, the Hellenistic world, and other ancient states heavily influenced by Greek civilization.',title:"Phalanx"},Philosophy:{image:"Philosophy.jpg",summary:'Philosophy (from Greek φιλοσοφία, philosophia, literally "love of wisdom") is the study of general and fundamental problems concerning matters such as existence, knowledge, values, reason, mind, and language. The term was probably coined by Pythagoras (c. 570–495 BCE). Philosophical methods include questioning, critical discussion, rational argument, and systematic presentation. Classic philosophical questions include: Is it possible to know anything and to prove it? What is most real? Philosophers also pose more practical and concrete questions such as: Is there a best way to live? Is it better to be just or unjust (if one can get away with it)? Do humans have free will?\nHistorically, "philosophy" encompassed any body of knowledge. From the time of Ancient Greek philosopher Aristotle to the 19th century, "natural philosophy" encompassed astronomy, medicine, and physics. For example, Newton\'s 1687 Mathematical Principles of Natural Philosophy later became classified as a book of physics. In the 19th century, the growth of modern research universities led academic philosophy and other disciplines to professionalize and specialize. In the modern era, some investigations that were traditionally part of philosophy became separate academic disciplines, including psychology, sociology, linguistics, and economics.\nOther investigations closely related to art, science, politics, or other pursuits remained part of philosophy. For example, is beauty objective or subjective? Are there many scientific methods or just one? Is political utopia a hopeful dream or hopeless fantasy? Major sub-fields of academic philosophy include metaphysics ("concerned with the fundamental nature of reality and being"), epistemology (about the "nature and grounds of knowledge [and]...its limits and validity" ), ethics, aesthetics, political philosophy, logic, philosophy of science, and the history of Western philosophy.\nSince the 20th century, professional philosophers contribute to society primarily as professors, researchers, and writers. However, many of those who study philosophy in undergraduate or graduate programs contribute in the fields of law, journalism, politics, religion, science, business and various art and entertainment activities.',title:"Philosophy"},Physics:{image:"Physics.jpg",summary:"Physics (from Ancient Greek: φυσική (ἐπιστήμη), translit. phusikḗ (epistḗmē), lit. 'knowledge of nature', from φύσις phúsis \"nature\") is the natural science that involves the study of matter and its motion and behavior through space and time, along with related concepts such as energy and force. One of the most fundamental scientific disciplines, the main goal of physics is to understand how the universe behaves.\nPhysics is one of the oldest academic disciplines, perhaps the oldest through its inclusion of astronomy. Over the last two millennia, physics was a part of natural philosophy along with chemistry, biology, and certain branches of mathematics, but during the scientific revolution in the 17th century, the natural sciences emerged as unique research programs in their own right. Physics intersects with many interdisciplinary areas of research, such as biophysics and quantum chemistry, and the boundaries of physics are not rigidly defined. New ideas in physics often explain the fundamental mechanisms of other sciences while opening new avenues of research in areas such as mathematics and philosophy.\nPhysics also makes significant contributions through advances in new technologies that arise from theoretical breakthroughs. For example, advances in the understanding of electromagnetism or nuclear physics led directly to the development of new products that have dramatically transformed modern-day society, such as television, computers, domestic appliances, and nuclear weapons; advances in thermodynamics led to the development of industrialization, and advances in mechanics inspired the development of calculus.",title:"Physics"},Pikemen:{image:"Pike square.jpg",summary:"The pike square (German: Gevierthaufen or Gewalthaufen, meaning crowd of force) was a military tactic developed by the Swiss Confederacy during the 15th century for use by its infantry.",title:"Pike square"},Plastics:{image:"Plastic.jpg",summary:"Plastic is material consisting of any of a wide range of synthetic or semi-synthetic organic compounds that are malleable and so can be molded into solid objects.\nPlasticity is the general property of all materials which can deform irreversibly without breaking but, in the class of moldable polymers, this occurs to such a degree that their actual name derives from this ability.\nPlastics are typically organic polymers of high molecular mass, but they often contain other substances. They are usually synthetic, most commonly derived from petrochemicals, but many are made from renewable materials such as polylactic acid from corn or cellulosics from cotton linters.\nDue to their relatively low cost, ease of manufacture, versatility, and imperviousness to water, plastics are used in an enormous and expanding range of products, from paper clips to spaceships. They have already displaced many traditional materials, such as wood, stone, horn and bone, leather, paper, metal, glass, and ceramic, in most of their former uses.\nIn developed countries, about a third of plastic is used in packaging and another third in buildings such as piping used in plumbing or vinyl siding. Other uses include automobiles (up to 20% plastic), furniture, and toys. In the developing world, the ratios may be different - for example, reportedly 42% of India's consumption is used in packaging.\nPlastics have many uses in the medical field as well, to include polymer implants, however the field of plastic surgery is not named for use of plastic materials, but rather the more generic meaning of the word plasticity, with regard to the reshaping of flesh.\nThe world's first fully synthetic plastic was bakelite, invented in New York in 1907 by Leo Baekeland who coined the term 'plastics'. Many chemists have contributed to the materials science of plastics, including Nobel laureate Hermann Staudinger who has been called \"the father of polymer chemistry\" and Herman Mark, known as \"the father of polymer physics\".\nThe success and dominance of plastics starting in the early 20th century led to environmental concerns regarding its slow decomposition rate after being discarded as trash due to its composition of very large molecules. Toward the end of the century, one approach to this problem was met with wide efforts toward recycling.",title:"Plastic"},"Police Station":{image:"Police station.jpg",summary:'A police station (sometimes called a "station house" in the US) is a building which serves to accommodate police officers and other members of staff. These buildings often contain offices and accommodation for personnel and vehicles, along with locker rooms, temporary holding cells and interview/interrogation rooms. In many countries, the commander of a police station is called a commissary.',title:"Police station"},Polytheism:{image:"Polytheism.jpg",summary:"Polytheism (from Greek πολυθεϊσμός, polytheismos) is the worship of or belief in multiple deities, which are usually assembled into a pantheon of gods and goddesses, along with their own religions and rituals. In most religions which accept polytheism, the different gods and goddesses are representations of forces of nature or ancestral principles, and can be viewed either as autonomous or as aspects or emanations of a creator God or transcendental absolute principle (monistic theologies), which manifests immanently in nature (panentheistic and pantheistic theologies). Most of the polytheistic deities of ancient religions, with the notable exceptions of the Ancient Egyptian and Hindu deities, were conceived as having physical bodies.\nPolytheism is a type of theism. Within theism, it contrasts with monotheism, the belief in a singular God, in most cases transcendent. Polytheists do not always worship all the gods equally, but they can be henotheists, specializing in the worship of one particular deity. Other polytheists can be kathenotheists, worshiping different deities at different times.\nPolytheism was the typical form of religion during the Bronze Age and Iron Age up to the Axial Age and the development of Abrahamic religions, the latter of which enforced strict monotheism. It is well documented in historical religions of Classical antiquity, especially ancient Greek religion and ancient Roman religion, and after the decline of Greco-Roman polytheism in tribal religions such as Germanic paganism or Slavic paganism.\nImportant polytheistic religions practiced today include Chinese traditional religion, Hinduism, Japanese Shinto, and various neopagan faiths.",title:"Polytheism"},"Port Facility":{image:"Port.jpg",summary:"A port is a location on a coast or shore containing one or more harbors where ships can dock and transfer people or cargo to or from land. Port locations are selected to optimize access to land and navigable water, for commercial demand, and for shelter from wind and waves. Ports with deeper water are rarer, but can handle larger ships. Since ports throughout history handled every kind of traffic, support and storage facilities vary widely, may extend for miles, and dominate the local economy. Some ports have an important military role.",title:"Port"},Pottery:{image:"Pottery.jpg",summary:'Pottery is the ceramic material which makes up potterywares, of which major types include earthenware, stoneware and porcelain. The place where such wares are made by a potter is also called a pottery (plural "potteries"). The definition of pottery used by the American Society for Testing and Materials (ASTM) is "all fired ceramic wares that contain clay when formed, except technical, structural, and refractory products."\nPottery is one of the oldest human inventions, originating before the Neolithic period, with ceramic objects like the Gravettian culture Venus of Dolní Věstonice figurine discovered in the Czech Republic date back to 29,000–25,000 BC, and pottery vessels that were discovered in Jiangxi, China, which date back to 18,000 BC. Early Neolithic pottery have been found in places such as Jomon Japan (10,500 BC), the Russian Far East (14,000 BC), Sub-Saharan Africa and South America.\nPottery is made by forming a ceramic (often clay) body into objects of a required shape and heating them to high temperatures in a kiln which removes all the water from the clay, which induces reactions that lead to permanent changes including increasing their strength and hardening and setting their shape. A clay body can be decorated before or after firing; however, prior to some shaping processes, clay must be prepared. Kneading helps to ensure an even moisture content throughout the body. Air trapped within the clay body needs to be removed. This is called de-airing and can be accomplished either by a machine called a vacuum pug or manually by wedging. Wedging can also help produce an even moisture content. Once a clay body has been kneaded and de-aired or wedged, it is shaped by a variety of techniques. After shaping, it is dried and then fired.',title:"Pottery"},"Power Plant":{image:"Power station.jpg",summary:"A power station, also referred to as a power plant or powerhouse and sometimes generating station or generating plant, is an industrial facility for the generation of electric power. Most power stations contain one or more generators, a rotating machine that converts mechanical power into electrical power. The relative motion between a magnetic field and a conductor creates an electrical current. The energy source harnessed to turn the generator varies widely. Most power stations in the world burn fossil fuels such as coal, oil, and natural gas to generate electricity. Others use nuclear power, but there is an increasing use of cleaner renewable sources such as solar, wind, wave and hydroelectric.",title:"Power station"},Pyramids:{image:"Giza pyramid complex.jpg",summary:'The Giza pyramid complex (Arabic: أهرامات الجيزة‎‎, IPA: [ʔɑhɾɑˈmɑːt elˈɡiːzæ], "pyramids of Giza") is an archaeological site on the Giza Plateau, on the outskirts of Cairo, Egypt.\nThis complex of ancient monuments includes the three pyramid complexes known as the Great Pyramids, the massive sculpture known as the Great Sphinx, several cemeteries, a workers\' village and an industrial complex. It is located in the Libyan Desert, approximately 9 km (5 mi) west of the Nile river at the old town of Giza, and about 13 km (8 mi) southwest of Cairo city centre.\nThe pyramids, which have historically loomed large as emblems of ancient Egypt in the Western imagination, were popularised in Hellenistic times, when the Great Pyramid was listed by Antipater of Sidon as one of the Seven Wonders of the World. It is by far the oldest of the ancient Wonders and the only one still in existence.',title:"Giza pyramid complex"},Radio:{image:"Radio.jpg",summary:"Radio is the technology of using radio waves to carry information, such as sound, by systematically modulating properties of electromagnetic energy waves transmitted through space, such as their amplitude, frequency, phase, or pulse width. When radio waves strike an electrical conductor, the oscillating fields induce an alternating current in the conductor. The information in the waves can be extracted and transformed back into its original form.\nRadio systems need a transmitter to modulate (change) some property of the energy produced to impress a signal on it, for example using amplitude modulation or angle modulation (which can be frequency modulation or phase modulation). Radio systems also need an antenna to convert electric currents into radio waves, and radio waves into an electric current. An antenna can be used for both transmitting and receiving. The electrical resonance of tuned circuits in radios allow individual stations to be selected. The electromagnetic wave is intercepted by a tuned receiving antenna. A radio receiver receives its input from an antenna and converts it into a form that is usable for the consumer, such as sound, pictures, digital data, measurement values, navigational positions, etc. Radio frequencies occupy the range from a 3 kHz to 300 GHz, although commercially important uses of radio use only a small part of this spectrum.\nA radio communication system sends signals by radio. The radio equipment involved in communication systems includes a transmitter and a receiver, each having an antenna and appropriate terminal equipment such as a microphone at the transmitter and a loudspeaker at the receiver in the case of a voice-communication system.",title:"Radio"},Railroad:{image:"Rail transport.jpg",summary:"Rail transport is a means of transferring of passengers and goods on wheeled vehicles running on rails, also known as tracks. It is also commonly referred to as train transport. In contrast to road transport, where vehicles run on a prepared flat surface, rail vehicles (rolling stock) are directionally guided by the tracks on which they run. Tracks usually consist of steel rails, installed on ties (sleepers) and ballast, on which the rolling stock, usually fitted with metal wheels, moves. Other variations are also possible, such as slab track, where the rails are fastened to a concrete foundation resting on a prepared subsurface.\nRolling stock in a rail transport system generally encounters lower frictional resistance than road vehicles, so passenger and freight cars (carriages and wagons) can be coupled into longer trains. The operation is carried out by a railway company, providing transport between train stations or freight customer facilities. Power is provided by locomotives which either draw electric power from a railway electrification system or produce their own power, usually by diesel engines. Most tracks are accompanied by a signalling system. Railways are a safe land transport system when compared to other forms of transport. Railway transport is capable of high levels of passenger and cargo utilization and energy efficiency, but is often less flexible and more capital-intensive than road transport, when lower traffic levels are considered.\nThe oldest known, man/animal-hauled railways date back to the 6th century BC in Corinth, Greece. Rail transport then commenced in mid 16th century in Germany in form of horse-powered funiculars and wagonways. Modern rail transport commenced with the British development of the steam locomotives in the early 19th century. Thus the railway system in Great Britain is the oldest in the world. Built by George Stephenson and his son Robert's company Robert Stephenson and Company, the Locomotion No. 1 is the first steam locomotive to carry passengers on a public rail line, the Stockton and Darlington Railway in 1825. George also built the first public inter-city railway line in the world to use only the steam locomotives all the time, the Liverpool and Manchester Railway which opened in 1830. With steam engines, one could construct mainline railways, which were a key component of the Industrial Revolution. Also, railways reduced the costs of shipping, and allowed for fewer lost goods, compared with water transport, which faced occasional sinking of ships. The change from canals to railways allowed for \"national markets\" in which prices varied very little from city to city. The invention and development of the railway in the United Kingdom was one of the most important technological inventions of the 19th century. The world's first underground railway, the Metropolitan Railway (part of the London Underground), opened in 1863.\nIn the 1880s, electrified trains were introduced, leading to electrification of tramways and rapid transit systems. Starting during the 1940s, the non-electrified railways in most countries had their steam locomotives replaced by diesel-electric locomotives, with the process being almost complete by 2000s. During the 1960s, electrified high-speed railway systems were introduced in Japan and later in some other countries. Many countries are in process of replacing diesel locomotives with electric locomotives, mainly due to environmental concerns, a notable example being Switzerland, which has completely electrified its network. Other forms of guided ground transport outside the traditional railway definitions, such as monorail or maglev, have been tried but have seen limited use.\nFollowing decline after World War II due to competition from cars, rail transport has had a revival in recent decades due to road congestion and rising fuel prices, as well as governments investing in rail as a means of reducing CO2 emissions in the context of concerns about global warming.",title:"Rail transport"},Recycling:{image:"Recycling.jpg",summary:'Recycling is the process of converting waste materials into new materials and objects. It is an alternative to "conventional" waste disposal that can save material and help lower greenhouse gas emissions (compared to plastic production, for example). Recycling can prevent the waste of potentially useful materials and reduce the consumption of fresh raw materials, thereby reducing: energy usage, air pollution (from incineration), and water pollution (from landfilling).\nRecycling is a key component of modern waste reduction and is the third component of the "Reduce, Reuse, and Recycle" waste hierarchy.\nThere are some ISO standards related to recycling such as ISO 15270:2008 for plastics waste and ISO 14001:2004 for environmental management control of recycling practice.\nRecyclable materials include many kinds of glass, paper, and cardboard, metal, plastic, tires, textiles, and electronics. The composting or other reuse of biodegradable waste—such as food or garden waste—is also considered recycling. Materials to be recycled are either brought to a collection center or picked up from the curbside, then sorted, cleaned, and reprocessed into new materials destined for manufacturing.\nIn the strictest sense, recycling of a material would produce a fresh supply of the same material—for example, used office paper would be converted into new office paper or used polystyrene foam into new polystyrene. However, this is often difficult or too expensive (compared with producing the same product from raw materials or other sources), so "recycling" of many products or materials involves their reuse in producing different materials (for example, paperboard) instead. Another form of recycling is the salvage of certain materials from complex products, either due to their intrinsic value (such as lead from car batteries, or gold from circuit boards), or due to their hazardous nature (e.g., removal and reuse of mercury from thermometers and thermostats).',title:"Recycling"},"Recycling Center":{image:"Recycling.jpg",summary:'Recycling is the process of converting waste materials into new materials and objects. It is an alternative to "conventional" waste disposal that can save material and help lower greenhouse gas emissions (compared to plastic production, for example). Recycling can prevent the waste of potentially useful materials and reduce the consumption of fresh raw materials, thereby reducing: energy usage, air pollution (from incineration), and water pollution (from landfilling).\nRecycling is a key component of modern waste reduction and is the third component of the "Reduce, Reuse, and Recycle" waste hierarchy.\nThere are some ISO standards related to recycling such as ISO 15270:2008 for plastics waste and ISO 14001:2004 for environmental management control of recycling practice.\nRecyclable materials include many kinds of glass, paper, and cardboard, metal, plastic, tires, textiles, and electronics. The composting or other reuse of biodegradable waste—such as food or garden waste—is also considered recycling. Materials to be recycled are either brought to a collection center or picked up from the curbside, then sorted, cleaned, and reprocessed into new materials destined for manufacturing.\nIn the strictest sense, recycling of a material would produce a fresh supply of the same material—for example, used office paper would be converted into new office paper or used polystyrene foam into new polystyrene. However, this is often difficult or too expensive (compared with producing the same product from raw materials or other sources), so "recycling" of many products or materials involves their reuse in producing different materials (for example, paperboard) instead. Another form of recycling is the salvage of certain materials from complex products, either due to their intrinsic value (such as lead from car batteries, or gold from circuit boards), or due to their hazardous nature (e.g., removal and reuse of mercury from thermometers and thermostats).',title:"Recycling"},Refining:{image:null,summary:"Refining (also perhaps called by the mathematical term affining) is the process of purification of a (1) substance or a (2) form. The term is usually used of a natural resource that is almost in a usable form, but which is more useful in its pure form. For instance, most types of natural petroleum will burn straight from the ground, but it will burn poorly and quickly clog an engine with residues and by-products. The term is broad, and may include more drastic transformations, such as the reduction of ore to metal (for which see Refining (metallurgy)).\nThe refining of liquids is often accomplished by distillation or fractionation; this process is useful, for example, for isolating different fractions of petroleum. Gases can be refined in this way as well, by being cooled and/or compressed until they liquefy. Gases and liquids can also be refined by extraction with a selective solvent that dissolves away either the substance of interest, or the unwanted impurities.\nMany solids can be refined by growing crystals in a solution of the impure material; the regular structure of the crystal tends to favor the desired material and exclude other kinds of particles.\nChemical reactions are often used to remove impurities of particular types.\nThe use of silicon and other semiconductors in electronics depends on precise control of impurities. The zone melting process developed by William Gardner Pfann was used to produce pure germanium, and subsequently float-zone silicon became available when Henry Theuerer of Bell Labs adapted Pfann's method to silicon.\nTypes of materials that are usually refined:\nmetals - see Refining (metallurgy)\npetroleum\nsilicon\nsugar\ntable salt\nvegetable oil\nair",title:"Refining"},Refrigeration:{image:"Refrigeration.jpg",summary:"Refrigeration is a process of removing heat from a low-temperature reservoir and transferring it to a high-temperature reservoir. The work of heat transfer is traditionally driven by mechanical means, but can also be driven by heat, magnetism, electricity, laser, or other means. Refrigeration has many applications, including, but not limited to: household refrigerators, industrial freezers, cryogenics, and air conditioning. Heat pumps may use the heat output of the refrigeration process, and also may be designed to be reversible, but are otherwise similar to air conditioning units.\nRefrigeration has had a large impact on industry, lifestyle, agriculture, and settlement patterns. The idea of preserving food dates back to at least the ancient Roman and Chinese empires. However, mechanical refrigeration technology has rapidly evolved in the last century, from ice harvesting to temperature-controlled rail cars. The introduction of refrigerated rail cars contributed to the westward expansion of the United States, allowing settlement in areas that were not on main transport channels such as rivers, harbors, or valley trails. Settlements were also developing in infertile parts of the country, filled with newly discovered natural resources. These new settlement patterns sparked the building of large cities which are able to thrive in areas that were otherwise thought to be inhospitable, such as Houston, Texas, and Las Vegas, Nevada. In most developed countries, cities are heavily dependent upon refrigeration in supermarkets, in order to obtain their food for daily consumption. The increase in food sources has led to a larger concentration of agricultural sales coming from a smaller percentage of existing farms. Farms today have a much larger output per person in comparison to the late 1800s. This has resulted in new food sources available to entire populations, which has had a large impact on the nutrition of society.\nAmmonia was one of the first refrigerants.",title:"Refrigeration"},Republic:{image:"Republic.jpg",summary:'A republic (Latin: res publica) is a form of government in which the country is considered a "public matter", not the private concern or property of the rulers. The primary positions of power within a republic are not inherited, but are attained through elections expressing the consent of the governed. Such leadership positions are therefore expected to fairly represent the citizen body. It is a form of government under which the head of state is not a monarch. In American English, the definition of a republic can also refer specifically to a government in which elected individuals represent the citizen body, known elsewhere as a representative democracy (a democratic republic) and exercise power according to the rule of law (a constitutional republic).\nAs of 2017, 159 of the world\'s 206 sovereign states use the word "republic" as part of their official names – not all of these are republics in the sense of having elected governments, nor is the word "republic" used in the names of all nations with elected governments. While heads-of-state often tend to claim that they rule only by the "consent of the governed", elections in some countries have been found to be held more for the purpose of “show” than for the actual purpose of in reality providing citizens with any genuine ability to choose their own leaders.\nThe term “republic” was first coined ca. 500 BC in Rome, but over time the term has undergone several changes in meaning. Initially the Latin term “res publica” signified the earlier “partial form of democracy” as found in Rome from c. 500 BC until c. 27 BC. In this early Roman partial-democracy, the power of the aristocratic or patrician class who held all of the seats in the Roman Senate, was checked by the institution of the consulship, whose two consul/vice-rulers were elected annually by the free citizens or plebes of Rome. The ancient Roman definition of the word differs from the modern use of the term, where no leadership positions are held to be restricted to only the "ruling class".\nMost often a republic is a single sovereign state, but there are also sub-sovereign state entities that are referred to as republics, or that have governments that are described as "republican" in nature. For instance, Article IV of the United States Constitution "guarantee[s] to every State in this Union a Republican form of Government". In contrast, the former Soviet Union, which described itself as being a group of "Republics" and also as a "federal multinational state composed of 15 republics", was widely viewed as being an authoritarian form of government and not as a republican form of government. It was seen as authoritarian, as its electoral system was structured so as to automatically guarantee the election of government sponsored candidates.',title:"Republic"},"Research Lab":{image:"Laboratory.jpg",summary:"A laboratory (CommE  or , AmE ; informally, lab) is a facility that provides controlled conditions in which scientific or technological research, experiments, and measurement may be performed.",title:"Laboratory"},Riflemen:{image:"Rifleman.jpg",summary:"A rifleman is an infantry soldier armed with a rifled long gun. Although the rifleman role had its origin with 16th century hand cannoneers and 17th century musketeers, the term originated in the 18th century with the introduction of the rifled musket. By the mid-19th century, entire regiments of riflemen were formed and became the mainstay of all standard infantry. Rifleman became a term for any common infantryman.",title:"Rifleman"},Robotics:{image:"Robotics.jpg",summary:"Robotics is an interdisciplinary branch of engineering and science that includes mechanical engineering, electrical engineering, computer science, and others. Robotics deals with the design, construction, operation, and use of robots, as well as computer systems for their control, sensory feedback, and information processing.\nThese technologies are used to develop machines that can substitute for humans. Robots can be used in any situation and for any purpose, but today many are used in dangerous environments (including bomb detection and de-activation), manufacturing processes, or where humans cannot survive. Robots can take on any form but some are made to resemble humans in appearance. This is said to help in the acceptance of a robot in certain replicative behaviors usually performed by people. Such robots attempt to replicate walking, lifting, speech, cognition, and basically anything a human can do. Many of today's robots are inspired by nature, contributing to the field of bio-inspired robotics.\nThe concept of creating machines that can operate autonomously dates back to classical times, but research into the functionality and potential uses of robots did not grow substantially until the 20th century. Throughout history, it has been frequently assumed that robots will one day be able to mimic human behavior and manage tasks in a human-like fashion. Today, robotics is a rapidly growing field, as technological advances continue; researching, designing, and building new robots serve various practical purposes, whether domestically, commercially, or militarily. Many robots are built to do jobs that are hazardous to people such as defusing bombs, finding survivors in unstable ruins, and exploring mines and shipwrecks. Robotics is also used in STEM (Science, Technology, Engineering, and Mathematics) as a teaching aid.",title:"Robotics"},Rocketry:{image:"Rocket.jpg",summary:'A rocket (from Italian rocchetto "bobbin") is a missile, spacecraft, aircraft or other vehicle that obtains thrust from a rocket engine. Rocket engine exhaust is formed entirely from propellant carried within the rocket before use. Rocket engines work by action and reaction and push rockets forward simply by expelling their exhaust in the opposite direction at high speed, and can therefore work in the vacuum of space.\nIn fact, rockets work more efficiently in space than in an atmosphere. Multistage rockets are capable of attaining escape velocity from Earth and therefore can achieve unlimited maximum altitude. Compared with airbreathing engines, rockets are lightweight and powerful and capable of generating large accelerations. To control their flight, rockets rely on momentum, airfoils, auxiliary reaction engines, gimballed thrust, momentum wheels, deflection of the exhaust stream, propellant flow, spin, and/or gravity.\nRockets for military and recreational uses date back to at least 13th century China. Significant scientific, interplanetary and industrial use did not occur until the 20th century, when rocketry was the enabling technology for the Space Age, including setting foot on the Earth\'s moon. Rockets are now used for fireworks, weaponry, ejection seats, launch vehicles for artificial satellites, human spaceflight, and space exploration.\nChemical rockets are the most common type of high power rocket, typically creating a high speed exhaust by the combustion of fuel with an oxidizer. The stored propellant can be a simple pressurized gas or a single liquid fuel that disassociates in the presence of a catalyst (monopropellants), two liquids that spontaneously react on contact (hypergolic propellants), two liquids that must be ignited to react, a solid combination of fuel with oxidizer (solid fuel), or solid fuel with liquid oxidizer (hybrid propellant system). Chemical rockets store a large amount of energy in an easily released form, and can be very dangerous. However, careful design, testing, construction and use minimizes risks.',title:"Rocket"},"SAM Battery":{image:"Surface-to-air missile.jpg",summary:"A surface-to-air missile (SAM), or ground-to-air missile (GTAM), is a missile designed to be launched from the ground to destroy aircraft or other missiles. It is one type of antiaircraft system; in modern armed forces, missiles have replaced most other forms of dedicated antiaircraft weapons, with anti-aircraft guns pushed into specialized roles.\nThe first serious attempts at SAM development took place during World War II, although no operational systems were introduced. Further development in the 1940s and 1950s led to the first operational systems being introduced by most major forces during the second half of the 1950s. Smaller systems, suitable for close-range work, evolved through the 1960s and 1970s, to modern systems that are man-portable. Shipborne systems followed the evolution of land-based models, starting with long-range weapons and steadily evolving toward smaller designs to provide a layered defence that have pushed gun-based systems into the shortest-range roles.\nThe American Nike Ajax was the first operational guided missile SAM system, and the Soviet Union's S-75 Dvina was the most-produced SAM. Widely used modern examples include the Patriot and S-300 wide-area systems, SM-6 naval missiles, and short-range man-portable systems like the Stinger and Strela-3.",title:"Surface-to-air missile"},"SDI Defense":{image:"Strategic Defense Initiative.jpg",summary:'The Strategic Defense Initiative (SDI) was a proposed missile defense system intended to protect the United States from attack by ballistic strategic nuclear weapons (intercontinental ballistic missiles and submarine-launched ballistic missiles). The system, which was to combine ground-based units and orbital deployment platforms, was first publicly announced by President Ronald Reagan on 23 March 1983. The Strategic Defense Initiative Organization (SDIO) was set up in 1984 within the United States Department of Defense to oversee the Strategic Defense Initiative.\nReagan was a vocal critic of the doctrine of mutual assured destruction (MAD), which he described a "suicide pact". In his 1983 speech, he called upon the scientists and engineers of the United States to develop a system that would render nuclear weapons obsolete. SDI was an important part of his defense policy, intended to end MAD as a nuclear deterrence strategy. A wide array of advanced weapon concepts, including lasers, particle beam weapons and ground- and space-based missile systems were studied, along with various sensor, command and control, and high-performance computer systems that would be needed to control a system consisting of hundreds of combat centers and satellites spanning the entire globe. A number of these concepts were tested through the late 1980s, and follow-on efforts and spin-offs continue to this day.\nThe ambitious initiative was criticized for allegedly threatening to destabilize the MAD-approach and to possibly re-ignite "an offensive arms race". SDI was nicknamed largely in the mainstream media as "Star Wars", after the popular 1977 film by George Lucas. In 1987, the American Physical Society concluded that a global shield such as "Star Wars" was not directly feasible for operational status using existing technology, and that about ten more years of research was needed to know whether such a system was possible.\nAfter the publication of the APS report, SDIs budget was repeatedly cut. By the late 1980s, the effort had been re-focused on the "Brilliant Pebbles" concept, which was expected to be much less expensive to develop and deploy. By the early 1990s, with the Cold War ending and nuclear arsenals being rapidly reduced, political support for SDI collapsed. SDI officially ended in 1993, when the administration of President Bill Clinton redirected the efforts towards theatre ballistic missiles and renamed the agency as the Ballistic Missile Defense Organization (BMDO). BMDO was renamed to the Missile Defense Agency in 2002. This article covers defense efforts under the SDIO.',title:"Strategic Defense Initiative"},"SETI Program":{image:"Search for extraterrestrial intelligence.jpg",summary:"The search for extraterrestrial intelligence (SETI) is a collective term for scientific searches for intelligent extraterrestrial life, for example, monitoring electromagnetic radiation for signs of transmissions from civilizations on other planets.\nScientific investigation began shortly after the advent of radio in the early 1900s, and focused international efforts have been going on since the 1980s. In 2015 Stephen Hawking and Russian billionaire Yuri Milner announced a well-funded effort called the Breakthrough Initiatives.\n\n",title:"Search for extraterrestrial intelligence"},Sanitation:{image:"Sanitation.jpg",summary:'Sanitation is the prevention of human contact with feces and the proper treatment and disposal of wastewater. Sanitation also includes promoting hygiene on a personal level through washing hands with soap. Proper sanitation protects people from hazards that may be microbiological, biological or chemical agents of disease. The main objective of a sanitation system is to protect and promote human health by providing a clean environment that will break the cycle of disease. For example, improving access to safe sanitation and changing hygiene behaviours can reduce the incidents of diarrhea.\nSanitation technologies may involve centralized civil engineering structures like sewer systems, sewage treatment, surface runoff treatment and solid waste landfills. These structures are designed to treat wastewater and municipal solid waste. Sanitation technologies may also take the form of relatively simple onsite sanitation systems. This can in some cases consist of a simple pit latrine or other type of non-flush toilet for the excreta management part.\nProviding sanitation to people requires attention to the entire system, not just focusing on technical aspects such as the toilet, fecal sludge management or the wastewater treatment plant. The "sanitation chain" involves the experience of the user, excreta and wastewater collection methods, transporting and treatment of waste, and reuse or disposal. All need to be thoroughly considered.\nOne of the main challenges of is the provide sustainable sanitation, especially in developing countries. Maintaining and sustaining sanitation has aspects that are technological, institutional and social in nature. Sanitation infrastructure has to be adapted to several specific contexts including consumers\' expectations and local resources available.',title:"Sanitation"},Seafaring:{image:"Seamanship.jpg",summary:"Seamanship is the art of operating a ship or boat.\nIt involves topics and development of specialised skills including: navigation and international maritime law; weather, meteorology and forecasting; watchstanding; ship-handling and small boat handling; operation of deck equipment, anchors and cables; ropework and line handling; communications; sailing; engines; execution of evolutions such as towing; cargo handling equipment, dangerous cargoes and cargo storage; dealing with emergencies; survival at sea and search and rescue; and fire fighting.\nThe degree of knowledge needed within these areas is dependent upon the nature of the work and the type of vessel employed by a mariner.",title:"Seamanship"},Settlers:{image:"Settler.jpg",summary:"A settler is a person who has migrated to an area and established a permanent residence there, often to colonize the area. Settlers are generally from a sedentary culture, as opposed to nomads who share and rotate their settlements with little or no concept of individual land ownership. Settlements are often built on land already claimed or owned by another group. Many times settlers are backed by governments or large countries. They also leave in search of religious freedom.",title:"Settler"},"Sewer System":{image:"Sanitary sewer.jpg",summary:'A sanitary sewer or "foul sewer" is an underground carriage system specifically for transporting sewage from houses and commercial buildings through pipes to treatment facilities or disposal. Sanitary sewers are part of an overall system called a sewage system or sewerage.\nSewage may be treated to control water pollution before discharge to surface waters. Sanitary sewers serving industrial areas also carry industrial wastewater.\nSeparate sanitary sewer systems are designed to transport sewage alone. In municipalities served by sanitary sewers, separate storm drains may convey surface runoff directly to surface waters. Sanitary sewers are distinguished from combined sewers, which combine sewage with stormwater runoff in one pipe. Sanitary sewer systems are beneficial because they avoid combined sewer overflows.\n\n',title:"Sanitary sewer"},"Shakespeare's Theater":{image:"William Shakespeare.jpg",summary:"William Shakespeare (; 26 April 1564 (baptised) – 23 April 1616) was an English poet, playwright and actor, widely regarded as the greatest writer in the English language and the world's pre-eminent dramatist. He is often called England's national poet and the \"Bard of Avon\". His extant works, including collaborations, consist of approximately 38 plays, 154 sonnets, two long narrative poems and a few other verses, some of uncertain authorship. His plays have been translated into every major living language and are performed more often than those of any other playwright.\nShakespeare was born and brought up in Stratford-upon-Avon, Warwickshire. At the age of 18, he married Anne Hathaway, with whom he had three children: Susanna and twins Hamnet and Judith. Sometime between 1585 and 1592, he began a successful career in London as an actor, writer, and part-owner of a playing company called the Lord Chamberlain's Men, later known as the King's Men. At age 49 around 1613, he appears to have retired to Stratford, where he died three years later. Few records of Shakespeare's private life survive, which has stimulated considerable speculation about such matters as his physical appearance, sexuality, religious beliefs and whether the works attributed to him were written by others.\nShakespeare produced most of his known work between 1589 and 1613. His early plays were primarily comedies and histories, which are regarded as some of the best work ever produced in these genres. He then wrote mainly tragedies until about 1608, including Hamlet, Othello, King Lear and Macbeth, considered some of the finest works in the English language. In his last phase, he wrote tragicomedies, also known as romances and collaborated with other playwrights.\nMany of his plays were published in editions of varying quality and accuracy during his lifetime. However, in 1623 John Heminges and Henry Condell, two friends and fellow actors of Shakespeare, published a more definitive text known as the First Folio, a posthumous collected edition of his dramatic works that included all but two of the plays now recognised as Shakespeare's. It was prefaced with a poem by Ben Jonson, in which Shakespeare is hailed, presciently, as \"not of an age, but for all time\".\nIn the 20th and 21st centuries, his works have been repeatedly adapted and rediscovered by new movements in scholarship and performance. His plays remain highly popular and are constantly studied, performed and reinterpreted in diverse cultural and political contexts throughout the world.",title:"William Shakespeare"},"Solar Plant":{image:"Solar energy.jpg",summary:'Solar energy is radiant light and heat from the Sun that is harnessed using a range of ever-evolving technologies such as solar heating, photovoltaics, solar thermal energy, solar architecture, molten salt power plants and artificial photosynthesis.\nIt is an important source of renewable energy and its technologies are broadly characterized as either passive solar or active solar depending on how they capture and distribute solar energy or convert it into solar power. Active solar techniques include the use of photovoltaic systems, concentrated solar power and solar water heating to harness the energy. Passive solar techniques include orienting a building to the Sun, selecting materials with favorable thermal mass or light-dispersing properties, and designing spaces that naturally circulate air.\nThe large magnitude of solar energy available makes it a highly appealing source of electricity. The United Nations Development Programme in its 2000 World Energy Assessment found that the annual potential of solar energy was 1,575–49,837 exajoules (EJ). This is several times larger than the total world energy consumption, which was 559.8 EJ in 2012.\nIn 2011, the International Energy Agency said that "the development of affordable, inexhaustible and clean solar energy technologies will have huge longer-term benefits. It will increase countries’ energy security through reliance on an indigenous, inexhaustible and mostly import-independent resource, enhance sustainability, reduce pollution, lower the costs of mitigating global warming, and keep fossil fuel prices lower than otherwise. These advantages are global. Hence the additional costs of the incentives for early deployment should be considered learning investments; they must be wisely spent and need to be widely shared".',title:"Solar energy"},"Space Component":{image:"Spacecraft propulsion.jpg",summary:"Spacecraft propulsion is any method used to accelerate spacecraft and artificial satellites. There are many different methods. Each method has drawbacks and advantages, and spacecraft propulsion is an active area of research. However, most spacecraft today are propelled by forcing a gas from the back/rear of the vehicle at very high speed through a supersonic de Laval nozzle. This sort of engine is called a rocket engine.\nAll current spacecraft use chemical rockets (bipropellant or solid-fuel) for launch, though some (such as the Pegasus rocket and SpaceShipOne) have used air-breathing engines on their first stage. Most satellites have simple reliable chemical thrusters (often monopropellant rockets) or resistojet rockets for orbital station-keeping and some use momentum wheels for attitude control. Soviet bloc satellites have used electric propulsion for decades, and newer Western geo-orbiting spacecraft are starting to use them for north-south stationkeeping and orbit raising. Interplanetary vehicles mostly use chemical rockets as well, although a few have used ion thrusters and Hall effect thrusters (two different types of electric propulsion) to great success.",title:"Spacecraft propulsion"},"Space Flight":{image:"Spaceflight.jpg",summary:"Spaceflight (also written space flight) is ballistic flight into or through outer space. Spaceflight can occur with spacecraft with or without humans on board. Examples of human spaceflight include the U.S. Apollo Moon landing and Space Shuttle programs and the Russian Soyuz program, as well as the ongoing International Space Station. Examples of unmanned spaceflight include space probes that leave Earth orbit, as well as satellites in orbit around Earth, such as communications satellites. These operate either by telerobotic control or are fully autonomous.\nSpaceflight is used in space exploration, and also in commercial activities like space tourism and satellite telecommunications. Additional non-commercial uses of spaceflight include space observatories, reconnaissance satellites and other Earth observation satellites.\nA spaceflight typically begins with a rocket launch, which provides the initial thrust to overcome the force of gravity and propels the spacecraft from the surface of the Earth. Once in space, the motion of a spacecraft—both when unpropelled and when under propulsion—is covered by the area of study called astrodynamics. Some spacecraft remain in space indefinitely, some disintegrate during atmospheric reentry, and others reach a planetary or lunar surface for landing or impact.\n\n",title:"Spaceflight"},"Space Module":{image:"Life support system.jpg",summary:"In human spaceflight, a life support system is a group of devices that allow a human being to survive in space. US government space agency NASA, and private spaceflight companies use the term environmental control and life support system or the acronym ECLSS when describing these systems for their human spaceflight missions. The life support system may supply air, water and food. It must also maintain the correct body temperature, an acceptable pressure on the body and deal with the body's waste products. Shielding against harmful external influences such as radiation and micro-meteorites may also be necessary. Components of the life support system are life-critical, and are designed and constructed using safety engineering techniques.",title:"Life support system"},"Space Structural":{image:"Spacecraft.jpg",summary:'A spacecraft (S/C)is a vehicle or machine designed to fly in outer space. Spacecraft are used for a variety of purposes, including communications, earth observation, meteorology, navigation, space colonization, planetary exploration, and transportation of humans and cargo.\nOn a sub-orbital spaceflight, a spacecraft enters space and then returns to the surface, without having gone into an orbit. For orbital spaceflights, spacecraft enter closed orbits around the Earth or around other celestial bodies. Spacecraft used for human spaceflight carry people on board as crew or passengers from start or on orbit (space stations) only, whereas those used for robotic space missions operate either autonomously or telerobotically. Robotic spacecraft used to support scientific research are space probes. Robotic spacecraft that remain in orbit around a planetary body are artificial satellites. Only a handful of interstellar probes, such as Pioneer 10 and 11, Voyager 1 and 2, and New Horizons, are on trajectories that leave the Solar System.\nOrbital spacecraft may be recoverable or not. By method of reentry to Earth they may be divided in non-winged space capsules and winged spaceplanes.\nHumanity has achieved space flight but only a few nations have the technology for orbital launches, including: Russia (RSA or "Roscosmos"), the United States (NASA), the member states of the European Space Agency (ESA), Japan (JAXA), Iran (ISA), India (ISRO), and China (CNSA).',title:"Spacecraft"},Spy:{image:"Espionage.jpg",summary:"Espionage (colloquially, spying) is the obtaining of secret or confidential information without the permission of the holder of the information. Spies help agencies uncover secret information. Any individual or spy ring (a cooperating group of spies), in the service of a government, company or independent operation, can commit espionage. The practice is clandestine, as it is by definition unwelcome and in many cases illegal and punishable by law. Espionage is a subset of \"intelligence\" gathering, which includes espionage as well as information gathering from public sources.\nEspionage is often part of an institutional effort by a government or commercial concern. However, the term tends to associate with state spying on potential or actual enemies for military purposes. Spying involving corporations is known as industrial espionage.\nOne of the most effective ways to gather data and information about the enemy (or potential enemy) is by infiltrating the enemy's ranks. This is the job of the spy (espionage agent). Spies can return all sorts of information concerning the size and strength of enemy forces. They can also find dissidents within the enemy's forces and influence them to defect. In times of crisis, spies can also oblige to steal technology and sabotage the enemy in various ways. Counterintelligence operatives can feed false information to enemy spies, protecting important domestic secrets, and preventing attempts at subversion. Almost all nations have strict laws concerning espionage and the penalty for being caught is often severe. However, the benefits through espionage are often great enough that most governments and many large corporations make use of it to varying degrees.\nFurther information on clandestine human intelligence and human intelligence information collection techniques is available, including discussions of operational techniques, asset recruiting, and the tradecraft used to collect this information.",title:"Espionage"},"Statue of Liberty":{image:"Statue of Liberty.jpg",summary:"The Statue of Liberty (Liberty Enlightening the World; French: La Liberté éclairant le monde) is a colossal neoclassical sculpture on Liberty Island in New York Harbor in New York City, in the United States. The copper statue, a gift from the people of France to the people of the United States, was designed by French sculptor Frédéric Auguste Bartholdi and built by Gustave Eiffel. The statue was dedicated on October 28, 1886.\nThe Statue of Liberty is a figure of a robed woman representing Libertas, a Roman goddess. She holds a torch above her head with her right hand, and in her left hand carries a tabula ansata inscribed in Roman numerals with \"JULY IV MDCCLXXVI\" (July 4, 1776), the date of the U.S. Declaration of Independence. A broken chain lies at her feet. The statue became an icon of freedom and of the United States, and was a welcoming sight to immigrants arriving from abroad.\nBartholdi was inspired by a French law professor and politician, Édouard René de Laboulaye, who is said to have commented in 1865 that any monument raised to U.S. independence would properly be a joint project of the French and American peoples. Because of the post-war instability in France, work on the statue did not commence until the early 1870s. In 1875, Laboulaye proposed that the French finance the statue and the U.S. provide the site and build the pedestal. Bartholdi completed the head and the torch-bearing arm before the statue was fully designed, and these pieces were exhibited for publicity at international expositions.\nThe torch-bearing arm was displayed at the Centennial Exposition in Philadelphia in 1876, and in Madison Square Park in Manhattan from 1876 to 1882. Fundraising proved difficult, especially for the Americans, and by 1885 work on the pedestal was threatened by lack of funds. Publisher Joseph Pulitzer, of the New York World, started a drive for donations to finish the project and attracted more than 120,000 contributors, most of whom gave less than a dollar. The statue was built in France, shipped overseas in crates, and assembled on the completed pedestal on what was then called Bedloe's Island. The statue's completion was marked by New York's first ticker-tape parade and a dedication ceremony presided over by President Grover Cleveland.\nThe statue was administered by the United States Lighthouse Board until 1901 and then by the Department of War; since 1933 it has been maintained by the National Park Service. Public access to the balcony around the torch has been barred for safety since 1916.",title:"Statue of Liberty"},Stealth:{image:"Stealth technology.jpg",summary:'Stealth technology also termed LO technology (low observable technology) is a sub-discipline of military tactics and passive electronic countermeasures, which cover a range of techniques used with personnel, aircraft, ships, submarines, missiles and satellites to make them less visible (ideally invisible) to radar, infrared, sonar and other detection methods. It corresponds to military camouflage for these parts of the electromagnetic spectrum (Multi-spectral camouflage).\nDevelopment of modern stealth technologies in the United States began in 1958, where earlier attempts in preventing radar tracking of its U-2 spy planes during the Cold War by the Soviet Union had been unsuccessful. Designers turned to develop a particular shape for planes that tended to reduce detection, by redirecting electromagnetic waves from radars. Radar-absorbent material was also tested and made to reduce or block radar signals that reflect off from the surface of planes. Such changes to shape and surface composition form stealth technology as currently used on the Northrop Grumman B-2 Spirit "Stealth Bomber".\nThe concept of stealth is to operate or hide without giving enemy forces any indications as to the presence of friendly forces. This concept was first explored through camouflage by blending into the background visual clutter. As the potency of detection and interception technologies (radar, Infra-red search and track, surface-to-air missiles, etc.) have increased over time, so too has the extent to which the design and operation of military personnel and vehicles have been affected in response. Some military uniforms are treated with chemicals to reduce their infrared signature. A modern "stealth" vehicle is designed from the outset to have a chosen spectral signature. The degree of stealth embodied in a particular design is chosen according to the predicted capabilities of projected threats.',title:"Stealth technology"},"Stealth Bomber":{image:"Stealth aircraft.jpg",summary:"Stealth aircraft are designed to avoid detection using a variety of technologies that reduce reflection/emission of radar, infrared, visible light, radio-frequency (RF) spectrum, and audio, collectively known as stealth technology. Development of stealth technology likely began in Germany during World War II, the prototyped Horten Ho 229 was designed for twin BMW 003 jet engines but finally powered by twin Junkers Jumo 004 jet engines being described as the first stealth aircraft. Well-known modern examples of stealth of U.S. aircraft include the United States' F-117 Nighthawk (1981–2008), the B-2 Spirit, the F-22 Raptor, and the F-35 Lightning II.\nWhile no aircraft is totally invisible to radar, stealth aircraft make it more difficult for conventional radar to detect or track the aircraft effectively, increasing the odds of an aircraft successfully avoiding detection by enemy radar and/or avoiding being successfully targeted by radar guided weapons. Stealth is the combination of passive low observable (LO) features and active emitters such as low-probability-of-intercept radars, radios and laser designators. These are usually combined with active measures such as carefully planning all mission maneuvers in order to minimize the aircraft's radar cross section, since common actions such as hard turns or opening bomb bay doors can more than double an otherwise stealthy aircraft's radar return. It is accomplished by using a complex design philosophy to reduce the ability of an opponent's sensors to detect, track, or attack the stealth aircraft. This philosophy also takes into account the heat, sound, and other emissions of the aircraft as these can also be used to locate it.\nFull-size stealth combat aircraft demonstrators have been flown by the United States (in 1977), Russia (in 2010) and China (in 2011). As of March 2017, the United States Armed Forces utilize three models of dedicated, manned stealth aircraft and the Chinese Air Force operates one, with a number of other countries developing their own designs. There are also various aircraft with reduced detectability, either unintentionally or as a secondary feature.",title:"Stealth aircraft"},"Stealth Fighter":{image:"Stealth aircraft.jpg",summary:"Stealth aircraft are designed to avoid detection using a variety of technologies that reduce reflection/emission of radar, infrared, visible light, radio-frequency (RF) spectrum, and audio, collectively known as stealth technology. Development of stealth technology likely began in Germany during World War II, the prototyped Horten Ho 229 was designed for twin BMW 003 jet engines but finally powered by twin Junkers Jumo 004 jet engines being described as the first stealth aircraft. Well-known modern examples of stealth of U.S. aircraft include the United States' F-117 Nighthawk (1981–2008), the B-2 Spirit, the F-22 Raptor, and the F-35 Lightning II.\nWhile no aircraft is totally invisible to radar, stealth aircraft make it more difficult for conventional radar to detect or track the aircraft effectively, increasing the odds of an aircraft successfully avoiding detection by enemy radar and/or avoiding being successfully targeted by radar guided weapons. Stealth is the combination of passive low observable (LO) features and active emitters such as low-probability-of-intercept radars, radios and laser designators. These are usually combined with active measures such as carefully planning all mission maneuvers in order to minimize the aircraft's radar cross section, since common actions such as hard turns or opening bomb bay doors can more than double an otherwise stealthy aircraft's radar return. It is accomplished by using a complex design philosophy to reduce the ability of an opponent's sensors to detect, track, or attack the stealth aircraft. This philosophy also takes into account the heat, sound, and other emissions of the aircraft as these can also be used to locate it.\nFull-size stealth combat aircraft demonstrators have been flown by the United States (in 1977), Russia (in 2010) and China (in 2011). As of March 2017, the United States Armed Forces utilize three models of dedicated, manned stealth aircraft and the Chinese Air Force operates one, with a number of other countries developing their own designs. There are also various aircraft with reduced detectability, either unintentionally or as a secondary feature.",title:"Stealth aircraft"},"Steam Engine":{image:"Steam engine.jpg",summary:"A steam engine is a heat engine that performs mechanical work using steam as its working fluid.\nSteam engines are external combustion engines, where the working fluid is separated from the combustion products. Non-combustion heat sources such as solar power, nuclear power or geothermal energy may be used. The ideal thermodynamic cycle used to analyze this process is called the Rankine cycle. In the cycle, water is heated and transforms into steam within a boiler operating at a high pressure. When expanded through pistons or turbines, mechanical work is done. The reduced pressure steam is then exhausted to the atmosphere, or condensed and pumped back into the boiler.\nIn general usage, the term steam engine can refer to either the integrated steam plants (including boilers etc.) such as railway steam locomotives and portable engines, or may refer to the piston or turbine machinery alone, as in the beam engine and stationary steam engine. Specialized devices such as steam hammers and steam pile drivers are dependent on the steam pressure supplied from a separate boiler.\nThe use of boiling water to produce mechanical motion goes back over 2000 years, but early devices were not highly practical. The Spanish inventor Jerónimo de Ayanz y Beaumont obtained a patent for a rudimentary steam-powered water pump in 1606. In 1698 Thomas Savery patented a steam pump that used steam in direct contact with the water being pumped. Savery's steam pump used condensing steam to create a vacuum and draw water into a chamber, and then applied pressurized steam to further pump the water.\nThomas Newcomen's atmospheric engine was the first commercial true steam engine using a piston, and was used in 1712 for pumping in a mine. They became popular for mining and 104 were in use by 1733. Eventually over two thousand of them were installed.\nIn 1781 Scottish engineer James Watt patented a steam engine that produced continuous rotary motion. Watt's ten-horsepower engines enabled a wide range of manufacturing machinery to be powered. The engines could be sited anywhere that water and coal or wood fuel could be obtained. By 1883, engines that could provide 10,000 hp had become feasible. The stationary steam engine was a key component of the Industrial Revolution, allowing factories to locate where water power was unavailable. The atmospheric engines of Newcomen and Watt were large compared to the amount of power they produced, but high-pressure steam engines were light enough to be applied to vehicles such as traction engines and the railway locomotives.\nReciprocating piston type steam engines remained the dominant source of power until the early 20th century, when advances in the design of electric motors and internal combustion engines gradually resulted in the replacement of reciprocating (piston) steam engines in commercial usage, and the ascendancy of steam turbines in power generation. Considering that the great majority of worldwide electric generation is produced by turbine type steam engines, the \"steam age\" is continuing with energy levels far beyond those of the turn of the 19th and 20th century.",title:"Steam engine"},Steel:{image:"Steel.jpg",summary:"Steel is an alloy of iron and carbon with trace amounts of other elements. Because of its high tensile strength and low cost, it is a major component used in buildings, infrastructure, tools, ships, automobiles, machines, appliances, and weapons.\nSteel base metal is iron, which is able to take on two crystalline forms (allotropic forms), body centered cubic (BCC) and face centered cubic (FCC), depending on its temperature. It is the interaction of those allotropes with the alloying elements, primarily carbon, that gives steel and cast iron their range of unique properties. In the body-centred cubic arrangement, there is an iron atom in the centre of each cube, and in the face-centred cubic, there is one at the center of each of the six faces of the cube.\nIn pure iron, the crystal structure has relatively little resistance to the iron atoms slipping past one another, and so pure iron is quite ductile, or soft and easily formed. In steel, small amounts of carbon, other elements, and inclusions within the iron act as hardening agents that prevent the movement of dislocations that otherwise occur in the crystal lattices of iron atoms.\nThe carbon in typical steel alloys may contribute up to 2.14% of its weight. Varying the amount of carbon and many other alloying elements, as well as controlling their chemical and physical makeup in the final steel (either as solute elements, or as precipitated phases), slows the movement of those dislocations that make pure iron ductile, and thus controls and enhances its qualities. These qualities include such things as the hardness, quenching behavior, need for annealing, tempering behavior, yield strength, and tensile strength of the resulting steel. The increase in steel's strength compared to pure iron is only possible by reducing iron's ductility.\nSteel was produced in bloomery furnaces for thousands of years, but its large-scale, industrial use only began after more efficient production methods were devised in the 17th century, with the production of blister steel and then crucible steel. With the invention of the Bessemer process in the mid-19th century, a new era of mass-produced steel began. This was followed by the Siemens-Martin process and then the Gilchrist-Thomas process that refined the quality of steel. With their introductions, mild steel replaced wrought iron.\nFurther refinements in the process, such as basic oxygen steelmaking (BOS), largely replaced earlier methods by further lowering the cost of production and increasing the quality of the final product. Today, steel is one of the most common man-made materials in the world, with more than 1.6 billion tons produced annually. Modern steel is generally identified by various grades defined by assorted standards organizations.",title:"Steel"},"Stock Exchange":{image:"Stock exchange.jpg",summary:'A stock exchange is an exchange (or bourse) where stock brokers and traders can buy and sell shares of stock, bonds, and other securities. Stock exchanges may also provide facilities for issue and redemption of securities and other financial instruments and capital events including the payment of income and dividends. Securities traded on a stock exchange include stock issued by listed companies, unit trusts, derivatives, pooled investment products and bonds. Stock exchanges often function as "continuous auction" markets with buyers and sellers consummating transactions at a central location such as the floor of the exchange.\nTo be able to trade a security on a certain stock exchange, it must be listed there. Usually, there is a central location at least for record keeping, but trade is increasingly less linked to such a physical place, as modern markets use electronic networks, which gives them advantages of increased speed and reduced cost of transactions. Trade on an exchange is restricted to brokers who are members of the exchange. In recent years, various other trading venues, such as electronic communication networks, alternative trading systems and "dark pools" have taken much of the trading activity away from traditional stock exchanges.\nThe initial public offering of stocks and bonds to investors is by definition done in the primary market and subsequent trading is done in the secondary market. A stock exchange is often the most important component of a stock market. Supply and demand in stock markets are driven by various factors that, as in all free markets, affect the price of stocks (see stock valuation).\nThere is usually no obligation for stock to be issued via the stock exchange itself, nor must stock be subsequently traded on the exchange. Such trading may be off exchange or over-the-counter. This is the usual way that derivatives and bonds are traded. Increasingly, stock exchanges are part of a global securities market.',title:"Stock exchange"},Submarine:{image:"Submarine.jpg",summary:'A submarine (or simply sub) is a watercraft capable of independent operation underwater. It differs from a submersible, which has more limited underwater capability. The term most commonly refers to a large, crewed vessel. It is also sometimes used historically or colloquially to refer to remotely operated vehicles and robots, as well as medium-sized or smaller vessels, such as the midget submarine and the wet sub. The noun submarine evolved as a shortened form of submarine boat; by naval tradition, submarines are usually referred to as "boats" rather than as "ships", regardless of their size (boat is usually reserved for seagoing vessels of relatively small size).\nAlthough experimental submarines had been built before, submarine design took off during the 19th century, and they were adopted by several navies. Submarines were first widely used during World War I (1914–1918), and now figure in many navies large and small. Military uses include attacking enemy surface ships (merchant and military), attacking other submarines, aircraft carrier protection, blockade running, ballistic missile submarines as part of a nuclear strike force, reconnaissance, conventional land attack (for example using a cruise missile), and covert insertion of special forces. Civilian uses for submarines include marine science, salvage, exploration and facility inspection and maintenance. Submarines can also be modified to perform more specialized functions such as search-and-rescue missions or undersea cable repair. Submarines are also used in tourism, and for undersea archaeology.\nMost large submarines consist of a cylindrical body with hemispherical (or conical) ends and a vertical structure, usually located amidships, which houses communications and sensing devices as well as periscopes. In modern submarines, this structure is the "sail" in American usage, and "fin" in European usage. A "conning tower" was a feature of earlier designs: a separate pressure hull above the main body of the boat that allowed the use of shorter periscopes. There is a propeller (or pump jet) at the rear, and various hydrodynamic control fins. Smaller, deep-diving and specialty submarines may deviate significantly from this traditional layout. Submarines use diving planes and also change the amount of water and air in ballast tanks to change buoyancy for submerging and surfacing.\nSubmarines have one of the widest ranges of types and capabilities of any vessel. They range from small autonomous examples and one- or two-person vessels that operate for a few hours, to vessels that can remain submerged for six months—such as the Russian Typhoon class, the biggest submarines ever built. Submarines can work at greater depths than are survivable or practical for human divers. Modern deep-diving submarines derive from the bathyscaphe, which in turn evolved from the diving bell.',title:"Submarine"},"Sun Tzu's War Academy":{image:"Sun Tzu.jpg",summary:"Sun Tzu (; also rendered as Sun Zi 孫子) was a Chinese general, military strategist, and philosopher who lived in the Spring and Autumn period of ancient China. Sun Tzu is traditionally credited as the author of The Art of War, a widely influential work of military strategy that has affected both Western and Eastern philosophy. Aside from his legacy as the author of The Art of War, Sun Tzu is revered in Chinese and the Culture of Asia as a legendary historical figure. His birth name was Sun Wu, and he was known outside of his family by his courtesy name Changqing. The name Sun Tzu by which he is best known in the West is an honorific which means \"Master Sun\".\nSun Tzu's historicity is uncertain. Sima Qian and other traditional historians placed him as a minister to King Helü of Wu and dated his lifetime to 544–496 BC. Modern scholars accepting his historicity nonetheless place the existing text of The Art of War in the later Warring States period based upon its style of composition and its descriptions of warfare. Traditional accounts state that the general's descendant Sun Bin also wrote a treatise on military tactics, also titled The Art of War. Since both Sun Wu and Sun Bin were referred to as Sun Tzu in classical Chinese texts, some historians believed them identical prior to the rediscovery of Sun Bin's treatise in 1972.\nSun Tzu's work has been praised and employed throughout East Asia since its composition. During the twentieth century, The Art of War grew in popularity and saw practical use in Western society as well. It continues to influence many competitive endeavors in Asia, Europe, and Americas including culture, politics, business, and sports, as well as modern warfare.",title:"Sun Tzu"},"Super Highways":{image:"Controlled-access highway.jpg",summary:"A controlled-access highway is a type of highway which has been designed for high-speed vehicular traffic, with all traffic flow and ingress/egress regulated. Common English terms are freeway (in Australia, South Africa and parts of the United States and Canada), motorway (in the United Kingdom, Ireland and New Zealand) and expressway (some parts of Canada, parts of the United States, and many Asian countries). Other similar terms include Interstate and parkway. Some of these may be limited-access highways, although this term can also refer to a class of highway with somewhat less isolation from other traffic.\nIn countries following the Vienna convention, the motorway qualification implies they are forbidden for walking or parking, and reserved for the use of motorised vehicles only.\nA controlled-access highway provides an unhindered flow of traffic, with no traffic signals, intersections or property access. They are free of any at-grade crossings with other roads, railways, or pedestrian paths, which are instead carried by overpasses and underpasses. Entrances and exits to the highway are provided at interchanges by slip roads (ramps), which allow for speed changes between the highway and arterials and collector roads. On the controlled-access highway, opposing directions of travel are generally separated by a median strip or central reservation containing a traffic barrier or grass. Elimination of conflicts with other directions of traffic dramatically improves safety and capacity.\nControlled-access highways evolved during the first half of the 20th century. Italy opened its first autostrada in 1924, A8, connecting Milan to Varese. Germany began to build its first controlled-access autobahn without speed limits (30-kilometre (19 mi) on what is now A555, then referred to as a dual highway) in 1932 between Cologne and Bonn. It then rapidly constructed a nationwide system of such roads. The first North American freeways (known as parkways) opened in the New York City area in the 1920s. Britain, heavily influenced by the railways, did not build its first motorway, the Preston By-pass (M6), until 1958.\nMost technologically advanced nations feature an extensive network of freeways or motorways to provide high-capacity urban travel, or high-speed rural travel, or both. Many have a national-level or even international-level (e.g. European E route) system of route numbering.",title:"Controlled-access highway"},Superconductors:{image:"Superconductivity.jpg",summary:"Superconductivity is a phenomenon of exactly zero electrical resistance and expulsion of magnetic flux fields occurring in certain materials, called superconductors, when cooled below a characteristic critical temperature. It was discovered by Dutch physicist Heike Kamerlingh Onnes on April 8, 1911, in Leiden. Like ferromagnetism and atomic spectral lines, superconductivity is a quantum mechanical phenomenon. It is characterized by the Meissner effect, the complete ejection of magnetic field lines from the interior of the superconductor as it transitions into the superconducting state. The occurrence of the Meissner effect indicates that superconductivity cannot be understood simply as the idealization of perfect conductivity in classical physics.\nThe electrical resistance of a metallic conductor decreases gradually as temperature is lowered. In ordinary conductors, such as copper or silver, this decrease is limited by impurities and other defects. Even near absolute zero, a real sample of a normal conductor shows some resistance. In a superconductor; the resistance drops abruptly to zero when the material is cooled below its critical temperature. An electric current through a loop of superconducting wire can persist indefinitely with no power source.\nIn 1986, it was discovered that some cuprate-perovskite ceramic materials have a critical temperature above 90 K (−183 °C). Such a high transition temperature is theoretically impossible for a conventional superconductor, leading the materials to be termed high-temperature superconductors. The cheaply-available coolant liquid nitrogen boils at 77 K, and thus superconduction at higher temperatures than this facilitates many experiments and applications that are less practical at lower temperatures.",title:"Superconductivity"},Supermarket:{image:"Supermarket.jpg",summary:'A supermarket is a self-service shop offering a wide variety of food and household products, organized into aisles. It is larger and has a wider selection than a traditional grocery store, but is smaller and more limited in the range of merchandise than a hypermarket or big-box market.\nThe supermarket typically comprises meat, fresh produce, dairy, and baked goods aisles, along with shelf space reserved for canned and packaged goods as well as for various non-food items such as kitchenware, household cleaners, pharmacy products and pet supplies. Some supermarkets also sell a variety of other household products that are consumed regularly, such as alcohol (where permitted), medicine, and clothes, and some stores sell a much wider range of non-food products: DVDs, sporting equipment, board games, and seasonal items (e.g., Christmas wrapping paper in December).\nThe traditional supermarket occupies a large amount of floor space, usually on a single level. It is usually situated near a residential area in order to be convenient to consumers. The basic appeal is the availability of a broad selection of goods under a single roof, at relatively low prices. Other advantages include ease of parking and frequently the convenience of shopping hours that extend into the evening or even 24 hours of the day. Supermarkets usually allocate large budgets to advertising, typically through newspapers. They also present elaborate in-shop displays of products.\nSupermarkets typically are chain stores, supplied by the distribution centres of their parent companies thus increasing opportunities for economies of scale. Supermarkets usually offer products at relatively low prices by using their buying power to buy goods from manufacturers at lower prices than smaller stores can. They also minimise financing costs by paying for goods at least 30 days after receipt and some extract credit terms of 90 days or more from vendors. Certain products (typically staple foods such as bread, milk and sugar) are very occasionally sold as loss leaders so as to attract shoppers to their store. Supermarkets make up for their low margins by a higher overall volume of sales, and with the sale of higher-margin items bought by the intended higher volume of shoppers. Customers usually shop by placing their selected merchandise into shopping carts (trolleys) or baskets (self-service) and pay for the merchandise at the check-out. Many supermarket chains are attempting to further reduce labor costs by shifting to self-service check-out machines, where a single employee can oversee and assist multiple customers at a time.\nA larger full-service supermarket combined with a department store is sometimes known as a hypermarket. Other services offered at some supermarkets may include those of banks, cafés, childcare centres/creches, insurance (and other financial services), Mobile Phone services, photo processing, video rentals, pharmacies and/or petrol stations. If the eatery in a supermarket is substantial enough, the facility may be called a "grocerant", a portmanteau of "grocery" and "restaurant".',title:"Supermarket"},Tactics:{image:"Military tactics.jpg",summary:"Military tactics are the science and art of organizing a military force, and the techniques for combining and using weapons and military units to engage and defeat an enemy in battle. Changes in philosophy and technology have been reflected in changes to military tactics. In contemporary military science, tactics are the lowest of three planning levels: (i) strategic, (ii) operational, and (iii) tactical. The highest level of planning is strategy: how force is translated into political objectives by bridging the means and ends of war. The intermediate level, operational, the conversion of strategy into tactics, deals with formations of units. In the vernacular, tactical decisions are those made to achieve the greatest immediate value; strategic decisions are those made to achieve the greatest overall value, irrespective of the immediate results of a tactical decision.",title:"Military tactics"},Temple:{image:"Temple.jpg",summary:'A temple (from the Latin word templum) is a structure reserved for religious or spiritual rituals and activities such as prayer and sacrifice. It is typically used for such buildings belonging to all faiths where a more specific term such as church, mosque or synagogue is not generally used in English. These include Hinduism, Buddhism, and Jainism among religions with many modern followers, as well as other ancient religions such as Ancient Egyptian religion.\nThe form and function of temples is thus very variable, though they are often considered by believers to be in some sense the "house" of one or more deities. Typically offerings of some sort are made to the deity, and other rituals enacted, and a special group of clergy maintain, and operate the temple. The degree to which the whole population of believers can access the building varies significantly; often parts or even the whole main building can only be accessed by the clergy. Temples typically have a main building and a larger precinct, which may contain many other buildings.\nThe word comes from Ancient Rome, where a templum constituted a sacred precinct as defined by a priest, or augur. It has the same root as the word "template", a plan in preparation of the building that was marked out on the ground by the augur. Templa also became associated with the dwelling places of a god or gods. Despite the specific set of meanings associated with the word, it has now become widely used to describe a house of worship for any number of religions and is even used for time periods prior to the Romans.',title:"Temple"},"The Corporation":{image:"Corporation.jpg",summary:'A corporation is a company or group of people authorized to act as a single entity (legally a person) and recognized as such in law. Early incorporated entities were established by charter (i.e. by an ad hoc act granted by a monarch or passed by a parliament or legislature). Most jurisdictions now allow the creation of new corporations through registration.\nCorporations come in many different types but are usually divided by the law of the jurisdiction where they are chartered into two kinds: by whether they can issue stock or not, or by whether they are formed to make a profit or not.\nWhere local law distinguishes corporations by ability to issue stock, corporations allowed to do so are referred to as "stock corporations", ownership of the corporation is through stock, and owners of stock are referred to as "stockholders" or "shareholders". Corporations not allowed to issue stock are referred to as "non-stock" corporations; those who are considered the owners of a non-stock corporation are persons (or other entities) who have obtained membership in the corporation, and are referred to as a "member" of the corporation.\nCorporations chartered in regions where they are distinguished by whether they are allowed to be for profit or not are referred to as "for profit" and "not-for-profit" corporations, respectively.\nThere is some overlap between stock/non-stock and for profit/not-for-profit in that not-for-profit corporations are always non-stock as well. A for profit corporation is almost always a stock corporation, but some for profit corporations may choose to be non-stock. To simplify the explanation, whenever "Stockholder" or "Shareholder" is used in the rest of this article to refer to a stock corporation, it is presumed to mean the same as "member" for a non-profit corporation or for a profit, non-stock corporation.\nRegistered corporations have legal personality and are owned by shareholders whose liability is generally limited to their investment. Shareholders do not typically actively manage a corporation; shareholders instead elect or appoint a board of directors to control the corporation in a fiduciary capacity. In most circumstances, a shareholder may also serve as a director or officer of a corporation.\nIn American English, the word corporation is most often used to describe large business corporations. In British English and in the Commonwealth countries, the term company is more widely used to describe the same sort of entity while the word corporation encompasses all incorporated entities. In American English, the word company can include entities such as partnerships that would not be referred to as companies in British English as they are not a separate legal entity.\nDespite not being individual human beings, corporations, as far as the law is concerned, are legal persons, and have many of the same rights and responsibilities as natural persons do. For example, a corporation can own property, and can sue or be sued.\n\nCorporations can exercise human rights against real individuals and the state, and they can themselves be responsible for human rights violations. Corporations can be "dissolved" either by statutory operation, order of court, or voluntary action on the part of shareholders. Insolvency may result in a form of corporate failure, when creditors force the liquidation and dissolution of the corporation under court order, but it most often results in a restructuring of corporate holdings. Corporations can even be convicted of criminal offenses, such as fraud and manslaughter. However, corporations are not considered living entities in the way that humans are.\nLate in the 19th century, a new form of company having the limited liability protections of a corporation, and the more favorable tax treatment of either a sole proprietorship or partnership was developed. While not a corporation, this new type of entity became very attractive as an alternative for corporations not needing to issue stock. In Germany, the organization was referred to as Gesellschaft mit beschränkter Haftung or GmbH. In the last quarter of the 20th Century this new form of non-corporate organization became available in the United States and other countries, and was known as the limited liability company or LLC. Since the GmbH and LLC forms of organization are technically not corporations (even though they have many of the same features), they will not be discussed in this article.',title:"Corporation"},"The Republic":{image:"Republic.jpg",summary:'A republic (Latin: res publica) is a form of government in which the country is considered a "public matter", not the private concern or property of the rulers. The primary positions of power within a republic are not inherited, but are attained through elections expressing the consent of the governed. Such leadership positions are therefore expected to fairly represent the citizen body. It is a form of government under which the head of state is not a monarch. In American English, the definition of a republic can also refer specifically to a government in which elected individuals represent the citizen body, known elsewhere as a representative democracy (a democratic republic) and exercise power according to the rule of law (a constitutional republic).\nAs of 2017, 159 of the world\'s 206 sovereign states use the word "republic" as part of their official names – not all of these are republics in the sense of having elected governments, nor is the word "republic" used in the names of all nations with elected governments. While heads-of-state often tend to claim that they rule only by the "consent of the governed", elections in some countries have been found to be held more for the purpose of “show” than for the actual purpose of in reality providing citizens with any genuine ability to choose their own leaders.\nThe term “republic” was first coined ca. 500 BC in Rome, but over time the term has undergone several changes in meaning. Initially the Latin term “res publica” signified the earlier “partial form of democracy” as found in Rome from c. 500 BC until c. 27 BC. In this early Roman partial-democracy, the power of the aristocratic or patrician class who held all of the seats in the Roman Senate, was checked by the institution of the consulship, whose two consul/vice-rulers were elected annually by the free citizens or plebes of Rome. The ancient Roman definition of the word differs from the modern use of the term, where no leadership positions are held to be restricted to only the "ruling class".\nMost often a republic is a single sovereign state, but there are also sub-sovereign state entities that are referred to as republics, or that have governments that are described as "republican" in nature. For instance, Article IV of the United States Constitution "guarantee[s] to every State in this Union a Republican form of Government". In contrast, the former Soviet Union, which described itself as being a group of "Republics" and also as a "federal multinational state composed of 15 republics", was widely viewed as being an authoritarian form of government and not as a republican form of government. It was seen as authoritarian, as its electoral system was structured so as to automatically guarantee the election of government sponsored candidates.',title:"Republic"},"The Wheel":{image:"Wheel.jpg",summary:"A wheel is a circular component that is intended to rotate on an axle bearing. The wheel is one of the key components of the wheel and axle which is one of the six simple machines. Wheels, in conjunction with axles, allow heavy objects to be moved easily facilitating movement or transportation while supporting a load, or performing labor in machines. Wheels are also used for other purposes, such as a ship's wheel, steering wheel, potter's wheel and flywheel.\nCommon examples are found in transport applications. A wheel greatly reduces friction by facilitating motion by rolling together with the use of axles. In order for wheels to rotate, a moment needs to be applied to the wheel about its axis, either by way of gravity or by the application of another external force or torque.",title:"Wheel"},Theology:{image:"Theology.jpg",summary:"Theology is the critical study of the nature of the divine. It is taught as an academic discipline, typically in universities, seminaries, and schools of divinity.",title:"Theology"},"Theory of Gravity":{image:"Gravity.jpg",summary:"Gravity, or gravitation, is a natural phenomenon by which all things with mass are brought toward (or gravitate toward) one another, including objects ranging from atoms and photons, to planets and stars. Since energy and mass are equivalent, all forms of energy (including light) cause gravitation and are under the influence of it. On Earth, gravity gives weight to physical objects, and the Moon's gravity causes the ocean tides. The gravitational attraction of the original gaseous matter present in the Universe caused it to begin coalescing, forming stars – and for the stars to group together into galaxies – so gravity is responsible for many of the large scale structures in the Universe. Gravity has an infinite range, although its effects become increasingly weaker on farther objects.\nGravity is most accurately described by the general theory of relativity (proposed by Albert Einstein in 1915) which describes gravity not as a force, but as a consequence of the curvature of spacetime caused by the uneven distribution of mass. The most extreme example of this curvature of spacetime is a black hole, from which nothing -- not even light -- can escape once past the black hole's event horizon. However, for most applications, gravity is well approximated by Newton's law of universal gravitation, which describes gravity as a force which causes any two bodies to be attracted to each other, with the force proportional to the product of their masses and inversely proportional to the square of the distance between them.\nGravity is the weakest of the four fundamental forces of physics, approximately 1038 times weaker than the strong force, 1036 times weaker than the electromagnetic force and 1029 times weaker than the weak force. As a consequence, it has no significant influence at the level of subatomic particles. In contrast, it is the dominant force at the macroscopic scale, and is the cause of the formation, shape and trajectory (orbit) of astronomical bodies. For example, gravity causes the Earth and the other planets to orbit the Sun, it also causes the Moon to orbit the Earth, and causes the formation of tides, the formation and evolution of the Solar System, stars and galaxies.\nThe earliest instance of gravity in the Universe, possibly in the form of quantum gravity, supergravity or a gravitational singularity, along with ordinary space and time, developed during the Planck epoch (up to 10−43 seconds after the birth of the Universe), possibly from a primeval state, such as a false vacuum, quantum vacuum or virtual particle, in a currently unknown manner. Attempts to develop a theory of gravity consistent with quantum mechanics, a quantum gravity theory, which would allow gravity to be united in a common mathematical framework (a theory of everything) with the other three forces of physics, are a current area of research.",title:"Gravity"},Trade:{image:"Trade.jpg",summary:"Trade involves the transfer of goods or services from one person or entity to another, often in exchange for money. A network that allows trade is called a market.\nThe original form of trade, barter, saw the direct exchange of goods and services for other goods and services. Barter is trading things without the use of money. Later one side of the barter started to involve precious metals, which gained symbolic as well as practical importance. Modern traders generally negotiate through a medium of exchange, such as money. As a result, buying can be separated from selling, or earning. The invention of money (and later credit, paper money and non-physical money) greatly simplified and promoted trade. Trade between two traders is called bilateral trade, while trade between more than two traders is called multilateral trade.\nTrade exists due to the specialization and division of labor, in which most people concentrate on a small aspect of production, but use that output in trades for other products and needs. Trade exists between regions because different regions may have a comparative advantage (perceived or real) in the production of some trade-able commodity—including production of natural resources scarce or limited elsewhere, or because different regions' size may encourage mass production. As such, trade at market prices between locations can benefit both locations.\nRetail trade consists of the sale of goods or merchandise from a very fixed location, such as a department store, boutique or kiosk, online or by mail, in small or individual lots for direct consumption or use by the purchaser. Wholesale trade is defined as the sale of goods that are sold as merchandise to retailers, or industrial, commercial, institutional, or other professional business users, or to other wholesalers and related subordinated services.",title:"Trade"},Transport:{image:"Troopship.jpg",summary:"A troopship (also troop ship or troop transport or trooper) is a ship used to carry soldiers, either in peacetime or wartime. Operationally, standard troopships – often drafted from commercial shipping fleets – cannot land troops directly on shore, typically loading and unloading at a seaport or onto smaller vessels, either tenders or barges.\nAttack transports, a variant of ocean-going troopship adapted to transporting invasion forces ashore, carry their own fleet of landing craft. Landing ships beach themselves and bring their troops directly ashore.\n\n",title:"Troopship"},Trireme:{image:"Trireme.jpg",summary:'A trireme (; derived from Latin: trirēmis "with three banks of oars"; Ancient Greek: τριήρης triērēs, literally "three-rower") was an ancient vessel and a type of galley that was used by the ancient maritime civilizations of the Mediterranean, especially the Phoenicians, ancient Greeks and Romans.\nThe trireme derives its name from its three rows of oars, manned with one man per oar. The early trireme was a development of the penteconter, an ancient warship with a single row of 25 oars on each side (i.e., a single-banked boat), and of the bireme (Ancient Greek: διήρης, diērēs), a warship with two banks of oars, of Phoenician origin. The word dieres does not appear until the Roman period. "It must be assumed the term pentekontor covered the two-level type". As a ship it was fast and agile, and it was the dominant warship in the Mediterranean during the 7th to 4th centuries BC, after which it was largely superseded by the larger quadriremes and quinqueremes. Triremes played a vital role in the Persian Wars, the creation of the Athenian maritime empire, and its downfall in the Peloponnesian War.\nThe term is sometimes also used to refer to medieval and early modern galleys with three files of oarsmen per side as triremes.',title:"Trireme"},"United Nations":{image:"United Nations.jpg",summary:"The United Nations (UN) is an intergovernmental organization tasked to promote international co-operation and to create and maintain international order. A replacement for the ineffective League of Nations, the organization was established on 24 October 1945 after World War II in order to prevent another such conflict. At its founding, the UN had 51 member states; there are now 193. The headquarters of the UN is in Manhattan, New York City, and is subject to extraterritoriality. Further main offices are situated in Geneva, Nairobi, and Vienna. The organization is financed by assessed and voluntary contributions from its member states. Its objectives include maintaining international peace and security, promoting human rights, fostering social and economic development, protecting the environment, and providing humanitarian aid in cases of famine, natural disaster, and armed conflict. The UN is the largest, most familiar, most internationally represented and most powerful intergovernmental organization in the world.\nThe UN Charter was drafted at a conference between April–June 1945 in San Francisco, and was signed on 26 June 1945 at the conclusion of the conference; this charter took effect 24 October 1945, and the UN began operation. The UN's mission to preserve world peace was complicated in its early decades by the Cold War between the US and Soviet Union and their respective allies. The organization participated in major actions in Korea and the Congo, as well as approving the creation of the state of Israel in 1947. The organization's membership grew significantly following widespread decolonization in the 1960s, and by the 1970s its budget for economic and social development programmes far outstripped its spending on peacekeeping. After the end of the Cold War, the UN took on major military and peacekeeping missions across the world with varying degrees of success.\nThe UN has six principal organs: the General Assembly (the main deliberative assembly); the Security Council (for deciding certain resolutions for peace and security); the Economic and Social Council (ECOSOC; for promoting international economic and social co-operation and development); the Secretariat (for providing studies, information, and facilities needed by the UN); the International Court of Justice (the primary judicial organ); and the UN Trusteeship Council (inactive since 1994). UN System agencies include the World Bank Group, the World Health Organization, the World Food Programme, UNESCO, and UNICEF. The UN's most prominent officer is the Secretary-General, an office held by Portuguese António Guterres since 2017. Non-governmental organizations may be granted consultative status with ECOSOC and other agencies to participate in the UN's work.\nThe organization won the Nobel Peace Prize in 2001, and a number of its officers and agencies have also been awarded the prize. Other evaluations of the UN's effectiveness have been mixed. Some commentators believe the organization to be an important force for peace and human development, while others have called the organization ineffective, corrupt, or biased.",title:"United Nations"},University:{image:"University.jpg",summary:'A university (Latin: universitas, "a whole") is an institution of higher (or tertiary) education and research which awards academic degrees in various academic disciplines. Universities typically provide undergraduate education and postgraduate education.\nThe word "university" is derived from the Latin universitas magistrorum et scholarium, which roughly means "community of teachers and scholars." While antecedents had existed in Asia and Africa, the modern university system has roots in the European medieval university, which was created in Italy and evolved from Christian Cathedral schools for the clergy during the High Middle Ages.',title:"University"},"Warrior Code":{image:"Warrior.jpg",summary:"A warrior is a person specializing in combat or warfare, especially within the context of a tribal or clan-based warrior culture society that recognizes a separate warrior class or caste.",title:"Warrior"},Warriors:{image:"Warrior.jpg",summary:"A warrior is a person specializing in combat or warfare, especially within the context of a tribal or clan-based warrior culture society that recognizes a separate warrior class or caste.",title:"Warrior"},"Women's Suffrage":{image:"Women's suffrage.jpg",summary:"Women's suffrage (also known as female suffrage, woman suffrage or women's right to vote) is the right of women to vote in elections. Limited voting rights were gained by women in Finland, Iceland, Sweden and some Australian colonies and western U.S. states in the late 19th century. National and international organizations formed to coordinate efforts to gain voting rights, especially the International Woman Suffrage Alliance (founded in 1904, Berlin, Germany), and also worked for equal civil rights for women.\nIn 1881, the Isle of Man gave women who owned property the right to vote. In 1893, the British colony of New Zealand, granted women the right to vote. The colony of South Australia, did the same in 1894 and women were able to vote in the next election, which was held in 1895. South Australia also permitted women to stand for election alongside men. In 1899 Western Australia enacted full women's suffrage, enabling women to vote in the constitutional referendum of 31 July 1900 and the 1901 state and federal elections. In 1902 women in the remaining four colonies also acquired the right to vote and stand in federal elections after the six Australian colonies federated to become the Commonwealth of Australia. Discriminatory restrictions against Aboriginal people, including women, voting in national elections, were not completely removed until 1962.\nThe first European country to introduce women's suffrage was the Grand Duchy of Finland, then part of the Russian Empire, which elected the world's first women Members of Parliament in the 1907 parliamentary elections. Norway followed, granting full women's suffrage in 1913.\nMost independent countries enacted women's suffrage in the interwar era, including Canada in 1917, Britain in 1918 and the United States in 1920. Leslie Hume argues that the First World War changed the popular mood:\nThe women's contribution to the war effort challenged the notion of women's physical and mental inferiority and made it more difficult to maintain that women were, both by constitution and temperament, unfit to vote. If women could work in munitions factories, it seemed both ungrateful and illogical to deny them a place in the polling booth. But the vote was much more than simply a reward for war work; the point was that women's participation in the war helped to dispel the fears that surrounded women's entry into the public arena.\nLate adopters in Europe were Spain in 1933, France in 1944, Italy in 1946, Greece in 1952, San Marino in 1959, Monaco in 1962, Andorra in 1970, Switzerland in 1971 at federal level, and at local canton level between 1959 in the cantons of Vaud and Neuchâtel and 1991 in the canton of Appenzell Innerrhoden, and Liechtenstein in 1984. In addition, although women in Portugal obtained suffrage in 1931, this was with stronger restrictions than those of men; full gender equality in voting was only granted in 1976.\nThe United States gave women equal voting rights in all states with the Nineteenth Amendment ratified in 1920. Canada and a few Latin American nations passed women's suffrage before World War II while the vast majority of Latin American nations established women's suffrage in the 1940s (see table in Summary below). The last Latin American country to give women the right to vote was Paraguay in 1961.\nIn December 2015, women were first allowed to vote in Saudi Arabia (municipal elections).\nExtended political campaigns by women and their supporters have generally been necessary to gain legislation or constitutional amendments for women's suffrage. In many countries, limited suffrage for women was granted before universal suffrage for men; for instance, literate women or property owners were granted suffrage before all men received it. The United Nations encouraged women's suffrage in the years following World War II, and the Convention on the Elimination of All Forms of Discrimination Against Women (1979) identifies it as a basic right with 189 countries currently being parties to this Convention.",title:"Women's suffrage"},Workers:{image:"Laborer.jpg",summary:"A laborer is a person who works in one of the construction trades, by tradition, considered unskilled manual labor -- though in practice the laborers are a skilled trade that has reliability and strength as core characteristics. Laborers are employed in the construction industry such as road paving, commercial buildings, bridges, tunnels. Laborers have all blasting, hand tools, power tools, air tools, and small heavy equipment, and act as assistants to other trades as well  such as operators or cement masons. The 1st century BC engineer Vitruvius writes about laborer practices at that time; a good crew of laborers is just as valuable as any other aspect of construction. Other than the addition of pneumatics, laborer practices have changed little. With the advent of advanced technology and its introduction into the construction field, the laborers have been quick to include much of this technology as being laborers work.",title:"Laborer"},Writing:{image:"Writing.jpg",summary:"Writing is a medium of human communication that represents language and emotion with signs and symbols. In most languages, writing is a complement to speech or spoken language. Writing is not a language, but a tool used to make languages be read. Within a language system, writing relies on many of the same structures as speech, such as vocabulary, grammar, and semantics, with the added dependency of a system of signs or symbols. The result of writing is called text, and the recipient of text is called a reader. Motivations for writing include publication, storytelling, correspondence and diary. Writing has been instrumental in keeping history, maintaining culture, dissemination of knowledge through the media and the formation of legal systems.\nAs human societies emerged, the development of writing was driven by pragmatic exigencies such as exchanging information, maintaining financial accounts, codifying laws and recording history. Around the 4th millennium BCE, the complexity of trade and administration in Mesopotamia outgrew human memory, and writing became a more dependable method of recording and presenting transactions in a permanent form. In both ancient Egypt and Mesoamerica, writing may have evolved through calendric and a political necessity for recording historical and environmental events.",title:"Writing"}};var game_info=null;var calendar_info=null;var game_rules=null;var ruleset_control=null;var ruleset_summary=null;var ruleset_description=null;var IDENTITY_NUMBER_ZERO=0;const TAB_MAP=0,TAB_EMPIRE=1,TAB_GOV=2,TAB_TECH=3,TAB_NATIONS=4,TAB_CITIES=5,TAB_PREFS=6,TAB_HELP=7;TAB_WARCALC=8;function game_init(){map={};terrains={};resources={};players={};units={};unit_types={};connections={};client.conn={};graphic_theme_path=simpleStorage.get("grtheme");if(!graphic_theme_path)graphic_theme_path="themes/greek/"}function game_find_city_by_number(id){return cities[id]}function game_find_unit_by_number(id){return units[id]}function civ_population(playerno){var population=0;for(var city_id in cities){var pcity=cities[city_id];if(playerno==pcity["owner"]){population+=city_population(pcity)}}return numberWithCommas(population*1e3)}function city_size_sum(playerno){var population=0;for(var city_id in cities){var pcity=cities[city_id];if(playerno==pcity["owner"]){population+=pcity["size"]+1}}return population}function update_game_status_panel(){if(C_S_RUNNING!=client_state())return;var status_html="";status_html="<span onclick='toggle_msgbox();' style='cursor: pointer;' title='Unread messages'><i class='fa fa-commenting-o' aria-hidden='true'></i>"+"<font color='#ff8080'>&nbsp;<b>"+(unread_messages>0?unread_messages:"")+"</b>&nbsp;&nbsp;&nbsp;</font></span>";if(client.conn.playing!=null){var pplayer=client.conn.playing;var tax=client.conn.playing["tax"];var lux=client.conn.playing["luxury"];var sci=client.conn.playing["science"];if(income_needs_refresh)city_force_income_update();var net_income=pplayer["expected_income"].toString();var income_str=net_income.slice(-2)==".5"?net_income.substring(0,net_income.length-2)+"</b>&#189<b>":net_income;if(pplayer["expected_income"]>0){net_income="+"+income_str}else net_income=income_str;if(!is_small_screen()){var pplayer=client.conn.playing;var pnation=nations[pplayer["nation"]];var tag=pnation["graphic_str"];var civ_flag="";if(!pnation["customized"]){civ_flag+="<img class='lowered_gov' style='background-color:transparent;margin-top:-3px;margin-right:3px;' src='/images/flags/"+tag+"-web"+get_tileset_file_extention()+"' width='42'>";status_html+="<span>"+civ_flag+"</span>"}}if(!is_small_screen())status_html+="<span style='cursor:default;'><b>"+nations[pplayer["nation"]]["adjective"]+"</b></span> &nbsp;";if(!is_small_screen()){status_html+="<span style='cursor:pointer;' onclick='javascript:show_revolution_dialog()'>";var gov_name=governments[client.conn.playing["government"]]["name"];var gov_modifier=get_gov_modifier(client.conn.playing.playerno,"",true);if(gov_name=="Anarchy")status_html+="<img class='lowered_gov' src='/images/gov.anarchy.png' title='Anarchy'>";else if(gov_name=="Despotism")status_html+="<img class='lowered_gov' src='/images/gov.despotism.png' title='Despotism'>";else if(gov_name=="Monarchy")status_html+="<img class='lowered_gov' src='/images/gov.monarchy"+gov_modifier+".png' title='"+gov_modifier+" Monarchy'>";else if(gov_name=="Communism")status_html+="<img class='lowered_gov' src='/images/gov.communism.png' title='Communism'>";else if(gov_name=="Republic")status_html+="<img class='lowered_gov' src='/images/gov.republic.png' title='Republic'>";else if(gov_name=="Democracy")status_html+="<img class='lowered_gov' src='/images/gov.democracy.png' title='Democracy'>";else if(gov_name=="Fundamentalism")status_html+="<img class='lowered_gov' src='/images/gov.fundamentalism.png' title='Fundamentalism'>";else if(gov_name=="Theocracy")status_html+="<img class='lowered_gov' src='/images/gov.theocracy.png' title='Theocracy'>";else if(gov_name.startsWith("Tribal"))status_html+="<img class='lowered_gov' src='/images/gov.tribalism.png' title='Tribalism'>";else if(gov_name=="Federation")status_html+="<img class='lowered_gov' src='/images/gov.federation.png' title='Federation'>";else if(gov_name=="Nationalism")status_html+="<img class='lowered_gov' src='/images/gov.nationalism.png' title='Nationalism'>";else status_html+="<img class='lowered_gov' src='/images/gov.despotism.png' title='"+gov_name+"'>"}status_html+="</span>";if(!is_small_screen())status_html+="<span style='cursor:pointer;' onclick='javascript:request_report(2)'>";if(!is_small_screen())status_html+="&nbsp; <i style='color:#ffc8c0' class='fa fa-child' aria-hidden='true' title='Total Citizens in all Cities'></i> ";if(!is_small_screen())status_html+="<b>"+city_size_sum(client.conn.playing.playerno)+"</b>  &nbsp;&nbsp;";if(!is_small_screen())status_html+="<i style='color:#d8dff0' class='fa fa-clock-o' aria-hidden='true' title='Year (turn)'></i> <b>"+get_year_string()+"</b> &nbsp;&nbsp;</span>";status_html+="<i style='color:#89c06a' class='fa fa-money' aria-hidden='true' title='Treasury'></i> ";var income_color="<b";if(pplayer["expected_income"]<0)income_color+=" class='negative_net_income' title='Deficit'";else if(pplayer["expected_income"]>0)income_color+=income_calculated_by_client?" style='color:#89c06a' title='Income'":" style='color:#a2b095' title='Income'";status_html+="<b style='color:#ffde80; cursor:default;' title='Gold'>"+pplayer["gold"]+"</b> "+income_color+" style='cursor:default;'>"+net_income+"</b>"+"  &nbsp;&nbsp;";status_html+="<span style='cursor:pointer;' onclick='javascript:show_tax_rates_dialog();'><i style='color:#ebb445' class='fa fa-btc' aria-hidden='true' title='Tax rate'></i> <b style='color:#fff0d1'>"+tax+"</b><span style='color:#bcbcbc'>%</span> &nbsp;";status_html+="<i style='color:#b087c5;' class='fa fa-music' aria-hidden='true' title='Luxury rate'></i> <b style='color:#f5e8ff'>"+lux+"</b><span style='color:#bcbcbc'>%</span> &nbsp;";const sci_title="Science:\n"+(techs[client.conn.playing["researching"]]===undefined?"":techs[client.conn.playing["researching"]]["name"])+"\n"+client.conn.playing["bulbs_researched"]+" / "+client.conn.playing["researching_cost"]+"\n"+bulb_output_text;status_html+="<i style='color:#a8ccd7;'class='fa fa-flask' aria-hidden='true' title='"+sci_title+"'></i> <b style='color:#ebfaff'>"+sci+"</b><span style='color:#bcbcbc'>%</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> "}else if(server_settings!=null&&server_settings["metamessage"]!=null){status_html+="Observing - Turn <b>"+game_info["turn"]+"</b> -";var status_message="";if(server_settings["metamessage"]["val"].indexOf("|")!=-1){status_message=server_settings["metamessage"]["val"].substr(0,server_settings["metamessage"]["val"].indexOf("|"))}status_html+=status_message+" &nbsp; &nbsp; &nbsp; &nbsp; "}if($(window).width()-sum_width()>880){if($("#game_status_panel_top").length){$("#game_status_panel_top").show();$("#game_status_panel_bottom").hide();$("#game_status_panel_top").html(status_html)}}else{if($("#game_status_panel_bottom").length){$("#game_status_panel_top").hide();if(show_order_buttons){$("#game_status_panel_bottom").show();$("#game_status_panel_bottom").css({width:$(window).width(),"pointer-events":"none"});$("#game_status_panel_bottom").html(status_html)}}}var page_title="Freeciv-web - "+username+"  (turn:"+game_info["turn"]+", port:"+civserverport+") ";if(server_settings["metamessage"]!=null){page_title+=server_settings["metamessage"]["val"]}document.title=page_title}function get_year_string(){var year_string="";if(game_info["year"]<0){year_string=Math.abs(game_info["year"])+calendar_info["negative_year_label"]}else if(game_info["year"]>=0){year_string=game_info["year"]+calendar_info["positive_year_label"]}if(is_small_screen()){year_string+=" (T:"+game_info["turn"]+")"}else{year_string+="&#x2014;Turn "+game_info["turn"]}return year_string}function current_turn_timeout(){if(game_info["turn"]==1&&game_info["first_timeout"]!=-1){return game_info["first_timeout"]}else{return game_info["timeout"]}}function sum_width(){var sum=0;$("#tabs_menu").children().each(function(){if($(this).is(":visible")&&$(this).attr("id")!="game_status_panel_top"&&$(this).attr("id").startsWith("ixtjkiller")){sum+=$(this).width()}});return sum}var governments={};var requested_gov=-1;var REPORT_WONDERS_OF_THE_WORLD=0;var REPORT_TOP_5_CITIES=1;var REPORT_DEMOGRAPHIC=2;var REPORT_ACHIEVEMENTS=3;var GOV_LAST=-1;function show_revolution_dialog(){const revo_height=680;var extended_height=0;var revo_width="490";var num_govs=Object.keys(governments).length;if(num_govs>7){extended_height=48*(num_govs-7);revo_width="780"}if(revo_height+extended_height>=$(window).height()){extended_height=$(window).height()-revo_height-4}var id="#revolution_dialog";remove_active_dialog(id);$("<div id='revolution_dialog'></div>").appendTo("div#game_page");if(client.conn.playing==null)return;var gov_name=governments[client.conn.playing["government"]]["name"];if(gov_name=="Monarchy")gov_name=get_gov_modifier(client.conn.playing.playerno,"Monarchy",true)+" "+gov_name;var dhtml="Current form of government: <b>"+gov_name+"</b><br>To start a revolution, select the new form of government:"+"<p><div id='governments' >"+"<div id='governments_list'>"+"</div></div><br> ";$(id).html(dhtml);$(id).attr("title","Start a Revolution!");$(id).dialog({bgiframe:true,modal:true,width:is_small_screen()?"99%":revo_width,height:is_small_screen()?$(window).height()-40:revo_height+extended_height,buttons:{"Start revolution!":function(){start_revolution();remove_active_dialog("#revolution_dialog")}}});dialog_register(id);update_govt_dialog()}function init_civ_dialog(){if(!client_is_observer()&&client.conn.playing!=null){var pplayer=client.conn.playing;var pnation=nations[pplayer["nation"]];var tag=pnation["graphic_str"];var civ_description="";var gov_modifier=get_gov_modifier(client.conn.playing.playerno,null,true);if(gov_modifier)gov_modifier+=" ";if(!pnation["customized"]){civ_description+="<img src='/images/flags/"+tag+"-web"+get_tileset_file_extention()+"' width='180'>"}civ_description+="<br><div>"+pplayer["name"]+" rules the "+nations[pplayer["nation"]]["adjective"]+" with the form of government: "+gov_modifier+governments[client.conn.playing["government"]]["name"]+"</div><br>";$("#nation_title").html("The "+nations[pplayer["nation"]]["adjective"]+" nation");$("#civ_dialog_text").html(civ_description)}else{$("#civ_dialog_text").html("This dialog isn't available as observer.")}}function update_govt_dialog(){var govt;var govt_id;if(client_is_observer())return;var governments_list_html="";for(govt_id in governments){govt=governments[govt_id];governments_list_html+="<button class='govt_button' id='govt_id_"+govt["id"]+"' "+"onclick='set_req_government("+govt["id"]+");' "+"title='"+cleaned_text(govt["helptext"])+"'>"+govt["name"]+"</button>"}$("#governments_list").html(governments_list_html);var magna_carta=get_gov_modifier(client.conn.playing.playerno,"Monarchy",false);var gov_modifier="";for(govt_id in governments){govt=governments[govt_id];gov_modifier=govt["name"]=="Monarchy"?magna_carta:"";label_html="<img class='lowered_gov' src='/images/e/"+govt["name"].toLowerCase()+gov_modifier+".png'>&nbsp;&nbsp;&nbsp;"+capitalize(gov_modifier)+" "+govt["name"]+"<img src='/images/e/techs/"+govt["name"].toLowerCase()+gov_modifier+".png' style='margin:-8px;margin-top:-9x;float:right;' "+"width='36px' height='36px'>";if(!can_player_get_gov(govt_id)){$("#govt_id_"+govt["id"]).button({disabled:true,label:label_html})}else if(requested_gov==govt_id){$("#govt_id_"+govt["id"]).button({label:label_html}).css({background:"url('/images/bg-light.jpg')",color:"black"})}else if(client.conn.playing["government"]==govt_id){$("#govt_id_"+govt["id"]).button({label:label_html}).css("background","url('/images/black-bg.png')").css("font-weight","bolder")}else{$("#govt_id_"+govt["id"]).button({label:label_html})}}}function start_revolution(){if(requested_gov!=-1){for(var unit_id in units){punit=units[unit_id];if(punit["owner"]==client.conn.playing.playerno){if(punit["activity"]==ACTIVITY_CONVERT){request_new_unit_activity(punit,ACTIVITY_IDLE,EXTRA_NONE)}}}var cur_gov=governments[client.conn.playing["government"]]["id"];if(do_worklists(cur_gov,governments[requested_gov]["id"]))setTimeout(send_player_change_government(requested_gov),1500);else send_player_change_government(requested_gov);requested_gov=-1}}function do_worklists(cur_gov_id,new_gov_id){var altered=false;for(city_id in cities){var pcity=cities[city_id];if(pcity["owner"]!=client.conn.playing.playerno)continue;if(pcity["worklist"]==null||pcity["worklist"].length==0)continue;var prev_worklist_len=pcity["worklist"].length;var cur_prod_is_legal=true;for(ut_id in unit_types){if(unit_types[ut_id].gov_requirement<GOV_LAST&&unit_types[ut_id].gov_requirement!=new_gov_id){pcity["worklist"]=pcity["worklist"].filter(list_item=>!(list_item["kind"]==VUT_UTYPE&&list_item["value"]==ut_id));if(pcity["production_kind"]==VUT_UTYPE&&pcity["production_value"]==ut_id){altered=true;cur_prod_is_legal=false}}}if(prev_worklist_len!=pcity["worklist"].length){send_city_worklist(pcity["id"]);altered=true}if(!cur_prod_is_legal){if(pcity["worklist"]!=null&&pcity["worklist"].length){send_city_change(pcity["id"],pcity["worklist"][0]["kind"],pcity["worklist"][0]["value"]);pcity["worklist"].shift();send_city_worklist(pcity["id"])}else{send_city_change(pcity["id"],VUT_IMPROVEMENT,Object.keys(improvements).length-1)}}}return altered}function set_req_government(gov_id){requested_gov=gov_id;update_govt_dialog()}function send_player_change_government(govt_id){var packet={pid:packet_player_change_government,government:govt_id};send_request(JSON.stringify(packet))}function government_max_rate(govt_id){var govt=governments[govt_id]["name"];if(govt=="Anarchy"){return 100}else if(govt=="Despotism"){return 60}else if(govt=="Monarchy"){return 70}else if(govt=="Communism"){return 80}else if(govt=="Republic"){return 80}else if(govt=="Democracy"){return 100}else if(govt=="Fundamentalism"){return 80}else if(govt=="Tribalism"){return 60}else if(govt=="Federation"){return 90}else if(govt=="Nationalism"){return 90}else if(govt=="Theocracy"){return 80}else{return 100}}function can_player_get_gov(govt_id){return player_has_wonder(client.conn.playing.playerno,improvement_id_by_name(B_STATUE_OF_LIBERTY_NAME))||are_reqs_active(client.conn.playing,null,null,null,null,null,null,governments[govt_id]["reqs"],RPT_CERTAIN)}function request_report(rtype){var packet={pid:packet_report_req,type:rtype};send_request(JSON.stringify(packet))}function show_climate_dialog(rtype){var title="Climate Report";var message="<br>";var warm_toler=Math.round(game_info["warminglevel"]*100/server_settings["globalwarming_percent"]["val"]);var warm_accum=game_info["globalwarming"]+warm_toler;var cold_toler=Math.round(game_info["coolinglevel"]*100/server_settings["nuclearwinter_percent"]["val"]);var cold_accum=game_info["nuclearwinter"]+cold_toler;message+="<span title='IF global warming occurs, the impact strength on the surface tiles of the planet.\n0% = none.\n100% = normal.\n101-10000 = elevated.'>"+"<b>Global Warming Strength</b>:&nbsp; "+game_info["global_warming"]+"%"+"</span><br>";message+="<span title='The current cumulative impact of existing pollution over recent turns, possibly accumulating higher beyond the tolerance to trigger Global Warming. A certain amount will naturally disperse each turn, if the impact caused by existing pollution is not greater.'>"+"<b>Global Warming Impact</b>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "+(game_info["globalwarming"]>0?warm_accum:"<span title='The impact is below tolerance or a major climate disaster has recently reset the climate models.'>[unknown]</span>")+"<span title='One unit of Accumulated Climate Stress, whether in measuring impact to climate, or tolerance to the stress.'> ACS</span>"+"</span><br>";message+="<span title='The current tolerance of the climate after exposure to recent impacts. This represents the natural reduction per turn that the Earth can ecologically absorb and process, and thus, also the tolerance beyond which global warming has a chance to trigger.'>"+"<b>Global Warming Tolerance</b>: "+warm_toler+"<span title='One unit of Accumulated Climate Stress, whether in measuring impact to climate, or tolerance to that stress.'> ACS </span>"+"</span><br>";message+="<span title='This is a server setting. Higher numbers make Global Warming more likely, by altering the Global Warming Tolerance shown above. Default of 100% = unchanged.'>"+"<b>Global Warming Percent</b>:&nbsp;&nbsp;&nbsp; "+server_settings["globalwarming_percent"]["val"]+"%</span><br><br>";if(game_info["globalwarming"]>game_info["warminglevel"])message+="Scientists recommend immediate international action to halt habitat destruction from Global Warming!!<br><br>";else if(game_info["globalwarming"]>game_info["warminglevel"]*.5)message+="Scientists are concerned that pollution impact is too close to Climate Tolerance levels.<br><br>";message+="<br><span title='IF nuclear winter occurs, the impact strength on the surface tiles of the planet.\n0% = none.\n100% = normal.\n101-10000 = elevated.'>"+"<b>Nuclear Winter Strength</b>:&nbsp; "+game_info["nuclear_winter"]+"%"+"</span><br>";message+="<span title='The current cumulative impact of existing fallout over recent turns, possibly accumulating higher beyond the tolerance to trigger Nuclear Winter. A certain amount will naturally disperse each turn, if the impact caused by existing fallout is not greater.'>"+"<b>Nuclear Winter Impact</b>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "+(game_info["nuclearwinter"]>0?cold_accum:"<span title='The impact is below tolerance or a major climate disaster has recently reset the climate models.'>[unknown]</span>")+"<span title='One unit of Accumulated Climate Stress, whether in measuring impact to climate, or tolerance to that stress.'> ACS </span>"+"</span><br>";message+="<span title='The current tolerance of the climate after exposure to recent impacts. This represents the natural reduction per turn that the Earth can ecologically absorb and process, and thus, also the tolerance beyond which nuclear winter has a chance to trigger.'>"+"<b>Nuclear Winter Tolerance</b>: "+cold_toler+"<span title='One unit of Accumulated Climate Stress, whether in measuring impact to climate, or tolerance to that stress.'> ACS </span>"+"</span><br>";message+="<span title='This is a server setting. Higher numbers make Nuclear Winter more likely, by altering the Nuclear Winter Tolerance shown above. Default of 100% = unchanged.'>"+"<b>Nuclear Winter Percent</b>:&nbsp;&nbsp;&nbsp; "+server_settings["nuclearwinter_percent"]["val"]+"%</span><br><br>";if(game_info["nuclearwinter"]>game_info["coolinglevel"])message+="Scientists recommend immediate international action to halt habitat destruction from Nuclear Winter!!<br>";else if(game_info["nuclearwinter"]>game_info["coolinglevel"]*.5)message+="Scientists are concerned that fallout impact is too close to Climate Tolerance levels.<br>";remove_active_dialog("#dialog");$("<div id='dialog'></div>").appendTo("div#game_page");$("#dialog").html(message);$("#dialog").attr("title",title);$("#dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"90%":"40%",buttons:{"Close (𝗪)":function(){remove_active_dialog("#dialog")}}});$("#dialog").dialog("open");dialog_register("#dialog")}function get_gov_modifier(playerno,gov_name,uppercase){if(!client_rules_flag[CRF_MP2_C])return"";if(!gov_name)gov_name=governments[players[playerno]["government"]]["name"];var gov_modifier="";if(players[playerno].wonders[improvement_id_by_name(B_MAGNA_CARTA)]){if(gov_name=="Monarchy")gov_modifier=uppercase?"Constitutional":"constitutional"}return gov_modifier}var submitted_to_hof=false;function submit_game_to_hall_of_fame(){if(client_is_observer()||client.conn.playing==null||submitted_to_hof||is_longturn()||$.getUrlVar("action")=="multi"){return}submitted_to_hof=true;var pplayer=client.conn.playing;if(game_info["turn"]<30||get_score_text(pplayer)==0){return}$.ajax({type:"POST",url:"/hall_of_fame_post?username="+username+"&nation="+nations[pplayer["nation"]]["adjective"]+"&score="+get_score_text(pplayer)+"&turn="+game_info["turn"]+"&port="+civserverport,success:function(data,textStatus,request){$("#hof_msg").html("Game submitted to Hall of Fame! See it <a href='/hall_of_fame' target='_new'>here</a>.")}}).fail(function(){swal("Unable to submit game to Hall of Fame. Please try again later!");setSwalTheme();$.unblockUI()})}var toplevel_menu_items=["help_terrain","help_economy","help_cities","help_city_improvements","help_wonders_of_the_world","help_units","help_combat","help_technology","help_government"];var hidden_menu_items=["help_connecting","help_languages","help_governor","help_chatline","help_about","help_worklist_editor","help_nations","help_copying"];var max_help_pane_width;var MAX_ALLOWED_HELP_WIDTH=984;function show_help(){$("#tabs-hel").show();$("#help_footer").hide();$("#help_footer").remove();$("#help_menu").remove();$("#help_info_page").remove();$("<ul id='help_menu'></ul><div id='help_info_page'></div>").appendTo("#tabs-hel");generate_help_menu("help_gen_ruleset");for(var sec_id in helpdata_order){var key=helpdata_order[sec_id];if(sec_id)if(hidden_menu_items.indexOf(key)>-1||key=="help_gen_ruleset"){continue}else if(key.indexOf("help_gen")!=-1){generate_help_menu(key)}else if(toplevel_menu_items.indexOf(key)>-1){generate_help_toplevel(key)}else{var parent_key=find_parent_help_key(key);$("<li id='"+key+"' data-helptag='"+key+"'>"+helpdata_tag_to_title(key)+"</li>").appendTo(parent_key)}}$("#help_menu").menu({select:function(event,ui){handle_help_menu_select(ui)}});show_help_intro();$("#tabs-hel").css("height",$(window).height()-60);if(is_small_screen()){$("#help_info_page").css("max-width",$(window).width()-165);$("#help_info_page").css({margin:"0px",padding:"0px","font-size":"90%"});$("#help_footer").remove();$("#help_footer").hide()}else{max_help_pane_width=$(window).width()-$("#help_menu").width()-60;if(max_help_pane_width>MAX_ALLOWED_HELP_WIDTH)max_help_pane_width=MAX_ALLOWED_HELP_WIDTH;$("#help_info_page").css("max-width",max_help_pane_width);$("#help_footer").show()}}function show_help_intro(){$.get("/docs/help_intro.txt",function(data){$("#help_info_page").html(data)})}function generate_help_menu(key){var impr_id;var improvement;if(key=="help_gen_terrain"){for(var terrain_id in terrains){var terrain=terrains[terrain_id];$("<li data-helptag='"+key+"_"+terrain["id"]+"'>"+terrain["name"]+"</li>").appendTo("#help_terrain_ul")}}else if(key=="help_gen_improvements"){var sortedBuildings=[];const impr_idx=0;for(impr_id in improvements){sortedBuildings.push([impr_id,improvements[impr_id]])}sortedBuildings.sort(function(a,b){return a[1]["name"]>b[1]["name"]?1:-1});for(id in sortedBuildings){improvement=improvements[sortedBuildings[id][impr_idx]];if(is_wonder(improvement))continue;if(!server_settings["nukes_major"]["val"]&&improvement["name"]=="Enrichment Facility"){continue}$("<li data-helptag='"+key+"_"+improvement["id"]+"'>"+improvement["name"]+"</li>").appendTo("#help_city_improvements_ul")}}else if(key=="help_gen_wonders"){for(impr_id in improvements){improvement=improvements[impr_id];if(!is_wonder(improvement))continue;s=improvement["name"].slice(-1);if(s!=alphanumeric_cleaner(s))continue;if(!server_settings["nukes_minor"]["val"]&&improvement["name"]=="Manhattan Project"){continue}$("<li data-helptag='"+key+"_"+improvement["id"]+"'>"+improvement["name"]+"</li>").appendTo("#help_wonders_of_the_world_ul")}}else if(key=="help_gen_units"){for(var i=0;i<unittype_ids_alphabetic().length;i++){var unit_id=unittype_ids_alphabetic()[i];var punit_type=unit_types[unit_id];if(utype_has_flag(punit_type,UTYF_NUCLEAR)){if(!server_settings["nukes_minor"]["val"])continue;if(!server_settings["nukes_major"]["val"]){if(punit_type["bombard_rate"]>0)continue;if(punit_type["bombard_rate"]<-1)continue}}$("<li data-helptag='"+key+"_"+punit_type["id"]+"'>"+punit_type["name"]+"</li>").appendTo("#help_units_ul")}}else if(key=="help_gen_techs"){for(var tech_id in techs){var tech=techs[tech_id];if(tech_id==0)continue;$("<li data-helptag='"+key+"_"+tech["id"]+"'>"+tech["name"]+"</li>").appendTo("#help_technology_ul")}}else if(key=="help_gen_governments"){for(var gov_id in governments){var pgov=governments[gov_id];$("<li data-helptag='"+key+"_"+pgov["id"]+"'>"+pgov["name"]+"</li>").appendTo("#help_government_ul")}}else if(key=="help_gen_ruleset"){$("<li id='"+key+"' data-helptag='"+key+"'>"+"Ruleset"+"</li>").appendTo(find_parent_help_key(key))}}function render_sprite(sprite){var msg="<div class='help_unit_image' style=' background: transparent url("+sprite["image-src"]+");background-position:-"+sprite["tileset-x"]+"px -"+sprite["tileset-y"]+"px;  width: "+sprite["width"]+"px;height: "+sprite["height"]+"px;'"+"></div>";return msg}function generate_help_toplevel(key){var parent_key=find_parent_help_key(key);$("<li id='"+key+"' data-helptag='"+key+"'>"+helpdata_tag_to_title(key)+"</li>").appendTo(parent_key);$("<ul id='"+key+"_ul' class='help_submenu'></ul>").appendTo("#"+key)}function find_parent_help_key(key){if(key=="help_terrain_alterations"){return"#help_terrain_ul"}else if(key=="help_villages"||key=="help_borders"){return"#help_terrain_ul"}else if(key=="help_food"||key=="help_production"||key=="help_trade"){return"#help_economy_ul"}else if(key=="help_specialists"||key=="help_happiness"||key=="help_pollution"||key=="help_plague"||key=="help_migration"){return"#help_cities_ul"}else if(key=="help_combat_example_1"||key=="help_combat_example_2"){return"#help_combat_ul"}else{return"#help_menu"}}function handle_help_menu_select(ui){var selected_tag=$(ui.item).data("helptag");if(selected_tag.indexOf("help_gen")!=-1){generate_help_text(selected_tag)}else if(selected_tag=="help_copying"){$.get("/docs/LICENSE.txt",function(data){$("#help_info_page").html("<h1>Freeciv-Web License</h1>"+data.replace(/\n/g,"<br>"))});clear_sidebar()}else if(selected_tag=="help_controls"){$.get("/docs/controls.txt",function(data){$("#help_info_page").html(data.replace(/\n/g,""))});clear_sidebar()}else{var msg="<h1>"+helpdata_tag_to_title(selected_tag)+"</h1>"+helpdata[selected_tag]["text"];$("#help_info_page").html(msg)}$("#help_info_page").focus()}function clear_sidebar(){if(is_small_screen()){$("#help_info_page").css("max-width",$(window).width());$("#help_info_page").css("padding","1px");$("#help_menu").hide()}}function wiki_on_item_button(item_name){item_name=string_unqualify(item_name);if(freeciv_wiki_docs[item_name]==null){console.log("No wiki data about "+item_name);return""}return"<button class='help_button' onclick=\"show_wikipedia_dialog('"+item_name.replace(/'/g,"\\'")+"');\">Wikipedia on "+item_name+"</button>"}function helpdata_format_current_ruleset(){var msg="";if(ruleset_control!=null){msg+="<h1>"+ruleset_control["name"]+"</h1>"}if(ruleset_summary!=null){msg+="<p>"+ruleset_summary.replace(/\n/g,"<br>")+"</p>"}if(ruleset_description!=null){msg+="<p>"+ruleset_description.replace(/\n/g,"<br>")+"</p>"}return msg}function generate_help_text(key){var flx_tab="0.30";var pane_class="helptext_pane";if(is_small_screen()){$("#help_info_page").css("max-width",$(window).width());$("#help_info_page").css("padding","1px");$("#help_menu").hide();flx_tab="0.55";pane_class+="_mobile"}var rulesetdir=ruledir_from_ruleset_name(ruleset_control["name"],"");var msg="";const hr="<hr style='border-top: 1px solid #000'>";if(key.indexOf("help_gen_terrain")!=-1){var terrain=terrains[parseInt(key.replace("help_gen_terrain_",""))];msg="<h1>"+terrain["name"]+"</h1>"+"<div class='"+pane_class+"'>"+cleaned_text(terrain["helptext"])+"<b><br><br>Movement cost: "+terrain["movement_cost"]+"<br>Defense bonus: "+terrain["defense_bonus"]+"<br>Food/Prod/Trade: "+terrain["output"][0]+"/"+terrain["output"][1]+"/"+terrain["output"][2]+"</b></div>"}else if(key.indexOf("help_gen_improvements")!=-1||key.indexOf("help_gen_wonders")!=-1){var improvement=improvements[parseInt(key.replace("help_gen_wonders_","").replace("help_gen_improvements_",""))];msg="<h1>"+improvement["name"]+"</h1>"+"<div class='"+pane_class+"'>"+render_sprite(get_improvement_image_sprite(improvement))+"<br>"+cleaned_text(improvement["helptext"])+"<b><br><br>Cost: "+improvement["build_cost"]+"<br>Upkeep: "+improvement["upkeep"];var reqs=get_improvement_requirements(improvement["id"]);if(reqs!=null){msg+="<br>Requirements: ";for(var n=0;n<reqs.length;n++){msg+=techs[reqs[n]]["name"]+" "}}msg+="<br><br></b></div>";msg+=wiki_on_item_button(improvement["name"])}else if(key.indexOf("help_gen_units")!=-1){var obsolete_by;var punit_type=unit_types[parseInt(key.replace("help_gen_units_",""))];var punit_class=unit_classes[punit_type["unit_class_id"]];var pstats=utype_get_extra_stats(punit_type);var bstats=utype_get_bombard_stats(punit_type);var flex=" style='display:flex;' ";var span1="<span style='flex:"+flx_tab+";'>";var span2="<span style='font-family:Arial; font-weight:bold; color:#48F;'>";var span_end="</span>";var div_end="</span></div>";msg="<h1 style='margin-top:0px;font-size:190%'>"+punit_type["name"]+"</h1>";msg+="<div style='margin-bottom:10px;margin-top:-10px'>"+render_sprite(get_unit_type_image_sprite(punit_type))+"</div>";msg+="<div id='manual_non_helptext_facts' style='max-width:"+max_help_pane_width+"px;'>";msg+="<div"+flex+"id='utype_fact_cost'>";msg+=span1+"Cost: "+span_end+span2+punit_type["build_cost"]+div_end;msg+="<div"+flex+" id='utype_fact_attack_str'>";var as=fractionalize(utype_real_base_attack_strength(punit_type));msg+=span1+"Attack: "+span_end+span2+as+div_end;msg+="<div"+flex+" id='utype_fact_defense_str'>";var ds=fractionalize(utype_real_base_defense_strength(punit_type));msg+=span1+"Defense: "+span_end+span2+ds+div_end;msg+="<div"+flex+" id='utype_fact_firepower'>";msg+=span1+"Firepower: "+span_end+span2+punit_type["firepower"]+div_end;msg+="<div"+flex+" id='utype_fact_hp'>";msg+=span1+"Hitpoints: "+span_end+span2+punit_type["hp"]+div_end;msg+="<div"+flex+" id='utype_fact_move_rate'>";var move_bonus=parseInt(punit_type["move_bonus"][0])?parseInt(punit_type["move_bonus"][0]):0;var move_rate="";move_rate+=move_points_text(parseInt(punit_type["move_rate"])+move_bonus,true);msg+=span1+"Moves: "+span_end+span2+String(move_rate)+div_end;msg+="<div"+flex+" id='utype_fact_vision'>";msg+=span1+"Vision: "+span_end+span2+Math.sqrt(parseInt(punit_type["vision_radius_sq"])).toFixed(2)+" tiles"+div_end;if(punit_type["fuel"]>0){msg+="<div"+flex+" id='utype_fact_fuel'>";msg+=span1+"Fuel: "+span_end+span2+punit_type["fuel"];msg+=div_end}if(punit_type["transport_capacity"]>0){msg+="<div"+flex+" id='utype_fact_cargo'>";msg+=span1+"Cargo: "+span_end+span2+punit_type["transport_capacity"];msg+=div_end}msg+="<div"+flex+" id='utype_fact_minspeed'>";msg+=span1+"Min_speed: "+span_end+span2;if(utype_has_class_flag(punit_type,UCF_DAMAGE_SLOWS))msg+=move_points_text(punit_class["min_speed"],false);else msg+="100%";msg+=div_end;msg+="<div"+flex+" id='utype_fact_upkeep'></span></div>";if(pstats.iPillage){msg+="<div"+flex+" id='utype_fact_ipillage'>";msg+=span1+"iPillage &nbsp;: "+span_end+span2;msg+=pstats.iPillage_odds+"% odds. "+pstats.iPillage_moves+(pstats.iPillage_moves>1?" moves.":" move.");if(pstats.iPillage_random_targets)msg+=" "+pstats.iPillage_random_targets+" random "+(pstats.iPillage_random_targets>1?"targets":"target");msg+=div_end}if(utype_has_flag(punit_type,UTYF_BOMBARDER)){var bombard_name=utype_get_bombard_name(punit_type);msg+="<div"+flex+" id='utype_fact_bombard'>";msg+=span1+bombard_name.replace(" ","&nbsp;")+":&nbsp;&nbsp;"+span_end+span2;msg+=punit_type["bombard_rate"]+(punit_type["bombard_rate"]>1?" rounds. ":"round.");if(bstats.bombard_primary_targets){msg+=bstats.bombard_primary_targets;msg+=bstats.bombard_primary_targets>1?" targets. ":" target. "}else msg+="ALL targets. ";if(bstats.bombard_move_cost)msg+=move_points_text(bstats.bombard_move_cost,false)+(bstats.bombard_move_cost>SINGLE_MOVE?" moves.":" move.");else msg+=move_points_text(punit_type["move_rate"],false)+" moves.";msg+=div_end}var impr_reqs;var first_req=true;for(var i=0;i<punit_type["build_reqs"].length;i++){if(punit_type["build_reqs"][i]["kind"]==VUT_IMPROVEMENT){var req=improvements[punit_type["build_reqs"][i]["value"]]["name"];if(first_req){impr_reqs=req;first_req=false}else{impr_reqs+=", "+req}}}if(!first_req){msg+="<div"+flex+" id='utype_fact_req_building'>";msg+=span1+"Building Reqs: "+span_end+span2;msg+=impr_reqs+" ";msg+=div_end}var treq=punit_type["tech_requirement"];if(treq!=null&&techs[treq]!=null){msg+="<div"+flex+" id='utype_fact_req_tech'>";msg+=span1+"Tech Req: "+span_end+span2+techs[treq]["name"]+div_end}obsolete_by=unit_types[punit_type["obsoleted_by"]];msg+="<div"+flex+" id='utype_fact_obsolete'>";msg+=span1+"Obsolete by: "+span_end+span2;if(obsolete_by==U_NOT_OBSOLETED){msg+="None"}else{msg+=obsolete_by["name"]}msg+=div_end;msg+="</div>"+hr;msg+="<div id='helptext' style='font-weight:500; max-width:"+max_help_pane_width+"px'><p>"+cleaned_text(punit_type["helptext"])+"</p></div>"+hr;msg+=wiki_on_item_button(punit_type["name"]);msg+="<div id='datastore' hidden='true'></div>"}else if(key.indexOf("help_gen_techs")!=-1){var tech=techs[parseInt(key.replace("help_gen_techs_",""))];msg="<h1>"+tech["name"]+"</h1>"+"<div class='"+pane_class+"'><b>"+render_sprite(get_technology_image_sprite(tech))+"<br>"+get_advances_text(tech["id"]);msg+="<br><br>";msg+="<div id='helptext'><p>"+cleaned_text(tech["helptext"])+"</p></b></div></div>";msg+=wiki_on_item_button(tech["name"])}else if(key=="help_gen_ruleset"){msg=helpdata_format_current_ruleset()}else if(key.indexOf("help_gen_governments")!=-1){var pgov=governments[parseInt(key.replace("help_gen_governments_",""))];var gov_img="<img src='/images/e/techs/"+pgov["name"].toLowerCase()+".png'>";msg="<h1>"+gov_img+" "+pgov["name"]+"</h1>"+"<div class='"+pane_class+"'>";msg+="<div id='helptext'><p>"+cleaned_text(pgov["helptext"])+"</p></div></div>";msg+=wiki_on_item_button(pgov["name"])}$("#help_info_page").html(msg);if(rulesetdir.length!=0){if(key.indexOf("help_gen_units")!=-1){var utype_id=parseInt(key.replace("help_gen_units_",""));$("#helptext").load("../man/"+rulesetdir+"7.html #utype"+utype_id+" .helptext");$("#datastore").load("../man/"+rulesetdir+"7.html #utype"+utype_id+" .upkeep",function(){$("#utype_fact_upkeep")[0].innerHTML=$("#datastore")[0].children[0].innerHTML.replace("Upkeep:",span1+"Upkeep:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"+span_end+span2)})}else if(key.indexOf("help_gen_governments")!=-1){var gov_id=parseInt(key.replace("help_gen_governments_",""));$("#helptext").load("../man/"+rulesetdir+"6.html #gov"+gov_id+" .helptext")}}$(".help_button").button()}function helpdata_tag_to_title(tag){var result=tag.replace("_of_the_world","").replace("help_","").replace("gen_","").replace("misc_","").replace(/_/g," ");return to_title_case(result)}var num_hotseat_players=2;var hotseat_players=[];var hotseat_active_player=0;var hotseat_enabled=false;var hotseat_pwd={};function show_hotseat_dialog(){var message="Now you can start a new hotseat game, where two or more "+"players plays on the same device by taking turns playing the game.<br>"+"Please give the names of each human player here:"+"<br><br><div id='new_hotseat_players'>"+"<div class='hotseat_player'>Player name 1: <input id='username_req_1' type='text' size='25' maxlength='31'></div>"+"<div class='hotseat_player'>Player name 2: <input id='username_req_2' type='text' size='25' maxlength='31'></div>"+"</div>"+"<br><br><span id='username_validation_result' style='display:none;'></span>";$("#hotseat_dialog").remove();$("<div id='hotseat_dialog'></div>").appendTo("div#game_page");$("#hotseat_dialog").html(message);$("#hotseat_dialog").attr("title","New hotseat game");$("#hotseat_dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"95%":"55%",height:500,buttons:{"Add player":function(){add_hotseat_player()},"New hotseat game":function(){new_hotseat_game()}}});$("#hotseat_dialog").dialog("open");var stored_username=simpleStorage.get("username","");if(stored_username!=null&&stored_username!=false){$("#username_req_1").val(stored_username)}}function new_hotseat_game(){for(var i=1;i<=num_hotseat_players;i++){if(!validate_hotseat_username("#username_req_"+i))return}username=$("#username_req_1").val();simpleStorage.set("username",username);hotseat_enabled=true;network_init();setTimeout(setup_hotseat_game,900)}function setup_hotseat_game(){if(ws!=null&&ws.readyState===1){set_alternate_turns();send_message("/set autotoggle disabled");hotseat_players.push($("#username_req_1").val());for(var i=2;i<=num_hotseat_players;i++){send_message("/create "+$("#username_req_"+i).val());send_message("/ai "+$("#username_req_"+i).val());hotseat_players.push($("#username_req_"+i).val())}$("#hotseat_dialog").dialog("close");send_message("Press Start Game to begin.")}else{setTimeout(setup_hotseat_game,500)}}function validate_hotseat_username(field){return is_username_valid_show($(field).val())}function add_hotseat_player(){if(num_hotseat_players>=125){swal("Support for more players is not available now.");setSwalTheme();return}num_hotseat_players+=1;$("#new_hotseat_players").append("<div class='hotseat_player'>Player name "+num_hotseat_players+": <input id='username_req_"+num_hotseat_players+"' type='text' size='25' maxlength='31'></div>")}function is_hotseat(){return $.getUrlVar("action")=="hotseat"||hotseat_enabled}function hotseat_next_player(){hotseat_active_player=(hotseat_active_player+1)%num_hotseat_players;send_message("/take "+hotseat_players[hotseat_active_player]);clear_chatbox();setTimeout(function(){advance_unit_focus(false)},400);$("#turn_done_button").button("option","disabled",false);$("#turn_done_button").button("option","label","Turn Done");show_hotseat_new_phase()}function show_hotseat_new_phase(){if(hotseat_players.length==0)hotseat_load_refresh();var message="It is now "+hotseat_players[hotseat_active_player]+"'s turn to play in this hotseat game.";if(hotseat_pwd[hotseat_players[hotseat_active_player]]!=null){message+="<br><br>Player password: <input id='hotseat_pwd' type='password' size='25' maxlength='31'>"}dialog_close_trigger="";$("#hotseat_dialog").remove();$("<div id='hotseat_dialog'></div>").appendTo("body");$("#hotseat_dialog").html(message);$("#hotseat_dialog").attr("title","Hotseat game");$("#hotseat_dialog").dialog({modal:true,width:"50%",beforeClose:function(event,ui){if(dialog_close_trigger!="button"){return false}else{return true}},buttons:{"Add password":function(){dialog_close_trigger="button";add_hotseat_password()},"Play turn":function(){if(hotseat_pwd[hotseat_players[hotseat_active_player]]!=null&&hotseat_pwd[hotseat_players[hotseat_active_player]]!=$("#hotseat_pwd").val()){swal("Invalid password.");setSwalTheme();return}dialog_close_trigger="button";$("#hotseat_dialog").dialog("close");$("#game_text_input").blur();keyboard_input=true;$("#game_page").show();set_default_mapview_active();advance_unit_focus(false)}}});$("#hotseat_dialog").dialog("open");if(overview_active)$("#game_overview_panel").parent().hide();$("#game_unit_panel").parent().hide();setTimeout(function(){$("#game_unit_panel").parent().hide()},1e3);if(chatbox_active)$("#game_chatbox_panel").parent().hide();$("#game_page").hide();keyboard_input=false}function add_hotseat_password(){var message="Set player password in this hotseat game for "+hotseat_players[hotseat_active_player]+":<br><br><input id='new_hotseat_pwd' type='password' size='25' maxlength='31'>";if(hotseat_pwd[hotseat_players[hotseat_active_player]]!=null){swal("Password already set.");setSwalTheme();return}keyboard_input=false;$("#hotseatpwd_dialog").remove();$("<div id='hotseatpwd_dialog'></div>").appendTo("body");$("#hotseatpwd_dialog").html(message);$("#hotseatpwd_dialog").attr("title","Hotseat game");$("#hotseatpwd_dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"95%":"50%",buttons:{Cancel:function(){$("#hotseatpwd_dialog").dialog("close");keyboard_input=true},"Set password, start turn":function(){var pwd=$("#new_hotseat_pwd").val();hotseat_pwd[hotseat_players[hotseat_active_player]]=pwd;keyboard_input=true;$("#hotseatpwd_dialog").dialog("close");$("#hotseat_dialog").dialog("close");$("#game_text_input").blur();keyboard_input=true;$("#game_page").show();set_default_mapview_active();advance_unit_focus(false)}}});$("#hotseatpwd_dialog").dialog("open")}function hotseat_load_refresh(){num_hotseat_players=0;for(var player_id in players){var pplayer=players[player_id];if(pplayer["flags"].isSet(PLRF_AI)==false){hotseat_players.push(pplayer["name"]);num_hotseat_players++}}for(var player_id in players){var pplayer=players[player_id];if(pplayer["flags"].isSet(PLRF_AI)==false&&pplayer["phase_done"]==false){return}if(hotseat_players.indexOf(pplayer["name"])>=0)hotseat_active_player++}}const B_AIRPORT_NAME="Airport";const B_RECYCLING_CENTER="Recycling Center";const B_PALACE_NAME="Palace";const B_ECC_PALACE_NAME="Ecclesiastical Palace";const B_ADAM_SMITH_NAME="A.Smith's Trading Co.";const B_ANGKOR_WAT="Angkor Wat";const B_APPIAN_WAY="Appian Way";const B_COLOSSUS="Colossus";const B_GIBRALTAR_FORTRESS="Gibraltar Fortress";const B_HOOVER_DAM="Hoover Dam";const B_LIGHTHOUSE="Lighthouse";const B_MAGNA_CARTA="Magna Carta";const B_MEDICI_BANK="Medici Bank";const B_STATUE_OF_LIBERTY_NAME="Statue of Liberty";const B_TESLAS_LABORATORY="Tesla's Laboratory";var B_LAST=MAX_NUM_BUILDINGS;const improvements={};const improvements_name_index={};var communist_discounts={Riflemen:5,"Dive Bomber":10,Armor:10};var nationalist_discounts={"Police Station":10};var colossus_discounts={Boat:3,Trireme:5,Galley:5,Caravan:5,Caravel:5,"Cargo Ship":5};var appian_discounts={Wagon:5};var angkorwat_discounts={Elephants:5};function improvements_init(){Object.keys(improvements).forEach(k=>delete improvements[k]);Object.keys(improvements_name_index).forEach(k=>delete improvements_name_index[k])}function improvements_add_building(improvement){improvements[improvement.id]=improvement;improvements_name_index[improvement.name]=improvement.id}function get_improvements_from_tech(tech_id){var result=[];for(var improvement_id in improvements){var pimprovement=improvements[improvement_id];var reqs=get_improvement_requirements(improvement_id);for(var i=0;i<reqs.length;i++){if(reqs[i]==tech_id){result.push(pimprovement)}}}return result}function is_wonder(improvement){return improvement["soundtag"][0]=="w"}function get_improvement_requirements(improvement_id){var result=[];var improvement=improvements[improvement_id];if(improvement!=null&&improvement["reqs"]!=null){for(var i=0;i<improvement["reqs"].length;i++){if(improvement["reqs"][i]["kind"]==1&&improvement["reqs"][i]["present"]){result.push(improvement["reqs"][i]["value"])}}}return result}function improvement_id_by_name(name){return improvements_name_index.hasOwnProperty(name)?improvements_name_index[name]:-1}function get_universal_discount_price(ptype,pcity){if(!pcity)pcity=active_city;var playerno;if(!pcity)playerno=client.conn.playing.playerno;else playerno=pcity.owner;if(client_rules_flag[CRF_MP2_SPECIAL_UNITS]&&governments[players[playerno].government].name=="Communism"){if(communist_discounts[ptype["name"]]){if(!client_rules_flag[CRF_MP2_C]){if(ptype["name"]=="Armor")return ptype["build_cost"]}return ptype["build_cost"]-communist_discounts[ptype["name"]]}}if(client_rules_flag[CRF_MP2_C]&&governments[players[playerno].government].name=="Nationalism"){if(nationalist_discounts[ptype["name"]])return ptype["build_cost"]-nationalist_discounts[ptype["name"]]}if(client_rules_flag[CRF_MP2_C]){if(ptype["name"]=="City Walls"&&player_invention_state(players[playerno],tech_id_by_name("Steel"))==TECH_KNOWN){return ptype["build_cost"]+10}if(ptype["name"]=="Coastal Defense"&&player_has_wonder(playerno,improvement_id_by_name(B_GIBRALTAR_FORTRESS))){return ptype["build_cost"]-15}if(ptype["name"]=="Hydro Plant"&&player_has_wonder(playerno,improvement_id_by_name(B_HOOVER_DAM))){return ptype["build_cost"]-5}}if(pcity&&client_rules_flag[CRF_COLOSSUS_DISCOUNT]&&city_has_building(pcity,improvement_id_by_name(B_COLOSSUS))){if(colossus_discounts[ptype["name"]])return ptype["build_cost"]-colossus_discounts[ptype["name"]]}if(pcity&&client_rules_flag[CRF_MP2_C]&&city_has_building(pcity,improvement_id_by_name(B_APPIAN_WAY))){if(appian_discounts[ptype["name"]])return ptype["build_cost"]-appian_discounts[ptype["name"]]}if(pcity&&client_rules_flag[CRF_MP2_C]&&city_has_building(pcity,improvement_id_by_name(B_ANGKOR_WAT))){if(angkorwat_discounts[ptype["name"]])return ptype["build_cost"]-angkorwat_discounts[ptype["name"]]}return ptype["build_cost"]}function show_intelligence_report_dialog(){if(selected_player==-1)return;var pplayer=players[selected_player];if(client_is_observer()||selected_player==client.conn.playing["playerno"]||client.conn.playing.real_embassy[selected_player]){show_intelligence_report_embassy(pplayer)}else{show_intelligence_report_hearsay(pplayer)}}function show_intelligence_report_hearsay(pplayer){var msg="Ruler "+pplayer["name"]+"<br>";if(pplayer["government"]>0){var gov_mod=get_gov_modifier(pplayer.playerno,"",true);var gov_name=governments[pplayer["government"]]["name"];if(gov_mod)gov_name=gov_mod+" "+gov_name;msg+="Government: "+gov_name+"<br>"}if(pplayer["gold"]>0){msg+="Gold: "+pplayer["gold"]+"<br>"}if(pplayer["researching"]!=null&&pplayer["researching"]>0&&techs[pplayer["researching"]]!=null){msg+="Researching: "+techs[pplayer["researching"]]["name"]+"<br>"}msg+="<br><br>Establishing an embassy enables a detailed intelligence report, treaties, and trade.";show_dialog_message("Intelligence report for "+pplayer["name"],msg)}function show_intelligence_report_embassy(pplayer){remove_active_dialog("#intel_dialog");$("<div id='intel_dialog'></div>").appendTo("div#game_page");const capital=player_capital(pplayer);var gov_mod=get_gov_modifier(pplayer.playerno,"",true);var gov_name=governments[pplayer["government"]]["name"];const natl_adj=nations[pplayer["nation"]]["adjective"];if(gov_mod)gov_name=gov_mod+" "+gov_name;var intel_data={ruler:pplayer["name"],government:gov_name,capital:capital?capital.name:"(capital unknown)",gold:pplayer["gold"],tax:pplayer["tax"]+"%",science:pplayer["science"]+"%",luxury:pplayer["luxury"]+"%",researching:"(Unknown)",dipl:[],tech:[],wndr:[]};for(var w=0;w<Object.keys(improvements).length;w++){if(players[pplayer.playerno].wonders[w]!=0&&improvements[w].genus<=1){intel_data["wndr"].push({name:improvements[w].name,helptext:html_safe(improvements[w].helptext)})}}var research=research_get(pplayer);if(research!==undefined){var researching=techs[research["researching"]];if(researching!==undefined){intel_data["researching"]=researching["name"]+" ("+research["bulbs_researched"]+"/"+research["researching_cost"]+")"}else{intel_data["researching"]="(Nothing)"}var myresearch=client_is_observer()?null:research_get(client.conn.playing)["inventions"];for(var tech_id in techs){if(research["inventions"][tech_id]==TECH_KNOWN||myresearch!=null&&myresearch[tech_id]==TECH_KNOWN){intel_data["tech"].push({name:techs[tech_id]["name"],who:myresearch!=null&&myresearch[tech_id]==TECH_KNOWN?research["inventions"][tech_id]==TECH_KNOWN?"both":"me_only":"them"})}}}if(pplayer["diplstates"]!==undefined){pplayer["diplstates"].forEach(function(st,i){if(st["state"]!==DS_NO_CONTACT&&i!==pplayer["playerno"]){var dplst=intel_data["dipl"][st["state"]];if(dplst===undefined){dplst={state:get_diplstate_text(st["state"]),nations:[]};intel_data["dipl"][st["state"]]=dplst}dplst["nations"].push(nations[players[i]["nation"]]["adjective"])}})}$("#intel_dialog").html(Handlebars.templates["intel"](intel_data));$("#intel_dialog").dialog({bgiframe:true,modal:true,title:""+nations[pplayer["nation"]]["adjective"]+" Intel Report",width:is_small_screen()?"91%":"auto"});$("#intel_dialog").dialog("open");$("#intel_dialog").parent().children().first().css("font-size","85%");if(gov_name)$("#intel_gov").css({color:color_gov_color(gov_name,1),"text-shadow":"1px 1px "+color_gov_color(gov_name,2)});$("li.tech-them").css("display","");$("li.tech-me_only").css("display","");$("li.tech-both").css("display","");$("li.tech-them").attr("title",""+natl_adj+" have. We don't. CLICK to remove these from report.");$("li.tech-me_only").attr("title","We have. "+natl_adj+" don't. CLICK to remove these from report.");$("li.tech-both").attr("title",""+natl_adj+" have and we have. CLICK to remove these from report.");$("li.tech-them").on("click",function(event){event.stopPropagation();event.stopImmediatePropagation();$("li.tech-them").css("display","none")});$("li.tech-me_only").on("click",function(event){event.stopPropagation();event.stopImmediatePropagation();$("li.tech-me_only").css("display","none")});$("li.tech-both").on("click",function(event){event.stopPropagation();event.stopImmediatePropagation();$("li.tech-both").css("display","none")});if(is_small_screen())$("#intel_tabs li").children().css("padding","6px");dialog_register("#intel_dialog");$("#intel_tabs").tabs();$("#game_text_input").blur()}var LOG_FATAL=0;var LOG_ERROR=1;var LOG_NORMAL=2;var LOG_VERBOSE=3;var LOG_DEBUG=4;function freelog(level,message){console.log(message)}function show_map_from_image_dialog(){$("#upload_dialog").remove();$("<div id='upload_dialog'></div>").appendTo("div#game_page");var html="Select a savegame file: <input type='file' id='mapFileInput'><br><br>"+"Select tile colors:<br>"+"<table><tr><td>Grassland:</td><td><input type='text' id='mapimg_grassland' /></td></tr>"+"<tr><td>Desert:</td><td><input type='text' id='mapimg_desert' /></td></tr>"+"<tr><td>Mountains:</td><td><input type='text' id='mapimg_mountains' /></td></tr>"+"<tr><td>Hills:</td><td><input type='text' id='mapimg_hills' /></td></tr>"+"<tr><td>Ocean:</td><td><input type='text' id='mapimg_ocean' /></td></tr>"+"<tr><td>Coast:</td><td><input type='text' id='mapimg_coast' /></td></tr></table>";$("#upload_dialog").html(html);$("#upload_dialog").attr("title","Create game map from uploaded image");$("#upload_dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"55%":"40%",buttons:{Cancel:function(){$("#upload_dialog").dialog("close")},Upload:function(){$.blockUI();handle_map_image_upload();$("#upload_dialog").dialog("close")}}});$("#upload_dialog").dialog("open");$("#mapimg_grassland").spectrum({color:"#407c26"});$("#mapimg_desert").spectrum({color:"#f0dc9b"});$("#mapimg_mountains").spectrum({color:"#43481f"});$("#mapimg_hills").spectrum({color:"#3d4f1f"});$("#mapimg_ocean").spectrum({color:"#081424"});$("#mapimg_coast").spectrum({color:"#143f79"})}function handle_map_image_upload(){var fileInput=document.getElementById("mapFileInput");var file=fileInput.files[0];if(file==null){$.unblockUI();swal("Please upload a image file!");setSwalTheme();return}if(!window.FileReader){$.unblockUI();swal("Uploading files not supported");setSwalTheme();return}var extension=file.name.substring(file.name.lastIndexOf("."));console.log("Loading map image of type: "+file.type+" with extention "+extension);if(extension==".png"||extension==".bmp"||extension==".jpg"||extension==".jpeg"||extension==".JPG"){var reader=new FileReader;reader.onload=function(e){doImage(reader.result)};reader.readAsDataURL(file)}else{$.unblockUI();swal("Image file "+file.name+"  not supported: "+file.type);setSwalTheme();console.error("Image file not supported: "+file.type)}$("#upload_dialog").dialog("close");$("#dialog").dialog("close")}function doImage(image_data){var mycanvas=document.createElement("canvas");mycanvas.width=120;mycanvas.height=80;var context=mycanvas.getContext("2d");var img=new Image;img.onload=function(){context.drawImage(img,0,0,this.width,this.height,0,0,120,80);handle_image_ctx(context)};img.src=image_data}function handle_image_ctx(ctx){var savetxt=process_image(ctx);$.ajax({type:"POST",url:"/freeciv-earth-mapgen",data:savetxt+";"+120+";"+80}).done(function(savegame){send_message_delayed("/load "+savegame,1200);setTimeout(load_game_toggle,1300);swal("Game map created from the image you uploaded. Game ready to start.");setSwalTheme();$.unblockUI()}).fail(function(){swal("Something failed. Please try again later!");setSwalTheme();$.unblockUI()})}function process_image(ctx){var mapline="";var height=80;var width=120;for(var y=0;y<height;y++){mapline+="t"+zeroFill(y,4)+'="';for(var x=0;x<width;x++){var pixel=ctx.getImageData(x,y,1,1);mapline+=get_map_terrain_type(x,y,pixel.data)}mapline+='"\n'}console.log(mapline);return mapline}function zeroFill(number,width){width-=number.toString().length;if(width>0){return new Array(width+(/\./.test(number)?2:1)).join("0")+number}return number+""}function get_map_terrain_type(x,y,pixel){var rnd=Math.random();if(pixel_color(255,255,255,pixel,20))return"a";if(pixel_color($("#mapimg_grassland").spectrum("get")["_r"],$("#mapimg_grassland").spectrum("get")["_g"],$("#mapimg_grassland").spectrum("get")["_b"],pixel,40))return"g";if(pixel_color(84,73,38,pixel,20))return"t";if(pixel_color($("#mapimg_desert").spectrum("get")["_r"],$("#mapimg_desert").spectrum("get")["_g"],$("#mapimg_desert").spectrum("get")["_b"],pixel,100))return"d";if(pixel_color(44,52,28,pixel,10))return"f";if(pixel_color(37,64,27,pixel,10))return"g";if(pixel_color(60,89,38,pixel,30))return"g";if(pixel_color(204,99,40,pixel,100))return"d";if(pixel_color($("#mapimg_mountains").spectrum("get")["_r"],$("#mapimg_mountains").spectrum("get")["_g"],$("#mapimg_mountains").spectrum("get")["_b"],pixel,10))return"m";if(pixel_color($("#mapimg_hills").spectrum("get")["_r"],$("#mapimg_hills").spectrum("get")["_g"],$("#mapimg_hills").spectrum("get")["_b"],pixel,10))return"h";if(pixel_color($("#mapimg_ocean").spectrum("get")["_r"],$("#mapimg_ocean").spectrum("get")["_g"],$("#mapimg_ocean").spectrum("get")["_b"],pixel,40))return":";if(pixel_color($("#mapimg_coast").spectrum("get")["_r"],$("#mapimg_coast").spectrum("get")["_g"],$("#mapimg_coast").spectrum("get")["_b"],pixel,15))return" ";if(pixel_color(39,57,61,pixel,35))return" ";if(rnd<4)return"p";if(rnd>=4&&rnd<=6)return"h";if(rnd>=6&&rnd<7)return"t";if(rnd>=7)return"g"}function pixel_color(colorRed,colorGreen,colorBlue,pixel,threshold){var diffR,diffG,diffB;diffR=colorRed-pixel[0];diffG=colorGreen-pixel[1];diffB=colorBlue-pixel[2];return Math.sqrt(diffR*diffR+diffG*diffG+diffB*diffB)<threshold}var map={};var tiles={};var DIR8_NORTHWEST=0;var DIR8_NORTH=1;var DIR8_NORTHEAST=2;var DIR8_WEST=3;var DIR8_EAST=4;var DIR8_SOUTHWEST=5;var DIR8_SOUTH=6;var DIR8_SOUTHEAST=7;var DIR8_LAST=8;var DIR8_COUNT=DIR8_LAST;var TF_WRAPX=1;var TF_WRAPY=2;var TF_ISO=4;var TF_HEX=8;var T_NONE=0;var T_UNKNOWN=0;var T_FIRST=0;var DIR_DX=[-1,0,1,-1,1,-1,0,1];var DIR_DY=[-1,-1,-1,0,0,1,1,1];function topo_has_flag(flag){return(map["topology_id"]&flag)!=0}function map_allocate(){tiles={};for(var x=0;x<map["xsize"];x++){for(var y=0;y<map["ysize"];y++){var tile={};tile["index"]=x+y*map["xsize"];tile["x"]=x;tile["y"]=y;tile["height"]=0;tile=tile_init(tile);tiles[tile["index"]]=tile}}map["startpos_table"]={};init_overview()}function tile_init(tile){tile["known"]=null;tile["seen"]={};tile["specials"]=[];tile["terrain"]=T_UNKNOWN;tile["units"]=[];tile["owner"]=null;tile["claimer"]=null;tile["worked"]=null;tile["spec_sprite"]=null;tile["goto_dir"]=null;tile["nuke"]=0;return tile}function map_init_topology(set_sizes){tile_types_setup["l0.arctic"].match_index[0]=2;var dir;map.valid_dirs={};map.cardinal_dirs={};map.num_valid_dirs=0;map.num_cardinal_dirs=0;for(dir=0;dir<8;dir++){if(is_valid_dir(dir)){map.valid_dirs[map.num_valid_dirs]=dir;map.num_valid_dirs++}if(is_cardinal_dir(dir)){map.cardinal_dirs[map.num_cardinal_dirs]=dir;map.num_cardinal_dirs++}}}function is_valid_dir(dir){switch(dir){case DIR8_SOUTHEAST:case DIR8_NORTHWEST:return!(topo_has_flag(TF_HEX)&&!topo_has_flag(TF_ISO));case DIR8_NORTHEAST:case DIR8_SOUTHWEST:return!(topo_has_flag(TF_HEX)&&topo_has_flag(TF_ISO));case DIR8_NORTH:case DIR8_EAST:case DIR8_SOUTH:case DIR8_WEST:return true;default:return false}}function is_cardinal_dir(dir){switch(dir){case DIR8_NORTH:case DIR8_SOUTH:case DIR8_EAST:case DIR8_WEST:return true;case DIR8_SOUTHEAST:case DIR8_NORTHWEST:return topo_has_flag(TF_HEX)&&topo_has_flag(TF_ISO);case DIR8_NORTHEAST:case DIR8_SOUTHWEST:return topo_has_flag(TF_HEX)&&!topo_has_flag(TF_ISO)}return false}function map_pos_to_tile(x,y){if(x>=map["xsize"])y-=1;else if(x<0)y+=1;return tiles[x+y*map["xsize"]]}function index_to_tile(index){return tiles[index]}function NATIVE_TO_MAP_POS(nat_x,nat_y){var pmap_x=Math.floor((nat_y+(nat_y&1))/2+nat_x);var pmap_y=Math.floor(nat_y-pmap_x+map["xsize"]);return{map_x:pmap_x,map_y:pmap_y}}function MAP_TO_NATIVE_POS(map_x,map_y){var pnat_y=Math.floor(map_x+map_y-map["xsize"]);var pnat_x=Math.floor((2*map_x-pnat_y-(pnat_y&1))/2);return{nat_y:pnat_y,nat_x:pnat_x}}function NATURAL_TO_MAP_POS(nat_x,nat_y){var pmap_x=Math.floor((nat_y+nat_x)/2);var pmap_y=Math.floor(nat_y-pmap_x+map["xsize"]);return{map_x:pmap_x,map_y:pmap_y}}function MAP_TO_NATURAL_POS(map_x,map_y){var pnat_y=Math.floor(map_x+map_y-map["xsize"]);var pnat_x=Math.floor(2*map_x-pnat_y);return{nat_y:pnat_y,nat_x:pnat_x}}function map_vector_to_sq_distance(dx,dy){if(topo_has_flag(TF_HEX)){map_vector_to_sq_distance=function(dx,dy){var d=map_vector_to_distance(dx,dy);return d*d}}else{map_vector_to_sq_distance=function(dx,dy){return dx*dx+dy*dy}}return map_vector_to_sq_distance(dx,dy)}function map_vector_to_distance(dx,dy){if(topo_has_flag(TF_HEX)){if(topo_has_flag(TF_ISO)){map_vector_to_distance=function(dx,dy){if(dx<0&&dy>0||dx>0&&dy<0){return Math.abs(dx)+Math.abs(dy)}else{return Math.max(Math.abs(dx),Math.abs(dy))}}}else{map_vector_to_distance=function(dx,dy){if(dx>0&&dy>0||dx<0&&dy<0){return Math.abs(dx)+Math.abs(dy)}else{return Math.max(Math.abs(dx),Math.abs(dy))}}}}else{map_vector_to_distance=function(dx,dy){return Math.max(Math.abs(dx),Math.abs(dy))}}return map_vector_to_distance(dx,dy)}function map_distance_vector(tile0,tile1){var half_world;if(tile0==null||tile1==null)return[FC_INFINITY,FC_INFINITY];var dx=tile1.x-tile0.x;if(topo_has_flag(TF_WRAPX)){half_world=Math.floor(map.xsize/2);dx=FC_WRAP(dx+half_world,map.xsize)-half_world}var dy=tile1.y-tile0.y;if(topo_has_flag(TF_WRAPY)){half_world=Math.floor(map.ysize/2);dx=FC_WRAP(dy+half_world,map.ysize)-half_world}return[dx,dy]}function mapstep(ptile,dir){if(!is_valid_dir(dir)){return null}return map_pos_to_tile(DIR_DX[dir]+ptile["x"],DIR_DY[dir]+ptile["y"])}function get_direction_for_step(start_tile,end_tile){var dir;for(dir=DIR8_NORTHWEST;dir<DIR8_LAST;dir++){var test_tile=mapstep(start_tile,dir);if(test_tile==end_tile){return dir}}return-1}function dir_get_name(dir){switch(dir){case DIR8_NORTH:return"N";case DIR8_NORTHEAST:return"NE";case DIR8_EAST:return"E";case DIR8_SOUTHEAST:return"SE";case DIR8_SOUTH:return"S";case DIR8_SOUTHWEST:return"SW";case DIR8_WEST:return"W";case DIR8_NORTHWEST:return"NW"}return"[Undef]"}function dir_cw(dir){switch(dir){case DIR8_NORTH:return DIR8_NORTHEAST;case DIR8_NORTHEAST:return DIR8_EAST;case DIR8_EAST:return DIR8_SOUTHEAST;case DIR8_SOUTHEAST:return DIR8_SOUTH;case DIR8_SOUTH:return DIR8_SOUTHWEST;case DIR8_SOUTHWEST:return DIR8_WEST;case DIR8_WEST:return DIR8_NORTHWEST;case DIR8_NORTHWEST:return DIR8_NORTH}return-1}function dir_ccw(dir){switch(dir){case DIR8_NORTH:return DIR8_NORTHWEST;case DIR8_NORTHEAST:return DIR8_NORTH;case DIR8_EAST:return DIR8_NORTHEAST;case DIR8_SOUTHEAST:return DIR8_EAST;case DIR8_SOUTH:return DIR8_SOUTHEAST;case DIR8_SOUTHWEST:return DIR8_SOUTH;case DIR8_WEST:return DIR8_SOUTHWEST;case DIR8_NORTHWEST:return DIR8_WEST}return-1}function clear_goto_tiles(){for(var x=0;x<map["xsize"];x++){for(var y=0;y<map["ysize"];y++){tiles[x+y*map["xsize"]]["goto_dir"]=null}}}var chatbox_active=true;var unread_messages=0;var message_log=new EventAggregator(update_chatbox,125,EventAggregator.DP_ALL,1e3,0);var pregame_messages=[];var previous_scroll=0;var current_message_dialog_state=null;var max_chat_message_length=500;var restore_chatbox_vals={h_container:null,w_container:null,h_game_chatbox_panel:null,w_game_chatbox_panel:null};function init_chatbox(){chatbox_active=true;if(is_small_screen()){$("#game_chatbox_panel").dialog({id:"mobile_chat_dialog",bgiframe:true,modal:false,opacity:"1.0",width:$(window).width()-4,height:$(window).height(),resizable:true,dialogClass:"mobile_chatbox_dialog no-close",closeOnEscape:false,position:{my:"left top",at:"left top",of:window,within:$("#game_page")},close:function(event,ui){chatbox_active=false}}).dialogExtend({minimizable:true,maximizable:true,closable:false,minimize:function(evt,dlg){msg_minimize_mobile(evt,dlg)},maximize:function(evt,dlg){msg_maximize_mobile(evt,dlg)},icons:{minimize:"ui-icon-circle-minus",restore:" ui-icon-pause",maximize:"ui-icon-circle-plus"}})}else{$("#game_chatbox_panel").dialog({bgiframe:true,modal:false,width:"27%",height:200,top:43,left:2,resizable:true,dialogClass:"chatbox_dialog no-close",closeOnEscape:false,position:{my:"left bottom",at:"left bottom",of:window,within:$("#game_page")},close:function(event,ui){chatbox_active=false}}).dialogExtend({minimizable:true,maximizable:true,closable:false,minimize:function(evt,dlg){msg_minimize(evt,dlg)},restore:function(evt,dlg){msg_restore(evt,dlg)},maximize:function(evt,dlg){msg_maximize(evt,dlg)},icons:{minimize:"ui-icon-circle-minus",maximize:"ui-icon-circle-plus",restore:"ui-icon-bullet"}});$("#game_chatbox_panel").parent().resize(function(e,ui){chatbox_restore("save");chatbox_restore("load")})}$("#game_chatbox_panel").dialog("open");$(".chatbox_dialog").css("top","52px");$("#game_chatbox_panel").parent().css("z-index","100");$("#game_chatbox_panel").parent().css("overflow","hidden");$("#game_chatbox_panel").parent().each(function(){this.style.setProperty("border","solid 1px","important");this.style.setProperty("border-color","#4328","important")});if(is_small_screen()){$(".ui-icon-pause").parent().hide();current_message_dialog_state="maximized";$(".ui-icon-circle-plus").parent().hide();$("#game_text_input").show()}else{$(".chatbox_dialog").css({left:"2px",top:"43px",position:"fixed"});if(simpleStorage.get("chatDlg")!=null)chatbox_restore("load");else chatbox_restore("save");$("#game_chatbox_panel").parent().children().not("#game_chatbox_panel").children().get(0).innerHTML="<div style='font-size:80%; vertical-align:top;'><i class='fa fa-commenting-o' aria-hidden='true'></i></div>";$("#game_text_input").blur()}$("#freeciv_custom_scrollbar_div").mCustomScrollbar({theme:"3d"});if(current_message_dialog_state=="minimized")$("#game_chatbox_panel").dialogExtend("minimize")}function chatbox_restore(action){if(action=="save"){restore_chatbox_vals.h_container=$("#game_chatbox_panel").parent().height();restore_chatbox_vals.w_container=$("#game_chatbox_panel").parent().width();restore_chatbox_vals.h_game_chatbox_panel=$("#game_chatbox_panel").height();restore_chatbox_vals.w_game_chatbox_panel=$("#game_chatbox_panel").width();simpleStorage.set("chatDlg",restore_chatbox_vals)}else{$("#game_chatbox_panel").parent().height(restore_chatbox_vals.h_container);$("#game_chatbox_panel").parent().width(restore_chatbox_vals.w_container);$("#game_chatbox_panel").height(restore_chatbox_vals.h_game_chatbox_panel);$("#game_chatbox_panel").width(restore_chatbox_vals.w_game_chatbox_panel);$("#freeciv_custom_scrollbar_div").height(restore_chatbox_vals.h_game_chatbox_panel-20);$("#freeciv_custom_scrollbar_div").width(restore_chatbox_vals.w_game_chatbox_panel);$("#mCSB_1").height("99%");$("#mCSB_1").width("auto")}}function msg_minimize(evt,dlg){$(".chatbox_dialog").css({height:"25",width:110});current_message_dialog_state=$("#game_chatbox_panel").dialogExtend("state");$(".chatbox_dialog").css({left:"2px",top:"8px",position:"fixed"});unread_messages=0}function msg_restore(evt,dlg){current_message_dialog_state=$("#game_chatbox_panel").dialogExtend("state");unread_messages=0;chatbox_restore("load");$(".chatbox_dialog").css({left:"2px",top:"43px",position:"fixed"});chatbox_scroll_to_bottom(false)}function msg_maximize(evt,dlg){current_message_dialog_state=$("#game_chatbox_panel").dialogExtend("state");unread_messages=0;$(".chatbox_dialog").css({left:"2px",top:"43px",position:"fixed"});$(".chatbox_dialog").css({height:$(window).height-44,width:"99%"});$("#gamebox_chat_panel").css({height:$("#gamebox_chat_panel").parent().height()-2});$("#gamebox_chat_panel").css({width:$("#gamebox_chat_panel").parent().width()-1});$("#freeciv_custom_scrollbar_div").height($("#game_chatbox_panel").height()-60);$("#freeciv_custom_scrollbar_div").width($("#game_chatbox_panel").width()-1);chatbox_scroll_to_bottom(false)}function toggle_msgbox(){if(!is_small_screen()){if(current_message_dialog_state=="minimized")$(".chatbox_dialog .ui-icon-bullet").click();else $(".chatbox_dialog .ui-icon-circle-minus").click()}}function msg_minimize_mobile(evt,dlg){current_message_dialog_state=$("#game_chatbox_panel").dialogExtend("state");$(".ui-icon-pause").parent().hide();$(".ui-icon-circle-plus").parent().show();$(".mobile_chatbox_dialog").css({height:"24",width:"24"});unread_messages=0}function msg_restore_mobile(evt,dlg){}function msg_maximize_mobile(evt,dlg){current_message_dialog_state=$("#game_chatbox_panel").dialogExtend("state");$(".ui-icon-pause").parent().hide();$(".ui-icon-circle-plus").parent().hide();$("#game_text_input").show();chatbox_scroll_to_bottom(false);unread_messages=0}function add_client_message(message){var fake_packet={message:"<font color='#AFA8A8'>"+message+"</font>"};fake_packet.event=E_CHAT_MSG;add_chatbox_text(fake_packet)}function add_chatbox_text(packet){var text=packet["message"];var server_words=["waiting on","Lost connection","Not enough","has been removed","has connected","Anyone can now become game organizer"];if(text==null)return;if(!check_text_with_banlist(text))return;if(is_longturn()){if(is_any_word_in_string(text,server_words))return}if(text.length>=max_chat_message_length)return;if(current_message_dialog_state=="minimized")unread_messages++;else unread_messages=0;packet["message"]=text;message_log.update(packet);chatbox_scroll_to_bottom(true)}function get_chatbox_text(){var chatbox_msg_list=get_chatbox_msg_list();if(chatbox_msg_list!=null){return chatbox_msg_list.textContent}else{return null}}function get_chatbox_msg_list(){return document.getElementById(civclient_state<=C_S_PREPARING?"pregame_message_area":"game_message_area")}function get_chatbox_msg_array(){var messages=[];$(get_chatbox_msg_list().innerHTML).each(function(){if(this.nodeName=="LI"){var event_number=window[this.className.toUpperCase()];messages.push({event:event_number,message:this.innerHTML})}});return messages}function clear_chatbox(){message_log.clear();chatbox_clip_messages(0)}function update_chatbox(messages){var scrollDiv=get_chatbox_msg_list();if(scrollDiv!=null){for(var i=0;i<messages.length;i++){var item=document.createElement("li");item.className=fc_e_events[messages[i].event][E_I_NAME];if(messages[i].message.includes("&#x279E;")){item.style.textAlign="right";item.style.paddingLeft="30px"}if(messages[i].message.includes("<l tgt="))messages[i].message=parseServerLink(messages[i].message);item.innerHTML=messages[i].message;scrollDiv.appendChild(item)}}else{for(var i=0;i<messages.length;i++){message_log.update(messages[i])}}if(scrollDiv.id=="pregame_message_area"){setTimeout(function(){var elem=document.getElementById("pregame_message_area");if(elem)elem.scrollTop=elem.scrollHeight},420)}else{chatbox_scroll_to_bottom(true)}}function parseServerLink(message){if(message.includes(" />.</")){var x=message.match(/x=(.*?) y=/)[1];var y=message.match(/y=(.*?) \/>.</)[1];const fcol="<font style='text-decoration: underline;' color='#1FDFFF'>";message=message.replace(/ \/>.<\//,">"+fcol+"("+x+","+y+")</font></l></")}return message}function chatbox_scroll_to_bottom(slow_scroll){if(slow_scroll){setTimeout(()=>$("#freeciv_custom_scrollbar_div").mCustomScrollbar("scrollTo","bottom"),200);setTimeout(()=>$("#freeciv_custom_scrollbar_div").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),900)}else setTimeout(()=>$("#freeciv_custom_scrollbar_div").mCustomScrollbar("scrollTo","bottom",{scrollInertia:0}),200)}function chatbox_clip_messages(lines){if(lines===undefined||lines<0){lines=24}message_log.fireNow();var msglist=get_chatbox_msg_list();var remove=msglist.children.length-lines;while(remove-- >0){msglist.removeChild(msglist.firstChild)}update_chatbox([])}function wait_for_text(text,runnable){var chatbox_text=get_chatbox_text();if(chatbox_text!=null&&chatbox_text.indexOf(text)!=-1){runnable()}else{setTimeout(function(){wait_for_text(text,runnable)},100)}}function insert_pregame_messages(welcome_message){var bad_words=["You are logged in as","Load complete","Welcome to the Freeciv version"];for(var i=0;i<pregame_messages.length;i++){var message_node=pregame_messages[i];if(is_any_word_in_string(message_node.message,bad_words))continue;message_node.message=message_node.message.replace(/#000000/g,"#F0F0F0");message_log.update(message_node)}pregame_messages=undefined}function orientation_changed(){switch(window.orientation){case 0:break;case-90:case 90:break}}var nations={};var nation_groups=[];var diplstates={};var selected_player=-1;function update_nation_screen(){var total_players=0;var no_humans=0;var no_ais=0;const observer=client_is_observer();var wide_screen=$(window).width()<1340?false:true;var narrow_screen=$(window).width()<1e3?true:false;var small_screen=is_small_screen();var landscape_screen=$(window).width()>$(window).height()?true:false;var tiny_screen=false;var redux_screen=false;if(small_screen||narrow_screen){tiny_screen=true;redux_screen=false;wide_screen=false}else if(!wide_screen){if(narrow_screen){tiny_screen=true;redux_screen=true;wide_screen=false}else{tiny_screen=false;redux_screen=true;wide_screen=false}}var header_titles=["Flag","Colors","Player Name","Nation","Attitude","Score","AI/Human","Alive","Diplomatic state","Embassy","Shared Vision","Team","State&nbsp;"];if(redux_screen||tiny_screen)header_titles=["Flag"," ","Name","Nation","Mood","Score","Type","Alive","Relation","Embassy","Vision","Team","State&nbsp;"];var center_style=" style='text-align:center;'";var nation_list_html="<table class='tablesorter' id='nation_table' "+center_style+" width='95%' border=0 cellspacing=0 >"+"<thead><tr id='nation_header_row'><th>"+header_titles[0]+"</th><th>"+header_titles[1]+"</th><th style='text-align:left;'>"+header_titles[2]+"</th>"+"<th"+center_style+">"+header_titles[3]+"</th><th "+center_style+"class='nation_attitude'>"+header_titles[4]+"</th><th"+center_style+">"+header_titles[5]+"</th><th"+center_style+">"+header_titles[6]+"</th><th"+center_style+">"+header_titles[7]+"</th>"+"<th"+center_style+">"+header_titles[8]+"</th><th"+center_style+">"+header_titles[9]+"</th><th"+center_style+">"+header_titles[10]+"</th><th"+center_style+" class='nation_team'>"+header_titles[11]+"</th><th style='text-align:right;'>"+header_titles[12]+"</th></tr></thead><tbody class='nation_table_body alternate-row-color'>";var sortList=[];var headers=$("#nation_table thead th");headers.filter(".tablesorter-headerAsc").each(function(i,cell){sortList.push([cell.cellIndex,0])});headers.filter(".tablesorter-headerDesc").each(function(i,cell){sortList.push([cell.cellIndex,1])});for(var player_id in players){var pplayer=players[player_id];if(pplayer["nation"]==-1)continue;if(is_longturn()&&client.conn.access_level!=5&&pplayer["name"].indexOf("NewAvailablePlayer")!=-1)continue;total_players++;var flag_html="<canvas id='nation_dlg_flags_"+player_id+"' width='50' height='32' class='nation_flags'></canvas>";var plr_class="";if(!observer&&client.conn.playing!=null&&player_id==client.conn.playing["playerno"])plr_class="nation_row_self";if(!pplayer["is_alive"])plr_class="nation_row_dead";else if(!observer&&diplstates[player_id]!=null){if(diplstates[player_id]==DS_WAR)plr_class="nation_row_war";else if(diplstates[player_id]==DS_ALLIANCE)plr_class="nation_row_alliance";else if(diplstates[player_id]==DS_CEASEFIRE)plr_class="nation_row_ceasefire";else if(diplstates[player_id]==DS_ARMISTICE)plr_class="nation_row_armistice";else if(diplstates[player_id]==DS_PEACE)plr_class="nation_row_peace";else plr_class="nation_row_none"}nation_list_html+="<tr data-plrid='"+player_id+"' class='"+plr_class+"'><td>"+flag_html+"</td>";nation_list_html+="<td><div style='background-color: "+nations[pplayer["nation"]]["color"]+"; "+"color: "+nations[pplayer["nation"]]["color2"]+"; border-style: solid; border-color: "+nations[pplayer["nation"]]["color3"]+"; margin: 4px; width: 20px; height: 20px;'>&#x25cf;"+"</div></td>";var gov_modifier=get_gov_modifier(player_id,"",false);var gov_indicator=pplayer["government"]?"<img class='lowered_gov' src='/images/e/"+governments[pplayer["government"]]["name"].toLowerCase()+gov_modifier+".png'>":"<img class='lowered_gov' src='/images/e/unknowngov.png'>";nation_list_html+="<td style='text-align:left;'>"+pplayer["name"]+"</td><td style='text-align:left;' title=\""+html_safe(nations[pplayer["nation"]]["legend"])+'">'+gov_indicator+"&nbsp;"+nations[pplayer["nation"]]["adjective"]+"</td>"+"<td class='nation_attitude'>"+col_love(pplayer)+"</td>"+"<td>"+get_score_text(pplayer)+"</td>"+"<td>"+(pplayer["flags"].isSet(PLRF_AI)?get_ai_level_text(pplayer)+" AI":"Human")+"</td><td>"+(pplayer["is_alive"]?"Alive":"Dead")+"</td>";var our_cb=!observer?players[client.conn.playing["playerno"]].diplstates[player_id]["has_reason_to_cancel"]:0;var their_cb=!observer?players[player_id].diplstates[client.conn.playing["playerno"]]["has_reason_to_cancel"]:0;var contact_time=0;if(!observer&&client.conn.playing!=null&&diplstates[player_id]!=null&&player_id!=client.conn.playing["playerno"]){contact_time=pplayer.diplstates[client.conn.playing.playerno].contact_turns_left;var pact_time=!observer?pplayer.diplstates[client.conn.playing.playerno].turns_left:0;var dstate=get_diplstate_text(diplstates[player_id]);if(dstate=="None")dstate="<span style='font-size:1%; color:rgba(0,0,0,0);'>+</span>"+dstate;if(dstate!="Ceasefire"&&dstate!="Armistice")pact_time=0;pact_time=pact_time>0?":<span title='Turns till pact expires' style='color:#f0d0c0'>"+pact_time+"</span>":"";if(dstate!="War"){if(our_cb){if(their_cb){dstate="<span title='We have "+pluralize("turn",our_cb)+" Casus Belli\nThey have "+pluralize("turn",their_cb)+" Casus Belli' style='color:#ff0000'><u>"+dstate+"</u>&#8224;&#x2021;</span>"}else dstate="<span title='We have "+pluralize("turn",our_cb)+" Casus Belli' style='color:#ff8000'><u>"+dstate+"</u>&#8224;</span>"}else if(their_cb){dstate="<span title='They have "+pluralize("turn",their_cb)+" Casus Belli' style='color:#ffe000'><u>"+dstate+"</u>&#x2021;</span>"}}nation_list_html+="<td style='text-align:center'>"+dstate+pact_time+"</td>"}else{nation_list_html+="<td style='text-align:center'>-</td>"}var embassy_status=get_embassy_text(player_id);if(redux_screen||tiny_screen)embassy_status=embassy_status.replace(" embassy","");if(embassy_status==embassy_status_text[EMBASSY_NONE]){if(contact_time>0)embassy_status="<span title='Contact turns remaining' style='color:#c0c0c0'>("+contact_time+")</span>"}else embassy_status="<span style='font-size:1%; color:rgba(0,0,0,0);'>z</span>"+embassy_status;nation_list_html+="<td style='text-align:center;'>"+embassy_status+"</td>";nation_list_html+="<td>";if(!observer&&client.conn.playing!=null){if(pplayer["gives_shared_vision"].isSet(client.conn.playing["playerno"])&&client.conn.playing["gives_shared_vision"].isSet(player_id)){nation_list_html+="Both ways"}else if(pplayer["gives_shared_vision"].isSet(client.conn.playing["playerno"])){nation_list_html+="To you"}else if(client.conn.playing["gives_shared_vision"].isSet(player_id)){nation_list_html+="To them"}else{nation_list_html+="None"}}nation_list_html+="</td>";nation_list_html+="<td class='nation_team'>"+(pplayer["team"]+1)+"</td>";nation_list_html+="<td style='text-align:right;' id='player_state_"+player_id+"'>"+get_turn_phase_state(pplayer,tiny_screen,redux_screen)+"&nbsp;</td>";nation_list_html+="</tr>";if(!pplayer["flags"].isSet(PLRF_AI)&&pplayer["is_alive"]&&pplayer["nturns_idle"]<=4)no_humans++;if(pplayer["flags"].isSet(PLRF_AI)&&pplayer["is_alive"])no_ais++}nation_list_html+="</tbody></table>";$("#nations_list").html(nation_list_html);$("#nations_title").html("Nations of the World");$("#nations_label").html("Human players: "+no_humans+". AIs: "+no_ais+". Inactive/dead: "+(total_players-no_humans-no_ais)+".");select_no_nation();if(is_pbem()){$("#meet_player_button").hide();$("#cancel_treaty_button").hide();$("#take_player_button").hide();$("#toggle_ai_button").hide();$("#game_scores_button").hide()}else if(is_longturn()){$("#take_player_button").hide();$("#toggle_ai_button").hide();$("#game_scores_button").hide()}if(is_small_screen){$("#take_player_button").hide()}for(var player_id in players){var pplayer=players[player_id];var flag_canvas=$("#nation_dlg_flags_"+player_id);if(flag_canvas.length>0){var flag_canvas_ctx=flag_canvas[0].getContext("2d");var tag="f."+nations[pplayer["nation"]]["graphic_str"]+"-large";if(flag_canvas_ctx!=null&&sprites[tag]!=null){flag_canvas_ctx.drawImage(sprites[tag],0,0)}}}$("#nation_table").tablesorter({theme:"dark",sortList:sortList});if(is_small_screen()){$("#nations").height(mapview["height"]-150);$("#nations").width(mapview["width"])}$.ajax({url:"/civsocket/"+(parseInt(civserverport)+1e3)+"/status",dataType:"html",cache:false,async:true}).done(function(data){var online_players={};var players_re=/username: <b>([^<]*)</g;var found;while((found=players_re.exec(data))!=null){if(found[1].length>0){online_players[found[1].toLowerCase()]=true}}for(var player_id in players){var pplayer=players[player_id];if(online_players[pplayer["username"].toLowerCase()]){$("#player_state_"+player_id).html("<span style='color: #00EE00;'><b> &#x1f310;"+get_turn_phase_state(pplayer,tiny_screen,redux_screen)+"</b></span>")}}$("#nation_table").trigger("update")});if(is_longturn())$(".nation_attitude").hide();if(is_longturn())$(".nation_team").hide();$("#nation_table").tooltip();if(tiny_screen){$("#nation_table").css({zoom:"0.6","-moz-transform":"0.6"});$("#nation_header_row").css({"font-size":"90%"});$("#nations_title").css({zoom:"0.85","-moz-transform":"0.85"});$("#nations_button_div").css({zoom:"74%"});$("#nations_label").css({zoom:"85%"})}else if(redux_screen){$("#city_table").css({zoom:"0.91","-moz-transform":"0.91"});$("#nation_header_row").css({"font-size":"90%"})}}function get_turn_phase_state(pplayer,tiny_screen,redux_screen){var pstate=" ";if(pplayer["phase_done"]&&!pplayer["flags"].isSet(PLRF_AI)){pstate="Done"}else if(!pplayer["flags"].isSet(PLRF_AI)&&pplayer["nturns_idle"]>1){if(tiny_screen||redux_screen)pstate+="idle  "+pplayer["nturns_idle"];else pstate+="Idle for "+pplayer["nturns_idle"]+" turns"}else if(!pplayer["phase_done"]&&!pplayer["flags"].isSet(PLRF_AI)){pstate="Moving"}return pstate}function col_love(pplayer){if(client_is_observer()||client.conn.playing==null||pplayer["playerno"]==client.conn.playing["playerno"]||pplayer["flags"].isSet(PLRF_AI)==false){return"-"}else{return love_text(pplayer["love"][client.conn.playing["playerno"]])}}function handle_nation_table_select(ev){ev.stopPropagation();var new_element=$(this);var new_player=parseFloat(new_element.data("plrid"));if(new_player===selected_player){new_element.removeClass("ui-selected");select_no_nation()}else{new_element.siblings().removeClass("ui-selected");new_element.addClass("ui-selected");selected_player=new_player;select_a_nation()}}function select_a_nation(){var player_id=selected_player;var pplayer=players[selected_player];if(pplayer==null)return;var selected_myself=client.conn.playing!=null&&player_id==client.conn.playing["playerno"];var both_alive_and_different=client.conn.playing!=null&&player_id!=client.conn.playing["playerno"]&&pplayer["is_alive"]&&client.conn.playing["is_alive"];if(pplayer["is_alive"]&&(client_is_observer()||selected_myself||diplstates[player_id]!=null&&diplstates[player_id]!=DS_NO_CONTACT||client_state()==C_S_OVER)){$("#view_player_button").button("enable")}else{$("#view_player_button").button("disable")}if(!client_is_observer()&&both_alive_and_different&&diplstates[player_id]!=null&&diplstates[player_id]!=DS_NO_CONTACT){$("#meet_player_button").button("enable")}else{$("#meet_player_button").button("disable")}if(!is_hotseat()&&!pplayer["flags"].isSet(PLRF_AI)&&(diplstates[player_id]!=null&&diplstates[player_id]==DS_NO_CONTACT)){$("#meet_player_button").button("disable")}if(pplayer["flags"].isSet(PLRF_AI)||selected_myself){$("#send_message_button").button("disable")}else{$("#send_message_button").button("enable")}if(!client_is_observer()&&both_alive_and_different&&pplayer["team"]!=client.conn.playing["team"]&&diplstates[player_id]!=null&&diplstates[player_id]!=DS_WAR&&diplstates[player_id]!=DS_NO_CONTACT){$("#cancel_treaty_button").button("enable")}else{$("#cancel_treaty_button").button("disable")}if(can_client_control()&&!selected_myself){if(diplstates[player_id]==DS_CEASEFIRE||diplstates[player_id]==DS_ARMISTICE||diplstates[player_id]==DS_PEACE){$("#cancel_treaty_button").button("option","label","Declare war")}else{$("#cancel_treaty_button").button("option","label","Cancel treaty")}}if(can_client_control()&&both_alive_and_different&&pplayer["team"]!=client.conn.playing["team"]&&client.conn.playing["gives_shared_vision"].isSet(player_id)){$("#withdraw_vision_button").button("enable")}else{$("#withdraw_vision_button").button("disable")}if(client_is_observer()||player_id==client.conn.playing["playerno"]||both_alive_and_different&&diplstates[player_id]!=DS_NO_CONTACT){$("#intelligence_report_button").button("enable")}else{$("#intelligence_report_button").button("disable")}if(!is_hotseat()&&client_is_observer()&&pplayer["flags"].isSet(PLRF_AI)&&nations[pplayer["nation"]]["is_playable"]&&$.getUrlVar("multi")=="true"){$("#take_player_button").button("enable")}else{$("#take_player_button").button("disable")}$("#toggle_ai_button").button("enable")}function select_no_nation(){selected_player=-1;$("#nations_button_div button").not("#game_scores_button").button("disable")}function nation_table_select_player(player_no){$("#players_tab a").click();var row=$("#nation_table tr[data-plrid="+player_no+"]");if(row.length==1){row.click();row[0].scrollIntoView()}}function nation_meet_clicked(){if(selected_player==-1)return;diplomacy_init_meeting_req(selected_player);set_default_mapview_active()}function cancel_treaty_clicked(){if(selected_player==-1)return;diplomacy_cancel_treaty(selected_player);set_default_mapview_active()}function withdraw_vision_clicked(){if(selected_player==-1)return;var packet={pid:packet_diplomacy_cancel_pact,other_player_id:selected_player,clause:CLAUSE_VISION};send_request(JSON.stringify(packet));set_default_mapview_active()}function take_player_clicked(){if(selected_player==-1)return;var pplayer=players[selected_player];take_player(pplayer["name"]);set_default_mapview_active()}function toggle_ai_clicked(){if(selected_player==-1)return;var pplayer=players[selected_player];aitoggle_player(pplayer["name"]);set_default_mapview_active()}function get_score_text(player){var embassy_status=get_embassy_text(player.playerno);if(player["score"]>0&&embassy_status!=embassy_status_text[EMBASSY_NONE]&&embassy_status!=embassy_status_text[EMBASSY_THEYHAVE]||client_is_observer()||client.conn.playing!=null&&player["playerno"]==client.conn.playing["playerno"]){return player["score"]}else{return" "}}function love_text(love){if(love<=-MAX_AI_LOVE*90/100){return"Genocidal"}else if(love<=-MAX_AI_LOVE*70/100){return"Belligerent"}else if(love<=-MAX_AI_LOVE*50/100){return"Hostile"}else if(love<=-MAX_AI_LOVE*25/100){return"Uncooperative"}else if(love<=-MAX_AI_LOVE*10/100){return"Uneasy"}else if(love<=MAX_AI_LOVE*10/100){return"Neutral"}else if(love<=MAX_AI_LOVE*25/100){return"Respectful"}else if(love<=MAX_AI_LOVE*50/100){return"Helpful"}else if(love<=MAX_AI_LOVE*70/100){return"Enthusiastic"}else if(love<=MAX_AI_LOVE*90/100){return"Admiring"}else{return"Worshipful"}}function take_player(player_name){send_message("/take "+player_name);observing=false}function aitoggle_player(player_name){send_message("/aitoggle "+player_name);observing=false}function center_on_player(){if($("#tabs").tabs("option","active")!=TAB_MAP)$("#tabs").tabs("option","active",TAB_MAP);if(selected_player==-1)return;for(var city_id in cities){var pcity=cities[city_id];if(city_owner_player_id(pcity)==selected_player){center_tile_mapcanvas(city_tile(pcity));set_default_mapview_active();return}}}function send_private_message(other_player_name){var message=other_player_name+": "+encode_message_text($("#private_message_text").val());var packet={pid:packet_chat_msg_req,message:message};send_request(JSON.stringify(packet));keyboard_input=true;$("#dialog").dialog("close")}function show_send_private_message_dialog(){if(selected_player==-1)return;var pplayer=players[selected_player];if(pplayer==null){swal("Please select a player to send a private message to first.");setSwalTheme();return}var name=pplayer["name"];keyboard_input=false;$("#dialog").remove();$("<div id='dialog'></div>").appendTo("div#game_page");var intro_html="Message: <textarea id='private_message_text' type='text' rows='6' cols='60' maxlength='350'>";$("#dialog").html(intro_html);$("#dialog").attr("title","Send private message to "+name);$("#dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"80%":"50%",buttons:{Send:function(){send_private_message(name)}}});$("#dialog").dialog("open");$("#dialog").keyup(function(e){if(e.keyCode==13){send_private_message(name)}})}var server_settings={};var Game_UID;var myGameVars;var client_rules_flag=[];const CRF_CARGO_HEURISTIC=0;const CRF_OASIS_IRRIGATE=1;const CRF_ASMITH_SPECIALISTS=2;const CRF_MP2_UNIT_CONVERSIONS=3;const CRF_LEGION_WORK=4;const CRF_MASONRY_FORT=5;const CRF_CANALS=6;const CRF_NO_UNIT_GOLD_UPKEEP=7;const CRF_MP2_SPECIAL_UNITS=8;const CRF_COMMIE_BLDG_UPKEEP=9;const CRF_PACTS_SANS_EMBASSY=10;const CRF_TESLA_UPGRADE_DISCOUNT=11;const CRF_RADAR_TOWER=12;const CRF_EXTRA_HIDEOUT=13;const CRF_EXTRA_QUAY=14;const CRF_NO_WASTE=15;const CRF_MINOR_NUKES=16;const CRF_MAJOR_NUKES=17;const CRF_SURGICAL_PILLAGE=18;const CRF_MAGLEV=19;const CRF_SIEGE_RAM=20;const CRF_MARINE_BASES=21;const CRF_MARINE_RANGED=22;const CRF_BSHIP_BOMBARD=23;const CRF_TRIREME_FUEL=24;const CRF_RECYCLING_DISCOUNT=25;const CRF_SEABRIDGE=26;const CRF_COLOSSUS_DISCOUNT=27;const CRF_SPECIAL_UNIT_ATTACKS=28;const CRF_NO_BASES_ON_RIVERS=29;const CRF_MP2=30;const CRF_MP2_A=31;const CRF_MP2_B=32;const CRF_MP2_C=33;const CRF_LAST=34;var graphic_theme_path;var default_user_name="";var default_server_host="localhost";var default_theme_name="human";var default_tileset_name="";var default_sound_set_name="stdsounds";var default_sound_plugin_name="";var sounds_enabled=true;var unit_click_menu=true;var map_drag_enabled=true;var enable_goto_drag=true;var enable_autoexplore=true;var show_order_option=true;var show_empire_tab=false;var show_warcalc=false;var show_unit_movepct=false;var show_compass=true;var hp_bar_offset=0;var focuslock=false;var save_options_on_exit=true;var fullscreen_mode=false;var replace_capital_i=null;var scroll_narrow_x=false;var solid_color_behind_units=false;var sound_bell_at_new_turn=false;var smooth_move_unit_msec=30;var smooth_center_slide_msec=200;var do_combat_animation=true;var ai_manual_turn_done=true;var auto_center_on_unit=true;var auto_center_on_combat=false;var auto_center_each_turn=true;var wakeup_focus=true;var goto_into_unknown=true;var center_when_popup_city=true;var concise_city_production=false;var auto_turn_done=false;var meta_accelerators=true;var ask_city_name=true;var popup_new_cities=true;var popup_actor_arrival=true;var keyboardless_goto=true;var enable_cursor_changes=true;var separate_unit_selection=false;var unit_selection_clears_orders=true;var highlight_our_names="yellow";var update_city_text_in_refresh_tile=true;var draw_dashed_borders=false;var draw_tertiary_colors=false;var draw_border_mode=0;var draw_thick_borders=false;var draw_moving_borders=false;var draw_border_flags=false;var minimap_color=1;var draw_city_outlines=true;var draw_city_output=false;var draw_city_airlift_counter=false;var draw_highlighted_pollution=false;var draw_city_mood=false;var draw_map_grid=false;var draw_stacked_unit_mode=3;const dsum_BASIC=0;const dsum_RING=1;const dsum_SMALL=2;var draw_city_names=true;var draw_city_growth=true;var draw_city_productions=false;var draw_city_buycost=false;var draw_city_traderoutes=false;var draw_terrain=true;var draw_coastline=false;var draw_roads_rails=true;var draw_irrigation=true;var draw_mines=true;var draw_fortress_airbase=true;var draw_huts=true;var draw_resources=true;var draw_pollution=true;var draw_cities=true;var draw_units=true;var draw_focus_unit=false;var draw_fog_of_war=true;var draw_borders=true;var draw_full_citybar=true;var draw_unit_shields=true;var player_dlg_show_dead_players=true;var reqtree_show_icons=true;var reqtree_curved_lines=false;var gui_gtk2_map_scrollbars=false;var gui_gtk2_dialogs_on_top=true;var gui_gtk2_show_task_icons=true;var gui_gtk2_enable_tabs=true;var gui_gtk2_better_fog=true;var gui_gtk2_show_chat_message_time=false;var gui_gtk2_split_bottom_notebook=false;var gui_gtk2_new_messages_go_to_top=false;var gui_gtk2_show_message_window_buttons=true;var gui_gtk2_metaserver_tab_first=false;var gui_gtk2_allied_chat_only=false;var gui_gtk2_small_display_layout=false;function init_options_dialog(){$("#save_button").button("option","label","Save Game (Ctrl+S)");$("#metamessage_setting").val(server_settings["metamessage"]["val"]);$("#metamessage_setting").change(function(){send_message("/metamessage "+$("#metamessage_setting").val())});$("#metamessage_setting").bind("keyup blur",function(){var clean_text=$(this).val().replace(/[^a-zA-Z\s\-]/g,"");if($(this).val()!=clean_text){$(this).val(clean_text)}});if(!is_pbem()){var existing_timeout=game_info["timeout"];if(existing_timeout==0)$("#timeout_info").html("<i> (none)</i>");else $("#timeout_info").html(" seconds");$("#timeout_setting").val(existing_timeout)}else{$("#timeout_setting_div").hide()}$("#timeout_setting").change(function(){var new_timeout=parseInt($("#timeout_setting").val());if(new_timeout>=1&&new_timeout<=29){swal("Invalid timeout specified. Must be 0 or more than 30 seconds.");setSwalTheme()}else{send_message("/set timeout "+new_timeout)}});if(audio!=null&&!audio.source.src){if(!supports_mp3()){audio.load("/music/"+music_list[Math.floor(Math.random()*music_list.length)]+".ogg")}else{audio.load("/music/"+music_list[Math.floor(Math.random()*music_list.length)]+".mp3")}}$(".setting_button").tooltip();$("#play_sounds_setting").prop("checked",sounds_enabled);$("#play_sounds_setting").change(function(){sounds_enabled=this.checked;simpleStorage.set("sndFX",sounds_enabled)});if(is_speech_supported()){$("#speech_enabled_setting").prop("checked",speech_enabled);$("#speech_enabled_setting").change(function(){speech_enabled=this.checked})}else{$("#speech_enabled_setting").attr("disabled",true)}$("#draw_map_grid").prop("checked",draw_map_grid);$("#draw_map_grid").change(function(){draw_map_grid=this.checked;simpleStorage.set("mapgrid",draw_map_grid)});$("#map_drag_enabled").prop("checked",map_drag_enabled);$("#map_drag_enabled").change(function(){map_drag_enabled=this.checked;simpleStorage.set("mapdrag",map_drag_enabled)});$("#enable_goto_drag").prop("checked",enable_goto_drag);$("#enable_goto_drag").change(function(){enable_goto_drag=this.checked;simpleStorage.set("gotodrag",enable_goto_drag)});$("#enable_autoexplore").prop("checked",enable_autoexplore);$("#enable_autoexplore").change(function(){enable_autoexplore=this.checked;simpleStorage.set("explorekey",enable_autoexplore)});$("#unit_click_menu").prop("checked",unit_click_menu);$("#unit_click_menu").change(function(){unit_click_menu=this.checked;simpleStorage.set("unitclickmenu",unit_click_menu)});$("#show_order_buttons").prop("checked",show_order_option);if(show_order_option==true){show_order_buttons=1;$("#game_unit_orders_default").show();update_unit_order_commands()}else{show_order_buttons=0;$("#game_unit_orders_default").hide()}$("#show_order_buttons").change(function(){show_order_option=this.checked;if(show_order_option==true){show_order_buttons=2;$("#game_unit_orders_default").show();update_unit_order_commands()}else{show_order_buttons=0;$("#game_unit_orders_default").hide()}simpleStorage.set("showorderbuttons",show_order_option)});$("#auto_attack").prop("checked",auto_attack);$("#auto_attack").change(function(){auto_attack=this.checked});$("#draw_highlighted_pollution").prop("checked",draw_highlighted_pollution);$("#draw_highlighted_pollution").change(function(){draw_highlighted_pollution=this.checked;simpleStorage.set("showpollution",draw_highlighted_pollution)});$("#airlift_setting").prop("checked",draw_city_airlift_counter);$("#airlift_setting").change(function(){draw_city_airlift_counter=this.checked;simpleStorage.set("airlift",draw_city_airlift_counter)});$("#focuslock_setting").prop("checked",focuslock);$("#focuslock_setting").change(function(){focuslock=this.checked;simpleStorage.set("focuslock",focuslock)});$("#draw_city_mood").prop("checked",draw_city_mood);$("#draw_city_mood").change(function(){draw_city_mood=this.checked;simpleStorage.set("drawMood",draw_city_mood)});$("#draw_city_output").prop("checked",draw_city_output);$("#draw_city_output").change(function(){draw_city_output=this.checked;simpleStorage.set("drawTiles",draw_city_output)});$("#scroll_narrow_x").prop("checked",scroll_narrow_x);$("#scroll_narrow_x").change(function(){scroll_narrow_x=this.checked;simpleStorage.set("xScroll",scroll_narrow_x)});$("#fill_borders").prop("checked",draw_border_flags);$("#fill_borders").change(function(){draw_border_flags=this.checked;simpleStorage.set("borderFlags",draw_border_flags)});$("#tricolor_borders").prop("checked",draw_tertiary_colors);$("#tricolor_borders").change(function(){draw_tertiary_colors=this.checked;draw_border_mode|=1;simpleStorage.set("tricolore",draw_tertiary_colors)});$("#thick_borders").prop("checked",draw_thick_borders);$("#thick_borders").change(function(){draw_thick_borders=this.checked;simpleStorage.set("thickBorders",draw_thick_borders)});$("#dashed_borders").prop("checked",draw_dashed_borders);$("#dashed_borders").change(function(){draw_dashed_borders=this.checked;simpleStorage.set("dashedBorders",draw_dashed_borders)});$("#no_borders").prop("checked",draw_border_mode&2);$("#no_borders").change(function(){if(this.checked)draw_border_mode|=2;else draw_border_mode&=1});$("#moving_borders").prop("checked",draw_moving_borders);$("#moving_borders").change(function(){draw_moving_borders=this.checked;simpleStorage.set("movingBorders",draw_moving_borders)});$("#show_empire").prop("checked",show_empire_tab);$("#show_empire").change(function(){show_empire_tab=this.checked;if(show_empire_tab)$("#ui-id-2").show();else $("#ui-id-2").hide();simpleStorage.set("showEmpire",show_empire_tab)});$("#show_unit_mp").prop("checked",show_unit_movepct);$("#show_unit_mp").change(function(){show_unit_movepct=this.checked;if(show_unit_movepct)hp_bar_offset=-5;else hp_bar_offset=0;simpleStorage.set("showMoves",show_unit_movepct)});$("#show_warcalc").prop("checked",show_warcalc);$("#show_warcalc").change(function(){show_warcalc=this.checked;if(show_warcalc){$("#warcalc_tab").show();$("#ui-id-8").click();show_warcalc=false;setTimeout(function(){$("#show_warcalc").prop("checked",false)},100)}});$("#show_compass").prop("checked",show_compass);$("#show_compass").change(function(){show_compass=this.checked;simpleStorage.set("showCompass",show_compass);if(show_compass)$("#compass").show();else $("#compass").hide()});graphic_theme_path=simpleStorage.get("grtheme");if(!graphic_theme_path)graphic_theme_path="themes/greek/";$("#graphic_theme").val(graphic_theme_path).prop("selected",true);$("#graphic_theme").change(function(){graphic_theme_path=$("#graphic_theme").val();simpleStorage.set("grtheme",graphic_theme_path);change_graphic_theme()});$("#graphic_theme").change();$("#title_setting_div").hide();if(is_longturn()){$("#update_model_button").hide();$("#switch_renderer_button").hide();$("#renderer_help").hide();$("#save_button").hide();$("#surrender_button").hide()}if(is_supercow())$("#save_button").show();$("#timeout_setting_div").show()}function change_graphic_theme(){return}var OVERVIEW_TILE_SIZE=1;var overviewTimerId=-1;var min_overview_width=200;var max_overview_width=300;var max_overview_height=300;var overview_map_height=140;var OVERVIEW_REFRESH;var palette=[];var palette_color_offset=0;var palette_terrain_offset=0;var overview_active=false;var COLOR_OVERVIEW_UNKNOWN=0;var COLOR_OVERVIEW_MY_CITY=1;var COLOR_OVERVIEW_ALLIED_CITY=2;var COLOR_OVERVIEW_ENEMY_CITY=3;var COLOR_OVERVIEW_MY_UNIT=4;var COLOR_OVERVIEW_ALLIED_UNIT=5;var COLOR_OVERVIEW_ENEMY_UNIT=6;var COLOR_OVERVIEW_VIEWRECT=7;var COLOR_OVERVIEW_GENERIC=8;var overview_hash=-1;var overview_current_state=null;function init_overview(){while(min_overview_width>OVERVIEW_TILE_SIZE*map["xsize"]){OVERVIEW_TILE_SIZE++}overview_active=true;$("#game_overview_panel").attr("title","");$("#game_overview_panel").dialog({bgiframe:true,modal:false,appendTo:"#tabs-map",resizable:false,closeOnEscape:false,dialogClass:"overview_dialog no-close",autoResize:true,width:"auto",close:function(event,ui){overview_active=false}}).dialogExtend({minimizable:true,maximizable:true,closable:false,minimize:function(evt,dlg){overview_current_state=$("#game_overview_panel").dialogExtend("state");$(".overview_dialog").css({height:"8",width:65});unobstruct_minimized_dialog_continer()},maximize:function(evt,dlg){overview_current_state=$("#game_overview_panel").dialogExtend("state");$(".overview_dialog").css({height:"auto",width:$(window).width()-4});$("#overview_map").width($("#game_overview_panel").width()-20);$("#overview_map").height($("#game_overview_panel").height()-20)},restore:function(evt,dlg){overview_current_state=$("#game_overview_panel").dialogExtend("state");var new_width=OVERVIEW_TILE_SIZE*map["xsize"];if(new_width>max_overview_width)new_width=max_overview_width;var new_height=OVERVIEW_TILE_SIZE*map["ysize"];if(new_height>max_overview_height)new_height=max_overview_height;$(".overview_dialog").css({height:new_height,width:new_width});$("#overview_map").width(new_width);$("#overview_map").height(new_height);$(".overview_dialog").position({my:"left bottom",at:"left bottom",of:window,within:$("#tabs-map")})},icons:{minimize:"ui-icon-circle-minus",maximize:"ui-icon-circle-plus",restore:"ui-icon-bullet"}});if(overview_current_state=="minimized")$("#game_overview_panel").dialogExtend("minimize");$("#game_overview_panel").parent().css("overflow","hidden");palette=generate_palette();redraw_overview();var new_width=OVERVIEW_TILE_SIZE*map["xsize"];if(new_width>max_overview_width)new_width=max_overview_width;var new_height=OVERVIEW_TILE_SIZE*map["ysize"];if(new_height>max_overview_height)new_height=max_overview_height;$("#overview_map").width(new_width);$("#overview_map").height(new_height);$(".overview_dialog").position({my:"left bottom",at:"left bottom",of:window,within:$("#tabs-map")});$("#overview_map").on("dragstart",function(event){event.preventDefault()});$("#game_overview_panel").parent().children().not("#game_overview_panel").children().get(0).innerHTML="<div style='font-size:97%; vertical-align:top; font-family:Arial; margin-bottom: 1px;'><i class='fa fa-globe' aria-hidden='true'></i></div>";$("#game_overview_panel").siblings().children().next().css("margin-top","-7px");$(".overview_dialog").children().css("border-radius","0px")}function redraw_overview(){if(mapview_slide["active"]||C_S_RUNNING>client_state()||map["xsize"]==null||map["ysize"]==null||$("#overview_map").length==0)return;var hash=generate_overview_hash(map["xsize"],map["ysize"]);if(hash!=overview_hash){bmp_lib.render("overview_img",generate_overview_grid(map["xsize"],map["ysize"]),palette);overview_hash=hash;render_viewrect()}}function force_redraw_overview(){var hash=generate_overview_hash(map["xsize"],map["ysize"]);bmp_lib.render("overview_img",generate_overview_grid(map["xsize"],map["ysize"]),palette);overview_hash=hash;render_viewrect()}function generate_overview_grid(cols,rows){var row;if(cols&1)cols-=1;if(rows&1)rows-=1;var grid=Array(rows*OVERVIEW_TILE_SIZE);for(row=0;row<rows*OVERVIEW_TILE_SIZE;row++){grid[row]=Array(cols*OVERVIEW_TILE_SIZE)}for(var x=0;x<rows;x++){for(var y=0;y<cols;y++){var ocolor=overview_tile_color(y,x);render_multipixel(grid,x,y,ocolor)}}return grid}function generate_overview_hash(cols,rows){var hash=0;for(var x=0;x<rows;x++){for(var y=0;y<cols;y++){hash+=overview_tile_color(y,x)}}var r=base_canvas_to_map_pos(0,0);if(r!=null){hash+=r["map_x"];hash+=r["map_y"]}return hash}function render_viewrect(){if(C_S_RUNNING!=client_state()&&C_S_OVER!=client_state())return;var path=[];var point=base_canvas_to_map_pos(0,0);path.push([point.map_x,point.map_y]);point=base_canvas_to_map_pos(mapview["width"],0);path.push([point.map_x,point.map_y]);point=base_canvas_to_map_pos(mapview["width"],mapview["height"]);path.push([point.map_x,point.map_y]);point=base_canvas_to_map_pos(0,mapview["height"]);path.push([point.map_x,point.map_y]);var viewrect_canvas=document.getElementById("overview_viewrect");if(viewrect_canvas==null)return;var map_w=$("#overview_map").width();var map_h=$("#overview_map").height();viewrect_canvas.width=map_w;viewrect_canvas.height=map_h;var viewrect_ctx=viewrect_canvas.getContext("2d");viewrect_ctx.clearRect(0,0,map_w,map_h);viewrect_ctx.strokeStyle="rgb(200,200,255)";viewrect_ctx.lineWidth=map.xsize/map_w;viewrect_ctx.scale(map_w/map.xsize,map_h/map.ysize);viewrect_ctx.beginPath();add_closed_path(viewrect_ctx,path);if(topo_has_flag(TF_WRAPX)){viewrect_ctx.save();viewrect_ctx.translate(map.xsize,0);add_closed_path(viewrect_ctx,path);viewrect_ctx.translate(-2*map.xsize,0);add_closed_path(viewrect_ctx,path);viewrect_ctx.restore()}viewrect_ctx.stroke()}function add_closed_path(ctx,path){ctx.moveTo(path[0][0],path[0][1]);for(var i=1;i<path.length;i++){ctx.lineTo(path[i][0],path[i][1])}ctx.lineTo(path[0][0],path[0][1])}function render_multipixel(grid,x,y,ocolor){if(x>=0&&y>=0&&x<map["ysize"]&&y<map["xsize"]){for(var px=0;px<OVERVIEW_TILE_SIZE;px++){for(var py=0;py<OVERVIEW_TILE_SIZE;py++){grid[OVERVIEW_TILE_SIZE*x+px][OVERVIEW_TILE_SIZE*y+py]=ocolor}}}}function generate_palette(){var palette=[];palette[COLOR_OVERVIEW_UNKNOWN]=[0,0,0];palette[COLOR_OVERVIEW_MY_CITY]=[255,255,255];palette[COLOR_OVERVIEW_ALLIED_CITY]=[0,255,255];palette[COLOR_OVERVIEW_ENEMY_CITY]=[0,255,255];palette[COLOR_OVERVIEW_MY_UNIT]=[255,255,0];palette[COLOR_OVERVIEW_ALLIED_UNIT]=[255,0,0];palette[COLOR_OVERVIEW_ENEMY_UNIT]=[255,0,0];palette[COLOR_OVERVIEW_VIEWRECT]=[200,200,255];palette[COLOR_OVERVIEW_GENERIC]=[71,89,57];palette_terrain_offset=palette.length;for(var terrain_id in terrains){var terrain=terrains[terrain_id];palette.push([terrain["color_red"],terrain["color_green"],terrain["color_blue"]])}palette_color_offset=palette.length;var player_count=Object.keys(players).length;for(var player_id in players){var pplayer=players[player_id];if(pplayer["nation"]==-1){palette[palette_color_offset+player_id%player_count]=[0,0,0]}else{var pcolor=null;const observer=client_is_observer();switch(minimap_color){case 0:if(observer||client.conn.playing==null)pcolor=[138,138,142];else if(!pplayer["is_alive"])pcolor=[48,32,32];else if(player_id==client.conn.playing["playerno"])pcolor=[55,128,255];else if(!observer&&diplstates[player_id]!=null){if(diplstates[player_id]==DS_WAR)pcolor=[192,32,32];else if(diplstates[player_id]==DS_ALLIANCE)pcolor=[0,32,240];else if(diplstates[player_id]==DS_PEACE)pcolor=[0,202,32];else if(diplstates[player_id]==DS_ARMISTICE)pcolor=[105,197,32];else if(diplstates[player_id]==DS_CEASEFIRE){pcolor=[160,192,32];if(pplayer.diplstates[client.conn.playing.playerno].turns_left&&pplayer.diplstates[client.conn.playing.playerno].turns_left<=3)pcolor=[222,192,32]}else pcolor=[138,138,142]}break;case 2:pcolor=nations[pplayer["nation"]]["color2"];break;case 3:pcolor=nations[pplayer["nation"]]["color3"];break;default:pcolor=nations[pplayer["nation"]]["color"]}if(pcolor!=null){palette[palette_color_offset+player_id%player_count]=color_rgb_to_list(pcolor)}else{palette[palette_color_offset+player_id%player_count]=[0,0,0]}}}return palette}function overview_tile_color(map_x,map_y){var ptile=map_pos_to_tile(map_x,map_y);var pcity=tile_city(ptile);if(pcity!=null){if(client.conn.playing==null){return COLOR_OVERVIEW_ENEMY_CITY}else if(city_owner_player_id(pcity)==client.conn.playing["id"]){return COLOR_OVERVIEW_MY_CITY}else{return COLOR_OVERVIEW_ENEMY_CITY}}var punit=find_visible_unit(ptile);if(punit!=null){if(client.conn.playing==null){return COLOR_OVERVIEW_ENEMY_UNIT}else if(punit["owner"]==client.conn.playing["id"]){return COLOR_OVERVIEW_MY_UNIT}else if(punit["owner"]!=null&&punit["owner"]!=255){return palette_color_offset+punit["owner"]}else{return COLOR_OVERVIEW_ENEMY_UNIT}}if(tile_get_known(ptile)!=TILE_UNKNOWN){if(ptile["owner"]!=null&&ptile["owner"]!=255){return palette_color_offset+ptile["owner"]}else{if(minimap_color==0&&!is_ocean_tile(ptile))return COLOR_OVERVIEW_GENERIC;return palette_terrain_offset+tile_terrain(ptile)["id"]}}return COLOR_OVERVIEW_UNKNOWN}function overview_clicked(x,y){var width=$("#overview_map").width();var height=$("#overview_map").height();var x1=Math.floor(x*map["xsize"]/width);var y1=Math.floor(y*map["ysize"]/height);var ptile=map_pos_to_tile(x1,y1);if(ptile!=null){center_tile_mapcanvas(ptile)}redraw_overview()}var income_needs_refresh=false;var last_ground_attack_time=0;var DEBUG_LOG_PACKETS=false;function handle_processing_started(packet){client_frozen=true}function handle_processing_finished(packet){client_frozen=false}function handle_freeze_hint(packet){client_frozen=true}function handle_thaw_hint(packet){client_frozen=false}function handle_ruleset_terrain(packet){if(packet["name"]=="Lake")packet["graphic_str"]=packet["graphic_alt"];terrains[packet["id"]]=packet}function handle_server_join_reply(packet){if(packet["you_can_join"]){var client_info;client.conn.established=true;client.conn.id=packet["conn_id"];if(get_client_page()==PAGE_MAIN||get_client_page()==PAGE_NETWORK){set_client_page(PAGE_START)}client_info={pid:packet_client_info,gui:GUI_WEB,emerg_version:0,distribution:""};send_request(JSON.stringify(client_info));set_client_state(C_S_PREPARING);if(($.getUrlVar("action")=="new"||$.getUrlVar("action")=="hack")&&$.getUrlVar("ruleset")!=null){change_ruleset($.getUrlVar("ruleset"))}if(autostart){if(loadTimerId==-1){wait_for_text("You are logged in as",pregame_start_game)}else{wait_for_text("Load complete",pregame_start_game)}}else if(observing){wait_for_text("You are logged in as",request_observe_game)}}else{swal("You were rejected from the game.",packet["message"]||"","error");setSwalTheme();client.conn.id=-1;set_client_page(PAGE_MAIN)}}function handle_conn_info(packet){var pconn=find_conn_by_id(packet["id"]);if(packet["used"]==false){if(pconn==null){freelog(LOG_VERBOSE,"Server removed unknown connection "+packet["id"]);return}client_remove_cli_conn(pconn);pconn=null}else{var pplayer=valid_player_by_number(packet["player_num"]);packet["playing"]=pplayer;if(packet["id"]==client.conn.id){if(client.conn.player_num==null||client.conn.player_num!==packet["player_num"]){discard_diplomacy_dialogs()}client.conn=packet}conn_list_append(packet)}if(packet["id"]==client.conn.id){if(client.conn.playing!=packet["playing"]){set_client_state(C_S_PREPARING)}}}function handle_ruleset_resource(packet){resources[packet["id"]]=packet}function handle_tile_info(packet){if(tiles!=null){packet["extras"]=new BitVector(packet["extras"]);tiles[packet["tile"]]=$.extend(tiles[packet["tile"]],packet)}}function handle_iPillage_event(message,tile_id){var ptile=tiles[tile_id];var ptype;var delay=0;message=message.substring(8);for(ptype_id in unit_types){ptype=unit_types[ptype_id];if(message.startsWith(ptype["name"])){var sskey=ptype["sound_fight_alt"];if(!sskey)sskey=ptype["sound_fight"];if(!soundset[sskey])sskey=ptype["sound_fight"];play_hostile_event_sound(sskey,ptile,ptype);break}}delay=500;if(ptype&&unit_pillage_sound_delay_times[ptype.rule_name])delay+=unit_pillage_sound_delay_times[ptype.rule_name];delayed_explosion(tile_id,delay)}function delayed_explosion(tile_id,delay_ms){setTimeout(()=>{delayed_explosion_helper(tile_id)},delay_ms)}function delayed_explosion_helper(tile_id){explosion_anim_map[tile_id]=25;anim_swords_instead[tile_id]=false}function handle_city_governor_event(message){global_governor_message=message;global_governor_message="<b>"+global_governor_message+"</b>";$("#cma_unsaved_warning").html(global_governor_message);$("#cma_unsaved_warning").show();setTimeout(function(){global_governor_message=""},1e4)}function handle_chat_msg(packet){var message=packet["message"];var event=packet["event"];var conn_id=packet["conn_id"];var tile_id=packet["tile"];const DEFAULT_OFF_WHITE_COLOR="#D0C8C0";if(message==null)return;if(event==null||event<0||event>=E_UNDEFINED){console.log("Undefined message event type");console.log(packet);packet["event"]=E_UNDEFINED}switch(event){case E_UNIT_ACTION_TARGET_HOSTILE:handle_iPillage_event(message,tile_id);break;case E_CITY_CMA_RELEASE:handle_city_governor_event(message);break;case E_IMP_SOLD:if(!suppress_event_sound())play_sound(soundset["e_imp_sold"]);break;case E_CHAT_MSG_PRIVATE_RCVD:if(!suppress_event_sound())play_sound("iphone1.ogg");break}if(connections[conn_id]==null){if(packet["event"]==E_SCRIPT){var regxp=/\n/gi;message=message.replace(regxp,"<br>\n");show_dialog_message("Message for you:",message);return}else{if(message.indexOf("/metamessage")!=-1)return;if(message.indexOf("Metaserver message string")!=-1)return;if(tile_id!=null&&tile_id>0){message="<span class='chatbox_text_tileinfo' "+"onclick='center_tile_id_click("+tile_id+");'>"+message.replace(DEFAULT_OFF_WHITE_COLOR,"B0F0FF")+"</span>"}if(is_speech_supported())speak(message)}}if(message.includes("%%")||message.includes("[`"))message=decode_user_hyperlinks(message);packet["message"]=message;add_chatbox_text(packet);if(packet["event"]==1||packet["event"]==77){if(message.includes(" your lootings accumulate to "))play_sound(soundset["e_victor"]);else if(message.includes("You have liberated "))play_sound(soundset["e_liberate"]);else if(message.includes(" gold from the city."))play_sound(soundset["e_conquer"])}}function recenter_flare_tile(tile_id){center_tile_id(tile_id);explosion_anim_map[tile_id]=50;show_tile_marker_instead[tile_id]=true}function decode_user_hyperlinks(message){var ptile=null;var assert_escape=0;while(message.includes("[`")){if(assert_escape++>20)break;var freemoji_name=message.substring(message.indexOf("[`")+2,message.indexOf("`]"));var replace_me="[`"+freemoji_name+"`]";var element=html_emoji_from_universal(freemoji_name);message=message.replace(replace_me,element)}if(message.includes("%%tile")){assert_escape=0;var tile_x,tile_y,tile_link;var tile_extract,tile_id;var pcity,city_name;while(message.includes("%%tile")&&message.includes("~%")){if(assert_escape++>4)break;tile_extract=message.substring(0,message.indexOf("~%")+2).match("%%tile(.*)~%");tile_id=tile_extract[1];if(tiles[tile_id]!=null){ptile=tiles[tile_id];pcity=tile_city(ptile);city_name=pcity==null?"":pcity.name+":";tile_x=ptile.x;tile_y=ptile.y;tile_link="<span class='chatbox_text_tileinfo' onclick='recenter_flare_tile("+tile_id+");'>"+"<font style='text-decoration: underline;' color='#1FDFFF'><l tgt='tile' x='"+tile_x+"' y='"+tile_y+"'>"+city_name+" ("+tile_x+","+tile_y+")";message=message.replace(tile_extract[0],tile_link+"</l></font></span>")}}}if(message.includes("%%unit")){assert_escape=0;var unit_link,unit_name;var unit_extract,unit_id;while(message.includes("%%unit")&&message.includes("_%")){if(assert_escape++>4)break;unit_extract=message.substring(0,message.indexOf("_%")+2).match("%%unit(.*)_%");unit_name=message.substring(message.indexOf("_%")+2,message.indexOf("~~"));unit_name=message.match("_%(.*)~~");if(unit_name==null)unit_name="";unit_id=unit_extract[1];if(units[unit_id]!=null){punit=units[unit_id];var nationality=nations[players[punit["owner"]]["nation"]]["adjective"];var hovertext=get_unit_city_info(punit);unit_link="<span class='chatbox_text_tileinfo' "+" title='"+hovertext+"'"+" onclick='set_unit_id_focus("+unit_id+");'>"+"<font style='text-decoration: underline;' color='#FFA865'>"+unit_name[1];message=message.replace(unit_name[1]+"~~","");message=message.replace(unit_extract[0],unit_link+"</font></span>")}else{message=message.replace("~~","");message=message.replace(unit_extract[0],"")}}}if(message.includes("%%Discord")){message=message.replace("%%Discord","<a href='https://discord.gg/Zj8UQSN' target='_new'>Freeciv-Web Discord Chat</a>")}return message}function handle_early_chat_msg(packet){handle_chat_msg(packet)}function handle_city_info(packet){packet["name"]=decodeURIComponent(packet["name"]);packet["improvements"]=new BitVector(packet["improvements"]);packet["city_options"]=new BitVector(packet["city_options"]);packet["unhappy"]=city_unhappy(packet);if(cities[packet["id"]]==null){cities[packet["id"]]=packet;if(C_S_RUNNING==client_state()&&!observing&&benchmark_start==0&&client.conn.playing!=null&&packet["owner"]==client.conn.playing.playerno){show_city_dialog_by_id(packet["id"])}}else{cities[packet["id"]]=$.extend(cities[packet["id"]],packet)}if(tiles[packet["tile"]]!=null){tiles[packet["tile"]]["worked"]=packet["id"]}}function handle_web_city_info_addition(packet){if(cities[packet["id"]]==null){console.log("packet_web_city_info_addition for unknown city "+packet["id"]);return}else{$.extend(cities[packet["id"]],packet)}packet=cities[packet["id"]];if(active_city!=null){show_city_dialog(active_city)}if(packet["diplomat_investigate"]){show_city_dialog(cities[packet["id"]])}if(worklist_dialog_active&&active_city!=null){city_worklist_dialog(active_city)}bulbs_output_updater.update();var active_tab=$("#tabs").tabs("option","active");if(active_tab==TAB_CITIES){city_screen_updater.update()}else if(active_tab==TAB_EMPIRE){empire_screen_updater.update()}income_needs_refresh=true}function handle_city_short_info(packet){packet["name"]=decodeURIComponent(packet["name"]);packet["improvements"]=new BitVector(packet["improvements"]);if(cities[packet["id"]]==null){cities[packet["id"]]=packet}else{cities[packet["id"]]=$.extend(cities[packet["id"]],packet)}bulbs_output_updater.update();var active_tab=$("#tabs").tabs("option","active");if(active_tab==TAB_CITIES){city_screen_updater.update()}else if(active_tab==TAB_EMPIRE){empire_screen_updater.update()}income_needs_refresh=true}function handle_traderoute_info(packet){if(city_trade_routes[packet["city"]]==null){city_trade_routes[packet["city"]]={}}city_trade_routes[packet["city"]][packet["index"]]=packet}function handle_player_info(packet){packet["flags"]=new BitVector(packet["flags"]);packet["gives_shared_vision"]=new BitVector(packet["gives_shared_vision"]);players[packet["playerno"]]=$.extend(players[packet["playerno"]],packet);var active_tab=$("#tabs").tabs("option","active");if(active_tab==TAB_EMPIRE){empire_screen_updater.update()}}function handle_web_player_info_addition(packet){players[packet["playerno"]]=$.extend(players[packet["playerno"]],packet);if(client.conn.playing!=null){if(packet["playerno"]==client.conn.playing["playerno"]){client.conn.playing=players[packet["playerno"]];update_game_status_panel();update_net_income();income_needs_refresh=false;income_calculated_by_client=false}}update_player_info_pregame();if(is_tech_tree_init&&tech_dialog_active)update_tech_screen();assign_nation_color(players[packet["playerno"]]["nation"]);if(packet["playerno"]==getLength(players)-1)$.unblockUI()}function handle_player_remove(packet){delete players[packet["playerno"]];update_player_info_pregame()}function handle_conn_ping(packet){ping_last=(new Date).getTime();var pong_packet={pid:packet_conn_pong};send_request(JSON.stringify(pong_packet))}function handle_set_topology(packet){}function handle_map_info(packet){map=packet;map_init_topology(false);map_allocate();mapdeco_init()}function handle_game_info(packet){game_info=packet;if(is_ongoing_longturn()&&C_S_PREPARING==client_state())wait_for_text("You are logged in as",pick_nation_ongoing_longturn)}function handle_calendar_info(packet){calendar_info=packet}function handle_start_phase(packet){if(C_S_PREPARING==client_state())pregame_messages=get_chatbox_msg_array();update_client_state(C_S_RUNNING);set_phase_start();saved_this_turn=false;add_replay_frame()}function handle_ruleset_control(packet){ruleset_control=packet;for(i=0;i<CRF_LAST;i++)client_rules_flag[i]=false;client_rules_flag[CRF_MINOR_NUKES]=true;var rules=ruleset_control["name"];if(rules.startsWith("MP2")){rules="MP2"}switch(rules){case"MP2":case"Avant-garde 2":case"Avant-garde":client_rules_flag[CRF_MP2_A]=true;client_rules_flag[CRF_RADAR_TOWER]=true;client_rules_flag[CRF_EXTRA_HIDEOUT]=true;client_rules_flag[CRF_EXTRA_QUAY]=true;client_rules_flag[CRF_MAJOR_NUKES]=true;client_rules_flag[CRF_SURGICAL_PILLAGE]=true;$("#order_airbase").attr("title","Build Airbase/Radar (Shift-E)");case"Multiplayer-Evolution ruleset":client_rules_flag[CRF_MP2]=true;client_rules_flag[CRF_CARGO_HEURISTIC]=true;client_rules_flag[CRF_ASMITH_SPECIALISTS]=true;client_rules_flag[CRF_OASIS_IRRIGATE]=true;client_rules_flag[CRF_MP2_UNIT_CONVERSIONS]=true;client_rules_flag[CRF_LEGION_WORK]=true;client_rules_flag[CRF_MASONRY_FORT]=true;client_rules_flag[CRF_CANALS]=true;client_rules_flag[CRF_MP2_SPECIAL_UNITS]=true;client_rules_flag[CRF_COMMIE_BLDG_UPKEEP]=true;client_rules_flag[CRF_PACTS_SANS_EMBASSY]=true;client_rules_flag[CRF_TESLA_UPGRADE_DISCOUNT]=true;client_rules_flag[CRF_NO_WASTE]=true;client_rules_flag[CRF_MAGLEV]=true;client_rules_flag[CRF_TRIREME_FUEL]=true;break;case"Multiplayer-Plus ruleset":client_rules_flag[CRF_CARGO_HEURISTIC]=true;client_rules_flag[CRF_NO_UNIT_GOLD_UPKEEP]=true;client_rules_flag[CRF_PACTS_SANS_EMBASSY]=true;client_rules_flag[CRF_NO_WASTE]=true;break;case"Multiplayer ruleset":client_rules_flag[CRF_CARGO_HEURISTIC]=true;client_rules_flag[CRF_NO_UNIT_GOLD_UPKEEP]=true;client_rules_flag[CRF_NO_WASTE]=true;break;case"Classic ruleset":client_rules_flag[CRF_CARGO_HEURISTIC]=true;client_rules_flag[CRF_NO_UNIT_GOLD_UPKEEP]=true;client_rules_flag[CRF_NO_WASTE]=true;break;case"Civ2Civ3 ruleset":client_rules_flag[CRF_MAGLEV]=true;case"Sandbox ruleset":client_rules_flag[CRF_NO_BASES_ON_RIVERS]=true;client_rules_flag[CRF_COMMIE_BLDG_UPKEEP]=true;break}switch(ruleset_control["name"]){case"MP2 Caravel":client_rules_flag[CRF_MP2_C]=true;client_rules_flag[CRF_SIEGE_RAM]=true;client_rules_flag[CRF_MARINE_BASES]=true;client_rules_flag[CRF_MARINE_RANGED]=true;client_rules_flag[CRF_BSHIP_BOMBARD]=true;client_rules_flag[CRF_RECYCLING_DISCOUNT]=true;client_rules_flag[CRF_COLOSSUS_DISCOUNT]=true;client_rules_flag[CRF_SPECIAL_UNIT_ATTACKS]=true;case"MP2 Brava":client_rules_flag[CRF_SEABRIDGE]=true;client_rules_flag[CRF_MP2_B]=true;break}warcalc_set_tooltips();if(ruleset_control["name"])update_client_state(C_S_PREPARING);effects={};ruleset_summary=null;ruleset_description=null;game_rules=null;nation_groups=[];nations={};specialists={};techs={};governments={};terrain_control={};SINGLE_MOVE=undefined;unit_types={};unit_classes={};city_rules={};terrains={};resources={};goods={};actions={};improvements_init();for(var extra in extras){var ename=extras[extra]["name"];delete window["EXTRA_"+ename.toUpperCase()];if(ename=="Railroad")delete window["EXTRA_RAIL"];else if(ename=="Oil Well")delete window["EXTRA_OIL_WELL"];else if(ename=="Minor Tribe Village")delete window["EXTRA_HUT"];else if(typeof EXTRA_SEABRIDGE!=="undefined"){if(ename=="Sea Bridge")delete window["EXTRA_SEABRIDGE"]}else if(typeof EXTRA_FORT!=="undefined"){if(ename=="Fort")delete window["EXTRA_FORT"]}else if(typeof EXTRA_NAVALBASE!=="undefined"){if(ename=="Naval Base")delete window["EXTRA_NAVALBASE"]}else if(typeof EXTRA_CASTLE!=="undefined"){if(ename=="Castle")delete window["EXTRA_CASTLE"]}else if(typeof EXTRA_BUNKER!=="undefined"){if(ename=="Castle")delete window["EXTRA_BUNKER"]}}extras={};clause_infos={}}function handle_non_integer_combat_scores(key){if(unit_types[key]["name"]=="Falconeers"){unit_types[key].defense_strength*=.5}else if(unit_types[key]["name"]=="Escort Fighter"){unit_types[key].attack_strength+=.5}else if(unit_types[key]["name"]=="Fighter"){unit_types[key].defense_strength+=.5}else{return}console.log("Non-integer combat strength added to warcalc data for "+unit_types[key]["name"])}function handle_ruleset_summary(packet){ruleset_summary=packet["text"]}function handle_ruleset_description_part(packet){if(ruleset_description==null){ruleset_description=packet["text"]}else{ruleset_description+=packet["text"]}}function handle_endgame_report(packet){update_client_state(C_S_OVER)}function update_client_state(value){set_client_state(value)}function handle_authentication_req(packet){show_auth_dialog(packet)}function handle_server_shutdown(packet){}function handle_nuke_tile_info(packet){var ptile=index_to_tile(packet["tile"]);ptile["nuke"]=60;play_sound("nuclear_distant.ogg")}function handle_city_remove(packet){remove_city(packet["city_id"])}function handle_connect_msg(packet){add_chatbox_text(packet)}function handle_server_info(packet){if(packet["emerg_version"]>0){console.log("Server has version %d.%d.%d.%d%s",packet.major_version,packet.minor_version,packet.patch_version,packet.emerg_version,packet.version_label)}else{console.log("Server has version %d.%d.%d%s",packet.major_version,packet.minor_version,packet.patch_version,packet.version_label)}}function handle_city_name_suggestion_info(packet){packet["name"]=decodeURIComponent(packet["name"]);city_name_dialog(packet["name"],packet["unit_id"])}function handle_city_sabotage_list(packet){if(!packet["disturb_player"]){console.log("handle_city_sabotage_list(): was asked to not disturb "+"the player. That is unimplemented.")}popup_sabotage_dialog(game_find_unit_by_number(packet["actor_id"]),game_find_city_by_number(packet["city_id"]),new BitVector(packet["improvements"]),packet["act_id"])}function handle_player_attribute_chunk(packet){}function handle_unit_remove(packet){var punit=game_find_unit_by_number(packet["unit_id"]);if(punit==null){return}if(action_selection_in_progress_for===punit.id){action_selection_close();action_selection_next_in_focus(punit.id)}clear_tile_unit(punit);client_remove_unit(punit)}function handle_unit_info(packet){handle_unit_packet_common(packet);var active_tab=$("#tabs").tabs("option","active");if(active_tab==TAB_EMPIRE){empire_screen_updater.update()}}function handle_unit_short_info(packet){handle_unit_packet_common(packet);var active_tab=$("#tabs").tabs("option","active");if(active_tab==TAB_EMPIRE){empire_screen_updater.update()}}function handle_unit_packet_common(packet_unit){var punit=player_find_unit_by_id(unit_owner(packet_unit),packet_unit["id"]);clear_tile_unit(punit);if(punit==null&&game_find_unit_by_number(packet_unit["id"])){handle_unit_remove(packet_unit["id"])}var old_tile=null;if(punit!=null)old_tile=index_to_tile(punit["tile"]);if(units[packet_unit["id"]]==null){if(should_ask_server_for_actions(packet_unit)){action_decision_request(packet_unit)}packet_unit["anim_list"]=[];units[packet_unit["id"]]=packet_unit;units[packet_unit["id"]]["facing"]=6}else{if(punit["action_decision_want"]!=packet_unit["action_decision_want"]&&should_ask_server_for_actions(packet_unit)){action_decision_request(packet_unit)}update_unit_anim_list(units[packet_unit["id"]],packet_unit);units[packet_unit["id"]]=$.extend(units[packet_unit["id"]],packet_unit);for(var i=0;i<current_focus.length;i++){if(current_focus[i]["id"]==packet_unit["id"]){$.extend(current_focus[i],packet_unit)}}}update_tile_unit(units[packet_unit["id"]]);if(current_focus.length>0&&current_focus[0]["id"]==packet_unit["id"]){update_active_units_dialog();update_unit_order_commands();if(current_focus[0]["done_moving"]!=packet_unit["done_moving"]){update_unit_focus()}}}function handle_unit_combat_info(packet){var attacker=units[packet["attacker_unit_id"]];var defender=units[packet["defender_unit_id"]];var attacker_hp=packet["attacker_hp"];var defender_hp=packet["defender_hp"];var tile_x=tiles[attacker["tile"]]["x"];var tile_y=tiles[attacker["tile"]]["y"];var pplayer=null;var player_nation=null;if(observing||client.conn.playing==null){}else{pplayer=players[client.conn.playing["playerno"]];player_nation=nations[pplayer["nation"]]["adjective"]}var defender_nation=players[defender["owner"]]["nation"];var attacker_nation=players[attacker["owner"]]["nation"];var player_is_combatant=player_nation==nations[defender_nation]["adjective"]||player_nation==nations[attacker_nation]["adjective"];var combatant_visible=is_unit_visible(attacker)||is_unit_visible(defender);if(attacker_hp==0&&(combatant_visible||player_is_combatant)){var win_type=unit_type(defender)["name"];var swords=units_pregunpowder.indexOf(win_type)>=0;if(combatant_visible)explosion_anim_map[attacker["tile"]]=25-swords*1;anim_swords_instead[attacker["tile"]]=swords;if(!combat_sound_special_case(attacker,attacker_hp,defender))play_combat_sound(defender)}if(defender_hp==0&&(combatant_visible||player_is_combatant)){var win_type=unit_type(attacker)["name"];var swords=units_pregunpowder.indexOf(win_type)>=0;if(combatant_visible)explosion_anim_map[defender["tile"]]=25-swords*1;anim_swords_instead[defender["tile"]]=swords;if(!combat_sound_special_case(attacker,attacker_hp,defender))play_combat_sound(attacker)}if(defender_hp>0&&attacker_hp>0&&(combatant_visible||player_is_combatant)){play_combat_sound(attacker);play_combat_sound(defender)}}function handle_unit_action_answer(packet){var actor_id=packet["actor_id"];var target_id=packet["target_id"];var cost=packet["cost"];var action_type=packet["action_type"];var target_city=game_find_city_by_number(target_id);var target_unit=game_find_unit_by_number(target_id);var actor_unit=game_find_unit_by_number(actor_id);if(actor_unit==null){console.log("Bad actor unit ("+actor_id+") in unit action answer.");act_sel_queue_done(diplomat_id);return}if(!packet["disturb_player"]){console.log("handle_unit_action_answer(): was asked to not disturb "+"the player. That is unimplemented.")}if(action_type==ACTION_SPY_BRIBE_UNIT){if(target_unit==null){console.log("Bad target unit ("+target_id+") in unit action answer.");act_sel_queue_done(diplomat_id);return}else{popup_bribe_dialog(actor_unit,target_unit,cost,action_type);return}}else if(action_type==ACTION_SPY_INCITE_CITY||action_type==ACTION_SPY_INCITE_CITY_ESC){if(target_city==null){console.log("Bad target city ("+target_id+") in unit action answer.");act_sel_queue_done(diplomat_id);return}else{popup_incite_dialog(actor_unit,target_city,cost,action_type);return}}else if(action_type==ACTION_UPGRADE_UNIT){if(target_city==null){console.log("Bad target city ("+target_id+") in unit action answer.");act_sel_queue_done(diplomat_id);return}else{popup_unit_upgrade_dlg(actor_unit,target_city,cost,action_type);return}}else if(action_type==ACTION_COUNT){console.log("unit_action_answer: Server refused to respond.")}else{console.log("unit_action_answer: Invalid answer.")}act_sel_queue_done(diplomat_id)}function handle_unit_actions(packet){var actor_unit_id=packet["actor_unit_id"];var target_unit_id=packet["target_unit_id"];var target_city_id=packet["target_city_id"];var target_tile_id=packet["target_tile_id"];var target_extra_id=packet["target_extra_id"];var action_probabilities=packet["action_probabilities"];var disturb_player=packet["disturb_player"];var pdiplomat=game_find_unit_by_number(actor_unit_id);var target_unit=game_find_unit_by_number(target_unit_id);var target_city=game_find_city_by_number(target_city_id);var ptile=index_to_tile(target_tile_id);var target_extra=extra_by_number(target_extra_id);var hasActions=false;if(pdiplomat!=null&&ptile!=null){action_probabilities.forEach(function(prob){if(action_prob_possible(prob)){hasActions=true}})}if(hasActions&&disturb_player){popup_action_selection(pdiplomat,action_probabilities,ptile,target_extra,target_unit,target_city)}else if(disturb_player){action_selection_no_longer_in_progress(actor_unit_id);action_decision_clear_want(actor_unit_id);action_selection_next_in_focus(actor_unit_id)}else if(hasActions){console.log("Received the reply to a background request I didn't do.")}}function handle_diplomacy_init_meeting(packet){if(is_hotseat()&&packet["initiated_from"]!=client.conn.playing["playerno"])return;diplomacy_clause_map[packet["counterpart"]]=[];show_diplomacy_dialog(packet["counterpart"]);show_diplomacy_clauses(packet["counterpart"])}function handle_diplomacy_cancel_meeting(packet){cancel_meeting(packet["counterpart"])}function handle_diplomacy_create_clause(packet){var counterpart_id=packet["counterpart"];if(diplomacy_clause_map[counterpart_id]==null){diplomacy_clause_map[counterpart_id]=[]}diplomacy_clause_map[counterpart_id].push(packet);show_diplomacy_clauses(counterpart_id)}function handle_diplomacy_remove_clause(packet){remove_clause(packet)}function handle_diplomacy_accept_treaty(packet){accept_treaty(packet["counterpart"],packet["I_accepted"],packet["other_accepted"])}var page_msg={};function handle_page_msg(packet){page_msg["headline"]=packet["headline"];page_msg["caption"]=packet["caption"];page_msg["event"]=packet["event"];page_msg["missing_parts"]=packet["parts"];page_msg["message"]="";if(packet.headline=="Wonders of the World"){page_msg["message"]+=handle_wonders_report();if(packet["parts"]==0){show_dialog_message(page_msg["headline"],page_msg["message"]);page_msg={}}else page_msg["message"]+="<br><b><u>Great Wonders</u></b><br>"}}function handle_wonders_report(){var appended_message="<div style='overflow:hidden;'><table><tr><th style='text-align:left;'><u>Small Wonders</u></th><th>#</th></tr>";var wonders=new Array(improvements.length);for(var w=0;w<Object.keys(improvements).length;w++){wonders[w]=0;for(var p=0;p<Object.keys(players).length;p++){if(players[p].wonders[w]!=0)wonders[w]++}if(wonders[w]>0&&improvements[w].genus==1){var color_marker="<span style='text-shadow: 1px 1px #000'>";if(!client_is_observer()&&player_has_wonder(client.conn.playing.playerno,w)){color_marker="<span style='color: rgb(128,192,255); text-shadow: 1px 1px #000'>"}appended_message+="<tr style='cursor:default' title='"+html_safe(improvements[w].helptext)+"'>"+"<td>"+color_marker+improvements[w].name+"</span></td><td><b>"+wonders[w]+"</b></td></tr>"}}appended_message+="</table></div>";return appended_message}function handle_page_msg_part(packet){page_msg["message"]=page_msg["message"]+packet["lines"];page_msg["missing_parts"]--;if(page_msg["missing_parts"]==0){var regxp=/\n/gi;page_msg["message"]=page_msg["message"].replace(regxp,"<br>\n");show_dialog_message(page_msg["headline"],page_msg["message"]);page_msg={}}}function handle_conn_ping_info(packet){last_ping_measurement=packet["ping_time"][0]*1e3;if(debug_active){conn_ping_info=packet;debug_ping_list.push(packet["ping_time"][0]*1e3)}}function handle_end_phase(packet){chatbox_clip_messages();if(is_pbem()){pbem_end_phase()}if(is_hotseat()){hotseat_next_player()}}function handle_new_year(packet){game_info["year"]=packet["year"];game_info["fragments"]=packet["fragments"];game_info["turn"]=packet["turn"]}function handle_begin_turn(packet){if(!observing){$("#turn_done_button").button("option","disabled",false);$("#turn_done_button").css({"background-color":"#000f",opacity:1,color:"#ddd","border-color":"#edd5"});if(is_small_screen()){$("#turn_done_button").button("option","label","Done")}else{$("#turn_done_button").button("option","label","Turn Done")}}waiting_units_list=[];update_unit_focus();update_active_units_dialog();update_game_status_panel();var funits=get_units_in_focus();if(funits!=null&&funits.length==0){auto_center_on_focus_unit()}if(is_tech_tree_init&&tech_dialog_active)update_tech_screen()}function handle_end_turn(packet){reset_unit_anim_list();if(!observing){$("#turn_done_button").css({"background-color":"#0006",opacity:.85,color:"#edd","border-color":"#edd5"});$("#turn_done_button").button("option","disabled",true);$("#turn_done_button:disabled").css({"background-color":"#0006",opacity:.85,color:"#edd","border-color":"#edd5"})}}function handle_freeze_client(packet){client_frozen=true}function handle_thaw_client(packet){client_frozen=false}function handle_spaceship_info(packet){spaceship_info[packet["player_num"]]=packet}function handle_ruleset_unit(packet){if(packet["name"]!=null&&packet["name"].indexOf("?unit:")==0)packet["name"]=packet["name"].replace("?unit:","");unit_types[packet["id"]]=packet;unit_types[packet["id"]].gov_requirement=GOV_LAST;for(var i=0;i<packet["build_reqs"].length;i++){if(packet["build_reqs"][i]["kind"]==VUT_GOVERNMENT){unit_types[packet["id"]].gov_requirement=packet["build_reqs"][i]["value"]}}if(client_rules_flag[CRF_MP2_C])handle_non_integer_combat_scores(packet["id"])}function handle_web_ruleset_unit_addition(packet){packet["utype_actions"]=new BitVector(packet["utype_actions"]);unit_types[packet["id"]]=$.extend(unit_types[packet["id"]],packet);create_unit_offset_arrays()}function handle_ruleset_game(packet){game_rules=packet}function handle_ruleset_specialist(packet){specialists[packet["id"]]=packet}function handle_ruleset_government_ruler_title(packet){}function recreate_old_tech_req(packet){var i;packet["req"]=[];for(i=0;i<packet["research_reqs"].length;i++){var requirement=packet["research_reqs"][i];if(requirement.kind==VUT_ADVANCE&&requirement.range==REQ_RANGE_PLAYER&&requirement.present){packet["req"].push(requirement.value)}}while(packet["req"].length<2){packet["req"].push(A_NONE)}}function handle_ruleset_tech(packet){packet["name"]=packet["name"].replace("?tech:","");techs[packet["id"]]=packet;recreate_old_tech_req(packet)}function handle_ruleset_tech_class(packet){}function handle_ruleset_tech_flag(packet){}function handle_ruleset_government(packet){governments[packet["id"]]=packet;GOV_LAST=Object.keys(governments).length}function handle_ruleset_terrain_control(packet){terrain_control=packet;SINGLE_MOVE=terrain_control["move_fragments"]}function handle_ruleset_nation_groups(packet){nation_groups=packet["groups"]}function handle_ruleset_nation(packet){nations[packet["id"]]=packet}function handle_ruleset_city(packet){city_rules[packet["style_id"]]=packet}function handle_ruleset_building(packet){improvements_add_building(packet)}function handle_ruleset_unit_class(packet){packet["flags"]=new BitVector(packet["flags"]);unit_classes[packet["id"]]=packet}function handle_ruleset_disaster(packet){}function handle_ruleset_trade(packet){}function handle_rulesets_ready(packet){}function handle_single_want_hack_reply(packet){}function handle_ruleset_choices(packet){}function handle_game_load(packet){}function handle_ruleset_effect(packet){if(effects[packet["effect_type"]]==null){effects[packet["effect_type"]]=[]}effects[packet["effect_type"]].push(packet)}function handle_ruleset_unit_flag(packet){}function handle_ruleset_unit_class_flag(packet){}function handle_ruleset_unit_bonus(packet){}function handle_ruleset_terrain_flag(packet){}function handle_scenario_info(packet){scenario_info=packet}function handle_scenario_description(packet){scenario_info["description"]=packet["description"];update_game_info_pregame()}function handle_vote_new(packet){}function handle_vote_update(packet){}function handle_vote_remove(packet){}function handle_vote_resolve(packet){}function handle_edit_object_created(packet){}function handle_goto_path(packet){if(goto_active){update_goto_path(packet)}else{show_goto_path(packet)}}function handle_server_setting_const(packet){server_settings[packet["id"]]=packet;server_settings[packet["name"]]=packet}function handle_server_setting_int(packet){$.extend(server_settings[packet["id"]],packet)}function handle_server_setting_enum(packet){$.extend(server_settings[packet["id"]],packet)}function handle_server_setting_bitwise(packet){$.extend(server_settings[packet["id"]],packet)}function handle_server_setting_bool(packet){$.extend(server_settings[packet["id"]],packet)}function handle_server_setting_str(packet){$.extend(server_settings[packet["id"]],packet)}function handle_game_uid(){if(!(server_settings&&Object.keys(server_settings).length>0))return;if(is_longturn()&&server_settings["metamessage"]&&server_settings["metamessage"]["val"]){Game_UID=server_settings["metamessage"]["val"]}else{Game_UID=server_settings["xsize"]["val"]*server_settings["ysize"]["val"]+server_settings["xsize"]["val"]+server_settings["ysize"]["val"];if(client.conn.playing){Game_UID+=client.conn.playing["name"]+client.conn.playing["nation"]+client.conn.playing["playerno"]}}Game_UID=getHash(Game_UID.toString());myGameVars=simpleStorage.get(Game_UID);if(!myGameVars)myGameVars={}}function handle_server_setting_control(packet){}function handle_player_diplstate(packet){if(client==null||client.conn.playing==null)return;if(packet["type"]==DS_WAR&&packet["plr2"]==client.conn.playing["playerno"]&&diplstates[packet["plr1"]]!=DS_WAR&&diplstates[packet["plr1"]]!=DS_NO_CONTACT){alert_war(packet["plr1"])}else if(packet["type"]==DS_WAR&&packet["plr1"]==client.conn.playing["playerno"]&&diplstates[packet["plr2"]]!=DS_WAR&&diplstates[packet["plr2"]]!=DS_NO_CONTACT){alert_war(packet["plr2"])}if(packet["plr1"]==client.conn.playing["playerno"]){diplstates[packet["plr2"]]=packet["type"]}else if(packet["plr2"]==client.conn.playing["playerno"]){diplstates[packet["plr1"]]=packet["type"]}if(players[packet["plr1"]].diplstates===undefined){players[packet["plr1"]].diplstates=[]}players[packet["plr1"]].diplstates[packet["plr2"]]={state:packet["type"],turns_left:packet["turns_left"],contact_turns_left:packet["contact_turns_left"],has_reason_to_cancel:packet["has_reason_to_cancel"]}}function handle_ruleset_extra(packet){packet["causes"]=new BitVector(packet["causes"]);packet["rmcauses"]=new BitVector(packet["rmcauses"]);extras[packet["id"]]=packet;extras[packet["name"]]=packet;window["EXTRA_"+packet["name"].toUpperCase()]=packet["id"];if(typeof EXTRA_FORT!=="undefined"){if(packet["name"]=="Fort")window["EXTRA_FORT"]=packet["id"]}if(packet["name"]=="Sea Bridge")window["EXTRA_SEABRIDGE"]=packet["id"];if(packet["name"]=="Naval Base")window["EXTRA_NAVALBASE"]=packet["id"];if(packet["name"]=="Railroad")window["EXTRA_RAIL"]=packet["id"];if(packet["name"]=="Oil Well")window["EXTRA_OIL_WELL"]=packet["id"];if(packet["name"]=="Minor Tribe Village")window["EXTRA_HUT"]=packet["id"];if(packet["name"]=="Castle")window["EXTRA_CASTLE"]=packet["id"];if(packet["name"]=="Bunker")window["EXTRA_BUNKER"]=packet["id"]}function handle_ruleset_extra_flag(packet){}function handle_ruleset_base(packet){}function handle_ruleset_road(packet){}function handle_ruleset_action_enabler(packet){var paction=actions[packet.enabled_action];if(paction===undefined){console.log("Unknown action "+packet.action+" for enabler ");console.log(packet);return}paction.enablers.push(packet)}function handle_ruleset_nation_sets(packet){}function handle_ruleset_style(packet){}function handle_nation_availability(packet){}function handle_ruleset_music(packet){}function handle_endgame_player(packet){endgame_player_info.push(packet)}function handle_research_info(packet){var old_inventions=null;if(research_data[packet["id"]]!=null)old_inventions=research_data[packet["id"]]["inventions"];research_data[packet["id"]]=packet;if(game_info["team_pooled_research"]){for(var player_id in players){var pplayer=players[player_id];if(pplayer["team"]==packet["id"]){pplayer=$.extend(pplayer,packet);delete pplayer["id"]}}}else{var pplayer=players[packet["id"]];pplayer=$.extend(pplayer,packet);delete pplayer["id"]}if(!client_is_observer()&&old_inventions!=null&&client.conn.playing!=null&&client.conn.playing["playerno"]==packet["id"]){for(var i=0;i<packet["inventions"].length;i++){if(packet["inventions"][i]!=old_inventions[i]&&packet["inventions"][i]==TECH_KNOWN){queue_tech_gained_dialog(i);break}}}if(is_tech_tree_init&&tech_dialog_active)update_tech_screen();bulbs_output_updater.update()}function handle_worker_task(packet){}function handle_timeout_info(packet){last_turn_change_time=Math.ceil(packet["last_turn_change_time"]);seconds_to_phasedone=Math.floor(packet["seconds_to_phasedone"]);seconds_to_phasedone_sync=(new Date).getTime()}function handle_show_img_play_sound(packet){}function handle_play_music(packet){}function handle_ruleset_action(packet){actions[packet["id"]]=packet;packet["enablers"]=[]}function handle_ruleset_action_auto(packet){}function handle_ruleset_goods(packet){goods[packet["id"]]=packet}function handle_ruleset_achievement(packet){}function handle_ruleset_clause(packet){clause_infos[packet["type"]]=packet}function handle_achievement_info(packet){}function handle_team_name_info(packet){}function suppress_event_sound(){var cur_time=(new Date).getTime();if(cur_time-game_launch_timer<event_sound_suppress_delay){return true}return false}var PAGE_MAIN=0;var PAGE_START=1;var PAGE_SCENARIO=2;var PAGE_LOAD=3;var PAGE_NETWORK=4;var PAGE_NATION=5;var PAGE_GAME=6;var old_page=-1;function set_client_page(page){var new_page=page;if(old_page==new_page){return}switch(old_page){case-1:$("#pregame_page").remove();$("#pick_nation_dialog").remove();$("#pregame_settings").remove();break;case PAGE_SCENARIO:break;case PAGE_LOAD:break;case PAGE_NETWORK:break;case PAGE_GAME:break;default:break}switch(new_page){case PAGE_MAIN:break;case PAGE_START:break;case PAGE_NATION:break;case PAGE_GAME:$("#game_page").show();set_chat_direction(null);break;case PAGE_LOAD:break;case PAGE_SCENARIO:break;case PAGE_NETWORK:break}}function get_client_page(){return old_page}var opponents=[];var pbem_phase_ended=false;var invited_players=[];function show_pbem_dialog(){var title="Welcome to Freeciv-web";var message="";if($.getUrlVar("invited_by")!=null){var invited=$.getUrlVar("invited_by").replace(/[^a-zA-Z0-9]/g,"");message="You have been invited by "+invited+" for a Play-by-Email game of Freeciv-web. "+"You and "+invited+" will play alternating turns, and you will get an e-mail every time "+"it is your turn to play. First you can create a new user or log-in, then you will play "+"the first turn."}else if($.getUrlVar("savegame")!=null){message="It is now your turn to play this Play-by-Email game. Please login to play your turn.";if(pbem_duplicate_turn_play_check())return}else{message="You are about to start a Play-by-Email game, where you "+"can challenge other players, and each player will be notified when "+"it is their turn to play through e-mail. If you are a new player, then click the sign up button below. These are the game rules:<br>"+"<ul><li>The game will have between 2 and 4 human players playing alternating turns. Each player will get an e-mail when it is their turn to play.</li>"+"<li>Standard Freeciv-web rules are used with some changes to map size, research speed, start units and gold to speed up games.</li>"+"<li>Please complete your turn as soon as possible, and use at no longer than 7 days until you complete your turn.</li>"+"<li>Results of games with 2 players are stored to rank players.</li>"+"<li>Please post feedback and arrange new games on <a href='https://discord.gg/ZHQGvWeUaP' target='_new'>Discord</a> and the <a href='http://forum.freeciv.org/f/viewforum.php?f=24' target='_new'>Forum</a>.</li>"+"<li id='user_count'></li></ul>"}$("#dialog").remove();$("<div id='dialog'></div>").appendTo("div#game_page");$("#dialog").html(message);$("#dialog").attr("title",title);$("#dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"95%":"60%",buttons:{"Signup new user":function(){show_new_user_account_dialog("pbem")},"Log In":function(){login_pbem_user()},Deactivate:function(){close_pbem_account()}}});$("#dialog").dialog("open");$.ajax({type:"POST",url:"/user_count",success:function(data,textStatus,request){$("#user_count").html("We are now "+data+" players available for Play-By-Email games.")}});var stored_username=simpleStorage.get("username","");var stored_password=simpleStorage.get("password","");if(stored_username!=null&&stored_username!=false&&stored_password!=null&&stored_password!=false){$(".ui-dialog-buttonset button").first().button("disable")}}function login_pbem_user(){var title="Log in";var message="Log in to your Freeciv-web user account:<br><br>"+"<table><tr><td>Username:</td><td><input id='username' type='text' size='25' maxlength='30' onkeyup='return forceLower(this);'></td></tr>"+"<tr><td>Password:</td><td><input id='password' type='password' size='25'> &nbsp;"+"</td></tr></table><br><br>"+"<div id='username_validation_result' style='display:none;'></div><br><br>";$("#dialog").remove();$("<div id='dialog'></div>").appendTo("div#game_page");$("#dialog").html(message);$("#dialog").attr("title",title);$("#dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"80%":"40%",buttons:{Cancel:function(){show_pbem_dialog()},Login:function(){login_pbem_user_request()}}});var stored_username=simpleStorage.get("username","");if(stored_username!=null&&stored_username!=false){$("#username").val(stored_username)}var stored_password=simpleStorage.get("password","");if(stored_password!=null&&stored_password!=false){$("#password").val(stored_password)}$("#dialog").dialog("open");$("#dialog").keyup(function(e){if(e.keyCode==13){login_pbem_user_request()}});$(".pwd_reset").click(forgot_pbem_password)}function login_pbem_user_request(){username=$("#username").val().trim();var password=$("#password").val().trim();if(password!=null&&password.length>2){var shaObj=new jsSHA("SHA-512","TEXT");shaObj.update(password);var sha_password=encodeURIComponent(shaObj.getHash("HEX"));$.ajax({type:"POST",url:"/login_user?username="+encodeURIComponent(username)+"&sha_password="+sha_password,success:function(data,textStatus,request){if(data!=null&&data=="OK"){simpleStorage.set("username",username);simpleStorage.set("password",password);if($.getUrlVar("savegame")!=null){handle_pbem_load()}else{challenge_pbem_player_dialog(null)}}else{$("#username_validation_result").html("Incorrect username or password. Please try again!");$("#username_validation_result").show()}},error:function(request,textStatus,errorThrown){swal("Login user failed. ");setSwalTheme()}})}else{swal("Invalid password");setSwalTheme()}}function challenge_pbem_player_dialog(extra_intro_message){var title="Find other players to play with!";var message="";if(extra_intro_message!=null)message=extra_intro_message+="<br>";message+="Total number of human players: "+"<select name='playercount' id='playercount'>"+"<option value='2'>2</option>"+"<option value='3'>3</option>"+"<option value='4'>4</option>"+"</select> <br><br>"+"<div id='opponent_box'></div>";$("#dialog").remove();$("<div id='dialog'></div>").appendTo("div#game_page");$("#dialog").html(message);$("#dialog").attr("title",title);$("#dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"80%":"40%",buttons:{"Invite random player":function(){$.ajax({type:"POST",url:"/random_user",success:function(data,textStatus,request){var playercount=parseFloat($("#playercount").val());if(playercount==2){$("#opponent").val(data)}else{$("#opponent_1").val(data)}}})},Cancel:function(){show_pbem_dialog()},"Start game":function(){create_new_pbem_game()}}});var invited=$.getUrlVar("invited_by");if(invited!=null){$("#opponent").val(invited);$(".ui-dialog-buttonset button").first().hide()}prepare_pbem_opponent_selection();$("#playercount").change(prepare_pbem_opponent_selection);$("#dialog").dialog("open")}function prepare_pbem_opponent_selection(){var playercount=parseFloat($("#playercount").val());opponents=[];if(playercount==2){var msg="Enter the username or e-mail address of the other player: "+"<table><tr><td>Username/E-Mail:</td><td><input id='opponent' type='text' size='25' maxlength='64'"+" onkeyup='return forceLower(this);'></td></tr>"+"</table><br>"+"If the other player already has an account, then you will play the first turn.<br>If you enter the e-mail "+"address of a new player, then we will send an invitation e-mail to that player "+"and the other player will play the first turn.";$("#opponent_box").html(msg)}else if(playercount==3||playercount==4){var msg="Enter the <u>usernames</u> of the other <u>human</u> players: "+"<table>"+"<tr><td>You:</td><td>"+username+"</td></tr>"+"<tr><td>Username 2:</td><td><input id='opponent_1' type='text' size='25' maxlength='64'"+" onkeyup='return forceLower(this);'></td></tr>"+"<tr><td>Username 3:</td><td><input id='opponent_2' type='text' size='25' maxlength='64'"+" onkeyup='return forceLower(this);'></td></tr>";if(playercount==4){msg+="<tr><td>Username 4:</td><td><input id='opponent_3' type='text' size='25' maxlength='64'"+" onkeyup='return forceLower(this);'></td></tr>"}msg+="</table><br>"+"Before you fill in this form, the other players have to create their account and tell you their usernames. <br>"+"You will play the first turn. The other players will get an e-mail when it is their turn to play.<br>"+"This type of game can have human players only.";$("#opponent_box").html(msg)}}function validateEmail(email){var checkemail=email;if(checkemail!=null)checkemail=checkemail.replace("+","");var re=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return re.test(checkemail)}function forceLower(strInput){strInput.value=strInput.value.toLowerCase()}function create_new_pbem_game(){opponents=[];var playercount=parseFloat($("#playercount").val());if(playercount==2){var check_opponent=$("#opponent").val();if(check_opponent!=null)check_opponent=check_opponent.trim();if(invited_players.indexOf(check_opponent)!=-1){swal("You have already invited "+check_opponent+". There is no "+"need to invite multiple times. It can take some time before "+"the invitation email arrives to "+check_opponent);setSwalTheme();return}if(check_opponent==username){setSwalTheme();swal("No playing with yourself please.");return}invited_players.push(check_opponent);$.ajax({type:"POST",url:"/validate_user?userstring="+check_opponent+"&invited_by="+username,success:function(data,textStatus,request){if(data=="invitation"){send_pbem_invitation(check_opponent)}else if(data=="user_does_not_exist"){swal("Opponent does not exist. Please try another username.");setSwalTheme()}else if(data!=null&&data.length>3){opponents.push(data);network_init();$("#dialog").dialog("close");setTimeout(create_pbem_players,3500);show_dialog_message("Game ready","Play-By-Email game is now ready to start. "+"Click the start game button to play the first turn. You can also configure some "+"game settings before the game begins. The default settings are recommended. "+"Some settings are not supported in PBEM games, "+"such as more than four players, AI players or diplomacy. "+"As the first player, you can choose nation for both players. "+"Have a fun Play-By-Email game!")}else{swal("Problem starting new pbem game.");setSwalTheme()}},error:function(request,textStatus,errorThrown){swal("Opponent does not exist. Please try another username.");setSwalTheme()}})}else{var pbem_ready_players=1;var game_start_ready=true;opponents.push($("#opponent_1").val());opponents.push($("#opponent_2").val());if(playercount==4){opponents.push($("#opponent_3").val())}for(var i=0;i<opponents.length;i++){if(opponents[i].length<1){swal("Please fill in all players names.");setSwalTheme();return}else if(opponents[i].indexOf("@")!=-1){swal("Please specify the username of the other player, not their e-mail address.");setSwalTheme();return}else{$.ajax({async:false,type:"POST",url:"/validate_user?userstring="+opponents[i]+"&invited_by="+username,success:function(data,textStatus,request){if(data=="user_does_not_exist"){swal("Opponent does not exist. Please try another username.");setSwalTheme();game_start_ready=false}else{pbem_ready_players=pbem_ready_players+1}}})}}if(game_start_ready&&pbem_ready_players==playercount){network_init();$("#dialog").dialog("close");setTimeout(create_pbem_players,3500);show_dialog_message("Game ready","Play-By-Email game is now ready to start. "+"Click the start game button to play the first turn. You can also configure some "+"game settings before the game begins. The default settings are recommended. "+"Some settings are not supported in PBEM games, "+"such as more than four players, AI players or diplomacy. "+"As the first player, you can choose nation for all players. "+"Have a fun Play-By-Email game!")}}}function send_pbem_invitation(email){$.ajax({type:"POST",url:"/mailstatus?action=invite&to="+email+"&from="+username,success:function(data,textStatus,request){swal(email+" has been invited to Freeciv-web. You will "+"receive an e-mail when it is your turn to play. Now "+"you can wait for the other player.");$("#opponent").val("");setSwalTheme()},error:function(request,textStatus,errorThrown){swal("Error: Unable to invite the opponent.");setSwalTheme()}})}function create_pbem_players(){if(ws!=null&&ws.readyState===1){if(opponents!=null&&opponents.length>0){for(var i=0;i<opponents.length;i++){send_message("/create "+opponents[i])}setTimeout(pbem_init_game,1200)}else{swal("Error: invalid opponent selected.");setSwalTheme()}}else{setTimeout(create_pbem_players,500)}}function set_human_pbem_players(){for(var player_id in players){var pplayer=players[player_id];if(pplayer["barbarian_type"]==NOT_A_BARBARIAN&&pplayer["flags"].isSet(PLRF_AI)&&pplayer["name"].toUpperCase()!=username.toUpperCase()||pplayer["barbarian_type"]!=NOT_A_BARBARIAN&&!pplayer["flags"].isSet(PLRF_AI)){send_message("/aitoggle "+pplayer["name"])}}}function is_pbem(){return $.getUrlVar("action")=="pbem"}function pbem_end_phase(){if(pbem_phase_ended)return;pbem_phase_ended=true;send_message("/save");show_dialog_message("Play By Email turn over","Your turn is now over in this Play By Email game. Now the next player "+"will get an email with information about how to complete their turn. "+"You will also get an email about when it is your turn to play again. "+"See you again soon!");if($.getUrlVar("savegame")!=null){simpleStorage.set("pbem_"+$.getUrlVar("savegame"),"true")}$(window).unbind("beforeunload");setTimeout(()=>window.location.href="/",5e3)}function handle_pbem_load(){network_init();var savegame=$.getUrlVar("savegame");$("#dialog").dialog("close");$.blockUI();wait_for_text("You are logged in as",function(){load_game_real(savegame)});wait_for_text("Load complete",activate_pbem_player)}function pbem_init_game(){set_human_pbem_players();$.post("/freeciv_time_played_stats?type=pbem").fail(function(){})}function activate_pbem_player(){send_message("/take "+username);send_message_delayed("/start",50)}function close_pbem_account(){var title="Close account";var message="To deactivate your account, please enter your username and password:<br><br>"+"<table><tr><td>Username:</td><td><input id='username' type='text' size='25' onkeyup='return forceLower(this);'></td></tr>"+"<tr><td>Password:</td><td><input id='password' type='password' size='25'></td></tr></table><br><br>"+"<div id='username_validation_result' style='display:none;'></div><br><br>";$("#dialog").remove();$("<div id='dialog'></div>").appendTo("div#game_page");$("#dialog").html(message);$("#dialog").attr("title",title);$("#dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"80%":"50%",buttons:{Cancel:function(){show_pbem_dialog()},Unsubscribe:function(){request_deactivate_account()}}});$("#dialog").dialog("open")}function request_deactivate_account(){var usr=$("#username").val().trim();var password=$("#password").val().trim();var shaObj=new jsSHA("SHA-512","TEXT");shaObj.update(password);var sha_password=encodeURIComponent(shaObj.getHash("HEX"));$.ajax({type:"POST",url:"/deactivate_user?username="+usr+"&sha_password="+sha_password,success:function(data,textStatus,request){swal("User account has been deactivated!");setSwalTheme()},error:function(request,textStatus,errorThrown){swal("deactivate user failed.");setSwalTheme()}})}function pbem_duplicate_turn_play_check(){var pbem_savegame=$.getUrlVar("savegame");if(pbem_savegame!=null){var previously_played=simpleStorage.get("pbem_"+pbem_savegame,"");if(previously_played!=null){swal("This Play-By-Email turn has already been played and can't be played again. Sorry!");setSwalTheme();return true}else{return false}}}function get_pbem_game_key(){return"pbem_tech_"+client.conn.username+players[0]["name"]+players[1]["name"]}function popup_pillage_selection_dialog(punit){if(punit==null)return;var tgt=get_what_can_unit_pillage_from(punit,null);if(tgt.length==0)return;var id="#pillage_sel_dialog_"+punit["id"];remove_active_dialog(id);$("<div id='pillage_sel_dialog_"+punit["id"]+"'></div>").appendTo("div#game_page");$("#pillage_sel_dialog_"+punit["id"]).css("white-space","pre-wrap");var pstats=unit_get_extra_stats(punit);var odds=pstats.iPillage_odds+5*punit.veteran;var moves_remaining=punit.movesleft-pstats.iPillage_moves*SINGLE_MOVE;if(moves_remaining<0)moves_remaining=0;var regular_pillage_available=unit_has_dual_pillage_options(punit);$(id).append(document.createTextNode(unit_types[punit["type"]]["name"]+" performing "+unit_get_pillage_name(punit)+":\n"+(unit_can_iPillage(punit)?"("+unit_moves_left(punit)+" moves - "+pstats.iPillage_moves+" spent "+" = "+move_points_text(moves_remaining,false)+" left)\n":"")));var button_id_prefix="pillage_sel_"+punit["id"]+"_";var buttons=[];for(var i=0;i<tgt.length;i++){var extra_id=tgt[i];if(extra_id==EXTRA_NONE)continue;buttons.push({id:button_id_prefix+extra_id,class:"act_sel_button",text:extras[extra_id]["name"]+(regular_pillage_available?" -- "+unit_get_pillage_name(punit)+": "+odds+"%":""),click:function(){pillage_target_selected(event);remove_active_dialog(id);setTimeout(update_unit_focus,update_focus_delay)}})}if(!regular_pillage_available)buttons.push({id:button_id_prefix+"ANYTHING",class:"act_sel_button",text:"Just do something!",click:function(){pillage_target_selected(event);remove_active_dialog(id);setTimeout(update_unit_focus,update_focus_delay)}});else if(regular_pillage_available){var button_id_prefix="std_pillage_sel_"+punit["id"]+"_";for(var i=0;i<tgt.length;i++){var extra_id=tgt[i];if(extra_id==EXTRA_NONE)continue;buttons.push({id:button_id_prefix+extra_id,class:"act_sel_button",text:extras[extra_id]["name"]+" -- Pillage: 100%",click:function(){pillage_target_selected(event);remove_active_dialog(id);setTimeout(update_unit_focus,update_focus_delay)}})}}buttons.push({id:"pillage_sel_cancel_"+punit["id"],class:"act_sel_button",text:"Cancel (𝗪)",click:function(){remove_active_dialog(id)}});$(id).attr("title","Choose Target"+(pstats.iPillage&&!regular_pillage_available?" ("+odds+"% odds)":""));$(id).dialog({bgiframe:true,modal:false,dialogClass:"act_sel_dialog",width:390,buttons:buttons,close:function(){remove_active_dialog(id)},autoOpen:true});$(id).dialog("open");$(id).dialog("widget").position({my:"center top",at:"center top",of:window});dialog_register(id)}function pillage_target_selected(ev){const ACTIVITY_IPILLAGE_OVERRIDE_FLAG=1024;var id=ev.target.id;var params,extra_id;if(id.startsWith("std")){params=id.match(/std_pillage_sel_(\d*)_([^_]*)/);extra_id=params[2]=="ANYTHING"?EXTRA_NONE:parseInt(params[2],10);extra_id|=ACTIVITY_IPILLAGE_OVERRIDE_FLAG}else{params=id.match(/pillage_sel_(\d*)_([^_]*)/);extra_id=params[2]=="ANYTHING"?EXTRA_NONE:parseInt(params[2],10)}request_new_unit_activity(units[parseInt(params[1],10)],ACTIVITY_PILLAGE,extra_id);remove_active_dialog(id)}var players={};var research_data={};var MAX_NUM_PLAYERS=30;var MAX_AI_LOVE=1e3;var DS_ARMISTICE=0;var DS_WAR=1;var DS_CEASEFIRE=2;var DS_PEACE=3;var DS_ALLIANCE=4;var DS_NO_CONTACT=5;var DS_TEAM=6;var DS_LAST=7;var PLRF_AI=0;var PLRF_SCENARIO_RESERVED=1;var PLRF_COUNT=2;function valid_player_by_number(playerno){return players[playerno]}function player_by_number(playerno){return players[playerno]}function player_by_name(pname){for(var player_id in players){var pplayer=players[player_id];if(pname==pplayer["name"])return pplayer}return null}function player_by_full_username(pname){var ainame;if(pname.substr(0,3)=="AI "){ainame=pname.substr(3)}else{ainame=pname}for(var player_id in players){var pplayer=players[player_id];if(pplayer["flags"].isSet(PLRF_AI)){if(ainame==pplayer["name"])return pplayer}else{if(pname==pplayer["username"])return pplayer}}return null}function player_find_unit_by_id(pplayer,unit_id){var punit=idex_lookup_unit(unit_id);if(punit==null)return null;if(pplayer!=null||unit_owner(punit)==pplayer){return punit}return NULL}function player_index(pplayer){return player_number(pplayer)}function player_number(player){return player["playerno"]}function get_diplstate_text(state_id){if(DS_ARMISTICE==state_id){return"Armistice"}else if(DS_WAR==state_id){return"War"}else if(DS_CEASEFIRE==state_id){return"Ceasefire"}else if(DS_PEACE==state_id){return"Peace"}else if(DS_ALLIANCE==state_id){return"Alliance"}else if(DS_NO_CONTACT==state_id){return"None"}else if(DS_TEAM==state_id){return"Team"}else{return"Unknown state"}}var embassy_status_text=["None","We have embassy","They have embassy","Both"];const EMBASSY_NONE=0;const EMBASSY_WEHAVE=1;const EMBASSY_THEYHAVE=2;const EMBASSY_BOTH=3;function get_embassy_text(player_id){const NO_INFO="-";if(player_id==null)return NO_INFO;const me=client.conn.playing;if(me==null||client_is_observer())return NO_INFO;const my_id=me.playerno;if(player_id==my_id)return NO_INFO;const them=players[player_id];if(them==null)return NO_INFO;const embassy_with=me.real_embassy[player_id];const embassy_from=them.real_embassy[my_id];if(embassy_with&&embassy_from){return embassy_status_text[EMBASSY_BOTH]}else if(embassy_with){return embassy_status_text[EMBASSY_WEHAVE]}else if(embassy_from){return embassy_status_text[EMBASSY_THEYHAVE]}else{return embassy_status_text[EMBASSY_NONE]}}function get_ai_level_text(player){var ai_level=player["ai_skill_level"];if(ai_level==0){return"Away"}else if(ai_level==1){return"Handicapped"}else if(ai_level==2){return"Novice"}else if(ai_level==3){return"Easy"}else if(ai_level==4){return"Normal"}else if(ai_level==5){return"Hard"}else if(ai_level==6){return"Cheating"}else if(ai_level==7){return"Experimental"}return"Unknown"}function get_player_connection_status(pplayer){if(pplayer==null)return"";if(!pplayer["is_alive"])return"dead";if(pplayer["phase_done"]){return"done moving"}else if(pplayer["nturns_idle"]>1){return pplayer["nturns_idle"]+" turns idling"}else{return"moving"}}function research_get(pplayer){if(pplayer==null)return null;if(game_info["team_pooled_research"]){return research_data[pplayer["team"]]}else{return research_data[pplayer["playerno"]]}}function player_has_wonder(playerno,improvement_id){if(players[playerno].wonders[improvement_id])return true;return false}function has_wonder(wonder_name_str){return player_has_wonder(client.conn.playing.playerno,improvement_id_by_name(wonder_name_str))}function world_has_wonder(wonder_name_str){for(player_id in players){if(player_has_wonder(client.conn.playing.playerno,improvement_id_by_name(wonder_name_str))){return true}}return false}function get_invalid_username_reason(username){if(username==null||username.length==0){return"empty"}else if(username.length<=2){return"too short"}else if(username.length>=32){return"too long"}username=username.toLowerCase();if(username=="pbem"){return"not available"}else if(username!=alphanumeric_cleaner(username)){return"invalid: only alphabetic letters and numbers are allowed, and must start with a letter"}else if(!check_text_with_banlist_exact(username)){return"banned"}return null}function player_capital(player){for(const city_id in cities){const city=cities[city_id];if(does_player_own_city(player,city)&&is_capital(city)){return city}}}function does_player_own_city(player,city){return city_owner_player_id(city)===player.playerno}var observing=false;var chosen_nation=-1;var chosen_style=-1;var choosing_player=-1;var ai_skill_level=3;var nation_select_id=-1;var metamessage_changed=false;var logged_in_with_password=false;var antialiasing_setting=true;var update_player_info_pregame_queued=false;var password_reset_count=0;var google_user_token=null;function pregame_start_game(){if(is_touch_device())$("#game_text_input").hide();if(client.conn["player_num"]==null)return;if(is_pbem()||is_hotseat()){set_alternate_turns()}var test_packet={pid:packet_player_ready,is_ready:true,player_no:client.conn["player_num"]};var myJSONText=JSON.stringify(test_packet);send_request(myJSONText);setup_window_size();popup_fullscreen_enter_game_dialog()}function set_alternate_turns(){console.log("set_alternate_turns -- setting phasemode; disabling diplomacy, AI.");send_message("/set phasemode player");send_message("/set minp 2");send_message("/set ec_chat=enabled");send_message("/set ec_info=enabled");send_message("/set ec_max_size=20000");send_message("/set ec_turns=32768");send_message("/set aifill 1");send_message("/set civilwarsize 1000");send_message("/set barbarians disabled");send_message("/set contactturns=0")}function observe(){if(observing){$("#observe_button").button("option","label","Observe Game");send_message("/detach")}else{$("#observe_button").button("option","label","Don't observe");send_message("/observe")}observing=!observing}function check_browser_compatibility(){var isIE=false||!!document.documentMode;if(isIE){swal({title:"INCOMPATIBLE BROWSER",text:"Internet Explorer is not supported. Freeciv is a game with video graphics that "+"require a modern browser. Internet Explorer is obsolete, and was replaced "+"by Microsoft's Edge browser. We suggest downloading a modern browser and coming "+"back to play! Suggestions: Chrome, Opera, Firefox, Safari, Chromium, or Edge. "+"Hope to see you soon!",type:"warning",showCancelButton:false,confirmButtonColor:"#DD6B55",confirmButtonText:"OK",closeOnConfirm:true},function(){console.log("Incompatible browser: Internet Explorer.");$(window).off("beforeunload");window.location="https://www.google.com/chrome/"});setSwalTheme()}}function update_game_info_pregame(){check_browser_compatibility();var game_info_html="";if(C_S_PREPARING!=client_state()){return}if(scenario_info!=null&&scenario_info["is_scenario"]){game_info_html+="<p>";game_info_html+=scenario_info["description"].replace(/\n/g,"<br>");game_info_html+="</p>";if(scenario_info["authors"]){game_info_html+="<p>";game_info_html+="Scenario by ";game_info_html+=scenario_info["authors"].replace(/\n/g,"<br>");game_info_html+="</p>"}if(scenario_info["prevent_new_cities"]){game_info_html+="<p>";game_info_html+=scenario_info["name"]+" forbids the founding of new cities.";game_info_html+="</p>"}}if(is_longturn()){$("#load_game_button").hide();$("#pregame_settings_button").hide();game_info_html+="<p>";game_info_html+="<h2>Freeciv: One Turn per Day game</h2>-Each player plays one turn every day, each turn lasts 23 hours.<br>"}else if($.getUrlVar("action")=="multi"){game_info_html+="<p>";game_info_html+="<h2>Freeciv Multiplayer game</h2>-You are now about to play a multiplayer game.<br>-Please wait until at least 2 players have joined the game, then click the start game button.";game_info_html+="</p>"}$("#pregame_game_info").html(game_info_html);setup_window_size()}function update_player_info_pregame(){if(update_player_info_pregame_queued)return;setTimeout(update_player_info_pregame_real,1e3);update_player_info_pregame_queued=true}function update_player_info_pregame_real(){var id;if(C_S_PREPARING==client_state()&&(!is_ongoing_longturn()||is_loaded_game())){var player_html="";for(id in players){var player=players[id];if(player!=null){if(player["name"].indexOf("AI")!=-1){player_html+="<div id='pregame_plr_"+id+"' class='pregame_player_name'><div id='pregame_ai_icon'></div><b>"+player["name"]+"</b></div>"}else{player_html+="<div id='pregame_plr_"+id+"' class='pregame_player_name'><div id='pregame_player_icon'></div><b>"+player["name"]+"</b></div>"}}}$("#pregame_player_list").html(player_html);for(id in players){var player=players[id];var nation_text="";if(player["nation"]in nations){nation_text=" - "+nations[player["nation"]]["adjective"];var flag_html=$("<canvas id='pregame_nation_flags_"+id+"' width='45' height='30' class='pregame_flags'></canvas>");$("#pregame_plr_"+id).prepend(flag_html);var flag_canvas=document.getElementById("pregame_nation_flags_"+id);if(flag_canvas==null)continue;var flag_canvas_ctx=flag_canvas.getContext("2d");var tag="f."+nations[player["nation"]]["graphic_str"]+"-large";if(sprites[tag]!=null&&flag_canvas_ctx!=null){flag_canvas_ctx.drawImage(sprites[tag],0,0)}}if(player["is_ready"]==true){$("#pregame_plr_"+id).addClass("pregame_player_ready");$("#pregame_plr_"+id).attr("title","Player ready"+nation_text)}else if(player["name"].indexOf("AI")==-1){$("#pregame_plr_"+id).attr("title","Player not ready"+nation_text)}else{$("#pregame_plr_"+id).attr("title","AI Player (random nation)")}$("#pregame_plr_"+id).attr("name",player["name"]);$("#pregame_plr_"+id).attr("playerid",player["playerno"])}$(".pregame_player_name").tooltip();var pregame_context_items={pick_nation:{name:"Pick nation"},observe_player:{name:"Observe this player"},take_player:{name:"Take this player"},aitoggle_player:{name:"Aitoggle player"},sep1:"---------",novice:{name:"Novice"},easy:{name:"Easy"},normal:{name:"Normal"},hard:{name:"Hard"},sep2:"---------"};if(is_pbem()){pregame_context_items={pick_nation:{name:"Pick nation"}}}if(!is_longturn()){$("#pregame_player_list").contextMenu({selector:".pregame_player_name",callback:function(key,options){var name=$(this).attr("name");if(name!=null&&name.indexOf(" ")!=-1)name=name.split(" ")[0];var playerid=parseInt($(this).attr("playerid"));if(key=="take_player"){send_message("/take "+name)}else if(key=="pick_nation"){pick_nation(playerid)}else if(key=="aitoggle_player"){send_message("/aitoggle "+name)}else if(key=="observe_player"){send_message("/observe "+name)}else if(key=="novice"){send_message("/novice "+name)}else if(key=="easy"){send_message("/easy "+name)}else if(key=="normal"){send_message("/normal "+name)}else if(key=="hard"){send_message("/hard "+name)}},items:pregame_context_items})}if(client.conn["player_num"]!=null&&client.conn["player_num"]in players&&players[client.conn["player_num"]]["is_ready"]==true){$("#start_game_button").button("option","disabled",true)}else{$("#start_game_button").button("option","disabled",false)}}update_player_info_pregame_queued=false}function draw_random_nation_ongoing_longturn(player_nations){var available_nations=[];for(nation_id in nations){if(nations[nation_id]["is_playable"]&&!(nation_id in player_nations))available_nations.push({id:nation_id,nation:nations[nation_id]})}chosen_nation=parseInt(available_nations[Math.floor(Math.random()*available_nations.length)]["id"]);$("#pick_nation_dialog").dialog("close");submit_nation_choice_ongoing_longturn()}function pick_nation_ongoing_longturn(){$("#pick_nation_button").hide();if(!is_loaded_game()){$("#start_game_button").hide();pick_nation(null)}}function pick_nation(player_id){if(C_S_RUNNING==client_state())return;if(player_id==null)player_id=client.conn["player_num"];var pplayer=players[player_id];var player_nations={};if(pplayer==null&&!is_ongoing_longturn())return;choosing_player=player_id;var player_name=!is_ongoing_longturn()?pplayer["name"]:simpleStorage.get("username","");if(is_ongoing_longturn()){for(id in players){if(players[id]["name"].indexOf("NewAvailablePlayer")==-1){if(players[id]["nturns_idle"]>=12)return;else player_nations[players[id]["nation"]]=true}}if(Object.keys(players).length==Object.keys(player_nations).length){add_client_message("Unable to join the game, it is full.");return}}var nations_html="<div id='nation_heading'><span>Select nation for "+player_name+":</span> <br>"+"<input id='nation_autocomplete_box' type='text' size='20'>"+"<div id='nation_choice'></div></div> <div id='nation_list'> ";var nation_name_list=[];for(var nation_id in nations){var pnation=nations[nation_id];if(pnation["is_playable"]&&(!is_ongoing_longturn()||!(nation_id in player_nations))){nations_html+="<div class='nation_pickme_line' onclick='select_nation("+nation_id+");'>"+"<div id='nation_"+nation_id+"' class='nation_choice'>"+"<canvas id='pick_flag_"+nation_id+"' width='30' height='20' class='pick_nation_flags'></canvas>"+pnation["adjective"]+"</div></div>";nation_name_list.push(pnation["adjective"])}}nations_html+="</div><div id='nation_style_choices'></div>"+"<div id='nation_legend'></div><div id='select_nation_flag'></div>";var buttons={1:{id:"play",text:"Play this nation!",click:function(){if(chosen_nation!=-1){$("#pick_nation_dialog").dialog("close");if(!is_ongoing_longturn())submit_nation_choice();else submit_nation_choice_ongoing_longturn()}}},2:{id:"customize",text:"Customize this nation",click:function(){show_customize_nation_dialog(player_id)}}};if(is_ongoing_longturn()){buttons["3"]={id:"random",text:"Pick a random nation",click:function(){draw_random_nation_ongoing_longturn(player_nations)}}}$("#pick_nation_dialog").html(nations_html);$("#pick_nation_dialog").attr("title","What Nation Will "+player_name+" Be Ruler Of?");$("#pick_nation_dialog").dialog({closeOnEscape:!is_ongoing_longturn(),bgiframe:true,modal:true,width:is_small_screen()?"99%":"70%",height:$(window).height()-100,buttons:buttons});$("#nation_legend").html("Please choose the nation for "+player_name+".");$("#nation_autocomplete_box").autocomplete({source:nation_name_list,close:function(event,ui){update_nation_selection()}});if(is_small_screen()){$("#select_nation_flag").hide();$("#nation_legend").hide();$("#nation_style_choices").hide();$("#nation_list").width("80%")}if(is_ongoing_longturn()){$(".ui-dialog-titlebar-close").css("display","none");$(".ui-dialog-buttonpane").css("width","100%");$(".ui-dialog-buttonpane").css("padding-right","0em");$(".ui-dialog-buttonpane").css("padding-left","0em");$(".ui-dialog-buttonset").css("width","100%");$("#play").css("float","right");$("#play").css("margin-right","1.4em");$("#customize").css("float","right");$("#random").css("float","left");$("#random").css("margin-left","1.4em")}nation_select_id=setTimeout(update_nation_selection,150);$("#pick_nation_dialog").dialog("open");if(!is_small_screen()){render_city_style_list()}else{$("#nation_autocomplete_box").blur()}for(var nation_id in nations){var pnation=nations[nation_id];if(pnation["is_playable"]&&(!is_ongoing_longturn()||!(nation_id in player_nations))){var flag_canvas=document.getElementById("pick_flag_"+nation_id);var flag_canvas_ctx=flag_canvas.getContext("2d");var tag="f."+pnation["graphic_str"];if(tileset[tag]==null)continue;flag_canvas_ctx.drawImage(sprites[tag],0,0)}}if(chosen_nation!=-1){select_nation(chosen_nation)}}function update_nation_selection(){var nation_name=$("#nation_autocomplete_box").val();if(nation_name==null||nation_name.length==0)return;if(C_S_RUNNING==client_state())return;for(var nation_id in nations){var pnation=nations[nation_id];if(pnation["is_playable"]&&pnation["adjective"].toLowerCase()==nation_name.toLowerCase()){select_nation(nation_id);return}}}function render_city_style_list(){var city_style_html="<b>City Styles:</b><br>";for(var style_id in city_rules){if(style_id>5)continue;var pstyle=city_rules[style_id];city_style_html+="<canvas id='city_style_"+style_id+"' data-style-id='"+style_id+"' width='96' height='72' style='cursor: pointer;'></canvas><br>"+pstyle["rule_name"]+"<br>"}$("#nation_style_choices").html(city_style_html);for(var style_id in city_rules){if(style_id>5)continue;var pstyle=city_rules[style_id];var pcitystyle_canvas=document.getElementById("city_style_"+style_id);if(pcitystyle_canvas==null)continue;var ctx=pcitystyle_canvas.getContext("2d");var tag=pstyle["graphic"]+"_city_4";if(style_id==chosen_style){ctx.fillStyle="#FFFFFF";ctx.fillRect(0,0,96,72)}ctx.drawImage(sprites[tag],0,0);$("#city_style_"+style_id).click(function(){chosen_style=parseFloat($(this).attr("data-style-id"));render_city_style_list()})}}function select_nation(new_nation_id){var pnation=nations[new_nation_id];$("#nation_legend").html(pnation["legend"]);$("#nation_autocomplete_box").val(pnation["adjective"]);$("#nation_"+chosen_nation).css("background-color","transparent");$("#nation_choice").html("Chosen nation: "+pnation["adjective"]);if(!pnation["customized"]){$("#select_nation_flag").html("<img style='nation_flag_choice' src='/images/flags/"+pnation["graphic_str"]+"-web"+get_tileset_file_extention()+"'>")}if(chosen_nation!=new_nation_id&&$("#nation_"+new_nation_id).length>0){$("#nation_"+new_nation_id).get(0).scrollIntoView()}chosen_nation=parseFloat(new_nation_id);$("#nation_"+chosen_nation).css("background-color","#FFFFFF")}function submit_nation_choice_ongoing_longturn(){if(client.conn["player_num"]==null)return;if(chosen_nation!=-1){if(chosen_style!=-1)style=chosen_style;else style=nations[chosen_nation]["style"]}else return;var test_packet={pid:packet_ongoing_longturn_nation_select_req,nation_no:chosen_nation,is_male:true,style:style};send_request(JSON.stringify(test_packet));clearInterval(nation_select_id);setup_window_size()}function submit_nation_choice(){if(chosen_nation==-1||client.conn["player_num"]==null||choosing_player==null||choosing_player<0)return;var pplayer=players[choosing_player];if(pplayer==null)return;var leader_name=pplayer["name"];if(pplayer["flags"].isSet(PLRF_AI)){leader_name=nations[chosen_nation]["leader_name"][0]}var style=nations[chosen_nation]["style"];if(chosen_style!=-1){style=chosen_style}var test_packet={pid:packet_nation_select_req,player_no:choosing_player,nation_no:chosen_nation,is_male:true,name:leader_name,style:style};send_request(JSON.stringify(test_packet));clearInterval(nation_select_id);if(is_longturn()){pregame_start_game()}}function ruledir_from_ruleset_name(ruleset_name,fall_back_dir){switch(ruleset_name){case"Classic ruleset":return"classic";case"Civ2Civ3 ruleset":return"civ2civ3";case"sim30":return"SIM30";case"Multiplayer ruleset":return"multiplayer";case"Webperimental":return"webperimental";case"Multiplayer-Plus ruleset":return"mpplus";case"Multiplayer-Evolution ruleset":return"mp2";case"Avant-garde":return"ag";default:if(!fall_back_dir){fall_back_dir=ruleset_name.toLowerCase().replace(" ","-")}console.log("Don't know the ruleset dir of \""+ruleset_name+'". Guessing "'+fall_back_dir+'".');return fall_back_dir}}function show_ruleset_description_full(){var id="#long_help_dialog";if(ruleset_control==null)return;$(id).remove();$("<div id='long_help_dialog'></div>").appendTo("div#pregame_page");$(id).html(helpdata_format_current_ruleset());$(id).dialog({title:ruleset_control["name"],color:default_dialog_text_color,buttons:{Close:function(){$(id).dialog("close")}},height:$("#pregame_settings").dialog("option","height"),width:"80%"});$(id).css("color",default_dialog_text_color)}function pregame_settings(){var id="#pregame_settings";$(id).remove();$("<div id='pregame_settings'></div>").appendTo("div#pregame_page");var dhtml="<div id='pregame_settings_tabs'>"+"   <ul>"+"     <li><a href='#pregame_settings_tabs-1'>Main</a></li>"+"     <li><a href='#pregame_settings_tabs-2'>Other</a></li>"+"   </ul>"+"<div id='pregame_settings_tabs-1'><table id='settings_table'> "+"<tr title='Ruleset version'><td>Ruleset:</td>"+"<td><select name='ruleset' id='ruleset'>"+"<option value='mp2-caravel'>Multiplayer 2.3 Caravel</option>"+"<option value='mp2-brava'>Multiplayer 2.2 Brava</option>"+"<option value='mp2b-occ'>MP 2.2 One City Challenge</option>"+"<option value='mp2b-desert'>MP 2.2 Desert</option>"+"<option value='ag'>Multiplayer 2.1 Avant-garde</option>"+"<option value='mpplus'>Multiplayer+ 1.1</option>"+"<option value='SIM30'>SIM30</option>"+"<option value='classic'>Classic</option>"+"<option value='civ2civ3'>Civ2Civ3</option>"+"</select><a id='ruleset_description'></a></td></tr>"+"<tr title='Set metaserver info line'><td>Game title:</td>"+"<td><input type='text' name='metamessage' id='metamessage' size='28' maxlength='42'></td></tr>"+"<tr title='Enables music'><td>Music:</td>"+"<td><input type='checkbox' name='music_setting' id='music_setting'>Play Music</td></tr>"+"<tr class='not_pbem' title='Total number of players (including AI players)'><td>Number of Players (including AI):</td>"+"<td><input type='number' name='aifill' id='aifill' size='4' length='3' min='0' max='32' step='1'></td></tr>"+"<tr><td>Timeout:</td><td><input type='number' name='timeout' id='timeout' size='4' length='3' min='30' max='3600' step='1'></td></tr>"+"<tr class='not_pbem' title='Creates a private game where players need to know this password in order to join.'><td>Password for private game:</td>"+"<td><input type='text' name='password' id='password' size='10' length='10'></td></tr>"+"<tr title='Map size (in thousands of tiles)'><td>Map size:</td>"+"<td><input type='number' name='mapsize' id='mapsize' size='4' length='3' min='1' max='10' step='1'></td></tr>"+"<tr class='not_pbem' title='This setting sets the skill-level of the AI players'><td>AI skill level:</td>"+"<td><select name='skill_level' id='skill_level'>"+"<option value='1'>Handicapped</option>"+"<option value='2'>Novice</option>"+"<option value='3'>Easy</option>"+"<option value='4'>Normal</option>"+"<option value='5'>Hard</option>"+"<option value='6'>Cheating</option>"+"</select></td></tr>"+"<tr class='not_pbem' title='This setting sets the world general tempeture, changing the types of tiles.'><td>Temperature</td>"+"<td><select name='temperature' id='temperature'>"+"<option value='100'>Very Hot</option>"+"<option value='70'>Hot</option>"+"<option value='50'>Normal</option>"+"<option value='30'>Cold</option>"+"<option value='0'>Very Cold</option>"+"</select></td></tr>"+"<tr title='Number of initial techs per player'><td>Tech level:</td>"+"<td><input type='number' name='techlevel' id='techlevel' size='3' length='3' min='0' max='100' step='10'></td></tr>"+"<tr title='This setting gives the approximate percentage of the map that will be made into land.'><td>Landmass:</td>"+"<td><input type='number' name='landmass' id='landmass' size='3' length='3' min='15' max='85' step='10'></td></tr>"+"<tr title='Amount of special resource squares'><td>Specials:</td>"+"<td><input type='number' name='specials' id='specials' size='4' length='4' min='0' max='1000' step='50'></td></tr>"+"<tr title='Minimum distance between cities'><td>City mindist :</td>"+"<td><input type='number' name='citymindist' id='citymindist' size='4' length='4' min='1' max='9' step='1'></td></tr>"+"<tr title='The game will end at the end of the given turn.'><td>End turn:</td>"+"<td><input type='number' name='endturn' id='endturn' size='4' length='4' min='0' max='32767' step='1'></td></tr>"+"<tr class='not_pbem' title='Enables score graphs for all players, showing score, population, techs and more."+" This will lead to information leakage about other players.'><td>Score graphs</td>"+"<td><input type='checkbox' name='scorelog_setting' id='scorelog_setting' checked>Enable score graphs</td></tr>"+"<tr id='killstack_area'><td id='killstack_label'></td>"+"<td><input type='checkbox' id='killstack_setting'>Enable killstack</td></tr>"+"<tr id='selct_multiple_units_area'><td id='select_multiple_units_label'></td>"+"<td><input type='checkbox' id='select_multiple_units_setting'>Right-click selects units</td></tr>"+"<tr title='Method used to generate map'><td>Map generator:</td>"+"<td><select name='generator' id='generator'>"+"<option value='RANDOM'>Fully random height</option>"+"<option value='FRACTAL'>Pseudo-fractal height</option>"+"<option value='ISLAND'>Island-based</option>"+"<option value='FAIR'>Fair islands</option>"+"<option value='FRACTURE'>Fracture map</option>"+"</select></td></tr>"+"</table><br>"+"<span id='settings_info'><i>Games can be customized in many more ways. "+"Type /help in the command line for more info.</i></span></div>"+"<div id='pregame_settings_tabs-2'>"+"<table id='settings_table'>"+"<tr title='Font on map'><td>Font on map:</td>"+"<td><input type='text' name='mapview_font' id='mapview_font' size='28' maxlength='42' value='16px Helvetica, sans serif'></td></tr>"+"<tr id='speech_enabled'><td id='speech_label'></td>"+"<td><input type='checkbox' id='speech_setting'>Enable speech audio messages</td></tr>"+"<tr id='voice_row'><td id='voice_label'></td>"+"<td><select name='voice' id='voice'></select></td></tr>"+"</table>"+"</div>"+"<div id='pregame_settings_tabs-3'></div>"+"<div id='pregame_settings_tabs-4'></div>"+"<div id='pregame_settings_tabs-5'></div>";$(id).html(dhtml);$(id).attr("title","Game Settings");$(id).dialog({bgiframe:true,color:default_dialog_text_color,modal:true,width:is_small_screen()?"98%":"60%",height:is_small_screen()?$(window).height()-40:$(window).height()-250,buttons:{Ok:function(){$("#pregame_settings").dialog("close");if(benchmark_start>0){$(window).unbind("beforeunload");alert("Reloading game to setup new graphics quality.");location.reload()}}}});$("#pregame_settings_tabs").tabs();if(game_info!=null){$("#aifill").val(game_info["aifill"]);$("#timeout").val(game_info["timeout"]);$("#skill_level").val(ai_skill_level)}if(server_settings["techlevel"]!=null&&server_settings["techlevel"]["val"]!=null){$("#techlevel").val(server_settings["techlevel"]["val"])}if(server_settings["landmass"]!=null&&server_settings["landmass"]["val"]!=null){$("#landmass").val(server_settings["landmass"]["val"])}if(server_settings["globalwarming_percent"]!=null&&server_settings["globalwarming_percent"]["val"]!=null){$("#global_warming_percent").val(server_settings["globalwarming_percent"]["val"])}if(server_settings["globalwarming"]!=null&&server_settings["globalwarming"]["val"]!=null){$("#global_warming").val(server_settings["globalwarming"]["val"])}if(server_settings["nuclearwinter_percent"]!=null&&server_settings["nuclearwinter_percent"]["val"]!=null){$("#nuclear_winter_percent").val(server_settings["nuclearwinter_percent"]["val"])}if(server_settings["nuclearwinter"]!=null&&server_settings["nuclearwinter"]["val"]!=null){$("#nuclear_winter").val(server_settings["nuclearwinter"]["val"])}if(server_settings["specials"]!=null&&server_settings["specials"]["val"]!=null){$("#specials").val(server_settings["specials"]["val"])}if(server_settings["citymindist"]!=null&&server_settings["citymindist"]["val"]!=null){$("#citymindist").val(server_settings["citymindist"]["val"])}if(server_settings["endturn"]!=null&&server_settings["endturn"]["val"]!=null){$("#endturn").val(server_settings["endturn"]["val"])}if(server_settings["size"]!=null&&server_settings["size"]["val"]!=null){$("#mapsize").val(server_settings["size"]["val"])}if(server_settings["killstack"]!=null&&server_settings["killstack"]["val"]!=null){$("#killstack_setting").prop("checked",server_settings["killstack"]["val"]);$("#killstack_area").prop("title",server_settings["killstack"]["extra_help"]);$("#killstack_label").prop("innerHTML",server_settings["killstack"]["short_help"])}if(server_settings["generator"]!=null&&server_settings["generator"]["val"]!=null){$("#generator").val(server_settings["generator"]["support_names"][server_settings["generator"]["val"]])}if(server_settings["temperature"]!=null&&server_settings["temperature"]["val"]!=null){$("#temperature").val(server_settings["temperature"]["name"][server_settings["temperature"]["val"]])}$("#select_multiple_units_setting").prop("checked",map_select_setting_enabled);$("#select_multiple_units_area").prop("title","Select multiple units with right-click and drag");$("#select_multiple_units_label").prop("innerHTML","Select multiple units with right-click and drag");if(is_speech_supported()){$("#speech_setting").prop("checked",speech_enabled);$("#speech_label").prop("innerHTML","Speech messages:");$("#voice_label").prop("innerHTML","Voice:")}else{$("#speech_label").prop("innerHTML","Speech messages:");$("#speech_setting").parent().html("Speech Synthesis API is not supported or enabled in your browser.")}if(server_settings["metamessage"]!=null&&server_settings["metamessage"]["val"]!=null){$("#metamessage").val(server_settings["metamessage"]["val"])}if(ruleset_control!=null){$("#ruleset").val(ruledir_from_ruleset_name(ruleset_control["name"],""))}if(scenario_info!=null&&scenario_info["is_scenario"]){$("#ruleset").prop("disabled",scenario_info["ruleset_locked"])}$(id).dialog("open");$(id).css("color",default_dialog_text_color);$("#aifill").change(function(){if(parseInt($("#aifill").val())<=12){send_message("/set aifill "+$("#aifill").val())}});$("#metamessage").change(function(){if(game_type=="singleplayer"){if($("#metamessage").val().includes("Private"))send_message("/metamessage "+$("#metamessage").val().replace(/Private/gi,"Closed"))}else{send_message("/metamessage "+$("#metamessage").val())}metamessage_changed=true});$("#metamessage").bind("keyup blur",function(){var clean_text=$(this).val().replace(/[^a-zA-Z\s\-]/g,"");if($(this).val()!=clean_text){$(this).val(clean_text)}});$("#mapview_font").change(function(){canvas_text_font=$("#mapview_font").val()});$("#mapsize").change(function(){var mapsize=parseFloat($("#mapsize").val());if(mapsize<=10){send_message("/set size "+$("#mapsize").val())}});$("#timeout").change(function(){send_message("/set timeout "+$("#timeout").val())});$("#techlevel").change(function(){send_message("/set techlevel "+$("#techlevel").val())});$("#specials").change(function(){send_message("/set specials "+$("#specials").val())});$("#landmass").change(function(){send_message("/set landmass "+$("#landmass").val())});$("#global_warming_percent").change(function(){send_message("/set globalwarming_percent "+$("#global_warming_percent").val())});$("#global_warming").change(function(){send_message("/set globalwarming "+$("#global_warming").val())});$("#nuclear_winter_percent").change(function(){send_message("/set nuclearwinter_percent "+$("#nuclear_winter_percent").val())});$("#nuclear_winter").change(function(){send_message("/set nuclearwinter "+$("#nuclear_winter").val())});$("#citymindist").change(function(){send_message("/set citymindist "+$("#citymindist").val())});$("#endturn").change(function(){send_message("/set endturn "+$("#endturn").val())});$("#generator").change(function(){send_message("/set generator "+$("#generator").val())});$("#temperature").change(function(){send_message("/set temperature "+$("#temperature").val())});$("#ruleset_description").html(" <span title='Ruleset summary' style='color:#9cd; cursor:help'><u>Rules Help</u></span>");$("#ruleset_description").click(show_ruleset_description_full);$("#ruleset").change(function(){change_ruleset($("#ruleset").val())});$("#password").change(function(){swal({title:"Really set game password?",text:"Setting a password on this game means that other players can not join this game "+"unless they know this password. In multiplayer games, be sure to ask the other players "+"about setting a password.",type:"warning",showCancelButton:true,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, set game password",closeOnConfirm:true},function(){var pwd_packet={pid:packet_authentication_reply,password:$("#password").val()};send_request(JSON.stringify(pwd_packet));if(game_type=="singleplayer")send_message("/metamessage Password-protected game");else if(game_type=="multiplayer")send_message("/metamessage Private password-protected game");metamessage_changed=true;$("#metamessage").prop("readonly",true);$("#metamessage_setting").prop("readonly",true);$("#password").prop("readonly",true)});setSwalTheme()});$("#skill_level").change(function(){ai_skill_level=parseFloat($("#skill_level").val());if(ai_skill_level==1){send_message("/handicapped")}else if(ai_skill_level==2){send_message("/novice")}else if(ai_skill_level==3){send_message("/easy")}else if(ai_skill_level==4){send_message("/normal")}else if(ai_skill_level==5){send_message("/hard")}else if(ai_skill_level==6){send_message("/cheating")}});$("#music_setting").prop("checked",audio_enabled==true);$("#music_setting").change(function(){audio_enabled=!audio_enabled;if(audio_enabled){if(!audio.source.src){if(!supports_mp3()){audio.load("/music/"+music_list[Math.floor(Math.random()*music_list.length)]+".ogg")}else{audio.load("/music/"+music_list[Math.floor(Math.random()*music_list.length)]+".mp3")}}audio.play()}else{audio.pause()}});$("#scorelog_setting").change(function(){var scorelog_enabled=$("#scorelog_setting").prop("checked");if(scorelog_enabled){send_message("/set scorelog enabled")}else{send_message("/set scorelog disabled")}});$("#killstack_setting").change(function(){if($("#killstack_setting").prop("checked")){send_message("/set killstack enabled")}else{send_message("/set killstack disabled")}});$("#select_multiple_units_setting").change(function(){if($("#select_multiple_units_setting").prop("checked")){map_select_setting_enabled=true}else{map_select_setting_enabled=false}});$("#speech_setting").change(function(){if($("#speech_setting").prop("checked")){speech_enabled=true;speak_unfiltered("Speech enabled.")}else{speech_enabled=false}});$("#voice").change(function(){voice=$("#voice").val()});if(is_speech_supported()){load_voices();window.speechSynthesis.onvoiceschanged=function(e){load_voices()}}if(is_pbem()){$(".not_pbem").hide()}$("#settings_table").tooltip();if(is_touch_device()||is_small_screen()){$("#metamessage").blur()}$("#show_voice_commands").click(function(){show_dialog_message("Voice commands","<b>Voice command - Explanation:</b> <br>"+"T, Turn - Turn Done<br>"+"Y, Yes, O, Ok   - Yes<br>"+"No - No<br>"+"B, Build, City   - Build city<br>"+"X - Explore<br>"+"I, Irrigation  - Irrigation<br>"+"Road  - Road<br>"+"A, Auto  - Auto settlers<br>"+"F, Fortify  - Fortify<br>"+"M, Mine  - Mine<br>"+"Wait  - Wait<br>"+"U, Up  - Move unit up<br>"+"D, Down  - Down<br>"+"L, Left  - Left<br>"+"R, Right  - Right<br>"+"N, North  - North<br>"+"S, South  - South<br>"+"E, East  - East<br>"+"W, West  - West<br>"+"North West, North East, South East, South West<br>")})}function change_ruleset(to){send_message("/rulesetdir "+to);send_message("/set nationset all");if(chosen_nation!=-1){swal("Ruleset changed. You need to select your nation again.");setSwalTheme()}}function show_intro_dialog(title,message){if($.getUrlVar("autostart")=="true"){autostart=true;return}$("#dialog").remove();$("<div id='dialog'></div>").appendTo("div#game_page");var intro_html=message+"<br><br><table><tr><td>Player name:</td><td><input id='username_req' spellcheck='false' type='text' size='25' maxlength='31'></td></tr>"+"<tr id='password_row' style='display:none;'><td>Password:</td><td id='password_td'></td></tr></table>"+" <br><br><span id='username_validation_result' style='display:none;'></span><br><br>";$("#dialog").html(intro_html);var stored_username=simpleStorage.get("username","");if(stored_username!=null&&stored_username!=false){$("#username_req").val(stored_username)}var stored_password=simpleStorage.get("password","");if(stored_password!=null&&stored_password!=false){$("#password_row").show();$("#password_td").html("<input id='password_req' type='password' size='25' maxlength='200'>");$("#password_req").val(stored_password)}var join_game_customize_text="";var join_game_title_text="";if($.getUrlVar("action")=="load"){join_game_customize_text="Load games";join_game_title_text="Load saved game or scenario"}else if($.getUrlVar("action")=="multi"){join_game_customize_text="Join Game";join_game_title_text="Join this active game"}else{join_game_customize_text="Start";join_game_title_text="Go to Game Launch area."}$("#dialog").attr("title",title);$("#dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"90%":"60%",beforeClose:function(event,ui){if(dialog_close_trigger!="button"){if(validate_username()){network_init();if(!is_touch_device())$("#pregame_text_input").focus();return true}else{return false}}},buttons:[{text:join_game_customize_text,title:join_game_title_text,click:function(){if(is_touch_device()||is_small_screen()){BigScreen.toggle()}dialog_close_trigger="button";validate_username_callback()},icons:{primary:"ui-icon-gear"}},{text:"New user account",title:"An account is necessary if you want to save games or participate in Longturn multiplayer.",click:function(){show_new_user_account_dialog()},icons:{primary:"ui-icon-person"}}]});var stored_username=simpleStorage.get("username","");var stored_password=simpleStorage.get("password","");if(stored_username!=null&&stored_username!=false&&stored_password!=null&&stored_password!=false){$(".ui-dialog-buttonset button").last().button("disable")}if(is_small_screen()){$("#freeciv_logo").remove();$("#pregame_message_area").css("width","73%");$("#observe_button").remove()}$("#dialog").dialog("open");$("#dialog").keyup(function(e){if(e.keyCode==13){dialog_close_trigger="button";autostart=true;validate_username_callback()}});if($.getUrlVar("action")=="observe"){$(".ui-dialog-buttonset button").first().button("option","label","Observe Game");$(".ui-dialog-buttonset button").first().next().remove()}blur_input_on_touchdevice()}function show_longturn_intro_dialog(){var title="Welcome to Freeciv: One Turn per Day!";var message="<br>This is a Freeciv: One Turn per Day game, which is a Freeciv multiplayer game "+"where the turns are 23 hours each, so players logs in once every day to do their turn. This format allows for more players to "+"play at once, more time to strategize, more time to coordinate with other players, and less rushing to get things done, which can "+"occur in a standard multi-player Freeciv game. It takes a lot longer to play a game, about 2 to 6 months, but you can play it just a "+"little bit every day. <br><br> "+"Please be polite to the other players and don't cheat. "+"You will get to play for turn immediately after signing up, and your next turn tomorrow. Please join the game only if you are interested in playing one turn every day. "+"Players who are idle for more than 12 turns can be replaced by new players. This means that idle players will continually be replaced by new players.<br><br>"+"Joining this game requires signing in with a player name and validated Google Account."+"<br><br><br><table><tr><td>Player name:</td><td><input id='username_req' type='text' size='25' maxlength='31'></td></tr></table>"+" <br><br><span id='username_validation_result' style='display:none;'></span><br>"+"<div id='fc-signin2'></div><br><br><br><small>(Please disable adblockers, then reload the page, for Google login button to work)</small>";if(is_small_screen()){message="Welcome to this Freeciv: One Turn per Day game! Enter your player name:"+"<br><br><table><tr><td>Player name:</td><td><input id='username_req' type='text' size='25' maxlength='31'></td></tr></table>"+" <br><br><span id='username_validation_result' style='display:none;'></span><br><br>"+"<div id='fc-signin2'></div><br>"}$("#dialog").remove();$("<div id='dialog'></div>").appendTo("div#game_page");$("#dialog").html(message);var stored_username=simpleStorage.get("username","");if(stored_username!=null&&stored_username!=false){$("#username_req").val(stored_username)}$("#dialog").attr("title",title);$("#dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"90%":"60%",beforeClose:function(event,ui){if(dialog_close_trigger!="button"){if(validate_username()){network_init();if(!is_touch_device())$("#pregame_text_input").focus();return true}else{return false}}},buttons:[{text:"Join game",click:function(){if(is_touch_device()||is_small_screen()){BigScreen.toggle()}dialog_close_trigger="button";validate_username_callback()},icons:{primary:"ui-icon-gear"}}]});if(is_small_screen()){$("#freeciv_logo").remove();$("#pregame_message_area").css("width","73%");$("#observe_button").remove()}$("#dialog").dialog("open");blur_input_on_touchdevice();google_user_token=null;gapi.signin2.render("fc-signin2",{scope:"profile email",width:240,height:50,onsuccess:google_signin_on_success,onfailure:google_signin_on_failure})}function validate_username_callback(){var check_username=$("#username_req").val();$.ajax({type:"POST",url:freeciv_api_server_url+"/validate_user?userstring="+check_username,success:function(data,textStatus,request){if(data=="user_does_not_exist"){if(validate_username()){network_init();if(!is_touch_device())$("#pregame_text_input").focus();$("#dialog").dialog("close");$("#password_req").val("");simpleStorage.set("password","")}}else{username=$("#username_req").val().trim();var password=$("#password_req").val();if(password==null){var stored_password=simpleStorage.get("password","");if(stored_password!=null&&stored_password!=false){password=stored_password}}if(password!=null&&password.length>2){var shaObj=new jsSHA("SHA-512","TEXT");shaObj.update(password);var sha_password=encodeURIComponent(shaObj.getHash("HEX"));$.ajax({type:"POST",url:freeciv_api_server_url+"/login_user?username="+encodeURIComponent(username)+"&sha_password="+sha_password,success:function(data,textStatus,request){if(data!=null&&data=="OK"){simpleStorage.set("username",username);simpleStorage.set("password",password);if(validate_username()){network_init();if(!is_touch_device())$("#pregame_text_input").focus();$("#dialog").dialog("close")}logged_in_with_password=true}else{$("#username_validation_result").html("Incorrect username or password. Please try again!");$("#username_validation_result").show()}},error:function(request,textStatus,errorThrown){swal("Login user failed.");setSwalTheme()}})}else{$("#username_validation_result").html("Player name already in use. Try a different player name, or enter the username and password of your account,<br> or create a new user account. <a class='pwd_reset' href='#' style='color: #bbbbbb;'>Forgot password?</a>");$("#username_validation_result").show()}$("#password_row").show();$("#password_req").focus();$("#password_td").html("<input id='password_req' type='password' size='25' maxlength='200'>")}},error:function(request,textStatus,errorThrown){console.log("For programmers and server admins: "+"Please check if the meta server is running properly.");swal("Error. Please try again with a different name.");setSwalTheme()}})}function show_new_user_account_dialog(gametype){var title="New user account";var message="Create a new WebCiv user account with information about yourself:<br><br>"+"<table><tr><td>Username:</td><td><input id='username' type='text' size='25' maxlength='30' onkeyup='return forceLower(this);'></td></tr>"+"<tr><td>Email:</td><td><input id='email' type='email' size='25' maxlength='64' ></td></tr>"+"<tr><td>Password:</td><td><input id='password' type='password' size='25'></td></tr>"+"<tr><td>Confim password:</td><td><input id='confirm_password' type='password' size='25'></td></tr></table><br>"+"<div id='username_validation_result' style='display:none;'></div><br>"+"Remember your username and password, since you will need this to log in later.<br><br>"+"<u><i>You <b>can't recover</b> a lost password. Write it down or accept the 99% chance <b>you will lose your account</u>!</b></i>"+(captcha_site_key!=""?"Click to accept captcha to show that you are real human player:<br>":"")+"<div id='captcha_element'></div><br><br>"+"<div><small><ul><li>It is free and safe to create a new account on Freeciv.</li>"+"<li>A user account allows you to save and load games.</li>"+"<li>Other players can use your username to start Play-by-email games with you.</li>"+"<li>You will NEVER receive spam. Your e-mail address will never be shared. Your password is stored securely as a secure hash <b>no one can recover</b>.</li>"+"<li>You can <a href='#' onclick='javascript:close_pbem_account();'>cancel</a> your account at any time if you want.</li>"+"</ul></small></div>";$("#dialog").remove();$("<div id='dialog'></div>").appendTo("div#game_page");$("#dialog").html(message);$("#dialog").attr("title",title);$("#dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"90%":"60%",buttons:{Cancel:function(){if(gametype=="pbem"){show_pbem_dialog()}else{init_common_intro_dialog()}},"Signup new user":function(){if(gametype=="pbem"){create_new_freeciv_user_account_request("pbem")}else{create_new_freeciv_user_account_request("normal")}}}});$("#dialog").dialog("open");if(captcha_site_key!=""){if(grecaptcha!==undefined&&grecaptcha!=null){$("#captcha_element").html("");grecaptcha.render("captcha_element",{sitekey:captcha_site_key})}else{swal("Captcha not available. This could be caused by a browser plugin.");setSwalTheme()}}$("#username").blur(function(){$.ajax({type:"POST",url:"/validate_user?userstring="+$("#username").val(),success:function(data,textStatus,request){if(data!="user_does_not_exist"){$("#username_validation_result").html("The username is already taken. Please choose another username.");$("#username_validation_result").show();$(".ui-dialog-buttonset button").button("disable")}else{$("#email").blur(function(){$.ajax({type:"POST",url:"/validate_user?userstring="+$("#email").val(),success:function(data,textStatus,request){if(data=="invitation"){$("#username_validation_result").html("");$("#username_validation_result").hide();$(".ui-dialog-buttonset button").button("enable")}else{$("#username_validation_result").html("The e-mail is already registered. Please choose another.");$("#username_validation_result").show();$(".ui-dialog-buttonset button").button("disable")}}})})}}})})}function create_new_freeciv_user_account_request(action_type){username=$("#username").val().trim().toLowerCase();var password=$("#password").val().trim();var confirm_password=$("#confirm_password").val().trim();var email=$("#email").val().trim();var captcha=$("#g-recaptcha-response").val();$("#username_validation_result").show();if(!is_username_valid_show(username)){return false}if(!validateEmail(email)){$("#username_validation_result").html("Invalid email address.");return false}else if(password==null||password.length<=2){$("#username_validation_result").html("Your password is too short.");return false}else if(password!=confirm_password){$("#username_validation_result").html("The passwords do not match.");return false}else if(captcha_site_key!=""&&captcha==null){$("#username_validation_result").html("Please fill in the captcha. You might have to disable some plugins to see the captcha.");return false}$("#username_validation_result").html("");$("#username_validation_result").hide();$("#dialog").parent().hide();var shaObj=new jsSHA("SHA-512","TEXT");shaObj.update(password);var sha_password=encodeURIComponent(shaObj.getHash("HEX"));$.ajax({type:"POST",url:"/create_pbem_user?username="+encodeURIComponent(username)+"&email="+encodeURIComponent(email)+"&password="+sha_password+"&captcha="+encodeURIComponent(captcha),success:function(data,textStatus,request){simpleStorage.set("username",username);simpleStorage.set("password",password);if(action_type=="pbem"){challenge_pbem_player_dialog("New account created. Your username is: "+username+". You can now start a new PBEM game or wait for an invitation for another player.")}else{$("#dialog").dialog("close");network_init();logged_in_with_password=true}},error:function(request,textStatus,errorThrown){$("#dialog").parent().show();swal("Creating new user failed.");setSwalTheme()}})}function show_customize_nation_dialog(player_id){if(chosen_nation==-1||client.conn["player_num"]==null||choosing_player==null||choosing_player<0)return;var pnation=nations[chosen_nation];$("#dialog").remove();$("<div id='dialog'></div>").appendTo("div#game_page");var message="<br>New nation name: <input id='new_nation_adjective' type='text' size='30' value='"+pnation["adjective"]+"'><br><br>"+"Upload new flag: <input type='file' id='newFlagFileInput'><br><br>"+"For best results scale the image to 30 x 20 pixels before uploading. <br><br>"+"(Note: the customized nation and flag will only be active during the current game session and will not be visible to other players.)";$("#dialog").html(message);$("#dialog").attr("title","Customize nation: "+pnation["adjective"]);$("#dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"90%":"50%",buttons:{Cancel:function(){$("#dialog").dialog("close");pick_nation(player_id)},OK:function(){handle_customized_nation(player_id)}}});$("#dialog").dialog("open")}function handle_customized_nation(player_id){var new_nation_name=$("#new_nation_adjective").val();nations[chosen_nation]["adjective"]=new_nation_name;var fileInput=document.getElementById("newFlagFileInput");var file=fileInput.files[0];if(file==null){swal("Please upload a image file!");setSwalTheme();return}if(!window.FileReader){swal("Uploading files not supported");setSwalTheme();return}var extension=file.name.substring(file.name.lastIndexOf("."));console.log("New flag: "+file.type+" with extention "+extension);if(extension==".png"||extension==".bmp"||extension==".jpg"||extension==".jpeg"||extension==".JPG"){var reader=new FileReader;reader.onload=function(e){handle_new_flag(reader.result,player_id)};reader.readAsDataURL(file)}else{$.unblockUI();swal("Image file "+file.name+"  not supported: "+file.type);setSwalTheme()}}function handle_new_flag(image_data,player_id){var pnation=nations[chosen_nation];var flag_tag="f."+pnation["graphic_str"];var shield_tag="f.shield."+pnation["graphic_str"];var new_flag_canvas=document.createElement("canvas");new_flag_canvas.width=sprites[flag_tag].width;new_flag_canvas.height=sprites[flag_tag].height;sprites[flag_tag]=new_flag_canvas;var ctx_flag=new_flag_canvas.getContext("2d");var new_shield_canvas=document.createElement("canvas");new_shield_canvas.width=sprites[shield_tag].width;new_shield_canvas.height=sprites[shield_tag].height;sprites[shield_tag]=new_shield_canvas;var ctx_shield=new_shield_canvas.getContext("2d");var img=new Image;img.onload=function(){ctx_flag.drawImage(img,0,0,this.width,this.height,0,0,new_flag_canvas.width,new_flag_canvas.height);ctx_shield.drawImage(img,0,0,this.width,this.height,0,0,new_shield_canvas.width,new_shield_canvas.height);$("#dialog").dialog("close");pick_nation(player_id)};img.src=image_data;nations[chosen_nation]["customized"]=true}function onloadCallback(){}function forgot_pbem_password(){var title="Forgot your password?";var message="Please enter your e-mail address to reset your password. Also complete the captcha. The new password will be sent to you by e-mail.<br><br>"+"<table><tr><td>E-mail address:</td><td><input id='email_reset' type='text' size='25'></td></tr>"+"</table><br><br>"+"<div id='captcha_element'></div>"+"<br><br>";$("#pwd_dialog").remove();$("<div id='pwd_dialog'></div>").appendTo("div#game_page");$("#pwd_dialog").html(message);$("#pwd_dialog").attr("title",title);$("#pwd_dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"90%":"40%",buttons:{Cancel:function(){$("#pwd_dialog").remove()},"Send password":function(){password_reset_count++;if(password_reset_count>3){swal("Unable to reset password.");setSwalTheme();return}var reset_email=$("#email_reset").val();var captcha=$("#g-recaptcha-response").val();if(reset_email==null||reset_email.length==0){setSwalTheme();swal("Please fill in e-mail.");return}if(captcha_site_key!=""&&(captcha==null||captcha.length==0)){swal("Please fill complete the captcha.");setSwalTheme();return}$.ajax({type:"POST",url:"/reset_password?email="+reset_email+"&captcha="+encodeURIComponent(captcha),success:function(data,textStatus,request){swal("Password reset. Please check your email.");$("#pwd_dialog").remove()},error:function(request,textStatus,errorThrown){swal("Error, password was not reset.");setSwalTheme()}})}}});$("#pwd_dialog").dialog("open");if(captcha_site_key!=""){if(grecaptcha!==undefined&&grecaptcha!=null){$("#captcha_element").html("");grecaptcha.render("captcha_element",{sitekey:captcha_site_key})}else{swal("Captcha not available. This could be caused by a browser plugin.");setSwalTheme()}}}function google_signin_on_success(googleUser){var id_token=googleUser.getAuthResponse().id_token;username=$("#username_req").val().trim().toLowerCase();if(!validate_username()){return}var xhr=new XMLHttpRequest;xhr.open("POST","/token_signin");xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.onload=function(){if(xhr.responseText=="OK"){google_user_token=id_token;simpleStorage.set("username",username);$("#dialog").dialog("close")}else if(xhr.responseText=="Email not verified"){swal("Login failed. E-mail not verified.");setSwalTheme()}else{swal("Login failed.");setSwalTheme()}};xhr.send("idtoken="+id_token+"&username="+username)}function google_signin_on_failure(error){if(error["error"]=="popup_closed_by_user")return;swal("Unable to sign in with Google: "+JSON.stringify(error));setSwalTheme();console.error("Unable to sign in with Google: "+JSON.stringify(error))}var s_tax=null;var s_lux=null;var s_sci=null;var tax;var sci;var lux;var maxrate=80;var freeze=false;var government_list;var current_government;var rate_updater_interval;var rates_changed=false;var sliders_adjusted=false;function show_tax_rates_dialog(){sliders_adjusted=false;if(client_is_observer())return;var id="#rates_dialog";$(id).remove();if(active_city){close_city_dialog_trigger();active_city=null}$("<div id='rates_dialog'></div>").appendTo("div#game_page");var panel_html="<input id='show_hp' type='checkbox' class='css-checkbox' title='Show hit points' name='chHP' value='false' onclick='toggle_empire_show_hitpoints();'>"+"<label for='show_hp' name='show_hp_lbl' class='css-label dark-check-red'>HP</label>&ensp;";var dhtml="<h2>Disburse taxes to:</h2>"+"<form name='rates'><table border='0' style='color: #ffffff;'>"+"<tr> <td>Treasury:</td>"+"<td> <div class='slider' id='slider-tax' tabIndex='1'></div></td>"+"<td><div id='tax_result' class='gold_text' style='float:left;'></div></td>"+"<td> <INPUT id='lock_gold' class='css-checkbox' TYPE='CHECKBOX' NAME='lock'>"+"<label for='lock_gold' name='lock_gold_lbl' class='css-label dark-check-orange'>Lock</label></td></tr>"+"<tr> <td>Luxury:</td><td><div class='slider' id='slider-lux' tabIndex='1'></div></td>"+"<td> <div id='lux_result' class='lux_text' style='float:left;'></div></td>"+"<td><INPUT id='lock_lux' class='css-checkbox' TYPE='CHECKBOX' NAME='lock'>"+"<label for='lock_lux' name='lock_lux_lbl' class='css-label dark-check-purple'>Lock</label></td></tr>"+"<tr><td>Science:</td><td><div class='sci_handle slider' id='slider-sci' tabIndex='1'></div></td>"+"<td><div id='sci_result' class='sci_text' style='float:left;'></div></td>"+"<td><INPUT id='lock_sci' class='css-checkbox' TYPE='CHECKBOX' NAME='lock'>"+"<label for='lock_sci' name='lock_sci_lbl' class='css-label dark-check-cyan'>Lock</label></td></tr>"+"</table></form>"+"<table style='margin:10px; text-align:right;'>"+"<tr><td>Net Income: </td><td><span class='gold_text' id='income_info'></span></td></tr>"+"<tr><td>Research:  </td> <td><span class='sci_text' id='bulbs_info'></span></td></tr>"+"</table>"+"<div id='max_tax_rate' style='text-align:center; margin:10px;'></div>";$(id).html(dhtml);$(id).attr("title","Tax rates");$(id).dialog({bgiframe:true,modal:true,dialogClass:"rate_slider",width:is_small_screen()?"90%":"40%",buttons:{"Done (𝗪)":function(){submit_player_rates();close_rates_dialog()}}});$(id).dialog("widget").keydown(tax_rate_key_listener);$(id).css("color",default_dialog_text_color);update_rates_dialog();$(".ui-dialog-titlebar-close").hide();freeze=true;rate_updater_interval=setInterval(rate_refresh,500)}function tax_rate_key_listener(ev){if($("input:focus").length>0||!keyboard_input)return;if(C_S_RUNNING!=client_state())return;var keyboard_key=String.fromCharCode(ev.keyCode).toUpperCase();var key_code=ev.keyCode;switch(key_code){case 13:ev.stopPropagation();clearInterval(rate_updater_interval);rate_output_update=null;$("#rates_dialog").dialog("close");$("#rates_dialog").remove();break}switch(keyboard_key){case"W":ev.stopPropagation();clearInterval(rate_updater_interval);rate_output_update=null;$("#rates_dialog").dialog("close");$("#rates_dialog").remove();break}}function rate_refresh(){if(rates_changed){rates_changed=false;submit_player_rates()}update_net_income();update_net_bulbs();if(!sliders_adjusted){$("#slider-tax").children().next().next().css("background-image","url('/images/slider_gold.png')");$("#slider-lux").children().next().next().css("background-image","url('/images/slider_lux.png')");$("#slider-sci").children().next().next().css("background-image","url('/images/slider_sci.png')")}}function update_rates_dialog(){if(client_is_observer()||client.conn.playing==null)return;maxrate=government_max_rate(client.conn.playing["government"]);$("#slider-tax").html("<input class='slider-input' id='slider-tax-input' name='slider-tax-input'/>");$("#slider-lux").html("<input class='slider-input' id='slider-lux-input' name='slider-lux-input'/>");$("#slider-sci").html("<input class='slider-input' id='slider-sci-input' name='slider-sci-input'/>");create_rates_dialog(client.conn.playing["tax"],client.conn.playing["luxury"],client.conn.playing["science"],maxrate);var govt=governments[client.conn.playing["government"]];$("#max_tax_rate").html("<i style='color:#a88'>"+govt["name"]+" max rate: &nbsp;</i>"+maxrate+"%");update_net_income();update_net_bulbs()}function update_net_income(){var net_income=client.conn.playing["expected_income"];if(client.conn.playing["expected_income"]>0){net_income="+"+client.conn.playing["expected_income"]}$("#income_info").html(net_income)}function update_net_bulbs(bulbs){if(bulbs===undefined){var cbo=get_current_bulbs_output();bulbs=cbo.self_bulbs-cbo.self_upkeep}if(bulbs>0){bulbs="+"+bulbs}$("#bulbs_info").html(bulbs)}function create_rates_dialog(tax,lux,sci,max){s_tax=new Slider(document.getElementById("slider-tax"),document.getElementById("slider-tax-input"));s_tax.setValue(tax);s_tax.setMaximum(max);s_tax.setMinimum(0);s_tax.setBlockIncrement(10);s_tax.setUnitIncrement(10);s_tax.onchange=update_tax_rates;s_lux=new Slider(document.getElementById("slider-lux"),document.getElementById("slider-lux-input"));s_lux.setValue(lux);s_lux.setMaximum(max);s_lux.setMinimum(0);s_lux.setBlockIncrement(10);s_lux.setUnitIncrement(10);s_lux.onchange=update_lux_rates;s_sci=new Slider(document.getElementById("slider-sci"),document.getElementById("slider-sci-input"));s_sci.setValue(sci);s_sci.setMaximum(max);s_sci.setMinimum(0);s_sci.setBlockIncrement(10);s_sci.setUnitIncrement(10);s_sci.onchange=update_sci_rates;maxrate=max;update_rates_labels()}function update_rates_labels(){tax=s_tax.getValue();lux=s_lux.getValue();sci=s_sci.getValue();$("#tax_result").html(tax+"%");$("#lux_result").html(lux+"%");$("#sci_result").html(sci+"%")}function update_tax_rates(){if(s_tax.getValue()%10!=0)s_tax.setValue(s_tax.getValue()-s_tax.getValue()%10);if(s_lux.getValue()%10!=0)s_lux.setValue(s_lux.getValue()-s_lux.getValue()%10);if(s_sci.getValue()%10!=0)s_sci.setValue(s_sci.getValue()-s_sci.getValue()%10);var lock_lux=document.rates.lock[1].checked;var lock_sci=document.rates.lock[2].checked;tax=s_tax.getValue();lux=s_lux.getValue();sci=s_sci.getValue();if(tax+lux+sci!=100&&lock_lux==false){lux=Math.min(Math.max(100-tax-sci,0),maxrate)}if(tax+lux+sci!=100&&lock_sci==false){sci=Math.min(Math.max(100-lux-tax,0),maxrate)}if(tax+lux+sci!=100){s_tax.setValue(100-lux-sci);return}s_tax.setValue(tax);s_lux.setValue(lux);s_sci.setValue(sci);$("#tax_result").html(tax+"%");$("#lux_result").html(lux+"%");$("#sci_result").html(sci+"%");rates_changed=true}function update_lux_rates(){if(s_tax.getValue()%10!=0)s_tax.setValue(s_tax.getValue()-s_tax.getValue()%10);if(s_lux.getValue()%10!=0)s_lux.setValue(s_lux.getValue()-s_lux.getValue()%10);if(s_sci.getValue()%10!=0)s_sci.setValue(s_sci.getValue()-s_sci.getValue()%10);var lock_tax=document.rates.lock[0].checked;var lock_sci=document.rates.lock[2].checked;tax=s_tax.getValue();lux=s_lux.getValue();sci=s_sci.getValue();if(tax+lux+sci!=100&&lock_tax==false){tax=Math.min(Math.max(100-lux-sci,0),maxrate)}if(tax+lux+sci!=100&&lock_sci==false){sci=Math.min(Math.max(100-lux-tax,0),maxrate)}if(tax+lux+sci!=100){s_lux.setValue(100-tax-sci);return}s_tax.setValue(tax);s_lux.setValue(lux);s_sci.setValue(sci);$("#tax_result").html(tax+"%");$("#lux_result").html(lux+"%");$("#sci_result").html(sci+"%");rates_changed=true}function update_sci_rates(){if(s_tax.getValue()%10!=0)s_tax.setValue(s_tax.getValue()-s_tax.getValue()%10);if(s_lux.getValue()%10!=0)s_lux.setValue(s_lux.getValue()-s_lux.getValue()%10);if(s_sci.getValue()%10!=0)s_sci.setValue(s_sci.getValue()-s_sci.getValue()%10);var lock_tax=document.rates.lock[0].checked;var lock_lux=document.rates.lock[1].checked;tax=s_tax.getValue();lux=s_lux.getValue();sci=s_sci.getValue();if(tax+lux+sci!=100&&lock_lux==false){lux=Math.min(Math.max(100-tax-sci,0),maxrate)}if(tax+lux+sci!=100&&lock_tax==false){tax=Math.min(Math.max(100-sci-lux,0),maxrate)}if(tax+lux+sci!=100){s_sci.setValue(100-lux-tax);return}s_tax.setValue(tax);s_lux.setValue(lux);s_sci.setValue(sci);$("#tax_result").html(tax+"%");$("#lux_result").html(lux+"%");$("#sci_result").html(sci+"%");rates_changed=true}function close_rates_dialog(){freeze=false;submit_player_rates();clearInterval(rate_updater_interval);rate_output_update=null;$("#rates_dialog").dialog("close")}function submit_player_rates(){if(tax>=0&&tax<=100&&lux>=0&&lux<=100&&sci>=0&&sci<=100){var packet={pid:packet_player_rates,tax:tax,luxury:lux,science:sci};send_request(JSON.stringify(packet))}else{swal("Invalid tax rate values");setSwalTheme()}}var replay_enabled=true;var replay_gif;function init_replay(){if(is_small_screen())replay_enabled=false;if(!replay_enabled)return;replay_gif=new GIF({workers:1,quality:1,workerScript:"/javascript/libs/gif.worker.js"})}function add_replay_frame(){if(!replay_enabled)return;if($("#overview_map").length>0&&$("#overview_map").width()>0&&$("#overview_map").height()>0&&$("#overview_img").width()>0&&$("#overview_img").height()>0){replay_gif.addFrame(document.getElementById("overview_img"),{delay:1e3,copy:true})}}function show_replay(){if(!replay_enabled)return;var replay_gif_clone=jQuery.extend(true,{},replay_gif);replay_gif_clone.on("finished",function(blob){show_replay_dialog(blob)});replay_gif_clone.render()}function show_replay_dialog(blob){var title="Replay";var message="<img id='replay_result' style='width: 100%; height: 100%;'>";$("#replay_dialog").remove();$("<div id='replay_dialog'></div>").appendTo("div#game_page");$("#replay_dialog").html(message);var replay_image=document.getElementById("replay_result");replay_image.src=URL.createObjectURL(blob);$("#replay_dialog").attr("title",title);$("#replay_dialog").dialog({bgiframe:true,modal:false,height:600,width:is_small_screen()?"90%":"50%",buttons:{Ok:function(){$("#replay_dialog").dialog("close");$("#game_text_input").blur()}}});$("#replay_dialog").dialog("open");$("#game_text_input").blur()}var reqtree={2:{x:0,y:0},10:{x:0,y:123},63:{x:0,y:183},46:{x:0,y:300},35:{x:0,y:417},9:{x:0,y:534},86:{x:0,y:651},87:{x:416,y:0},13:{x:416,y:79},55:{x:416,y:154},48:{x:416,y:248},45:{x:416,y:322},62:{x:416,y:395},81:{x:416,y:456},20:{x:416,y:532},38:{x:416,y:635},42:{x:667,y:38},84:{x:667,y:113},53:{x:667,y:202},4:{x:667,y:290},72:{x:667,y:369},19:{x:667,y:500},80:{x:918,y:29},59:{x:918,y:152},56:{x:918,y:329},25:{x:918,y:425},29:{x:918,y:504},8:{x:918,y:658},7:{x:1169,y:6},49:{x:1169,y:85},85:{x:1169,y:177},60:{x:1169,y:249},54:{x:1169,y:310},37:{x:1169,y:386},12:{x:1169,y:605},22:{x:1420,y:6},11:{x:1420,y:106},21:{x:1420,y:174},83:{x:1420,y:235},75:{x:1420,y:307},71:{x:1420,y:384},44:{x:1420,y:458},82:{x:1420,y:535},34:{x:1420,y:612},5:{x:1753,y:85},28:{x:1753,y:221},65:{x:1753,y:303},50:{x:1753,y:471},41:{x:1753,y:620},36:{x:1958,y:175},23:{x:1958,y:409},18:{x:1958,y:563},79:{x:2271,y:47},16:{x:2271,y:138},76:{x:2271,y:312},68:{x:2271,y:491},78:{x:2271,y:658},32:{x:2543,y:2},67:{x:2543,y:93},27:{x:2543,y:236},24:{x:2543,y:352},33:{x:2543,y:428},43:{x:2543,y:504},3:{x:2543,y:658},15:{x:2794,y:185},51:{x:2794,y:472},6:{x:3e3,y:233},30:{x:3e3,y:309},47:{x:3228,y:130},52:{x:3228,y:430},64:{x:3228,y:539},66:{x:3479,y:50},57:{x:3479,y:143},39:{x:3479,y:270},17:{x:3479,y:346},1:{x:3479,y:516},58:{x:3812,y:298},69:{x:3812,y:384},70:{x:3812,y:460},14:{x:3812,y:539},73:{x:4228,y:287},40:{x:4228,y:378},61:{x:4479,y:120},26:{x:4479,y:196},77:{x:4479,y:378},31:{x:4680,y:381},74:{x:4680,y:481}};var reqtree_multiplayer={2:{x:0,y:0},10:{x:0,y:76},64:{x:0,y:200},47:{x:0,y:324},36:{x:0,y:448},9:{x:0,y:572},87:{x:0,y:696},88:{x:416,y:0},13:{x:416,y:80},56:{x:416,y:170},49:{x:416,y:250},46:{x:416,y:330},63:{x:416,y:420},82:{x:416,y:510},20:{x:416,y:590},39:{x:416,y:690},43:{x:667,y:40},85:{x:667,y:134},54:{x:667,y:216},4:{x:667,y:297},73:{x:667,y:379},19:{x:667,y:557},81:{x:918,y:30},60:{x:918,y:161},57:{x:918,y:338},25:{x:918,y:451},29:{x:918,y:533},8:{x:918,y:679},7:{x:1169,y:6},50:{x:1169,y:88},86:{x:1169,y:182},38:{x:1169,y:328},61:{x:1169,y:410},55:{x:1169,y:464},12:{x:1169,y:630},22:{x:1502,y:20},11:{x:1502,y:110},21:{x:1502,y:165},84:{x:1502,y:222},76:{x:1502,y:322},72:{x:1502,y:402},35:{x:1502,y:482},45:{x:1502,y:562},83:{x:1502,y:642},5:{x:1835,y:180},28:{x:1835,y:241},51:{x:1835,y:374},66:{x:1835,y:471},42:{x:1835,y:643},37:{x:2036,y:170},23:{x:2036,y:435},18:{x:2036,y:517},80:{x:2369,y:33},16:{x:2369,y:127},77:{x:2369,y:302},69:{x:2369,y:489},31:{x:2369,y:571},79:{x:2369,y:653},33:{x:2641,y:1},68:{x:2641,y:95},27:{x:2641,y:177},24:{x:2641,y:378},34:{x:2641,y:460},44:{x:2641,y:542},3:{x:2641,y:686},15:{x:2892,y:185},52:{x:2892,y:507},6:{x:3099,y:243},30:{x:3099,y:325},48:{x:3350,y:177},53:{x:3350,y:473},65:{x:3350,y:555},67:{x:3601,y:71},58:{x:3601,y:153},40:{x:3601,y:280},17:{x:3601,y:362},1:{x:3601,y:578},59:{x:3934,y:204},70:{x:3934,y:417},71:{x:3934,y:502},14:{x:3934,y:584},74:{x:4350,y:307},41:{x:4350,y:401},62:{x:4601,y:107},26:{x:4601,y:189},78:{x:4601,y:401},32:{x:4831,y:401},75:{x:4831,y:516}};var reqtree_civ2civ3={2:{x:0,y:0},10:{x:0,y:114},46:{x:0,y:228},63:{x:0,y:342},35:{x:0,y:456},9:{x:0,y:570},86:{x:0,y:684},87:{x:333,y:0},13:{x:333,y:80},48:{x:333,y:170},55:{x:333,y:250},45:{x:333,y:330},62:{x:333,y:410},81:{x:333,y:500},20:{x:333,y:580},38:{x:333,y:680},42:{x:584,y:38},53:{x:584,y:120},4:{x:584,y:249},72:{x:584,y:392},84:{x:584,y:493},19:{x:584,y:621},80:{x:917,y:29},59:{x:917,y:144},54:{x:917,y:261},44:{x:917,y:343},8:{x:917,y:581},29:{x:917,y:635},85:{x:1250,y:51},7:{x:1250,y:162},82:{x:1250,y:244},60:{x:1250,y:380},49:{x:1250,y:435},37:{x:1250,y:492},12:{x:1250,y:662},22:{x:1522,y:79},83:{x:1522,y:173},11:{x:1522,y:255},21:{x:1522,y:305},56:{x:1522,y:402},34:{x:1522,y:531},71:{x:1522,y:613},50:{x:1855,y:235},75:{x:1855,y:317},28:{x:1855,y:399},41:{x:1855,y:596},23:{x:2106,y:228},65:{x:2106,y:273},18:{x:2106,y:493},68:{x:2357,y:159},36:{x:2357,y:241},25:{x:2357,y:323},78:{x:2357,y:544},5:{x:2608,y:66},79:{x:2608,y:112},76:{x:2608,y:261},67:{x:2608,y:355},16:{x:2608,y:437},3:{x:2608,y:519},24:{x:2880,y:67},32:{x:2880,y:149},15:{x:2880,y:325},43:{x:2880,y:407},33:{x:2880,y:501},27:{x:2880,y:583},51:{x:3131,y:196},6:{x:3131,y:293},30:{x:3131,y:477},47:{x:3338,y:149},64:{x:3338,y:272},52:{x:3338,y:408},57:{x:3589,y:78},17:{x:3589,y:236},1:{x:3589,y:413},66:{x:3589,y:495},39:{x:3589,y:577},58:{x:3922,y:102},69:{x:3922,y:298},70:{x:3922,y:380},14:{x:3922,y:462},40:{x:4255,y:141},61:{x:4255,y:223},73:{x:4255,y:308},77:{x:4506,y:183},74:{x:4506,y:265},26:{x:4506,y:408},31:{x:4757,y:404}};var reqtree_SIM30={1:{x:5402,y:231},2:{x:482+123,y:100},3:{x:3940,y:214},4:{x:1148+123,y:135},5:{x:3524,y:267},6:{x:4818,y:332},7:{x:2108+123,y:500+48},8:{x:210+123,y:454},9:{x:210+123,y:32},10:{x:2108+123,y:298},11:{x:1836+123,y:35},12:{x:815+123,y:66},13:{x:5900,y:152},14:{x:4316,y:524},15:{x:3940,y:132},16:{x:5402,y:326},17:{x:3273,y:332},18:{x:815+123,y:563},19:{x:482+123,y:350},20:{x:2857,y:374},21:{x:2359+123,y:415},22:{x:2857,y:122},23:{x:4316,y:194},24:{x:3273,y:168},25:{x:5900,y:45},26:{x:4316,y:442},27:{x:2359+123,y:286},28:{x:1503+123,y:164},29:{x:4818,y:161},30:{x:6818,y:226},31:{x:4316,y:276},32:{x:2108+123,y:134},33:{x:0,y:222},34:{x:3524,y:355},35:{x:2108+123,y:332+48},36:{x:815+123,y:320},37:{x:5402,y:58},38:{x:5900,y:436},39:{x:2359+123,y:60},40:{x:1148+123,y:229},41:{x:4316,y:100},42:{x:1503+123,y:461},43:{x:815+123,y:401},44:{x:482+123,y:520},45:{x:4567,y:222},46:{x:815+123,y:228},47:{x:1836+123,y:437+48},48:{x:2359+123,y:154},49:{x:4567,y:571},50:{x:5151,y:104},51:{x:1148+123,y:41},52:{x:1503+123,y:55},53:{x:482+123,y:180},54:{x:2359+123,y:497},55:{x:4818,y:414},56:{x:5151,y:502},57:{x:1503+123,y:258},58:{x:1836+123,y:239},59:{x:6316,y:283},60:{x:482+123,y:0},61:{x:815+123,y:482},62:{x:5151,y:311},63:{x:3273,y:250},64:{x:4818,y:60},65:{x:3940,y:508},66:{x:3273,y:86},67:{x:5900,y:234},68:{x:5900,y:342},69:{x:2108+123,y:418+48},70:{x:1148+123,y:461},71:{x:6316,y:365},72:{x:6567,y:324},73:{x:2857,y:245},74:{x:3940,y:310},75:{x:6567,y:406},76:{x:3524,y:185},77:{x:3940,y:414},78:{x:1836+123,y:355+48},79:{x:210+123,y:536},80:{x:1836+123,y:117},81:{x:2108+123,y:216},82:{x:1148+123,y:555},83:{x:1836+123,y:273+48},84:{x:482+123,y:260},85:{x:815+123,y:147},86:{x:2857,y:497},87:{x:1148+123,y:367},88:{x:210+123,y:225},89:{x:210+123,y:618},90:{x:482+123,y:600},91:{x:210+123,y:307},92:{x:5151,y:408},93:{x:5402,y:408},94:{x:0,y:444},95:{x:0,y:618}};var reqtree_mpplus={2:{x:0,y:0},10:{x:0,y:174},64:{x:0,y:248},47:{x:0,y:347},36:{x:0,y:446},9:{x:0,y:582},87:{x:0,y:708},88:{x:416,y:0},13:{x:416,y:82},56:{x:416,y:145},49:{x:416,y:258},46:{x:416,y:347},63:{x:416,y:426},82:{x:416,y:524},20:{x:416,y:604},39:{x:416,y:706},43:{x:667,y:1},85:{x:667,y:106},54:{x:667,y:197},4:{x:667,y:299},73:{x:667,y:388},19:{x:667,y:539},81:{x:918,y:1},60:{x:918,y:145},57:{x:918,y:350},25:{x:918,y:461},29:{x:918,y:553},8:{x:918,y:693},7:{x:1169,y:14},50:{x:1169,y:86},86:{x:1169,y:195},38:{x:1169,y:319},61:{x:1169,y:418},55:{x:1169,y:526},12:{x:1169,y:696},22:{x:1502,y:1},11:{x:1502,y:108},21:{x:1502,y:176},84:{x:1502,y:239},76:{x:1502,y:342},72:{x:1502,y:412},35:{x:1502,y:500},45:{x:1502,y:596},83:{x:1502,y:658},5:{x:1835,y:75},28:{x:1835,y:282},51:{x:1835,y:389},66:{x:1835,y:484},42:{x:1835,y:698},37:{x:2096,y:335},23:{x:2096,y:416},18:{x:2096,y:526},80:{x:2374,y:35},16:{x:2374,y:145},77:{x:2374,y:325},69:{x:2374,y:514},31:{x:2374,y:600},79:{x:2374,y:699},33:{x:2646,y:1},68:{x:2646,y:113},27:{x:2646,y:242},24:{x:2646,y:344},34:{x:2646,y:475},44:{x:2646,y:586},3:{x:2646,y:699},15:{x:2904,y:188},52:{x:2904,y:522},6:{x:3116,y:249},30:{x:3116,y:336},48:{x:3367,y:181},53:{x:3367,y:486},65:{x:3367,y:646},67:{x:3618,y:1},58:{x:3618,y:89},40:{x:3618,y:319},17:{x:3618,y:398},1:{x:3618,y:589},59:{x:3951,y:208},70:{x:3951,y:425},71:{x:3951,y:525},14:{x:3951,y:623},74:{x:4367,y:234},41:{x:4367,y:435},62:{x:4618,y:1},26:{x:4618,y:193},78:{x:4618,y:526},32:{x:4856,y:410},75:{x:4856,y:526}};var reqtree_avantgarde={2:{x:0,y:0},11:{x:0,y:174},65:{x:0,y:248},48:{x:0,y:347},37:{x:0,y:446},10:{x:0,y:582},89:{x:0,y:708},90:{x:416,y:0},14:{x:416,y:82},57:{x:416,y:145},50:{x:416,y:258},47:{x:416,y:347},64:{x:416,y:426},84:{x:416,y:524},21:{x:416,y:604},40:{x:416,y:706},44:{x:667,y:1},87:{x:667,y:106},55:{x:667,y:197},4:{x:667,y:299},75:{x:667,y:388},20:{x:667,y:539},83:{x:918,y:1},61:{x:918,y:145},58:{x:918,y:350},26:{x:918,y:461},30:{x:918,y:553},9:{x:918,y:693},8:{x:1169,y:14},51:{x:1169,y:86},88:{x:1169,y:195},39:{x:1169,y:319},62:{x:1169,y:418},56:{x:1169,y:526},13:{x:1169,y:696},23:{x:1502,y:1},12:{x:1502,y:108},22:{x:1502,y:176},86:{x:1502,y:239},78:{x:1502,y:342},74:{x:1502,y:412},36:{x:1502,y:500},46:{x:1502,y:596},85:{x:1502,y:658},5:{x:1835,y:75},29:{x:1835,y:282},52:{x:1835,y:392},68:{x:1835,y:484},43:{x:1835,y:698},38:{x:2096,y:327},24:{x:2096,y:392},19:{x:2096,y:526},82:{x:2374,y:37},17:{x:2374,y:146},79:{x:2374,y:327},71:{x:2374,y:475},32:{x:2374,y:583},81:{x:2374,y:699},34:{x:2646,y:1},70:{x:2646,y:116},28:{x:2646,y:245},25:{x:2646,y:349},35:{x:2646,y:475},45:{x:2646,y:583},3:{x:2646,y:699},16:{x:2904,y:188},53:{x:2904,y:523},6:{x:3116,y:249},31:{x:3116,y:341},49:{x:3367,y:181},54:{x:3367,y:486},67:{x:3367,y:640},69:{x:3618,y:1},59:{x:3618,y:89},41:{x:3618,y:312},18:{x:3618,y:395},66:{x:3870,y:708},1:{x:3618,y:569},60:{x:3870,y:208},72:{x:4116,y:390},73:{x:4116,y:529},15:{x:3870,y:483},7:{x:4366,y:507},76:{x:4366,y:241},42:{x:4366,y:398},63:{x:4618,y:286},27:{x:4618,y:181},80:{x:4618,y:395},33:{x:4856,y:340},77:{x:4856,y:456}};var reqtree_mp2c={2:{x:0,y:0},11:{x:0,y:174},65:{x:0,y:248},48:{x:0,y:347},37:{x:0,y:446},10:{x:0,y:582},89:{x:0,y:708},90:{x:416,y:0},14:{x:416,y:82},57:{x:416,y:145},50:{x:416,y:258},47:{x:416,y:347},64:{x:416,y:426},84:{x:416,y:524},21:{x:416,y:604},40:{x:416,y:706},44:{x:667,y:1},87:{x:667,y:106},55:{x:667,y:197},4:{x:667,y:299},75:{x:667,y:388},20:{x:667,y:539},83:{x:918,y:1},61:{x:918,y:145},58:{x:918,y:350},26:{x:918,y:461},30:{x:918,y:553},9:{x:918,y:693},8:{x:1169,y:14},51:{x:1169,y:86},88:{x:1169,y:195},39:{x:1169,y:319},62:{x:1169,y:418},56:{x:1169,y:526},13:{x:1169,y:696},23:{x:1502,y:1},12:{x:1502,y:108},22:{x:1502,y:176},86:{x:1502,y:239},78:{x:1502,y:342},74:{x:1502,y:412},36:{x:1502,y:500},46:{x:1502,y:596},85:{x:1502,y:658},5:{x:1835,y:75},29:{x:1835,y:282},52:{x:1835,y:392},68:{x:1835,y:484},43:{x:1835,y:698},32:{x:1835,y:597},38:{x:2096,y:327},24:{x:2096,y:392},19:{x:2096,y:526},82:{x:2374,y:37},17:{x:2374,y:146},79:{x:2374,y:327},71:{x:2374,y:475},81:{x:2374,y:699},34:{x:2646,y:1},70:{x:2646,y:116},28:{x:2646,y:245},25:{x:2646,y:349},35:{x:2646,y:512},45:{x:2646,y:594},3:{x:2646,y:699},16:{x:2904,y:188},53:{x:2904,y:523},6:{x:3116,y:249},31:{x:3116,y:341},49:{x:3367,y:181},54:{x:3367,y:486},67:{x:3367,y:640},69:{x:3618,y:1},59:{x:3618,y:89},41:{x:3618,y:312},18:{x:3618,y:395},66:{x:3870,y:708},1:{x:3618,y:569},60:{x:3870,y:208},72:{x:4116,y:390},73:{x:4116,y:529},15:{x:3870,y:483},7:{x:4366,y:507},76:{x:4366,y:241},42:{x:4366,y:398},63:{x:4618,y:286},27:{x:4618,y:181},80:{x:4618,y:395},33:{x:4856,y:340},77:{x:4856,y:456},91:{x:2646,y:429}};var requirements={};var REQ_RANGE_LOCAL=0;var REQ_RANGE_CADJACENT=1;var REQ_RANGE_ADJACENT=2;var REQ_RANGE_CITY=3;var REQ_RANGE_TRADEROUTE=4;var REQ_RANGE_CONTINENT=5;var REQ_RANGE_PLAYER=6;var REQ_RANGE_TEAM=7;var REQ_RANGE_ALLIANCE=8;var REQ_RANGE_WORLD=9;var REQ_RANGE_COUNT=10;function is_req_active(target_player,target_city,target_building,target_tile,target_unittype,target_output,target_specialist,req,prob_type){var result=TRI_NO;switch(req["kind"]){case VUT_NONE:result=TRI_YES;break;case VUT_ADVANCE:result=is_tech_in_range(target_player,req["range"],req["value"]);break;case VUT_GOVERNMENT:case VUT_IMPROVEMENT:case VUT_TERRAIN:case VUT_NATION:case VUT_UTYPE:case VUT_UTFLAG:case VUT_UCLASS:case VUT_UCFLAG:case VUT_OTYPE:case VUT_SPECIALIST:case VUT_MINSIZE:case VUT_AI_LEVEL:case VUT_TERRAINCLASS:case VUT_MINYEAR:case VUT_TERRAINALTER:case VUT_CITYTILE:case VUT_GOOD:case VUT_TERRFLAG:case VUT_NATIONALITY:case VUT_BASEFLAG:case VUT_ROADFLAG:case VUT_EXTRA:case VUT_TECHFLAG:case VUT_ACHIEVEMENT:case VUT_DIPLREL:case VUT_MAXTILEUNITS:case VUT_STYLE:case VUT_MINCULTURE:case VUT_UNITSTATE:case VUT_MINMOVES:case VUT_MINVETERAN:case VUT_MINHP:case VUT_AGE:case VUT_NATIONGROUP:case VUT_TOPO:case VUT_IMPR_GENUS:case VUT_ACTION:case VUT_MINTECHS:case VUT_EXTRAFLAG:case VUT_MINCALFRAG:case VUT_SERVERSETTING:console.log("Unimplemented requirement type "+req["kind"]);break;case VUT_COUNT:return false;default:console.log("Unknown requirement type "+req["kind"])}if(result==TRI_MAYBE){if(prob_type==RPT_POSSIBLE){return true}else{return false}}if(req["present"]){return result==TRI_YES}else{return result==TRI_NO}}function are_reqs_active(target_player,target_city,target_building,target_tile,target_unittype,target_output,target_specialist,reqs,prob_type){for(var i=0;i<reqs.length;i++){if(!is_req_active(target_player,target_city,target_building,target_tile,target_unittype,target_output,target_specialist,reqs[i],prob_type)){return false}}return true}function is_tech_in_range(target_player,range,tech){switch(range){case REQ_RANGE_PLAYER:return target_player!=null&&player_invention_state(target_player,tech)==TECH_KNOWN?TRI_YES:TRI_NO;case REQ_RANGE_TEAM:case REQ_RANGE_ALLIANCE:case REQ_RANGE_WORLD:console.log("Unimplemented tech requirement range "+range);return TRI_MAYBE;case REQ_RANGE_LOCAL:case REQ_RANGE_CADJACENT:case REQ_RANGE_ADJACENT:case REQ_RANGE_CITY:case REQ_RANGE_TRADEROUTE:case REQ_RANGE_CONTINENT:case REQ_RANGE_COUNT:break}console.log("Invalid tech req range "+range);return TRI_MAYBE}function universal_build_shield_cost(pcity,target){if(!target["hp"])return get_universal_discount_price(target,pcity);else return get_universal_discount_price(target,pcity)}var saved_this_turn=false;var game_loaded=false;var scenarios=[{img:"/images/tutorial.png",description:"Tutorial",savegame:"tutorial"},{img:"/images/world_small.png",description:"The World (80x50)",savegame:"earth-small"},{img:"/images/world_big.png",description:"The World (160x90)",savegame:"earth-large"},{img:"/images/hagworld.png",description:"The World (120x60)",savegame:"hagworld"},{img:"/images/europe.png",description:"Large Europe v2.01LT (177x100) LONGTURN ONLY. Up to 50 players",savegame:"europe-new-positions"},{img:"/images/europe.png",description:"Large Europe v2 (177x100)",savegame:"europe"},{img:"/images/europe_1901.png",description:"Europe 1901 WWI (177x100) up to 11 players",savegame:"europe_1901"},{img:"/images/british.png",description:"British Isles (85x80)",savegame:"british-isles"},{img:"/images/iberian.png",description:"Iberian Peninsula (136x100) Spain and Portugal",savegame:"iberian-peninsula"},{img:"/images/france.png",description:"France (140x90)",savegame:"france"},{img:"/images/italy.png",description:"Italy (100x100)",savegame:"italy"},{img:"/images/japan.png",description:"Japan (88x100)",savegame:"japan"},{img:"/images/america.png",description:"North America (116x100)",savegame:"north_america"}];var scenario_info=null;var scenario_activated=false;var loadTimerId=-1;function save_game(){if(saved_this_turn){swal("You have already saved this turn, and you can only save once every turn each game-session.");setSwalTheme();return}remove_active_dialog("#save_dialog");$("<div id='save_dialog'></div>").appendTo("div#game_page");var dhtml="<span id='settings_info'><i>You can save your current game here. "+"Savegames are stored on the server, and deleted after 365 days. You can save once every turn in each game session.</i></span>";if(!logged_in_with_password){dhtml+="<br><br>Warning: You have not logged in using a user account with password. Please "+"create a new user account with password next time you want save, so you are sure"+" you can load the savegame with a username and password. <a href='/webclient/?action=new&amp;type=singleplayer'>Click here</a> "+'to start a new game, then click on the "New User Account" button to create a new account.<br>'}$("#save_dialog").html(dhtml);$("#save_dialog").attr("title","Save game");$("#save_dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"90%":"40%",close:function(){keyboard_input=true},buttons:{"Save Game":function(){remove_active_dialog("#save_dialog");send_message("/save");swal("Game saved.");setSwalTheme()}}});if(is_pbem()){swal("Play-By-Email games can not be saved. Please use the end turn button.");setSwalTheme();return}$("#save_dialog").dialog("open");dialog_register("#save_dialog");saved_this_turn=true}function quicksave(){if(is_pbem()){swal("Play-By-Email games can not be saved. Please use the end turn button.");setSwalTheme();return}if(saved_this_turn){swal("You have already saved this turn, and you can only save once every turn each game-session.");setSwalTheme();return}send_message("/save");message_log.update({event:E_REPORT,message:"Game saved."});saved_this_turn=true}function show_load_game_dialog(){$.ajax({type:"POST",url:"/listsavegames?username="+username,success:function(data,textStatus,request){show_load_game_dialog_cb(data)},error:function(request,textStatus,errorThrown){swal("Loading game failed (listsavegames failed)");setSwalTheme()}})}function show_load_game_dialog_cb(savegames_data){var saveHtml=[];if(savegames_data!=null&&savegames_data.length>=3){var savegames=savegames_data.split(";");for(var i=0;i<savegames.length;i++){if(savegames[i].length>2){saveHtml.push("<li class='ui-widget-content'>"+savegames[i]+"</li>")}}}if(saveHtml.length==0){show_scenario_dialog();return}saveHtml="<ul id='selectable' style='height: 95%;'>"+saveHtml.join("")+"</ul><br>";var dialog_buttons={};if(C_S_RUNNING!=client_state()){dialog_buttons=$.extend(dialog_buttons,{"Load Savegame":function(){var load_game_id=$("#selectable .ui-selected").index();if(load_game_id==-1){swal("Unable to load savegame: no game selected.");setSwalTheme()}else if($("#selectable .ui-selected").text()!=null){$.blockUI({message:"<h1 style='text-align:center'><font color='#ccc'>Loading Savegame...</font>"+"<br><center><img src='/images/loading.gif'></center></h1>",color:default_dialog_text_color});send_message("/load "+$("#selectable .ui-selected").text());game_loaded=true;$("#dialog").dialog("close");$("#game_text_input").blur()}}});var stored_password=simpleStorage.get("password","");if(stored_password!=null&&stored_password!=false){dialog_buttons=$.extend(dialog_buttons,{"Delete ALL":function(){var r;if("confirm"in window){r=confirm("Do you really want to delete all your savegames?")}else{r=true}if(r==true){delete_all_savegames();$("#dialog").dialog("close");setTimeout(show_scenario_dialog,1e3)}},Delete:function(){var load_game_id=$("#selectable .ui-selected").index();if(load_game_id!=-1){$("#selectable .ui-selected").each(function(){var $this=$(this);if($this.length){delete_savegame($this.text())}})}$("#selectable .ui-selected").remove()}})}dialog_buttons=$.extend(dialog_buttons,{"Load Scenarios...":function(){$("#dialog").dialog("close");$("#game_text_input").blur();show_scenario_dialog()}})}$("#dialog").remove();$("<div id='dialog'></div>").appendTo("div#game_page");$("#dialog").html(saveHtml);$("#dialog").attr("title","Load saved game");$("#dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"90%":"50%",height:is_small_screen()?$(window).height()-20:$(window).height()-80,buttons:dialog_buttons});$("#selectable li").first().addClass("ui-selected");if(!is_touch_device()){$("#selectable").selectable()}else{$("#selectable").on("click","li",function(ev){ev.stopPropagation();var item=$(this);item.siblings().removeClass("ui-selected");item.addClass("ui-selected")})}$("#dialog").dialog("open");$("#game_text_input").blur();$(".ui-dialog-buttonpane button").eq(0).focus()}function delete_savegame(filename){var stored_password=simpleStorage.get("password","");if(stored_password!=null&&stored_password!=false){var shaObj=new jsSHA("SHA-512","TEXT");shaObj.update(stored_password);var sha_password=encodeURIComponent(shaObj.getHash("HEX"));$.ajax({type:"POST",url:"/deletesavegame?username="+encodeURIComponent(username)+"&savegame="+encodeURIComponent(filename)+"&sha_password="+sha_password})}}function delete_all_savegames(){var stored_password=simpleStorage.get("password","");if(stored_password!=null&&stored_password!=false){var shaObj=new jsSHA("SHA-512","TEXT");shaObj.update(stored_password);var sha_password=encodeURIComponent(shaObj.getHash("HEX"));$.ajax({type:"POST",url:"/deletesavegame?username="+encodeURIComponent(username)+"&savegame=ALL"+"&sha_password="+sha_password})}}function load_game_check(){var load_game_id=$("#selectable .ui-selected").index();var scenario=$.getUrlVar("scenario");if($.getUrlVar("load")=="tutorial"){$.blockUI();wait_for_text("You are logged in as",function(){load_game_real("tutorial")});wait_for_text("Load complete",load_game_toggle)}else if($.getUrlVar("action")=="earthload"){$.blockUI();var savegame_earth_file=$.getUrlVar("savegame").replace("#","");wait_for_text("You are logged in as",function(){load_game_real(savegame_earth_file)});wait_for_text("Load complete",load_game_toggle)}else if(load_game_id!=-1){$.blockUI();if(scenario=="true"||scenario_activated){if(load_game_id==-1){show_scenario_dialog()}else{var scenario_game_id=scenarios[load_game_id]["savegame"];wait_for_text("You are logged in as",function(){load_game_real(scenario_game_id)});wait_for_text("Load complete",load_game_toggle)}}}else if(scenario=="true"&&$.getUrlVar("load")!="tutorial"){show_scenario_dialog()}else if($.getUrlVar("action")=="load"){show_load_game_dialog()}}function load_game_real(filename){console.log("Server command: /load "+filename);send_message("/load "+filename);$.unblockUI();game_loaded=true}function set_metamessage_on_loaded_game(game_type){if(game_type=="multi"){metamessage_changed=true;send_message("/metamessage Multiplayer game loaded by "+username);loaded_game_type=game_type}else if(game_type=="hotseat"){hotseat_enabled=true;loaded_game_type=game_type}}function load_game_toggle(){send_message("/set nationset all");if(players==null||players[0]==null){message_log.update({event:E_LOG_ERROR,message:"Error: Unable to aitoggle and take your player. Try reloading the page."});$.unblockUI();return}var firstplayer=players[0]["name"].split(" ")[0];if($.getUrlVar("scenario")=="true"||scenario_activated){send_message("/set aifill 6")}send_message("/aitoggle "+firstplayer);send_message("/take "+firstplayer);$.unblockUI()}function show_scenario_dialog(){$("#dialog").remove();$("<div id='dialog'></div>").appendTo("div#game_page");$.unblockUI();var saveHtml="<ol id='selectable'>";for(var i=0;i<scenarios.length;i++){saveHtml+="<li class='ui-widget-content'><img border='0' src='"+scenarios[i]["img"]+"' style='padding: 4px;' ><br>"+scenarios[i]["description"]+"</li>"}saveHtml+="</ol>";$("#dialog").html(saveHtml);$("#dialog").attr("title","Select a scenario to play:");$("#selectable").css("height",$(window).height()-180);$("#dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"90%":"40%",position:{my:"center bottom",at:"center bottom",of:window},buttons:{Cancel:function(){$("#dialog").dialog("close")},"Create map from image upload..":function(){$("#dialog").dialog("close");show_map_from_image_dialog()},"Select scenario":function(){if($("#selectable .ui-selected").index()==-1){swal("Please select a scenario first.");setSwalTheme()}else{scenario_activated=true;load_game_check();$("#dialog").dialog("close");$("#game_text_input").blur()}}}});$("#selectable").selectable();$("#dialog").dialog("open");$(".ui-dialog-buttonset").children().last().attr("title","Note: set your ruleset BEFORE loading scenario");$("#game_text_input").blur()}function view_game_scores(){set_default_mapview_active();$("#scores_dialog").remove();$("<div id='scores_dialog'></div>").appendTo("div#game_page");var dialog_html="<center><div id='scores_wait'>Please wait while generating score graphs...</div></center>"+"</div><div id='scores_tabs'><ul id='scores_ul'></ul></div>";$("#scores_dialog").html(dialog_html);$("#scores_dialog").attr("title","Game Scores");$("#scores_dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"95%":"80%",height:is_small_screen()?560:710,buttons:{Ok:function(){$("#scores_dialog").dialog("close");$("#scores_tabs").remove();$("#scores_dialog").remove()}}});$("#scores_dialog").dialog("open");$.ajax({url:"/data/scorelogs/score-"+civserverport+".log",dataType:"html",cache:false,async:true}).fail(function(){$("#scores_wait").html("Score graphs not shown, because server 'scorelog' variable is disabled,"+" or because of problem loading the score file.");$("#game_scores_button").button("option","disabled",true)}).done(function(data){handle_scorelog(data)})}function handle_scorelog(scorelog){var start_turn=0;var scoreitems=scorelog.split("\n");var scoreplayers={};var playerslist=[];var playernames=[];var scoretags={};var resultdata={};var scorecolors=[];for(var i=0;i<scoreitems.length;i++){var scoreitem=scoreitems[i];var scoredata=scoreitem.split(" ");if(scoredata.length>=3){if(scoredata[0]=="addplayer"){var pname=scoredata[3];for(var s=4;s<scoredata.length;s++){pname+=" "+scoredata[s]}scoreplayers[scoredata[2]]=pname;playerslist.push(scoredata[2]);playernames.push(pname);var pplayer=player_by_name(pname);if(pplayer==null){scorecolors.push("#ff0000")}else{scorecolors.push(nations[pplayer["nation"]]["color"])}}else if(scoredata[0]=="turn"){if(start_turn==0)start_turn=scoredata[1]}else if(scoredata[0]=="tag"){scoretags[scoredata[1]]=scoredata[2]}else if(scoredata[0]=="data"){var turn=scoredata[1];var tag=scoredata[2];var player=scoredata[3];var value=scoredata[4];if(resultdata[tag]==null){var s={};s["turn"]=turn;s[player]=parseInt(value);resultdata[tag]=[];resultdata[tag][turn-start_turn]=s}else if(resultdata[tag]!=null&&resultdata[tag][turn-start_turn]==null){var s={};s["turn"]=turn;s[player]=parseInt(value);resultdata[tag][turn-start_turn]=s}else if(resultdata[tag][turn-start_turn]!=null){resultdata[tag][turn-start_turn][player]=parseInt(value)}}}}if(is_small_screen())scoretags={0:"score"};for(var key in scoretags){var tagname=scoretags[key];$("#scores_ul").append("<li><a href='#scores-tabs-"+key+"' class='scores_tabber'>"+get_scorelog_name(tagname)+"</a></li>");$("#scores_tabs").append("<div id='scores-tabs-"+key+"'><div id='scoreschart-"+key+"' class='scorechart'></div>"+"<center><b>"+get_scorelog_name(tagname)+"</b></center></div>")}var ps=4;if(scoreitems.length>1e3)ps=0;for(var key in scoretags){try{Morris.Line({element:"scoreschart-"+key,data:resultdata[key],xkey:"turn",ykeys:playerslist,labels:playernames,parseTime:false,lineColors:scorecolors,pointSize:ps})}catch(err){console.log("Problem showing score log graph: "+err)}}$("#scores_tabs").tabs();$(".scores_tabber").css("padding","1px");$("#scores_wait").hide();if(is_small_screen()){$(".scorechart").height($("#scores_dialog").height()-10)}}function get_scorelog_name(tag){var names={score:"Score",pop:"Population",bnp:"Economics",mfg:"Production",cities:"Cities",techs:"Techs",munits:"Military units",wonders:"Wonders",techout:"Tech output",landarea:"Land area",settledarea:"Settled area",gold:"Gold",unitsbuilt:"Units built",unitskilled:"Units killed",unitslost:"Units lost"};return names[tag]}var sound_path="/sounds/";var sound_traffic_counter=0;var sound_traffic_max=10;var sound_delayer=150;var sound_delay_timestamp=null;function check_unit_sound_play(old_unit,new_unit){if(!sounds_enabled)return;if(old_unit==null||new_unit==null)return;if(new_unit["tile"]==old_unit["tile"])return;if(!is_unit_visible(new_unit))return;if(soundset==null){console.error("soundset not found.");return}var ptype=unit_type(new_unit);if(soundset[ptype["sound_move"]]!=null){play_sound(soundset[ptype["sound_move"]])}else if(soundset[ptype["sound_move_alt"]]!=null){play_sound(soundset[ptype["sound_move_alt"]])}}function unit_move_sound_play(unit){if(!sounds_enabled)return;if(unit==null)return;if(soundset==null){console.error("soundset not found.");return}var ptype=unit_type(unit);move_sound=soundset[ptype["sound_move"]];var full_moves=ptype["move_rate"];var used_moves=full_moves-unit["movesleft"];if(used_moves<0){if(ptype["name"]=="Train"){if(player_invention_state(client.conn.playing,tech_id_by_name("Electricity"))==TECH_KNOWN)full_moves+=9;if(player_invention_state(client.conn.playing,tech_id_by_name("Combustion"))==TECH_KNOWN)full_moves+=9}}if(unit["movesleft"]<full_moves){switch(ptype["name"]){case"Armor":case"Armor II":move_sound="pm_armor.ogg";break;case"Medium Bomber":case"Heavy Bomber":case"Strategic Bomber":case"Bomber":move_sound="pm_prop_bombers.ogg";break;case"Cruise Missile":case"Nuclear Missile":case"Nuclear":case"Tactical Nuke":move_sound=null;break;case"Dive Bomber":case"Airplane":case"Fighter":case"Escort Fighter":move_sound="pm_prop_fighters.ogg";break;case"AWACS":case"Jet Bomber":case"Stealth Bomber":case"Jet Fighter":case"Ground Strike Fighter":move_sound="pm-large-jets.ogg";break;case"Helicopter":case"Transport Helicopter":move_sound="pm_heli.ogg";break;case"Train":move_sound="pm_train.ogg";break}}if(move_sound!=null){play_sound(move_sound)}else if(soundset[ptype["sound_move_alt"]]!=null){play_sound(soundset[ptype["sound_move_alt"]])}}function play_hostile_event_sound(key,ptile,ptype){if(!sounds_enabled)return;var funits=tile_units(ptile);if(!funits)return;if(soundset==null){console.error("Soundset not found.");return}if(soundset[key]!=null){play_sound(soundset[key])}}function play_combat_sound(unit){if(!sounds_enabled)return;if(unit==null)return;if(!is_unit_visible(unit)){return}if(soundset==null){console.error("Soundset not found.");return}var ptype=unit_type(unit);if(soundset[ptype["sound_fight"]]!=null){play_sound(soundset[ptype["sound_fight"]])}else if(soundset[ptype["sound_fight_alt"]]!=null){play_sound(soundset[ptype["sound_fight_alt"]])}}function combat_sound_special_case(attacker,attacker_hp,defender){if(unit_types[attacker["type"]]["name"]=="Submarine"&&unit_types[defender["type"]]["name"]=="Destroyer"&&attacker_hp==0){play_sound("depth-charge.ogg");return true}if(unit_types[defender["type"]]["name"]=="Submarine"&&unit_types[attacker["type"]]["name"]=="Destroyer"&&attacker_hp>0){play_sound("depth-charge.ogg");return true}return false}function play_sound(sound_file){var current_time=(new Date).getTime();if(sound_delay_timestamp==null){sound_delay_timestamp=current_time;sound_traffic_counter=0}if(current_time-sound_delay_timestamp>sound_delayer){sound_traffic_counter=0;sound_delay_timestamp=current_time}sound_traffic_counter++;if(sound_traffic_counter>sound_traffic_max){console.log("  >> Aborted play_sound('"+sound_file+"') due to (counter:"+sound_traffic_counter+") > (max_allowed:"+sound_traffic_max+") within "+sound_delayer+"ms");return}try{if(!sounds_enabled||!document.createElement("audio").canPlayType||Audio==null){return}var audio=new Audio(sound_path+sound_file);var promise=audio.play();if(promise!=null){promise.catch(sound_error_handler)}}catch(err){trackJs.console.log("Error playing sound_file="+sound_file);sound_error_handler(err)}}function sound_error_handler(err){if(window.trackJs){if(err!=null&&err["name"]!=null&&err["name"]=="NotAllowedError")return;trackJs.console.log(err);trackJs.track("Sound problem")}else{console.log("sounds.js sound_error_handler(err) triggered with err=="+err)}}var spaceship_info={};var SSHIP_NONE=0;var SSHIP_STARTED=1;var SSHIP_LAUNCHED=2;var SSHIP_ARRIVED=3;var SSHIP_PLACE_STRUCTURAL=0;var SSHIP_PLACE_FUEL=1;var SSHIP_PLACE_PROPULSION=2;var SSHIP_PLACE_HABITATION=3;var SSHIP_PLACE_LIFE_SUPPORT=4;var SSHIP_PLACE_SOLAR_PANELS=5;function show_spaceship_dialog(){var title="Spaceship";var message="";if(client_is_observer())return;var spaceship=spaceship_info[client.conn.playing["playerno"]];message+="Spaceship progress: "+get_spaceship_state_text(spaceship["sship_state"])+"<br>";message+="Success probability: "+Math.floor(spaceship["success_rate"]*100)+"%<br>";message+="Travel time: "+Math.floor(spaceship["travel_time"])+" years<br>";message+="Components: "+spaceship["components"]+"<br>";message+="Energy Rate: "+Math.floor(spaceship["energy_rate"]*100)+"%<br>";message+="Support Rate: "+Math.floor(spaceship["support_rate"]*100)+"%<br>";message+="Habitation: "+spaceship["habitation"]+"<br>";message+="Life Support: "+spaceship["life_support"]+"<br>";message+="Mass: "+spaceship["mass"]+" tons<br>";message+="Modules: "+spaceship["modules"]+"<br>";message+="Population: "+spaceship["population"]+"<br>";message+="Propulsion: "+spaceship["propulsion"]+"<br>";message+="Solar Panels: "+spaceship["solar_panels"]+"<br>";message+="Structurals: "+spaceship["structurals"]+"<br>";if(spaceship["launch_year"]!=9999)message+="Launch year: "+spaceship["launch_year"]+"<br>";if(game_info["victory_conditions"]==0)message="Spaceship victory disabled.<br>";message+="<br>For help, see the Space Race page in the manual.<br>";remove_active_dialog("#dialog");$("<div id='dialog'></div>").appendTo("div#game_page");$("#dialog").html(message);$("#dialog").attr("title",title);$("#dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"90%":"40%",buttons:{"Close (𝗪)":function(){remove_active_dialog("#dialog")},Launch:function(){remove_active_dialog("#dialog");launch_spaceship();set_default_mapview_active()}}});$("#dialog").dialog("open");dialog_register("#dialog");if(spaceship["sship_state"]!=SSHIP_STARTED||spaceship["success_rate"]==0)$(".ui-dialog-buttonpane button:contains('Launch')").button("disable")}function launch_spaceship(){var test_packet={pid:packet_spaceship_launch};var myJSONText=JSON.stringify(test_packet);send_request(myJSONText)}function get_spaceship_state_text(state_id){if(state_id==SSHIP_NONE)return"Not started";if(state_id==SSHIP_STARTED)return"Started";if(state_id==SSHIP_LAUNCHED)return"Launched";if(state_id==SSHIP_ARRIVED)return"Arrived"}var specialists={};var speech_enabled=false;var voice=null;function is_speech_supported(){if("speechSynthesis"in window){return true}else{return false}}function speak(text){if(!is_speech_supported()||!speech_enabled)return;speech_synth(text,true)}function speak_unfiltered(text){if(!is_speech_supported()||!speech_enabled)return;speech_synth(text,false)}function speech_synth(text,filter_enabled){if(!is_speech_supported()||!speech_enabled)return;var text_filtered=filter_enabled?filter_speech_messages(text):text;if(text_filtered==null)return;var msg=new SpeechSynthesisUtterance;msg.text=text_filtered;msg.volume=parseFloat(1);msg.rate=parseFloat(1.1);msg.pitch=parseFloat(1);msg.lang="en-US";if(voice==null){var voices=speechSynthesis.getVoices();voices.forEach(function(voice_check,i){if(voice_check.name=="Google UK English Female")voice="Google UK English Female"})}if(voice!=null){msg.voice=speechSynthesis.getVoices().filter(function(voice_check){return voice_check.name==voice})[0]}window.speechSynthesis.speak(msg)}function filter_speech_messages(input){if(C_S_RUNNING!=client_state())return null;if(input==null||input.length==0)return null;if(input.indexOf("metamessage")!=-1)return null;if(input.indexOf("rules the")!=-1)return null;input=input.replace(/(\r\n|\n|\r)/gm,"");input=input.replace(/AI/g,"");input=input.replace(/\*/g,"");input=jQuery("<div>"+input+"</div>").text();if(input.length>90)return null;return input}function load_voices(){if(!is_speech_supported()||speechSynthesis==null)return;var voices=speechSynthesis.getVoices();var voiceSelect=document.getElementById("voice");if(voiceSelect==null)return;voices.forEach(function(voice,i){var option=document.createElement("option");option.value=voice.name;option.innerHTML=voice.name;voiceSelect.appendChild(option)})}var techs={};var techcoststyle1={};var bulb_output_text="";var tech_canvas_text_font="18px Arial";var tech_canvas_text_font_redux="17px Arial";var tech_canvas_text_font_alt="18px Arial";var is_tech_tree_init=false;var tech_dialog_active=false;var tech_xscale=1.2;var wikipedia_url="http://freeciv.fandom.com/wiki/";var hover_tech_id=null;var hover_tech_oldest_time=null;var hover_tech_delay=130;var TECH_UNKNOWN=0;var TECH_PREREQS_KNOWN=1;var TECH_KNOWN=2;var AR_ONE=0;var AR_TWO=1;var AR_ROOT=2;var AR_SIZE=3;var TF_BONUS_TECH=0;var TF_BRIDGE=1;var TF_RAILROAD=2;var TF_POPULATION_POLLUTION_INC=3;var TF_FARMLAND=4;var TF_BUILD_AIRBORNE=5;var TF_LAST=6;var A_NONE=0;var A_FIRST=1;var A_LAST=MAX_NUM_ADVANCES+1;var A_FUTURE=A_LAST+1;var A_UNSET=A_LAST+2;var A_UNKNOWN=A_LAST+3;var A_LAST_REAL=A_UNKNOWN;var A_NEVER=null;var tech_canvas=null;var tech_canvas_ctx=null;var tech_item_width=222;var tech_item_height=52;var maxleft=0;var clicked_tech_id=null;var bulbs_output_updater=new EventAggregator(update_bulbs_output_info,250,EventAggregator.DP_NONE,250,3,250);function player_invention_state(pplayer,tech_id){if(pplayer==null){return TECH_UNKNOWN}else{if(pplayer["inventions"]!=null&&pplayer["inventions"][tech_id]!=null){return pplayer["inventions"][tech_id]}else{return TECH_UNKNOWN}}}function tech_known(tech_str){return player_invention_state(client.conn.playing,tech_id_by_name(tech_str))==TECH_KNOWN}function init_tech_screen(){if(is_small_screen()){tech_canvas_text_font="20px Arial"}addEventListener("mousedown",function(e){if(e.button==1){e.preventDefault()}});$("#technologies").width($(window).width()-20);$("#technologies").height($(window).height()-$("#technologies").offset().top-15);if(is_tech_tree_init)return;if(ruleset_control["name"]!="Classic ruleset")reqtree=reqtree_mpplus;if(ruleset_control["name"]=="Civ2Civ3 ruleset")reqtree=reqtree_civ2civ3;if(ruleset_control["name"]=="SIM30")reqtree=reqtree_SIM30;if(ruleset_control["name"]=="Multiplayer ruleset")reqtree=reqtree_multiplayer;if(ruleset_control["name"]=="Longturn-Web-X ruleset")reqtree=reqtree_multiplayer;if(ruleset_control["name"]=="Multiplayer-Plus ruleset")reqtree=reqtree_mpplus;if(ruleset_control["name"]=="Multiplayer-Evolution ruleset")reqtree=reqtree_mpplus;if(ruleset_control["name"].startsWith("Avant-garde"))reqtree=reqtree_avantgarde;if(ruleset_control["name"].startsWith("MP2"))reqtree=reqtree_avantgarde;if(client_rules_flag[CRF_MP2_C])reqtree=reqtree_mp2c;tech_canvas=document.getElementById("tech_canvas");if(tech_canvas==null){console.log("unable to find tech canvas.");return}tech_canvas_ctx=tech_canvas.getContext("2d");if("imageSmoothingEnabled"in tech_canvas_ctx){tech_canvas_ctx.imageSmoothingEnabled=false}var max_width=0;var max_height=0;for(var tech_id in techs){if(!(tech_id+""in reqtree)||reqtree[tech_id+""]==null){continue}var x=reqtree[tech_id+""]["x"];var y=reqtree[tech_id+""]["y"];if(x>max_width)max_width=x;if(y>max_height)max_height=y}tech_canvas.width=(max_width+tech_item_width)*tech_xscale;tech_canvas.height=max_height+tech_item_height;if(is_small_screen()){tech_canvas.width=Math.floor(tech_canvas.width*.6);tech_canvas.height=Math.floor(tech_canvas.height*.6);tech_canvas_ctx.scale(.6,.6);$("#tech_info_box").css("font-size","87%");$("#tech_result_text").css("font-size","85%");$("#tech_color_help").css("font-size","65%");$("#tech_progress_box").css("padding-left","10px");$("#tech_goal_box").css("font-size","87%")}if(!is_small_screen()){$("#mouse_info_box").html("<div title='Right-click:     Scrolls the screen.\nMiddle-click:    Sets the Future Goal.\nALT+Right-click: alternate mid-click' style='margin-right:-10px;margin-bottom:10px;float:right;width:26px;height:20px;'>&#x2753;</div>");$("#mouse_info_box").css("cursor","help");$("#mouse_info_box").tooltip()}is_tech_tree_init=true;clicked_tech_id=null}function update_tech_tree(){if(freeze)return;var hy=24;var hx=48+160;hx=tech_item_width;tech_canvas_ctx.clearRect(0,0,5824,726);for(var tech_id in techs){var ptech=techs[tech_id];if(!(tech_id+""in reqtree)||reqtree[tech_id+""]==null){continue}var sx=Math.floor(reqtree[tech_id+""]["x"]*tech_xscale);var sy=reqtree[tech_id+""]["y"];for(var i=0;i<ptech["req"].length;i++){var rid=ptech["req"][i];if(rid==0||reqtree[rid+""]==null)continue;var dx=Math.floor(reqtree[rid+""]["x"]*tech_xscale);var dy=reqtree[rid+""]["y"];var sequence=1+Math.round(dy/55)+Math.round(dx/45);sequence=sequence-(sequence-sequence%9);if(tech_known(ptech["rule_name"])&&tech_known(techs[rid]["rule_name"])){tech_canvas_ctx.strokeStyle="rgb(88, 88, 88)";tech_canvas_ctx.lineWidth=1}else{if(sequence==8)tech_canvas_ctx.strokeStyle="rgba(55, 83, 204, 0.83)";else if(sequence==7)tech_canvas_ctx.strokeStyle="rgba(81, 146, 187, 0.8)";else if(sequence==6)tech_canvas_ctx.strokeStyle="rgba(121, 127, 82, 0.88)";else if(sequence==5)tech_canvas_ctx.strokeStyle="rgba(138, 36, 78, 0.8)";else if(sequence==4)tech_canvas_ctx.strokeStyle="rgba(161, 227, 243, 0.8)";else if(sequence==3)tech_canvas_ctx.strokeStyle="rgba(60, 187, 146, 0.8)";else if(sequence==2)tech_canvas_ctx.strokeStyle="rgba(0, 00, 45, 0.9)";else if(sequence==1)tech_canvas_ctx.strokeStyle="rgba(223, 223, 223, 0.8)";else tech_canvas_ctx.strokeStyle="rgba(189, 91, 79, 0.85)";tech_canvas_ctx.lineWidth=3}var node_offset=3;tech_canvas_ctx.beginPath();tech_canvas_ctx.moveTo(sx,sy+hy);tech_canvas_ctx.lineTo(dx+hx+(node_offset+1),dy+hy);tech_canvas_ctx.stroke();var radius=2;tech_canvas_ctx.lineWidth=4;tech_canvas_ctx.beginPath();tech_canvas_ctx.arc(dx+hx+radius+node_offset,dy+hy,radius,0,2*Math.PI,false);tech_canvas_ctx.stroke()}}tech_canvas_ctx.lineWidth=1;const KNOWN_TECH_FRAME="rgb(179,179,179)";const KNOWN_TECH_FILL="rgb(224,224,224)";const CUR_TECH_FRAME="rgb(0, 0, 0)";const FUTURE_TECH_FRAME="rgb(255, 255, 255)";const POSSIBLE_TECH_FRAME="rgb(71, 92, 55)";const UNKNOWN_TECH_FRAME="rgb(50, 67, 84)";const POSSIBLE_AND_FUTURE_FILL="rgb(128, 178, 159)";for(var tech_id in techs){var ptech=techs[tech_id];if(!(tech_id+""in reqtree)||reqtree[tech_id+""]==null)continue;var x=Math.floor(reqtree[tech_id+""]["x"]*tech_xscale)+2;var y=reqtree[tech_id+""]["y"]+2;if(player_invention_state(client.conn.playing,ptech["id"])==TECH_KNOWN){var tag=tileset_tech_graphic_tag(ptech);tech_canvas_ctx.fillStyle=KNOWN_TECH_FILL;tech_canvas_ctx.fillRect(x-2,y-2,tech_item_width,tech_item_height);tech_canvas_ctx.strokeStyle=KNOWN_TECH_FRAME;tech_canvas_ctx.strokeRect(x-2,y-2,tech_item_width,tech_item_height);mapview_put_tile(tech_canvas_ctx,tag,x+1,y);if(ptech["name"].length>17)tech_canvas_ctx.font=tech_canvas_text_font_alt;else tech_canvas_ctx.font=tech_canvas_text_font;tech_canvas_ctx.fillStyle="rgba(0, 0, 0, 1)";tech_canvas_ctx.fillText(ptech["name"],x+50,y+15);if(x>maxleft)maxleft=x}else if(player_invention_state(client.conn.playing,ptech["id"])==TECH_PREREQS_KNOWN){var bgcolor=client.conn.playing!=null&&is_tech_req_for_goal(ptech["id"],client.conn.playing["tech_goal"])?"rgb(131, 170, 101)":"rgb(91, 130, 61)";if(client.conn.playing["researching"]==ptech["id"]){bgcolor="rgb(171, 199, 149)";tech_canvas_ctx.lineWidth=6;tech_canvas_ctx.strokeStyle=CUR_TECH_FRAME}else if(client.conn.playing["tech_goal"]==ptech["id"]){tech_canvas_ctx.lineWidth=6;bgcolor=POSSIBLE_AND_FUTURE_FILL;tech_canvas_ctx.strokeStyle=FUTURE_TECH_FRAME;tech_canvas_ctx.fillStyle="rgb(0, 0, 0)"}var tag=tileset_tech_graphic_tag(ptech);tech_canvas_ctx.fillStyle=bgcolor;tech_canvas_ctx.fillRect(x-2,y-2,tech_item_width,tech_item_height);if(tech_canvas_ctx.lineWidth<6){tech_canvas_ctx.lineWidth=2;tech_canvas_ctx.strokeStyle=POSSIBLE_TECH_FRAME}tech_canvas_ctx.strokeRect(x-2,y-2,tech_item_width,tech_item_height);tech_canvas_ctx.lineWidth=1;mapview_put_tile(tech_canvas_ctx,tag,x+1,y);if(client.conn.playing["researching"]==ptech["id"]){tech_canvas_ctx.fillStyle="rgb(0, 0, 0)";if(ptech["name"].length>17)tech_canvas_ctx.font="Bold "+tech_canvas_text_font_redux;else tech_canvas_ctx.font="Bold "+tech_canvas_text_font}else{if(ptech["name"].length>17)tech_canvas_ctx.font=tech_canvas_text_font_alt;else tech_canvas_ctx.font=tech_canvas_text_font;tech_canvas_ctx.fillStyle="rgb(255, 255, 255)"}tech_canvas_ctx.fillText(ptech["name"],x+51,y+16)}else if(player_invention_state(client.conn.playing,ptech["id"])==TECH_UNKNOWN){var bgcolor=client.conn.playing!=null&&is_tech_req_for_goal(ptech["id"],client.conn.playing["tech_goal"])?"rgb(133, 167, 212)":"rgb(61, 95, 130)";if(client.conn.playing["tech_goal"]==ptech["id"]){tech_canvas_ctx.lineWidth=6;tech_canvas_ctx.strokeStyle=FUTURE_TECH_FRAME}var tag=tileset_tech_graphic_tag(ptech);tech_canvas_ctx.fillStyle=bgcolor;tech_canvas_ctx.fillRect(x-2,y-2,tech_item_width,tech_item_height);if(tech_canvas_ctx.lineWidth<6)tech_canvas_ctx.strokeStyle=UNKNOWN_TECH_FRAME;tech_canvas_ctx.strokeRect(x-2,y-2,tech_item_width,tech_item_height);tech_canvas_ctx.lineWidth=1;mapview_put_tile(tech_canvas_ctx,tag,x+1,y);if(client.conn.playing["tech_goal"]==ptech["id"]){tech_canvas_ctx.fillStyle="rgb(0, 0, 0)";if(ptech["name"].length>17)tech_canvas_ctx.font="Bold "+tech_canvas_text_font_redux;else tech_canvas_ctx.font="Bold "+tech_canvas_text_font}else{tech_canvas_ctx.fillStyle="rgb(255, 255, 255)";if(ptech["name"].length>17)tech_canvas_ctx.font=tech_canvas_text_font_alt;else tech_canvas_ctx.font=tech_canvas_text_font}tech_canvas_ctx.fillText(ptech["name"],x+51,y+16)}var tech_things=0;var prunits=get_utypes_from_tech(tech_id);for(var i=0;i<prunits.length;i++){var ptype=prunits[i];if(utype_has_flag(ptype,UTYF_NUCLEAR)){if(!server_settings["nukes_minor"]["val"])continue;if(!server_settings["nukes_major"]["val"]){if(ptype["bombard_rate"]>0)continue;if(ptype["bombard_rate"]<-1)continue}}var sprite=sprites[tileset_unit_type_graphic_tag(ptype)];if(sprite!=null){tech_canvas_ctx.drawImage(sprite,x+50+tech_things++*30,y+23,28,24)}}var primprovements=get_improvements_from_tech(tech_id);for(var i=0;i<primprovements.length;i++){var pimpr=primprovements[i];if((!server_settings["nukes_major"]["val"]||!server_settings["nukes_minor"]["val"])&&pimpr["name"]=="Enrichment Facility"){continue}if(!server_settings["nukes_minor"]["val"]&&pimpr["name"]=="Manhattan Project"){continue}if(pimpr.name!=alphanumeric_cleaner(pimpr.name))continue;var sprite=sprites[tileset_building_graphic_tag(pimpr)];if(sprite!=null){tech_canvas_ctx.drawImage(sprite,x+50+tech_things++*30,y+23,28,24)}}}}function is_tech_req_for_goal(check_tech_id,goal_tech_id){if(check_tech_id==goal_tech_id)return true;if(goal_tech_id==0||check_tech_id==0)return false;var goal_tech=techs[goal_tech_id];if(goal_tech==null)return false;for(var i=0;i<goal_tech["req"].length;i++){var rid=goal_tech["req"][i];if(check_tech_id==rid){return true}else if(is_tech_req_for_goal(check_tech_id,rid)){return true}}return false}function is_tech_req_for_tech(check_tech_id,next_tech_id){if(check_tech_id==next_tech_id)return false;if(next_tech_id==0||check_tech_id==0)return false;var next_tech=techs[next_tech_id];if(next_tech==null)return false;for(var i=0;i<next_tech["req"].length;i++){var rid=next_tech["req"][i];if(check_tech_id==rid){return true}}return false}function update_tech_screen(){if(client_is_observer()||client.conn.playing==null){show_observer_tech_dialog();return}init_tech_screen();update_tech_tree();var research_goal_text="No research target selected.<br>Please select a technology now";if(techs[client.conn.playing["researching"]]!=null){research_goal_text=touch_device?"Current Research: ":"Research:";research_goal_text+=techs[client.conn.playing["researching"]]["name"]}if(techs[client.conn.playing["tech_goal"]]!=null){if(!touch_device)research_goal_text+="<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Future Goal: ";else research_goal_text+="&nbsp;<font color='lightskyblue'>Future Goal:</font>";research_goal_text+=techs[client.conn.playing["tech_goal"]]["name"]}$("#tech_goal_box").html(research_goal_text);$("#tech_progress_text").html("Research progress: "+client.conn.playing["bulbs_researched"]+" / "+client.conn.playing["researching_cost"]);var pct_progress=100*(client.conn.playing["bulbs_researched"]/client.conn.playing["researching_cost"]);$("#progress_fg").css("width",pct_progress+"%");var is_wide_screen=$(window).width()<1590?false:true;if(clicked_tech_id!=null){switch(techs[clicked_tech_id].name){case"Space Flight":case"Automobile":case"Rocketry":case"Industrialization":fs="80%";break;default:fs="90%"}var tech_help_text=html_safe(cleaned_text(techs[clicked_tech_id].helptext));if(touch_device)$("#tech_results").css("margin-left","-22px");$("#tech_result_text").html("<span style='font-size:"+fs+"' title='"+tech_help_text+"' id='tech_advance_helptext'>"+get_advances_text(clicked_tech_id)+" "+(is_wide_screen?"":"")+"</span>");$("#tech_advance_helptext").tooltip({disabled:false})}else if(techs[client.conn.playing["researching"]]!=null){switch(techs[client.conn.playing["researching"]].name){case"Space Flight":case"Automobile":case"Rocketry":case"Industrialization":fs="80%";break;default:fs="90%"}var research_help_text=html_safe(cleaned_text(techs[client.conn.playing["researching"]].helptext));$("#tech_result_text").html("<span style='font-size:"+fs+"' title='"+research_help_text+"' id='tech_advance_helptext'>"+get_advances_text(client.conn.playing["researching"])+" "+(is_wide_screen?"":"")+"</span>");$("#tech_advance_helptext").tooltip({disabled:false})}$("#tech_tab_item").css("color","#000000");maxleft=maxleft-280;if(maxleft<0)maxleft=0;if(!tech_dialog_active){setTimeout(scroll_tech_tree,10)}tech_dialog_active=true}function get_advances_text(tech_id){const num=value=>value===null?"null":value;const tech_span=(name,unit_id,impr_id,title)=>`<span ${title?`title='${title}'`:""}`+` onclick='show_tech_info_dialog("${name}", ${num(unit_id)}, ${num(impr_id)})'>${name}</span>`;const is_valid_and_required=next_tech_id=>reqtree.hasOwnProperty(next_tech_id)&&is_tech_req_for_tech(tech_id,next_tech_id);const format_list_with_intro=(intro,list)=>(list=list.filter(Boolean)).length?intro+" "+list.join(", "):"";const ptech=techs[tech_id];var cost=ptech.cost;if(game_info["sciencebox"]!=100){cost=ptech.cost*game_info["sciencebox"]/100}return tech_span(ptech.name,null,null)+" ("+Math.floor(cost)+")"+format_list_with_intro(" enables",[format_list_with_intro("",get_utypes_from_tech(tech_id).map(unit=>tech_span(unit.name,unit.id,null,"A:"+fractionalize(utype_real_base_attack_strength(unit))+" D:"+fractionalize(utype_real_base_defense_strength(unit))+(unit.firepower>1?" F:"+unit.firepower:"")+" H:"+unit.hp+" M:"+move_points_text(unit.move_rate+(unit.move_bonus[0]?unit.move_bonus[0]:0),true)+(unit.fuel?"("+unit.fuel+")":"")+(unit.transport_capacity?" C:"+unit.transport_capacity:"")+" Cost:"+unit.build_cost+"\n\n"+html_safe(cleaned_text(unit.helptext))))),format_list_with_intro("",get_improvements_from_tech(tech_id).map(impr=>tech_span(impr.name,null,impr.id,"Cost:"+impr.build_cost+" Upkeep:"+impr.upkeep+"\n\n"+html_safe(cleaned_text(impr.helptext))))),format_list_with_intro("",Object.keys(techs).filter(is_valid_and_required).map(tid=>techs[tid]).map(tech=>tech_span(tech.name,null,null,tech.rule_name+" ("+Math.trunc(tech.cost)+") "+uncapitalize(html_safe(cleaned_text(tech.helptext))))))])+"."}function scroll_tech_tree(){$("#technologies").scrollLeft(maxleft)}function send_player_research(tech_id){var packet={pid:packet_player_research,tech:tech_id};send_request(JSON.stringify(packet));remove_active_dialog("#tech_dialog")}function send_player_tech_goal(tech_id){var packet={pid:packet_player_tech_goal,tech:tech_id};send_request(JSON.stringify(packet))}function tech_mapview_mouse_click(e){var mouse_button;if(e.which){mouse_button=e.which}else if(e.button){mouse_button=e.button+1}if(mouse_button==3&&!e.altKey){if(mouse_x>$(window).width()/2){$("#technologies").scrollLeft($("#technologies").scrollLeft()+mouse_x/2)}else{$("#technologies").scrollLeft($("#technologies").scrollLeft()-($("#technologies").width()-mouse_x-12)/2)}return}if(tech_canvas!=null){var tech_mouse_x=mouse_x-$("#technologies").offset().left+$("#technologies").scrollLeft();var tech_mouse_y=mouse_y-$("#technologies").offset().top+$("#technologies").scrollTop();for(var tech_id in techs){var ptech=techs[tech_id];if(!(tech_id+""in reqtree))continue;var x=Math.floor(reqtree[tech_id+""]["x"]*tech_xscale)+2;var y=reqtree[tech_id+""]["y"]+2;if(is_small_screen()){x=x*.6;y=y*.6}if(tech_mouse_x>x&&tech_mouse_x<x+tech_item_width&&tech_mouse_y>y&&tech_mouse_y<y+tech_item_height){if(mouse_button==2||mouse_button==3&&e.altKey)send_player_tech_goal(ptech["id"]);else if(player_invention_state(client.conn.playing,ptech["id"])==TECH_PREREQS_KNOWN){var adjusted_tech_cost=Math.max(1,Math.floor(ptech["cost"]*game_info["sciencebox"]/100));if(client.conn.playing["bulbs_researched"]>=adjusted_tech_cost){var swal_tech_id=ptech["id"];var warning_text="You will immediately discover "+ptech["name"]+".";var extra_title="";if(!!techs[client.conn.playing["tech_goal"]]){warning_text+=".\n\n";if(techs[client.conn.playing["tech_goal"]]["id"]!=swal_tech_id){warning_text+="Extra bulbs instantly go toward "+techs[client.conn.playing["tech_goal"]]["name"]+".\n";warning_text+="\nSet Future Goal to "+ptech["name"]+" to prevent this.";extra_title="\nthen proceed to "+techs[client.conn.playing["tech_goal"]]["name"]}}swal({title:"Research "+ptech["name"]+extra_title+"?",text:warning_text,type:"info",background:"#a19886",showCancelButton:true,confirmButtonColor:"#38e",cancelButtonColor:"#d33",confirmButtonText:"Yes",cancelButtonText:"No"},function(){send_player_research(swal_tech_id)});setSwalTheme()}else send_player_research(ptech["id"])}else if(player_invention_state(client.conn.playing,ptech["id"])==TECH_UNKNOWN){send_player_tech_goal(ptech["id"])}clicked_tech_id=ptech["id"]}}}update_tech_screen()}function get_tech_infobox_html(tech_id){var infobox_html="";var ptech=techs[tech_id];var tag=tileset_tech_graphic_tag(ptech);if(tag==null)return null;var tileset_x=tileset[tag][0];var tileset_y=tileset[tag][1];var width=tileset[tag][2];var height=tileset[tag][3];var i=tileset[tag][4];var image_src="/tileset/freeciv-web-tileset-"+tileset_name+"-"+i+get_tileset_file_extention()+"?ts="+ts;if(is_small_screen()){infobox_html+="<div class='specific_tech' style='transform: scale(1.0);' onclick='send_player_research("+tech_id+")'>"+ptech["name"]+"</div>"}else{infobox_html+="<div class='specific_tech' onclick='send_player_research("+tech_id+")'>"+"<div class='tech_infobox_image' style='background: transparent url("+image_src+"); background-position:-"+tileset_x+"px -"+tileset_y+"px;  width: "+width+"px;height: "+height+"px;'></div>"+get_advances_text(tech_id).replace(stripChar,"")+"</div>"}return infobox_html}function check_queued_tech_gained_dialog(){if(!is_pbem()||players.length<2)return;var queued_tech=simpleStorage.get(get_pbem_game_key(),"");if(queued_tech!=null){remove_active_dialog("#dialog");show_tech_gained_dialog(queued_tech);simpleStorage.set(get_pbem_game_key(),null)}}function queue_tech_gained_dialog(tech_gained_id){if(client_is_observer()||C_S_RUNNING!=client_state())return;if(is_pbem()&&pbem_phase_ended){simpleStorage.set(get_pbem_game_key(),tech_gained_id)}else{show_tech_gained_dialog(tech_gained_id)}}function show_tech_gained_dialog(tech_gained_id){if(client_is_observer()||C_S_RUNNING!=client_state())return;$("#tech_tab_item").css("color","#aa0000");var pplayer=client.conn.playing;var tech=techs[tech_gained_id];if(tech==null)return;var title=tech["name"]+" discovered!";var message="The "+nations[pplayer["nation"]]["adjective"]+" have discovered "+tech["name"]+".<br>";message+="<span id='tech_advance_helptext'>"+get_advances_text(tech_gained_id)+" "+"</span>";var tech_choices=[];for(var next_tech_id in techs){var ntech=techs[next_tech_id];if(!(next_tech_id+""in reqtree))continue;if(player_invention_state(client.conn.playing,ntech["id"])==TECH_PREREQS_KNOWN){tech_choices.push(ntech)}}message+="<br>You can now research:<br><div id='tech_gained_choice'>";for(var i=0;i<tech_choices.length;i++){message+=get_tech_infobox_html(tech_choices[i]["id"])}message+="</div>";remove_active_dialog("#tech_dialog");$("<div id='tech_dialog'></div>").appendTo("div#game_page");$("#tech_dialog").html(message);$("#tech_dialog").attr("title",title);$("#tech_dialog").dialog({bgiframe:true,modal:false,width:is_small_screen()?"90%":"60%",buttons:[{text:"Close (𝗪)",click:function(){remove_active_dialog("#tech_dialog");$("#game_text_input").blur()}},{text:"Show Technology Tree",click:function(){$("#tabs").tabs("option","active",TAB_TECH);set_default_mapview_inactive();update_tech_screen();remove_active_dialog("#tech_dialog")}}]});$("#tech_dialog").dialog("open");dialog_register("#tech_dialog");$("#game_text_input").blur();$("#tech_advance_helptext").tooltip({disabled:false});$(".specific_tech").tooltip({disabled:false})}function show_wikipedia_dialog(tech_name){$("#tech_tab_item").css("color","#aa0000");if(freeciv_wiki_docs==null||freeciv_wiki_docs[tech_name]==null)return;if(freeciv_wiki_docs[tech_name]==null)return;var message="<b>Wikipedia on <a href='"+wikipedia_url+freeciv_wiki_docs[tech_name]["title"]+"' target='_new'>"+freeciv_wiki_docs[tech_name]["title"]+"</a></b><br>";if(freeciv_wiki_docs[tech_name]["image"]!=null){message+="<img id='wiki_image' src='/images/wiki/"+freeciv_wiki_docs[tech_name]["image"]+"'><br>"}message+=freeciv_wiki_docs[tech_name]["summary"];remove_active_dialog("#wiki_dialog");$("<div id='wiki_dialog'></div>").appendTo("div#game_page");$("#wiki_dialog").html(message);$("#wiki_dialog").attr("title",tech_name);$("#wiki_dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"90%":"60%",buttons:{"OK (𝗪)":function(){remove_active_dialog("#wiki_dialog")}}});$("#wiki_dialog").dialog("open");dialog_register("#wiki_dialog");$("#wiki_dialog").css("max-height",$(window).height()-100);$("#game_text_input").blur()}function show_tech_info_dialog(tech_name,unit_type_id,improvement_id){$("#tech_tab_item").css("color","#aa0000");var message="";if(unit_type_id!=null){var punit_type=unit_types[unit_type_id];var move_bonus=parseInt(punit_type["move_bonus"][0])?parseInt(punit_type["move_bonus"][0]):0;var move_rate="";move_rate+=move_points_text(parseInt(punit_type["move_rate"])+move_bonus,false);message+="<b>Unit info</b>: "+cleaned_text(punit_type["helptext"])+"<br>"+"</b><br>Cost: <b>"+punit_type["build_cost"]+"</b><br>Attack: <b>"+utype_real_base_attack_strength(punit_type)+"</b><br>Defense: <b>"+utype_real_base_defense_strength(punit_type)+"</b><br>Firepower: <b>"+punit_type["firepower"]+"</b><br>Hitpoints: <b>"+punit_type["hp"]+"</b><br>Moves: <b>"+move_rate+"</b><br>Vision: <b>"+punit_type["vision_radius_sq"]+"</b><br><br>"}if(improvement_id!=null)message+="<b>Improvement info</b>: "+cleaned_text(improvements[improvement_id]["helptext"])+"<br><br>";if(freeciv_wiki_docs[tech_name]!=null){var tech_id=tech_id_by_name(tech_name);const num=value=>value===null?"null":value;const tech_span=(name,unit_id,impr_id,title)=>`<span ${title?`title='${title}'`:""}`+` onclick='show_tech_info_dialog("${name}", ${num(unit_id)}, ${num(impr_id)}")'>${name}</span>`;const is_valid_and_required=next_tech_id=>reqtree.hasOwnProperty(next_tech_id)&&is_tech_req_for_tech(tech_id,next_tech_id);const format_list_with_intro=(intro,list)=>(list=list.filter(Boolean)).length?intro+" "+list.join(", "):"";if(tech_id!=null){message+="<b>"+tech_name+"</b>"+format_list_with_intro(" enables",[format_list_with_intro("",get_utypes_from_tech(tech_id).map(unit=>tech_span(unit.name,unit.id,null,html_safe(cleaned_text(unit.helptext))))),format_list_with_intro("",get_improvements_from_tech(tech_id).map(impr=>tech_span(impr.name,null,impr.id,html_safe(cleaned_text(impr.helptext))))),format_list_with_intro("",Object.keys(techs).filter(is_valid_and_required).map(tid=>techs[tid]).map(tech=>tech_span(tech.name,null,null)))])+".<br>";message+=html_safe(cleaned_text(techs[tech_id].helptext))+"<br><br>"}message+="<b>Wikipedia on <a href='"+wikipedia_url+freeciv_wiki_docs[tech_name]["title"]+"' target='_new' style='color: black;'>"+freeciv_wiki_docs[tech_name]["title"]+"</a>:</b><br>";if(freeciv_wiki_docs[tech_name]["image"]!=null){message+="<img id='wiki_image' src='/images/wiki/"+freeciv_wiki_docs[tech_name]["image"]+"'><br>"}message+=freeciv_wiki_docs[tech_name]["summary"]}remove_active_dialog("#wiki_dialog");$("<div id='wiki_dialog'></div>").appendTo("div#game_page");$("#wiki_dialog").html(message);$("#wiki_dialog").attr("title",tech_name);$("#wiki_dialog").dialog({bgiframe:true,modal:true,width:is_small_screen()?"95%":"70%",height:$(window).height()-60,buttons:{"OK (𝗪)":function(){remove_active_dialog("#wiki_dialog")}}});$("#wiki_dialog").dialog("open");dialog_register("#wiki_dialog");$("#game_text_input").blur()}function update_tech_dialog_cursor(){tech_canvas.style.cursor="default";var tech_mouse_x=mouse_x-$("#technologies").offset().left+$("#technologies").scrollLeft();var tech_mouse_y=mouse_y-$("#technologies").offset().top+$("#technologies").scrollTop();for(var tech_id in techs){var ptech=techs[tech_id];if(!(tech_id+""in reqtree))continue;var x=Math.floor(reqtree[tech_id+""]["x"]*tech_xscale)+2;var y=reqtree[tech_id+""]["y"]+2;if(is_small_screen()){x=x*.6;y=y*.6}if(tech_mouse_x>x&&tech_mouse_x<x+tech_item_width&&tech_mouse_y>y&&tech_mouse_y<y+tech_item_height){if(player_invention_state(client.conn.playing,ptech["id"])==TECH_PREREQS_KNOWN){tech_canvas.style.cursor="pointer"}else if(player_invention_state(client.conn.playing,ptech["id"])==TECH_UNKNOWN){tech_canvas.style.cursor="pointer"}else{tech_canvas.style.cursor="not-allowed"}if(hover_tech_id!=tech_id){hover_tech_id=tech_id;hover_tech_oldest_time=Date.now();return}else{if(Date.now()-hover_tech_oldest_time<hover_tech_delay)return}var fs;switch(ptech["name"]){case"Space Flight":case"Automobile":case"Rocketry":case"Industrialization":fs="80%";break;default:fs="90%"}var is_wide_screen=$(window).width()<1590?false:true;var tech_help_text=html_safe(cleaned_text(techs[ptech["id"]].helptext));$("#tech_result_text").html("<span title='"+tech_help_text+"' style='margin-left:-4px; font-size:"+fs+"' id='tech_advance_helptext'>"+get_advances_text(ptech["id"])+"</span><span style='color: #ffd588; font-size:"+fs+"'>&nbsp;"+(is_wide_screen?tech_help_text:"")+"</span>");$("#tech_advance_helptext").tooltip({disabled:false})}}}function show_observer_tech_dialog(){$("#tech_info_box").hide();$("#tech_canvas").hide();var msg="<h2>Research</h2>";for(var player_id in players){var pplayer=players[player_id];var pname=pplayer["name"];var pr=research_get(pplayer);if(pr==null)continue;var researching=pr["researching"];if(techs[researching]!=null){msg+=pname+": "+techs[researching]["name"]+"<br>"}}$("#technologies").html(msg);$("#technologies").css("color","#dcb")}function get_current_bulbs_output(){var self_bulbs=0;var self_upkeep=0;var pooled=false;var team_bulbs=0;var team_upkeep=0;if(!client_is_observer()&&client.conn.playing!=null){var cplayer=client.conn.playing.playerno;for(var city_id in cities){var city=cities[city_id];if(city.owner===cplayer&&city.prod!=null){self_bulbs+=city.prod[O_SCIENCE]}}self_upkeep=client.conn.playing.tech_upkeep;if(game_info["team_pooled_research"]){var team=client.conn.playing.team;for(var player_id in players){var player=players[player_id];if(player.team===team&&player.is_alive){team_upkeep+=player.tech_upkeep;if(player.playerno!==cplayer){pooled=true}}}if(pooled){team_bulbs=research_data[team].total_bulbs_prod}}if(!pooled){team_bulbs=self_bulbs;team_upkeep=self_upkeep}}return{self_bulbs:self_bulbs,self_upkeep:self_upkeep,pooled:pooled,team_bulbs:team_bulbs,team_upkeep:team_upkeep}}function get_current_bulbs_output_text(cbo){if(cbo===undefined){cbo=get_current_bulbs_output()}var text;if(cbo.self_bulbs===0&&cbo.self_upkeep===0){text="No bulbs researched"}else{text=cbo.self_bulbs;var net=cbo.self_bulbs-cbo.self_upkeep;if(cbo.self_upkeep!==0){text=text+" - "+cbo.self_upkeep+" = "+net}if(1==Math.abs(net)){text=text+" bulb/turn"}else{text=text+" bulbs/turn"}}if(cbo.pooled){text=text+" ("+(cbo.team_bulbs-cbo.team_upkeep)+" team total)"}if(cbo.team_bulbs>0&&client.conn.playing["researching_cost"]!=0){var turns_left=Math.ceil((client.conn.playing["researching_cost"]-client.conn.playing["bulbs_researched"])/cbo.team_bulbs);var turns_left_plural=turns_left>1?" turns)":" turn)";var turns_left_text=" ("+turns_left+turns_left_plural;text=text+turns_left_text}bulb_output_text=text;return text}function update_bulbs_output_info(){var cbo=get_current_bulbs_output();$("#bulbs_output").html(get_current_bulbs_output_text(cbo));update_net_bulbs(cbo.self_bulbs-cbo.self_upkeep)}function tech_id_by_name(tname){for(var tech_id in techs){if(tname==techs[tech_id]["name"])return tech_id}return null}function click_tech_tab(){$("#tech_tab_item").click()}var terrains={};var resources={};var terrain_control={};function tile_set_terrain(ptile,pterrain){ptile["terrain"]=pterrain}function tile_terrain(ptile){if(ptile)return terrains[ptile["terrain"]]}function tile_terrain_near(ptile){var tterrain_near=[];for(var dir=0;dir<8;dir++){var tile1=mapstep(ptile,dir);if(tile1!=null&&tile_get_known(tile1)!=TILE_UNKNOWN){var terrain1=tile_terrain(tile1);if(null!=terrain1){tterrain_near[dir]=terrain1;continue}freelog(LOG_ERROR,`build_tile_data() tile (${ptile["x"]},${ptile["y"]}) has no terrain!`)}tterrain_near[dir]=tile_terrain(ptile)}return tterrain_near}function is_ocean_tile(ptile){if(!ptile)return false;var pterrain=tile_terrain(ptile);if(!pterrain||!pterrain["graphic_str"])return false;return pterrain["graphic_str"]=="floor"||pterrain["graphic_str"]=="coast"}var TILE_UNKNOWN=0;var TILE_KNOWN_UNSEEN=1;var TILE_KNOWN_SEEN=2;function tile_get_known(ptile){if(ptile["known"]==null||ptile["known"]==TILE_UNKNOWN){return TILE_UNKNOWN}else if(ptile["known"]==TILE_KNOWN_UNSEEN){return TILE_KNOWN_UNSEEN}else if(ptile["known"]==TILE_KNOWN_SEEN){return TILE_KNOWN_SEEN}}function tile_has_extra(ptile,extra){if(!ptile||ptile["extras"]==null){return false}return ptile["extras"].isSet(extra)}function tile_resource(tile){if(tile!=null&&tile.extras!=null){const tile_extras=tile.extras.toBitSet();for(var extra in tile_extras){if(is_extra_caused_by(extras[tile_extras[extra]],EC_RESOURCE)){return tile_extras[extra]}}}return null}function tile_owner(tile){return tile["owner"]}function tile_set_owner(tile,owner,claimer){tile["owner"]=owner}function tile_worked(tile){return tile["worked"]}function tile_set_worked(ptile,pwork){ptile["worked"]=pwork}function does_tile_have_base(ptile){if(typeof EXTRA_FORTRESS!=="undefined"&&tile_has_extra(ptile,EXTRA_FORTRESS))return true;if(typeof EXTRA_FORT!=="undefined"&&tile_has_extra(ptile,EXTRA_FORT))return true;if(typeof EXTRA_AIRBASE!=="undefined"&&tile_has_extra(ptile,EXTRA_AIRBASE))return true;if(typeof EXTRA_NAVALBASE!=="undefined"&&tile_has_extra(ptile,EXTRA_NAVALBASE))return true;if(typeof EXTRA_AIRSTRIP!=="undefined"&&tile_has_extra(ptile,EXTRA_AIRSTRIP))return true;if(typeof EXTRA_CASTLE!=="undefined"&&tile_has_extra(ptile,EXTRA_CASTLE))return true;if(typeof EXTRA_BUNKER!=="undefined"&&tile_has_extra(ptile,EXTRA_BUNKER))return true;if(typeof EXTRA_!=="undefined"&&tile_has_extra(ptile,EXTRA_))return true;return false}function tile_city(ptile){if(ptile==null)return null;var city_id=ptile["worked"];var pcity=cities[city_id];if(pcity!=null&&is_city_center(pcity,ptile)){return pcity}return null}function improve_tile_info_dialog(message){var added_text="";var ttype=0;var tindex=Object.keys(terrains).length;var tinvalid=Object.keys(terrains).length;if(mclick_tile){tindex=mclick_tile["terrain"];ttype=terrains[tindex]}if(mclick_tile)ttype=terrains[mclick_tile["terrain"]];var wt=1;for(var i=0;i<Object.keys(unit_types).length;i++){if(unit_types[i]["name"]=="Workers"){wt=unit_types[i]["move_rate"]/SINGLE_MOVE;break}}if(ttype){var has_river="";var db=parseFloat(1)+parseFloat(ttype["defense_bonus"])/100;if(message.includes("River</b>")){has_river=" (<span style='color:#5d97ed;' class='black_shadow'><b>River</b></span>)";if(client_rules_flag[CRF_MP2_C])db+=.5;else db*=1+extras[EXTRA_RIVER]["defense_bonus"]/100;db=Math.round((db+Number.EPSILON)*100)/100}added_text+="<span class='black_shadow' style='color:rgb("+ttype["color_red"]+","+ttype["color_green"]+","+ttype["color_blue"]+")'><br><br><b>"+ttype["name"]+"</b>"+has_river+"<br></span>";added_text+="Defense Bonus: <b>"+db+"&times;</b> &nbsp;&nbsp;&nbsp; Movement Cost: <b>"+ttype["movement_cost"]+"</b><br>";if(ttype["irrigation_time"]){added_text+="<span class='highlight_irrigation'>Irrigate:<b>"+Math.ceil(ttype["irrigation_time"]/wt)+"</b></span>";if(ttype["irrigation_food_incr"])added_text+=" (+"+ttype["irrigation_food_incr"]+")"}if(ttype["cultivate_time"]){added_text+="&nbsp;&nbsp; <span class='highlight_cultivate'>Cultivate:<b>"+Math.ceil(ttype["cultivate_time"]/wt)+"</b></span>";if(ttype["irrigation_result"]&&ttype["irrigation_result"]!=tindex&&ttype["irrigation_result"]!=tinvalid){added_text+="&#10145;"+terrains[ttype["irrigation_result"]]["name"]}}if(ttype["mining_time"]){added_text+="&nbsp;&nbsp; <span class='highlight_mining'>Mine:<b>"+Math.ceil(ttype["mining_time"]/wt)+"</b></span>";if(ttype["mining_shield_incr"])added_text+=" (+"+ttype["mining_shield_incr"]+")"}if(ttype["plant_time"]){added_text+="&nbsp;&nbsp; <span class='highlight_plant'>Plant:<b>"+Math.ceil(ttype["plant_time"]/wt)+"</b></span>";if(ttype["mining_result"]&&ttype["mining_result"]!=tindex&&ttype["mining_result"]!=tinvalid){added_text+="&#10145;"+terrains[ttype["mining_result"]]["name"]}}if(ttype["transform_time"])added_text+="&nbsp;&nbsp; <span class='highlight_transforming'>Transform:<b>"+Math.ceil(ttype["transform_time"]/wt)+"</b></span>";if(ttype["transform_result"]&&ttype["transform_result"]!=tindex&&ttype["transform_result"]!=tinvalid)added_text+="&#10145;"+terrains[ttype["transform_result"]]["name"];if(ttype["road_time"])added_text+="&nbsp;&nbsp; <span class='highlight_roading'>Road:<b>"+Math.ceil(ttype["road_time"]/wt)+"</b></span>";added_text+="<br>"+cleaned_text(ttype["helptext"])+"<br><br>"}warcalc_reset_roles();var sunits=tile_units(mclick_tile);if(my_hp&&sunits&&sunits.length>0)warcalc_set_default_vals(sunits[0]);if(my_hp&&their_hp&&sunits&&units[my_uid]&&units[their_uid]&&sunits.length>0){$("#id_astr").val(my_str);$("#id_dstr").val(their_str);$("#id_ahp").val(my_hp);$("#id_dhp").val(their_hp);$("#id_afp").val(my_fp);$("#id_dfp").val(their_fp);$("#att_win").html("");$("#def_win").html("");warcalc_compute();var A_val=parseFloat(my_str)<.1?my_str.toFixed(2):my_str.toFixed(1);var D_val=parseFloat(their_str)<.1?their_str.toFixed(2):their_str.toFixed(1);added_text+="<b>Combat odds:</b><span style='font-size:75%'> (*before base or unit-type bonus)</span><br>";added_text+="A:<b>"+A_val+"</b>  HP:<b>"+my_hp+"</b>  FP:<b>"+my_fp+"</b>  ("+unit_types[units[my_uid]["type"]]["name"]+")<br>";added_text+="D:<b>"+D_val+"</b>  HP:<b>"+their_hp+"</b>  FP:<b>"+their_fp+"</b>  ";added_text+="("+unit_types[sunits[0]["type"]]["name"]+")<br>";added_text+=$("#att_win").html();added_text+="\n<div id='click_calc' title='Base and special unit bonuses not included (e.g., Fort, Pikemen vs. Chariot)' "+"style='cursor:pointer;' onclick='improve_tile_info_warcalc_click()'>"+"<u>Click</u> to apply other bonuses</div>"}return message+added_text}function improve_tile_info_warcalc_click(){$("#ui-id-8").trigger("click");close_dialog_message();warcalc_screen()}var tileset_tile_width=96;var tileset_tile_height=48;var tileset_options="+tilespec4+2007.Oct.26";var tileset_name="amplio2";var priority=20;var tileset_image_count=3;var normal_tile_width=96;var normal_tile_height=48;var small_tile_width=15;var small_tile_height=20;var is_hex=0;var is_isometric=1;var is_mountainous=0;var roadstyle=0;var fogstyle=2;var darkness_style=4;var unit_flag_offset_x=25;var unit_flag_offset_y=16;var city_flag_offset_x=2;var city_flag_offset_y=9;var city_size_offset_x=0;var city_size_offset_y=20;var buoy_flag_offset_x=24;var buoy_flag_offset_y=-4;var unit_activity_offset_x=55;var unit_activity_offset_y=25;var unit_offset_x=25;var unit_offset_y=18;var unit_offset_adj_x=-9;var unit_offset_adj_y=-7;var is_full_citybar=1;var citybar_offset_y=55;var citybar_offset_x=45;var tilelabel_offset_y=15;var tilelabel_offset_x=0;var dither_offset_x=[normal_tile_width/2,0,normal_tile_width/2,0];var dither_offset_y=[0,normal_tile_height/2,normal_tile_height/2,0];var ts_layer=[];ts_layer[0]={};ts_layer[0]["match_types"]=["shallow","deep","land"];ts_layer[1]={};ts_layer[1]["match_types"]=["forest","hills","mountains","water","ice","jungle","tundra","swamp"];ts_layer[2]={};ts_layer[2]["match_types"]=["water","ice"];var ts_tiles={};ts_tiles["lake"]={};ts_tiles["lake"]["is_blended"]=0;ts_tiles["lake"]["num_layers"]=1;ts_tiles["lake"]["layer0_match_type"]="shallow";ts_tiles["lake"]["layer0_match_with"]=["land"];ts_tiles["lake"]["layer0_sprite_type"]="corner";ts_tiles["coast"]={};ts_tiles["coast"]["is_blended"]=1;ts_tiles["coast"]["num_layers"]=2;ts_tiles["coast"]["layer0_match_type"]="shallow";ts_tiles["coast"]["layer0_match_with"]=["deep","land"];ts_tiles["coast"]["layer0_sprite_type"]="corner";ts_tiles["coast"]["layer1_match_type"]="water";ts_tiles["coast"]["layer1_match_with"]=["ice"];ts_tiles["coast"]["layer1_sprite_type"]="corner";ts_tiles["floor"]={};ts_tiles["floor"]["is_blended"]=0;ts_tiles["floor"]["num_layers"]=2;ts_tiles["floor"]["layer0_match_type"]="deep";ts_tiles["floor"]["layer0_match_with"]=["shallow","land"];ts_tiles["floor"]["layer0_sprite_type"]="corner";ts_tiles["floor"]["layer1_match_type"]="water";ts_tiles["floor"]["layer1_match_with"]=["ice"];ts_tiles["floor"]["layer1_sprite_type"]="corner";ts_tiles["arctic"]={};ts_tiles["arctic"]["is_blended"]=0;ts_tiles["arctic"]["num_layers"]=3;ts_tiles["arctic"]["layer0_match_type"]="shallow";ts_tiles["arctic"]["layer1_match_type"]="ice";ts_tiles["arctic"]["layer2_match_type"]="ice";ts_tiles["arctic"]["mine_sprite"]="tx.oil_mine";ts_tiles["arctic"]={};ts_tiles["arctic"]["is_blended"]=1;ts_tiles["arctic"]["num_layers"]=1;ts_tiles["arctic"]["layer0_match_type"]="land";ts_tiles["arctic"]["mine_sprite"]="tx.oil_mine";ts_tiles["desert"]={};ts_tiles["desert"]["is_blended"]=1;ts_tiles["desert"]["num_layers"]=1;ts_tiles["desert"]["layer0_match_type"]="land";ts_tiles["desert"]["mine_sprite"]="tx.oil_mine";ts_tiles["forest"]={};ts_tiles["forest"]["is_blended"]=1;ts_tiles["forest"]["num_layers"]=2;ts_tiles["forest"]["layer0_match_type"]="land";ts_tiles["forest"]["layer1_match_type"]="forest";ts_tiles["forest"]["layer1_match_with"]=["forest"];ts_tiles["grassland"]={};ts_tiles["grassland"]["is_blended"]=1;ts_tiles["grassland"]["num_layers"]=1;ts_tiles["grassland"]["layer0_match_type"]="land";ts_tiles["hills"]={};ts_tiles["hills"]["is_blended"]=1;ts_tiles["hills"]["num_layers"]=2;ts_tiles["hills"]["layer0_match_type"]="land";ts_tiles["hills"]["layer1_match_type"]="hills";ts_tiles["hills"]["layer1_match_with"]=["hills"];ts_tiles["hills"]["mine_sprite"]="tx.mine";ts_tiles["jungle"]={};ts_tiles["jungle"]["is_blended"]=1;ts_tiles["jungle"]["num_layers"]=2;ts_tiles["jungle"]["layer0_match_type"]="land";ts_tiles["jungle"]["layer1_match_type"]="jungle";ts_tiles["jungle"]["layer1_match_with"]=["jungle"];ts_tiles["mountains"]={};ts_tiles["mountains"]["is_blended"]=1;ts_tiles["mountains"]["num_layers"]=2;ts_tiles["mountains"]["layer0_match_type"]="land";ts_tiles["mountains"]["layer1_match_type"]="mountains";ts_tiles["mountains"]["layer1_match_with"]=["mountains"];ts_tiles["mountains"]["mine_sprite"]="tx.mine";ts_tiles["plains"]={};ts_tiles["plains"]["is_blended"]=1;ts_tiles["plains"]["num_layers"]=1;ts_tiles["plains"]["layer0_match_type"]="land";ts_tiles["swamp"]={};ts_tiles["swamp"]["is_blended"]=1;ts_tiles["swamp"]["num_layers"]=2;ts_tiles["swamp"]["layer0_match_type"]="land";ts_tiles["swamp"]["layer1_match_type"]="swamp";ts_tiles["swamp"]["layer1_match_with"]=["swamp"];ts_tiles["tundra"]={};ts_tiles["tundra"]["is_blended"]=1;ts_tiles["tundra"]["num_layers"]=2;ts_tiles["tundra"]["layer0_match_type"]="land";ts_tiles["tundra"]["layer1_match_type"]="tundra";ts_tiles["tundra"]["layer1_match_with"]=["tundra"];ts_tiles["inaccessible"]={};ts_tiles["inaccessible"]["is_blended"]=0;ts_tiles["inaccessible"]["num_layers"]=1;ts_tiles["inaccessible"]["layer0_match_type"]="land";var tile_types_setup={"l0.lake":{match_style:MATCH_PAIR,sprite_type:CELL_CORNER,mine_tag:"(null)",match_indices:2,match_index:[0,2],dither:false},"l0.coast":{match_style:MATCH_FULL,sprite_type:CELL_CORNER,mine_tag:"(null)",match_indices:3,match_index:[0,1,2],dither:false},"l1.coast":{match_style:MATCH_PAIR,sprite_type:CELL_CORNER,mine_tag:"(null)",match_indices:2,match_index:[3,4],dither:false},"l0.floor":{match_style:MATCH_FULL,sprite_type:CELL_CORNER,mine_tag:"(null)",match_indices:3,match_index:[1,0,2],dither:false},"l1.floor":{match_style:MATCH_PAIR,sprite_type:CELL_CORNER,mine_tag:"(null)",match_indices:2,match_index:[3,4],dither:false},"l0.arctic":{match_style:MATCH_NONE,sprite_type:CELL_WHOLE,mine_tag:"tx.oil_mine",match_indices:1,match_index:[2],dither:true},"l0.desert":{match_style:MATCH_NONE,sprite_type:CELL_WHOLE,mine_tag:"tx.oil_mine",match_indices:1,match_index:[2],dither:true},"l0.forest":{match_style:MATCH_NONE,sprite_type:CELL_WHOLE,mine_tag:"(null)",match_indices:1,match_index:[2],dither:true},"l1.forest":{match_style:MATCH_SAME,sprite_type:CELL_WHOLE,mine_tag:"(null)",match_indices:2,match_index:[0,0],dither:false},"l0.grassland":{match_style:MATCH_NONE,sprite_type:CELL_WHOLE,mine_tag:"(null)",match_indices:1,match_index:[2],dither:true},"l0.hills":{match_style:MATCH_NONE,sprite_type:CELL_WHOLE,mine_tag:"tx.mine",match_indices:1,match_index:[2],dither:true},"l1.hills":{match_style:MATCH_SAME,sprite_type:CELL_WHOLE,mine_tag:"tx.mine",match_indices:2,match_index:[1,1],dither:false},"l0.jungle":{match_style:MATCH_NONE,sprite_type:CELL_WHOLE,mine_tag:"(null)",match_indices:1,match_index:[5],dither:true},"l1.jungle":{match_style:MATCH_SAME,sprite_type:CELL_WHOLE,mine_tag:"(null)",match_indices:2,match_index:[5,5],dither:false},"l0.mountains":{match_style:MATCH_NONE,sprite_type:CELL_WHOLE,mine_tag:"tx.mine",match_indices:1,match_index:[2],dither:true},"l1.mountains":{match_style:MATCH_SAME,sprite_type:CELL_WHOLE,mine_tag:"tx.mine",match_indices:2,match_index:[2,2],dither:false},"l0.plains":{match_style:MATCH_NONE,sprite_type:CELL_WHOLE,mine_tag:"(null)",match_indices:1,match_index:[2],dither:true},"l0.swamp":{match_style:MATCH_NONE,sprite_type:CELL_WHOLE,mine_tag:"(null)",match_indices:1,match_index:[2],dither:true},"l1.swamp":{match_style:MATCH_SAME,sprite_type:CELL_WHOLE,mine_tag:"(null)",match_indices:2,match_index:[5,5],dither:false},"l0.tundra":{match_style:MATCH_NONE,sprite_type:CELL_WHOLE,mine_tag:"(null)",match_indices:1,match_index:[5],dither:true},"l1.tundra":{match_style:MATCH_SAME,sprite_type:CELL_WHOLE,mine_tag:"(null)",match_indices:2,match_index:[5,5],dither:false},"l0.inaccessible":{match_style:MATCH_NONE,sprite_type:CELL_WHOLE,mine_tag:"(null)",match_indices:1,match_index:[2],dither:false}};var cellgroup_map={"coast.0":"t.l0.cellgroup_s_s_s_s","coast.1":"t.l0.cellgroup_s_s_s_s","coast.2":"t.l0.cellgroup_s_s_s_s","coast.3":"t.l0.cellgroup_s_s_s_s","coast.4":"t.l0.cellgroup_s_s_s_d","coast.5":"t.l0.cellgroup_s_d_s_s","coast.6":"t.l0.cellgroup_d_s_s_s","coast.7":"t.l0.cellgroup_s_s_d_s","coast.8":"t.l0.cellgroup_s_s_s_l","coast.9":"t.l0.cellgroup_s_l_s_s","coast.10":"t.l0.cellgroup_l_s_s_s","coast.11":"t.l0.cellgroup_s_s_l_s","coast.12":"t.l0.cellgroup_d_s_s_s","coast.13":"t.l0.cellgroup_s_s_d_s","coast.14":"t.l0.cellgroup_s_d_s_s","coast.15":"t.l0.cellgroup_s_s_s_d","coast.16":"t.l0.cellgroup_d_s_s_d","coast.17":"t.l0.cellgroup_s_d_d_s","coast.18":"t.l0.cellgroup_d_d_s_s","coast.19":"t.l0.cellgroup_s_s_d_d","coast.20":"t.l0.cellgroup_d_s_s_l","coast.21":"t.l0.cellgroup_s_l_d_s","coast.22":"t.l0.cellgroup_l_d_s_s","coast.23":"t.l0.cellgroup_s_s_l_d","coast.24":"t.l0.cellgroup_l_s_s_s","coast.25":"t.l0.cellgroup_s_s_l_s","coast.26":"t.l0.cellgroup_s_l_s_s","coast.27":"t.l0.cellgroup_s_s_s_l","coast.28":"t.l0.cellgroup_l_s_s_d","coast.29":"t.l0.cellgroup_s_d_l_s","coast.30":"t.l0.cellgroup_d_l_s_s","coast.31":"t.l0.cellgroup_s_s_d_l","coast.32":"t.l0.cellgroup_l_s_s_l","coast.33":"t.l0.cellgroup_s_l_l_s","coast.34":"t.l0.cellgroup_l_l_s_s","coast.35":"t.l0.cellgroup_s_s_l_l","coast.36":"t.l0.cellgroup_s_d_s_s","coast.37":"t.l0.cellgroup_s_s_s_d","coast.38":"t.l0.cellgroup_s_s_d_s","coast.39":"t.l0.cellgroup_d_s_s_s","coast.40":"t.l0.cellgroup_s_d_s_d","coast.41":"t.l0.cellgroup_s_d_s_d","coast.42":"t.l0.cellgroup_d_s_d_s","coast.43":"t.l0.cellgroup_d_s_d_s","coast.44":"t.l0.cellgroup_s_d_s_l","coast.45":"t.l0.cellgroup_s_l_s_d","coast.46":"t.l0.cellgroup_l_s_d_s","coast.47":"t.l0.cellgroup_d_s_l_s","coast.48":"t.l0.cellgroup_d_d_s_s","coast.49":"t.l0.cellgroup_s_s_d_d","coast.50":"t.l0.cellgroup_s_d_d_s","coast.51":"t.l0.cellgroup_d_s_s_d","coast.52":"t.l0.cellgroup_d_d_s_d","coast.53":"t.l0.cellgroup_s_d_d_d","coast.54":"t.l0.cellgroup_d_d_d_s","coast.55":"t.l0.cellgroup_d_s_d_d","coast.56":"t.l0.cellgroup_d_d_s_l","coast.57":"t.l0.cellgroup_s_l_d_d","coast.58":"t.l0.cellgroup_l_d_d_s","coast.59":"t.l0.cellgroup_d_s_l_d","coast.60":"t.l0.cellgroup_l_d_s_s","coast.61":"t.l0.cellgroup_s_s_l_d","coast.62":"t.l0.cellgroup_s_l_d_s","coast.63":"t.l0.cellgroup_d_s_s_l","coast.64":"t.l0.cellgroup_l_d_s_d","coast.65":"t.l0.cellgroup_s_d_l_d","coast.66":"t.l0.cellgroup_d_l_d_s","coast.67":"t.l0.cellgroup_d_s_d_l","coast.68":"t.l0.cellgroup_l_d_s_l","coast.69":"t.l0.cellgroup_s_l_l_d","coast.70":"t.l0.cellgroup_l_l_d_s","coast.71":"t.l0.cellgroup_d_s_l_l","coast.72":"t.l0.cellgroup_s_l_s_s","coast.73":"t.l0.cellgroup_s_s_s_l","coast.74":"t.l0.cellgroup_s_s_l_s","coast.75":"t.l0.cellgroup_l_s_s_s","coast.76":"t.l0.cellgroup_s_l_s_d","coast.77":"t.l0.cellgroup_s_d_s_l","coast.78":"t.l0.cellgroup_d_s_l_s","coast.79":"t.l0.cellgroup_l_s_d_s","coast.80":"t.l0.cellgroup_s_l_s_l","coast.81":"t.l0.cellgroup_s_l_s_l","coast.82":"t.l0.cellgroup_l_s_l_s","coast.83":"t.l0.cellgroup_l_s_l_s","coast.84":"t.l0.cellgroup_d_l_s_s","coast.85":"t.l0.cellgroup_s_s_d_l","coast.86":"t.l0.cellgroup_s_d_l_s","coast.87":"t.l0.cellgroup_l_s_s_d","coast.88":"t.l0.cellgroup_d_l_s_d","coast.89":"t.l0.cellgroup_s_d_d_l","coast.90":"t.l0.cellgroup_d_d_l_s","coast.91":"t.l0.cellgroup_l_s_d_d","coast.92":"t.l0.cellgroup_d_l_s_l","coast.93":"t.l0.cellgroup_s_l_d_l","coast.94":"t.l0.cellgroup_l_d_l_s","coast.95":"t.l0.cellgroup_l_s_l_d","coast.96":"t.l0.cellgroup_l_l_s_s","coast.97":"t.l0.cellgroup_s_s_l_l","coast.98":"t.l0.cellgroup_s_l_l_s","coast.99":"t.l0.cellgroup_l_s_s_l","coast.100":"t.l0.cellgroup_l_l_s_d","coast.101":"t.l0.cellgroup_s_d_l_l","coast.102":"t.l0.cellgroup_d_l_l_s","coast.103":"t.l0.cellgroup_l_s_d_l","coast.104":"t.l0.cellgroup_l_l_s_l","coast.105":"t.l0.cellgroup_s_l_l_l","coast.106":"t.l0.cellgroup_l_l_l_s","coast.107":"t.l0.cellgroup_l_s_l_l","floor.0":"t.l0.cellgroup_d_d_d_d","floor.1":"t.l0.cellgroup_d_d_d_d","floor.2":"t.l0.cellgroup_d_d_d_d","floor.3":"t.l0.cellgroup_d_d_d_d","floor.4":"t.l0.cellgroup_d_d_d_s","floor.5":"t.l0.cellgroup_d_s_d_d","floor.6":"t.l0.cellgroup_s_d_d_d","floor.7":"t.l0.cellgroup_d_d_s_d","floor.8":"t.l0.cellgroup_d_d_d_l","floor.9":"t.l0.cellgroup_d_l_d_d","floor.10":"t.l0.cellgroup_l_d_d_d","floor.11":"t.l0.cellgroup_d_d_l_d","floor.12":"t.l0.cellgroup_s_d_d_d","floor.13":"t.l0.cellgroup_d_d_s_d","floor.14":"t.l0.cellgroup_d_s_d_d","floor.15":"t.l0.cellgroup_d_d_d_s","floor.16":"t.l0.cellgroup_s_d_d_s","floor.17":"t.l0.cellgroup_d_s_s_d","floor.18":"t.l0.cellgroup_s_s_d_d","floor.19":"t.l0.cellgroup_d_d_s_s","floor.20":"t.l0.cellgroup_s_d_d_l","floor.21":"t.l0.cellgroup_d_l_s_d","floor.22":"t.l0.cellgroup_l_s_d_d","floor.23":"t.l0.cellgroup_d_d_l_s","floor.24":"t.l0.cellgroup_l_d_d_d","floor.25":"t.l0.cellgroup_d_d_l_d","floor.26":"t.l0.cellgroup_d_l_d_d","floor.27":"t.l0.cellgroup_d_d_d_l","floor.28":"t.l0.cellgroup_l_d_d_s","floor.29":"t.l0.cellgroup_d_s_l_d","floor.30":"t.l0.cellgroup_s_l_d_d","floor.31":"t.l0.cellgroup_d_d_s_l","floor.32":"t.l0.cellgroup_l_d_d_l","floor.33":"t.l0.cellgroup_d_l_l_d","floor.34":"t.l0.cellgroup_l_l_d_d","floor.35":"t.l0.cellgroup_d_d_l_l","floor.36":"t.l0.cellgroup_d_s_d_d","floor.37":"t.l0.cellgroup_d_d_d_s","floor.38":"t.l0.cellgroup_d_d_s_d","floor.39":"t.l0.cellgroup_s_d_d_d","floor.40":"t.l0.cellgroup_d_s_d_s","floor.41":"t.l0.cellgroup_d_s_d_s","floor.42":"t.l0.cellgroup_s_d_s_d","floor.43":"t.l0.cellgroup_s_d_s_d","floor.44":"t.l0.cellgroup_d_s_d_l","floor.45":"t.l0.cellgroup_d_l_d_s","floor.46":"t.l0.cellgroup_l_d_s_d","floor.47":"t.l0.cellgroup_s_d_l_d","floor.48":"t.l0.cellgroup_s_s_d_d","floor.49":"t.l0.cellgroup_d_d_s_s","floor.50":"t.l0.cellgroup_d_s_s_d","floor.51":"t.l0.cellgroup_s_d_d_s","floor.52":"t.l0.cellgroup_s_s_d_s","floor.53":"t.l0.cellgroup_d_s_s_s","floor.54":"t.l0.cellgroup_s_s_s_d","floor.55":"t.l0.cellgroup_s_d_s_s","floor.56":"t.l0.cellgroup_s_s_d_l","floor.57":"t.l0.cellgroup_d_l_s_s","floor.58":"t.l0.cellgroup_l_s_s_d","floor.59":"t.l0.cellgroup_s_d_l_s","floor.60":"t.l0.cellgroup_l_s_d_d","floor.61":"t.l0.cellgroup_d_d_l_s","floor.62":"t.l0.cellgroup_d_l_s_d","floor.63":"t.l0.cellgroup_s_d_d_l","floor.64":"t.l0.cellgroup_l_s_d_s","floor.65":"t.l0.cellgroup_d_s_l_s","floor.66":"t.l0.cellgroup_s_l_s_d","floor.67":"t.l0.cellgroup_s_d_s_l","floor.68":"t.l0.cellgroup_l_s_d_l","floor.69":"t.l0.cellgroup_d_l_l_s","floor.70":"t.l0.cellgroup_l_l_s_d","floor.71":"t.l0.cellgroup_s_d_l_l","floor.72":"t.l0.cellgroup_d_l_d_d","floor.73":"t.l0.cellgroup_d_d_d_l","floor.74":"t.l0.cellgroup_d_d_l_d","floor.75":"t.l0.cellgroup_l_d_d_d","floor.76":"t.l0.cellgroup_d_l_d_s","floor.77":"t.l0.cellgroup_d_s_d_l","floor.78":"t.l0.cellgroup_s_d_l_d","floor.79":"t.l0.cellgroup_l_d_s_d","floor.80":"t.l0.cellgroup_d_l_d_l","floor.81":"t.l0.cellgroup_d_l_d_l","floor.82":"t.l0.cellgroup_l_d_l_d","floor.83":"t.l0.cellgroup_l_d_l_d","floor.84":"t.l0.cellgroup_s_l_d_d","floor.85":"t.l0.cellgroup_d_d_s_l","floor.86":"t.l0.cellgroup_d_s_l_d","floor.87":"t.l0.cellgroup_l_d_d_s","floor.88":"t.l0.cellgroup_s_l_d_s","floor.89":"t.l0.cellgroup_d_s_s_l","floor.90":"t.l0.cellgroup_s_s_l_d","floor.91":"t.l0.cellgroup_l_d_s_s","floor.92":"t.l0.cellgroup_s_l_d_l","floor.93":"t.l0.cellgroup_d_l_s_l","floor.94":"t.l0.cellgroup_l_s_l_d","floor.95":"t.l0.cellgroup_l_d_l_s","floor.96":"t.l0.cellgroup_l_l_d_d","floor.97":"t.l0.cellgroup_d_d_l_l","floor.98":"t.l0.cellgroup_d_l_l_d","floor.99":"t.l0.cellgroup_l_d_d_l","floor.100":"t.l0.cellgroup_l_l_d_s","floor.101":"t.l0.cellgroup_d_s_l_l","floor.102":"t.l0.cellgroup_s_l_l_d","floor.103":"t.l0.cellgroup_l_d_s_l","floor.104":"t.l0.cellgroup_l_l_d_l","floor.105":"t.l0.cellgroup_d_l_l_l","floor.106":"t.l0.cellgroup_l_l_l_d","floor.107":"t.l0.cellgroup_l_d_l_l"};var icegroup_map={"arctic.1":"t.l1.coast_cell_d_i_i_i","arctic.2":"t.l1.coast_cell_d_i_i_w","arctic.3":"t.l1.coast_cell_d_i_w_i","arctic.4":"t.l1.coast_cell_d_i_w_w","arctic.5":"t.l1.coast_cell_d_w_i_i","arctic.6":"t.l1.coast_cell_d_w_i_w","arctic.7":"t.l1.coast_cell_d_w_w_i","arctic.8":"t.l1.coast_cell_d_w_w_w","arctic.9":"t.l1.coast_cell_l_i_i_i","arctic.10":"t.l1.coast_cell_l_i_i_w","arctic.11":"t.l1.coast_cell_l_i_w_i","arctic.12":"t.l1.coast_cell_l_i_w_w","arctic.13":"t.l1.coast_cell_l_w_i_i","arctic.14":"t.l1.coast_cell_l_w_i_w","arctic.15":"t.l1.coast_cell_l_w_w_i","arctic.16":"t.l1.coast_cell_l_w_w_w","arctic.17":"t.l1.coast_cell_r_i_i_i","arctic.18":"t.l1.coast_cell_r_i_i_w","arctic.19":"t.l1.coast_cell_r_i_w_i","arctic.20":"t.l1.coast_cell_r_i_w_w","arctic.21":"t.l1.coast_cell_r_w_i_i","arctic.22":"t.l1.coast_cell_r_w_i_w","arctic.23":"t.l1.coast_cell_r_w_w_i","arctic.24":"t.l1.coast_cell_r_w_w_w","arctic.25":"t.l1.coast_cell_u_i_i_i","arctic.26":"t.l1.coast_cell_u_i_i_w","arctic.27":"t.l1.coast_cell_u_i_w_i","arctic.28":"t.l1.coast_cell_u_i_w_w","arctic.29":"t.l1.coast_cell_u_w_i_i","arctic.30":"t.l1.coast_cell_u_w_i_w","arctic.31":"t.l1.coast_cell_u_w_w_i","arctic.32":"t.l1.coast_cell_u_w_w_w"};var units={};var unit_pillage_sound_delay_times={"Dive Bomber":3e3,"Ground Strike Fighter":300,"Jet Bomber":300,Armor:400,"Armor II":400};var unit_bombard_attack_names={Phalanx:"Rumble Attack",Archers:"Volley Attack",Legion:"Pilum Assult","Siege Ram":"Ram Fortress",Fanatics:"Skirmish Assault",Zealots:"Skirmish Assault",Marines:"Bazooka Attack",Zeppelin:"Bomb",Battleship:"Bombard"};var units_pregunpowder=["Warriors","Phalanx","Legion","Pikemen","Archers","Horsemen","Chariot","Elephants","Knights","Crusaders","Catapult","Explorer","Tribesmen","Well-Digger","Settlers","Workers","Trireme","Longboat","Caravan","War Galley","Galley","Siege Ram","Caravel","Ram Ship"];var SINGLE_MOVE;var ANIM_STEPS=8;var anim_units_max=30;var anim_units_count=0;var ORDER_MOVE=0;var ORDER_ACTIVITY=1;var ORDER_FULL_MP=2;var ORDER_ACTION_MOVE=3;var ORDER_PERFORM_ACTION=4;var ORDER_LAST=5;var USSDT_QUEUE=0;var USSDT_UNQUEUE=1;var USSDT_BATTLE_GROUP=2;function idex_lookup_unit(id){return units[id]}function unit_owner(punit){return player_by_number(punit["owner"])}function client_remove_unit(punit){control_unit_killed(punit);if(unit_is_in_focus(punit)){current_focus=[]}delete units[punit["id"]]}function tile_units(ptile){if(ptile==null)return null;return ptile["units"]}function unit_tile(punit){if(punit&&punit["tile"])return index_to_tile(punit["tile"]);return null}function get_supported_units(pcity){if(pcity==null)return null;var result=[];for(var unit_id in units){var punit=units[unit_id];if(punit["homecity"]==pcity["id"]){result.push(punit)}}return result}function update_tile_unit(punit){if(punit==null)return;var found=false;var ptile=index_to_tile(punit["tile"]);if(ptile==null||ptile["units"]==null)return;for(var i=0;i<ptile["units"].length;i++){if(ptile["units"][i]["id"]==punit["id"]){found=true}}if(!found){ptile["units"].push(punit)}}function clear_tile_unit(punit){if(punit==null)return;var ptile=index_to_tile(punit["tile"]);if(ptile==null||ptile["units"]==null)return-1;if(ptile["units"].indexOf(punit)>=0){ptile["units"].splice(ptile["units"].indexOf(punit),1)}}function unit_list_size(unit_list){if(unit_list==null)return 0;return unit_list.length}function unit_list_without(unit_list,punit){return unit_list.filter(function(funit,index,c_focus){return funit["id"]!=punit["id"]})}function unit_type(unit){return unit_types[unit["type"]]}function unit_can_do_action(punit,act_id){return utype_can_do_action(unit_type(punit),act_id)}function unit_has_cargo_room(punit){if(!punit){console.log("Error: unit_has_cargo_room(..) was asked the capacity of a null unit.");return true}var ptype=unit_type(punit);var ptile=unit_tile(punit);var units_on_tile=tile_units(ptile);var transport_id=punit["id"];var transport_capacity=ptype["transport_capacity"];var cargo_units=0;for(var u=0;u<units_on_tile.length;u++){if(units_on_tile[u]["transported_by"]==transport_id){cargo_units++}}if(cargo_units>=transport_capacity){return false}return true}function unit_can_do_unload(punit){if(!punit)return false;var rules=ruleset_control["name"];if(!rules.startsWith("Avant-garde")&&rules!="Multiplayer-Evolution ruleset"&&!rules.startsWith("MP2"))return true;var tunit=null,ttype=null,tclass=null;if(punit["transported_by"]){tunit=units[punit["transported_by"]];ttype=unit_type(tunit);tclass=unit_classes[ttype.unit_class_id]}else return false;var quay_rules=client_rules_flag[CRF_EXTRA_QUAY];var ptype=unit_type(punit);var ptile=index_to_tile(punit["tile"]);var terrain_name=tile_terrain(ptile)["name"];if(ptile==null)return false;var pcity=tile_city(ptile);var pclass=get_unit_class_name(punit);if(pcity)return true;if(utype_has_flag(ptype,UTYF_MARINES)&&!is_ocean_tile(ptile))return true;if(typeof EXTRA_NAVALBASE!=="undefined"&&tile_has_extra(ptile,EXTRA_NAVALBASE))return true;if(pclass=="Air")return true;if(pclass=="AirProtect")return true;if(pclass=="AirPillage")return true;if(pclass=="Air_High_Altitude")return true;if(pclass=="Balloon")return true;if(pclass=="Helicopter")return true;if(pclass=="Missile")return true;if(!quay_rules){if(tile_has_extra(ptile,EXTRA_RIVER))return false;return true}if((tclass.rule_name=="Helicopter"||tclass.rule_name.startsWith("Air"))&&(pclass.startsWith("Land")||pclass=="Bomb")){if(!tile_has_extra(ptile,EXTRA_AIRBASE))return false;return true}if(tclass.rule_name=="LandRail"||tclass.rule_name=="LandRoad"){if(tile_has_extra(ptile,EXTRA_AIRBASE))return true;if(quay_rules&&tile_has_extra(ptile,EXTRA_QUAY))return true;if(typeof EXTRA_FORT!=="undefined"&&tile_has_extra(ptile,EXTRA_FORT))return true;if(tile_has_extra(ptile,EXTRA_FORTRESS))return true;if(typeof EXTRA_CASTLE!=="undefined"&&tile_has_extra(ptile,EXTRA_CASTLE))return true;if(typeof EXTRA_BUNKER!=="undefined"&&tile_has_extra(ptile,EXTRA_BUNKER))return true;return false}if(tile_has_extra(ptile,EXTRA_QUAY))return true;if(tile_has_extra(ptile,EXTRA_RIVER))return false;if(tile_has_extra(ptile,EXTRA_CANAL))return false;if(tile_has_extra(ptile,EXTRA_WATERWAY))return false;return true}function unit_could_possibly_load(punit,ptype,ttype,tclass){if(!punit||!ptype||!ttype||!tclass)return false;var pclass=get_unit_class_name(punit);if((pclass.startsWith("Land")||pclass=="Cargo")&&punit["transported"]){var ptile=tiles[punit["tile"]];var can_load=false;var from_unit=units[punit["transported_by"]];var from_class=get_unit_class(from_unit);var from_type=unit_type(from_unit);if(tile_city(ptile))can_load=true;else if(unit_can_do_unload(punit))can_load=true;else if(from_class.rule_name=="Trireme"||from_class.rule_name=="RiverShip"||from_class.rule_name=="Sea"||from_class.rule_name=="Boat"){var from_unit_move_rate=from_type["move_rate"];if(client_rules_flag[CRF_MP2]){if(player_has_wonder(unit_owner(from_unit).playerno,improvement_id_by_name(B_LIGHTHOUSE))){from_unit_move_rate+=2*SINGLE_MOVE}if(player_invention_state(unit_owner(from_unit),tech_id_by_name("Nuclear Power"))==TECH_KNOWN){from_unit_move_rate+=2*SINGLE_MOVE}}if(from_unit.movesleft>=from_unit_move_rate-4*SINGLE_MOVE){if(from_unit.movesleft>=from_unit_move_rate/2){can_load=true}}}if(!can_load)return false}if(pclass=="Sea"||pclass=="RiverShip"||pclass=="Submarine"||pclass=="Trireme"||pclass=="LandRail"||pclass=="Space"){return false}if(pclass=="Cargo"){if(ptype.rule_name=="Freight"){if(tclass.rule_name!="LandRail"&&tclass.rule_name!="LandRoad"&&ttype.name!="Cargo Ship"&&ttype.name!="Airplane"&&ttype.name!="Transport")return false}else{if(ttype.name!="Galleon"&&!utype_has_flag(ttype,UTYF_TRADEROUTE))return false;if(tclass.rule_name=="Goods")return false}}else if(pclass=="Bomb"){if(!ttype.name.includes("Bomber")&&tclass.rule_name!="LandRail"&&tclass.rule_name!="LandRoad")return false;if(ttype.cargo[0]==0)return false}else if(pclass=="Missile"){if(ttype.name=="Missile Destroyer"||ttype.name=="AEGIS Cruiser"||ttype.name=="Submarine"||ttype.name=="Mobile SAM"||ttype.name=="Carrier")return true;return false}else if(pclass.startsWith("Land")){if(tclass.rule_name=="Land")return false;if(tclass.rule_name=="Submarine")return false;if(tclass.rule_name=="LandRail"||tclass.rule_name=="LandRoad"){if(utype_real_base_move_rate(ptype)>=3*SINGLE_MOVE)return false}if(tclass.rule_name=="Air"){if(ttype.name!="Airplane"||!unit_has_type_flag(punit,UTYF_DIPLOMAT))return false}if(tclass.rule_name=="AirPillage")return false;if(tclass.rule_name=="Air_High_Altitude")return false;if(ttype.name=="AEGIS Cruiser")return false;if(ttype.name=="Mobile SAM")return false;if(ttype.name=="Missile Destroyer")return false;if(pclass!="LandAirSea"){if(ttype.name=="Carrier")return false;if(ttype.name=="Helicopter")return false}if(pclass=="LandRoad"||pclass=="LandRail"){if(tclass.rule_name=="Helicopter")return false}}else if(pclass=="Balloon"){debugger;if(tclass.rule_name=="LandRail")return true;if(tclass.rule_name=="RiverShip"&&!(ttype.name=="Cargo Ship"||ttype.name=="Galleon"))return false;if(tclass.rule_name=="Sea"&&!(ttype.name=="Transport"||ttype.name=="Carrier"))return false}else if(pclass=="Zeppelin"){if(ttype.name!="Carrier"&&ttype.name!="Transport"&&ttype.name!="Train")return false}else if(pclass.startsWith("Air")||pclass=="Helicopter"){if(ttype.name!="Carrier")return false}return true}function get_unit_moves_left(punit){if(punit==null){return 0}return"Moves:"+move_points_text(punit["movesleft"],false)+""}function unit_moves_left(punit){if(punit==null){return 0}return move_points_text(punit["movesleft"],false)+""}function move_points_text(moves,make_fraction){var result="";if(make_fraction===undefined)make_fraction=false;var div_symbol=make_fraction?"&#x2044;":"/";var spacer=make_fraction?"&#8203;":" ";var numerator,denominator;if(moves%SINGLE_MOVE!=0){numerator=Math.floor(moves%SINGLE_MOVE);denominator=SINGLE_MOVE;var simplified_fraction=fraction_reduce(numerator,denominator);numerator=simplified_fraction.numerator;denominator=simplified_fraction.denominator;if(Math.floor(moves/SINGLE_MOVE)>0){result=""+Math.floor(moves/SINGLE_MOVE)+spacer+numerator+div_symbol+denominator}else{result=""+numerator+div_symbol+denominator}}else{result=Math.floor(moves/SINGLE_MOVE)}if(isNaN(moves))return"-";return result}function unit_has_goto(punit){if(client.conn.playing==null||punit["owner"]!=client.conn.playing.playerno){return false}return punit["has_orders"]&&punit["goto_tile"]!=-1}function update_unit_anim_list(old_unit,new_unit){var anim_tuple;if(old_unit==null||new_unit==null)return;if(new_unit["tile"]==old_unit["tile"])return;if(anim_units_count>anim_units_max)return;if(!is_unit_visible(new_unit))return;if(old_unit["anim_list"]==null)old_unit["anim_list"]=[];if(new_unit["transported"]==true){old_unit["anim_list"]=[];return}anim_units_count+=1;var has_old_pos=false;var has_new_pos=false;for(var i=0;i<old_unit["anim_list"].length;i++){anim_tuple=old_unit["anim_list"][i];if(anim_tuple["tile"]==old_unit["tile"]){has_old_pos=true}if(anim_tuple["tile"]==new_unit["tile"]){has_new_pos=true}}if(!has_old_pos){anim_tuple={};anim_tuple["tile"]=old_unit["tile"];anim_tuple["i"]=ANIM_STEPS;old_unit["anim_list"].push(anim_tuple)}if(!has_new_pos){anim_tuple={};anim_tuple["tile"]=new_unit["tile"];anim_tuple["i"]=ANIM_STEPS;old_unit["anim_list"].push(anim_tuple)}}function get_unit_anim_offset(punit){var offset={};if(punit["anim_list"]!=null&&punit["anim_list"].length>=2){var anim_tuple_src=punit["anim_list"][0];var anim_tuple_dst=punit["anim_list"][1];var src_tile=index_to_tile(anim_tuple_src["tile"]);var dst_tile=index_to_tile(anim_tuple_dst["tile"]);var u_tile=index_to_tile(punit["tile"]);anim_tuple_dst["i"]=anim_tuple_dst["i"]-1;var i=Math.floor((anim_tuple_dst["i"]+2)/3);var r=map_to_gui_pos(src_tile["x"],src_tile["y"]);var src_gx=r["gui_dx"];var src_gy=r["gui_dy"];var s=map_to_gui_pos(dst_tile["x"],dst_tile["y"]);var dst_gx=s["gui_dx"];var dst_gy=s["gui_dy"];var t=map_to_gui_pos(u_tile["x"],u_tile["y"]);var punit_gx=t["gui_dx"];var punit_gy=t["gui_dy"];var gui_dx=Math.floor((dst_gx-src_gx)*(i/ANIM_STEPS))+(punit_gx-dst_gx);var gui_dy=Math.floor((dst_gy-src_gy)*(i/ANIM_STEPS))+(punit_gy-dst_gy);if(i==0){punit["anim_list"].splice(0,1);if(punit["anim_list"].length==1){punit["anim_list"].splice(0,punit["anim_list"].length)}if(focuslock&&punit["anim_list"].length==0){if(unit_is_only_unit_in_focus(punit)){center_tile_mapcanvas(unit_tile(punit))}else{}}}offset["x"]=-gui_dx;offset["y"]=-gui_dy}else{offset["x"]=0;offset["y"]=0;anim_units_count-=1}return offset}function reset_unit_anim_list(){for(var unit_id in units){var punit=units[unit_id];punit["anim_list"]=[]}anim_units_count=0}function get_unit_homecity_name(punit){if(punit["homecity"]!=0&&cities[punit["homecity"]]!=null){return decodeURIComponent(cities[punit["homecity"]]["name"])}else{return null}}function is_unit_visible(punit){if(punit==null||punit["tile"]==null)return false;var u_tile=index_to_tile(punit["tile"]);var r=map_to_gui_pos(u_tile["x"],u_tile["y"]);var unit_gui_x=r["gui_dx"];var unit_gui_y=r["gui_dy"];if(unit_gui_x<mapview["gui_x0"]||unit_gui_y<mapview["gui_y0"]||unit_gui_x>mapview["gui_x0"]+mapview["width"]||unit_gui_y>mapview["gui_y0"]+mapview["height"]){return false}else{return true}}function unittype_ids_alphabetic(){var unittype_names=[];var unit_id;for(unit_id in unit_types){var punit_type=unit_types[unit_id];unittype_names.push(punit_type["name"])}unittype_names.sort();var unittype_id_list=[];for(var n in unittype_names){var unit_name=unittype_names[n];for(unit_id in unit_types){punit_type=unit_types[unit_id];if(unit_name==punit_type["name"]){unittype_id_list.push(unit_id)}}}return unittype_id_list}function get_unit_city_info(punit,plaintext){var result="";var upkeep_mode;if(client_rules_flag[CRF_NO_UNIT_GOLD_UPKEEP]){upkeep_mode=1}else upkeep_mode=3;var ptype=unit_type(punit);result+=ptype["name"];if(ptype["transport_capacity"]>0)result+=" T"+punit["id"];if(get_unit_homecity_name(punit)){result+=": "+get_unit_homecity_name(punit);if(upkeep_mode==3){result+="\nFood/Gold/Shield: ";if(punit["upkeep"]!=null){result+=punit["upkeep"][O_FOOD]+"/"+punit["upkeep"][O_GOLD]+"/"+punit["upkeep"][O_SHIELD]}}else if(upkeep_mode==1){result+="\nUpkeep: ";if(punit["upkeep"]!=null){var food_string=punit["upkeep"][O_FOOD]?punit["upkeep"][O_FOOD]+"f ":"";result+=food_string+punit["upkeep"][O_SHIELD];if(food_string)result+="s"}}}else if(client.conn.playing!=null&&punit["owner"]!=client.conn.playing.playerno){var player_id=punit["owner"];if(players[player_id]!=null){var nation_id=players[player_id]["nation"];result+=": "+nations[nation_id]["adjective"];result+="\nLeader: "+players[player_id]["name"]+""}}result+="\nLocation: ";var tile_id=punit["tile"];var pcity=tile_city(tiles[punit["tile"]]);var coordinates="{"+tiles[punit["tile"]]["x"]+","+tiles[punit["tile"]]["y"]+"}";if(pcity){result+=pcity["name"]+" "+coordinates}else if(cities[tiles[punit["tile"]]["worked"]]){if(cities[tiles[punit["tile"]]["worked"]]["name"])result+=coordinates+" near "+cities[tiles[punit["tile"]]["worked"]]["name"];else result+=coordinates+" near unknown foreign city."}else{result+=coordinates}if(client.conn.playing!=null&&punit["owner"]==client.conn.playing.playerno){if(tiles[punit["tile"]]["owner"]==UNCLAIMED_LAND){result+="\nTerritory: Unclaimed"}else if(!pcity&&tiles[punit["tile"]]["owner"]==client.conn.playing.playerno){result+="\nTerritory: Homeland"}else if(tiles[punit["tile"]]["owner"]!=client.conn.playing.playerno){var player_id=tiles[punit["tile"]]["owner"];if(players[player_id]!=null){var nation_id=players[player_id]["nation"];result+="\nTerritory: "+nations[nation_id]["adjective"];result+=" ("+players[player_id]["name"]+")"}}}if(punit["transported_by"]!=undefined&&punit["transported_by"]>0){result+="\nActivity: CARGO on T"+punit["transported_by"]}else{switch(punit["activity"]){case ACTIVITY_POLLUTION:result+="\nActivity: CLEANING POLLUTION";break;case ACTIVITY_MINE:result+="\nActivity: MINING";break;case ACTIVITY_IRRIGATE:result+="\nActivity: IRRIGATING";break;case ACTIVITY_FORTIFIED:result+="\nActivity: FORTIFIED";break;case ACTIVITY_FORTIFYING:result+="\nActivity: FORTIFYING";break;case ACTIVITY_SENTRY:result+="\nActivity: SENTRY";break;case ACTIVITY_PILLAGE:result+="\nActivity: PILLAGE";break;case ACTIVITY_GOTO:result+="\nActivity: GOTO";break;case ACTIVITY_EXPLORE:result+="\nActivity: AUTO-EXPLORE";break;case ACTIVITY_TRANSFORM:var ptile=tiles[punit["tile"]];result+="\nTRANSFORMING "+terrains[ptile["terrain"]]["name"];break;case ACTIVITY_FALLOUT:result+="\nActivity: CLEANING FALLOUT";break;case ACTIVITY_BASE:result+="\nActivity: BUILDING BASE";break;case ACTIVITY_GEN_ROAD:result+="\nActivity: BUILDING ROAD";break;case ACTIVITY_CONVERT:result+="\nActivity: CONVERTING"}}if(punit["goto_tile"]!=undefined&&punit["ai"]!=undefined){if(punit["ai"]==true){result+="\nActivity: AUTO-WORKER"}else if(punit["goto_tile"]>-1){var xG=tiles[punit["goto_tile"]]["x"];var yG=tiles[punit["goto_tile"]]["y"];result+="\nActivity: GOTO ("+xG+","+yG+")"}}result+="\n";if(punit["veteran"]){if(ptype["veteran_levels"]>0){var special_name=ptype["veteran_name"][punit["veteran"]];var n=special_name.lastIndexOf(":");var vet_name=special_name.substring(n+1)}else{var vet_name=game_rules["veteran_name"][punit["veteran"]]}vet_star=plaintext?"*":"&starf;";vet_name=vet_name.charAt(0).toUpperCase()+vet_name.substring(1);result+="\n"+vet_name+" "+vet_star.repeat(punit["veteran"])}result+="\nHealth: "+punit["hp"]+"/"+ptype["hp"];if(client.conn.playing!=null&&punit["owner"]==client.conn.playing.playerno){result+="\nMoves: "+move_points_text(punit["movesleft"],false);if(punit["fuel"])result+="\nFuel: "+punit["fuel"]}return result}function get_what_can_unit_pillage_from(punit,ptile){var i,j;var extra;var targets=[];if(punit==null)return targets;if(ptile==null){ptile=index_to_tile(punit.tile)}if(terrains[ptile.terrain].pillage_time==0)return targets;var unit_class=unit_classes[unit_types[punit.type].unit_class_id];if(!utype_can_do_action(unit_type(punit),ACTION_PILLAGE)){if(client_rules_flag[CRF_SURGICAL_PILLAGE]){var ptype=unit_type(punit);if(ptype["name"]!="Ground Strike Fighter"&&ptype["name"]!="Dive Bomber"&&ptype["name"]!="Jet Bomber"&&ptype["name"]!="Strategic Bomber"){return targets}}else return targets}var available=ptile.extras.toBitSet();var cannot_pillage=new BitVector([]);for(const unit_idx in Object.keys(ptile.units)){const unit=ptile.units[unit_idx];if(unit==punit||unit_can_iPillage(punit))continue;if(unit.activity===ACTIVITY_PILLAGE){cannot_pillage.set(unit.activity_tgt)}}const RAIL=tile_has_extra(ptile,EXTRA_RAILROAD);const FORT=typeof EXTRA_FORT!=="undefined"?tile_has_extra(ptile,EXTRA_FORT):false;const FORTRESS=tile_has_extra(ptile,EXTRA_FORTRESS);const NAVALBASE=typeof EXTRA_NAVALBASE!=="undefined"?tile_has_extra(ptile,EXTRA_NAVALBASE):false;const CASTLE=typeof EXTRA_CASTLE!=="undefined"?tile_has_extra(ptile,EXTRA_CASTLE):false;const BUNKER=typeof EXTRA_BUNKER!=="undefined"?tile_has_extra(ptile,EXTRA_BUNKER):false;if(client_rules_flag[CRF_SEABRIDGE]){extras["17"].reqs.push({kind:23,value:16,range:0,survives:false,present:true,quiet:false});extras["17"].reqs.push({kind:23,value:20,range:0,survives:false,present:true,quiet:false})}for(i=0;i<available.length;i++){extra=extras[available[i]];for(j=0;j<extra.reqs.length;j++){var req=extra.reqs[j];if(req.kind==VUT_EXTRA&&req.present==true)cannot_pillage.set(req.value)}}for(i=0;i<available.length;i++){extra=available[i];if(is_extra_removed_by(extras[extra],ERM_PILLAGE)&&!cannot_pillage.isSet(extra)){if(game_info.pillage_select){if(extra==EXTRA_ROAD&&RAIL){}else if(FORT&&extra==EXTRA_FORT&&(FORTRESS||NAVALBASE||CASTLE||BUNKER)){}else if(FORTRESS&&extra==EXTRA_FORTRESS&&(CASTLE||BUNKER)){}else if(NAVALBASE&&extra==EXTRA_NAVALBASE&&(CASTLE||BUNKER)){}else{targets.push(extra)}}else{targets.push(EXTRA_NONE);break}}}if(client_rules_flag[CRF_SEABRIDGE]){extras["17"].reqs.pop();extras["17"].reqs.pop()}return targets}function get_unit_class_name(punit){var unit_class=unit_classes[unit_types[punit["type"]]["unit_class_id"]];return unit_class["rule_name"].replace("?unitclass:","")}function get_unit_class(punit){if(!punit)return null;var unit_class=unit_classes[unit_types[punit["type"]]["unit_class_id"]];return unit_class}function unit_has_class_flag(punit,flag){var unit_class=unit_classes[unit_types[punit["type"]]["unit_class_id"]];return unit_classes[unit_class["id"]]["flags"].isSet(flag)}function unit_has_type_flag(punit,flag){return utype_has_flag(unit_types[punit.type],flag)}function unit_has_moved(punit){var ptype=unit_type(punit);if(punit["done_moving"]){return true}if(!unit_has_class_flag(punit,UCF_DAMAGE_SLOWS)){if(punit["movesleft"]<ptype["move_rate"]){return true}return false}if(punit["movesleft"]>=ptype["move_rate"]){return false}if(punit["hp"]>=ptype["hp"]){return true}var health_pct=parseFloat(punit["hp"])/parseFloat(ptype["hp"]);var injured_full_moves=Math.floor(parseFloat(ptype["move_rate"])*health_pct);if(punit["movesleft"]<injured_full_moves){return true}return false}function unit_get_bombard_name(punit){if(!punit)return"Ranged Attack";return utype_get_pillage_name(unit_type(punit))}function utype_get_bombard_name(ptype){if(!ptype)return"Ranged Attack";var name=unit_bombard_attack_names[ptype["rule_name"]];if(!name)return"Ranged Attack";else return name}function unit_get_pillage_name(punit){if(!punit)return"Pillage";return utype_get_pillage_name(unit_type(punit))}function utype_get_pillage_name(ptype){if(!ptype)return"Pillage";var name=ptype["sound_fight_alt"];if(!name||name.startsWith("f_"))return"Pillage";else return name}function unit_has_dual_pillage_options(punit){var pstats=unit_get_extra_stats(punit);return pstats.iPillage&&get_unit_class_name(punit).startsWith("Land")}function unit_can_iPillage(punit){return utype_can_iPillage(unit_type(punit))}function utype_can_iPillage(ptype){return utype_get_extra_stats(ptype).iPillage}function unit_get_extra_stats(punit){if(!punit)return{};return utype_get_extra_stats(unit_type(punit))}function utype_get_extra_stats(ptype){if(!ptype)return{};var pstats={};var BB=ptype["paratroopers_mr_sub"]/SINGLE_MOVE;if(ptype["paratroopers_range"]>0){BB=0}pstats.bit_field=BB;pstats.attack_stay_fortified=BB&1;pstats.iPillage=(BB&2)>>1;pstats.iPillage_moves=(BB&28)>>2;pstats.iPillage_odds=(BB&480)>>5;pstats.iPillage_random_targets=(BB&1536)>>9;pstats.bombard_retaliate_rounds=(BB&129024)>>11;pstats.iPillage_odds=100-5*pstats.iPillage_odds;if(pstats.bombard_retaliate_rounds>0){pstats.bombard_retaliate_rounds--;if(pstats.bombard_retaliate_rounds==0){pstats.bombard_retaliate_rounds=1e3}}return pstats}function unit_get_bombard_stats(punit){if(!punit)return{};return utype_get_bombard_stats(unit_type(punit))}function utype_get_bombard_stats(ptype){if(!ptype)return{};var pstats={};var BB=ptype["city_size"];pstats.bit_field=BB;pstats.bombard_extra_range=BB&1;pstats.bombard_stay_fortified=(BB&2)>>1;pstats.bombard_move_cost=(BB&252)>>2;pstats.bombard_primary_targets=(BB&1792)>>8;pstats.bombard_primary_kills=(BB&14336)>>11;pstats.bombard_atk_mod=(BB&507904)>>14;if(BB&524288)pstats.bombard_atk_mod*=-3;else pstats.bombard_atk_mod*=25;return pstats}function unit_get_flag_image(punit,height){var tag=nations[players[punit["owner"]]["nation"]]["graphic_str"];var civ_flag_url="";var image_element="";if(!nations[players[punit["owner"]]["nation"]]["customized"]){civ_flag_url+="/images/flags/"+tag+"-web"+get_tileset_file_extention();image_element="<img "+"class='v' "+"src='"+civ_flag_url+"' "+"title='"+nations[players[punit["owner"]]["nation"]]["adjective"]+"' "+"style='height:"+height+"px;'"+">";return image_element}return""}function unit_get_shield_image(punit){var owner_id=punit["owner"];var owner=players[owner_id];var nation_id=owner["nation"];var nation=nations[nation_id];return get_html_nation_shield_sprite(nation)}var unit_types={};var unit_classes={};var U_NOT_OBSOLETED=null;var U_LAST=MAX_NUM_UNITS;const UCF_TERRAIN_SPEED=0;const UCF_TERRAIN_DEFENSE=1;const UCF_DAMAGE_SLOWS=2;const UCF_CAN_OCCUPY_CITY=3;const UCF_BUILD_ANYWHERE=4;const UCF_UNREACHABLE=5;const UCF_COLLECT_RANSOM=6;const UCF_ZOC=7;const UCF_CAN_FORTIFY=8;const UCF_DOESNT_OCCUPY_TILE=9;const UCF_ATTACK_NON_NATIVE=10;const UCF_KILLCITIZEN=11;const UCF_USER_FLAG_1=12;const UCF_USER_FLAG_2=13;const UCF_USER_FLAG_3=14;const UCF_USER_FLAG_4=15;const UCF_USER_FLAG_5=16;const UCF_USER_FLAG_6=17;const UCF_USER_FLAG_7=18;const UCF_USER_FLAG_8=19;const UCF_USER_FLAG_9=20;const UCF_USER_FLAG_10=21;const UCF_USER_FLAG_11=22;const UCF_USER_FLAG_12=23;const UCF_AIRLIFTABLE=UCF_USER_FLAG_1;const UCF_BORDERPOLICE=UCF_USER_FLAG_2;const UCF_ATTACK_FROM_NON_NATIVE=UCF_USER_FLAG_3;const UTYF_CANT_FORTIFY=0;const UTYF_NOZOC=1;const UTYF_IGZOC=2;const UTYF_CIVILIAN=3;const UTYF_IGTER=4;const UTYF_ONEATTACK=5;const UTYF_FIELDUNIT=6;const UTYF_PROVOKING=7;const UTYF_NEVER_PROTECTS=8;const UTYF_SETTLERS=9;const UTYF_DIPLOMAT=10;const UTYF_COAST_STRICT=11;const UTYF_COAST=12;const UTYF_SHIELD2GOLD=13;const UTYF_SPY=14;const UTYF_ONLY_NATIVE_ATTACK=15;const UTYF_FANATIC=16;const UTYF_GAMELOSS=17;const UTYF_UNIQUE=18;const UTYF_EVAC_FIRST=19;const UTYF_SUPERSPY=20;const UTYF_NOHOME=21;const UTYF_NO_VETERAN=22;const UTYF_CITYBUSTER=23;const UTYF_NOBUILD=24;const UTYF_BADWALLATTACKER=25;const UTYF_BADCITYDEFENDER=26;const UTYF_BARBARIAN_ONLY=27;const UTYF_BEACH_LANDER=28;const UTYF_NEWCITY_GAMES_ONLY=29;const UTYF_CANESCAPE=30;const UTYF_CANKILLESCAPING=31;const UTYF_NEVER_BLOCKED=32;const UTYF_USER_FLAG_1=33;const UTYF_USER_FLAG_2=34;const UTYF_USER_FLAG_3=35;const UTYF_USER_FLAG_4=36;const UTYF_USER_FLAG_5=37;const UTYF_USER_FLAG_6=38;const UTYF_USER_FLAG_7=39;const UTYF_USER_FLAG_8=40;const UTYF_USER_FLAG_9=41;const UTYF_USER_FLAG_10=42;const UTYF_USER_FLAG_11=43;const UTYF_USER_FLAG_12=44;const UTYF_USER_FLAG_13=45;const UTYF_USER_FLAG_14=46;const UTYF_USER_FLAG_15=47;const UTYF_USER_FLAG_16=48;const UTYF_USER_FLAG_17=49;const UTYF_USER_FLAG_18=50;const UTYF_USER_FLAG_19=51;const UTYF_USER_FLAG_20=52;const UTYF_USER_FLAG_21=53;const UTYF_USER_FLAG_22=54;const UTYF_USER_FLAG_23=55;const UTYF_USER_FLAG_24=56;const UTYF_USER_FLAG_25=57;const UTYF_USER_FLAG_26=58;const UTYF_USER_FLAG_27=59;const UTYF_USER_FLAG_28=60;const UTYF_USER_FLAG_29=61;const UTYF_USER_FLAG_30=62;const UTYF_USER_FLAG_31=63;const UTYF_USER_FLAG_32=64;const UTYF_USER_FLAG_33=65;const UTYF_USER_FLAG_34=66;const UTYF_USER_FLAG_35=67;const UTYF_USER_FLAG_36=68;const UTYF_USER_FLAG_37=69;const UTYF_USER_FLAG_38=70;const UTYF_AIRBASE=UTYF_USER_FLAG_1;const UTYF_TRANSFORM=UTYF_USER_FLAG_2;const UTYF_CANROAD=UTYF_USER_FLAG_3;const UTYF_CANFORTRESS=UTYF_USER_FLAG_4;const UTYF_BOMBARDER=UTYF_USER_FLAG_5;const UTYF_AIRATTACKER=UTYF_USER_FLAG_6;const UTYF_HORSE=UTYF_USER_FLAG_7;const UTYF_FOOTSOLDIER=UTYF_USER_FLAG_8;const UTYF_HELICOPTER=UTYF_USER_FLAG_9;const UTYF_SUBMARINE=UTYF_USER_FLAG_10;const UTYF_UNBRIBABLE=UTYF_USER_FLAG_11;const UTYF_TRADEROUTE=UTYF_USER_FLAG_12;const UTYF_HELPWONDER=UTYF_USER_FLAG_13;const UTYF_CAPTURER=UTYF_USER_FLAG_14;const UTYF_CAPTURABLE=UTYF_USER_FLAG_15;const UTYF_CITIES=UTYF_USER_FLAG_16;const UTYF_ADDTOCITY=UTYF_USER_FLAG_17;const UTYF_NUCLEAR=UTYF_USER_FLAG_18;const UTYF_MISSILE=UTYF_USER_FLAG_19;const UTYF_WELLDIGGER=UTYF_USER_FLAG_20;const UTYF_INFRA=UTYF_USER_FLAG_21;const UTYF_PROLETARIAN=UTYF_USER_FLAG_22;const UTYF_PARATROOPERS=UTYF_USER_FLAG_23;const UTYF_MARINES=UTYF_USER_FLAG_24;const UTYF_EXPELLABLE=UTYF_USER_FLAG_25;const UTYF_AIRPROTECTOR=UTYF_USER_FLAG_26;const UTYF_CANT_REACH_AIR=UTYF_USER_FLAG_27;const UTYF_FORTBUSTER=UTYF_USER_FLAG_28;const UTYF_FORTRESSBUSTER=UTYF_USER_FLAG_29;const UTYF_ANTIAIR=UTYF_USER_FLAG_30;const UTYF_MULTISLOT=UTYF_USER_FLAG_31;const UTYF_CANHIDE=UTYF_USER_FLAG_32;const UTYF_WILLNEVER=UTYF_USER_FLAG_33;const UTYF_TRANSPORTDEFENDER=UTYF_USER_FLAG_34;function utype_can_do_action(putype,action_id){if(putype==null||putype["utype_actions"]==null){console.log("utype_can_do_action(): bad unit type.");return false}else if(action_id>=ACTION_COUNT||action_id<0){console.log("utype_can_do_action(): invalid action id "+action_id);return false}return putype["utype_actions"].isSet(action_id)}function can_player_build_unit_direct(p,punittype){if(player_invention_state(p,punittype["tech_requirement"])!=TECH_KNOWN){return false}return true}function utype_has_class_flag(ptype,flag){return unit_classes[ptype["unit_class_id"]]["flags"].isSet(flag)}function utype_has_flag(ptype,flag){var bv=new BitVector(ptype["flags"]);return bv.isSet(flag)}function get_utypes_from_tech(tech_id){var result=[];for(var unit_type_id in unit_types){var punit_type=unit_types[unit_type_id];if(punit_type["tech_requirement"]==tech_id){result.push(punit_type)}}return result}function utype_real_base_attack_strength(ptype){if(ptype.power_fact[0]===undefined)return ptype.attack_strength;var adjusted=ptype.attack_strength*ptype.power_fact[0];adjusted*=10;adjusted=Math.round(adjusted)/1e3;return adjusted}function utype_real_base_defense_strength(ptype){if(ptype.power_fact[0]===undefined)return ptype.defense_strength;var adjusted=ptype.defense_strength*ptype.power_fact[0];adjusted*=10;adjusted=Math.round(adjusted)/1e3;return adjusted}function utype_real_base_move_rate(punit_type){var move_bonus=parseInt(punit_type["move_bonus"][0])?parseInt(punit_type["move_bonus"][0]):0;var move_rate=parseInt(punit_type["move_rate"]);return move_bonus+move_rate}var stripChar=[];stripChar[0]=new RegExp(String.fromCharCode(3),"g");const STRIPCHAR_LAST=1;String.prototype.repeat=String.prototype.repeat||function(n){if(n<0)throw new RangeError("invalid count value");if(n==0)return"";return new Array(n+1).join(this.toString())};function clone(obj){if(obj==null||typeof obj!="object"){return obj}var temp=obj.constructor();for(var key in obj){temp[key]=clone(obj[key])}return temp}function DIVIDE(n,d){return parseInt(n/d-(n<0&&n%d<0?1:0))}function FC_WRAP(value,range){return value<0?value%range!=0?value%range+range:0:value>=range?value%range:value}function XOR(a,b){return(a||b)&&!(a&&b)}function fraction_reduce(numerator,denominator){var gcd=function gcd(a,b){return b?gcd(b,a%b):a};gcd=gcd(numerator,denominator);return{numerator:numerator/gcd,denominator:denominator/gcd}}$.extend({getUrlVars:function(){var vars=[],hash;var hashes=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var i=0;i<hashes.length;i++){hash=hashes[i].split("=");vars.push(hash[0]);vars[hash[0]]=hash[1]}return vars},getUrlVar:function(name){return $.getUrlVars()[name]}});var benchmark_start=0;function civclient_benchmark(frame){if(frame==0)benchmark_start=(new Date).getTime();var ptile=map_pos_to_tile(frame+5,frame+5);center_tile_mapcanvas(ptile);if(frame<30){setTimeout("civclient_benchmark("+(frame+1)+");",10)}else{var end=(new Date).getTime();var time=(end-benchmark_start)/25;swal("Redraw time: "+time);setSwalTheme()}}function numberWithCommas(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function to_title_case(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})}function string_unqualify(str){if(str.charAt(0)=="?"&&str.indexOf(":")!=-1){return str.substr(str.indexOf(":")+1)}else{return str}}function get_random_int(min,max){return Math.floor(fc_seedrandom()*(max-min))+min}function supports_mp3(){var a=document.createElement("audio");return!!(a.canPlayType&&a.canPlayType("audio/mpeg;").replace(/no/,""))}function is_right_mouse_selection_supported(){if(is_touch_device()||platform.description.indexOf("Mac OS X")>0||platform.description.indexOf("Chrome OS")>0||platform.description.indexOf("CrOS")>0){return false}else{return true}}function seconds_to_human_time(input_seconds){if(input_seconds<=0)return 0+"s";var hours=Math.floor(input_seconds/3600);var minutes=Math.floor((input_seconds-hours*3600)/60);var seconds=input_seconds-hours*3600-minutes*60;if(!is_small_screen()){if(hours>0)return hours+"h "+minutes+"m ";else if(hours==0&&minutes>0)return minutes+"m "+seconds+"s";else if(hours==0&&minutes==0)return seconds+"s"}else{if(hours>0)return hours+"."+Math.floor(minutes*10/60)+"h";else if(hours==0&&minutes>9)return minutes+"m";else return minutes+":"+seconds}}function get_tileset_file_extention(){return".png"}function is_any_word_in_string(string,words_array){for(var i=0;i<words_array.length;i++){if(string.indexOf(words_array[i])!=-1)return true}return false}function copy_string_to_clipboard(str){var el=document.createElement("textarea");el.value=str;el.setAttribute("readonly","");el.style={position:"absolute",left:"-9999px"};document.body.appendChild(el);el.select();document.execCommand("copy");document.body.removeChild(el)}function alphanumeric_cleaner(text){var regex=/([\u0020-\u0021\u0026-\u0039\u0026-\u0027\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]+)/g;var result=text.match(regex);if(result==null||result.length>1)return"";return result}function alphanumeric_cleaner_city_names(text){var regex=/([\u0020-\u0021\u0026-\u0039\u0026-\u0027\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2019\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]+)/g;var result=text.match(regex);if(result==null||result.length>1)return"";return result}function unobstruct_minimized_dialog_continer(){$("#dialog-extend-fixed-container").children().css("visibility","visible");$("#dialog-extend-fixed-container").css("visibility","hidden")}function html_safe(text){text=text.replace(/'/g,"&#39;");text=text.replace(/"/g,"&#34;");text=text.replace(/[\x03]/g,"\n");return text}function html_emoji_from_universal(universal_name){var freemoji_name=universal_name.toLowerCase();freemoji_name=freemoji_name.replace(/\s+/g,"");freemoji_name=freemoji_name.replace(".","");freemoji_name=freemoji_name.replace("_","");freemoji_name=freemoji_name.replace("_","");freemoji_name=freemoji_name.replace("_","");freemoji_name=freemoji_name.replace("'","");var path="/images/e/"+freemoji_name+".png";var element="<img class='v' src='"+path+"'>";return element}function getHash(input){var hash=0,len=input.length;for(var i=0;i<len;i++){hash=(hash<<5)-hash+input.charCodeAt(i);hash|=0}return Math.abs(hash).toString()}function wait(ms){var start=(new Date).getTime();var end=start;while(end<start+ms){end=(new Date).getTime()}}function cleaned_text(str){for(i=0;i<STRIPCHAR_LAST;i++){str=str.replace(stripChar[i],"")}return str}function capitalize(s){if(typeof s!=="string")return"";return s.charAt(0).toUpperCase()+s.slice(1)}function uncapitalize(s){if(typeof s!=="string")return"";return s.charAt(0).toLowerCase()+s.slice(1)}function fractionalize(s){if(s.toString().endsWith(".5"))s=""+Math.trunc(s)+"&#189;";else if(s.toString().endsWith(".75"))s=""+(Math.trunc(s)?Math.trunc(s):"")+"&#xBE;";else if(s.toString().endsWith(".25"))s=""+(Math.trunc(s)?Math.trunc(s):"")+"&#xBC;";else if(s.toString().endsWith(".05"))s=""+(Math.trunc(s)?Math.trunc(s):"")+"&#8203;1&#x2044;20";else if(s.toString().endsWith(".1"))s=""+(Math.trunc(s)?Math.trunc(s):"")+"&#x2152;";return s}function getLength(obj){if(obj)return Object.keys(obj).length;else return 0}function pluralize(str,num){if(num>1){str+="s";return""+num+" "+str}else return"1 "+str}var my_hp="";var my_str="";var my_fp=1;var my_uid=null;var their_hp="";var their_str="";var their_fp=1;var their_uid=null;const WARCALC_ATTACKING=0;const WARCALC_DEFENDING=1;var warcalc_role_mode=WARCALC_ATTACKING;function warcalc_screen(){$("#warcalc_scroll").css("width","auto");$("#warcalc_tab").show();$("#warcalc_tab").children().show();warcalc_reset_roles();if(current_focus&&current_focus.length>0)warcalc_set_default_vals(current_focus[0]);$("#id_astr").val(my_str);$("#id_dstr").val(their_str);$("#id_ahp").val(my_hp);$("#id_dhp").val(their_hp);$("#id_afp").val(my_fp);$("#id_dfp").val(their_fp);$("#att_win").html("");$("#def_win").html("");$("#exp_hp").html("");setTimeout(function(){$("#id_astr").focus();$("#id_astr").select()},200);warcalc_update_titles()}function warcalc_reset_roles(){if(warcalc_role_mode!=WARCALC_ATTACKING){warcalc_role_mode=WARCALC_ATTACKING;if(my_uid&&units[my_uid])warcalc_set_default_vals(units[my_uid]);if(their_uid&&units[their_uid])warcalc_set_default_vals(units[their_uid])}}function warcalc_update_titles(){if(!my_uid||!their_uid||!units[my_uid]||!units[their_uid])return;if(warcalc_role_mode==WARCALC_ATTACKING){$("#wcamsg").prop("title","Your "+unit_types[units[my_uid]["type"]]["name"]+" is set as attacker.\n\nOnly Veteran bonus is auto-calculated");$("#wcamsg").html("A:&#11088;"+unit_types[units[my_uid]["type"]]["name"]);$("#wcdmsg").prop("title","Foreign "+unit_types[units[their_uid]["type"]]["name"]+" is set as defender.\n\nVeteran, Terrain, and Fortify bonuses are included.\n\nNot included:\n Base, Unit-type bonus, City modifiers");$("#wcdmsg").html("D:"+unit_types[units[their_uid]["type"]]["name"])}else if(warcalc_role_mode==WARCALC_DEFENDING){$("#wcamsg").prop("title","Foreign "+unit_types[units[their_uid]["type"]]["name"]+" is set as attacker.\n\nOnly Veteran bonus is auto-calculated");$("#wcamsg").html("A:"+unit_types[units[their_uid]["type"]]["name"]);$("#wcdmsg").prop("title","Your "+unit_types[units[my_uid]["type"]]["name"]+" is set as defender.\n\nVeteran, Terrain, and Fortify bonuses are included.\n\nNot included:\n Base, Unit-type bonus, City modifiers");$("#wcdmsg").html("D:&#11088;"+unit_types[units[my_uid]["type"]]["name"])}}function warcalc_swap_roles(){if(!my_uid||!their_uid)return;if(!(units[my_uid]&&units[their_uid]))return;warcalc_role_mode=1-warcalc_role_mode;if(warcalc_compute_role_strength(my_uid,their_uid)){warcalc_update_titles()}}function warcalc_compute_role_strength(my_uid,their_uid){var punit;var ptype;var power_fact=100;if(!(my_uid&&their_uid&&units[their_uid]&&units[my_uid]))return false;if(warcalc_role_mode==WARCALC_ATTACKING){warcalc_set_default_vals(units[my_uid]);warcalc_set_default_vals(units[their_uid]);$("#id_astr").val(my_str);$("#id_dstr").val(their_str);$("#id_ahp").val(my_hp);$("#id_dhp").val(their_hp);$("#id_afp").val(my_fp);$("#id_dfp").val(their_fp);$("#att_win").html("");$("#def_win").html("");$("#exp_hp").html("")}else if(warcalc_role_mode==WARCALC_DEFENDING){punit=units[their_uid];ptype=unit_types[punit["type"]];if(punit["veteran"]){if(ptype["veteran_levels"]>0){power_fact=ptype["power_fact"][punit["veteran"]]}else{power_fact=game_rules["power_fact"][punit["veteran"]]}}their_hp=punit["hp"];their_fp=ptype["firepower"];their_str=utype_real_base_attack_strength(ptype);their_str*=power_fact/100;if(their_str-Math.trunc(their_str))their_str=trim_decimals(their_str);if(units[my_uid])punit=units[my_uid];else return false;ptype=unit_types[punit["type"]];power_fact=warcalc_get_defense_bonus(punit);my_hp=punit["hp"];my_str=utype_real_base_defense_strength(ptype);my_fp=ptype["firepower"];my_str*=power_fact/100;my_str=trim_decimals(my_str);$("#id_dstr").val(my_str);$("#id_astr").val(their_str);$("#id_dhp").val(my_hp);$("#id_ahp").val(their_hp);$("#id_dfp").val(my_fp);$("#id_afp").val(their_fp);$("#att_win").html("");$("#def_win").html("");$("#exp_hp").html("")}return true}function warcalc_set_default_vals(punit){var ptype=unit_types[punit["type"]];var power_fact=100;if(!client_is_observer()&&punit["owner"]==client.conn.playing.playerno){if(punit["veteran"]){if(ptype["veteran_levels"]>0){power_fact=ptype["power_fact"][punit["veteran"]]}else{power_fact=game_rules["power_fact"][punit["veteran"]]}}my_hp=punit["hp"];my_str=power_fact==100?utype_real_base_attack_strength(ptype):ptype["attack_strength"];my_fp=ptype["firepower"];my_uid=punit["id"];my_str*=power_fact/100;if(my_str-Math.trunc(my_str))my_str=trim_decimals(my_str)}else{power_fact=warcalc_get_defense_bonus(punit);their_hp=punit["hp"];their_str=power_fact==100?utype_real_base_defense_strength(ptype):ptype["defense_strength"];their_fp=ptype["firepower"];their_uid=punit["id"];their_str*=power_fact/100;their_str=trim_decimals(their_str)}}function trim_decimals(value){if(value<1)return value;return Math.round(parseFloat(value)*100)/100}function warcalc_get_defense_bonus(punit){var power_fact=100;if(punit["veteran"]){var ptype=unit_types[punit["type"]];if(ptype["veteran_levels"]>0){power_fact=ptype["power_fact"][punit["veteran"]]}else{power_fact=game_rules["power_fact"][punit["veteran"]]}}if(unit_has_class_flag(punit,UCF_TERRAIN_DEFENSE)){var ptile=tiles[punit["tile"]];const terrain=terrains[ptile["terrain"]];var terrain_fact=1+terrain["defense_bonus"]/100;if(tile_has_extra(ptile,EXTRA_RIVER)){if(client_rules_flag[CRF_MP2_C])terrain_fact+=.5;else terrain_fact*=1+extras[EXTRA_RIVER]["defense_bonus"]/100}power_fact*=terrain_fact}if(punit["activity"]==ACTIVITY_FORTIFIED){if(!tile_city(ptile)){power_fact*=1.5}}return power_fact}function warcalc_compute(){var att=$("#id_astr").val();var def=$("#id_dstr").val();var ahp=$("#id_ahp").val();var dhp=$("#id_dhp").val();var afp=$("#id_afp").val();var dfp=$("#id_dfp").val();var prob=100*warcalc_win_chance(att,ahp,afp,def,dhp,dfp);$("#att_win").html("<br>Attacker has a <b style='font-size:115%'>"+prob.toFixed(2)+"%</b> chance to win.");$("#def_win").html("Defender has a "+(100-prob).toFixed(2)+"% chance to win.");$("#wc_done_btn").show();expected_hitpoints(att,ahp,afp,def,dhp,dfp)}function warcalc_win_chance(as,ahp,afp,ds,dhp,dfp){var as=parseFloat(as);var ds=parseFloat(ds);var ahp=parseFloat(ahp);var dhp=parseFloat(dhp);var afp=parseFloat(afp);var dfp=parseFloat(dfp);if(afp>=dhp){return 1-Math.pow(ds/(as+ds),ahp)}var att_N_lose=Math.trunc((ahp+dfp-1)/dfp);var def_N_lose=Math.trunc((dhp+afp-1)/afp);var att_P_lose1=as+ds==0?.5:ds/(as+ds);var def_P_lose1=1-att_P_lose1;var binom_save=Math.pow(def_P_lose1,def_N_lose-1);var accum_prob=binom_save;for(let lr=1;lr<att_N_lose;lr++){var n=lr+def_N_lose-1;binom_save*=n;binom_save/=lr;binom_save*=att_P_lose1;accum_prob+=binom_save}accum_prob*=def_P_lose1;return accum_prob}function expected_hitpoints(att,ahp,afp,def,dhp,dfp){var att=parseFloat(att);var def=parseFloat(def);var ahp=parseFloat(ahp);var dhp=parseFloat(dhp);var afp=parseFloat(afp);var dfp=parseFloat(dfp);var p=att/(att+def);for(i=0;i<60;i++){dhp-=p*afp;ahp-=(1-p)*dfp;if(ahp<1||dhp<1)break}if(ahp<1&&dhp<1){}else{if(ahp<1)ahp="<b>DEAD</b>";if(dhp<1)dhp="<b>DEAD</b>"}if(ahp>0)ahp="<b>"+ahp.toFixed(2)+"</b> hp";if(dhp>0)dhp="<b>"+dhp.toFixed(2)+"</b> hp";$("#exp_hp").html("<br><br>Attacker: "+ahp+"<br>Defender: "+dhp)}function wc_A(mult){var base=$("#id_astr").val();base*=mult;base=trim_decimals(base);$("#id_astr").val(base)}function wc_D(mult){var base=$("#id_dstr").val();base*=mult;base=trim_decimals(base);$("#id_dstr").val(base)}function warcalc_done(){$("#ui-ui-8").hide();set_default_mapview_active();$("#map_tab").click()}function warcalc_set_tooltips(){$(".tiny_button").show();$(".tiny_button").tooltip();$(".wcttmsg").tooltip();$(".wcttmsg").tooltip({open:function(event,ui){ui.tooltip.css("max-width","400px")}});const bl="* ";const nbl="\n* ";$("#wcamsg").tooltip({open:function(event,ui){ui.tooltip.css("max-width","450px")}});$("#wcdmsg").tooltip({open:function(event,ui){ui.tooltip.css("max-width","450px")}});if(ruleset_control["name"].startsWith("MP2")||ruleset_control["name"].startsWith("Avant-garde")||ruleset_control["name"]=="Multiplayer-Evolution ruleset"){if(is_small_screen()){$("#wcth1").hide();$("#wcth2").hide();$("#wcttmsg").prop("disabled",true);$("#wc400").hide();var scale=parseFloat($(window).width()-9)/352*.77;var transX=88*scale-82;if(scale>1)scale=1;var tran_str="scale("+scale+") translateX("+transX+"%)";$("#wcbtbl").css({transform:tran_str})}$("#wc500").hide();$("#wc125").prop("title",bl+"In city with SAM Battery vs. Stealth Aircraft");$("#wc133").prop("title",bl+"River"+nbl+"Swamp"+nbl+"Forest"+nbl+"Land/Heli in Fort vs. Land/Sea/Missile (not Armor)"+nbl+"Fighter over Fort/Fortress vs. Land/Sea/Missile (not Armor)"+nbl+"Sea unit in Naval base");$("#wc150").prop("title",bl+"Veteran-1 ('Veteran')"+nbl+"Jungle"+nbl+"Land unit Fortified OR inside city");$("#wc167").prop("title",bl+"Land/Heli in Fortress vs Armor/Aircraft"+nbl+"Land/Heli in Naval Base vs Armor/Aircraft");$("#wc175").prop("title",bl+"Veteran-2 ('Hardened')");$("#wc200").prop("title",bl+"Veteran-3 ('Elite')"+nbl+"Hills"+nbl+"Land/Heli in Fortress vs. Land/Sea/Missile"+nbl+"In city with Coastal Defense vs. Sea"+nbl+"In city with SAM Battery vs. Air (not Stealth)"+nbl+"In city with SDI vs. Missile"+nbl+"Pikemen vs Horse (not Cavalry)"+nbl+"Knight vs. Foot soldier"+nbl+"Cruiser,Battleship,M.Destroyer,AEGIS vs Submarine"+nbl+"Sea unit vs. Marines"+nbl+"AAA/Mobile SAM vs. Aircraft"+nbl+"Missile Destroyer vs. Air/Missile"+nbl+"Armor II vs. Missile");$("#wc210").prop("title",bl+"Veteran-4 ('Crack')");$("#wc220").prop("title",bl+"Veteran-5 ('Master')");$("#wc230").prop("title",bl+"Veteran-6 ('Champion')");$("#wc300").prop("title",bl+"Mountains"+nbl+"In city with City Walls vs Land (not Howitzer)"+nbl+"Knight vs. Horse (not Cavalry)"+nbl+"AEGIS vs. Air/Missile");$("#wc400").prop("title",bl+"Destroyer vs. Submarine");$("#wca133").hide();$("#wca167").hide();$("#wca125").prop("title",bl+"Stealth Aircraft vs. AAA/Mobile SAM/AEGIS Cruiser");$("#wca150").prop("title",bl+"Veteran-1 ('Veteran')"+nbl+"Phalanx/Pikemen + Agoge of Sparta");$("#wca175").prop("title",bl+"Veteran-2 ('Hardened')");$("#wca200").prop("title",bl+"Veteran-3 ('Elite')"+nbl+"AAA/Mobile SAM vs. Aircraft"+nbl+"Fighter vs Heli (also: Heli FP=1)")+nbl+"Any unit vs Ship in a city: Defend FP1, Attack FP x2";$("#wca210").prop("title",bl+"Veteran-4 ('Crack')");$("#wca220").prop("title",bl+"Veteran-5 ('Master')");$("#wca230").prop("title",bl+"Veteran-6 ('Champion')");$("#wc125").tooltip({open:function(event,ui){ui.tooltip.css("max-width","450px")}});$("#wc133").tooltip({open:function(event,ui){ui.tooltip.css("max-width","450px")}});$("#wc167").tooltip({open:function(event,ui){ui.tooltip.css("max-width","450px")}});$("#wc200").tooltip({open:function(event,ui){ui.tooltip.css("max-width","460px")}});$("#wc300").tooltip({open:function(event,ui){ui.tooltip.css("max-width","450px")}});if(ruleset_control["name"].startsWith("Avant-garde")||ruleset_control["name"].startsWith("MP2")){$("#wc133").prop("title",bl+"River"+nbl+"Swamp"+nbl+"Forest"+nbl+"Land/Heli in Fort vs. Land/Sea/Missile (not Armor)"+nbl+"Fighter over Fort/Fortress vs. Land/Sea/Missile (not Armor)"+nbl+"Dive Bomber, Ground Strike Fighter vs. Anti-Air");$("#wc150").prop("title",bl+"Veteran-1 ('Veteran')"+nbl+"Jungle"+nbl+"Land unit Fortified OR inside city"+nbl+"Helicopter vs. Foot or Mounted units");$("#wc167").prop("title",bl+"Land/Heli in Fortress vs Armor/Aircraft"+nbl+"Land/Heli/Sea in Naval Base vs Armor/Aircraft");$("#wc200").prop("title",bl+"Veteran-3 ('Elite')"+nbl+"Hills"+nbl+"Land/Heli in Fortress vs. Land/Sea/Missile"+nbl+"Land/Heli/Sea in Naval Base vs. Land/Sea/Missile"+nbl+"In city with Coastal Defense vs. Sea"+nbl+"In city with SAM Battery vs. Air/Heli (not Stealth)"+nbl+"In city with SDI vs. Missile"+nbl+"Pikemen vs Horse (not Cavalry)"+nbl+"Knight vs. Foot soldier"+nbl+"Cruiser,Battleship,M.Destroyer,AEGIS vs Submarine"+nbl+"Sea unit vs. Marines"+nbl+"AAA/Mobile SAM vs. Aircraft"+nbl+"Missile Destroyer vs. Air/Missile"+nbl+"Armor II vs. Missile");$("#wca150").prop("title",bl+"Veteran-1 ('Veteran')"+nbl+"Phalanx/Pikemen + Agoge of Sparta"+nbl+"Dive Bomber vs. Land or Sea");$("#wca200").prop("title",bl+"Veteran-3 ('Elite')"+nbl+"AAA/Mobile SAM vs. Aircraft")}if(ruleset_control["name"].startsWith("MP2 C")){$("#wc175").prop("title",bl+"Veteran-2 ('Hardened')"+nbl+"In city with Fortifications vs Land (not Howitzer)");$("#wc150").prop("title",bl+"Veteran-1 ('Veteran')"+nbl+"Jungle"+nbl+"Land unit Fortified OR inside city"+nbl+"Helicopter vs. Foot or Mounted units"+nbl+"Forest in city with Fortifications"+nbl+"Swamp in city with Fortifications");$("#wc167").prop("title",bl+"Land/Heli in Fortress vs Armor/Aircraft"+nbl+"Land/Heli/Sea in Naval Base vs Armor/Aircraft"+nbl+"Jungle in city with Fortifications");$("#wc125").prop("title",bl+"In city with SAM Battery vs. Stealth Aircraft");$("#wca125").prop("title",bl+"Catapult vs Fortifications or City Walls"+nbl+"Stealth Aircraft vs. AAA/Mobile SAM/AEGIS Cruiser");$("#wca150").prop("title",bl+"Veteran-1 ('Veteran')"+nbl+"Cannon vs Fortifications or City Walls"+nbl+"Phalanx/Pikemen + Agoge of Sparta"+nbl+"Dive Bomber vs. Land or Sea");$("#wca175").prop("title",bl+"Veteran-2 ('Hardened')"+nbl+"Artillery vs Fortifications or City Walls")}return}$("#wc133").hide();$("#wc167").hide();$("#wc210").hide();$("#wc220").hide();$("#wc230").hide();$("#wc400").hide();$("#wca125").hide();$("#wca133").hide();$("#wca167").hide();$("#wca210").hide();$("#wca220").hide();$("#wca230").hide();if(ruleset_control["name"]=="Multiplayer-Plus ruleset"||ruleset_control["name"]=="Multiplayer ruleset"||ruleset_control["name"]=="Classic ruleset"){$("#wc125").hide();$("#wc150").prop("title",bl+"Veteran-1 ('Veteran')"+nbl+"River"+nbl+"Swamp"+nbl+"Forest"+nbl+"Jungle"+nbl+"Land unit Fortified OR inside city");$("#wc175").prop("title",bl+"Veteran-2 ('Hardened')");$("#wc200").prop("title",bl+"Veteran-3 ('Elite')"+nbl+"Hills"+nbl+"Land/Heli in Fortress vs. Land/Sea units"+nbl+"Pikemen vs. Horse (not Cavalry)"+nbl+"In city with Coastal Defense vs. Sea"+nbl+"In city with SAM Battery vs. Aircraft"+nbl+"In city with SDI vs. Missile");$("#wc300").prop("title",bl+"Mountains"+nbl+"In city with City Walls vs Land/Heli (not Howitzer)");$("#wc500").prop("title",bl+"AEGIS vs. Air/Missile");$("#wca150").prop("title",bl+"Veteran-1 ('Veteran')");$("#wca175").prop("title",bl+"Veteran-2 ('Hardened')");$("#wca200").prop("title",bl+"Veteran-3 ('Elite')"+nbl+"Fighter vs Heli (also: Heli FP=1)");$("#wc200").tooltip({open:function(event,ui){ui.tooltip.css("max-width","400px")}});$("#wc300").tooltip({open:function(event,ui){ui.tooltip.css("max-width","400px")}})}if(ruleset_control["name"]=="Civ2Civ3 ruleset"){$("#wc300").hide();$("#wc125").prop("title",bl+"River"+nbl+"Swamp"+nbl+"Forest"+nbl+"Jungle");$("#wc150").prop("title",bl+"Veteran-1 ('Veteran')"+nbl+"Hills"+nbl+"Land unit Fortified OR inside city"+nbl+"Sea unit inside city"+nbl+"Land unit in Fort vs. Land/Sea"+nbl+"On Airstrip vs. Aircraft"+nbl+"In Airbase vs. Land/Sea"+nbl+"In city and Nation has Great Wall");$("#wc175").prop("title",bl+"Veteran-2 ('Hardened')");$("#wc200").prop("title",bl+"Veteran-3 ('Elite')"+nbl+"Mountains"+nbl+"Destroyer vs. Submarine"+nbl+""+"Land unit in Fortress vs. Land/Sea"+nbl+"In Airbase vs. Aircraft"+nbl+"In city with City Walls vs Land unit"+nbl+"In city with Coastal Defense vs. Sea"+nbl+"In city with SAM Battery vs. Air/Heli"+nbl+"In city with SDI vs. Missile");$("#wc500").prop("title",bl+"AEGIS vs. Air/Missile");$("#wca150").prop("title",bl+"Veteran-1 ('Veteran')");$("#wca175").prop("title",bl+"Veteran-2 ('Hardened')");$("#wca200").prop("title",bl+"Veteran-3 ('Elite')");$("#wc150").tooltip({open:function(event,ui){ui.tooltip.css("max-width","400px")}});$("#wc200").tooltip({open:function(event,ui){ui.tooltip.css("max-width","400px")}})}}(function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)})(function(t){function e(t){for(var e=t.css("visibility");"inherit"===e;)t=t.parent(),e=t.css("visibility");return"hidden"!==e}function i(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.ui=t.ui||{},t.ui.version="1.12.1";var s=0,n=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,n,o;for(o=0;null!=(n=i[o]);o++)try{s=t._data(n,"events"),s&&s.remove&&t(n).triggerHandler("remove")}catch(a){}e(i)}}(t.cleanData),t.widget=function(e,i,s){var n,o,a,r={},l=e.split(".")[0];e=e.split(".")[1];var h=l+"-"+e;return s||(s=i,i=t.Widget),t.isArray(s)&&(s=t.extend.apply(null,[{}].concat(s))),t.expr[":"][h.toLowerCase()]=function(e){return!!t.data(e,h)},t[l]=t[l]||{},n=t[l][e],o=t[l][e]=function(t,e){return this._createWidget?(arguments.length&&this._createWidget(t,e),void 0):new o(t,e)},t.extend(o,n,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),a=new i,a.options=t.widget.extend({},a.options),t.each(s,function(e,s){return t.isFunction(s)?(r[e]=function(){function t(){return i.prototype[e].apply(this,arguments)}function n(t){return i.prototype[e].apply(this,t)}return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=n,e=s.apply(this,arguments),this._super=i,this._superApply=o,e}}(),void 0):(r[e]=s,void 0)}),o.prototype=t.widget.extend(a,{widgetEventPrefix:n?a.widgetEventPrefix||e:e},r,{constructor:o,namespace:l,widgetName:e,widgetFullName:h}),n?(t.each(n._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete n._childConstructors):i._childConstructors.push(o),t.widget.bridge(e,o),o},t.widget.extend=function(e){for(var i,s,o=n.call(arguments,1),a=0,r=o.length;r>a;a++)for(i in o[a])s=o[a][i],o[a].hasOwnProperty(i)&&void 0!==s&&(e[i]=t.isPlainObject(s)?t.isPlainObject(e[i])?t.widget.extend({},e[i],s):t.widget.extend({},s):s);return e},t.widget.bridge=function(e,i){var s=i.prototype.widgetFullName||e;t.fn[e]=function(o){var a="string"==typeof o,r=n.call(arguments,1),l=this;return a?this.length||"instance"!==o?this.each(function(){var i,n=t.data(this,s);return"instance"===o?(l=n,!1):n?t.isFunction(n[o])&&"_"!==o.charAt(0)?(i=n[o].apply(n,r),i!==n&&void 0!==i?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+o+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; "+"attempted to call method '"+o+"'")}):l=void 0:(r.length&&(o=t.widget.extend.apply(null,[o].concat(r))),this.each(function(){var e=t.data(this,s);e?(e.option(o||{}),e._init&&e._init()):t.data(this,s,new i(o,this))})),l}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(e,i){i=t(i||this.defaultElement||this)[0],this.element=t(i),this.uuid=s++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),this.classesElementLookup={},i!==this&&(t.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===i&&this.destroy()}}),this.document=t(i.style?i.ownerDocument:i.document||i),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){var e=this;this._destroy(),t.each(this.classesElementLookup,function(t,i){e._removeClass(i,t)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var s,n,o,a=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(a={},s=e.split("."),e=s.shift(),s.length){for(n=a[e]=t.widget.extend({},this.options[e]),o=0;s.length-1>o;o++)n[s[o]]=n[s[o]]||{},n=n[s[o]];if(e=s.pop(),1===arguments.length)return void 0===n[e]?null:n[e];n[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];a[e]=i}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return"classes"===t&&this._setOptionClasses(e),this.options[t]=e,"disabled"===t&&this._setOptionDisabled(e),this},_setOptionClasses:function(e){var i,s,n;for(i in e)n=this.classesElementLookup[i],e[i]!==this.options.classes[i]&&n&&n.length&&(s=t(n.get()),this._removeClass(n,i),s.addClass(this._classes({element:s,keys:i,classes:e,add:!0})))},_setOptionDisabled:function(t){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!t),t&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(e){function i(i,o){var a,r;for(r=0;i.length>r;r++)a=n.classesElementLookup[i[r]]||t(),a=e.add?t(t.unique(a.get().concat(e.element.get()))):t(a.not(e.element).get()),n.classesElementLookup[i[r]]=a,s.push(i[r]),o&&e.classes[i[r]]&&s.push(e.classes[i[r]])}var s=[],n=this;return e=t.extend({element:this.element,classes:this.options.classes||{}},e),this._on(e.element,{remove:"_untrackClassesElement"}),e.keys&&i(e.keys.match(/\S+/g)||[],!0),e.extra&&i(e.extra.match(/\S+/g)||[]),s.join(" ")},_untrackClassesElement:function(e){var i=this;t.each(i.classesElementLookup,function(s,n){-1!==t.inArray(e.target,n)&&(i.classesElementLookup[s]=t(n.not(e.target).get()))})},_removeClass:function(t,e,i){return this._toggleClass(t,e,i,!1)},_addClass:function(t,e,i){return this._toggleClass(t,e,i,!0)},_toggleClass:function(t,e,i,s){s="boolean"==typeof s?s:i;var n="string"==typeof t||null===t,o={extra:n?e:i,keys:n?t:e,element:n?this.element:t,add:s};return o.element.toggleClass(this._classes(o),s),this},_on:function(e,i,s){var n,o=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=n=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),t.each(s,function(s,a){function r(){return e||o.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof a?o[a]:a).apply(o,arguments):void 0}"string"!=typeof a&&(r.guid=a.guid=a.guid||r.guid||t.guid++);var l=s.match(/^([\w:-]*)\s*(.*)$/),h=l[1]+o.eventNamespace,c=l[2];c?n.on(h,c,r):i.on(h,r)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.off(i).off(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){this._addClass(t(e.currentTarget),null,"ui-state-hover")},mouseleave:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){this._addClass(t(e.currentTarget),null,"ui-state-focus")},focusout:function(e){this._removeClass(t(e.currentTarget),null,"ui-state-focus")}})},_trigger:function(e,i,s){var n,o,a=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(t.isFunction(a)&&a.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){"string"==typeof n&&(n={effect:n});var a,r=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),a=!t.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),a&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}}),t.widget,function(){function e(t,e,i){return[parseFloat(t[0])*(u.test(t[0])?e/100:1),parseFloat(t[1])*(u.test(t[1])?i/100:1)]}function i(e,i){return parseInt(t.css(e,i),10)||0}function s(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}var n,o=Math.max,a=Math.abs,r=/left|center|right/,l=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,u=/%$/,d=t.fn.position;t.position={scrollbarWidth:function(){if(void 0!==n)return n;var e,i,s=t("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return t("body").append(s),e=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,e===i&&(i=s[0].clientWidth),s.remove(),n=e-i},getScrollInfo:function(e){var i=e.isWindow||e.isDocument?"":e.element.css("overflow-x"),s=e.isWindow||e.isDocument?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,o="scroll"===s||"auto"===s&&e.height<e.element[0].scrollHeight;return{width:o?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),s=t.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType,o=!s&&!n;return{element:i,isWindow:s,isDocument:n,offset:o?t(e).offset():{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},t.fn.position=function(n){if(!n||!n.of)return d.apply(this,arguments);n=t.extend({},n);var u,p,f,g,m,_,v=t(n.of),b=t.position.getWithinInfo(n.within),y=t.position.getScrollInfo(b),w=(n.collision||"flip").split(" "),k={};return _=s(v),v[0].preventDefault&&(n.at="left top"),p=_.width,f=_.height,g=_.offset,m=t.extend({},g),t.each(["my","at"],function(){var t,e,i=(n[this]||"").split(" ");1===i.length&&(i=r.test(i[0])?i.concat(["center"]):l.test(i[0])?["center"].concat(i):["center","center"]),i[0]=r.test(i[0])?i[0]:"center",i[1]=l.test(i[1])?i[1]:"center",t=h.exec(i[0]),e=h.exec(i[1]),k[this]=[t?t[0]:0,e?e[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===n.at[0]?m.left+=p:"center"===n.at[0]&&(m.left+=p/2),"bottom"===n.at[1]?m.top+=f:"center"===n.at[1]&&(m.top+=f/2),u=e(k.at,p,f),m.left+=u[0],m.top+=u[1],this.each(function(){var s,r,l=t(this),h=l.outerWidth(),c=l.outerHeight(),d=i(this,"marginLeft"),_=i(this,"marginTop"),x=h+d+i(this,"marginRight")+y.width,C=c+_+i(this,"marginBottom")+y.height,D=t.extend({},m),T=e(k.my,l.outerWidth(),l.outerHeight());"right"===n.my[0]?D.left-=h:"center"===n.my[0]&&(D.left-=h/2),"bottom"===n.my[1]?D.top-=c:"center"===n.my[1]&&(D.top-=c/2),D.left+=T[0],D.top+=T[1],s={marginLeft:d,marginTop:_},t.each(["left","top"],function(e,i){t.ui.position[w[e]]&&t.ui.position[w[e]][i](D,{targetWidth:p,targetHeight:f,elemWidth:h,elemHeight:c,collisionPosition:s,collisionWidth:x,collisionHeight:C,offset:[u[0]+T[0],u[1]+T[1]],my:n.my,at:n.at,within:b,elem:l})}),n.using&&(r=function(t){var e=g.left-D.left,i=e+p-h,s=g.top-D.top,r=s+f-c,u={target:{element:v,left:g.left,top:g.top,width:p,height:f},element:{element:l,left:D.left,top:D.top,width:h,height:c},horizontal:0>i?"left":e>0?"right":"center",vertical:0>r?"top":s>0?"bottom":"middle"};h>p&&p>a(e+i)&&(u.horizontal="center"),c>f&&f>a(s+r)&&(u.vertical="middle"),u.important=o(a(e),a(i))>o(a(s),a(r))?"horizontal":"vertical",n.using.call(this,t,u)}),l.offset(t.extend(D,{using:r}))})},t.ui.position={fit:{left:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=t.left-e.collisionPosition.marginLeft,l=n-r,h=r+e.collisionWidth-a-n;e.collisionWidth>a?l>0&&0>=h?(i=t.left+l+e.collisionWidth-a-n,t.left+=l-i):t.left=h>0&&0>=l?n:l>h?n+a-e.collisionWidth:n:l>0?t.left+=l:h>0?t.left-=h:t.left=o(t.left-r,t.left)},top:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollTop:s.offset.top,a=e.within.height,r=t.top-e.collisionPosition.marginTop,l=n-r,h=r+e.collisionHeight-a-n;e.collisionHeight>a?l>0&&0>=h?(i=t.top+l+e.collisionHeight-a-n,t.top+=l-i):t.top=h>0&&0>=l?n:l>h?n+a-e.collisionHeight:n:l>0?t.top+=l:h>0?t.top-=h:t.top=o(t.top-r,t.top)}},flip:{left:function(t,e){var i,s,n=e.within,o=n.offset.left+n.scrollLeft,r=n.width,l=n.isWindow?n.scrollLeft:n.offset.left,h=t.left-e.collisionPosition.marginLeft,c=h-l,u=h+e.collisionWidth-r-l,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>c?(i=t.left+d+p+f+e.collisionWidth-r-o,(0>i||a(c)>i)&&(t.left+=d+p+f)):u>0&&(s=t.left-e.collisionPosition.marginLeft+d+p+f-l,(s>0||u>a(s))&&(t.left+=d+p+f))},top:function(t,e){var i,s,n=e.within,o=n.offset.top+n.scrollTop,r=n.height,l=n.isWindow?n.scrollTop:n.offset.top,h=t.top-e.collisionPosition.marginTop,c=h-l,u=h+e.collisionHeight-r-l,d="top"===e.my[1],p=d?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>c?(s=t.top+p+f+g+e.collisionHeight-r-o,(0>s||a(c)>s)&&(t.top+=p+f+g)):u>0&&(i=t.top-e.collisionPosition.marginTop+p+f+g-l,(i>0||u>a(i))&&(t.top+=p+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}}}(),t.ui.position,t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])}}),t.fn.extend({disableSelection:function(){var t="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(t+".ui-disableSelection",function(t){t.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}}),t.ui.focusable=function(i,s){var n,o,a,r,l,h=i.nodeName.toLowerCase();return"area"===h?(n=i.parentNode,o=n.name,i.href&&o&&"map"===n.nodeName.toLowerCase()?(a=t("img[usemap='#"+o+"']"),a.length>0&&a.is(":visible")):!1):(/^(input|select|textarea|button|object)$/.test(h)?(r=!i.disabled,r&&(l=t(i).closest("fieldset")[0],l&&(r=!l.disabled))):r="a"===h?i.href||s:s,r&&t(i).is(":visible")&&e(t(i)))},t.extend(t.expr[":"],{focusable:function(e){return t.ui.focusable(e,null!=t.attr(e,"tabindex"))}}),t.ui.focusable,t.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):t(this[0].form)},t.ui.formResetMixin={_formResetHandler:function(){var e=t(this);setTimeout(function(){var i=e.data("ui-form-reset-instances");t.each(i,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var t=this.form.data("ui-form-reset-instances")||[];t.length||this.form.on("reset.ui-form-reset",this._formResetHandler),t.push(this),this.form.data("ui-form-reset-instances",t)}},_unbindFormResetHandler:function(){if(this.form.length){var e=this.form.data("ui-form-reset-instances");e.splice(t.inArray(this,e),1),e.length?this.form.data("ui-form-reset-instances",e):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}},"1.7"===t.fn.jquery.substring(0,3)&&(t.each(["Width","Height"],function(e,i){function s(e,i,s,o){return t.each(n,function(){i-=parseFloat(t.css(e,"padding"+this))||0,s&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),o&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],o=i.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(e){return void 0===e?a["inner"+i].call(this):this.each(function(){t(this).css(o,s(this,e)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?a["outer"+i].call(this,e):this.each(function(){t(this).css(o,s(this,e,!0,n)+"px")})}}),t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},t.ui.escapeSelector=function(){var t=/([!"#$%&'()*+,./:;<=>?@[\]^`{|}~])/g;return function(e){return e.replace(t,"\\$1")}}(),t.fn.labels=function(){var e,i,s,n,o;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(n=this.eq(0).parents("label"),s=this.attr("id"),s&&(e=this.eq(0).parents().last(),o=e.add(e.length?e.siblings():this.siblings()),i="label[for='"+t.ui.escapeSelector(s)+"']",n=n.add(o.find(i).addBack(i))),this.pushStack(n))},t.fn.scrollParent=function(e){var i=this.css("position"),s="absolute"===i,n=e?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var e=t(this);return s&&"static"===e.css("position")?!1:n.test(e.css("overflow")+e.css("overflow-y")+e.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:t(this[0].ownerDocument||document)},t.extend(t.expr[":"],{tabbable:function(e){var i=t.attr(e,"tabindex"),s=null!=i;return(!s||i>=0)&&t.ui.focusable(e,s)}}),t.fn.extend({uniqueId:function(){var t=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++t)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&t(this).removeAttr("id")})}}),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var o=!1;t(document).on("mouseup",function(){o=!1}),t.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.on("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).on("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(e){if(!o){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(e),this._mouseDownEvent=e;var i=this,s=1===e.which,n="string"==typeof this.options.cancel&&e.target.nodeName?t(e.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(e)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(e)!==!1,!this._mouseStarted)?(e.preventDefault(),!0):(!0===t.data(e.target,this.widgetName+".preventClickEvent")&&t.removeData(e.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return i._mouseMove(t)},this._mouseUpDelegate=function(t){return i._mouseUp(t)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),e.preventDefault(),o=!0,!0)):!0}},_mouseMove:function(e){if(this._mouseMoved){if(t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button)return this._mouseUp(e);if(!e.which)if(e.originalEvent.altKey||e.originalEvent.ctrlKey||e.originalEvent.metaKey||e.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(e)}return(e.which||e.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,o=!1,e.preventDefault()},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),t.ui.plugin={add:function(e,i,s){var n,o=t.ui[e].prototype;for(n in s)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,s[n]])},call:function(t,e,i,s){var n,o=t.plugins[e];if(o&&(s||t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType))for(n=0;o.length>n;n++)t.options[o[n][0]]&&o[n][1].apply(t.element,i)}},t.ui.safeActiveElement=function(t){var e;try{e=t.activeElement}catch(i){e=t.body}return e||(e=t.body),e.nodeName||(e=t.body),e},t.ui.safeBlur=function(e){e&&"body"!==e.nodeName.toLowerCase()&&t(e).trigger("blur")},t.widget("ui.draggable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(t,e){this._super(t,e),"handle"===t&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?(this.destroyOnClear=!0,void 0):(this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(e){var i=this.options;return this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(this._blurActiveElement(e),this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0):!1)},_blockFrames:function(e){this.iframeBlocks=this.document.find(e).map(function(){var e=t(this);return t("<div>").css("position","absolute").appendTo(e.parent()).outerWidth(e.outerWidth()).outerHeight(e.outerHeight()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(e){var i=t.ui.safeActiveElement(this.document[0]),s=t(e.target);s.closest(i).length||t.ui.safeBlur(i)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===t(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(e),this.originalPosition=this.position=this._generatePosition(e,!1),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_refreshOffsets:function(t){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:t.pageX-this.offset.left,top:t.pageY-this.offset.top}},_mouseDrag:function(e,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",e,s)===!1)return this._mouseUp(new t.Event("mouseup",e)),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1},_mouseUp:function(e){return this._unblockFrames(),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),this.handleElement.is(e.target)&&this.element.trigger("focus"),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new t.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper),n=s?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_isRootNode:function(t){return/(html|body)/i.test(t.tagName)||t===this.document[0]},_getParentOffset:function(){var e=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var t=this.element.position(),e=this._isRootNode(this.scrollParent[0]);return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+(e?0:this.scrollParent.scrollTop()),left:t.left-(parseInt(this.helper.css("left"),10)||0)+(e?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options,o=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===n.containment?(this.containment=[0,0,t(o).width()-this.helperProportions.width-this.margins.left,(t(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=t(n.containment),s=i[0],s&&(e=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(t,e){e||(e=this.position);var i="absolute"===t?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:e.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:e.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(t,e){var i,s,n,o,a=this.options,r=this._isRootNode(this.scrollParent[0]),l=t.pageX,h=t.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),e&&(this.containment&&(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(h=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(h=i[3]+this.offset.click.top)),a.grid&&(n=a.grid[1]?this.originalPageY+Math.round((h-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,h=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-a.grid[1]:n+a.grid[1]:n,o=a.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,l=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-a.grid[0]:o+a.grid[0]:o),"y"===a.axis&&(l=this.originalPageX),"x"===a.axis&&(h=this.originalPageY)),{top:h-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s,this],!0),/^(drag|start|stop)/.test(e)&&(this.positionAbs=this._convertPositionTo("absolute"),s.offset=this.positionAbs),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i,s){var n=t.extend({},i,{item:s.element});s.sortables=[],t(s.options.connectToSortable).each(function(){var i=t(this).sortable("instance");i&&!i.options.disabled&&(s.sortables.push(i),i.refreshPositions(),i._trigger("activate",e,n))})},stop:function(e,i,s){var n=t.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,t.each(s.sortables,function(){var t=this;t.isOver?(t.isOver=0,s.cancelHelperRemoval=!0,t.cancelHelperRemoval=!1,t._storedCSS={position:t.placeholder.css("position"),top:t.placeholder.css("top"),left:t.placeholder.css("left")},t._mouseStop(e),t.options.helper=t.options._helper):(t.cancelHelperRemoval=!0,t._trigger("deactivate",e,n))})},drag:function(e,i,s){t.each(s.sortables,function(){var n=!1,o=this;o.positionAbs=s.positionAbs,o.helperProportions=s.helperProportions,o.offset.click=s.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,t.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&t.contains(o.element[0],this.element[0])&&(n=!1),n})),n?(o.isOver||(o.isOver=1,s._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},e.target=o.currentItem[0],o._mouseCapture(e,!0),o._mouseStart(e,!0,!0),o.offset.click.top=s.offset.click.top,o.offset.click.left=s.offset.click.left,o.offset.parent.left-=s.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=s.offset.parent.top-o.offset.parent.top,s._trigger("toSortable",e),s.dropped=o.element,t.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,o.fromOutside=s),o.currentItem&&(o._mouseDrag(e),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",e,o._uiHash(o)),o._mouseStop(e,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(e),i.position=s._generatePosition(e,!0),s._trigger("fromSortable",e),s.dropped=!1,t.each(s.sortables,function(){this.refreshPositions()}))})}}),t.ui.plugin.add("draggable","cursor",{start:function(e,i,s){var n=t("body"),o=s.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function(e,i,s){var n=s.options;n._cursor&&t("body").css("cursor",n._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function(e,i,s){var n=s.options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(t,e,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(e,i,s){var n=s.options,o=!1,a=s.scrollParentNotHidden[0],r=s.document[0];a!==r&&"HTML"!==a.tagName?(n.axis&&"x"===n.axis||(s.overflowOffset.top+a.offsetHeight-e.pageY<n.scrollSensitivity?a.scrollTop=o=a.scrollTop+n.scrollSpeed:e.pageY-s.overflowOffset.top<n.scrollSensitivity&&(a.scrollTop=o=a.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(s.overflowOffset.left+a.offsetWidth-e.pageX<n.scrollSensitivity?a.scrollLeft=o=a.scrollLeft+n.scrollSpeed:e.pageX-s.overflowOffset.left<n.scrollSensitivity&&(a.scrollLeft=o=a.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-t(r).scrollTop()<n.scrollSensitivity?o=t(r).scrollTop(t(r).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(r).scrollTop())<n.scrollSensitivity&&(o=t(r).scrollTop(t(r).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-t(r).scrollLeft()<n.scrollSensitivity?o=t(r).scrollLeft(t(r).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(r).scrollLeft())<n.scrollSensitivity&&(o=t(r).scrollLeft(t(r).scrollLeft()+n.scrollSpeed)))),o!==!1&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(s,e)}}),t.ui.plugin.add("draggable","snap",{start:function(e,i,s){var n=s.options;s.snapElements=[],t(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var e=t(this),i=e.offset();this!==s.element[0]&&s.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(e,i,s){var n,o,a,r,l,h,c,u,d,p,f=s.options,g=f.snapTolerance,m=i.offset.left,_=m+s.helperProportions.width,v=i.offset.top,b=v+s.helperProportions.height;for(d=s.snapElements.length-1;d>=0;d--)l=s.snapElements[d].left-s.margins.left,h=l+s.snapElements[d].width,c=s.snapElements[d].top-s.margins.top,u=c+s.snapElements[d].height,l-g>_||m>h+g||c-g>b||v>u+g||!t.contains(s.snapElements[d].item.ownerDocument,s.snapElements[d].item)?(s.snapElements[d].snapping&&s.options.snap.release&&s.options.snap.release.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(n=g>=Math.abs(c-b),o=g>=Math.abs(u-v),a=g>=Math.abs(l-_),r=g>=Math.abs(h-m),n&&(i.position.top=s._convertPositionTo("relative",{top:c-s.helperProportions.height,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l-s.helperProportions.width}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h}).left)),p=n||o||a||r,"outer"!==f.snapMode&&(n=g>=Math.abs(c-v),o=g>=Math.abs(u-b),a=g>=Math.abs(l-m),r=g>=Math.abs(h-_),n&&(i.position.top=s._convertPositionTo("relative",{top:c,left:0}).top),o&&(i.position.top=s._convertPositionTo("relative",{top:u-s.helperProportions.height,left:0}).top),a&&(i.position.left=s._convertPositionTo("relative",{top:0,left:l}).left),r&&(i.position.left=s._convertPositionTo("relative",{top:0,left:h-s.helperProportions.width}).left)),!s.snapElements[d].snapping&&(n||o||a||r||p)&&s.options.snap.snap&&s.options.snap.snap.call(s.element,e,t.extend(s._uiHash(),{snapItem:s.snapElements[d].item})),s.snapElements[d].snapping=n||o||a||r||p)}}),t.ui.plugin.add("draggable","stack",{start:function(e,i,s){var n,o=s.options,a=t.makeArray(t(o.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});a.length&&(n=parseInt(t(a[0]).css("zIndex"),10)||0,t(a).each(function(e){t(this).css("zIndex",n+e)}),this.css("zIndex",n+a.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i,s){var n=t(i.helper),o=s.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function(e,i,s){var n=s.options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}}),t.ui.draggable,t.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(s)?s:function(t){return t.is(s)},this.proportions=function(){return arguments.length?(e=arguments[0],void 0):e?e:e={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&&this._addClass("ui-droppable")},_addToManager:function(e){t.ui.ddmanager.droppables[e]=t.ui.ddmanager.droppables[e]||[],t.ui.ddmanager.droppables[e].push(this)},_splice:function(t){for(var e=0;t.length>e;e++)t[e]===this&&t.splice(e,1)},_destroy:function(){var e=t.ui.ddmanager.droppables[this.options.scope];this._splice(e)},_setOption:function(e,i){if("accept"===e)this.accept=t.isFunction(i)?i:function(t){return t.is(i)};else if("scope"===e){var s=t.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(e,i)},_activate:function(e){var i=t.ui.ddmanager.current;this._addActiveClass(),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this._removeActiveClass(),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._addHoverClass(),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeHoverClass(),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var s=i||t.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=t(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===s.options.scope&&i.accept.call(i.element[0],s.currentItem||s.element)&&a(s,t.extend(i,{offset:i.element.offset()}),i.options.tolerance,e)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",e,this.ui(s)),this.element):!1):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});var a=t.ui.intersect=function(){function t(t,e,i){return t>=e&&e+i>t}return function(e,i,s,n){if(!i.offset)return!1;var o=(e.positionAbs||e.position.absolute).left+e.margins.left,a=(e.positionAbs||e.position.absolute).top+e.margins.top,r=o+e.helperProportions.width,l=a+e.helperProportions.height,h=i.offset.left,c=i.offset.top,u=h+i.proportions().width,d=c+i.proportions().height;switch(s){case"fit":return o>=h&&u>=r&&a>=c&&d>=l;case"intersect":return o+e.helperProportions.width/2>h&&u>r-e.helperProportions.width/2&&a+e.helperProportions.height/2>c&&d>l-e.helperProportions.height/2;case"pointer":return t(n.pageY,c,i.proportions().height)&&t(n.pageX,h,i.proportions().width);case"touch":return(a>=c&&d>=a||l>=c&&d>=l||c>a&&l>d)&&(o>=h&&u>=o||r>=h&&u>=r||h>o&&r>u);default:return!1}}}();t.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(e,i){var s,n,o=t.ui.ddmanager.droppables[e.options.scope]||[],a=i?i.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(s=0;o.length>s;s++)if(!(o[s].options.disabled||e&&!o[s].accept.call(o[s].element[0],e.currentItem||e.element))){for(n=0;r.length>n;n++)if(r[n]===o[s].element[0]){o[s].proportions().height=0;continue t}o[s].visible="none"!==o[s].element.css("display"),o[s].visible&&("mousedown"===a&&o[s]._activate.call(o[s],i),o[s].offset=o[s].element.offset(),o[s].proportions({width:o[s].element[0].offsetWidth,height:o[s].element[0].offsetHeight}))}},drop:function(e,i){var s=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&a(e,this,this.options.tolerance,i)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(e,i){e.element.parentsUntil("body").on("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,o,r=a(e,this,this.options.tolerance,i),l=!r&&this.isover?"isout":r&&!this.isover?"isover":null;l&&(this.options.greedy&&(n=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return t(this).droppable("instance").options.scope===n}),o.length&&(s=t(o[0]).droppable("instance"),s.greedyChild="isover"===l)),s&&"isover"===l&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[l]=!0,this["isout"===l?"isover":"isout"]=!1,this["isover"===l?"_over":"_out"].call(this,i),s&&"isout"===l&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").off("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}},t.uiBackCompat!==!1&&t.widget("ui.droppable",t.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),t.ui.droppable,t.widget("ui.resizable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(t){return parseFloat(t)||0},_isNumber:function(t){return!isNaN(parseFloat(t))},_hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return e[s]>0?!0:(e[s]=1,n=e[s]>0,e[s]=0,n)},_create:function(){var e,i=this.options,s=this;this._addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,e={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(e),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(e),this._proportionallyResize()),this._setupHandles(),i.autoHide&&t(this.element).on("mouseenter",function(){i.disabled||(s._removeClass("ui-resizable-autohide"),s._handles.show())}).on("mouseleave",function(){i.disabled||s.resizing||(s._addClass("ui-resizable-autohide"),s._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(t,e){switch(this._super(t,e),t){case"handles":this._removeHandles(),this._setupHandles();break;default:}},_setupHandles:function(){var e,i,s,n,o,a=this.options,r=this;if(this.handles=a.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=t(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),s=this.handles.split(","),this.handles={},i=0;s.length>i;i++)e=t.trim(s[i]),n="ui-resizable-"+e,o=t("<div>"),this._addClass(o,"ui-resizable-handle "+n),o.css({zIndex:a.zIndex}),this.handles[e]=".ui-resizable-"+e,this.element.append(o);this._renderAxis=function(e){var i,s,n,o;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=t(this.handles[i]),this._on(this.handles[i],{mousedown:r._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(s=t(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,o),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){r.resizing||(this.className&&(o=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),r.axis=o&&o[1]?o[1]:"se")}),a.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(e){var i,s,n=!1;for(i in this.handles)s=t(this.handles[i])[0],(s===e.target||t.contains(s,e.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(e){var i,s,n,o=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),s=this._num(this.helper.css("top")),o.containment&&(i+=t(o.containment).scrollLeft()||0,s+=t(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:e.pageX,top:e.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===n?this.axis+"-resize":n),this._addClass("ui-resizable-resizing"),this._propagate("start",e),!0},_mouseDrag:function(e){var i,s,n=this.originalMousePosition,o=this.axis,a=e.pageX-n.left||0,r=e.pageY-n.top||0,l=this._change[o];return this._updatePrevProperties(),l?(i=l.apply(this,[e,a,r]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),s=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger("resize",e,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(e){this.resizing=!1;var i,s,n,o,a,r,l,h=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&this._hasScroll(i[0],"left")?0:c.sizeDiff.height,o=s?0:c.sizeDiff.width,a={width:c.helper.width()-o,height:c.helper.height()-n},r=parseFloat(c.element.css("left"))+(c.position.left-c.originalPosition.left)||null,l=parseFloat(c.element.css("top"))+(c.position.top-c.originalPosition.top)||null,h.animate||this.element.css(t.extend(a,{top:l,left:r})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!h.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var t={};return this.position.top!==this.prevPosition.top&&(t.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(t.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(t.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(t.height=this.size.height+"px"),this.helper.css(t),t},_updateVirtualBoundaries:function(t){var e,i,s,n,o,a=this.options;o={minWidth:this._isNumber(a.minWidth)?a.minWidth:0,maxWidth:this._isNumber(a.maxWidth)?a.maxWidth:1/0,minHeight:this._isNumber(a.minHeight)?a.minHeight:0,maxHeight:this._isNumber(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||t)&&(e=o.minHeight*this.aspectRatio,s=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,e>o.minWidth&&(o.minWidth=e),s>o.minHeight&&(o.minHeight=s),o.maxWidth>i&&(o.maxWidth=i),o.maxHeight>n&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function(t){this.offset=this.helper.offset(),this._isNumber(t.left)&&(this.position.left=t.left),this._isNumber(t.top)&&(this.position.top=t.top),this._isNumber(t.height)&&(this.size.height=t.height),this._isNumber(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,i=this.size,s=this.axis;return this._isNumber(t.height)?t.width=t.height*this.aspectRatio:this._isNumber(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===s&&(t.left=e.left+(i.width-t.width),t.top=null),"nw"===s&&(t.top=e.top+(i.height-t.height),t.left=e.left+(i.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,i=this.axis,s=this._isNumber(t.width)&&e.maxWidth&&e.maxWidth<t.width,n=this._isNumber(t.height)&&e.maxHeight&&e.maxHeight<t.height,o=this._isNumber(t.width)&&e.minWidth&&e.minWidth>t.width,a=this._isNumber(t.height)&&e.minHeight&&e.minHeight>t.height,r=this.originalPosition.left+this.originalSize.width,l=this.originalPosition.top+this.originalSize.height,h=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return o&&(t.width=e.minWidth),a&&(t.height=e.minHeight),s&&(t.width=e.maxWidth),n&&(t.height=e.maxHeight),o&&h&&(t.left=r-e.minWidth),s&&h&&(t.left=r-e.maxWidth),a&&c&&(t.top=l-e.minHeight),n&&c&&(t.top=l-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_getPaddingPlusBorderDimensions:function(t){for(var e=0,i=[],s=[t.css("borderTopWidth"),t.css("borderRightWidth"),t.css("borderBottomWidth"),t.css("borderLeftWidth")],n=[t.css("paddingTop"),t.css("paddingRight"),t.css("paddingBottom"),t.css("paddingLeft")];4>e;e++)i[e]=parseFloat(s[e])||0,i[e]+=parseFloat(n[e])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var t,e=0,i=this.helper||this.element;this._proportionallyResizeElements.length>e;e++)t=this._proportionallyResizeElements[e],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(t)),t.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize,s=this.originalPosition;return{left:s.left+e,width:i.width-e}},n:function(t,e,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).resizable("instance"),s=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),a=o&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,r=o?0:i.sizeDiff.width,l={width:i.size.width-r,height:i.size.height-a},h=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,c=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(l,c&&h?{top:c,left:h}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};n&&n.length&&t(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var e,i,s,n,o,a,r,l=t(this).resizable("instance"),h=l.options,c=l.element,u=h.containment,d=u instanceof t?u.get(0):/parent/.test(u)?c.parent().get(0):u;d&&(l.containerElement=t(d),/document/.test(u)||u===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(e=t(d),i=[],t(["Top","Right","Left","Bottom"]).each(function(t,s){i[t]=l._num(e.css("padding"+s))}),l.containerOffset=e.offset(),l.containerPosition=e.position(),l.containerSize={height:e.innerHeight()-i[3],width:e.innerWidth()-i[1]},s=l.containerOffset,n=l.containerSize.height,o=l.containerSize.width,a=l._hasScroll(d,"left")?d.scrollWidth:o,r=l._hasScroll(d)?d.scrollHeight:n,l.parentData={element:d,left:s.left,top:s.top,width:a,height:r}))},resize:function(e){var i,s,n,o,a=t(this).resizable("instance"),r=a.options,l=a.containerOffset,h=a.position,c=a._aspectRatio||e.shiftKey,u={top:0,left:0},d=a.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(u=l),h.left<(a._helper?l.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-l.left:a.position.left-u.left),c&&(a.size.height=a.size.width/a.aspectRatio,p=!1),a.position.left=r.helper?l.left:0),h.top<(a._helper?l.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-l.top:a.position.top),c&&(a.size.width=a.size.height*a.aspectRatio,p=!1),a.position.top=a._helper?l.top:0),n=a.containerElement.get(0)===a.element.parent().get(0),o=/relative|absolute/.test(a.containerElement.css("position")),n&&o?(a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top):(a.offset.left=a.element.offset().left,a.offset.top=a.element.offset().top),i=Math.abs(a.sizeDiff.width+(a._helper?a.offset.left-u.left:a.offset.left-l.left)),s=Math.abs(a.sizeDiff.height+(a._helper?a.offset.top-u.top:a.offset.top-l.top)),i+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-i,c&&(a.size.height=a.size.width/a.aspectRatio,p=!1)),s+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-s,c&&(a.size.width=a.size.height*a.aspectRatio,p=!1)),p||(a.position.left=a.prevPosition.left,a.position.top=a.prevPosition.top,a.size.width=a.prevSize.width,a.size.height=a.prevSize.height)},stop:function(){var e=t(this).resizable("instance"),i=e.options,s=e.containerOffset,n=e.containerPosition,o=e.containerElement,a=t(e.helper),r=a.offset(),l=a.outerWidth()-e.sizeDiff.width,h=a.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:l,height:h}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:l,height:h})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).resizable("instance"),i=e.options;t(i.alsoResize).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseFloat(e.width()),height:parseFloat(e.height()),left:parseFloat(e.css("left")),top:parseFloat(e.css("top"))})})},resize:function(e,i){var s=t(this).resizable("instance"),n=s.options,o=s.originalSize,a=s.originalPosition,r={height:s.size.height-o.height||0,width:s.size.width-o.width||0,top:s.position.top-a.top||0,left:s.position.left-a.left||0};t(n.alsoResize).each(function(){var e=t(this),s=t(this).data("ui-resizable-alsoresize"),n={},o=e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(o,function(t,e){var i=(s[e]||0)+(r[e]||0);i&&i>=0&&(n[e]=i||null)}),e.css(n)})},stop:function(){t(this).removeData("ui-resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).resizable("instance"),i=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),e._addClass(e.ghost,"ui-resizable-ghost"),t.uiBackCompat!==!1&&"string"==typeof e.options.ghost&&e.ghost.addClass(this.options.ghost),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).resizable("instance");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).resizable("instance");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e,i=t(this).resizable("instance"),s=i.options,n=i.size,o=i.originalSize,a=i.originalPosition,r=i.axis,l="number"==typeof s.grid?[s.grid,s.grid]:s.grid,h=l[0]||1,c=l[1]||1,u=Math.round((n.width-o.width)/h)*h,d=Math.round((n.height-o.height)/c)*c,p=o.width+u,f=o.height+d,g=s.maxWidth&&p>s.maxWidth,m=s.maxHeight&&f>s.maxHeight,_=s.minWidth&&s.minWidth>p,v=s.minHeight&&s.minHeight>f;s.grid=l,_&&(p+=h),v&&(f+=c),g&&(p-=h),m&&(f-=c),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=a.top-d):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=a.left-u):((0>=f-c||0>=p-h)&&(e=i._getPaddingPlusBorderDimensions(this)),f-c>0?(i.size.height=f,i.position.top=a.top-d):(f=c-e.height,i.size.height=f,i.position.top=a.top+o.height-f),p-h>0?(i.size.width=p,i.position.left=a.left-u):(p=h-e.width,i.size.width=p,i.position.left=a.left+o.width-p))}}),t.ui.resizable,t.widget("ui.selectable",t.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e.elementPos=t(e.element[0]).offset(),e.selectees=t(e.options.filter,e.element[0]),e._addClass(e.selectees,"ui-selectee"),e.selectees.each(function(){var i=t(this),s=i.offset(),n={left:s.left-e.elementPos.left,top:s.top-e.elementPos.top};t.data(this,"selectable-item",{element:this,$element:i,left:n.left,top:n.top,right:n.left+i.outerWidth(),bottom:n.top+i.outerHeight(),startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=t("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(e){var i=this,s=this.options;this.opos=[e.pageX,e.pageY],this.elementPos=t(this.element[0]).offset(),this.options.disabled||(this.selectees=t(s.filter,this.element[0]),this._trigger("start",e),t(s.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=t.data(this,"selectable-item");s.startselected=!0,e.metaKey||e.ctrlKey||(i._removeClass(s.$element,"ui-selected"),s.selected=!1,i._addClass(s.$element,"ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",e,{unselecting:s.element}))}),t(e.target).parents().addBack().each(function(){var s,n=t.data(this,"selectable-item");return n?(s=!e.metaKey&&!e.ctrlKey||!n.$element.hasClass("ui-selected"),i._removeClass(n.$element,s?"ui-unselecting":"ui-selected")._addClass(n.$element,s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",e,{selecting:n.element}):i._trigger("unselecting",e,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,o=this.opos[0],a=this.opos[1],r=e.pageX,l=e.pageY;return o>r&&(i=r,r=o,o=i),a>l&&(i=l,l=a,a=i),this.helper.css({left:o,top:a,width:r-o,height:l-a}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),h=!1,c={};i&&i.element!==s.element[0]&&(c.left=i.left+s.elementPos.left,c.right=i.right+s.elementPos.left,c.top=i.top+s.elementPos.top,c.bottom=i.bottom+s.elementPos.top,"touch"===n.tolerance?h=!(c.left>r||o>c.right||c.top>l||a>c.bottom):"fit"===n.tolerance&&(h=c.left>o&&r>c.right&&c.top>a&&l>c.bottom),h?(i.selected&&(s._removeClass(i.$element,"ui-selected"),i.selected=!1),i.unselecting&&(s._removeClass(i.$element,"ui-unselecting"),i.unselecting=!1),i.selecting||(s._addClass(i.$element,"ui-selecting"),i.selecting=!0,s._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,s._addClass(i.$element,"ui-selected"),i.selected=!0):(s._removeClass(i.$element,"ui-selecting"),i.selecting=!1,i.startselected&&(s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(s._removeClass(i.$element,"ui-selected"),i.selected=!1,s._addClass(i.$element,"ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",e,{unselected:s.element})}),t(".ui-selecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");i._removeClass(s.$element,"ui-selecting")._addClass(s.$element,"ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",e,{selected:s.element})}),this._trigger("stop",e),this.helper.remove(),!1}}),t.widget("ui.sortable",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(t,e,i){return t>=e&&e+i>t},_isFloating:function(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(t,e){this._super(t,e),"handle"===t&&this._setHandleClassName()},_setHandleClassName:function(){var e=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),t.each(this.items,function(){e._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(e,i){var s=null,n=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(s=t(e.target)),s?!this.options.handle||i||(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(e,i,s){var n,o,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-this.document.scrollTop()<a.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-a.scrollSpeed):this.window.height()-(e.pageY-this.document.scrollTop())<a.scrollSensitivity&&(r=this.document.scrollTop(this.document.scrollTop()+a.scrollSpeed)),e.pageX-this.document.scrollLeft()<a.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-a.scrollSpeed):this.window.width()-(e.pageX-this.document.scrollLeft())<a.scrollSensitivity&&(r=this.document.scrollLeft(this.document.scrollLeft()+a.scrollSpeed))),r!==!1&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],o=this._intersectsWithPointer(s),o&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],n):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new t.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,l=r+t.height,h=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||s+h>r&&l>s+h,d="y"===this.options.axis||e+c>o&&a>e+c,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&a>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&l>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var e,i,s="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left,t.width),o=s&&n;return o?(e=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===e?2:1:e&&("down"===e?2:1)):!1},_intersectsWithSides:function(t){var e=this._isOverAxis(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:s&&("down"===s&&e||"up"===s&&!e)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){function i(){r.push(this)}var s,n,o,a,r=[],l=[],h=this._connectWith();if(h&&e)for(s=h.length-1;s>=0;s--)for(o=t(h[s],this.document[0]),n=o.length-1;n>=0;n--)a=t.data(o[n],this.widgetFullName),a&&a!==this&&!a.options.disabled&&l.push([t.isFunction(a.options.items)?a.options.items.call(a.element):t(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a]);for(l.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),s=l.length-1;s>=0;s--)l[s][0].each(i);return t(r)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,n,o,a,r,l,h,c=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(n=t(d[i],this.document[0]),s=n.length-1;s>=0;s--)o=t.data(n[s],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=u.length-1;i>=0;i--)for(a=u[i][1],r=u[i][0],s=0,h=r.length;h>s;s++)l=t(r[s]),l.data(this.widgetName+"-item",a),c.push({item:l,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.floating=this.items.length?"x"===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,o;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,s=e.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]);return e._addClass(n,"ui-sortable-placeholder",i||e.currentItem[0].className)._removeClass(n,"ui-sortable-helper"),"tbody"===s?e._createTrPlaceholder(e.currentItem.find("tr").eq(0),t("<tr>",e.document[0]).appendTo(n)):"tr"===s?e._createTrPlaceholder(e.currentItem,n):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_createTrPlaceholder:function(e,i){var s=this;e.children().each(function(){t("<td>&#160;</td>",s.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(e){var i,s,n,o,a,r,l,h,c,u,d=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!t.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(d&&t.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",e,this._uiHash(this)),this.containers[i].containerCache.over=0);if(d)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,c=d.floating||this._isFloating(this.currentItem),a=c?"left":"top",r=c?"width":"height",u=c?"pageX":"pageY",s=this.items.length-1;s>=0;s--)t.contains(this.containers[p].element[0],this.items[s].item[0])&&this.items[s].item[0]!==this.currentItem[0]&&(l=this.items[s].item.offset()[a],h=!1,e[u]-l>this.items[s][r]/2&&(h=!0),n>Math.abs(e[u]-l)&&(n=Math.abs(e[u]-l),o=this.items[s],this.direction=h?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",e,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;o?this._rearrange(e,o,null,!0):this._rearrange(e,null,this.containers[p].element,!0),this._trigger("change",e,this._uiHash()),this.containers[p]._trigger("change",e,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",e,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function(e){var i,s,n=this.options,o=e.pageX,a=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:r.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){function i(t,e,i){return function(s){i._trigger(t,s,e._uiHash(e))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)("auto"===this._storedCSS[s]||"static"===this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s>=0;s--)e||n.push(i("deactivate",this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(i("out",this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!e){for(s=0;n.length>s;s++)n[s].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.widget("ui.accordion",{version:"1.12.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top","ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:"> li > :first-child, > :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var e=this.options;this.prevShow=this.prevHide=t(),this._addClass("ui-accordion","ui-widget ui-helper-reset"),this.element.attr("role","tablist"),e.collapsible||e.active!==!1&&null!=e.active||(e.active=0),this._processPanels(),0>e.active&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():t()}},_createIcons:function(){var e,i,s=this.options.icons;s&&(e=t("<span>"),this._addClass(e,"ui-accordion-header-icon","ui-icon "+s.header),e.prependTo(this.headers),i=this.active.children(".ui-accordion-header-icon"),this._removeClass(i,s.header)._addClass(i,null,s.activeHeader)._addClass(this.headers,"ui-accordion-icons"))},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons"),this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){var t;this.element.removeAttr("role"),this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId(),this._destroyIcons(),t=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&t.css("height","")},_setOption:function(t,e){return"active"===t?(this._activate(e),void 0):("event"===t&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(e)),this._super(t,e),"collapsible"!==t||e||this.options.active!==!1||this._activate(0),"icons"===t&&(this._destroyIcons(),e&&this._createIcons()),void 0)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t),this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!t)},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var i=t.ui.keyCode,s=this.headers.length,n=this.headers.index(e.target),o=!1;switch(e.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:o=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(e);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[s-1]}o&&(t(e.target).attr("tabIndex",-1),t(o).attr("tabIndex",0),t(o).trigger("focus"),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===t.ui.keyCode.UP&&e.ctrlKey&&t(e.currentTarget).prev().trigger("focus")},refresh:function(){var e=this.options;this._processPanels(),e.active===!1&&e.collapsible===!0||!this.headers.length?(e.active=!1,this.active=t()):e.active===!1?this._activate(0):this.active.length&&!t.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=t()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var t=this.headers,e=this.panels;this.headers=this.element.find(this.options.header),this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default"),this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide(),this._addClass(this.panels,"ui-accordion-content","ui-helper-reset ui-widget-content"),e&&(this._off(t.not(this.headers)),this._off(e.not(this.panels)))},_refresh:function(){var e,i=this.options,s=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active),this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed"),this._addClass(this.active.next(),"ui-accordion-content-active"),this.active.next().show(),this.headers.attr("role","tab").each(function(){var e=t(this),i=e.uniqueId().attr("id"),s=e.next(),n=s.uniqueId().attr("id");e.attr("aria-controls",n),s.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===s?(e=n.height(),this.element.siblings(":visible").each(function(){var i=t(this),s=i.css("position");"absolute"!==s&&"fixed"!==s&&(e-=i.outerHeight(!0))}),this.headers.each(function(){e-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,e-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===s&&(e=0,this.headers.next().each(function(){var i=t(this).is(":visible");i||t(this).show(),e=Math.max(e,t(this).css("height","").height()),i||t(this).hide()}).height(e))},_activate:function(e){var i=this._findActive(e)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):t()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var i,s,n=this.options,o=this.active,a=t(e.currentTarget),r=a[0]===o[0],l=r&&n.collapsible,h=l?t():a.next(),c=o.next(),u={oldHeader:o,oldPanel:c,newHeader:l?t():a,newPanel:h};e.preventDefault(),r&&!n.collapsible||this._trigger("beforeActivate",e,u)===!1||(n.active=l?!1:this.headers.index(a),this.active=r?t():a,this._toggle(u),this._removeClass(o,"ui-accordion-header-active","ui-state-active"),n.icons&&(i=o.children(".ui-accordion-header-icon"),this._removeClass(i,null,n.icons.activeHeader)._addClass(i,null,n.icons.header)),r||(this._removeClass(a,"ui-accordion-header-collapsed")._addClass(a,"ui-accordion-header-active","ui-state-active"),n.icons&&(s=a.children(".ui-accordion-header-icon"),this._removeClass(s,null,n.icons.header)._addClass(s,null,n.icons.activeHeader)),this._addClass(a.next(),"ui-accordion-content-active")))},_toggle:function(e){var i=e.newPanel,s=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,e):(s.hide(),i.show(),this._toggleComplete(e)),s.attr({"aria-hidden":"true"}),s.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&s.length?s.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(t(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(t,e,i){var s,n,o,a=this,r=0,l=t.css("box-sizing"),h=t.length&&(!e.length||t.index()<e.index()),c=this.options.animate||{},u=h&&c.down||c,d=function(){a._toggleComplete(i)};return"number"==typeof u&&(o=u),"string"==typeof u&&(n=u),n=n||u.easing||c.easing,o=o||u.duration||c.duration,e.length?t.length?(s=t.show().outerHeight(),e.animate(this.hideProps,{duration:o,easing:n,step:function(t,e){e.now=Math.round(t)}}),t.hide().animate(this.showProps,{duration:o,easing:n,complete:d,step:function(t,i){i.now=Math.round(t),"height"!==i.prop?"content-box"===l&&(r+=i.now):"content"!==a.options.heightStyle&&(i.now=Math.round(s-e.outerHeight()-r),r=0)}}),void 0):e.animate(this.hideProps,o,n,d):t.animate(this.showProps,o,n,d)},_toggleComplete:function(t){var e=t.oldPanel,i=e.prev();this._removeClass(e,"ui-accordion-content-active"),this._removeClass(i,"ui-accordion-header-active")._addClass(i,"ui-accordion-header-collapsed"),e.length&&(e.parent()[0].className=e.parent()[0].className),this._trigger("activate",null,t)}}),t.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(t){t.preventDefault()},"click .ui-menu-item":function(e){var i=t(e.target),s=t(t.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(e),e.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(e):!this.element.is(":focus")&&s.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){if(!this.previousFilter){var i=t(e.target).closest(".ui-menu-item"),s=t(e.currentTarget);i[0]===s[0]&&(this._removeClass(s.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(e,s))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.find(this.options.items).eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){var i=!t.contains(this.element[0],t.ui.safeActiveElement(this.document[0]));i&&this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){this._closeOnDocumentClick(t)&&this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){var e=this.element.find(".ui-menu-item").removeAttr("role aria-disabled"),i=e.children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),i.children().each(function(){var e=t(this);e.data("ui-menu-submenu-caret")&&e.remove()})},_keydown:function(e){var i,s,n,o,a=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:a=!1,s=this.previousFilter||"",o=!1,n=e.keyCode>=96&&105>=e.keyCode?""+(e.keyCode-96):String.fromCharCode(e.keyCode),clearTimeout(this.filterTimer),n===s?o=!0:n=s+n,i=this._filterMenuItems(n),i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(n=String.fromCharCode(e.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(e,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}a&&e.preventDefault()},_activate:function(t){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(t):this.select(t))},refresh:function(){var e,i,s,n,o,a=this,r=this.options.icons.submenu,l=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),s=l.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),i=e.prev(),s=t("<span>").data("ui-menu-submenu-caret",!0);a._addClass(s,"ui-menu-icon","ui-icon "+r),i.attr("aria-haspopup","true").prepend(s),e.attr("aria-labelledby",i.attr("id"))}),this._addClass(s,"ui-menu","ui-widget ui-widget-content ui-front"),e=l.add(this.element),i=e.find(this.options.items),i.not(".ui-menu-item").each(function(){var e=t(this);a._isDivider(e)&&a._addClass(e,"ui-menu-divider","ui-widget-content")}),n=i.not(".ui-menu-item, .ui-menu-divider"),o=n.children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(n,"ui-menu-item")._addClass(o,"ui-menu-item-wrapper"),i.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){if("icons"===t){var i=this.element.find(".ui-menu-icon");this._removeClass(i,null,this.options.icons.submenu)._addClass(i,null,e.submenu)}this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t+""),this._toggleClass(null,"ui-state-disabled",!!t)},focus:function(t,e){var i,s,n;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),s=this.active.children(".ui-menu-item-wrapper"),this._addClass(s,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),n=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(n,null,"ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=e.children(".ui-menu"),i.length&&t&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,s,n,o,a,r;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-i-s,o=this.activeMenu.scrollTop(),a=this.activeMenu.height(),r=e.outerHeight(),0>n?this.activeMenu.scrollTop(o+n):n+r>a&&this.activeMenu.scrollTop(o+n-a+r))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",t,{item:this.active}),this.active=null)},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(e),this._removeClass(s.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=s},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(e){return!t(e.target).closest(".ui-menu").length},_isDivider:function(t){return!/[^\-\u2014\u2013\s]/.test(t.text())},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var s;this.active&&(s="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.find(this.options.items)[e]()),this.focus(i,s)},nextPage:function(e){var i,s,n;return this.active?(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=t(this),0>i.offset().top-s-n}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items)[this.active?"last":"first"]())),void 0):(this.next(e),void 0)},previousPage:function(e){var i,s,n;return this.active?(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-s+n>0}),this.focus(e,i)):this.focus(e,this.activeMenu.find(this.options.items).first())),void 0):(this.next(e),void 0)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)},_filterMenuItems:function(e){var i=e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),s=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return s.test(t.trim(t(this).children(".ui-menu-item-wrapper").text()))})}}),t.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var e,i,s,n=this.element[0].nodeName.toLowerCase(),o="textarea"===n,a="input"===n;this.isMultiLine=o||!a&&this._isContentEditable(this.element),this.valueMethod=this.element[o||a?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return e=!0,s=!0,i=!0,void 0;e=!1,s=!1,i=!1;var o=t.ui.keyCode;switch(n.keyCode){case o.PAGE_UP:e=!0,this._move("previousPage",n);break;case o.PAGE_DOWN:e=!0,this._move("nextPage",n);break;case o.UP:e=!0,this._keyEvent("previous",n);break;case o.DOWN:e=!0,this._keyEvent("next",n);break;case o.ENTER:this.menu.active&&(e=!0,n.preventDefault(),this.menu.select(n));break;case o.TAB:this.menu.active&&this.menu.select(n);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(e)return e=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault(),void 0;if(!i){var n=t.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(t){return s?(s=!1,t.preventDefault(),void 0):(this._searchTimeout(t),void 0)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?(delete this.cancelBlur,void 0):(clearTimeout(this.searching),this.close(t),this._change(t),void 0)}}),this._initSource(),this.menu=t("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,this.element[0]!==t.ui.safeActiveElement(this.document[0])&&this.element.trigger("focus")})},menufocus:function(e,i){var s,n;return this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type))?(this.menu.blur(),this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)}),void 0):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",e,{item:n})&&e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(n.value),s=i.item.attr("aria-label")||n.value,s&&t.trim(s).length&&(this.liveRegion.children().hide(),t("<div>").text(s).appendTo(this.liveRegion)),void 0)},menuselect:function(e,i){var s=i.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==t.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=s})),!1!==this._trigger("select",e,{item:s})&&this._value(s.value),this.term=this._value(),this.close(e),this.selectedItem=s}}),this.liveRegion=t("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(e){var i=this.menu.element[0];return e.target===this.element[0]||e.target===i||t.contains(i,e.target)},_closeOnClickOutside:function(t){this._isEventTargetInWidget(t)||this.close()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,i,s=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,s){s(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,n){s.xhr&&s.xhr.abort(),s.xhr=t.ajax({url:i,data:e,dataType:"json",success:function(t){n(t)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){var e=this.term===this._value(),i=this.menu.element.is(":visible"),s=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey;(!e||e&&!i&&!s)&&(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):this._trigger("search",e)!==!1?this._search(t):void 0},_search:function(t){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var e=++this.requestIndex;return t.proxy(function(t){e===this.requestIndex&&this.__response(t),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")},this)},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({},e,{label:e.label||e.value,value:e.value||e.label})})},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var s=this;t.each(i,function(t,i){s._renderItemData(e,i)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").append(t("<div>").text(i.label)).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this.isMultiLine||this._value(this.term),this.menu.blur(),void 0):(this.menu[t](e),void 0):(this.search(null,e),void 0)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(t,e),e.preventDefault())},_isContentEditable:function(t){if(!t.length)return!1;var e=t.prop("contentEditable");return"inherit"===e?this._isContentEditable(t.parent()):"true"===e}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var s=RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return s.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.children().hide(),t("<div>").text(i).appendTo(this.liveRegion))}}),t.ui.autocomplete;var r=/ui-corner-([a-z]){2,6}/g;t.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var e=this,i=[];t.each(this.options.items,function(s,n){var o,a={};return n?"controlgroupLabel"===s?(o=e.element.find(n),o.each(function(){var e=t(this);e.children(".ui-controlgroup-label-contents").length||e.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),e._addClass(o,null,"ui-widget ui-widget-content ui-state-default"),i=i.concat(o.get()),void 0):(t.fn[s]&&(a=e["_"+s+"Options"]?e["_"+s+"Options"]("middle"):{classes:{}},e.element.find(n).each(function(){var n=t(this),o=n[s]("instance"),r=t.widget.extend({},a);if("button"!==s||!n.parent(".ui-spinner").length){o||(o=n[s]()[s]("instance")),o&&(r.classes=e._resolveClassesValues(r.classes,o)),n[s](r);var l=n[s]("widget");t.data(l[0],"ui-controlgroup-data",o?o:n[s]("instance")),i.push(l[0])}})),void 0):void 0}),this.childWidgets=t(t.unique(i)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(e){this.childWidgets.each(function(){var i=t(this),s=i.data("ui-controlgroup-data");s&&s[e]&&s[e]()})},_updateCornerClass:function(t,e){var i="ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all",s=this._buildSimpleOptions(e,"label").classes.label;this._removeClass(t,null,i),this._addClass(t,null,s)},_buildSimpleOptions:function(t,e){var i="vertical"===this.options.direction,s={classes:{}};return s.classes[e]={middle:"",first:"ui-corner-"+(i?"top":"left"),last:"ui-corner-"+(i?"bottom":"right"),only:"ui-corner-all"}[t],s},_spinnerOptions:function(t){var e=this._buildSimpleOptions(t,"ui-spinner");return e.classes["ui-spinner-up"]="",e.classes["ui-spinner-down"]="",e},_buttonOptions:function(t){return this._buildSimpleOptions(t,"ui-button")},_checkboxradioOptions:function(t){return this._buildSimpleOptions(t,"ui-checkboxradio-label")},_selectmenuOptions:function(t){var e="vertical"===this.options.direction;return{width:e?"auto":!1,classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(e?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(e?"top":"left")},last:{"ui-selectmenu-button-open":e?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(e?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[t]}},_resolveClassesValues:function(e,i){var s={};return t.each(e,function(n){var o=i.options.classes[n]||"";o=t.trim(o.replace(r,"")),s[n]=(o+" "+e[n]).replace(/\s+/g," ")}),s},_setOption:function(t,e){return"direction"===t&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(t,e),"disabled"===t?(this._callChildMethod(e?"disable":"enable"),void 0):(this.refresh(),void 0)},refresh:function(){var e,i=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),e=this.childWidgets,this.options.onlyVisible&&(e=e.filter(":visible")),e.length&&(t.each(["first","last"],function(t,s){var n=e[s]().data("ui-controlgroup-data");if(n&&i["_"+n.widgetName+"Options"]){var o=i["_"+n.widgetName+"Options"](1===e.length?"only":s);o.classes=i._resolveClassesValues(o.classes,n),n.element[n.widgetName](o)}else i._updateCornerClass(e[s](),s)}),this._callChildMethod("refresh"))}}),t.widget("ui.checkboxradio",[t.ui.formResetMixin,{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var e,i,s=this,n=this._super()||{};return this._readType(),i=this.element.labels(),this.label=t(i[i.length-1]),this.label.length||t.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element[0]).each(function(){s.originalLabel+=3===this.nodeType?t(this).text():this.outerHTML}),this.originalLabel&&(n.label=this.originalLabel),e=this.element[0].disabled,null!=e&&(n.disabled=e),n},_create:function(){var t=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),t&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var e=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===e&&/radio|checkbox/.test(this.type)||t.error("Can't create checkboxradio on element.nodeName="+e+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var e,i=this.element[0].name,s="input[name='"+t.ui.escapeSelector(i)+"']";return i?(e=this.form.length?t(this.form[0].elements).filter(s):t(s).filter(function(){return 0===t(this).form().length}),e.not(this.element)):t([])},_toggleClasses:function(){var e=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",e)._toggleClass(this.icon,null,"ui-icon-blank",!e),"radio"===this.type&&this._getRadioGroup().each(function(){var e=t(this).checkboxradio("instance");e&&e._removeClass(e.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(t,e){return"label"!==t||e?(this._super(t,e),"disabled"===t?(this._toggleClass(this.label,null,"ui-state-disabled",e),this.element[0].disabled=e,void 0):(this.refresh(),void 0)):void 0},_updateIcon:function(e){var i="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=t("<span>"),this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(i+=e?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,e?"ui-icon-blank":"ui-icon-check")):i+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",i),e||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var t=this.label.contents().not(this.element[0]);this.icon&&(t=t.not(this.icon[0])),this.iconSpace&&(t=t.not(this.iconSpace[0])),t.remove(),this.label.append(this.options.label)},refresh:function(){var t=this.element[0].checked,e=this.element[0].disabled;this._updateIcon(t),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),null!==this.options.label&&this._updateLabel(),e!==this.options.disabled&&this._setOptions({disabled:e})}}]),t.ui.checkboxradio,t.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var t,e=this._super()||{};return this.isInput=this.element.is("input"),t=this.element[0].disabled,null!=t&&(e.disabled=t),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(e.label=this.originalLabel),e},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(e){e.keyCode===t.ui.keyCode.SPACE&&(e.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(e,i){var s="iconPosition"!==e,n=s?this.options.iconPosition:i,o="top"===n||"bottom"===n;this.icon?s&&this._removeClass(this.icon,null,this.options.icon):(this.icon=t("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),s&&this._addClass(this.icon,null,i),this._attachIcon(n),o?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=t("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(n))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(t){this.icon[/^(?:end|bottom)/.test(t)?"before":"after"](this.iconSpace)},_attachIcon:function(t){this.element[/^(?:end|bottom)/.test(t)?"append":"prepend"](this.icon)},_setOptions:function(t){var e=void 0===t.showLabel?this.options.showLabel:t.showLabel,i=void 0===t.icon?this.options.icon:t.icon;e||i||(t.showLabel=!0),this._super(t)},_setOption:function(t,e){"icon"===t&&(e?this._updateIcon(t,e):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===t&&this._updateIcon(t,e),"showLabel"===t&&(this._toggleClass("ui-button-icon-only",null,!e),this._updateTooltip()),"label"===t&&(this.isInput?this.element.val(e):(this.element.html(e),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(t,e),"disabled"===t&&(this._toggleClass(null,"ui-state-disabled",e),this.element[0].disabled=e,e&&this.element.blur())},refresh:function(){var t=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOptions({disabled:t}),this._updateTooltip()}}),t.uiBackCompat!==!1&&(t.widget("ui.button",t.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(t,e){return"text"===t?(this._super("showLabel",e),void 0):("showLabel"===t&&(this.options.text=e),"icon"===t&&(this.options.icons.primary=e),"icons"===t&&(e.primary?(this._super("icon",e.primary),this._super("iconPosition","beginning")):e.secondary&&(this._super("icon",e.secondary),this._super("iconPosition","end"))),this._superApply(arguments),void 0)}}),t.fn.button=function(e){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?e.apply(this,arguments):(t.ui.checkboxradio||t.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(t.fn.button),t.fn.buttonset=function(){return t.ui.controlgroup||t.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),t.ui.button,t.widget("ui.dialog",{version:"1.12.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;0>i&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),t=e.parent.children().eq(e.index),t.length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog},disable:t.noop,enable:t.noop,close:function(e){var i=this;this._isOpen&&this._trigger("beforeClose",e)!==!1&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||t.ui.safeBlur(t.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",e)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,i){var s=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+t(this).css("z-index")}).get(),o=Math.max.apply(null,n);return o>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",o+1),s=!0),s&&!i&&this._trigger("focus",e),s},open:function(){var e=this;return this._isOpen?(this._moveToTop()&&this._focusTabbable(),void 0):(this._isOpen=!0,this.opener=t(t.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus")}),this._makeFocusTarget(),this._trigger("open"),void 0)},_focusTabbable:function(){var t=this._focusedElement;t||(t=this.element.find("[autofocus]")),t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).trigger("focus")},_keepFocus:function(e){function i(){var e=t.ui.safeActiveElement(this.document[0]),i=this.uiDialog[0]===e||t.contains(this.uiDialog[0],e);i||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),this.close(e),void 0;if(e.keyCode===t.ui.keyCode.TAB&&!e.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");e.target!==n[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==s[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(this._delay(function(){n.trigger("focus")}),e.preventDefault()):(this._delay(function(){s.trigger("focus")}),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=t("<button type='button'></button>").button({label:t("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(e,"ui-dialog-title"),this._title(e),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title?t.text(this.options.title):t.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length?(this._removeClass(this.uiDialog,"ui-dialog-buttons"),void 0):(t.each(i,function(i,s){var n,o;s=t.isFunction(s)?{click:s,text:i}:s,s=t.extend({type:"button"},s),n=s.click,o={icon:s.icon,iconPosition:s.iconPosition,showLabel:s.showLabel,icons:s.icons,text:s.text},delete s.click,delete s.icon,delete s.iconPosition,delete s.showLabel,delete s.icons,"boolean"==typeof s.text&&delete s.text,t("<button></button>",s).button(o).appendTo(e.uiButtonSet).on("click",function(){n.apply(e.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog),void 0)},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,n){i._addClass(t(this),"ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,e(n))},drag:function(t,s){i._trigger("drag",t,e(s))},stop:function(n,o){var a=o.offset.left-i.document.scrollLeft(),r=o.offset.top-i.document.scrollTop();s.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" "+"top"+(r>=0?"+":"")+r,of:i.window},i._removeClass(t(this),"ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,e(o))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,s=this.options,n=s.resizable,o=this.uiDialog.css("position"),a="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:a,start:function(s,n){i._addClass(t(this),"ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,e(n))},resize:function(t,s){i._trigger("resize",t,e(s))},stop:function(n,o){var a=i.uiDialog.offset(),r=a.left-i.document.scrollLeft(),l=a.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:"left top",at:"left"+(r>=0?"+":"")+r+" "+"top"+(l>=0?"+":"")+l,of:i.window},i._removeClass(t(this),"ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,e(o))}}).css("position",o)},_trackFocus:function(){this._on(this.widget(),{focusin:function(e){this._makeFocusTarget(),this._focusedElement=t(e.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var e=this._trackingInstances(),i=t.inArray(this,e);-1!==i&&e.splice(i,1)},_trackingInstances:function(){var t=this.document.data("ui-dialog-instances");return t||(t=[],this.document.data("ui-dialog-instances",t)),t},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(e){var i=this,s=!1,n={};t.each(e,function(t,e){i._setOption(t,e),t in i.sizeRelatedOptions&&(s=!0),t in i.resizableRelatedOptions&&(n[t]=e)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,i){var s,n,o=this.uiDialog;"disabled"!==e&&(this._super(e,i),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:t("<a>").text(""+this.options.closeText).html()}),"draggable"===e&&(s=o.is(":data(ui-draggable)"),s&&!i&&o.draggable("destroy"),!s&&i&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(n=o.is(":data(ui-resizable)"),n&&!i&&o.resizable("destroy"),n&&"string"==typeof i&&o.resizable("option","handles",i),n||i===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),t=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),e=Math.max(0,s.minHeight-t),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-t):"none","auto"===s.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return t(e.target).closest(".ui-dialog").length?!0:!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=!0;this._delay(function(){e=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(t){e||this._allowInteraction(t)||(t.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=t("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var t=this.document.data("ui-dialog-overlays")-1;t?this.document.data("ui-dialog-overlays",t):(this._off(this.document,"focusin"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),t.uiBackCompat!==!1&&t.widget("ui.dialog",t.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(t,e){"dialogClass"===t&&this.uiDialog.removeClass(this.options.dialogClass).addClass(e),this._superApply(arguments)}}),t.ui.dialog,t.widget("ui.progressbar",{version:"1.12.1",options:{classes:{"ui-progressbar":"ui-corner-all","ui-progressbar-value":"ui-corner-left","ui-progressbar-complete":"ui-corner-right"},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.attr({role:"progressbar","aria-valuemin":this.min}),this._addClass("ui-progressbar","ui-widget ui-widget-content"),this.valueDiv=t("<div>").appendTo(this.element),this._addClass(this.valueDiv,"ui-progressbar-value","ui-widget-header"),this._refreshValue()},_destroy:function(){this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow"),this.valueDiv.remove()},value:function(t){return void 0===t?this.options.value:(this.options.value=this._constrainedValue(t),this._refreshValue(),void 0)},_constrainedValue:function(t){return void 0===t&&(t=this.options.value),this.indeterminate=t===!1,"number"!=typeof t&&(t=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),this._super(t,e)},_setOptionDisabled:function(t){this._super(t),this.element.attr("aria-disabled",t),this._toggleClass(null,"ui-state-disabled",!!t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).width(i.toFixed(0)+"%"),this._toggleClass(this.valueDiv,"ui-progressbar-complete",null,e===this.options.max)._toggleClass("ui-progressbar-indeterminate",null,this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div>").appendTo(this.valueDiv),this._addClass(this.overlayDiv,"ui-progressbar-overlay"))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}}),t.widget("ui.selectmenu",[t.ui.formResetMixin,{version:"1.12.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this._bindFormResetHandler(),this._rendered=!1,this.menuItems=t()},_drawButton:function(){var e,i=this,s=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button),this._on(this.labels,{click:function(t){this.button.focus(),t.preventDefault()}}),this.element.hide(),this.button=t("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element),this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget"),e=t("<span>").appendTo(this.button),this._addClass(e,"ui-selectmenu-icon","ui-icon "+this.options.icons.button),this.buttonItem=this._renderButtonItem(s).appendTo(this.button),this.options.width!==!1&&this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){i._rendered||i._refreshMenu()})},_drawMenu:function(){var e=this;this.menu=t("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=t("<div>").append(this.menu),this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front"),this.menuWrap.appendTo(this._appendTo()),this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(t,i){t.preventDefault(),e._setSelection(),e._select(i.item.data("ui-selectmenu-item"),t)},focus:function(t,i){var s=i.item.data("ui-selectmenu-item");null!=e.focusIndex&&s.index!==e.focusIndex&&(e._trigger("focus",t,{item:s}),e.isOpen||e._select(s,t)),e.focusIndex=s.index,e.button.attr("aria-activedescendant",e.menuItems.eq(s.index).attr("id"))}}).menu("instance"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{})),null===this.options.width&&this._resizeButton()},_refreshMenu:function(){var t,e=this.element.find("option");this.menu.empty(),this._parseOptions(e),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper"),this._rendered=!0,e.length&&(t=this._getSelectedItem(),this.menuInstance.focus(null,t),this._setAria(t.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(t){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",t)))},_position:function(){this.menuWrap.position(t.extend({of:this.button},this.options.position))},close:function(t){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",t))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(e){var i=t("<span>");return this._setText(i,e.label),this._addClass(i,"ui-selectmenu-text"),i},_renderMenu:function(e,i){var s=this,n="";t.each(i,function(i,o){var a;o.optgroup!==n&&(a=t("<li>",{text:o.optgroup}),s._addClass(a,"ui-selectmenu-optgroup","ui-menu-divider"+(o.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),a.appendTo(e),n=o.optgroup),s._renderItemData(e,o)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-selectmenu-item",e)},_renderItem:function(e,i){var s=t("<li>"),n=t("<div>",{title:i.element.attr("title")});return i.disabled&&this._addClass(s,null,"ui-state-disabled"),this._setText(n,i.label),s.append(n).appendTo(e)},_setText:function(t,e){e?t.text(e):t.html("&#160;")},_move:function(t,e){var i,s,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex).parent("li"):(i=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),n+=":not(.ui-state-disabled)"),s="first"===t||"last"===t?i["first"===t?"prevAll":"nextAll"](n).eq(-1):i[t+"All"](n).eq(0),s.length&&this.menuInstance.focus(e,s)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(t){this[this.isOpen?"close":"open"](t)},_setSelection:function(){var t;this.range&&(window.getSelection?(t=window.getSelection(),t.removeAllRanges(),t.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(e){this.isOpen&&(t(e.target).closest(".ui-selectmenu-menu, #"+t.ui.escapeSelector(this.ids.button)).length||this.close(e))}},_buttonEvents:{mousedown:function(){var t;window.getSelection?(t=window.getSelection(),t.rangeCount&&(this.range=t.getRangeAt(0))):this.range=document.selection.createRange()},click:function(t){this._setSelection(),this._toggle(t)},keydown:function(e){var i=!0;switch(e.keyCode){case t.ui.keyCode.TAB:case t.ui.keyCode.ESCAPE:this.close(e),i=!1;break;case t.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(e);break;case t.ui.keyCode.UP:e.altKey?this._toggle(e):this._move("prev",e);break;case t.ui.keyCode.DOWN:e.altKey?this._toggle(e):this._move("next",e);break;case t.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(e):this._toggle(e);break;case t.ui.keyCode.LEFT:this._move("prev",e);break;case t.ui.keyCode.RIGHT:this._move("next",e);break;case t.ui.keyCode.HOME:case t.ui.keyCode.PAGE_UP:this._move("first",e);break;case t.ui.keyCode.END:case t.ui.keyCode.PAGE_DOWN:this._move("last",e);break;default:this.menu.trigger(e),i=!1}i&&e.preventDefault()}},_selectFocusedItem:function(t){var e=this.menuItems.eq(this.focusIndex).parent("li");e.hasClass("ui-state-disabled")||this._select(e.data("ui-selectmenu-item"),t)},_select:function(t,e){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=t.index,this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(t)),this._setAria(t),this._trigger("select",e,{item:t}),t.index!==i&&this._trigger("change",e,{item:t}),this.close(e)},_setAria:function(t){var e=this.menuItems.eq(t.index).attr("id");this.button.attr({"aria-labelledby":e,"aria-activedescendant":e}),this.menu.attr("aria-activedescendant",e)},_setOption:function(t,e){if("icons"===t){var i=this.button.find("span.ui-icon");this._removeClass(i,null,this.options.icons.button)._addClass(i,null,e.button)}this._super(t,e),"appendTo"===t&&this.menuWrap.appendTo(this._appendTo()),"width"===t&&this._resizeButton()},_setOptionDisabled:function(t){this._super(t),this.menuInstance.option("disabled",t),this.button.attr("aria-disabled",t),this._toggleClass(this.button,null,"ui-state-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen),this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var t=this.options.width;return t===!1?(this.button.css("width",""),void 0):(null===t&&(t=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(t),void 0)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var t=this._super();return t.disabled=this.element.prop("disabled"),t},_parseOptions:function(e){var i=this,s=[];e.each(function(e,n){s.push(i._parseOption(t(n),e))}),this.items=s},_parseOption:function(t,e){var i=t.parent("optgroup");return{element:t,index:e,value:t.val(),label:t.text(),optgroup:i.attr("label")||"",disabled:i.prop("disabled")||t.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler(),this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.labels.attr("for",this.ids.element)}}]),t.widget("ui.slider",t.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,s=this.options,n=this.element.find(".ui-slider-handle"),o="<span tabindex='0'></span>",a=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),e=n.length;i>e;e++)a.push(o);this.handles=n.add(t(a.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e).attr("tabIndex",0)})},_createRange:function(){var e=this.options;e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})):(this.range=t("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),("min"===e.range||"max"===e.range)&&this._addClass(this.range,"ui-slider-range-"+e.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(e){var i,s,n,o,a,r,l,h,c=this,u=this.options;return u.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(s-c.values(e));(n>i||n===i&&(e===c._lastChangedValue||c.values(e)===u.min))&&(n=i,o=t(this),a=e)}),r=this._start(e,a),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=a,this._addClass(o,null,"ui-state-active"),o.trigger("focus"),l=o.offset(),h=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=h?{left:0,top:0}:{left:e.pageX-l.left-o.width()/2,top:e.pageY-l.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,a,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,s,n,o;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/e,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),o=this._valueMin()+s*n,this._trimAlignValue(o)},_uiHash:function(t,e,i){var s={handle:this.handles[t],handleIndex:t,value:void 0!==e?e:this.value()};return this._hasMultipleValues()&&(s.value=void 0!==e?e:this.values(t),s.values=i||this.values()),s},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(t,e){return this._trigger("start",t,this._uiHash(e))},_slide:function(t,e,i){var s,n,o=this.value(),a=this.values();this._hasMultipleValues()&&(n=this.values(e?0:1),o=this.values(e),2===this.options.values.length&&this.options.range===!0&&(i=0===e?Math.min(n,i):Math.max(n,i)),a[e]=i),i!==o&&(s=this._trigger("slide",t,this._uiHash(e,i,a)),s!==!1&&(this._hasMultipleValues()?this.values(e,i):this.value(i)))},_stop:function(t,e){this._trigger("stop",t,this._uiHash(e))},_change:function(t,e){this._keySliding||this._mouseSliding||(this._lastChangedValue=e,this._trigger("change",t,this._uiHash(e)))},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(e,i){var s,n,o;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),this._change(null,e),void 0;if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this._hasMultipleValues()?this._values(e):this.value();for(s=this.options.values,n=arguments[0],o=0;s.length>o;o+=1)s[o]=this._trimAlignValue(n[o]),this._change(null,o);this._refreshValue()},_setOption:function(e,i){var s,n=0;switch("range"===e&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(n=this.options.values.length),this._super(e,i),e){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(i),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=n-1;s>=0;s--)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(t){this._super(t),this._toggleClass(null,"ui-state-disabled",!!t)},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,s;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this._hasMultipleValues()){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,s=t-i;return 2*Math.abs(i)>=e&&(s+=i>0?e:-e),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var t=this.options.max,e=this._valueMin(),i=this.options.step,s=Math.round((t-e)/i)*i;t=s+e,t>this.options.max&&(t-=i),this.max=parseFloat(t.toFixed(this._precision()))},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(t){"vertical"===t&&this.range.css({width:"",left:""}),"horizontal"===t&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var e,i,s,n,o,a=this.options.range,r=this.options,l=this,h=this._animateOff?!1:r.animate,c={};this._hasMultipleValues()?this.handles.each(function(s){i=100*((l.values(s)-l._valueMin())/(l._valueMax()-l._valueMin())),c["horizontal"===l.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[h?"animate":"css"](c,r.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===s&&l.range.stop(1,1)[h?"animate":"css"]({left:i+"%"},r.animate),1===s&&l.range[h?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:r.animate})):(0===s&&l.range.stop(1,1)[h?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&l.range[h?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:r.animate}))),e=i}):(s=this.value(),n=this._valueMin(),o=this._valueMax(),i=o!==n?100*((s-n)/(o-n)):0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[h?"animate":"css"](c,r.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:i+"%"},r.animate),"max"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:100-i+"%"},r.animate),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:i+"%"},r.animate),"max"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:100-i+"%"},r.animate))},_handleEvents:{keydown:function(e){var i,s,n,o,a=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(t(e.target),null,"ui-state-active"),i=this._start(e,a),i===!1))return}switch(o=this.options.step,s=n=this._hasMultipleValues()?this.values(a):this.value(),e.keyCode){case t.ui.keyCode.HOME:n=this._valueMin();break;case t.ui.keyCode.END:n=this._valueMax();break;case t.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(s===this._valueMax())return;n=this._trimAlignValue(s+o);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(s===this._valueMin())return;n=this._trimAlignValue(s-o)}this._slide(e,a,n)},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),this._removeClass(t(e.target),null,"ui-state-active"))}}}),t.widget("ui.spinner",{version:"1.12.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e=this._super(),i=this.element;return t.each(["min","max","step"],function(t,s){var n=i.attr(s);null!=n&&n.length&&(e[s]=n)}),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){return this.cancelBlur?(delete this.cancelBlur,void 0):(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",t),void 0)},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((e>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(t)},100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function i(){var e=this.element[0]===t.ui.safeActiveElement(this.document[0]);e||(this.element.trigger("focus"),this.previous=s,this._delay(function(){this.previous=s}))}var s;s=this.element[0]===t.ui.safeActiveElement(this.document[0])?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(e)!==!1&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){return t(e.currentTarget).hasClass("ui-state-active")?this._start(e)===!1?!1:(this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e),void 0):void 0},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(.5*this.uiSpinner.height())&&this.uiSpinner.height()>0&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(e){var i=this.options,s=t.ui.keyCode;switch(e.keyCode){case s.UP:return this._repeat(null,1,e),!0;case s.DOWN:return this._repeat(null,-1,e),!0;case s.PAGE_UP:return this._repeat(null,i.page,e),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,e),!0}return!1},_start:function(t){return this.spinning||this._trigger("start",t)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(t,e,i){t=t||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,e,i)},t),this._spin(e*this.options.step,i)},_spin:function(t,e){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+t*this._increment(this.counter)),this.spinning&&this._trigger("spin",e,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(e){var i=this.options.incremental;return i?t.isFunction(i)?i(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_adjustValue:function(t){var e,i,s=this.options;return e=null!==s.min?s.min:0,i=t-e,i=Math.round(i/s.step)*s.step,t=e+i,t=parseFloat(t.toFixed(this._precision())),null!==s.max&&t>s.max?s.max:null!==s.min&&s.min>t?s.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t))},_setOption:function(t,e){var i,s,n;return"culture"===t||"numberFormat"===t?(i=this._parse(this.element.val()),this.options[t]=e,this.element.val(this._format(i)),void 0):(("max"===t||"min"===t||"step"===t)&&"string"==typeof e&&(e=this._parse(e)),"icons"===t&&(s=this.buttons.first().find(".ui-icon"),this._removeClass(s,null,this.options.icons.up),this._addClass(s,null,e.up),n=this.buttons.last().find(".ui-icon"),this._removeClass(n,null,this.options.icons.down),this._addClass(n,null,e.down)),this._super(t,e),void 0)},_setOptionDisabled:function(t){this._super(t),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable")},_setOptions:i(function(t){this._super(t)}),_parse:function(t){return"string"==typeof t&&""!==t&&(t=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t),""===t||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var t=this.value();return null===t?!1:t===this._adjustValue(t)},_value:function(t,e){var i;""!==t&&(i=this._parse(t),null!==i&&(e||(i=this._adjustValue(i)),t=this._format(i))),this.element.val(t),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:i(function(t){this._stepUp(t)}),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:i(function(t){this._stepDown(t)}),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:i(function(t){this._stepUp((t||1)*this.options.page)}),pageDown:i(function(t){this._stepDown((t||1)*this.options.page)}),value:function(t){return arguments.length?(i(this._value).call(this,t),void 0):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),t.uiBackCompat!==!1&&t.widget("ui.spinner",t.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}}),t.ui.spinner,t.widget("ui.tabs",{version:"1.12.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var t=/#.*$/;return function(e){var i,s;i=e.href.replace(t,""),s=location.href.replace(t,"");try{i=decodeURIComponent(i)}catch(n){}try{s=decodeURIComponent(s)}catch(n){}return e.hash.length>1&&i===s}}(),_create:function(){var e=this,i=this.options;this.running=!1,this._addClass("ui-tabs","ui-widget ui-widget-content"),this._toggleClass("ui-tabs-collapsible",null,i.collapsible),this._processTabs(),i.active=this._initialActive(),t.isArray(i.disabled)&&(i.disabled=t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"),function(t){return e.tabs.index(t)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(i.active):t(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var e=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===e&&(s&&this.tabs.each(function(i,n){return t(n).attr("aria-controls")===s?(e=i,!1):void 0}),null===e&&(e=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===e||-1===e)&&(e=this.tabs.length?0:!1)),e!==!1&&(e=this.tabs.index(this.tabs.eq(e)),-1===e&&(e=i?!1:0)),!i&&e===!1&&this.anchors.length&&(e=0),e},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):t()}},_tabKeydown:function(e){var i=t(t.ui.safeActiveElement(this.document[0])).closest("li"),s=this.tabs.index(i),n=!0;if(!this._handlePageNav(e)){switch(e.keyCode){case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:s++;break;case t.ui.keyCode.UP:case t.ui.keyCode.LEFT:n=!1,s--;break;case t.ui.keyCode.END:s=this.anchors.length-1;break;case t.ui.keyCode.HOME:s=0;break;case t.ui.keyCode.SPACE:return e.preventDefault(),clearTimeout(this.activating),this._activate(s),void 0;case t.ui.keyCode.ENTER:return e.preventDefault(),clearTimeout(this.activating),this._activate(s===this.options.active?!1:s),void 0;default:return}e.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,n),e.ctrlKey||e.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(s).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",s)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===t.ui.keyCode.UP&&(e.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(e){return e.altKey&&e.keyCode===t.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):e.altKey&&e.keyCode===t.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(e,i){function s(){return e>n&&(e=0),0>e&&(e=n),e}for(var n=this.tabs.length-1;-1!==t.inArray(s(),this.options.disabled);)e=i?e+1:e-1;return e},_focusNextTab:function(t,e){return t=this._findNextTab(t,e),this.tabs.eq(t).trigger("focus"),t},_setOption:function(t,e){return"active"===t?(this._activate(e),void 0):(this._super(t,e),"collapsible"===t&&(this._toggleClass("ui-tabs-collapsible",null,e),e||this.options.active!==!1||this._activate(0)),"event"===t&&this._setupEvents(e),"heightStyle"===t&&this._setupHeightStyle(e),void 0)},_sanitizeSelector:function(t){return t?t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,i=this.tablist.children(":has(a[href])");e.disabled=t.map(i.filter(".ui-state-disabled"),function(t){return i.index(t)}),this._processTabs(),e.active!==!1&&this.anchors.length?this.active.length&&!t.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=t()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=t()),this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var e=this,i=this.tabs,s=this.anchors,n=this.panels;this.tablist=this._getList().attr("role","tablist"),this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header"),this.tablist.on("mousedown"+this.eventNamespace,"> li",function(e){t(this).is(".ui-state-disabled")&&e.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){t(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1}),this._addClass(this.tabs,"ui-tabs-tab","ui-state-default"),this.anchors=this.tabs.map(function(){return t("a",this)[0]}).attr({role:"presentation",tabIndex:-1}),this._addClass(this.anchors,"ui-tabs-anchor"),this.panels=t(),this.anchors.each(function(i,s){var n,o,a,r=t(s).uniqueId().attr("id"),l=t(s).closest("li"),h=l.attr("aria-controls");e._isLocal(s)?(n=s.hash,a=n.substring(1),o=e.element.find(e._sanitizeSelector(n))):(a=l.attr("aria-controls")||t({}).uniqueId()[0].id,n="#"+a,o=e.element.find(n),o.length||(o=e._createPanel(a),o.insertAfter(e.panels[i-1]||e.tablist)),o.attr("aria-live","polite")),o.length&&(e.panels=e.panels.add(o)),h&&l.data("ui-tabs-aria-controls",h),l.attr({"aria-controls":a,"aria-labelledby":r}),o.attr("aria-labelledby",r)}),this.panels.attr("role","tabpanel"),this._addClass(this.panels,"ui-tabs-panel","ui-widget-content"),i&&(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(e){return t("<div>").attr("id",e).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(e){var i,s,n;for(t.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1),n=0;s=this.tabs[n];n++)i=t(s),e===!0||-1!==t.inArray(n,e)?(i.attr("aria-disabled","true"),this._addClass(i,null,"ui-state-disabled")):(i.removeAttr("aria-disabled"),this._removeClass(i,null,"ui-state-disabled"));this.options.disabled=e,this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,e===!0)},_setupEvents:function(e){var i={};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(t){t.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,s=this.element.parent();"fill"===e?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=t(this),s=e.css("position");"absolute"!==s&&"fixed"!==s&&(i-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=t(this).outerHeight(!0)}),this.panels.each(function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each(function(){i=Math.max(i,t(this).height("").height())}).height(i))},_eventHandler:function(e){var i=this.options,s=this.active,n=t(e.currentTarget),o=n.closest("li"),a=o[0]===s[0],r=a&&i.collapsible,l=r?t():this._getPanelForTab(o),h=s.length?this._getPanelForTab(s):t(),c={oldTab:s,oldPanel:h,newTab:r?t():o,newPanel:l};e.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||a&&!i.collapsible||this._trigger("beforeActivate",e,c)===!1||(i.active=r?!1:this.tabs.index(o),this.active=a?t():o,this.xhr&&this.xhr.abort(),h.length||l.length||t.error("jQuery UI Tabs: Mismatching fragment identifier."),l.length&&this.load(this.tabs.index(o),e),this._toggle(e,c))},_toggle:function(e,i){function s(){o.running=!1,o._trigger("activate",e,i)}function n(){o._addClass(i.newTab.closest("li"),"ui-tabs-active","ui-state-active"),a.length&&o.options.show?o._show(a,o.options.show,s):(a.show(),s())}var o=this,a=i.newPanel,r=i.oldPanel;this.running=!0,r.length&&this.options.hide?this._hide(r,this.options.hide,function(){o._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),n()}):(this._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),r.hide(),n()),r.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),a.length&&r.length?i.oldTab.attr("tabIndex",-1):a.length&&this.tabs.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),a.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(e){var i,s=this._findActive(e);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return e===!1?t():this.tabs.eq(e)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+t.ui.escapeSelector(e)+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.tablist.removeAttr("role").off(this.eventNamespace),this.anchors.removeAttr("role tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){t.data(this,"ui-tabs-destroy")?t(this).remove():t(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")}),this.tabs.each(function(){var e=t(this),i=e.data("ui-tabs-aria-controls");i?e.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(e){var i=this.options.disabled;i!==!1&&(void 0===e?i=!1:(e=this._getIndex(e),i=t.isArray(i)?t.map(i,function(t){return t!==e?t:null}):t.map(this.tabs,function(t,i){return i!==e?i:null})),this._setOptionDisabled(i))},disable:function(e){var i=this.options.disabled;if(i!==!0){if(void 0===e)i=!0;else{if(e=this._getIndex(e),-1!==t.inArray(e,i))return;i=t.isArray(i)?t.merge([e],i).sort():[e]}this._setOptionDisabled(i)}},load:function(e,i){e=this._getIndex(e);var s=this,n=this.tabs.eq(e),o=n.find(".ui-tabs-anchor"),a=this._getPanelForTab(n),r={tab:n,panel:a},l=function(t,e){"abort"===e&&s.panels.stop(!1,!0),s._removeClass(n,"ui-tabs-loading"),a.removeAttr("aria-busy"),t===s.xhr&&delete s.xhr};this._isLocal(o[0])||(this.xhr=t.ajax(this._ajaxSettings(o,i,r)),this.xhr&&"canceled"!==this.xhr.statusText&&(this._addClass(n,"ui-tabs-loading"),a.attr("aria-busy","true"),this.xhr.done(function(t,e,n){setTimeout(function(){a.html(t),s._trigger("load",i,r),l(n,e)},1)}).fail(function(t,e){setTimeout(function(){l(t,e)},1)})))},_ajaxSettings:function(e,i,s){var n=this;return{url:e.attr("href").replace(/#.*$/,""),beforeSend:function(e,o){return n._trigger("beforeLoad",i,t.extend({jqXHR:e,ajaxSettings:o},s))}}},_getPanelForTab:function(e){var i=t(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),t.uiBackCompat!==!1&&t.widget("ui.tabs",t.ui.tabs,{_processTabs:function(){this._superApply(arguments),this._addClass(this.tabs,"ui-tab")}}),t.ui.tabs,t.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(e,i){var s=(e.attr("aria-describedby")||"").split(/\s+/);s.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(s.join(" ")))},_removeDescribedBy:function(e){var i=e.data("ui-tooltip-id"),s=(e.attr("aria-describedby")||"").split(/\s+/),n=t.inArray(i,s);-1!==n&&s.splice(n,1),e.removeData("ui-tooltip-id"),s=t.trim(s.join(" ")),s?e.attr("aria-describedby",s):e.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.liveRegion=t("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this.disabledTitles=t([])},_setOption:function(e,i){var s=this;this._super(e,i),"content"===e&&t.each(this.tooltips,function(t,e){s._updateContent(e.element)})},_setOptionDisabled:function(t){this[t?"_disable":"_enable"]()},_disable:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur");n.target=n.currentTarget=s.element[0],e.close(n,!0)}),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var e=t(this);return e.is("[title]")?e.data("ui-tooltip-title",e.attr("title")).removeAttr("title"):void 0}))},_enable:function(){this.disabledTitles.each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))}),this.disabledTitles=t([])},open:function(e){var i=this,s=t(e?e.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&s.parents().each(function(){var e,s=t(this);s.data("ui-tooltip-open")&&(e=t.Event("blur"),e.target=e.currentTarget=this,i.close(e,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._registerCloseHandlers(e,s),this._updateContent(s,e))},_updateContent:function(t,e){var i,s=this.options.content,n=this,o=e?e.type:null;return"string"==typeof s||s.nodeType||s.jquery?this._open(e,t,s):(i=s.call(t[0],function(i){n._delay(function(){t.data("ui-tooltip-open")&&(e&&(e.type=o),this._open(e,t,i))})}),i&&this._open(e,t,i),void 0)},_open:function(e,i,s){function n(t){h.of=t,a.is(":hidden")||a.position(h)}var o,a,r,l,h=t.extend({},this.options.position);if(s){if(o=this._find(i))return o.tooltip.find(".ui-tooltip-content").html(s),void 0;i.is("[title]")&&(e&&"mouseover"===e.type?i.attr("title",""):i.removeAttr("title")),o=this._tooltip(i),a=o.tooltip,this._addDescribedBy(i,a.attr("id")),a.find(".ui-tooltip-content").html(s),this.liveRegion.children().hide(),l=t("<div>").html(a.find(".ui-tooltip-content").html()),l.removeAttr("name").find("[name]").removeAttr("name"),l.removeAttr("id").find("[id]").removeAttr("id"),l.appendTo(this.liveRegion),this.options.track&&e&&/^mouse/.test(e.type)?(this._on(this.document,{mousemove:n}),n(e)):a.position(t.extend({of:i},this.options.position)),a.hide(),this._show(a,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(r=this.delayedShow=setInterval(function(){a.is(":visible")&&(n(h.of),clearInterval(r))},t.fx.interval)),this._trigger("open",e,{tooltip:a})}},_registerCloseHandlers:function(e,i){var s={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var s=t.Event(e);s.currentTarget=i[0],this.close(s,!0)}}};i[0]!==this.element[0]&&(s.remove=function(){this._removeTooltip(this._find(i).tooltip)}),e&&"mouseover"!==e.type||(s.mouseleave="close"),e&&"focusin"!==e.type||(s.focusout="close"),this._on(!0,i,s)},close:function(e){var i,s=this,n=t(e?e.currentTarget:this.element),o=this._find(n);return o?(i=o.tooltip,o.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),o.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(t(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,i){t(i.element).attr("title",i.title),delete s.parents[e]}),o.closing=!0,this._trigger("close",e,{tooltip:i}),o.hiding||(o.closing=!1)),void 0):(n.removeData("ui-tooltip-open"),void 0)},_tooltip:function(e){var i=t("<div>").attr("role","tooltip"),s=t("<div>").appendTo(i),n=i.uniqueId().attr("id");return this._addClass(s,"ui-tooltip-content"),this._addClass(i,"ui-tooltip","ui-widget ui-widget-content"),i.appendTo(this._appendTo(e)),this.tooltips[n]={element:e,tooltip:i}},_find:function(t){var e=t.data("ui-tooltip-id");return e?this.tooltips[e]:null},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_appendTo:function(t){var e=t.closest(".ui-front, dialog");return e.length||(e=this.document[0].body),e},_destroy:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur"),o=s.element;n.target=n.currentTarget=o[0],e.close(n,!0),t("#"+i).remove(),o.data("ui-tooltip-title")&&(o.attr("title")||o.attr("title",o.data("ui-tooltip-title")),o.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}}),t.uiBackCompat!==!1&&t.widget("ui.tooltip",t.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var t=this._superApply(arguments);return this.options.tooltipClass&&t.tooltip.addClass(this.options.tooltipClass),t}}),t.ui.tooltip});!function(a,b,c){"use strict";function d(a){var b=null;if("VIDEO"===a.tagName)b=a;else{var c=a.getElementsByTagName("video");c[0]&&(b=c[0])}return b}function e(a){var b=d(a);if(b&&b.webkitEnterFullscreen){try{b.readyState<b.HAVE_METADATA?(b.addEventListener("loadedmetadata",function e(){b.removeEventListener("loadedmetadata",e,!1),b.webkitEnterFullscreen(),l=!!b.getAttribute("controls")},!1),b.load()):(b.webkitEnterFullscreen(),l=!!b.getAttribute("controls")),k=b}catch(c){return r("not_supported",a)}return!0}return r(void 0===j.request?"not_supported":"not_enabled",a)}function f(){s.element||(q(),h())}function g(){c&&"webkitfullscreenchange"===j.change&&window.addEventListener("resize",f,!1)}function h(){c&&"webkitfullscreenchange"===j.change&&window.removeEventListener("resize",f,!1)}var i=/i(Pad|Phone|Pod)/.test(navigator.userAgent)&&parseInt(navigator.userAgent.replace(/^.*OS (\d+)_(\d+).*$/,"$1.$2"),10)>=7,j=function(){var a=b.createElement("video"),c={request:["requestFullscreen","webkitRequestFullscreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullscreen"],exit:["exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],enabled:["fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled"],element:["fullscreenElement","webkitFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElement","msFullscreenElement"],change:["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],error:["fullscreenerror","webkitfullscreenerror","mozfullscreenerror","MSFullscreenError"]},d={};for(var e in c)for(var f=0,g=c[e].length;g>f;f++)if(c[e][f]in a||c[e][f]in b||"on"+c[e][f].toLowerCase()in b){d[e]=c[e][f];break}return d}(),k=null,l=null,m=function(){},n=[],o=!1;navigator.userAgent.indexOf("Android")>-1&&navigator.userAgent.indexOf("Chrome")>-1&&(o=parseInt(navigator.userAgent.replace(/^.*Chrome\/(\d+).*$/,"$1"),10)||!0);var p=function(a){var b=n[n.length-1];b&&(a!==b.element&&a!==k||!b.hasEntered)&&("VIDEO"===a.tagName&&(k=a),1===n.length&&s.onenter(s.element),b.enter.call(b.element,a||b.element),b.hasEntered=!0)},q=function(){!k||l||i||(k.setAttribute("controls","controls"),k.removeAttribute("controls")),k=null,l=null;var a=n.pop();a&&(a.exit.call(a.element),s.element||(n.forEach(function(a){a.exit.call(a.element)}),n=[],s.onexit()))},r=function(a,b){if(n.length>0){var c=n.pop();b=b||c.element,c.error.call(b,a),s.onerror(b,a)}},s={request:function(a,d,f,g){if(a=a||b.body,n.push({element:a,enter:d||m,exit:f||m,error:g||m}),void 0===j.request)return void e(a);if(c&&b[j.enabled]===!1)return void e(a);if(o!==!1&&32>o)return void e(a);if(c&&void 0===j.enabled)return j.enabled="webkitFullscreenEnabled",a[j.request](),void setTimeout(function(){b[j.element]?b[j.enabled]=!0:(b[j.enabled]=!1,e(a))},250);try{a[j.request](),setTimeout(function(){b[j.element]||r(c?"not_enabled":"not_allowed",a)},100)}catch(h){r("not_enabled",a)}},exit:function(){h(),b[j.exit]()},toggle:function(a,b,c,d){s.element?s.exit():s.request(a,b,c,d)},videoEnabled:function(a){if(s.enabled)return!0;a=a||b.body;var c=d(a);return c&&void 0!==c.webkitSupportsFullscreen?c.readyState<c.HAVE_METADATA?"maybe":c.webkitSupportsFullscreen:!1},onenter:m,onexit:m,onchange:m,onerror:m};try{Object.defineProperties(s,{element:{enumerable:!0,get:function(){return k&&k.webkitDisplayingFullscreen?k:b[j.element]||null}},enabled:{enumerable:!0,get:function(){return"webkitCancelFullScreen"!==j.exit||c?o!==!1&&32>o?!1:b[j.enabled]||!1:!0}}}),j.change&&b.addEventListener(j.change,function(a){if(s.onchange(s.element),s.element){var b=n[n.length-2];b&&b.element===s.element?q():(p(s.element),g())}else q()},!1),b.addEventListener("webkitbeginfullscreen",function(a){var b=!0;if(n.length>0)for(var c=0,e=n.length;e>c;c++){var f=d(n[c].element);if(f===a.srcElement){b=!1;break}}b&&n.push({element:a.srcElement,enter:m,exit:m,error:m}),s.onchange(a.srcElement),p(a.srcElement)},!0),b.addEventListener("webkitendfullscreen",function(a){s.onchange(a.srcElement),q(a.srcElement)},!0),j.error&&b.addEventListener(j.error,function(a){r("not_allowed")},!1)}catch(t){s.element=null,s.enabled=!1}"function"==typeof define&&define.amd?define(function(){return s}):"undefined"!=typeof module&&module.exports?module.exports=s:a.BigScreen=s}(this,document,self!==top);var bmp_lib={};bmp_lib.render=function(element,grid,opt_palette){if(typeof element=="string"){element=document.getElementById(element)}if(!element||!element.tagName){throw"bmp_lib.render: Invalid element: "+element}else if(element.tagName=="IMG"){element.src=this.imageSource(grid,opt_palette)}else if(element.tagName=="TABLE"){var data=this.tableBody(grid,opt_palette);if("outerHTML"in element){var rowCount=element.rows.length;for(var y=rowCount-1;y>=0;y--){element.deleteRow(y)}var tableTag=element.outerHTML;tableTag=tableTag.substring(0,tableTag.indexOf(">")+1);var tempDiv=document.createElement("DIV");tempDiv.innerHTML=tableTag+data+"</table>";element.parentElement.replaceChild(tempDiv.firstChild,element)}else{element.innerHTML=data}}else{throw"bmp_lib.render: Invalid HTML tag: "+element.tagName}};bmp_lib.imageSource=function(grid,opt_palette){var a=this.normalize_(grid,opt_palette);var data=this.createBmp_(a[0],a[1]);return"data:image/bmp;base64,"+this.encode64_(data)};bmp_lib.tableBody=function(grid,opt_palette){var a=this.normalize_(grid,opt_palette);grid=a[0];var palette=a[1];var height=grid.length;var width=height&&grid[0].length;var rgb;var table=[];for(var y=0;y<height;y++){row=[];for(var x=0;x<width;x++){if(palette){rgb=palette[grid[y].charCodeAt(x)]}else{rgb=grid[y][x]}var colour=this.dec2hex_(rgb[0])+this.dec2hex_(rgb[1])+this.dec2hex_(rgb[2]);row[x]="<TD BGCOLOR=#"+colour+"><img width=1 height=1></TD>"}row.unshift("<TR>");row.push("</TR>");table[y]=row.join("")}return table.join("\n")};bmp_lib.normalize_=function(grid,opt_palette){var palette;if(grid.length==0){palette=null}else if(typeof grid[0]=="string"&&opt_palette){palette=opt_palette}else if(typeof grid[0]=="object"&&typeof grid[0][0]=="number"&&opt_palette){grid=this.arrayArrayToArrayStr_(grid);palette=opt_palette}else if(typeof grid[0]=="object"&&typeof grid[0][0]=="object"&&grid[0][0].length>=3){palette=null}else{throw"Invalid argument types."}return[grid,palette]};bmp_lib.createBmp_=function(grid,palette){var bitmapFileHeader="BMxxxx\0\0\0\0yyyy";var height=grid.length;var width=height&&grid[0].length;var biHeight=this.multixbyteEncode_(height,4);var biWidth=this.multixbyteEncode_(width,4);var bfOffBits=this.multixbyteEncode_(40,4);var bitCount;if(palette&&palette.length<=256){bitCount=8}else{bitCount=24;if(palette){grid=this.depalette_(grid,palette)}palette=null}var biBitCount=this.multixbyteEncode_(bitCount,2);var bitmapInfoHeader=bfOffBits+biWidth+biHeight+"\0"+biBitCount+"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0";var rgbQuad;if(bitCount!=24){var palette_str=String(palette);if(bmp_lib.createBmp_.palette_str_cache==palette_str){rgbQuad=bmp_lib.createBmp_.rgbQuad_cache}else{rgbQuad=[];var r=0;var g=0;var b=0;for(var x=0;x<256;x++){if(x<palette.length){r=palette[x][0];g=palette[x][1];b=palette[x][2]}rgbQuad[x]=String.fromCharCode(b,g,r,0)}rgbQuad=rgbQuad.join("");bmp_lib.createBmp_.palette_str_cache=palette_str;bmp_lib.createBmp_.rgbQuad_cache=rgbQuad}}else{rgbQuad=""}var padding;if(width%4==1){padding="\0\0\0"}else if(width%4==2){padding="\0\0"}else if(width%4==3){padding="\0"}else{padding=""}if(bitCount==24){padding=padding+padding+padding}var data=[];for(var y=0;y<height;y++){var row=grid[height-y-1];if(bitCount==8){data[y]=row+padding}else if(bitCount==24){for(var x=0;x<width;x++){data.push(String.fromCharCode(row[x][2],row[x][1],row[x][0]))}data.push(padding)}}data=data.join("");var bitmap=bitmapFileHeader+bitmapInfoHeader+rgbQuad+data;bitmap=bitmap.replace(/yyyy/,this.multixbyteEncode_(bitmapFileHeader.length+bitmapInfoHeader.length+rgbQuad.length,4));bitmap=bitmap.replace(/xxxx/,this.multixbyteEncode_(bitmap.length,4));return bitmap};bmp_lib.createBmp_.palette_str_cache="";bmp_lib.createBmp_.rgbQuad_cache="";bmp_lib.multixbyteEncode_=function(number,xbytes){if(number<0||xbytes<0){throw"Negative numbers not allowed."}var oldbase=1;var string="";for(var x=0;x<xbytes;x++){var xbyte=0;if(number!=0){var base=oldbase*256;xbyte=number%base;number=number-xbyte;xbyte=xbyte/oldbase;oldbase=base}string+=String.fromCharCode(xbyte)}if(number!=0){throw"Overflow, number too big for string length"}return string};bmp_lib.arrayArrayToArrayStr_=function(arrayArray){var arrayStr=Array(arrayArray.length);for(var y=0;y<arrayArray.length;y++){line=[];for(var x=0;x<arrayArray[y].length;x++){line[x]=String.fromCharCode(arrayArray[y][x])}arrayStr[y]=line.join("")}return arrayStr};bmp_lib.depalette_=function(oldGrid,palette){var newGrid=Array(oldGrid.length);for(var y=0;y<oldGrid.length;y++){newGrid[y]=[];for(var x=0;x<oldGrid[y].length;x++){newGrid[y][x]=palette[oldGrid[y].charCodeAt(x)]}}return newGrid};bmp_lib.dec2hex_=function(decimal){var a=decimal%16;var b=(decimal-a)/16;return bmp_lib.dec2hex_.hexChars.charAt(b)+bmp_lib.dec2hex_.hexChars.charAt(a)};bmp_lib.dec2hex_.hexChars="0123456789ABCDEF";bmp_lib.encode64_=function(input){var output="";var i=0;do{var chr1=input.charCodeAt(i++);var chr2=input.charCodeAt(i++);var chr3=input.charCodeAt(i++);var enc1=chr1>>2;var enc2=(chr1&3)<<4|chr2>>4;var enc3=(chr2&15)<<2|chr3>>6;var enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else if(isNaN(chr3)){enc4=64}output=output+bmp_lib.encode64_.keyStr.charAt(enc1)+bmp_lib.encode64_.keyStr.charAt(enc2)+bmp_lib.encode64_.keyStr.charAt(enc3)+bmp_lib.encode64_.keyStr.charAt(enc4)}while(i<input.length);return output};bmp_lib.encode64_.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";if("btoa"in window&&typeof window.btoa=="function"&&window.btoa("hello")=="aGVsbG8="){bmp_lib.encode64_=function(input){return window.btoa(input)}}var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var canvas=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(canvas.getContext("webgl")||canvas.getContext("experimental-webgl")))}catch(e){return false}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var element=document.createElement("div");element.id="webgl-error-message";element.style.fontFamily="monospace";element.style.fontSize="13px";element.style.fontWeight="normal";element.style.textAlign="center";element.style.background="#fff";element.style.color="#000";element.style.padding="1.5em";element.style.width="400px";element.style.margin="5em auto 0";if(!this.webgl){element.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")}return element},addGetWebGLMessage:function(parameters){var parent,id,element;parameters=parameters||{};parent=parameters.parent!==undefined?parameters.parent:document.body;id=parameters.id!==undefined?parameters.id:"oldie";element=Detector.getWebGLErrorMessage();element.id=id;parent.appendChild(element)}};if(typeof module==="object"){module.exports=Detector}(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.GIF=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Uncaught, unspecified "error" event. ('+er+")");err.context=er;throw err}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-- >0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],2:[function(require,module,exports){var UA,browser,mode,platform,ua;ua=navigator.userAgent.toLowerCase();platform=navigator.platform.toLowerCase();UA=ua.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0];mode=UA[1]==="ie"&&document.documentMode;browser={name:UA[1]==="version"?UA[3]:UA[1],version:mode||parseFloat(UA[1]==="opera"&&UA[4]?UA[4]:UA[2]),platform:{name:ua.match(/ip(?:ad|od|hone)/)?"ios":(ua.match(/(?:webos|android)/)||platform.match(/mac|win|linux/)||["other"])[0]}};browser[browser.name]=true;browser[browser.name+parseInt(browser.version,10)]=true;browser.platform[browser.platform.name]=true;module.exports=browser},{}],3:[function(require,module,exports){var EventEmitter,GIF,browser,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1},slice=[].slice;EventEmitter=require("events").EventEmitter;browser=require("./browser.coffee");GIF=function(superClass){var defaults,frameDefaults;extend(GIF,superClass);defaults={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:false,dither:false};frameDefaults={delay:500,copy:false};function GIF(options){var base,key,value;this.running=false;this.options={};this.frames=[];this.freeWorkers=[];this.activeWorkers=[];this.setOptions(options);for(key in defaults){value=defaults[key];if((base=this.options)[key]==null){base[key]=value}}}GIF.prototype.setOption=function(key,value){this.options[key]=value;if(this._canvas!=null&&(key==="width"||key==="height")){return this._canvas[key]=value}};GIF.prototype.setOptions=function(options){var key,results,value;results=[];for(key in options){if(!hasProp.call(options,key))continue;value=options[key];results.push(this.setOption(key,value))}return results};GIF.prototype.addFrame=function(image,options){var frame,key;if(options==null){options={}}frame={};frame.transparent=this.options.transparent;for(key in frameDefaults){frame[key]=options[key]||frameDefaults[key]}if(this.options.width==null){this.setOption("width",image.width)}if(this.options.height==null){this.setOption("height",image.height)}if(typeof ImageData!=="undefined"&&ImageData!==null&&image instanceof ImageData){frame.data=image.data}else if(typeof CanvasRenderingContext2D!=="undefined"&&CanvasRenderingContext2D!==null&&image instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext!=="undefined"&&WebGLRenderingContext!==null&&image instanceof WebGLRenderingContext){if(options.copy){frame.data=this.getContextData(image)}else{frame.context=image}}else if(image.childNodes!=null){if(options.copy){frame.data=this.getImageData(image)}else{frame.image=image}}else{throw new Error("Invalid image")}return this.frames.push(frame)};GIF.prototype.render=function(){var i,j,numWorkers,ref;if(this.running){throw new Error("Already running")}if(this.options.width==null||this.options.height==null){throw new Error("Width and height must be set prior to rendering")}this.running=true;this.nextFrame=0;this.finishedFrames=0;this.imageParts=function(){var j,ref,results;results=[];for(i=j=0,ref=this.frames.length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){results.push(null)}return results}.call(this);numWorkers=this.spawnWorkers();if(this.options.globalPalette===true){this.renderNextFrame()}else{for(i=j=0,ref=numWorkers;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){this.renderNextFrame()}}this.emit("start");return this.emit("progress",0)};GIF.prototype.abort=function(){var worker;while(true){worker=this.activeWorkers.shift();if(worker==null){break}this.log("killing active worker");worker.terminate()}this.running=false;return this.emit("abort")};GIF.prototype.spawnWorkers=function(){var j,numWorkers,ref,results;numWorkers=Math.min(this.options.workers,this.frames.length);(function(){results=[];for(var j=ref=this.freeWorkers.length;ref<=numWorkers?j<numWorkers:j>numWorkers;ref<=numWorkers?j++:j--){results.push(j)}return results}).apply(this).forEach(function(_this){return function(i){var worker;_this.log("spawning worker "+i);worker=new Worker(_this.options.workerScript);worker.onmessage=function(event){_this.activeWorkers.splice(_this.activeWorkers.indexOf(worker),1);_this.freeWorkers.push(worker);return _this.frameFinished(event.data)};return _this.freeWorkers.push(worker)}}(this));return numWorkers};GIF.prototype.frameFinished=function(frame){var i,j,ref;this.log("frame "+frame.index+" finished - "+this.activeWorkers.length+" active");this.finishedFrames++;this.emit("progress",this.finishedFrames/this.frames.length);this.imageParts[frame.index]=frame;if(this.options.globalPalette===true){this.options.globalPalette=frame.globalPalette;this.log("global palette analyzed");if(this.frames.length>2){for(i=j=1,ref=this.freeWorkers.length;1<=ref?j<ref:j>ref;i=1<=ref?++j:--j){this.renderNextFrame()}}}if(indexOf.call(this.imageParts,null)>=0){return this.renderNextFrame()}else{return this.finishRendering()}};GIF.prototype.finishRendering=function(){var data,frame,i,image,j,k,l,len,len1,len2,len3,offset,page,ref,ref1,ref2;len=0;ref=this.imageParts;for(j=0,len1=ref.length;j<len1;j++){frame=ref[j];len+=(frame.data.length-1)*frame.pageSize+frame.cursor}len+=frame.pageSize-frame.cursor;this.log("rendering finished - filesize "+Math.round(len/1e3)+"kb");data=new Uint8Array(len);offset=0;ref1=this.imageParts;for(k=0,len2=ref1.length;k<len2;k++){frame=ref1[k];ref2=frame.data;for(i=l=0,len3=ref2.length;l<len3;i=++l){page=ref2[i];data.set(page,offset);if(i===frame.data.length-1){offset+=frame.cursor}else{offset+=frame.pageSize}}}image=new Blob([data],{type:"image/gif"});return this.emit("finished",image,data)};GIF.prototype.renderNextFrame=function(){var frame,task,worker;if(this.freeWorkers.length===0){throw new Error("No free workers")}if(this.nextFrame>=this.frames.length){return}frame=this.frames[this.nextFrame++];worker=this.freeWorkers.shift();task=this.getTask(frame);this.log("starting frame "+(task.index+1)+" of "+this.frames.length);this.activeWorkers.push(worker);return worker.postMessage(task)};GIF.prototype.getContextData=function(ctx){return ctx.getImageData(0,0,this.options.width,this.options.height).data};GIF.prototype.getImageData=function(image){var ctx;if(this._canvas==null){this._canvas=document.createElement("canvas");this._canvas.width=this.options.width;this._canvas.height=this.options.height}ctx=this._canvas.getContext("2d");ctx.setFill=this.options.background;ctx.fillRect(0,0,this.options.width,this.options.height);ctx.drawImage(image,0,0);return this.getContextData(ctx)};GIF.prototype.getTask=function(frame){var index,task;index=this.frames.indexOf(frame);task={index:index,last:index===this.frames.length-1,delay:frame.delay,transparent:frame.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:browser.name==="chrome"};if(frame.data!=null){task.data=frame.data}else if(frame.context!=null){task.data=this.getContextData(frame.context)}else if(frame.image!=null){task.data=this.getImageData(frame.image)}else{throw new Error("Invalid frame")}return task};GIF.prototype.log=function(){var args;args=1<=arguments.length?slice.call(arguments,0):[];if(!this.options.debug){return}return console.log.apply(console,args)};return GIF}(EventEmitter);module.exports=GIF},{"./browser.coffee":2,events:1}]},{},[3])(3)});(function(){"use strict";function setup($){$.fn._fadeIn=$.fn.fadeIn;var noOp=$.noop||function(){};var msie=/MSIE/.test(navigator.userAgent);var ie6=/MSIE 6.0/.test(navigator.userAgent)&&!/MSIE 8.0/.test(navigator.userAgent);var mode=document.documentMode||0;var setExpr=$.isFunction(document.createElement("div").style.setExpression);$.blockUI=function(opts){install(window,opts)};$.unblockUI=function(opts){remove(window,opts)};$.growlUI=function(title,message,timeout,onClose){var $m=$('<div class="growlUI"></div>');if(title)$m.append("<h1>"+title+"</h1>");if(message)$m.append("<h2>"+message+"</h2>");if(timeout===undefined)timeout=3e3;var callBlock=function(opts){opts=opts||{};$.blockUI({message:$m,fadeIn:typeof opts.fadeIn!=="undefined"?opts.fadeIn:700,fadeOut:typeof opts.fadeOut!=="undefined"?opts.fadeOut:1e3,timeout:typeof opts.timeout!=="undefined"?opts.timeout:timeout,centerY:false,showOverlay:false,onUnblock:onClose,css:$.blockUI.defaults.growlCSS})};callBlock();var nonmousedOpacity=$m.css("opacity");$m.mouseover(function(){callBlock({fadeIn:0,timeout:3e4});var displayBlock=$(".blockMsg");displayBlock.stop();displayBlock.fadeTo(300,1)}).mouseout(function(){$(".blockMsg").fadeOut(1e3)})};$.fn.block=function(opts){if(this[0]===window){$.blockUI(opts);return this}var fullOpts=$.extend({},$.blockUI.defaults,opts||{});this.each(function(){var $el=$(this);if(fullOpts.ignoreIfBlocked&&$el.data("blockUI.isBlocked"))return;$el.unblock({fadeOut:0})});return this.each(function(){if($.css(this,"position")=="static"){this.style.position="relative";$(this).data("blockUI.static",true)}this.style.zoom=1;install(this,opts)})};$.fn.unblock=function(opts){if(this[0]===window){$.unblockUI(opts);return this}return this.each(function(){remove(this,opts)})};$.blockUI.version=2.7;$.blockUI.defaults={message:"<h1>Please wait...</h1>",title:null,draggable:true,theme:false,css:{padding:0,margin:0,width:"30%",top:"40%",left:"35%",textAlign:"center",color:"#000",border:"3px solid #aaa",backgroundColor:"#fff",cursor:"wait"},themedCSS:{width:"30%",top:"40%",left:"35%"},overlayCSS:{backgroundColor:"#000",opacity:.6,cursor:"wait"},cursorReset:"default",growlCSS:{width:"350px",top:"10px",left:"",right:"10px",border:"none",padding:"5px",opacity:.6,cursor:"default",color:"#fff",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px"},iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank",forceIframe:false,baseZ:1e3,centerX:true,centerY:true,allowBodyStretch:true,bindEvents:true,constrainTabKey:true,fadeIn:200,fadeOut:400,timeout:0,showOverlay:true,focusInput:true,focusableElements:":input:enabled:visible",onBlock:null,onUnblock:null,onOverlayClick:null,quirksmodeOffsetHack:4,blockMsgClass:"blockMsg",ignoreIfBlocked:false};var pageBlock=null;var pageBlockEls=[];function install(el,opts){var css,themedCSS;var full=el==window;var msg=opts&&opts.message!==undefined?opts.message:undefined;opts=$.extend({},$.blockUI.defaults,opts||{});if(opts.ignoreIfBlocked&&$(el).data("blockUI.isBlocked"))return;opts.overlayCSS=$.extend({},$.blockUI.defaults.overlayCSS,opts.overlayCSS||{});css=$.extend({},$.blockUI.defaults.css,opts.css||{});if(opts.onOverlayClick)opts.overlayCSS.cursor="pointer";themedCSS=$.extend({},$.blockUI.defaults.themedCSS,opts.themedCSS||{});msg=msg===undefined?opts.message:msg;if(full&&pageBlock)remove(window,{fadeOut:0});if(msg&&typeof msg!="string"&&(msg.parentNode||msg.jquery)){var node=msg.jquery?msg[0]:msg;var data={};$(el).data("blockUI.history",data);data.el=node;data.parent=node.parentNode;data.display=node.style.display;data.position=node.style.position;if(data.parent)data.parent.removeChild(node)}$(el).data("blockUI.onUnblock",opts.onUnblock);var z=opts.baseZ;var lyr1,lyr2,lyr3,s;if(msie||opts.forceIframe)lyr1=$('<iframe class="blockUI" style="z-index:'+z+++';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+opts.iframeSrc+'"></iframe>');else lyr1=$('<div class="blockUI" style="display:none"></div>');if(opts.theme)lyr2=$('<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:'+z+++';display:none"></div>');else lyr2=$('<div class="blockUI blockOverlay" style="z-index:'+z+++';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>');if(opts.theme&&full){s='<div class="blockUI '+opts.blockMsgClass+' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+(z+10)+';display:none;position:fixed">';if(opts.title){s+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||"&nbsp;")+"</div>"}s+='<div class="ui-widget-content ui-dialog-content"></div>';s+="</div>"}else if(opts.theme){s='<div class="blockUI '+opts.blockMsgClass+' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+(z+10)+';display:none;position:absolute">';if(opts.title){s+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||"&nbsp;")+"</div>"}s+='<div class="ui-widget-content ui-dialog-content"></div>';s+="</div>"}else if(full){s='<div class="blockUI '+opts.blockMsgClass+' blockPage" style="z-index:'+(z+10)+';display:none;position:fixed"></div>'}else{s='<div class="blockUI '+opts.blockMsgClass+' blockElement" style="z-index:'+(z+10)+';display:none;position:absolute"></div>'}lyr3=$(s);if(msg){if(opts.theme){lyr3.css(themedCSS);lyr3.addClass("ui-widget-content")}else lyr3.css(css)}if(!opts.theme)lyr2.css(opts.overlayCSS);lyr2.css("position",full?"fixed":"absolute");if(msie||opts.forceIframe)lyr1.css("opacity",0);var layers=[lyr1,lyr2,lyr3],$par=full?$("body"):$(el);$.each(layers,function(){this.appendTo($par)});if(opts.theme&&opts.draggable&&$.fn.draggable){lyr3.draggable({handle:".ui-dialog-titlebar",cancel:"li"})}var expr=setExpr&&(!$.support.boxModel||$("object,embed",full?null:el).length>0);if(ie6||expr){if(full&&opts.allowBodyStretch&&$.support.boxModel)$("html,body").css("height","100%");if((ie6||!$.support.boxModel)&&!full){var t=sz(el,"borderTopWidth"),l=sz(el,"borderLeftWidth");var fixT=t?"(0 - "+t+")":0;var fixL=l?"(0 - "+l+")":0}$.each(layers,function(i,o){var s=o[0].style;s.position="absolute";if(i<2){if(full)s.setExpression("height","Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.support.boxModel?0:"+opts.quirksmodeOffsetHack+') + "px"');else s.setExpression("height",'this.parentNode.offsetHeight + "px"');if(full)s.setExpression("width",'jQuery.support.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"');else s.setExpression("width",'this.parentNode.offsetWidth + "px"');if(fixL)s.setExpression("left",fixL);if(fixT)s.setExpression("top",fixT)}else if(opts.centerY){if(full)s.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"');s.marginTop=0}else if(!opts.centerY&&full){var top=opts.css&&opts.css.top?parseInt(opts.css.top,10):0;var expression="((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+top+') + "px"';s.setExpression("top",expression)}})}if(msg){if(opts.theme)lyr3.find(".ui-widget-content").append(msg);else lyr3.append(msg);if(msg.jquery||msg.nodeType)$(msg).show()}if((msie||opts.forceIframe)&&opts.showOverlay)lyr1.show();if(opts.fadeIn){var cb=opts.onBlock?opts.onBlock:noOp;var cb1=opts.showOverlay&&!msg?cb:noOp;var cb2=msg?cb:noOp;if(opts.showOverlay)lyr2._fadeIn(opts.fadeIn,cb1);if(msg)lyr3._fadeIn(opts.fadeIn,cb2)}else{if(opts.showOverlay)lyr2.show();if(msg)lyr3.show();if(opts.onBlock)opts.onBlock.bind(lyr3)()}bind(1,el,opts);if(full){pageBlock=lyr3[0];pageBlockEls=$(opts.focusableElements,pageBlock);if(opts.focusInput)setTimeout(focus,20)}else center(lyr3[0],opts.centerX,opts.centerY);if(opts.timeout){var to=setTimeout(function(){if(full)$.unblockUI(opts);else $(el).unblock(opts)},opts.timeout);$(el).data("blockUI.timeout",to)}}function remove(el,opts){var count;var full=el==window;var $el=$(el);var data=$el.data("blockUI.history");var to=$el.data("blockUI.timeout");if(to){clearTimeout(to);$el.removeData("blockUI.timeout")}opts=$.extend({},$.blockUI.defaults,opts||{});bind(0,el,opts);if(opts.onUnblock===null){opts.onUnblock=$el.data("blockUI.onUnblock");$el.removeData("blockUI.onUnblock")}var els;if(full)els=$("body").children().filter(".blockUI").add("body > .blockUI");else els=$el.find(">.blockUI");if(opts.cursorReset){if(els.length>1)els[1].style.cursor=opts.cursorReset;if(els.length>2)els[2].style.cursor=opts.cursorReset}if(full)pageBlock=pageBlockEls=null;if(opts.fadeOut){count=els.length;els.stop().fadeOut(opts.fadeOut,function(){if(--count===0)reset(els,data,opts,el)})}else reset(els,data,opts,el)}function reset(els,data,opts,el){var $el=$(el);if($el.data("blockUI.isBlocked"))return;els.each(function(i,o){if(this.parentNode)this.parentNode.removeChild(this)});if(data&&data.el){data.el.style.display=data.display;data.el.style.position=data.position;data.el.style.cursor="default";if(data.parent)data.parent.appendChild(data.el);$el.removeData("blockUI.history")}if($el.data("blockUI.static")){$el.css("position","static")}if(typeof opts.onUnblock=="function")opts.onUnblock(el,opts);var body=$(document.body),w=body.width(),cssW=body[0].style.width;body.width(w-1).width(w);body[0].style.width=cssW}function bind(b,el,opts){var full=el==window,$el=$(el);if(!b&&(full&&!pageBlock||!full&&!$el.data("blockUI.isBlocked")))return;$el.data("blockUI.isBlocked",b);if(!full||!opts.bindEvents||b&&!opts.showOverlay)return;var events="mousedown mouseup keydown keypress keyup touchstart touchend touchmove";if(b)$(document).bind(events,opts,handler);else $(document).unbind(events,handler)}function handler(e){if(e.type==="keydown"&&e.keyCode&&e.keyCode==9){if(pageBlock&&e.data.constrainTabKey){var els=pageBlockEls;var fwd=!e.shiftKey&&e.target===els[els.length-1];var back=e.shiftKey&&e.target===els[0];if(fwd||back){setTimeout(function(){focus(back)},10);return false}}}var opts=e.data;var target=$(e.target);if(target.hasClass("blockOverlay")&&opts.onOverlayClick)opts.onOverlayClick(e);if(target.parents("div."+opts.blockMsgClass).length>0)return true;return target.parents().children().filter("div.blockUI").length===0}function focus(back){if(!pageBlockEls)return;var e=pageBlockEls[back===true?pageBlockEls.length-1:0];if(e)e.focus()}function center(el,x,y){var p=el.parentNode,s=el.style;var l=(p.offsetWidth-el.offsetWidth)/2-sz(p,"borderLeftWidth");var t=(p.offsetHeight-el.offsetHeight)/2-sz(p,"borderTopWidth");if(x)s.left=l>0?l+"px":"0";if(y)s.top=t>0?t+"px":"0"}function sz(el,p){return parseInt($.css(el,p),10)||0}}if(typeof define==="function"&&define.amd&&define.amd.jQuery){define(["jquery"],setup)}else{setup(jQuery)}})();(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else if(typeof exports==="object"){factory(require("jquery"))}else{factory(jQuery)}})(function($){"use strict";$.support.htmlMenuitem="HTMLMenuItemElement"in window;$.support.htmlCommand="HTMLCommandElement"in window;$.support.eventSelectstart="onselectstart"in document.documentElement;if(!$.ui||!$.widget){$.cleanData=function(orig){return function(elems){var events,elem,i;for(i=0;elems[i]!=null;i++){elem=elems[i];try{events=$._data(elem,"events");if(events&&events.remove){$(elem).triggerHandler("remove")}}catch(e){}}orig(elems)}}($.cleanData)}var $currentTrigger=null,initialized=false,$win=$(window),counter=0,namespaces={},menus={},types={},defaults={selector:null,appendTo:null,trigger:"right",autoHide:false,delay:200,reposition:true,selectableSubMenu:false,classNames:{hover:"context-menu-hover",disabled:"context-menu-disabled",visible:"context-menu-visible",notSelectable:"context-menu-not-selectable",icon:"context-menu-icon",iconEdit:"context-menu-icon-edit",iconCut:"context-menu-icon-cut",iconCopy:"context-menu-icon-copy",iconPaste:"context-menu-icon-paste",iconDelete:"context-menu-icon-delete",iconAdd:"context-menu-icon-add",iconQuit:"context-menu-icon-quit",iconLoadingClass:"context-menu-icon-loading"},determinePosition:function($menu){if($.ui&&$.ui.position){$menu.css("display","block").position({my:"center top",at:"center bottom",of:this,offset:"0 5",collision:"fit"}).css("display","none")}else{var offset=this.offset();offset.top+=this.outerHeight();offset.left+=this.outerWidth()/2-$menu.outerWidth()/2;$menu.css(offset)}},position:function(opt,x,y){var offset;if(!x&&!y){opt.determinePosition.call(this,opt.$menu);return}else if(x==="maintain"&&y==="maintain"){offset=opt.$menu.position()}else{var offsetParentOffset=opt.$menu.offsetParent().offset();offset={top:y-offsetParentOffset.top,left:x-offsetParentOffset.left}}var bottom=$win.scrollTop()+$win.height(),right=$win.scrollLeft()+$win.width(),height=opt.$menu.outerHeight(),width=opt.$menu.outerWidth();if(offset.top+height>bottom){offset.top-=height}if(offset.top<0){offset.top=0}if(offset.left+width>right){offset.left-=width}if(offset.left<0){offset.left=0}opt.$menu.css(offset)},positionSubmenu:function($menu){if(typeof $menu==="undefined"){return}if($.ui&&$.ui.position){$menu.css("display","block").position({my:"left top-5",at:"right top",of:this,collision:"flipfit fit"}).css("display","")}else{var offset={top:-9,left:this.outerWidth()-5};$menu.css(offset)}},zIndex:1,animation:{duration:50,show:"slideDown",hide:"slideUp"},events:{show:$.noop,hide:$.noop},callback:null,items:{}},hoveract={timer:null,pageX:null,pageY:null},zindex=function($t){var zin=0,$tt=$t;while(true){zin=Math.max(zin,parseInt($tt.css("z-index"),10)||0);$tt=$tt.parent();if(!$tt||!$tt.length||"html body".indexOf($tt.prop("nodeName").toLowerCase())>-1){break}}return zin},handle={abortevent:function(e){e.preventDefault();e.stopImmediatePropagation()},contextmenu:function(e){var $this=$(this);if(e.data.trigger==="right"){e.preventDefault();e.stopImmediatePropagation()}if(e.data.trigger!=="right"&&e.data.trigger!=="demand"&&e.originalEvent){return}if(typeof e.mouseButton!=="undefined"&&e.data){if(!(e.data.trigger==="left"&&e.mouseButton===0)&&!(e.data.trigger==="right"&&e.mouseButton===2)){return}}if($this.hasClass("context-menu-active")){return}if(!$this.hasClass("context-menu-disabled")){$currentTrigger=$this;if(e.data.build){var built=e.data.build($currentTrigger,e);if(built===false){return}e.data=$.extend(true,{},defaults,e.data,built||{});if(!e.data.items||$.isEmptyObject(e.data.items)){if(window.console){(console.error||console.log).call(console,"No items specified to show in contextMenu")}throw new Error("No Items specified")}e.data.$trigger=$currentTrigger;op.create(e.data)}var showMenu=false;for(var item in e.data.items){if(e.data.items.hasOwnProperty(item)){var visible;if($.isFunction(e.data.items[item].visible)){visible=e.data.items[item].visible.call($(e.currentTarget),item,e.data)}else if(typeof e.data.items[item]!=="undefined"&&e.data.items[item].visible){visible=e.data.items[item].visible===true}else{visible=true}if(visible){showMenu=true}}}if(showMenu){op.show.call($this,e.data,e.pageX,e.pageY)}}},click:function(e){e.preventDefault();e.stopImmediatePropagation();$(this).trigger($.Event("contextmenu",{data:e.data,pageX:e.pageX,pageY:e.pageY}))},mousedown:function(e){var $this=$(this);if($currentTrigger&&$currentTrigger.length&&!$currentTrigger.is($this)){$currentTrigger.data("contextMenu").$menu.trigger("contextmenu:hide")}if(e.button===2){$currentTrigger=$this.data("contextMenuActive",true)}},mouseup:function(e){var $this=$(this);if($this.data("contextMenuActive")&&$currentTrigger&&$currentTrigger.length&&$currentTrigger.is($this)&&!$this.hasClass("context-menu-disabled")){e.preventDefault();e.stopImmediatePropagation();$currentTrigger=$this;$this.trigger($.Event("contextmenu",{data:e.data,pageX:e.pageX,pageY:e.pageY}))}$this.removeData("contextMenuActive")},mouseenter:function(e){var $this=$(this),$related=$(e.relatedTarget),$document=$(document);if($related.is(".context-menu-list")||$related.closest(".context-menu-list").length){return}if($currentTrigger&&$currentTrigger.length){return}hoveract.pageX=e.pageX;hoveract.pageY=e.pageY;hoveract.data=e.data;$document.on("mousemove.contextMenuShow",handle.mousemove);hoveract.timer=setTimeout(function(){hoveract.timer=null;$document.off("mousemove.contextMenuShow");$currentTrigger=$this;$this.trigger($.Event("contextmenu",{data:hoveract.data,pageX:hoveract.pageX,pageY:hoveract.pageY}))},e.data.delay)},mousemove:function(e){hoveract.pageX=e.pageX;hoveract.pageY=e.pageY},mouseleave:function(e){var $related=$(e.relatedTarget);if($related.is(".context-menu-list")||$related.closest(".context-menu-list").length){return}try{clearTimeout(hoveract.timer)}catch(e){}hoveract.timer=null},layerClick:function(e){var $this=$(this),root=$this.data("contextMenuRoot"),button=e.button,x=e.pageX,y=e.pageY,target,offset;e.preventDefault();setTimeout(function(){var $window;var triggerAction=root.trigger==="left"&&button===0||root.trigger==="right"&&button===2;if(document.elementFromPoint&&root.$layer){root.$layer.hide();target=document.elementFromPoint(x-$win.scrollLeft(),y-$win.scrollTop());if(target.isContentEditable){var range=document.createRange(),sel=window.getSelection();range.selectNode(target);range.collapse(true);sel.removeAllRanges();sel.addRange(range)}$(target).trigger(e);root.$layer.show()}if(root.reposition&&triggerAction){if(document.elementFromPoint){if(root.$trigger.is(target)){root.position.call(root.$trigger,root,x,y);return}}else{offset=root.$trigger.offset();$window=$(window);offset.top+=$window.scrollTop();if(offset.top<=e.pageY){offset.left+=$window.scrollLeft();if(offset.left<=e.pageX){offset.bottom=offset.top+root.$trigger.outerHeight();if(offset.bottom>=e.pageY){offset.right=offset.left+root.$trigger.outerWidth();if(offset.right>=e.pageX){root.position.call(root.$trigger,root,x,y);return}}}}}}if(target&&triggerAction){root.$trigger.one("contextmenu:hidden",function(){$(target).contextMenu({x:x,y:y,button:button})})}if(root!==null&&typeof root!=="undefined"&&root.$menu!==null&&typeof root.$menu!=="undefined"){root.$menu.trigger("contextmenu:hide")}},50)},keyStop:function(e,opt){if(!opt.isInput){e.preventDefault()}e.stopPropagation()},key:function(e){var opt={};if($currentTrigger){opt=$currentTrigger.data("contextMenu")||{}}if(typeof opt.zIndex==="undefined"){opt.zIndex=0}var targetZIndex=0;var getZIndexOfTriggerTarget=function(target){if(target.style.zIndex!==""){targetZIndex=target.style.zIndex}else{if(target.offsetParent!==null&&typeof target.offsetParent!=="undefined"){getZIndexOfTriggerTarget(target.offsetParent)}else if(target.parentElement!==null&&typeof target.parentElement!=="undefined"){getZIndexOfTriggerTarget(target.parentElement)}}};getZIndexOfTriggerTarget(e.target);if(opt.$menu&&parseInt(targetZIndex,10)>parseInt(opt.$menu.css("zIndex"),10)){return}switch(e.keyCode){case 9:case 38:handle.keyStop(e,opt);if(opt.isInput){if(e.keyCode===9&&e.shiftKey){e.preventDefault();if(opt.$selected){opt.$selected.find("input, textarea, select").blur()}if(opt.$menu!==null&&typeof opt.$menu!=="undefined"){opt.$menu.trigger("prevcommand")}return}else if(e.keyCode===38&&opt.$selected.find("input, textarea, select").prop("type")==="checkbox"){e.preventDefault();return}}else if(e.keyCode!==9||e.shiftKey){if(opt.$menu!==null&&typeof opt.$menu!=="undefined"){opt.$menu.trigger("prevcommand")}return}break;case 40:handle.keyStop(e,opt);if(opt.isInput){if(e.keyCode===9){e.preventDefault();if(opt.$selected){opt.$selected.find("input, textarea, select").blur()}if(opt.$menu!==null&&typeof opt.$menu!=="undefined"){opt.$menu.trigger("nextcommand")}return}else if(e.keyCode===40&&opt.$selected.find("input, textarea, select").prop("type")==="checkbox"){e.preventDefault();return}}else{if(opt.$menu!==null&&typeof opt.$menu!=="undefined"){opt.$menu.trigger("nextcommand")}return}break;case 37:handle.keyStop(e,opt);if(opt.isInput||!opt.$selected||!opt.$selected.length){break}if(!opt.$selected.parent().hasClass("context-menu-root")){var $parent=opt.$selected.parent().parent();opt.$selected.trigger("contextmenu:blur");opt.$selected=$parent;return}break;case 39:handle.keyStop(e,opt);if(opt.isInput||!opt.$selected||!opt.$selected.length){break}var itemdata=opt.$selected.data("contextMenu")||{};if(itemdata.$menu&&opt.$selected.hasClass("context-menu-submenu")){opt.$selected=null;itemdata.$selected=null;itemdata.$menu.trigger("nextcommand");return}break;case 35:case 36:if(opt.$selected&&opt.$selected.find("input, textarea, select").length){return}else{(opt.$selected&&opt.$selected.parent()||opt.$menu).children(":not(."+opt.classNames.disabled+", ."+opt.classNames.notSelectable+")")[e.keyCode===36?"first":"last"]().trigger("contextmenu:focus");e.preventDefault();return}break;case 13:handle.keyStop(e,opt);if(opt.isInput){if(opt.$selected&&!opt.$selected.is("textarea, select")){e.preventDefault();return}break}if(typeof opt.$selected!=="undefined"&&opt.$selected!==null){opt.$selected.trigger("mouseup")}return;case 32:case 33:case 34:handle.keyStop(e,opt);return;case 27:handle.keyStop(e,opt);if(opt.$menu!==null&&typeof opt.$menu!=="undefined"){opt.$menu.trigger("contextmenu:hide")}return;default:var k=String.fromCharCode(e.keyCode).toUpperCase();if(opt.accesskeys&&opt.accesskeys[k]){opt.accesskeys[k].$node.trigger(opt.accesskeys[k].$menu?"contextmenu:focus":"mouseup");return}break}e.stopPropagation();if(typeof opt.$selected!=="undefined"&&opt.$selected!==null){opt.$selected.trigger(e)}},prevItem:function(e){e.stopPropagation();var opt=$(this).data("contextMenu")||{};var root=$(this).data("contextMenuRoot")||{};if(opt.$selected){var $s=opt.$selected;opt=opt.$selected.parent().data("contextMenu")||{};opt.$selected=$s}var $children=opt.$menu.children(),$prev=!opt.$selected||!opt.$selected.prev().length?$children.last():opt.$selected.prev(),$round=$prev;while($prev.hasClass(root.classNames.disabled)||$prev.hasClass(root.classNames.notSelectable)||$prev.is(":hidden")){if($prev.prev().length){$prev=$prev.prev()}else{$prev=$children.last()}if($prev.is($round)){return}}if(opt.$selected){handle.itemMouseleave.call(opt.$selected.get(0),e)}handle.itemMouseenter.call($prev.get(0),e);var $input=$prev.find("input, textarea, select");if($input.length){$input.focus()}},nextItem:function(e){e.stopPropagation();var opt=$(this).data("contextMenu")||{};var root=$(this).data("contextMenuRoot")||{};if(opt.$selected){var $s=opt.$selected;opt=opt.$selected.parent().data("contextMenu")||{};opt.$selected=$s}var $children=opt.$menu.children(),$next=!opt.$selected||!opt.$selected.next().length?$children.first():opt.$selected.next(),$round=$next;while($next.hasClass(root.classNames.disabled)||$next.hasClass(root.classNames.notSelectable)||$next.is(":hidden")){if($next.next().length){$next=$next.next()}else{$next=$children.first()}if($next.is($round)){return}}if(opt.$selected){handle.itemMouseleave.call(opt.$selected.get(0),e)}handle.itemMouseenter.call($next.get(0),e);var $input=$next.find("input, textarea, select");if($input.length){$input.focus()}},focusInput:function(){var $this=$(this).closest(".context-menu-item"),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;root.$selected=opt.$selected=$this;root.isInput=opt.isInput=true},blurInput:function(){var $this=$(this).closest(".context-menu-item"),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;root.isInput=opt.isInput=false},menuMouseenter:function(){var root=$(this).data().contextMenuRoot;root.hovering=true},menuMouseleave:function(e){var root=$(this).data().contextMenuRoot;if(root.$layer&&root.$layer.is(e.relatedTarget)){root.hovering=false}},itemMouseenter:function(e){var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;root.hovering=true;if(e&&root.$layer&&root.$layer.is(e.relatedTarget)){e.preventDefault();e.stopImmediatePropagation()}(opt.$menu?opt:root).$menu.children("."+root.classNames.hover).trigger("contextmenu:blur").children(".hover").trigger("contextmenu:blur");if($this.hasClass(root.classNames.disabled)||$this.hasClass(root.classNames.notSelectable)){opt.$selected=null;return}$this.trigger("contextmenu:focus")},itemMouseleave:function(e){var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;if(root!==opt&&root.$layer&&root.$layer.is(e.relatedTarget)){if(typeof root.$selected!=="undefined"&&root.$selected!==null){root.$selected.trigger("contextmenu:blur")}e.preventDefault();e.stopImmediatePropagation();root.$selected=opt.$selected=opt.$node;return}if(opt&&opt.$menu&&opt.$menu.hasClass("context-menu-visible")){return}$this.trigger("contextmenu:blur")},itemClick:function(e){var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot,key=data.contextMenuKey,callback;if(!opt.items[key]||$this.is("."+root.classNames.disabled+", .context-menu-separator, ."+root.classNames.notSelectable)||$this.is(".context-menu-submenu")&&root.selectableSubMenu===false){return}e.preventDefault();e.stopImmediatePropagation();if($.isFunction(opt.callbacks[key])&&Object.prototype.hasOwnProperty.call(opt.callbacks,key)){callback=opt.callbacks[key]}else if($.isFunction(root.callback)){callback=root.callback}else{return}if(callback.call(root.$trigger,key,root,e)!==false){root.$menu.trigger("contextmenu:hide")}else if(root.$menu.parent().length){op.update.call(root.$trigger,root)}},inputClick:function(e){e.stopImmediatePropagation()},hideMenu:function(e,data){var root=$(this).data("contextMenuRoot");op.hide.call(root.$trigger,root,data&&data.force)},focusItem:function(e){e.stopPropagation();var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;if($this.hasClass(root.classNames.disabled)||$this.hasClass(root.classNames.notSelectable)){return}$this.addClass([root.classNames.hover,root.classNames.visible].join(" ")).parent().find(".context-menu-item").not($this).removeClass(root.classNames.visible).filter("."+root.classNames.hover).trigger("contextmenu:blur");opt.$selected=root.$selected=$this;if(opt&&opt.$node&&opt.$node.hasClass("context-menu-submenu")){opt.$node.addClass(root.classNames.hover)}if(opt.$node){root.positionSubmenu.call(opt.$node,opt.$menu)}},blurItem:function(e){e.stopPropagation();var $this=$(this),data=$this.data(),opt=data.contextMenu,root=data.contextMenuRoot;if(opt.autoHide){$this.removeClass(root.classNames.visible)}$this.removeClass(root.classNames.hover);opt.$selected=null}},op={show:function(opt,x,y){var $trigger=$(this),css={};$("#context-menu-layer").trigger("mousedown");opt.$trigger=$trigger;if(opt.events.show.call($trigger,opt)===false){$currentTrigger=null;return}op.update.call($trigger,opt);opt.position.call($trigger,opt,x,y);if(opt.zIndex){var additionalZValue=opt.zIndex;if(typeof opt.zIndex==="function"){additionalZValue=opt.zIndex.call($trigger,opt)}css.zIndex=zindex($trigger)+additionalZValue}op.layer.call(opt.$menu,opt,css.zIndex);opt.$menu.find("ul").css("zIndex",css.zIndex+1);opt.$menu.css(css)[opt.animation.show](opt.animation.duration,function(){$trigger.trigger("contextmenu:visible")});$trigger.data("contextMenu",opt).addClass("context-menu-active");$(document).off("keydown.contextMenu").on("keydown.contextMenu",handle.key);if(opt.autoHide){$(document).on("mousemove.contextMenuAutoHide",function(e){var pos=$trigger.offset();pos.right=pos.left+$trigger.outerWidth();pos.bottom=pos.top+$trigger.outerHeight();if(opt.$layer&&!opt.hovering&&(!(e.pageX>=pos.left&&e.pageX<=pos.right)||!(e.pageY>=pos.top&&e.pageY<=pos.bottom))){setTimeout(function(){if(!opt.hovering&&opt.$menu!==null&&typeof opt.$menu!=="undefined"){opt.$menu.trigger("contextmenu:hide")}},50)}})}},hide:function(opt,force){var $trigger=$(this);if(!opt){opt=$trigger.data("contextMenu")||{}}if(!force&&opt.events&&opt.events.hide.call($trigger,opt)===false){return}$trigger.removeData("contextMenu").removeClass("context-menu-active");if(opt.$layer){setTimeout(function($layer){return function(){$layer.remove()}}(opt.$layer),10);try{delete opt.$layer}catch(e){opt.$layer=null}}$currentTrigger=null;opt.$menu.find("."+opt.classNames.hover).trigger("contextmenu:blur");opt.$selected=null;opt.$menu.find("."+opt.classNames.visible).removeClass(opt.classNames.visible);$(document).off(".contextMenuAutoHide").off("keydown.contextMenu");if(opt.$menu){opt.$menu[opt.animation.hide](opt.animation.duration,function(){if(opt.build){opt.$menu.remove();$.each(opt,function(key){switch(key){case"ns":case"selector":case"build":case"trigger":return true;default:opt[key]=undefined;try{delete opt[key]}catch(e){}return true}})}setTimeout(function(){$trigger.trigger("contextmenu:hidden")},10)})}},create:function(opt,root){if(typeof root==="undefined"){root=opt}opt.$menu=$('<ul class="context-menu-list"></ul>').addClass(opt.className||"").data({contextMenu:opt,contextMenuRoot:root});$.each(["callbacks","commands","inputs"],function(i,k){opt[k]={};if(!root[k]){root[k]={}}});if(!root.accesskeys){root.accesskeys={}}function createNameNode(item){var $name=$("<span></span>");if(item._accesskey){if(item._beforeAccesskey){$name.append(document.createTextNode(item._beforeAccesskey))}$("<span></span>").addClass("context-menu-accesskey").text(item._accesskey).appendTo($name);if(item._afterAccesskey){$name.append(document.createTextNode(item._afterAccesskey))}}else{if(item.isHtmlName){if(typeof item.accesskey!=="undefined"){throw new Error("accesskeys are not compatible with HTML names and cannot be used together in the same item")}$name.html(item.name)}else{$name.text(item.name)}}return $name}$.each(opt.items,function(key,item){var $t=$('<li class="context-menu-item"></li>').addClass(item.className||""),$label=null,$input=null;$t.on("click",$.noop);if(typeof item==="string"||item.type==="cm_separator"){item={type:"cm_seperator"}}item.$node=$t.data({contextMenu:opt,contextMenuRoot:root,contextMenuKey:key});if(typeof item.accesskey!=="undefined"){var aks=splitAccesskey(item.accesskey);for(var i=0,ak;ak=aks[i];i++){if(!root.accesskeys[ak]){root.accesskeys[ak]=item;var matched=item.name.match(new RegExp("^(.*?)("+ak+")(.*)$","i"));if(matched){item._beforeAccesskey=matched[1];item._accesskey=matched[2];item._afterAccesskey=matched[3]}break}}}if(item.type&&types[item.type]){types[item.type].call($t,item,opt,root);$.each([opt,root],function(i,k){k.commands[key]=item;if($.isFunction(item.callback)&&(typeof k.callbacks[key]==="undefined"||typeof opt.type==="undefined")){k.callbacks[key]=item.callback}})}else{if(item.type==="cm_seperator"){$t.addClass("context-menu-separator "+root.classNames.notSelectable)}else if(item.type==="html"){$t.addClass("context-menu-html "+root.classNames.notSelectable)}else if(item.type==="sub"){}else if(item.type){$label=$("<label></label>").appendTo($t);createNameNode(item).appendTo($label);$t.addClass("context-menu-input");opt.hasTypes=true;$.each([opt,root],function(i,k){k.commands[key]=item;k.inputs[key]=item})}else if(item.items){item.type="sub"}switch(item.type){case"cm_seperator":break;case"text":$input=$('<input type="text" value="1" name="" />').attr("name","context-menu-input-"+key).val(item.value||"").appendTo($label);break;case"textarea":$input=$('<textarea name=""></textarea>').attr("name","context-menu-input-"+key).val(item.value||"").appendTo($label);if(item.height){$input.height(item.height)}break;case"checkbox":$input=$('<input type="checkbox" value="1" name="" />').attr("name","context-menu-input-"+key).val(item.value||"").prop("checked",!!item.selected).prependTo($label);break;case"radio":$input=$('<input type="radio" value="1" name="" />').attr("name","context-menu-input-"+item.radio).val(item.value||"").prop("checked",!!item.selected).prependTo($label);break;case"select":$input=$('<select name=""></select>').attr("name","context-menu-input-"+key).appendTo($label);if(item.options){$.each(item.options,function(value,text){$("<option></option>").val(value).text(text).appendTo($input)});$input.val(item.selected)}break;case"sub":createNameNode(item).appendTo($t);item.appendTo=item.$node;$t.data("contextMenu",item).addClass("context-menu-submenu");item.callback=null;if("function"===typeof item.items.then){op.processPromises(item,root,item.items)}else{op.create(item,root)}break;case"html":$(item.html).appendTo($t);break;default:$.each([opt,root],function(i,k){k.commands[key]=item;if($.isFunction(item.callback)&&(typeof k.callbacks[key]==="undefined"||typeof opt.type==="undefined")){k.callbacks[key]=item.callback}});createNameNode(item).appendTo($t);break}if(item.type&&item.type!=="sub"&&item.type!=="html"&&item.type!=="cm_seperator"){$input.on("focus",handle.focusInput).on("blur",handle.blurInput);if(item.events){$input.on(item.events,opt)}}if(item.icon){if($.isFunction(item.icon)){item._icon=item.icon.call(this,this,$t,key,item)}else{if(typeof item.icon==="string"&&item.icon.substring(0,3)==="fa-"){item._icon=root.classNames.icon+" "+root.classNames.icon+"--fa fa "+item.icon}else{item._icon=root.classNames.icon+" "+root.classNames.icon+"-"+item.icon}}$t.addClass(item._icon)}}item.$input=$input;item.$label=$label;$t.appendTo(opt.$menu);if(!opt.hasTypes&&$.support.eventSelectstart){$t.on("selectstart.disableTextSelect",handle.abortevent)}});if(!opt.$node){opt.$menu.css("display","none").addClass("context-menu-root")}opt.$menu.appendTo(opt.appendTo||document.body)},resize:function($menu,nested){var domMenu;$menu.css({position:"absolute",display:"block"});$menu.data("width",(domMenu=$menu.get(0)).getBoundingClientRect?Math.ceil(domMenu.getBoundingClientRect().width):$menu.outerWidth()+1);$menu.css({position:"static",minWidth:"0px",maxWidth:"100000px"});$menu.find("> li > ul").each(function(){op.resize($(this),true)});if(!nested){$menu.find("ul").addBack().css({position:"",display:"",minWidth:"",maxWidth:""}).outerWidth(function(){return $(this).data("width")})}},update:function(opt,root){var $trigger=this;if(typeof root==="undefined"){root=opt;op.resize(opt.$menu)}opt.$menu.children().each(function(){var $item=$(this),key=$item.data("contextMenuKey"),item=opt.items[key],disabled=$.isFunction(item.disabled)&&item.disabled.call($trigger,key,root)||item.disabled===true,visible;if($.isFunction(item.visible)){visible=item.visible.call($trigger,key,root)}else if(typeof item.visible!=="undefined"){visible=item.visible===true}else{visible=true}$item[visible?"show":"hide"]();$item[disabled?"addClass":"removeClass"](root.classNames.disabled);if($.isFunction(item.icon)){$item.removeClass(item._icon);item._icon=item.icon.call(this,$trigger,$item,key,item);$item.addClass(item._icon)}if(item.type){$item.find("input, select, textarea").prop("disabled",disabled);switch(item.type){case"text":case"textarea":item.$input.val(item.value||"");break;case"checkbox":case"radio":item.$input.val(item.value||"").prop("checked",!!item.selected);break;case"select":item.$input.val((item.selected===0?"0":item.selected)||"");break}}if(item.$menu){op.update.call($trigger,item,root)}})},layer:function(opt,zIndex){var $layer=opt.$layer=$('<div id="context-menu-layer"></div>').css({height:$win.height(),width:$win.width(),display:"block",position:"fixed","z-index":zIndex,top:0,left:0,opacity:0,filter:"alpha(opacity=0)","background-color":"#000"}).data("contextMenuRoot",opt).insertBefore(this).on("contextmenu",handle.abortevent).on("mousedown",handle.layerClick);if(typeof document.body.style.maxWidth==="undefined"){$layer.css({position:"absolute",height:$(document).height()})}return $layer},processPromises:function(opt,root,promise){opt.$node.addClass(root.classNames.iconLoadingClass);function completedPromise(opt,root,items){if(typeof items==="undefined"){errorPromise(undefined)}finishPromiseProcess(opt,root,items)}function errorPromise(opt,root,errorItem){if(typeof errorItem==="undefined"){errorItem={error:{name:"No items and no error item",icon:"context-menu-icon context-menu-icon-quit"}};if(window.console){(console.error||console.log).call(console,'When you reject a promise, provide an "items" object, equal to normal sub-menu items')}}else if(typeof errorItem==="string"){errorItem={error:{name:errorItem}}}finishPromiseProcess(opt,root,errorItem)}function finishPromiseProcess(opt,root,items){if(typeof root.$menu==="undefined"||!root.$menu.is(":visible")){return}opt.$node.removeClass(root.classNames.iconLoadingClass);opt.items=items;op.create(opt,root,true);op.update(opt,root);root.positionSubmenu.call(opt.$node,opt.$menu)}promise.then(completedPromise.bind(this,opt,root),errorPromise.bind(this,opt,root))}};function splitAccesskey(val){var t=val.split(/\s+/);var keys=[];for(var i=0,k;k=t[i];i++){k=k.charAt(0).toUpperCase();keys.push(k)}return keys}$.fn.contextMenu=function(operation){var $t=this,$o=operation;if(this.length>0){if(typeof operation==="undefined"){this.first().trigger("contextmenu")}else if(typeof operation.x!=="undefined"&&typeof operation.y!=="undefined"){this.first().trigger($.Event("contextmenu",{pageX:operation.x,pageY:operation.y,mouseButton:operation.button}))}else if(operation==="hide"){var $menu=this.first().data("contextMenu")?this.first().data("contextMenu").$menu:null;if($menu){$menu.trigger("contextmenu:hide")}}else if(operation==="destroy"){$.contextMenu("destroy",{context:this})}else if($.isPlainObject(operation)){operation.context=this;$.contextMenu("create",operation)}else if(operation){this.removeClass("context-menu-disabled")}else if(!operation){this.addClass("context-menu-disabled")}}else{$.each(menus,function(){if(this.selector===$t.selector){$o.data=this;$.extend($o.data,{trigger:"demand"})}});handle.contextmenu.call($o.target,$o)}return this};$.contextMenu=function(operation,options){if(typeof operation!=="string"){options=operation;operation="create"}if(typeof options==="string"){options={selector:options}}else if(typeof options==="undefined"){options={}}var o=$.extend(true,{},defaults,options||{});var $document=$(document);var $context=$document;var _hasContext=false;if(!o.context||!o.context.length){o.context=document}else{$context=$(o.context).first();o.context=$context.get(0);_hasContext=!$(o.context).is(document)}switch(operation){case"create":if(!o.selector){throw new Error("No selector specified")}if(o.selector.match(/.context-menu-(list|item|input)($|\s)/)){throw new Error('Cannot bind to selector "'+o.selector+'" as it contains a reserved className')}if(!o.build&&(!o.items||$.isEmptyObject(o.items))){throw new Error("No Items specified")}counter++;o.ns=".contextMenu"+counter;if(!_hasContext){namespaces[o.selector]=o.ns}menus[o.ns]=o;if(!o.trigger){o.trigger="right"}if(!initialized){var itemClick=o.itemClickEvent==="click"?"click.contextMenu":"mouseup.contextMenu";var contextMenuItemObj={"contextmenu:focus.contextMenu":handle.focusItem,"contextmenu:blur.contextMenu":handle.blurItem,"contextmenu.contextMenu":handle.abortevent,"mouseenter.contextMenu":handle.itemMouseenter,"mouseleave.contextMenu":handle.itemMouseleave};contextMenuItemObj[itemClick]=handle.itemClick;$document.on({"contextmenu:hide.contextMenu":handle.hideMenu,"prevcommand.contextMenu":handle.prevItem,"nextcommand.contextMenu":handle.nextItem,"contextmenu.contextMenu":handle.abortevent,"mouseenter.contextMenu":handle.menuMouseenter,"mouseleave.contextMenu":handle.menuMouseleave},".context-menu-list").on("mouseup.contextMenu",".context-menu-input",handle.inputClick).on(contextMenuItemObj,".context-menu-item");initialized=true}$context.on("contextmenu"+o.ns,o.selector,o,handle.contextmenu);if(_hasContext){$context.on("remove"+o.ns,function(){$(this).contextMenu("destroy")})}switch(o.trigger){case"hover":$context.on("mouseenter"+o.ns,o.selector,o,handle.mouseenter).on("mouseleave"+o.ns,o.selector,o,handle.mouseleave);break;case"left":$context.on("click"+o.ns,o.selector,o,handle.click);break;case"touchstart":$context.on("touchstart"+o.ns,o.selector,o,handle.click);break}if(!o.build){op.create(o)}break;case"destroy":var $visibleMenu;if(_hasContext){var context=o.context;$.each(menus,function(ns,o){if(!o){return true}if(!$(context).is(o.selector)){return true}$visibleMenu=$(".context-menu-list").filter(":visible");if($visibleMenu.length&&$visibleMenu.data().contextMenuRoot.$trigger.is($(o.context).find(o.selector))){$visibleMenu.trigger("contextmenu:hide",{force:true})}try{if(menus[o.ns].$menu){menus[o.ns].$menu.remove()}delete menus[o.ns]}catch(e){menus[o.ns]=null}$(o.context).off(o.ns);return true})}else if(!o.selector){$document.off(".contextMenu .contextMenuAutoHide");$.each(menus,function(ns,o){$(o.context).off(o.ns)});namespaces={};menus={};counter=0;initialized=false;$("#context-menu-layer, .context-menu-list").remove()}else if(namespaces[o.selector]){$visibleMenu=$(".context-menu-list").filter(":visible");if($visibleMenu.length&&$visibleMenu.data().contextMenuRoot.$trigger.is(o.selector)){$visibleMenu.trigger("contextmenu:hide",{force:true})}try{if(menus[namespaces[o.selector]].$menu){menus[namespaces[o.selector]].$menu.remove()}delete menus[namespaces[o.selector]]}catch(e){menus[namespaces[o.selector]]=null}$document.off(namespaces[o.selector])}break;case"html5":if(!$.support.htmlCommand&&!$.support.htmlMenuitem||typeof options==="boolean"&&options){$('menu[type="context"]').each(function(){if(this.id){$.contextMenu({selector:"[contextmenu="+this.id+"]",items:$.contextMenu.fromMenu(this)})}}).css("display","none")}break;default:throw new Error('Unknown operation "'+operation+'"')}return this};$.contextMenu.setInputValues=function(opt,data){if(typeof data==="undefined"){data={}}$.each(opt.inputs,function(key,item){switch(item.type){case"text":case"textarea":item.value=data[key]||"";break;case"checkbox":item.selected=data[key]?true:false;break;case"radio":item.selected=(data[item.radio]||"")===item.value;break;case"select":item.selected=data[key]||"";break}})};$.contextMenu.getInputValues=function(opt,data){if(typeof data==="undefined"){data={}}$.each(opt.inputs,function(key,item){switch(item.type){case"text":case"textarea":case"select":data[key]=item.$input.val();break;case"checkbox":data[key]=item.$input.prop("checked");break;case"radio":if(item.$input.prop("checked")){data[item.radio]=item.value}break}});return data};function inputLabel(node){return node.id&&$('label[for="'+node.id+'"]').val()||node.name}function menuChildren(items,$children,counter){if(!counter){counter=0}$children.each(function(){var $node=$(this),node=this,nodeName=this.nodeName.toLowerCase(),label,item;if(nodeName==="label"&&$node.find("input, textarea, select").length){label=$node.text();$node=$node.children().first();node=$node.get(0);nodeName=node.nodeName.toLowerCase()}switch(nodeName){case"menu":item={name:$node.attr("label"),items:{}};counter=menuChildren(item.items,$node.children(),counter);break;case"a":case"button":item={name:$node.text(),disabled:!!$node.attr("disabled"),callback:function(){return function(){$node.get(0).click()}}()};break;case"menuitem":case"command":switch($node.attr("type")){case undefined:case"command":case"menuitem":item={name:$node.attr("label"),disabled:!!$node.attr("disabled"),icon:$node.attr("icon"),callback:function(){return function(){$node.get(0).click()}}()};break;case"checkbox":item={type:"checkbox",disabled:!!$node.attr("disabled"),name:$node.attr("label"),selected:!!$node.attr("checked")};break;case"radio":item={type:"radio",disabled:!!$node.attr("disabled"),name:$node.attr("label"),radio:$node.attr("radiogroup"),value:$node.attr("id"),selected:!!$node.attr("checked")};break;default:item=undefined}break;case"hr":item="-------";break;case"input":switch($node.attr("type")){case"text":item={type:"text",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),value:$node.val()};break;case"checkbox":item={type:"checkbox",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),selected:!!$node.attr("checked")};break;case"radio":item={type:"radio",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),radio:!!$node.attr("name"),value:$node.val(),selected:!!$node.attr("checked")};break;default:item=undefined;break}break;case"select":item={type:"select",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),selected:$node.val(),options:{}};$node.children().each(function(){item.options[this.value]=$(this).text()});break;case"textarea":item={type:"textarea",name:label||inputLabel(node),disabled:!!$node.attr("disabled"),value:$node.val()};break;case"label":break;default:item={type:"html",html:$node.clone(true)};break}if(item){counter++;items["key"+counter]=item}});return counter}$.contextMenu.fromMenu=function(element){var $this=$(element),items={};menuChildren(items,$this.children());return items};$.contextMenu.defaults=defaults;$.contextMenu.types=types;$.contextMenu.handle=handle;$.contextMenu.op=op;$.contextMenu.menus=menus});(function(){var $;$=jQuery;$.widget("ui.dialogExtend",{version:"2.0.0",modes:{},options:{closable:true,dblclick:false,titlebar:false,icons:{close:"ui-icon-closethick",restore:"ui-icon-newwin"},load:null,beforeRestore:null,restore:null},_create:function(){this._state="normal";if(!$(this.element[0]).data("ui-dialog")){$.error("jQuery.dialogExtend Error : Only jQuery UI Dialog element is accepted")}this._verifyOptions();this._initStyles();this._initButtons();this._initTitleBar();this._setState("normal");this._on("load",function(e){return console.log("test",e)});return this._trigger("load")},_setState:function(state){$(this.element[0]).removeClass("ui-dialog-"+this._state).addClass("ui-dialog-"+state);return this._state=state},_verifyOptions:function(){var name,_ref,_results;if(this.options.dblclick&&!(this.options.dblclick in this.modes)){$.error("jQuery.dialogExtend Error : Invalid <dblclick> value '"+this.options.dblclick+"'");this.options.dblclick=false}if(this.options.titlebar&&((_ref=this.options.titlebar)!=="none"&&_ref!=="transparent")){$.error("jQuery.dialogExtend Error : Invalid <titlebar> value '"+this.options.titlebar+"'");this.options.titlebar=false}_results=[];for(name in this.modes){if(this["_verifyOptions_"+name]){_results.push(this["_verifyOptions_"+name]())}else{_results.push(void 0)}}return _results},_initStyles:function(){var name,style,_results;if(!$(".dialog-extend-css").length){style="";style+='<style class="dialog-extend-css" type="text/css">';style+=".ui-dialog .ui-dialog-titlebar-buttonpane>a { float: right; }";style+=".ui-dialog .ui-dialog-titlebar-restore { width: 19px; height: 18px; }";style+=".ui-dialog .ui-dialog-titlebar-restore span { display: block; margin: 1px; }";style+=".ui-dialog .ui-dialog-titlebar-restore:hover,";style+=".ui-dialog .ui-dialog-titlebar-restore:focus { padding: 0; }";style+=".ui-dialog .ui-dialog-titlebar ::selection { background-color: transparent; }";style+="</style>";$(style).appendTo("body")}_results=[];for(name in this.modes){_results.push(this["_initStyles_"+name]())}return _results},_initButtons:function(){var buttonPane,mode,name,titlebar,_ref,_this=this;titlebar=$(this.element[0]).dialog("widget").find(".ui-dialog-titlebar");buttonPane=$('<div class="ui-dialog-titlebar-buttonpane"></div>').appendTo(titlebar);buttonPane.css({position:"absolute",top:"50%",right:"0.0em","margin-top":"-10px",height:"18px"});titlebar.find(".ui-dialog-titlebar-close").css({position:"relative",float:"right",top:"auto",right:"auto",margin:0}).find(".ui-icon").removeClass("ui-icon-closethick").addClass(this.options.icons.close).end().appendTo(buttonPane).end();buttonPane.append('<span class="ui-dialog-titlebar-restore ui-corner-all ui-state-default" style="cursor:pointer; float:left"><span class="ui-icon '+this.options.icons.restore+'" title="restore">restore</span></span>').find(".ui-dialog-titlebar-restore").attr("role","button").mouseover(function(){return $(this).addClass("ui-state-hover")}).mouseout(function(){return $(this).removeClass("ui-state-hover")}).focus(function(){return $(this).addClass("ui-state-focus")}).blur(function(){return $(this).removeClass("ui-state-focus")}).end().find(".ui-dialog-titlebar-close").toggle(this.options.closable).end().find(".ui-dialog-titlebar-restore").hide().click(function(e){e.preventDefault();return _this.restore()}).end();_ref=this.modes;for(name in _ref){mode=_ref[name];this._initModuleButton(name,mode)}return titlebar.dblclick(function(evt){if(_this.options.dblclick){if(_this._state!=="normal"){return _this.restore()}else{return _this[_this.options.dblclick]()}}}).select(function(){return false})},_initModuleButton:function(name,mode){var buttonPane,_this=this;buttonPane=$(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-buttonpane");return buttonPane.append('<span class="ui-dialog-titlebar-'+name+' ui-corner-all ui-state-default" style="cursor:pointer; float:left;" title="'+name+'"><span class="ui-icon '+this.options.icons[name]+'">'+name+"</span></span>").find(".ui-dialog-titlebar-"+name).attr("role","button").mouseover(function(){return $(this).addClass("ui-state-hover")}).mouseout(function(){return $(this).removeClass("ui-state-hover")}).focus(function(){return $(this).addClass("ui-state-focus")}).blur(function(){return $(this).removeClass("ui-state-focus")}).end().find(".ui-dialog-titlebar-"+name).toggle(this.options[mode.option]).click(function(e){e.preventDefault();return _this[name]()}).end()},_initTitleBar:function(){var handle;switch(this.options.titlebar){case false:return 0;case"none":if($(this.element[0]).dialog("option","draggable")){handle=$("<div />").addClass("ui-dialog-draggable-handle").css("cursor","move").height(5);$(this.element[0]).dialog("widget").prepend(handle).draggable("option","handle",handle)}return $(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").find(".ui-dialog-title").html("&nbsp;").end().css({"background-color":"transparent","background-image":"none",border:0,position:"absolute",right:0,top:0,"z-index":9999}).end();case"transparent":return $(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").css({"background-color":"transparent","background-image":"none",border:0});default:return $.error("jQuery.dialogExtend Error : Invalid <titlebar> value '"+this.options.titlebar+"'")}},state:function(){return this._state},restore:function(){this._trigger("beforeRestore");this._restore();this._toggleButtons();return this._trigger("restore")},_restore:function(){if(this._state!=="normal"){this["_restore_"+this._state]();this._setState("normal");return $(this.element[0]).dialog("widget").focus()}},_saveSnapshot:function(){if(this._state==="normal"){this.original_config_resizable=$(this.element[0]).dialog("option","resizable");this.original_config_draggable=$(this.element[0]).dialog("option","draggable");this.original_size_height=$(this.element[0]).dialog("widget").outerHeight();this.original_size_width=$(this.element[0]).dialog("option","width");this.original_size_maxHeight=$(this.element[0]).dialog("option","maxHeight");this.original_position_mode=$(this.element[0]).dialog("widget").css("position");this.original_position_left=$(this.element[0]).dialog("widget").offset().left-$("body").scrollLeft();this.original_position_top=$(this.element[0]).dialog("widget").offset().top-$("body").scrollTop();return this.original_titlebar_wrap=$(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").css("white-space")}},_loadSnapshot:function(){return{config:{resizable:this.original_config_resizable,draggable:this.original_config_draggable},size:{height:this.original_size_height,width:this.original_size_width,maxHeight:this.original_size_maxHeight},position:{mode:this.original_position_mode,left:this.original_position_left,top:this.original_position_top},titlebar:{wrap:this.original_titlebar_wrap}}},_toggleButtons:function(newstate){var mode,name,state,_ref,_ref1,_results;state=newstate||this._state;$(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-restore").toggle(state!=="normal").css({right:"1.4em"}).end();_ref=this.modes;for(name in _ref){mode=_ref[name];$(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-"+name).toggle(state!==mode.state&&this.options[mode.option])}_ref1=this.modes;_results=[];for(name in _ref1){mode=_ref1[name];if(mode.state===state){_results.push($(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-restore").insertAfter($(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-"+name)).end())}else{_results.push(void 0)}}return _results}})}).call(this);(function(){var $;$=jQuery;$.extend(true,$.ui.dialogExtend.prototype,{modes:{collapse:{option:"collapsable",state:"collapsed"}},options:{collapsable:false,icons:{collapse:"ui-icon-triangle-1-s"},beforeCollapse:null,collapse:null},collapse:function(){var newHeight,pos;newHeight=$(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").height()+15;this._trigger("beforeCollapse");if(this._state!=="normal"){this._restore()}this._saveSnapshot();pos=$(this.element[0]).dialog("widget").position();$(this.element[0]).dialog("option",{resizable:false,height:newHeight,maxHeight:newHeight,position:[pos.left-$(document).scrollLeft(),pos.top-$(document).scrollTop()]}).on("dialogclose",this._collapse_restore).hide().dialog("widget").find(".ui-dialog-buttonpane:visible").hide().end().find(".ui-dialog-titlebar").css("white-space","nowrap").end().find(".ui-dialog-content");this._setState("collapsed");this._toggleButtons();return this._trigger("collapse")},_restore_collapsed:function(){var original;original=this._loadSnapshot();return $(this.element[0]).show().dialog("widget").find(".ui-dialog-buttonpane:hidden").show().end().find(".ui-dialog-titlebar").css("white-space",original.titlebar.wrap).end().find(".ui-dialog-content").dialog("option",{resizable:original.config.resizable,height:original.size.height,maxHeight:original.size.maxHeight}).off("dialogclose",this._collapse_restore)},_initStyles_collapse:function(){var style;if(!$(".dialog-extend-collapse-css").length){style="";style+='<style class="dialog-extend-collapse-css" type="text/css">';style+=".ui-dialog .ui-dialog-titlebar-collapse { width: 19px; height: 18px; }";style+=".ui-dialog .ui-dialog-titlebar-collapse span { display: block; margin: 1px; }";style+=".ui-dialog .ui-dialog-titlebar-collapse:hover,";style+=".ui-dialog .ui-dialog-titlebar-collapse:focus { padding: 0; }";style+="</style>";return $(style).appendTo("body")}},_collapse_restore:function(){return $(this).dialogExtend("restore")}})}).call(this);(function(){var $;$=jQuery;$.extend(true,$.ui.dialogExtend.prototype,{modes:{maximize:{option:"maximizable",state:"maximized"}},options:{maximizable:false,icons:{maximize:"ui-icon-extlink"},beforeMaximize:null,maximize:null},maximize:function(){var newHeight,newWidth;newHeight=$(window).height()-11;newWidth=$(window).width()-11;this._trigger("beforeMaximize");if(this._state!=="normal"){this._restore()}this._saveSnapshot();if($(this.element[0]).dialog("option","draggable")){$(this.element[0]).dialog("widget").draggable("option","handle",null).find(".ui-dialog-draggable-handle").css("cursor","text").end()}$(this.element[0]).dialog("widget").css("position","fixed").find(".ui-dialog-content").show().dialog("widget").find(".ui-dialog-buttonpane").show().end().find(".ui-dialog-content").dialog("option",{resizable:false,draggable:false,height:newHeight,width:newWidth,position:{my:"left top",at:"left top",of:window}});this._setState("maximized");this._toggleButtons();return this._trigger("maximize")},_restore_maximized:function(){var original;original=this._loadSnapshot();$(this.element[0]).dialog("widget").css("position",original.position.mode).find(".ui-dialog-titlebar").css("white-space",original.titlebar.wrap).end().find(".ui-dialog-content").dialog("option",{resizable:original.config.resizable,draggable:original.config.draggable,height:original.size.height,width:original.size.width,maxHeight:original.size.maxHeight,position:{my:"left top",at:"left+"+original.position.left+" top+"+original.position.top,of:window}});if($(this.element[0]).dialog("option","draggable")){return $(this.element[0]).dialog("widget").draggable("option","handle",$(this.element[0]).dialog("widget").find(".ui-dialog-draggable-handle").length?$(this.element[0]).dialog("widget").find(".ui-dialog-draggable-handle"):".ui-dialog-titlebar").find(".ui-dialog-draggable-handle").css("cursor","move")}},_initStyles_maximize:function(){var style;if(!$(".dialog-extend-maximize-css").length){style="";style+='<style class="dialog-extend-maximize-css" type="text/css">';style+=".ui-dialog .ui-dialog-titlebar-maximize { width: 19px; height: 18px; }";style+=".ui-dialog .ui-dialog-titlebar-maximize span { display: block; margin: 1px; }";style+=".ui-dialog .ui-dialog-titlebar-maximize:hover,";style+=".ui-dialog .ui-dialog-titlebar-maximize:focus { padding: 0; }";style+="</style>";return $(style).appendTo("body")}}})}).call(this);(function(){var $;$=jQuery;$.extend(true,$.ui.dialogExtend.prototype,{modes:{minimize:{option:"minimizable",state:"minimized"}},options:{minimizable:false,minimizeLocation:"left",icons:{minimize:"ui-icon-minus"},beforeMinimize:null,minimize:null},minimize:function(){var dialogcontrols,fixedContainer,newWidth;this._trigger("beforeMinimize");if(this._state!=="normal"){this._restore()}newWidth=200;if($("#dialog-extend-fixed-container").length){fixedContainer=$("#dialog-extend-fixed-container")}else{fixedContainer=$('<div id="dialog-extend-fixed-container"></div>').appendTo("body");fixedContainer.css({position:"fixed",bottom:1,left:1,right:1,"z-index":9999})}this._toggleButtons("minimized");dialogcontrols=$(this.element[0]).dialog("widget").clone().children().remove().end();$(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").clone(true,true).appendTo(dialogcontrols);dialogcontrols.css({float:this.options.minimizeLocation,margin:1});fixedContainer.append(dialogcontrols);$(this.element[0]).data("dialog-extend-minimize-controls",dialogcontrols);if($(this.element[0]).dialog("option","draggable")){dialogcontrols.removeClass("ui-draggable")}dialogcontrols.css({height:"auto",width:newWidth,position:"static"});$(this.element[0]).on("dialogbeforeclose",this._minimize_restoreOnClose).dialog("widget").hide();this._setState("minimized");return this._trigger("minimize")},_restore_minimized:function(){$(this.element[0]).dialog("widget").show();$(this.element[0]).off("dialogbeforeclose",this._minimize_restoreOnClose);$(this.element[0]).data("dialog-extend-minimize-controls").remove();return $(this.element[0]).removeData("dialog-extend-minimize-controls")},_initStyles_minimize:function(){var style;if(!$(".dialog-extend-minimize-css").length){style="";style+='<style class="dialog-extend-minimize-css" type="text/css">';style+=".ui-dialog .ui-dialog-titlebar-minimize { width: 19px; height: 18px; }";style+=".ui-dialog .ui-dialog-titlebar-minimize span { display: block; margin: 1px; }";style+=".ui-dialog .ui-dialog-titlebar-minimize:hover,";style+=".ui-dialog .ui-dialog-titlebar-minimize:focus { padding: 0; }";style+="</style>";return $(style).appendTo("body")}},_verifyOptions_minimize:function(){var _ref;if(!this.options.minimizeLocation||(_ref=this.options.minimizeLocation)!=="left"&&_ref!=="right"){$.error("jQuery.dialogExtend Error : Invalid <minimizeLocation> value '"+this.options.minimizeLocation+"'");return this.options.minimizeLocation="left"}},_minimize_restoreOnClose:function(){return $(this).dialogExtend("restore")}})}).call(this);(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else if(typeof module!=="undefined"&&module.exports){module.exports=factory}else{factory(jQuery,window,document)}})(function($){(function(init){var _rjs=typeof define==="function"&&define.amd,_njs=typeof module!=="undefined"&&module.exports,_dlp="https:"==document.location.protocol?"https:":"http:",_url="cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js";if(!_rjs){if(_njs){require("jquery-mousewheel")($)}else{$.event.special.mousewheel||$("head").append(decodeURI("%3Cscript src="+_dlp+"//"+_url+"%3E%3C/script%3E"))}}init()})(function(){var pluginNS="mCustomScrollbar",pluginPfx="mCS",defaultSelector=".mCustomScrollbar",defaults={setTop:0,setLeft:0,axis:"y",scrollbarPosition:"inside",scrollInertia:950,autoDraggerLength:true,alwaysShowScrollbar:0,snapOffset:0,mouseWheel:{enable:true,scrollAmount:"auto",axis:"y",deltaFactor:"auto",disableOver:["select","option","keygen","datalist","textarea"]},scrollButtons:{scrollType:"stepless",scrollAmount:"auto"},keyboard:{enable:true,scrollType:"stepless",scrollAmount:"auto"},contentTouchScroll:25,documentTouchScroll:true,advanced:{autoScrollOnFocus:"input,textarea,select,button,datalist,keygen,a[tabindex],area,object,[contenteditable='true']",updateOnContentResize:true,updateOnImageLoad:"auto",autoUpdateTimeout:60},theme:"light",callbacks:{onTotalScrollOffset:0,onTotalScrollBackOffset:0,alwaysTriggerOffsets:true}},totalInstances=0,liveTimers={},oldIE=window.attachEvent&&!window.addEventListener?1:0,touchActive=false,touchable,classes=["mCSB_dragger_onDrag","mCSB_scrollTools_onDrag","mCS_img_loaded","mCS_disabled","mCS_destroyed","mCS_no_scrollbar","mCS-autoHide","mCS-dir-rtl","mCS_no_scrollbar_y","mCS_no_scrollbar_x","mCS_y_hidden","mCS_x_hidden","mCSB_draggerContainer","mCSB_buttonUp","mCSB_buttonDown","mCSB_buttonLeft","mCSB_buttonRight"],methods={init:function(options){var options=$.extend(true,{},defaults,options),selector=_selector.call(this);if(options.live){var liveSelector=options.liveSelector||this.selector||defaultSelector,$liveSelector=$(liveSelector);if(options.live==="off"){removeLiveTimers(liveSelector);return}liveTimers[liveSelector]=setTimeout(function(){$liveSelector.mCustomScrollbar(options);if(options.live==="once"&&$liveSelector.length){removeLiveTimers(liveSelector)}},500)}else{removeLiveTimers(liveSelector)}options.setWidth=options.set_width?options.set_width:options.setWidth;options.setHeight=options.set_height?options.set_height:options.setHeight;options.axis=options.horizontalScroll?"x":_findAxis(options.axis);options.scrollInertia=options.scrollInertia>0&&options.scrollInertia<17?17:options.scrollInertia;if(typeof options.mouseWheel!=="object"&&options.mouseWheel==true){options.mouseWheel={enable:true,scrollAmount:"auto",axis:"y",preventDefault:false,deltaFactor:"auto",normalizeDelta:false,invert:false}}options.mouseWheel.scrollAmount=!options.mouseWheelPixels?options.mouseWheel.scrollAmount:options.mouseWheelPixels;options.mouseWheel.normalizeDelta=!options.advanced.normalizeMouseWheelDelta?options.mouseWheel.normalizeDelta:options.advanced.normalizeMouseWheelDelta;options.scrollButtons.scrollType=_findScrollButtonsType(options.scrollButtons.scrollType);_theme(options);return $(selector).each(function(){var $this=$(this);if(!$this.data(pluginPfx)){$this.data(pluginPfx,{idx:++totalInstances,opt:options,scrollRatio:{y:null,x:null},overflowed:null,contentReset:{y:null,x:null},bindEvents:false,tweenRunning:false,sequential:{},langDir:$this.css("direction"),cbOffsets:null,trigger:null,poll:{size:{o:0,n:0},img:{o:0,n:0},change:{o:0,n:0}}});var d=$this.data(pluginPfx),o=d.opt,htmlDataAxis=$this.data("mcs-axis"),htmlDataSbPos=$this.data("mcs-scrollbar-position"),htmlDataTheme=$this.data("mcs-theme");if(htmlDataAxis){o.axis=htmlDataAxis}if(htmlDataSbPos){o.scrollbarPosition=htmlDataSbPos}if(htmlDataTheme){o.theme=htmlDataTheme;_theme(o)}_pluginMarkup.call(this);if(d&&o.callbacks.onCreate&&typeof o.callbacks.onCreate==="function"){o.callbacks.onCreate.call(this)}$("#mCSB_"+d.idx+"_container img:not(."+classes[2]+")").addClass(classes[2]);methods.update.call(null,$this)}})},update:function(el,cb){var selector=el||_selector.call(this);return $(selector).each(function(){var $this=$(this);if($this.data(pluginPfx)){var d=$this.data(pluginPfx),o=d.opt,mCSB_container=$("#mCSB_"+d.idx+"_container"),mCustomScrollBox=$("#mCSB_"+d.idx),mCSB_dragger=[$("#mCSB_"+d.idx+"_dragger_vertical"),$("#mCSB_"+d.idx+"_dragger_horizontal")];if(!mCSB_container.length){return}if(d.tweenRunning){_stop($this)}if(cb&&d&&o.callbacks.onBeforeUpdate&&typeof o.callbacks.onBeforeUpdate==="function"){o.callbacks.onBeforeUpdate.call(this)}if($this.hasClass(classes[3])){$this.removeClass(classes[3])}if($this.hasClass(classes[4])){$this.removeClass(classes[4])}mCustomScrollBox.css("max-height","none");if(mCustomScrollBox.height()!==$this.height()){mCustomScrollBox.css("max-height",$this.height())}_expandContentHorizontally.call(this);if(o.axis!=="y"&&!o.advanced.autoExpandHorizontalScroll){mCSB_container.css("width",_contentWidth(mCSB_container))}d.overflowed=_overflowed.call(this);_scrollbarVisibility.call(this);if(o.autoDraggerLength){_setDraggerLength.call(this)}_scrollRatio.call(this);_bindEvents.call(this);var to=[Math.abs(mCSB_container[0].offsetTop),Math.abs(mCSB_container[0].offsetLeft)];if(o.axis!=="x"){if(!d.overflowed[0]){_resetContentPosition.call(this);if(o.axis==="y"){_unbindEvents.call(this)}else if(o.axis==="yx"&&d.overflowed[1]){_scrollTo($this,to[1].toString(),{dir:"x",dur:0,overwrite:"none"})}}else if(mCSB_dragger[0].height()>mCSB_dragger[0].parent().height()){_resetContentPosition.call(this)}else{_scrollTo($this,to[0].toString(),{dir:"y",dur:0,overwrite:"none"});d.contentReset.y=null}}if(o.axis!=="y"){if(!d.overflowed[1]){_resetContentPosition.call(this);if(o.axis==="x"){_unbindEvents.call(this)}else if(o.axis==="yx"&&d.overflowed[0]){_scrollTo($this,to[0].toString(),{dir:"y",dur:0,overwrite:"none"})}}else if(mCSB_dragger[1].width()>mCSB_dragger[1].parent().width()){_resetContentPosition.call(this)}else{_scrollTo($this,to[1].toString(),{dir:"x",dur:0,overwrite:"none"});d.contentReset.x=null}}if(cb&&d){if(cb===2&&o.callbacks.onImageLoad&&typeof o.callbacks.onImageLoad==="function"){o.callbacks.onImageLoad.call(this)}else if(cb===3&&o.callbacks.onSelectorChange&&typeof o.callbacks.onSelectorChange==="function"){o.callbacks.onSelectorChange.call(this)}else if(o.callbacks.onUpdate&&typeof o.callbacks.onUpdate==="function"){o.callbacks.onUpdate.call(this)}}_autoUpdate.call(this)}})},scrollTo:function(val,options){if(typeof val=="undefined"||val==null){return}var selector=_selector.call(this);return $(selector).each(function(){var $this=$(this);if($this.data(pluginPfx)){var d=$this.data(pluginPfx),o=d.opt,methodDefaults={trigger:"external",scrollInertia:o.scrollInertia,scrollEasing:"mcsEaseInOut",moveDragger:false,timeout:60,callbacks:true,onStart:true,onUpdate:true,onComplete:true},methodOptions=$.extend(true,{},methodDefaults,options),to=_arr.call(this,val),dur=methodOptions.scrollInertia>0&&methodOptions.scrollInertia<17?17:methodOptions.scrollInertia;to[0]=_to.call(this,to[0],"y");to[1]=_to.call(this,to[1],"x");if(methodOptions.moveDragger){to[0]*=d.scrollRatio.y;to[1]*=d.scrollRatio.x}methodOptions.dur=_isTabHidden()?0:dur;setTimeout(function(){if(to[0]!==null&&typeof to[0]!=="undefined"&&o.axis!=="x"&&d.overflowed[0]){methodOptions.dir="y";methodOptions.overwrite="all";_scrollTo($this,to[0].toString(),methodOptions)}if(to[1]!==null&&typeof to[1]!=="undefined"&&o.axis!=="y"&&d.overflowed[1]){methodOptions.dir="x";methodOptions.overwrite="none";_scrollTo($this,to[1].toString(),methodOptions)}},methodOptions.timeout)}})},stop:function(){var selector=_selector.call(this);return $(selector).each(function(){var $this=$(this);if($this.data(pluginPfx)){_stop($this)}})},disable:function(r){var selector=_selector.call(this);return $(selector).each(function(){var $this=$(this);if($this.data(pluginPfx)){var d=$this.data(pluginPfx);_autoUpdate.call(this,"remove");_unbindEvents.call(this);if(r){_resetContentPosition.call(this)}_scrollbarVisibility.call(this,true);$this.addClass(classes[3])}})},destroy:function(){var selector=_selector.call(this);return $(selector).each(function(){var $this=$(this);if($this.data(pluginPfx)){var d=$this.data(pluginPfx),o=d.opt,mCustomScrollBox=$("#mCSB_"+d.idx),mCSB_container=$("#mCSB_"+d.idx+"_container"),scrollbar=$(".mCSB_"+d.idx+"_scrollbar");if(o.live){removeLiveTimers(o.liveSelector||$(selector).selector)}_autoUpdate.call(this,"remove");_unbindEvents.call(this);_resetContentPosition.call(this);$this.removeData(pluginPfx);_delete(this,"mcs");scrollbar.remove();mCSB_container.find("img."+classes[2]).removeClass(classes[2]);mCustomScrollBox.replaceWith(mCSB_container.contents());$this.removeClass(pluginNS+" _"+pluginPfx+"_"+d.idx+" "+classes[6]+" "+classes[7]+" "+classes[5]+" "+classes[3]).addClass(classes[4])}})}},_selector=function(){return typeof $(this)!=="object"||$(this).length<1?defaultSelector:this},_theme=function(obj){var fixedSizeScrollbarThemes=["rounded","rounded-dark","rounded-dots","rounded-dots-dark"],nonExpandedScrollbarThemes=["rounded-dots","rounded-dots-dark","3d","3d-dark","3d-thick","3d-thick-dark","inset","inset-dark","inset-2","inset-2-dark","inset-3","inset-3-dark"],disabledScrollButtonsThemes=["minimal","minimal-dark"],enabledAutoHideScrollbarThemes=["minimal","minimal-dark"],scrollbarPositionOutsideThemes=["minimal","minimal-dark"];obj.autoDraggerLength=$.inArray(obj.theme,fixedSizeScrollbarThemes)>-1?false:obj.autoDraggerLength;obj.autoExpandScrollbar=$.inArray(obj.theme,nonExpandedScrollbarThemes)>-1?false:obj.autoExpandScrollbar;obj.scrollButtons.enable=$.inArray(obj.theme,disabledScrollButtonsThemes)>-1?false:obj.scrollButtons.enable;obj.autoHideScrollbar=$.inArray(obj.theme,enabledAutoHideScrollbarThemes)>-1?true:obj.autoHideScrollbar;obj.scrollbarPosition=$.inArray(obj.theme,scrollbarPositionOutsideThemes)>-1?"outside":obj.scrollbarPosition},removeLiveTimers=function(selector){if(liveTimers[selector]){clearTimeout(liveTimers[selector]);_delete(liveTimers,selector)}},_findAxis=function(val){return val==="yx"||val==="xy"||val==="auto"?"yx":val==="x"||val==="horizontal"?"x":"y"},_findScrollButtonsType=function(val){return val==="stepped"||val==="pixels"||val==="step"||val==="click"?"stepped":"stepless"},_pluginMarkup=function(){var $this=$(this),d=$this.data(pluginPfx),o=d.opt,expandClass=o.autoExpandScrollbar?" "+classes[1]+"_expand":"",scrollbar=["<div id='mCSB_"+d.idx+"_scrollbar_vertical' class='mCSB_scrollTools mCSB_"+d.idx+"_scrollbar mCS-"+o.theme+" mCSB_scrollTools_vertical"+expandClass+"'><div class='"+classes[12]+"'><div id='mCSB_"+d.idx+"_dragger_vertical' class='mCSB_dragger' style='position:absolute;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>","<div id='mCSB_"+d.idx+"_scrollbar_horizontal' class='mCSB_scrollTools mCSB_"+d.idx+"_scrollbar mCS-"+o.theme+" mCSB_scrollTools_horizontal"+expandClass+"'><div class='"+classes[12]+"'><div id='mCSB_"+d.idx+"_dragger_horizontal' class='mCSB_dragger' style='position:absolute;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>"],wrapperClass=o.axis==="yx"?"mCSB_vertical_horizontal":o.axis==="x"?"mCSB_horizontal":"mCSB_vertical",scrollbars=o.axis==="yx"?scrollbar[0]+scrollbar[1]:o.axis==="x"?scrollbar[1]:scrollbar[0],contentWrapper=o.axis==="yx"?"<div id='mCSB_"+d.idx+"_container_wrapper' class='mCSB_container_wrapper' />":"",autoHideClass=o.autoHideScrollbar?" "+classes[6]:"",scrollbarDirClass=o.axis!=="x"&&d.langDir==="rtl"?" "+classes[7]:"";if(o.setWidth){$this.css("width",o.setWidth)}if(o.setHeight){$this.css("height",o.setHeight)}o.setLeft=o.axis!=="y"&&d.langDir==="rtl"?"989999px":o.setLeft;$this.addClass(pluginNS+" _"+pluginPfx+"_"+d.idx+autoHideClass+scrollbarDirClass).wrapInner("<div id='mCSB_"+d.idx+"' class='mCustomScrollBox mCS-"+o.theme+" "+wrapperClass+"'><div id='mCSB_"+d.idx+"_container' class='mCSB_container' style='position:relative; top:"+o.setTop+"; left:"+o.setLeft+";' dir='"+d.langDir+"' /></div>");var mCustomScrollBox=$("#mCSB_"+d.idx),mCSB_container=$("#mCSB_"+d.idx+"_container");if(o.axis!=="y"&&!o.advanced.autoExpandHorizontalScroll){mCSB_container.css("width",_contentWidth(mCSB_container))}if(o.scrollbarPosition==="outside"){if($this.css("position")==="static"){$this.css("position","relative")}$this.css("overflow","visible");mCustomScrollBox.addClass("mCSB_outside").after(scrollbars)}else{mCustomScrollBox.addClass("mCSB_inside").append(scrollbars);mCSB_container.wrap(contentWrapper)}_scrollButtons.call(this);var mCSB_dragger=[$("#mCSB_"+d.idx+"_dragger_vertical"),$("#mCSB_"+d.idx+"_dragger_horizontal")];mCSB_dragger[0].css("min-height",mCSB_dragger[0].height());mCSB_dragger[1].css("min-width",mCSB_dragger[1].width())},_contentWidth=function(el){var val=[el[0].scrollWidth,Math.max.apply(Math,el.children().map(function(){return $(this).outerWidth(true)}).get())],w=el.parent().width();return val[0]>w?val[0]:val[1]>w?val[1]:"100%"},_expandContentHorizontally=function(){var $this=$(this),d=$this.data(pluginPfx),o=d.opt,mCSB_container=$("#mCSB_"+d.idx+"_container");if(o.advanced.autoExpandHorizontalScroll&&o.axis!=="y"){mCSB_container.css({width:"auto","min-width":0,"overflow-x":"scroll"});var w=Math.ceil(mCSB_container[0].scrollWidth);if(o.advanced.autoExpandHorizontalScroll===3||o.advanced.autoExpandHorizontalScroll!==2&&w>mCSB_container.parent().width()){mCSB_container.css({width:w,"min-width":"100%","overflow-x":"inherit"})}else{mCSB_container.css({"overflow-x":"inherit",position:"absolute"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:Math.ceil(mCSB_container[0].getBoundingClientRect().right+.4)-Math.floor(mCSB_container[0].getBoundingClientRect().left),"min-width":"100%",position:"relative"}).unwrap()}}},_scrollButtons=function(){var $this=$(this),d=$this.data(pluginPfx),o=d.opt,mCSB_scrollTools=$(".mCSB_"+d.idx+"_scrollbar:first"),tabindex=!_isNumeric(o.scrollButtons.tabindex)?"":"tabindex='"+o.scrollButtons.tabindex+"'",btnHTML=["<a href='#' class='"+classes[13]+"' "+tabindex+" />","<a href='#' class='"+classes[14]+"' "+tabindex+" />","<a href='#' class='"+classes[15]+"' "+tabindex+" />","<a href='#' class='"+classes[16]+"' "+tabindex+" />"],btn=[o.axis==="x"?btnHTML[2]:btnHTML[0],o.axis==="x"?btnHTML[3]:btnHTML[1],btnHTML[2],btnHTML[3]];if(o.scrollButtons.enable){mCSB_scrollTools.prepend(btn[0]).append(btn[1]).next(".mCSB_scrollTools").prepend(btn[2]).append(btn[3])}},_setDraggerLength=function(){var $this=$(this),d=$this.data(pluginPfx),mCustomScrollBox=$("#mCSB_"+d.idx),mCSB_container=$("#mCSB_"+d.idx+"_container"),mCSB_dragger=[$("#mCSB_"+d.idx+"_dragger_vertical"),$("#mCSB_"+d.idx+"_dragger_horizontal")],ratio=[mCustomScrollBox.height()/mCSB_container.outerHeight(false),mCustomScrollBox.width()/mCSB_container.outerWidth(false)],l=[parseInt(mCSB_dragger[0].css("min-height")),Math.round(ratio[0]*mCSB_dragger[0].parent().height()),parseInt(mCSB_dragger[1].css("min-width")),Math.round(ratio[1]*mCSB_dragger[1].parent().width())],h=oldIE&&l[1]<l[0]?l[0]:l[1],w=oldIE&&l[3]<l[2]?l[2]:l[3];mCSB_dragger[0].css({height:h,"max-height":mCSB_dragger[0].parent().height()-10}).find(".mCSB_dragger_bar").css({"line-height":l[0]+"px"});mCSB_dragger[1].css({width:w,"max-width":mCSB_dragger[1].parent().width()-10})},_scrollRatio=function(){var $this=$(this),d=$this.data(pluginPfx),mCustomScrollBox=$("#mCSB_"+d.idx),mCSB_container=$("#mCSB_"+d.idx+"_container"),mCSB_dragger=[$("#mCSB_"+d.idx+"_dragger_vertical"),$("#mCSB_"+d.idx+"_dragger_horizontal")],scrollAmount=[mCSB_container.outerHeight(false)-mCustomScrollBox.height(),mCSB_container.outerWidth(false)-mCustomScrollBox.width()],ratio=[scrollAmount[0]/(mCSB_dragger[0].parent().height()-mCSB_dragger[0].height()),scrollAmount[1]/(mCSB_dragger[1].parent().width()-mCSB_dragger[1].width())];d.scrollRatio={y:ratio[0],x:ratio[1]}},_onDragClasses=function(el,action,xpnd){var expandClass=xpnd?classes[0]+"_expanded":"",scrollbar=el.closest(".mCSB_scrollTools");if(action==="active"){el.toggleClass(classes[0]+" "+expandClass);scrollbar.toggleClass(classes[1]);el[0]._draggable=el[0]._draggable?0:1}else{if(!el[0]._draggable){if(action==="hide"){el.removeClass(classes[0]);scrollbar.removeClass(classes[1])}else{el.addClass(classes[0]);scrollbar.addClass(classes[1])}}}},_overflowed=function(){var $this=$(this),d=$this.data(pluginPfx),mCustomScrollBox=$("#mCSB_"+d.idx),mCSB_container=$("#mCSB_"+d.idx+"_container"),contentHeight=d.overflowed==null?mCSB_container.height():mCSB_container.outerHeight(false),contentWidth=d.overflowed==null?mCSB_container.width():mCSB_container.outerWidth(false),h=mCSB_container[0].scrollHeight,w=mCSB_container[0].scrollWidth;if(h>contentHeight){contentHeight=h}if(w>contentWidth){contentWidth=w}return[contentHeight>mCustomScrollBox.height(),contentWidth>mCustomScrollBox.width()]},_resetContentPosition=function(){var $this=$(this),d=$this.data(pluginPfx),o=d.opt,mCustomScrollBox=$("#mCSB_"+d.idx),mCSB_container=$("#mCSB_"+d.idx+"_container"),mCSB_dragger=[$("#mCSB_"+d.idx+"_dragger_vertical"),$("#mCSB_"+d.idx+"_dragger_horizontal")];_stop($this);if(o.axis!=="x"&&!d.overflowed[0]||o.axis==="y"&&d.overflowed[0]){mCSB_dragger[0].add(mCSB_container).css("top",0);_scrollTo($this,"_resetY")}if(o.axis!=="y"&&!d.overflowed[1]||o.axis==="x"&&d.overflowed[1]){var cx=dx=0;if(d.langDir==="rtl"){cx=mCustomScrollBox.width()-mCSB_container.outerWidth(false);dx=Math.abs(cx/d.scrollRatio.x)}mCSB_container.css("left",cx);mCSB_dragger[1].css("left",dx);_scrollTo($this,"_resetX")}},_bindEvents=function(){var $this=$(this),d=$this.data(pluginPfx),o=d.opt;if(!d.bindEvents){_draggable.call(this);if(o.contentTouchScroll){_contentDraggable.call(this)}_selectable.call(this);if(o.mouseWheel.enable){function _mwt(){mousewheelTimeout=setTimeout(function(){if(!$.event.special.mousewheel){_mwt()}else{clearTimeout(mousewheelTimeout);_mousewheel.call($this[0])}},100)}var mousewheelTimeout;_mwt()}_draggerRail.call(this);_wrapperScroll.call(this);if(o.advanced.autoScrollOnFocus){_focus.call(this)}if(o.scrollButtons.enable){_buttons.call(this)}if(o.keyboard.enable){_keyboard.call(this)}d.bindEvents=true}},_unbindEvents=function(){var $this=$(this),d=$this.data(pluginPfx),o=d.opt,namespace=pluginPfx+"_"+d.idx,sb=".mCSB_"+d.idx+"_scrollbar",sel=$("#mCSB_"+d.idx+",#mCSB_"+d.idx+"_container,#mCSB_"+d.idx+"_container_wrapper,"+sb+" ."+classes[12]+",#mCSB_"+d.idx+"_dragger_vertical,#mCSB_"+d.idx+"_dragger_horizontal,"+sb+">a"),mCSB_container=$("#mCSB_"+d.idx+"_container");if(o.advanced.releaseDraggableSelectors){sel.add($(o.advanced.releaseDraggableSelectors))}if(o.advanced.extraDraggableSelectors){sel.add($(o.advanced.extraDraggableSelectors))}if(d.bindEvents){$(document).add($(!_canAccessIFrame()||top.document)).unbind("."+namespace);sel.each(function(){$(this).unbind("."+namespace)});clearTimeout($this[0]._focusTimeout);_delete($this[0],"_focusTimeout");clearTimeout(d.sequential.step);_delete(d.sequential,"step");clearTimeout(mCSB_container[0].onCompleteTimeout);_delete(mCSB_container[0],"onCompleteTimeout");d.bindEvents=false}},_scrollbarVisibility=function(disabled){var $this=$(this),d=$this.data(pluginPfx),o=d.opt,contentWrapper=$("#mCSB_"+d.idx+"_container_wrapper"),content=contentWrapper.length?contentWrapper:$("#mCSB_"+d.idx+"_container"),scrollbar=[$("#mCSB_"+d.idx+"_scrollbar_vertical"),$("#mCSB_"+d.idx+"_scrollbar_horizontal")],mCSB_dragger=[scrollbar[0].find(".mCSB_dragger"),scrollbar[1].find(".mCSB_dragger")];if(o.axis!=="x"){if(d.overflowed[0]&&!disabled){scrollbar[0].add(mCSB_dragger[0]).add(scrollbar[0].children("a")).css("display","block");content.removeClass(classes[8]+" "+classes[10])}else{if(o.alwaysShowScrollbar){if(o.alwaysShowScrollbar!==2){mCSB_dragger[0].css("display","none")}content.removeClass(classes[10])}else{scrollbar[0].css("display","none");content.addClass(classes[10])}content.addClass(classes[8])}}if(o.axis!=="y"){if(d.overflowed[1]&&!disabled){scrollbar[1].add(mCSB_dragger[1]).add(scrollbar[1].children("a")).css("display","block");content.removeClass(classes[9]+" "+classes[11])}else{if(o.alwaysShowScrollbar){if(o.alwaysShowScrollbar!==2){mCSB_dragger[1].css("display","none")}content.removeClass(classes[11])}else{scrollbar[1].css("display","none");content.addClass(classes[11])}content.addClass(classes[9])}}if(!d.overflowed[0]&&!d.overflowed[1]){$this.addClass(classes[5])}else{$this.removeClass(classes[5])}},_coordinates=function(e){var t=e.type,o=e.target.ownerDocument!==document&&frameElement!==null?[$(frameElement).offset().top,$(frameElement).offset().left]:null,io=_canAccessIFrame()&&e.target.ownerDocument!==top.document&&frameElement!==null?[$(e.view.frameElement).offset().top,$(e.view.frameElement).offset().left]:[0,0];switch(t){case"pointerdown":case"MSPointerDown":case"pointermove":case"MSPointerMove":case"pointerup":case"MSPointerUp":return o?[e.originalEvent.pageY-o[0]+io[0],e.originalEvent.pageX-o[1]+io[1],false]:[e.originalEvent.pageY,e.originalEvent.pageX,false];break;case"touchstart":case"touchmove":case"touchend":var touch=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0],touches=e.originalEvent.touches.length||e.originalEvent.changedTouches.length;return e.target.ownerDocument!==document?[touch.screenY,touch.screenX,touches>1]:[touch.pageY,touch.pageX,touches>1];break;default:return o?[e.pageY-o[0]+io[0],e.pageX-o[1]+io[1],false]:[e.pageY,e.pageX,false]}},_draggable=function(){var $this=$(this),d=$this.data(pluginPfx),o=d.opt,namespace=pluginPfx+"_"+d.idx,draggerId=["mCSB_"+d.idx+"_dragger_vertical","mCSB_"+d.idx+"_dragger_horizontal"],mCSB_container=$("#mCSB_"+d.idx+"_container"),mCSB_dragger=$("#"+draggerId[0]+",#"+draggerId[1]),draggable,dragY,dragX,rds=o.advanced.releaseDraggableSelectors?mCSB_dragger.add($(o.advanced.releaseDraggableSelectors)):mCSB_dragger,eds=o.advanced.extraDraggableSelectors?$(!_canAccessIFrame()||top.document).add($(o.advanced.extraDraggableSelectors)):$(!_canAccessIFrame()||top.document);mCSB_dragger.bind("contextmenu."+namespace,function(e){e.preventDefault()}).bind("mousedown."+namespace+" touchstart."+namespace+" pointerdown."+namespace+" MSPointerDown."+namespace,function(e){e.stopImmediatePropagation();e.preventDefault();if(!_mouseBtnLeft(e)){return}touchActive=true;if(oldIE){document.onselectstart=function(){return false}}_iframe.call(mCSB_container,false);_stop($this);draggable=$(this);var offset=draggable.offset(),y=_coordinates(e)[0]-offset.top,x=_coordinates(e)[1]-offset.left,h=draggable.height()+offset.top,w=draggable.width()+offset.left;if(y<h&&y>0&&x<w&&x>0){dragY=y;dragX=x}_onDragClasses(draggable,"active",o.autoExpandScrollbar)}).bind("touchmove."+namespace,function(e){e.stopImmediatePropagation();e.preventDefault();var offset=draggable.offset(),y=_coordinates(e)[0]-offset.top,x=_coordinates(e)[1]-offset.left;_drag(dragY,dragX,y,x)});$(document).add(eds).bind("mousemove."+namespace+" pointermove."+namespace+" MSPointerMove."+namespace,function(e){if(draggable){var offset=draggable.offset(),y=_coordinates(e)[0]-offset.top,x=_coordinates(e)[1]-offset.left;if(dragY===y&&dragX===x){return}_drag(dragY,dragX,y,x)}}).add(rds).bind("mouseup."+namespace+" touchend."+namespace+" pointerup."+namespace+" MSPointerUp."+namespace,function(e){if(draggable){_onDragClasses(draggable,"active",o.autoExpandScrollbar);draggable=null}touchActive=false;if(oldIE){document.onselectstart=null}_iframe.call(mCSB_container,true)});function _drag(dragY,dragX,y,x){mCSB_container[0].idleTimer=o.scrollInertia<233?250:0;if(draggable.attr("id")===draggerId[1]){var dir="x",to=(draggable[0].offsetLeft-dragX+x)*d.scrollRatio.x}else{var dir="y",to=(draggable[0].offsetTop-dragY+y)*d.scrollRatio.y}_scrollTo($this,to.toString(),{dir:dir,drag:true})}},_contentDraggable=function(){var $this=$(this),d=$this.data(pluginPfx),o=d.opt,namespace=pluginPfx+"_"+d.idx,mCustomScrollBox=$("#mCSB_"+d.idx),mCSB_container=$("#mCSB_"+d.idx+"_container"),mCSB_dragger=[$("#mCSB_"+d.idx+"_dragger_vertical"),$("#mCSB_"+d.idx+"_dragger_horizontal")],draggable,dragY,dragX,touchStartY,touchStartX,touchMoveY=[],touchMoveX=[],startTime,runningTime,endTime,distance,speed,amount,durA=0,durB,overwrite=o.axis==="yx"?"none":"all",touchIntent=[],touchDrag,docDrag,iframe=mCSB_container.find("iframe"),events=["touchstart."+namespace+" pointerdown."+namespace+" MSPointerDown."+namespace,"touchmove."+namespace+" pointermove."+namespace+" MSPointerMove."+namespace,"touchend."+namespace+" pointerup."+namespace+" MSPointerUp."+namespace],touchAction=document.body.style.touchAction!==undefined&&document.body.style.touchAction!=="";mCSB_container.bind(events[0],function(e){_onTouchstart(e)}).bind(events[1],function(e){_onTouchmove(e)});mCustomScrollBox.bind(events[0],function(e){_onTouchstart2(e)}).bind(events[2],function(e){_onTouchend(e)});if(iframe.length){iframe.each(function(){$(this).bind("load",function(){if(_canAccessIFrame(this)){$(this.contentDocument||this.contentWindow.document).bind(events[0],function(e){_onTouchstart(e);_onTouchstart2(e)}).bind(events[1],function(e){_onTouchmove(e)}).bind(events[2],function(e){_onTouchend(e)})}})})}function _onTouchstart(e){if(!_pointerTouch(e)||touchActive||_coordinates(e)[2]){touchable=0;return}touchable=1;touchDrag=0;docDrag=0;draggable=1;$this.removeClass("mCS_touch_action");var offset=mCSB_container.offset();dragY=_coordinates(e)[0]-offset.top;dragX=_coordinates(e)[1]-offset.left;touchIntent=[_coordinates(e)[0],_coordinates(e)[1]]}function _onTouchmove(e){if(!_pointerTouch(e)||touchActive||_coordinates(e)[2]){return}if(!o.documentTouchScroll){e.preventDefault()}e.stopImmediatePropagation();if(docDrag&&!touchDrag){return}if(draggable){runningTime=_getTime();var offset=mCustomScrollBox.offset(),y=_coordinates(e)[0]-offset.top,x=_coordinates(e)[1]-offset.left,easing="mcsLinearOut";touchMoveY.push(y);touchMoveX.push(x);touchIntent[2]=Math.abs(_coordinates(e)[0]-touchIntent[0]);touchIntent[3]=Math.abs(_coordinates(e)[1]-touchIntent[1]);if(d.overflowed[0]){var limit=mCSB_dragger[0].parent().height()-mCSB_dragger[0].height(),prevent=dragY-y>0&&y-dragY>-(limit*d.scrollRatio.y)&&(touchIntent[3]*2<touchIntent[2]||o.axis==="yx")}if(d.overflowed[1]){var limitX=mCSB_dragger[1].parent().width()-mCSB_dragger[1].width(),preventX=dragX-x>0&&x-dragX>-(limitX*d.scrollRatio.x)&&(touchIntent[2]*2<touchIntent[3]||o.axis==="yx")}if(prevent||preventX){if(!touchAction){e.preventDefault()}touchDrag=1}else{docDrag=1;$this.addClass("mCS_touch_action")}if(touchAction){e.preventDefault()}amount=o.axis==="yx"?[dragY-y,dragX-x]:o.axis==="x"?[null,dragX-x]:[dragY-y,null];mCSB_container[0].idleTimer=250;if(d.overflowed[0]){_drag(amount[0],durA,easing,"y","all",true)}if(d.overflowed[1]){_drag(amount[1],durA,easing,"x",overwrite,true)}}}function _onTouchstart2(e){if(!_pointerTouch(e)||touchActive||_coordinates(e)[2]){touchable=0;return}touchable=1;e.stopImmediatePropagation();_stop($this);startTime=_getTime();var offset=mCustomScrollBox.offset();touchStartY=_coordinates(e)[0]-offset.top;touchStartX=_coordinates(e)[1]-offset.left;touchMoveY=[];touchMoveX=[]}function _onTouchend(e){if(!_pointerTouch(e)||touchActive||_coordinates(e)[2]){return}draggable=0;e.stopImmediatePropagation();touchDrag=0;docDrag=0;endTime=_getTime();var offset=mCustomScrollBox.offset(),y=_coordinates(e)[0]-offset.top,x=_coordinates(e)[1]-offset.left;if(endTime-runningTime>30){return}speed=1e3/(endTime-startTime);var easing="mcsEaseOut",slow=speed<2.5,diff=slow?[touchMoveY[touchMoveY.length-2],touchMoveX[touchMoveX.length-2]]:[0,0];distance=slow?[y-diff[0],x-diff[1]]:[y-touchStartY,x-touchStartX];var absDistance=[Math.abs(distance[0]),Math.abs(distance[1])];speed=slow?[Math.abs(distance[0]/4),Math.abs(distance[1]/4)]:[speed,speed];var a=[Math.abs(mCSB_container[0].offsetTop)-distance[0]*_m(absDistance[0]/speed[0],speed[0]),Math.abs(mCSB_container[0].offsetLeft)-distance[1]*_m(absDistance[1]/speed[1],speed[1])];amount=o.axis==="yx"?[a[0],a[1]]:o.axis==="x"?[null,a[1]]:[a[0],null];durB=[absDistance[0]*4+o.scrollInertia,absDistance[1]*4+o.scrollInertia];var md=parseInt(o.contentTouchScroll)||0;amount[0]=absDistance[0]>md?amount[0]:0;amount[1]=absDistance[1]>md?amount[1]:0;if(d.overflowed[0]){_drag(amount[0],durB[0],easing,"y",overwrite,false)}if(d.overflowed[1]){_drag(amount[1],durB[1],easing,"x",overwrite,false)}}function _m(ds,s){var r=[s*1.5,s*2,s/1.5,s/2];if(ds>90){return s>4?r[0]:r[3]}else if(ds>60){return s>3?r[3]:r[2]}else if(ds>30){return s>8?r[1]:s>6?r[0]:s>4?s:r[2]}else{return s>8?s:r[3]}}function _drag(amount,dur,easing,dir,overwrite,drag){if(!amount){return}_scrollTo($this,amount.toString(),{dur:dur,scrollEasing:easing,dir:dir,overwrite:overwrite,drag:drag})}},_selectable=function(){var $this=$(this),d=$this.data(pluginPfx),o=d.opt,seq=d.sequential,namespace=pluginPfx+"_"+d.idx,mCSB_container=$("#mCSB_"+d.idx+"_container"),wrapper=mCSB_container.parent(),action;mCSB_container.bind("mousedown."+namespace,function(e){if(touchable){return}if(!action){action=1;touchActive=true}}).add(document).bind("mousemove."+namespace,function(e){if(!touchable&&action&&_sel()){var offset=mCSB_container.offset(),y=_coordinates(e)[0]-offset.top+mCSB_container[0].offsetTop,x=_coordinates(e)[1]-offset.left+mCSB_container[0].offsetLeft;if(y>0&&y<wrapper.height()&&x>0&&x<wrapper.width()){if(seq.step){_seq("off",null,"stepped")}}else{if(o.axis!=="x"&&d.overflowed[0]){if(y<0){_seq("on",38)}else if(y>wrapper.height()){_seq("on",40)}}if(o.axis!=="y"&&d.overflowed[1]){if(x<0){_seq("on",37)}else if(x>wrapper.width()){_seq("on",39)}}}}}).bind("mouseup."+namespace+" dragend."+namespace,function(e){if(touchable){return}if(action){action=0;_seq("off",null)}touchActive=false});function _sel(){return window.getSelection?window.getSelection().toString():document.selection&&document.selection.type!="Control"?document.selection.createRange().text:0}function _seq(a,c,s){seq.type=s&&action?"stepped":"stepless";seq.scrollAmount=10;_sequentialScroll($this,a,c,"mcsLinearOut",s?60:null)}},_mousewheel=function(){if(!$(this).data(pluginPfx)){return}var $this=$(this),d=$this.data(pluginPfx),o=d.opt,namespace=pluginPfx+"_"+d.idx,mCustomScrollBox=$("#mCSB_"+d.idx),mCSB_dragger=[$("#mCSB_"+d.idx+"_dragger_vertical"),$("#mCSB_"+d.idx+"_dragger_horizontal")],iframe=$("#mCSB_"+d.idx+"_container").find("iframe");if(iframe.length){iframe.each(function(){$(this).bind("load",function(){if(_canAccessIFrame(this)){$(this.contentDocument||this.contentWindow.document).bind("mousewheel."+namespace,function(e,delta){_onMousewheel(e,delta)})}})})}mCustomScrollBox.bind("mousewheel."+namespace,function(e,delta){_onMousewheel(e,delta)});function _onMousewheel(e,delta){_stop($this);if(_disableMousewheel($this,e.target)){return}var deltaFactor=o.mouseWheel.deltaFactor!=="auto"?parseInt(o.mouseWheel.deltaFactor):oldIE&&e.deltaFactor<100?100:e.deltaFactor||100,dur=o.scrollInertia;if(o.axis==="x"||o.mouseWheel.axis==="x"){var dir="x",px=[Math.round(deltaFactor*d.scrollRatio.x),parseInt(o.mouseWheel.scrollAmount)],amount=o.mouseWheel.scrollAmount!=="auto"?px[1]:px[0]>=mCustomScrollBox.width()?mCustomScrollBox.width()*.9:px[0],contentPos=Math.abs($("#mCSB_"+d.idx+"_container")[0].offsetLeft),draggerPos=mCSB_dragger[1][0].offsetLeft,limit=mCSB_dragger[1].parent().width()-mCSB_dragger[1].width(),dlt=o.mouseWheel.axis==="y"?e.deltaY||delta:e.deltaX}else{var dir="y",px=[Math.round(deltaFactor*d.scrollRatio.y),parseInt(o.mouseWheel.scrollAmount)],amount=o.mouseWheel.scrollAmount!=="auto"?px[1]:px[0]>=mCustomScrollBox.height()?mCustomScrollBox.height()*.9:px[0],contentPos=Math.abs($("#mCSB_"+d.idx+"_container")[0].offsetTop),draggerPos=mCSB_dragger[0][0].offsetTop,limit=mCSB_dragger[0].parent().height()-mCSB_dragger[0].height(),dlt=e.deltaY||delta}if(dir==="y"&&!d.overflowed[0]||dir==="x"&&!d.overflowed[1]){return}if(o.mouseWheel.invert||e.webkitDirectionInvertedFromDevice){dlt=-dlt}if(o.mouseWheel.normalizeDelta){dlt=dlt<0?-1:1}if(dlt>0&&draggerPos!==0||dlt<0&&draggerPos!==limit||o.mouseWheel.preventDefault){e.stopImmediatePropagation();e.preventDefault()}if(e.deltaFactor<5&&!o.mouseWheel.normalizeDelta){amount=e.deltaFactor;dur=17}_scrollTo($this,(contentPos-dlt*amount).toString(),{dir:dir,dur:dur})}},_canAccessIFrameCache=new Object,_canAccessIFrame=function(iframe){var result=false,cacheKey=false,html=null;if(iframe===undefined){cacheKey="#empty"}else if($(iframe).attr("id")!==undefined){cacheKey=$(iframe).attr("id")}if(cacheKey!==false&&_canAccessIFrameCache[cacheKey]!==undefined){return _canAccessIFrameCache[cacheKey]}if(!iframe){try{var doc=top.document;html=doc.body.innerHTML}catch(err){}result=html!==null}else{try{var doc=iframe.contentDocument||iframe.contentWindow.document;html=doc.body.innerHTML}catch(err){}result=html!==null}if(cacheKey!==false){_canAccessIFrameCache[cacheKey]=result}return result},_iframe=function(evt){var el=this.find("iframe");if(!el.length){return}var val=!evt?"none":"auto";el.css("pointer-events",val)},_disableMousewheel=function(el,target){var tag=target.nodeName.toLowerCase(),tags=el.data(pluginPfx).opt.mouseWheel.disableOver,focusTags=["select","textarea"];return $.inArray(tag,tags)>-1&&!($.inArray(tag,focusTags)>-1&&!$(target).is(":focus"))},_draggerRail=function(){var $this=$(this),d=$this.data(pluginPfx),namespace=pluginPfx+"_"+d.idx,mCSB_container=$("#mCSB_"+d.idx+"_container"),wrapper=mCSB_container.parent(),mCSB_draggerContainer=$(".mCSB_"+d.idx+"_scrollbar ."+classes[12]),clickable;mCSB_draggerContainer.bind("mousedown."+namespace+" touchstart."+namespace+" pointerdown."+namespace+" MSPointerDown."+namespace,function(e){touchActive=true;if(!$(e.target).hasClass("mCSB_dragger")){clickable=1}}).bind("touchend."+namespace+" pointerup."+namespace+" MSPointerUp."+namespace,function(e){touchActive=false}).bind("click."+namespace,function(e){if(!clickable){return}clickable=0;if($(e.target).hasClass(classes[12])||$(e.target).hasClass("mCSB_draggerRail")){_stop($this);var el=$(this),mCSB_dragger=el.find(".mCSB_dragger");if(el.parent(".mCSB_scrollTools_horizontal").length>0){if(!d.overflowed[1]){return}var dir="x",clickDir=e.pageX>mCSB_dragger.offset().left?-1:1,to=Math.abs(mCSB_container[0].offsetLeft)-clickDir*(wrapper.width()*.9)}else{if(!d.overflowed[0]){return}var dir="y",clickDir=e.pageY>mCSB_dragger.offset().top?-1:1,to=Math.abs(mCSB_container[0].offsetTop)-clickDir*(wrapper.height()*.9)}_scrollTo($this,to.toString(),{dir:dir,scrollEasing:"mcsEaseInOut"})}})},_focus=function(){var $this=$(this),d=$this.data(pluginPfx),o=d.opt,namespace=pluginPfx+"_"+d.idx,mCSB_container=$("#mCSB_"+d.idx+"_container"),wrapper=mCSB_container.parent();mCSB_container.bind("focusin."+namespace,function(e){var el=$(document.activeElement),nested=mCSB_container.find(".mCustomScrollBox").length,dur=0;if(!el.is(o.advanced.autoScrollOnFocus)){return}_stop($this);clearTimeout($this[0]._focusTimeout);$this[0]._focusTimer=nested?(dur+17)*nested:0;$this[0]._focusTimeout=setTimeout(function(){var to=[_childPos(el)[0],_childPos(el)[1]],contentPos=[mCSB_container[0].offsetTop,mCSB_container[0].offsetLeft],isVisible=[contentPos[0]+to[0]>=0&&contentPos[0]+to[0]<wrapper.height()-el.outerHeight(false),contentPos[1]+to[1]>=0&&contentPos[0]+to[1]<wrapper.width()-el.outerWidth(false)],overwrite=o.axis==="yx"&&!isVisible[0]&&!isVisible[1]?"none":"all";if(o.axis!=="x"&&!isVisible[0]){_scrollTo($this,to[0].toString(),{dir:"y",scrollEasing:"mcsEaseInOut",overwrite:overwrite,dur:dur})}if(o.axis!=="y"&&!isVisible[1]){_scrollTo($this,to[1].toString(),{dir:"x",scrollEasing:"mcsEaseInOut",overwrite:overwrite,dur:dur})}},$this[0]._focusTimer)})},_wrapperScroll=function(){var $this=$(this),d=$this.data(pluginPfx),namespace=pluginPfx+"_"+d.idx,wrapper=$("#mCSB_"+d.idx+"_container").parent();wrapper.bind("scroll."+namespace,function(e){if(wrapper.scrollTop()!==0||wrapper.scrollLeft()!==0){$(".mCSB_"+d.idx+"_scrollbar").css("visibility","hidden")}})},_buttons=function(){var $this=$(this),d=$this.data(pluginPfx),o=d.opt,seq=d.sequential,namespace=pluginPfx+"_"+d.idx,sel=".mCSB_"+d.idx+"_scrollbar",btn=$(sel+">a");btn.bind("contextmenu."+namespace,function(e){e.preventDefault()}).bind("mousedown."+namespace+" touchstart."+namespace+" pointerdown."+namespace+" MSPointerDown."+namespace+" mouseup."+namespace+" touchend."+namespace+" pointerup."+namespace+" MSPointerUp."+namespace+" mouseout."+namespace+" pointerout."+namespace+" MSPointerOut."+namespace+" click."+namespace,function(e){e.preventDefault();if(!_mouseBtnLeft(e)){return}var btnClass=$(this).attr("class");seq.type=o.scrollButtons.scrollType;switch(e.type){case"mousedown":case"touchstart":case"pointerdown":case"MSPointerDown":if(seq.type==="stepped"){return}touchActive=true;d.tweenRunning=false;_seq("on",btnClass);break;case"mouseup":case"touchend":case"pointerup":case"MSPointerUp":case"mouseout":case"pointerout":case"MSPointerOut":if(seq.type==="stepped"){return}touchActive=false;if(seq.dir){_seq("off",btnClass)}break;case"click":if(seq.type!=="stepped"||d.tweenRunning){return}_seq("on",btnClass);break}function _seq(a,c){seq.scrollAmount=o.scrollButtons.scrollAmount;_sequentialScroll($this,a,c)}})},_keyboard=function(){var $this=$(this),d=$this.data(pluginPfx),o=d.opt,seq=d.sequential,namespace=pluginPfx+"_"+d.idx,mCustomScrollBox=$("#mCSB_"+d.idx),mCSB_container=$("#mCSB_"+d.idx+"_container"),wrapper=mCSB_container.parent(),editables="input,textarea,select,datalist,keygen,[contenteditable='true']",iframe=mCSB_container.find("iframe"),events=["blur."+namespace+" keydown."+namespace+" keyup."+namespace];if(iframe.length){iframe.each(function(){$(this).bind("load",function(){if(_canAccessIFrame(this)){$(this.contentDocument||this.contentWindow.document).bind(events[0],function(e){_onKeyboard(e)})}})})}mCustomScrollBox.attr("tabindex","0").bind(events[0],function(e){_onKeyboard(e)});function _onKeyboard(e){switch(e.type){case"blur":if(d.tweenRunning&&seq.dir){_seq("off",null)}break;case"keydown":case"keyup":var code=e.keyCode?e.keyCode:e.which,action="on";if(o.axis!=="x"&&(code===38||code===40)||o.axis!=="y"&&(code===37||code===39)){if((code===38||code===40)&&!d.overflowed[0]||(code===37||code===39)&&!d.overflowed[1]){return}if(e.type==="keyup"){action="off"}if(!$(document.activeElement).is(editables)){e.preventDefault();e.stopImmediatePropagation();_seq(action,code)}}else if(code===33||code===34){if(d.overflowed[0]||d.overflowed[1]){e.preventDefault();e.stopImmediatePropagation()}if(e.type==="keyup"){_stop($this);var keyboardDir=code===34?-1:1;if(o.axis==="x"||o.axis==="yx"&&d.overflowed[1]&&!d.overflowed[0]){var dir="x",to=Math.abs(mCSB_container[0].offsetLeft)-keyboardDir*(wrapper.width()*.9)}else{var dir="y",to=Math.abs(mCSB_container[0].offsetTop)-keyboardDir*(wrapper.height()*.9)}_scrollTo($this,to.toString(),{dir:dir,scrollEasing:"mcsEaseInOut"})}}else if(code===35||code===36){if(!$(document.activeElement).is(editables)){if(d.overflowed[0]||d.overflowed[1]){e.preventDefault();e.stopImmediatePropagation()}if(e.type==="keyup"){if(o.axis==="x"||o.axis==="yx"&&d.overflowed[1]&&!d.overflowed[0]){var dir="x",to=code===35?Math.abs(wrapper.width()-mCSB_container.outerWidth(false)):0}else{var dir="y",to=code===35?Math.abs(wrapper.height()-mCSB_container.outerHeight(false)):0}_scrollTo($this,to.toString(),{dir:dir,scrollEasing:"mcsEaseInOut"})}}}break}function _seq(a,c){seq.type=o.keyboard.scrollType;seq.scrollAmount=o.keyboard.scrollAmount;if(seq.type==="stepped"&&d.tweenRunning){return}_sequentialScroll($this,a,c)}}},_sequentialScroll=function(el,action,trigger,e,s){var d=el.data(pluginPfx),o=d.opt,seq=d.sequential,mCSB_container=$("#mCSB_"+d.idx+"_container"),once=seq.type==="stepped"?true:false,steplessSpeed=o.scrollInertia<26?26:o.scrollInertia,steppedSpeed=o.scrollInertia<1?17:o.scrollInertia;switch(action){case"on":seq.dir=[trigger===classes[16]||trigger===classes[15]||trigger===39||trigger===37?"x":"y",trigger===classes[13]||trigger===classes[15]||trigger===38||trigger===37?-1:1];_stop(el);if(_isNumeric(trigger)&&seq.type==="stepped"){return}_on(once);break;case"off":_off();if(once||d.tweenRunning&&seq.dir){_on(true)}break}function _on(once){if(o.snapAmount){seq.scrollAmount=!(o.snapAmount instanceof Array)?o.snapAmount:seq.dir[0]==="x"?o.snapAmount[1]:o.snapAmount[0]}var c=seq.type!=="stepped",t=s?s:!once?1e3/60:c?steplessSpeed/1.5:steppedSpeed,m=!once?2.5:c?7.5:40,contentPos=[Math.abs(mCSB_container[0].offsetTop),Math.abs(mCSB_container[0].offsetLeft)],ratio=[d.scrollRatio.y>10?10:d.scrollRatio.y,d.scrollRatio.x>10?10:d.scrollRatio.x],amount=seq.dir[0]==="x"?contentPos[1]+seq.dir[1]*(ratio[1]*m):contentPos[0]+seq.dir[1]*(ratio[0]*m),px=seq.dir[0]==="x"?contentPos[1]+seq.dir[1]*parseInt(seq.scrollAmount):contentPos[0]+seq.dir[1]*parseInt(seq.scrollAmount),to=seq.scrollAmount!=="auto"?px:amount,easing=e?e:!once?"mcsLinear":c?"mcsLinearOut":"mcsEaseInOut",onComplete=!once?false:true;if(once&&t<17){to=seq.dir[0]==="x"?contentPos[1]:contentPos[0]}_scrollTo(el,to.toString(),{dir:seq.dir[0],scrollEasing:easing,dur:t,onComplete:onComplete});if(once){seq.dir=false;return}clearTimeout(seq.step);seq.step=setTimeout(function(){_on()},t)}function _off(){clearTimeout(seq.step);_delete(seq,"step");_stop(el)}},_arr=function(val){var o=$(this).data(pluginPfx).opt,vals=[];if(typeof val==="function"){val=val()}if(!(val instanceof Array)){vals[0]=val.y?val.y:val.x||o.axis==="x"?null:val;vals[1]=val.x?val.x:val.y||o.axis==="y"?null:val}else{vals=val.length>1?[val[0],val[1]]:o.axis==="x"?[null,val[0]]:[val[0],null]}if(typeof vals[0]==="function"){vals[0]=vals[0]()}if(typeof vals[1]==="function"){vals[1]=vals[1]()}return vals},_to=function(val,dir){if(val==null||typeof val=="undefined"){return}var $this=$(this),d=$this.data(pluginPfx),o=d.opt,mCSB_container=$("#mCSB_"+d.idx+"_container"),wrapper=mCSB_container.parent(),t=typeof val;if(!dir){dir=o.axis==="x"?"x":"y"}var contentLength=dir==="x"?mCSB_container.outerWidth(false)-wrapper.width():mCSB_container.outerHeight(false)-wrapper.height(),contentPos=dir==="x"?mCSB_container[0].offsetLeft:mCSB_container[0].offsetTop,cssProp=dir==="x"?"left":"top";switch(t){case"function":return val();break;case"object":var obj=val.jquery?val:$(val);if(!obj.length){return}return dir==="x"?_childPos(obj)[1]:_childPos(obj)[0];break;case"string":case"number":if(_isNumeric(val)){return Math.abs(val)}else if(val.indexOf("%")!==-1){return Math.abs(contentLength*parseInt(val)/100)}else if(val.indexOf("-=")!==-1){return Math.abs(contentPos-parseInt(val.split("-=")[1]))}else if(val.indexOf("+=")!==-1){var p=contentPos+parseInt(val.split("+=")[1]);return p>=0?0:Math.abs(p)}else if(val.indexOf("px")!==-1&&_isNumeric(val.split("px")[0])){return Math.abs(val.split("px")[0])}else{if(val==="top"||val==="left"){return 0}else if(val==="bottom"){return Math.abs(wrapper.height()-mCSB_container.outerHeight(false))}else if(val==="right"){return Math.abs(wrapper.width()-mCSB_container.outerWidth(false))}else if(val==="first"||val==="last"){var obj=mCSB_container.find(":"+val);return dir==="x"?_childPos(obj)[1]:_childPos(obj)[0]}else{if($(val).length){return dir==="x"?_childPos($(val))[1]:_childPos($(val))[0]}else{mCSB_container.css(cssProp,val);methods.update.call(null,$this[0]);return}}}break}},_autoUpdate=function(rem){var $this=$(this),d=$this.data(pluginPfx),o=d.opt,mCSB_container=$("#mCSB_"+d.idx+"_container");if(rem){clearTimeout(mCSB_container[0].autoUpdate);_delete(mCSB_container[0],"autoUpdate");return}upd();function upd(){clearTimeout(mCSB_container[0].autoUpdate);if($this.parents("html").length===0){$this=null;return}mCSB_container[0].autoUpdate=setTimeout(function(){if(o.advanced.updateOnSelectorChange){d.poll.change.n=sizesSum();if(d.poll.change.n!==d.poll.change.o){d.poll.change.o=d.poll.change.n;doUpd(3);return}}if(o.advanced.updateOnContentResize){d.poll.size.n=$this[0].scrollHeight+$this[0].scrollWidth+mCSB_container[0].offsetHeight+$this[0].offsetHeight+$this[0].offsetWidth;if(d.poll.size.n!==d.poll.size.o){d.poll.size.o=d.poll.size.n;doUpd(1);return}}if(o.advanced.updateOnImageLoad){if(!(o.advanced.updateOnImageLoad==="auto"&&o.axis==="y")){d.poll.img.n=mCSB_container.find("img").length;if(d.poll.img.n!==d.poll.img.o){d.poll.img.o=d.poll.img.n;mCSB_container.find("img").each(function(){imgLoader(this)});return}}}if(o.advanced.updateOnSelectorChange||o.advanced.updateOnContentResize||o.advanced.updateOnImageLoad){upd()}},o.advanced.autoUpdateTimeout)}function imgLoader(el){if($(el).hasClass(classes[2])){doUpd();return}var img=new Image;function createDelegate(contextObject,delegateMethod){return function(){return delegateMethod.apply(contextObject,arguments)}}function imgOnLoad(){this.onload=null;$(el).addClass(classes[2]);doUpd(2)}img.onload=createDelegate(img,imgOnLoad);img.src=el.src}function sizesSum(){if(o.advanced.updateOnSelectorChange===true){o.advanced.updateOnSelectorChange="*"}var total=0,sel=mCSB_container.find(o.advanced.updateOnSelectorChange);if(o.advanced.updateOnSelectorChange&&sel.length>0){sel.each(function(){total+=this.offsetHeight+this.offsetWidth})}return total}function doUpd(cb){clearTimeout(mCSB_container[0].autoUpdate);methods.update.call(null,$this[0],cb)}},_snapAmount=function(to,amount,offset){return Math.round(to/amount)*amount-offset},_stop=function(el){var d=el.data(pluginPfx),sel=$("#mCSB_"+d.idx+"_container,#mCSB_"+d.idx+"_container_wrapper,#mCSB_"+d.idx+"_dragger_vertical,#mCSB_"+d.idx+"_dragger_horizontal");sel.each(function(){_stopTween.call(this)})},_scrollTo=function(el,to,options){var d=el.data(pluginPfx),o=d.opt,defaults={trigger:"internal",dir:"y",scrollEasing:"mcsEaseOut",drag:false,dur:o.scrollInertia,overwrite:"all",callbacks:true,onStart:true,onUpdate:true,onComplete:true},options=$.extend(defaults,options),dur=[options.dur,options.drag?0:options.dur],mCustomScrollBox=$("#mCSB_"+d.idx),mCSB_container=$("#mCSB_"+d.idx+"_container"),wrapper=mCSB_container.parent(),totalScrollOffsets=o.callbacks.onTotalScrollOffset?_arr.call(el,o.callbacks.onTotalScrollOffset):[0,0],totalScrollBackOffsets=o.callbacks.onTotalScrollBackOffset?_arr.call(el,o.callbacks.onTotalScrollBackOffset):[0,0];d.trigger=options.trigger;if(wrapper.scrollTop()!==0||wrapper.scrollLeft()!==0){$(".mCSB_"+d.idx+"_scrollbar").css("visibility","visible");wrapper.scrollTop(0).scrollLeft(0)}if(to==="_resetY"&&!d.contentReset.y){if(_cb("onOverflowYNone")){o.callbacks.onOverflowYNone.call(el[0])}d.contentReset.y=1}if(to==="_resetX"&&!d.contentReset.x){if(_cb("onOverflowXNone")){o.callbacks.onOverflowXNone.call(el[0])}d.contentReset.x=1}if(to==="_resetY"||to==="_resetX"){return}if((d.contentReset.y||!el[0].mcs)&&d.overflowed[0]){if(_cb("onOverflowY")){o.callbacks.onOverflowY.call(el[0])}d.contentReset.x=null}if((d.contentReset.x||!el[0].mcs)&&d.overflowed[1]){if(_cb("onOverflowX")){o.callbacks.onOverflowX.call(el[0])}d.contentReset.x=null}if(o.snapAmount){var snapAmount=!(o.snapAmount instanceof Array)?o.snapAmount:options.dir==="x"?o.snapAmount[1]:o.snapAmount[0];to=_snapAmount(to,snapAmount,o.snapOffset)}switch(options.dir){case"x":var mCSB_dragger=$("#mCSB_"+d.idx+"_dragger_horizontal"),property="left",contentPos=mCSB_container[0].offsetLeft,limit=[mCustomScrollBox.width()-mCSB_container.outerWidth(false),mCSB_dragger.parent().width()-mCSB_dragger.width()],scrollTo=[to,to===0?0:to/d.scrollRatio.x],tso=totalScrollOffsets[1],tsbo=totalScrollBackOffsets[1],totalScrollOffset=tso>0?tso/d.scrollRatio.x:0,totalScrollBackOffset=tsbo>0?tsbo/d.scrollRatio.x:0;break;case"y":var mCSB_dragger=$("#mCSB_"+d.idx+"_dragger_vertical"),property="top",contentPos=mCSB_container[0].offsetTop,limit=[mCustomScrollBox.height()-mCSB_container.outerHeight(false),mCSB_dragger.parent().height()-mCSB_dragger.height()],scrollTo=[to,to===0?0:to/d.scrollRatio.y],tso=totalScrollOffsets[0],tsbo=totalScrollBackOffsets[0],totalScrollOffset=tso>0?tso/d.scrollRatio.y:0,totalScrollBackOffset=tsbo>0?tsbo/d.scrollRatio.y:0;break}if(scrollTo[1]<0||scrollTo[0]===0&&scrollTo[1]===0){scrollTo=[0,0]}else if(scrollTo[1]>=limit[1]){scrollTo=[limit[0],limit[1]]}else{scrollTo[0]=-scrollTo[0]}if(!el[0].mcs){_mcs();if(_cb("onInit")){o.callbacks.onInit.call(el[0])}}clearTimeout(mCSB_container[0].onCompleteTimeout);_tweenTo(mCSB_dragger[0],property,Math.round(scrollTo[1]),dur[1],options.scrollEasing);if(!d.tweenRunning&&(contentPos===0&&scrollTo[0]>=0||contentPos===limit[0]&&scrollTo[0]<=limit[0])){return}_tweenTo(mCSB_container[0],property,Math.round(scrollTo[0]),dur[0],options.scrollEasing,options.overwrite,{onStart:function(){if(options.callbacks&&options.onStart&&!d.tweenRunning){if(_cb("onScrollStart")){_mcs();o.callbacks.onScrollStart.call(el[0])}d.tweenRunning=true;_onDragClasses(mCSB_dragger);d.cbOffsets=_cbOffsets()}},onUpdate:function(){if(options.callbacks&&options.onUpdate){if(_cb("whileScrolling")){_mcs();o.callbacks.whileScrolling.call(el[0])}}},onComplete:function(){if(options.callbacks&&options.onComplete){if(o.axis==="yx"){clearTimeout(mCSB_container[0].onCompleteTimeout)}var t=mCSB_container[0].idleTimer||0;mCSB_container[0].onCompleteTimeout=setTimeout(function(){if(_cb("onScroll")){_mcs();o.callbacks.onScroll.call(el[0])}if(_cb("onTotalScroll")&&scrollTo[1]>=limit[1]-totalScrollOffset&&d.cbOffsets[0]){_mcs();o.callbacks.onTotalScroll.call(el[0])}if(_cb("onTotalScrollBack")&&scrollTo[1]<=totalScrollBackOffset&&d.cbOffsets[1]){_mcs();o.callbacks.onTotalScrollBack.call(el[0])}d.tweenRunning=false;mCSB_container[0].idleTimer=0;_onDragClasses(mCSB_dragger,"hide")},t)}}});function _cb(cb){return d&&o.callbacks[cb]&&typeof o.callbacks[cb]==="function"}function _cbOffsets(){return[o.callbacks.alwaysTriggerOffsets||contentPos>=limit[0]+tso,o.callbacks.alwaysTriggerOffsets||contentPos<=-tsbo]}function _mcs(){var cp=[mCSB_container[0].offsetTop,mCSB_container[0].offsetLeft],dp=[mCSB_dragger[0].offsetTop,mCSB_dragger[0].offsetLeft],cl=[mCSB_container.outerHeight(false),mCSB_container.outerWidth(false)],pl=[mCustomScrollBox.height(),mCustomScrollBox.width()];el[0].mcs={content:mCSB_container,top:cp[0],left:cp[1],draggerTop:dp[0],draggerLeft:dp[1],topPct:Math.round(100*Math.abs(cp[0])/(Math.abs(cl[0])-pl[0])),leftPct:Math.round(100*Math.abs(cp[1])/(Math.abs(cl[1])-pl[1])),direction:options.dir}}},_tweenTo=function(el,prop,to,duration,easing,overwrite,callbacks){if(!el._mTween){el._mTween={top:{},left:{}}}var callbacks=callbacks||{},onStart=callbacks.onStart||function(){},onUpdate=callbacks.onUpdate||function(){},onComplete=callbacks.onComplete||function(){},startTime=_getTime(),_delay,progress=0,from=el.offsetTop,elStyle=el.style,_request,tobj=el._mTween[prop];if(prop==="left"){from=el.offsetLeft}var diff=to-from;tobj.stop=0;if(overwrite!=="none"){_cancelTween()}_startTween();function _step(){if(tobj.stop){return}if(!progress){onStart.call()}progress=_getTime()-startTime;_tween();if(progress>=tobj.time){tobj.time=progress>tobj.time?progress+_delay-(progress-tobj.time):progress+_delay-1;if(tobj.time<progress+1){tobj.time=progress+1}}if(tobj.time<duration){tobj.id=_request(_step)}else{onComplete.call()}}function _tween(){if(duration>0){tobj.currVal=_ease(tobj.time,from,diff,duration,easing);elStyle[prop]=Math.round(tobj.currVal)+"px"}else{elStyle[prop]=to+"px"}onUpdate.call()}function _startTween(){_delay=1e3/60;tobj.time=progress+_delay;_request=!window.requestAnimationFrame?function(f){_tween();return setTimeout(f,.01)}:window.requestAnimationFrame;tobj.id=_request(_step)}function _cancelTween(){if(tobj.id==null){return}if(!window.requestAnimationFrame){clearTimeout(tobj.id)}else{window.cancelAnimationFrame(tobj.id)}tobj.id=null}function _ease(t,b,c,d,type){switch(type){case"linear":case"mcsLinear":return c*t/d+b;break;case"mcsLinearOut":t/=d;t--;return c*Math.sqrt(1-t*t)+b;break;case"easeInOutSmooth":t/=d/2;if(t<1)return c/2*t*t+b;t--;return-c/2*(t*(t-2)-1)+b;break;case"easeInOutStrong":t/=d/2;if(t<1)return c/2*Math.pow(2,10*(t-1))+b;t--;return c/2*(-Math.pow(2,-10*t)+2)+b;break;case"easeInOut":case"mcsEaseInOut":t/=d/2;if(t<1)return c/2*t*t*t+b;t-=2;return c/2*(t*t*t+2)+b;break;case"easeOutSmooth":t/=d;t--;return-c*(t*t*t*t-1)+b;break;case"easeOutStrong":return c*(-Math.pow(2,-10*t/d)+1)+b;break;case"easeOut":case"mcsEaseOut":default:var ts=(t/=d)*t,tc=ts*t;return b+c*(.499999999999997*tc*ts+-2.5*ts*ts+5.5*tc+-6.5*ts+4*t)}}},_getTime=function(){if(window.performance&&window.performance.now){return window.performance.now()}else{if(window.performance&&window.performance.webkitNow){return window.performance.webkitNow()}else{if(Date.now){return Date.now()}else{return(new Date).getTime()}}}},_stopTween=function(){var el=this;if(!el._mTween){el._mTween={top:{},left:{}}}var props=["top","left"];for(var i=0;i<props.length;i++){var prop=props[i];if(el._mTween[prop].id){if(!window.requestAnimationFrame){clearTimeout(el._mTween[prop].id)}else{window.cancelAnimationFrame(el._mTween[prop].id)}el._mTween[prop].id=null;el._mTween[prop].stop=1}}},_delete=function(c,m){try{delete c[m]}catch(e){c[m]=null}},_mouseBtnLeft=function(e){return!(e.which&&e.which!==1)},_pointerTouch=function(e){var t=e.originalEvent.pointerType;return!(t&&t!=="touch"&&t!==2)},_isNumeric=function(val){return!isNaN(parseFloat(val))&&isFinite(val)},_childPos=function(el){var p=el.parents(".mCSB_container");return[el.offset().top-p.offset().top,el.offset().left-p.offset().left]},_isTabHidden=function(){var prop=_getHiddenProp();if(!prop)return false;return document[prop];function _getHiddenProp(){var pfx=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var i=0;i<pfx.length;i++){if(pfx[i]+"Hidden"in document)return pfx[i]+"Hidden"}return null}};$.fn[pluginNS]=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist")}};$[pluginNS]=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist")}};$[pluginNS].defaults=defaults;window[pluginNS]=true;$(window).bind("load",function(){$(defaultSelector)[pluginNS]();$.extend($.expr[":"],{mcsInView:$.expr[":"].mcsInView||function(el){var $el=$(el),content=$el.parents(".mCSB_container"),wrapper,cPos;if(!content.length){return}wrapper=content.parent();cPos=[content[0].offsetTop,content[0].offsetLeft];return cPos[0]+_childPos($el)[0]>=0&&cPos[0]+_childPos($el)[0]<wrapper.height()-$el.outerHeight(false)&&cPos[1]+_childPos($el)[1]>=0&&cPos[1]+_childPos($el)[1]<wrapper.width()-$el.outerWidth(false)},mcsInSight:$.expr[":"].mcsInSight||function(el,i,m){var $el=$(el),elD,content=$el.parents(".mCSB_container"),wrapperView,pos,wrapperViewPct,pctVals=m[3]==="exact"?[[1,0],[1,0]]:[[.9,.1],[.6,.4]];if(!content.length){return}elD=[$el.outerHeight(false),$el.outerWidth(false)];pos=[content[0].offsetTop+_childPos($el)[0],content[0].offsetLeft+_childPos($el)[1]];wrapperView=[content.parent()[0].offsetHeight,content.parent()[0].offsetWidth];wrapperViewPct=[elD[0]<wrapperView[0]?pctVals[0]:pctVals[1],elD[1]<wrapperView[1]?pctVals[0]:pctVals[1]];return pos[0]-wrapperView[0]*wrapperViewPct[0][0]<0&&pos[0]+elD[0]-wrapperView[0]*wrapperViewPct[0][1]>=0&&pos[1]-wrapperView[1]*wrapperViewPct[1][0]<0&&pos[1]+elD[1]-wrapperView[1]*wrapperViewPct[1][1]>=0},mcsOverflow:$.expr[":"].mcsOverflow||function(el){var d=$(el).data(pluginPfx);if(!d){return}return d.overflowed[0]||d.overflowed[1]}})})})});!function(h){h.extend({tablesorter:new function(){function d(){var b=arguments[0],a=1<arguments.length?Array.prototype.slice.call(arguments):b;if("undefined"!==typeof console&&"undefined"!==typeof console.log)console[/error/i.test(b)?"error":/warn/i.test(b)?"warn":"log"](a);else alert(a)}function r(b,a){d(b+" ("+((new Date).getTime()-a.getTime())+"ms)")}function k(b){for(var a in b)return!1;return!0}function v(b,a,c){if(!a)return"";var f,e=b.config,m=e.textExtraction||"",d="",d="basic"===m?h(a).attr(e.textAttribute)||a.textContent||a.innerText||h(a).text()||"":"function"===typeof m?m(a,b,c):"function"===typeof(f=g.getColumnData(b,m,c))?f(a,b,c):a.textContent||a.innerText||h(a).text()||"";return h.trim(d)}function p(b){var a,c,f=b.config,e=f.$tbodies=f.$table.children("tbody:not(."+f.cssInfoBlock+")"),m,x,l,n,w,u,k,q,t,D=0,A="",y=e.length;if(0===y)return f.debug?d("Warning: *Empty table!* Not building a parser cache"):"";f.debug&&(t=new Date,d("Detecting parsers for each column"));a=[];for(c=[];D<y;){m=e[D].rows;if(m[D])for(x=f.columns,l=0;l<x;l++){n=f.$headers.filter('[data-column="'+l+'"]:last');w=g.getColumnData(b,f.headers,l);q=g.getParserById(g.getData(n,w,"extractor"));k=g.getParserById(g.getData(n,w,"sorter"));u="false"===g.getData(n,w,"parser");f.empties[l]=(g.getData(n,w,"empty")||f.emptyTo||(f.emptyToBottom?"bottom":"top")).toLowerCase();f.strings[l]=(g.getData(n,w,"string")||f.stringTo||"max").toLowerCase();u&&(k=g.getParserById("no-parser"));q||(q=!1);if(!k)a:{n=b;w=m;u=-1;k=l;for(var C=void 0,L=void 0,M=g.parsers.length,z=!1,B="",C=!0;""===B&&C;)u++,w[u]?(z=w[u].cells[k],B=v(n,z,k),L=h(z),n.config.debug&&d("Checking if value was empty on row "+u+", column: "+k+': "'+B+'"')):C=!1;for(;0<=--M;)if((C=g.parsers[M])&&"text"!==C.id&&C.is&&C.is(B,n,z,L)){k=C;break a}k=g.getParserById("text")}f.debug&&(A+="column:"+l+"; extractor:"+q.id+"; parser:"+k.id+"; string:"+f.strings[l]+"; empty: "+f.empties[l]+"\n");c[l]=k;a[l]=q}D+=c.length?y:1}f.debug&&(d(A?A:"No parsers detected"),r("Completed detecting parsers",t));f.parsers=c;f.extractors=a}function y(b){var a,c,f,e,m,x,l,n,w,u,k,q=b.config,t=q.$table.children("tbody"),p=q.extractors,A=q.parsers;q.cache={};q.totalRows=0;if(!A)return q.debug?d("Warning: *Empty table!* Not building a cache"):"";q.debug&&(n=new Date);q.showProcessing&&g.isProcessing(b,!0);for(m=0;m<t.length;m++)if(k=[],a=q.cache[m]={normalized:[]},!t.eq(m).hasClass(q.cssInfoBlock)){w=t[m]&&t[m].rows.length||0;for(f=0;f<w;++f)if(u={child:[]},x=h(t[m].rows[f]),l=[],x.hasClass(q.cssChildRow)&&0!==f)c=a.normalized.length-1,a.normalized[c][q.columns].$row=a.normalized[c][q.columns].$row.add(x),x.prev().hasClass(q.cssChildRow)||x.prev().addClass(g.css.cssHasChild),u.child[c]=h.trim(x[0].textContent||x[0].innerText||x.text()||"");else{u.$row=x;u.order=f;for(e=0;e<q.columns;++e)"undefined"===typeof A[e]?q.debug&&d("No parser found for cell:",x[0].cells[e],"does it have a header?"):(c=v(b,x[0].cells[e],e),c="undefined"===typeof p[e].id?c:p[e].format(c,b,x[0].cells[e],e),c="no-parser"===A[e].id?"":A[e].format(c,b,x[0].cells[e],e),l.push(q.ignoreCase&&"string"===typeof c?c.toLowerCase():c),"numeric"===(A[e].type||"").toLowerCase()&&(k[e]=Math.max(Math.abs(c)||0,k[e]||0)));l[q.columns]=u;a.normalized.push(l)}a.colMax=k;q.totalRows+=a.normalized.length}q.showProcessing&&g.isProcessing(b);q.debug&&r("Building cache for "+w+" rows",n)}function B(b,a){var c=b.config,f=c.widgetOptions,e=b.tBodies,m=[],d=c.cache,l,n,w,u,p,q;if(k(d))return c.appender?c.appender(b,m):b.isUpdating?c.$table.trigger("updateComplete",b):"";c.debug&&(q=new Date);for(p=0;p<e.length;p++)if(l=h(e[p]),l.length&&!l.hasClass(c.cssInfoBlock)){w=g.processTbody(b,l,!0);l=d[p].normalized;n=l.length;for(u=0;u<n;u++)m.push(l[u][c.columns].$row),c.appender&&(!c.pager||c.pager.removeRows&&f.pager_removeRows||c.pager.ajax)||w.append(l[u][c.columns].$row);g.processTbody(b,w,!1)}c.appender&&c.appender(b,m);c.debug&&r("Rebuilt table",q);a||c.appender||g.applyWidget(b);b.isUpdating&&c.$table.trigger("updateComplete",b)}function F(b){return/^d/i.test(b)||1===b}function E(b){var a,c,f,e,m,x,l,n=b.config;n.headerList=[];n.headerContent=[];n.debug&&(l=new Date);n.columns=g.computeColumnIndex(n.$table.children("thead, tfoot").children("tr"));e=n.cssIcon?'<i class="'+(n.cssIcon===g.css.icon?g.css.icon:n.cssIcon+" "+g.css.icon)+'"></i>':"";n.$headers=h(h.map(h(b).find(n.selectorHeaders),function(l,d){c=h(l);if(!c.parent().hasClass(n.cssIgnoreRow))return a=g.getColumnData(b,n.headers,d,!0),n.headerContent[d]=c.html(),""!==n.headerTemplate&&(m=n.headerTemplate.replace(/\{content\}/g,c.html()).replace(/\{icon\}/g,e),n.onRenderTemplate&&(f=n.onRenderTemplate.apply(c,[d,m]))&&"string"===typeof f&&(m=f),c.html('<div class="'+g.css.headerIn+'">'+m+"</div>")),n.onRenderHeader&&n.onRenderHeader.apply(c,[d,n,n.$table]),l.column=parseInt(c.attr("data-column"),10),l.order=F(g.getData(c,a,"sortInitialOrder")||n.sortInitialOrder)?[1,0,2]:[0,1,2],l.count=-1,l.lockedOrder=!1,x=g.getData(c,a,"lockedOrder")||!1,"undefined"!==typeof x&&!1!==x&&(l.order=l.lockedOrder=F(x)?[1,1,1]:[0,0,0]),c.addClass(g.css.header+" "+n.cssHeader),n.headerList[d]=l,c.parent().addClass(g.css.headerRow+" "+n.cssHeaderRow).attr("role","row"),n.tabIndex&&c.attr("tabindex",0),l}));h(b).find(n.selectorHeaders).attr({scope:"col",role:"columnheader"});H(b);n.debug&&(r("Built headers:",l),d(n.$headers))}function I(b,a,c){var f=b.config;f.$table.find(f.selectorRemove).remove();p(b);y(b);J(f.$table,a,c)}function H(b){var a,c,f,e=b.config;e.$headers.each(function(m,d){c=h(d);f=g.getColumnData(b,e.headers,m,!0);a="false"===g.getData(d,f,"sorter")||"false"===g.getData(d,f,"parser");d.sortDisabled=a;c[a?"addClass":"removeClass"]("sorter-false").attr("aria-disabled",""+a);b.id&&(a?c.removeAttr("aria-controls"):c.attr("aria-controls",b.id))})}function G(b){var a,c,f=b.config,e=f.sortList,m=e.length,d=g.css.sortNone+" "+f.cssNone,l=[g.css.sortAsc+" "+f.cssAsc,g.css.sortDesc+" "+f.cssDesc],n=[f.cssIconAsc,f.cssIconDesc,f.cssIconNone],w=["ascending","descending"],k=h(b).find("tfoot tr").children().add(f.$extraHeaders).removeClass(l.join(" "));f.$headers.removeClass(l.join(" ")).addClass(d).attr("aria-sort","none").find("."+f.cssIcon).removeClass(n.join(" ")).addClass(n[2]);for(a=0;a<m;a++)if(2!==e[a][1]&&(b=f.$headers.not(".sorter-false").filter('[data-column="'+e[a][0]+'"]'+(1===m?":last":"")),b.length)){for(c=0;c<b.length;c++)b[c].sortDisabled||b.eq(c).removeClass(d).addClass(l[e[a][1]]).attr("aria-sort",w[e[a][1]]).find("."+f.cssIcon).removeClass(n[2]).addClass(n[e[a][1]]);k.length&&k.filter('[data-column="'+e[a][0]+'"]').removeClass(d).addClass(l[e[a][1]])}f.$headers.not(".sorter-false").each(function(){var b=h(this),a=this.order[(this.count+1)%(f.sortReset?3:2)],a=b.text()+": "+g.language[b.hasClass(g.css.sortAsc)?"sortAsc":b.hasClass(g.css.sortDesc)?"sortDesc":"sortNone"]+g.language[0===a?"nextAsc":1===a?"nextDesc":"nextNone"];b.attr("aria-label",a)})}function Q(b){var a,c,f=b.config;f.widthFixed&&0===f.$table.children("colgroup").length&&(a=h("<colgroup>"),c=h(b).width(),h(b.tBodies).not("."+f.cssInfoBlock).find("tr:first").children(":visible").each(function(){a.append(h("<col>").css("width",parseInt(h(this).width()/c*1e3,10)/10+"%"))}),f.$table.prepend(a))}function R(b,a){var c,f,e,m,g,l=b.config,d=a||l.sortList;l.sortList=[];h.each(d,function(b,a){m=parseInt(a[0],10);if(e=l.$headers.filter('[data-column="'+m+'"]:last')[0]){f=(f=(""+a[1]).match(/^(1|d|s|o|n)/))?f[0]:"";switch(f){case"1":case"d":f=1;break;case"s":f=g||0;break;case"o":c=e.order[(g||0)%(l.sortReset?3:2)];f=0===c?1:1===c?0:2;break;case"n":e.count+=1;f=e.order[e.count%(l.sortReset?3:2)];break;default:f=0}g=0===b?f:g;c=[m,parseInt(f,10)||0];l.sortList.push(c);f=h.inArray(c[1],e.order);e.count=0<=f?f:c[1]%(l.sortReset?3:2)}})}function S(b,a){return b&&b[a]?b[a].type||"":""}function N(b,a,c){if(b.isUpdating)return setTimeout(function(){N(b,a,c)},50);var f,e,m,d,l=b.config,n=!c[l.sortMultiSortKey],w=l.$table;w.trigger("sortStart",b);a.count=c[l.sortResetKey]?2:(a.count+1)%(l.sortReset?3:2);l.sortRestart&&(e=a,l.$headers.each(function(){this===e||!n&&h(this).is("."+g.css.sortDesc+",."+g.css.sortAsc)||(this.count=-1)}));e=parseInt(h(a).attr("data-column"),10);if(n){l.sortList=[];if(null!==l.sortForce)for(f=l.sortForce,m=0;m<f.length;m++)f[m][0]!==e&&l.sortList.push(f[m]);f=a.order[a.count];if(2>f&&(l.sortList.push([e,f]),1<a.colSpan))for(m=1;m<a.colSpan;m++)l.sortList.push([e+m,f])}else{if(l.sortAppend&&1<l.sortList.length)for(m=0;m<l.sortAppend.length;m++)d=g.isValueInArray(l.sortAppend[m][0],l.sortList),0<=d&&l.sortList.splice(d,1);if(0<=g.isValueInArray(e,l.sortList))for(m=0;m<l.sortList.length;m++)d=l.sortList[m],f=l.$headers.filter('[data-column="'+d[0]+'"]:last')[0],d[0]===e&&(d[1]=f.order[a.count],2===d[1]&&(l.sortList.splice(m,1),f.count=-1));else if(f=a.order[a.count],2>f&&(l.sortList.push([e,f]),1<a.colSpan))for(m=1;m<a.colSpan;m++)l.sortList.push([e+m,f])}if(null!==l.sortAppend)for(f=l.sortAppend,m=0;m<f.length;m++)f[m][0]!==e&&l.sortList.push(f[m]);w.trigger("sortBegin",b);setTimeout(function(){G(b);K(b);B(b);w.trigger("sortEnd",b)},1)}function K(b){var a,c,f,e,m,d,l,n,h,u,p,q=0,t=b.config,v=t.textSorter||"",A=t.sortList,z=A.length,y=b.tBodies.length;if(!t.serverSideSorting&&!k(t.cache)){t.debug&&(m=new Date);for(c=0;c<y;c++)d=t.cache[c].colMax,l=t.cache[c].normalized,l.sort(function(c,m){for(a=0;a<z;a++){e=A[a][0];n=A[a][1];q=0===n;if(t.sortStable&&c[e]===m[e]&&1===z)break;(f=/n/i.test(S(t.parsers,e)))&&t.strings[e]?(f="boolean"===typeof t.string[t.strings[e]]?(q?1:-1)*(t.string[t.strings[e]]?-1:1):t.strings[e]?t.string[t.strings[e]]||0:0,h=t.numberSorter?t.numberSorter(c[e],m[e],q,d[e],b):g["sortNumeric"+(q?"Asc":"Desc")](c[e],m[e],f,d[e],e,b)):(u=q?c:m,p=q?m:c,h="function"===typeof v?v(u[e],p[e],q,e,b):"object"===typeof v&&v.hasOwnProperty(e)?v[e](u[e],p[e],q,e,b):g["sortNatural"+(q?"Asc":"Desc")](c[e],m[e],e,b,t));if(h)return h}return c[t.columns].order-m[t.columns].order});t.debug&&r("Sorting on "+A.toString()+" and dir "+n+" time",m)}}function O(b,a){var c=b[0];c.isUpdating&&b.trigger("updateComplete",c);h.isFunction(a)&&a(b[0])}function J(b,a,c){var f=b[0].config.sortList;!1!==a&&!b[0].isProcessing&&f.length?b.trigger("sorton",[f,function(){O(b,c)},!0]):(O(b,c),g.applyWidget(b[0],!1))}function P(b){var a=b.config,c=a.$table;c.unbind("sortReset update updateRows updateCell updateAll addRows updateComplete sorton appendCache updateCache applyWidgetId applyWidgets refreshWidgets destroy mouseup mouseleave ".split(" ").join(a.namespace+" ")).bind("sortReset"+a.namespace,function(c,e){c.stopPropagation();a.sortList=[];G(b);K(b);B(b);h.isFunction(e)&&e(b)}).bind("updateAll"+a.namespace,function(c,e,m){c.stopPropagation();b.isUpdating=!0;g.refreshWidgets(b,!0,!0);g.restoreHeaders(b);E(b);g.bindEvents(b,a.$headers,!0);P(b);I(b,e,m)}).bind("update"+a.namespace+" updateRows"+a.namespace,function(a,c,m){a.stopPropagation();b.isUpdating=!0;H(b);I(b,c,m)}).bind("updateCell"+a.namespace,function(f,e,m,g){f.stopPropagation();b.isUpdating=!0;c.find(a.selectorRemove).remove();var l,d,k;d=c.find("tbody");k=h(e);f=d.index(h.fn.closest?k.closest("tbody"):k.parents("tbody").filter(":first"));l=h.fn.closest?k.closest("tr"):k.parents("tr").filter(":first");e=k[0];d.length&&0<=f&&(d=d.eq(f).find("tr").index(l),k=k.index(),a.cache[f].normalized[d][a.columns].$row=l,l="undefined"===typeof a.extractors[k].id?v(b,e,k):a.extractors[k].format(v(b,e,k),b,e,k),e="no-parser"===a.parsers[k].id?"":a.parsers[k].format(l,b,e,k),a.cache[f].normalized[d][k]=a.ignoreCase&&"string"===typeof e?e.toLowerCase():e,"numeric"===(a.parsers[k].type||"").toLowerCase()&&(a.cache[f].colMax[k]=Math.max(Math.abs(e)||0,a.cache[f].colMax[k]||0)),J(c,m,g))}).bind("addRows"+a.namespace,function(f,e,m,g){f.stopPropagation();b.isUpdating=!0;if(k(a.cache))H(b),I(b,m,g);else{e=h(e).attr("role","row");var d,n,r,u,y,q=e.filter("tr").length,t=c.find("tbody").index(e.parents("tbody").filter(":first"));a.parsers&&a.parsers.length||p(b);for(f=0;f<q;f++){n=e[f].cells.length;y=[];u={child:[],$row:e.eq(f),order:a.cache[t].normalized.length};for(d=0;d<n;d++)r="undefined"===typeof a.extractors[d].id?v(b,e[f].cells[d],d):a.extractors[d].format(v(b,e[f].cells[d],d),b,e[f].cells[d],d),r="no-parser"===a.parsers[d].id?"":a.parsers[d].format(r,b,e[f].cells[d],d),y[d]=a.ignoreCase&&"string"===typeof r?r.toLowerCase():r,"numeric"===(a.parsers[d].type||"").toLowerCase()&&(a.cache[t].colMax[d]=Math.max(Math.abs(y[d])||0,a.cache[t].colMax[d]||0));y.push(u);a.cache[t].normalized.push(y)}J(c,m,g)}}).bind("updateComplete"+a.namespace,function(){b.isUpdating=!1}).bind("sorton"+a.namespace,function(a,e,m,d){var l=b.config;a.stopPropagation();c.trigger("sortStart",this);R(b,e);G(b);l.delayInit&&k(l.cache)&&y(b);c.trigger("sortBegin",this);K(b);B(b,d);c.trigger("sortEnd",this);g.applyWidget(b);h.isFunction(m)&&m(b)}).bind("appendCache"+a.namespace,function(a,c,d){a.stopPropagation();B(b,d);h.isFunction(c)&&c(b)}).bind("updateCache"+a.namespace,function(c,e){a.parsers&&a.parsers.length||p(b);y(b);h.isFunction(e)&&e(b)}).bind("applyWidgetId"+a.namespace,function(c,e){c.stopPropagation();g.getWidgetById(e).format(b,a,a.widgetOptions)}).bind("applyWidgets"+a.namespace,function(a,c){a.stopPropagation();g.applyWidget(b,c)}).bind("refreshWidgets"+a.namespace,function(a,c,d){a.stopPropagation();g.refreshWidgets(b,c,d)}).bind("destroy"+a.namespace,function(a,c,d){a.stopPropagation();g.destroy(b,c,d)}).bind("resetToLoadState"+a.namespace,function(){g.refreshWidgets(b,!0,!0);a=h.extend(!0,g.defaults,a.originalSettings);b.hasInitialized=!1;g.setup(b,a)})}var g=this;g.version="2.18.4";g.parsers=[];g.widgets=[];g.defaults={theme:"default",widthFixed:!1,showProcessing:!1,headerTemplate:"{content}",onRenderTemplate:null,onRenderHeader:null,cancelSelection:!0,tabIndex:!0,dateFormat:"mmddyyyy",sortMultiSortKey:"shiftKey",sortResetKey:"ctrlKey",usNumberFormat:!0,delayInit:!1,serverSideSorting:!1,headers:{},ignoreCase:!0,sortForce:null,sortList:[],sortAppend:null,sortStable:!1,sortInitialOrder:"asc",sortLocaleCompare:!1,sortReset:!1,sortRestart:!1,emptyTo:"bottom",stringTo:"max",textExtraction:"basic",textAttribute:"data-text",textSorter:null,numberSorter:null,widgets:[],widgetOptions:{zebra:["even","odd"]},initWidgets:!0,widgetClass:"widget-{name}",initialized:null,tableClass:"",cssAsc:"",cssDesc:"",cssNone:"",cssHeader:"",cssHeaderRow:"",cssProcessing:"",cssChildRow:"tablesorter-childRow",cssIcon:"tablesorter-icon",cssIconNone:"",cssIconAsc:"",cssIconDesc:"",cssInfoBlock:"tablesorter-infoOnly",cssAllowClicks:"tablesorter-allowClicks",cssIgnoreRow:"tablesorter-ignoreRow",selectorHeaders:"> thead th, > thead td",selectorSort:"th, td",selectorRemove:".remove-me",debug:!1,headerList:[],empties:{},strings:{},parsers:[]};g.css={table:"tablesorter",cssHasChild:"tablesorter-hasChildRow",childRow:"tablesorter-childRow",header:"tablesorter-header",headerRow:"tablesorter-headerRow",headerIn:"tablesorter-header-inner",icon:"tablesorter-icon",info:"tablesorter-infoOnly",processing:"tablesorter-processing",sortAsc:"tablesorter-headerAsc",sortDesc:"tablesorter-headerDesc",sortNone:"tablesorter-headerUnSorted"};g.language={sortAsc:"Ascending sort applied, ",sortDesc:"Descending sort applied, ",sortNone:"No sort applied, ",nextAsc:"activate to apply an ascending sort",nextDesc:"activate to apply a descending sort",nextNone:"activate to remove the sort"};g.log=d;g.benchmark=r;g.construct=function(b){return this.each(function(){var a=h.extend(!0,{},g.defaults,b);a.originalSettings=b;!this.hasInitialized&&g.buildTable&&"TABLE"!==this.tagName?g.buildTable(this,a):g.setup(this,a)})};g.setup=function(b,a){if(!b||!b.tHead||0===b.tBodies.length||!0===b.hasInitialized)return a.debug?d("ERROR: stopping initialization! No table, thead, tbody or tablesorter has already been initialized"):"";var c="",f=h(b),e=h.metadata;b.hasInitialized=!1;b.isProcessing=!0;b.config=a;h.data(b,"tablesorter",a);a.debug&&h.data(b,"startoveralltimer",new Date);a.supportsDataObject=function(a){a[0]=parseInt(a[0],10);return 1<a[0]||1===a[0]&&4<=parseInt(a[1],10)}(h.fn.jquery.split("."));a.string={max:1,min:-1,emptymin:1,emptymax:-1,zero:0,none:0,null:0,top:!0,bottom:!1};a.emptyTo=a.emptyTo.toLowerCase();a.stringTo=a.stringTo.toLowerCase();/tablesorter\-/.test(f.attr("class"))||(c=""!==a.theme?" tablesorter-"+a.theme:"");a.table=b;a.$table=f.addClass(g.css.table+" "+a.tableClass+c).attr("role","grid");a.$headers=f.find(a.selectorHeaders);a.namespace=a.namespace?"."+a.namespace.replace(/\W/g,""):".tablesorter"+Math.random().toString(16).slice(2);a.$table.children().children("tr").attr("role","row");a.$tbodies=f.children("tbody:not(."+a.cssInfoBlock+")").attr({"aria-live":"polite","aria-relevant":"all"});a.$table.children("caption").length&&(c=a.$table.children("caption")[0],c.id||(c.id=a.namespace.slice(1)+"caption"),a.$table.attr("aria-labelledby",c.id));a.widgetInit={};a.textExtraction=a.$table.attr("data-text-extraction")||a.textExtraction||"basic";E(b);Q(b);p(b);a.totalRows=0;a.delayInit||y(b);g.bindEvents(b,a.$headers,!0);P(b);a.supportsDataObject&&"undefined"!==typeof f.data().sortlist?a.sortList=f.data().sortlist:e&&f.metadata()&&f.metadata().sortlist&&(a.sortList=f.metadata().sortlist);g.applyWidget(b,!0);0<a.sortList.length?f.trigger("sorton",[a.sortList,{},!a.initWidgets,!0]):(G(b),a.initWidgets&&g.applyWidget(b,!1));a.showProcessing&&f.unbind("sortBegin"+a.namespace+" sortEnd"+a.namespace).bind("sortBegin"+a.namespace+" sortEnd"+a.namespace,function(c){clearTimeout(a.processTimer);g.isProcessing(b);"sortBegin"===c.type&&(a.processTimer=setTimeout(function(){g.isProcessing(b,!0)},500))});b.hasInitialized=!0;b.isProcessing=!1;a.debug&&g.benchmark("Overall initialization time",h.data(b,"startoveralltimer"));f.trigger("tablesorter-initialized",b);"function"===typeof a.initialized&&a.initialized(b)};g.getColumnData=function(b,a,c,f,e){if("undefined"!==typeof a&&null!==a){b=h(b)[0];var d;b=b.config;e=e||b.$headers;if(a[c])return f?a[c]:a[e.index(e.filter('[data-column="'+c+'"]:last'))];for(d in a)if("string"===typeof d&&(f=e.filter('[data-column="'+c+'"]:last').filter(d).add(e.filter('[data-column="'+c+'"]:last').find(d)),f.length))return a[d]}};g.computeColumnIndex=function(b){var a=[],c=0,f,e,d,g,l,k,r,u,p,q;for(f=0;f<b.length;f++)for(l=b[f].cells,e=0;e<l.length;e++){d=l[e];g=h(d);k=d.parentNode.rowIndex;g.index();r=d.rowSpan||1;u=d.colSpan||1;"undefined"===typeof a[k]&&(a[k]=[]);for(d=0;d<a[k].length+1;d++)if("undefined"===typeof a[k][d]){p=d;break}c=Math.max(p,c);g.attr({"data-column":p});for(d=k;d<k+r;d++)for("undefined"===typeof a[d]&&(a[d]=[]),q=a[d],g=p;g<p+u;g++)q[g]="x"}return c+1};g.isProcessing=function(b,a,c){b=h(b);var f=b[0].config,e=c||b.find("."+g.css.header);a?("undefined"!==typeof c&&0<f.sortList.length&&(e=e.filter(function(){return this.sortDisabled?!1:0<=g.isValueInArray(parseFloat(h(this).attr("data-column")),f.sortList)})),b.add(e).addClass(g.css.processing+" "+f.cssProcessing)):b.add(e).removeClass(g.css.processing+" "+f.cssProcessing)};g.processTbody=function(b,a,c){b=h(b)[0];if(c)return b.isProcessing=!0,a.before('<span class="tablesorter-savemyplace"/>'),c=h.fn.detach?a.detach():a.remove();c=h(b).find("span.tablesorter-savemyplace");a.insertAfter(c);c.remove();b.isProcessing=!1};g.clearTableBody=function(b){h(b)[0].config.$tbodies.children().detach()};g.bindEvents=function(b,a,c){b=h(b)[0];var f,e=b.config;!0!==c&&(e.$extraHeaders=e.$extraHeaders?e.$extraHeaders.add(a):a);a.find(e.selectorSort).add(a.filter(e.selectorSort)).unbind(["mousedown","mouseup","sort","keyup",""].join(e.namespace+" ")).bind(["mousedown","mouseup","sort","keyup",""].join(e.namespace+" "),function(c,d){var g;g=c.type;if(!(1!==(c.which||c.button)&&!/sort|keyup/.test(g)||"keyup"===g&&13!==c.which||"mouseup"===g&&!0!==d&&250<(new Date).getTime()-f)){if("mousedown"===g)return f=(new Date).getTime(),/(input|select|button|textarea)/i.test(c.target.tagName)||h(c.target).closest("td,th").hasClass(e.cssAllowClicks)?"":!e.cancelSelection;e.delayInit&&k(e.cache)&&y(b);g=h.fn.closest?h(this).closest("th, td")[0]:/TH|TD/.test(this.tagName)?this:h(this).parents("th, td")[0];g=e.$headers[a.index(g)];g.sortDisabled||N(b,g,c)}});e.cancelSelection&&a.attr("unselectable","on").bind("selectstart",!1).css({"user-select":"none",MozUserSelect:"none"})};g.restoreHeaders=function(b){var a=h(b)[0].config;a.$table.find(a.selectorHeaders).each(function(b){h(this).find("."+g.css.headerIn).length&&h(this).html(a.headerContent[b])})};g.destroy=function(b,a,c){b=h(b)[0];if(b.hasInitialized){g.refreshWidgets(b,!0,!0);var f=h(b),e=b.config,d=f.find("thead:first"),k=d.find("tr."+g.css.headerRow).removeClass(g.css.headerRow+" "+e.cssHeaderRow),l=f.find("tfoot:first > tr").children("th, td");!1===a&&0<=h.inArray("uitheme",e.widgets)&&(f.trigger("applyWidgetId",["uitheme"]),f.trigger("applyWidgetId",["zebra"]));d.find("tr").not(k).remove();f.removeData("tablesorter").unbind("sortReset update updateAll updateRows updateCell addRows updateComplete sorton appendCache updateCache applyWidgetId applyWidgets refreshWidgets destroy mouseup mouseleave keypress sortBegin sortEnd resetToLoadState ".split(" ").join(e.namespace+" "));e.$headers.add(l).removeClass([g.css.header,e.cssHeader,e.cssAsc,e.cssDesc,g.css.sortAsc,g.css.sortDesc,g.css.sortNone].join(" ")).removeAttr("data-column").removeAttr("aria-label").attr("aria-disabled","true");k.find(e.selectorSort).unbind(["mousedown","mouseup","keypress",""].join(e.namespace+" "));g.restoreHeaders(b);f.toggleClass(g.css.table+" "+e.tableClass+" tablesorter-"+e.theme,!1===a);b.hasInitialized=!1;delete b.config.cache;"function"===typeof c&&c(b)}};g.regex={chunk:/(^([+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?)?$|^0x[0-9a-f]+$|\d+)/gi,chunks:/(^\\0|\\0$)/,hex:/^0x[0-9a-f]+$/i};g.sortNatural=function(b,a){if(b===a)return 0;var c,f,e,d,k,l;f=g.regex;if(f.hex.test(a)){c=parseInt(b.match(f.hex),16);e=parseInt(a.match(f.hex),16);if(c<e)return-1;if(c>e)return 1}c=b.replace(f.chunk,"\\0$1\\0").replace(f.chunks,"").split("\\0");f=a.replace(f.chunk,"\\0$1\\0").replace(f.chunks,"").split("\\0");l=Math.max(c.length,f.length);for(k=0;k<l;k++){e=isNaN(c[k])?c[k]||0:parseFloat(c[k])||0;d=isNaN(f[k])?f[k]||0:parseFloat(f[k])||0;if(isNaN(e)!==isNaN(d))return isNaN(e)?1:-1;typeof e!==typeof d&&(e+="",d+="");if(e<d)return-1;if(e>d)return 1}return 0};g.sortNaturalAsc=function(b,a,c,f,e){if(b===a)return 0;c=e.string[e.empties[c]||e.emptyTo];return""===b&&0!==c?"boolean"===typeof c?c?-1:1:-c||-1:""===a&&0!==c?"boolean"===typeof c?c?1:-1:c||1:g.sortNatural(b,a)};g.sortNaturalDesc=function(b,a,c,f,e){if(b===a)return 0;c=e.string[e.empties[c]||e.emptyTo];return""===b&&0!==c?"boolean"===typeof c?c?-1:1:c||1:""===a&&0!==c?"boolean"===typeof c?c?1:-1:-c||-1:g.sortNatural(a,b)};g.sortText=function(b,a){return b>a?1:b<a?-1:0};g.getTextValue=function(b,a,c){if(c){var f=b?b.length:0,e=c+a;for(c=0;c<f;c++)e+=b.charCodeAt(c);return a*e}return 0};g.sortNumericAsc=function(b,a,c,f,e,d){if(b===a)return 0;d=d.config;e=d.string[d.empties[e]||d.emptyTo];if(""===b&&0!==e)return"boolean"===typeof e?e?-1:1:-e||-1;if(""===a&&0!==e)return"boolean"===typeof e?e?1:-1:e||1;isNaN(b)&&(b=g.getTextValue(b,c,f));isNaN(a)&&(a=g.getTextValue(a,c,f));return b-a};g.sortNumericDesc=function(b,a,c,f,e,d){if(b===a)return 0;d=d.config;e=d.string[d.empties[e]||d.emptyTo];if(""===b&&0!==e)return"boolean"===typeof e?e?-1:1:e||1;if(""===a&&0!==e)return"boolean"===typeof e?e?1:-1:-e||-1;isNaN(b)&&(b=g.getTextValue(b,c,f));isNaN(a)&&(a=g.getTextValue(a,c,f));return a-b};g.sortNumeric=function(b,a){return b-a};g.characterEquivalents={a:"áàâãäąå",A:"ÁÀÂÃÄĄÅ",c:"çćč",C:"ÇĆČ",e:"éèêëěę",E:"ÉÈÊËĚĘ",i:"íìİîïı",I:"ÍÌİÎÏ",o:"óòôõö",O:"ÓÒÔÕÖ",ss:"ß",SS:"ẞ",u:"úùûüů",U:"ÚÙÛÜŮ"};g.replaceAccents=function(b){var a,c="[",f=g.characterEquivalents;if(!g.characterRegex){g.characterRegexArray={};for(a in f)"string"===typeof a&&(c+=f[a],g.characterRegexArray[a]=new RegExp("["+f[a]+"]","g"));g.characterRegex=new RegExp(c+"]")}if(g.characterRegex.test(b))for(a in f)"string"===typeof a&&(b=b.replace(g.characterRegexArray[a],a));return b};g.isValueInArray=function(b,a){var c,f=a.length;for(c=0;c<f;c++)if(a[c][0]===b)return c;return-1};g.addParser=function(b){var a,c=g.parsers.length,f=!0;for(a=0;a<c;a++)g.parsers[a].id.toLowerCase()===b.id.toLowerCase()&&(f=!1);f&&g.parsers.push(b)};g.getParserById=function(b){if("false"==b)return!1;var a,c=g.parsers.length;for(a=0;a<c;a++)if(g.parsers[a].id.toLowerCase()===b.toString().toLowerCase())return g.parsers[a];return!1};g.addWidget=function(b){g.widgets.push(b)};g.hasWidget=function(b,a){b=h(b);return b.length&&b[0].config&&b[0].config.widgetInit[a]||!1};g.getWidgetById=function(b){var a,c,f=g.widgets.length;for(a=0;a<f;a++)if((c=g.widgets[a])&&c.hasOwnProperty("id")&&c.id.toLowerCase()===b.toLowerCase())return c};g.applyWidget=function(b,a){b=h(b)[0];var c=b.config,f=c.widgetOptions,e=" "+c.table.className+" ",d=[],k,l,n;!1!==a&&b.hasInitialized&&(b.isApplyingWidgets||b.isUpdating)||(c.debug&&(k=new Date),n=new RegExp("\\s"+c.widgetClass.replace(/\{name\}/i,"([\\w-]+)")+"\\s","g"),e.match(n)&&(e=e.match(n))&&h.each(e,function(a,b){c.widgets.push(b.replace(n,"$1"))}),c.widgets.length&&(b.isApplyingWidgets=!0,c.widgets=h.grep(c.widgets,function(a,b){return h.inArray(a,c.widgets)===b}),h.each(c.widgets||[],function(a,b){(n=g.getWidgetById(b))&&n.id&&(n.priority||(n.priority=10),d[a]=n)}),d.sort(function(a,b){return a.priority<b.priority?-1:a.priority===b.priority?0:1}),h.each(d,function(e,d){if(d){if(a||!c.widgetInit[d.id])c.widgetInit[d.id]=!0,d.hasOwnProperty("options")&&(f=b.config.widgetOptions=h.extend(!0,{},d.options,f)),d.hasOwnProperty("init")&&(c.debug&&(l=new Date),d.init(b,d,c,f),c.debug&&g.benchmark("Initializing "+d.id+" widget",l));!a&&d.hasOwnProperty("format")&&(c.debug&&(l=new Date),d.format(b,c,f,!1),c.debug&&g.benchmark((a?"Initializing ":"Applying ")+d.id+" widget",l))}})),setTimeout(function(){b.isApplyingWidgets=!1;h.data(b,"lastWidgetApplication",new Date)},0),c.debug&&(e=c.widgets.length,r("Completed "+(!0===a?"initializing ":"applying ")+e+" widget"+(1!==e?"s":""),k)))};g.refreshWidgets=function(b,a,c){b=h(b)[0];var f,e=b.config,k=e.widgets,r=g.widgets,l=r.length;for(f=0;f<l;f++)r[f]&&r[f].id&&(a||0>h.inArray(r[f].id,k))&&(e.debug&&d('Refeshing widgets: Removing "'+r[f].id+'"'),r[f].hasOwnProperty("remove")&&e.widgetInit[r[f].id]&&(r[f].remove(b,e,e.widgetOptions),e.widgetInit[r[f].id]=!1));!0!==c&&g.applyWidget(b,a)};g.getData=function(b,a,c){var d="";b=h(b);var e,g;if(!b.length)return"";e=h.metadata?b.metadata():!1;g=" "+(b.attr("class")||"");"undefined"!==typeof b.data(c)||"undefined"!==typeof b.data(c.toLowerCase())?d+=b.data(c)||b.data(c.toLowerCase()):e&&"undefined"!==typeof e[c]?d+=e[c]:a&&"undefined"!==typeof a[c]?d+=a[c]:" "!==g&&g.match(" "+c+"-")&&(d=g.match(new RegExp("\\s"+c+"-([\\w-]+)"))[1]||"");return h.trim(d)};g.formatFloat=function(b,a){if("string"!==typeof b||""===b)return b;var c;b=(a&&a.config?!1!==a.config.usNumberFormat:"undefined"!==typeof a?a:1)?b.replace(/,/g,""):b.replace(/[\s|\.]/g,"").replace(/,/g,".");/^\s*\([.\d]+\)/.test(b)&&(b=b.replace(/^\s*\(([.\d]+)\)/,"-$1"));c=parseFloat(b);return isNaN(c)?h.trim(b):c};g.isDigit=function(b){return isNaN(b)?/^[\-+(]?\d+[)]?$/.test(b.toString().replace(/[,.'"\s]/g,"")):!0}}});var p=h.tablesorter;h.fn.extend({tablesorter:p.construct});p.addParser({id:"no-parser",is:function(){return!1},format:function(){return""},type:"text"});p.addParser({id:"text",is:function(){return!0},format:function(d,r){var k=r.config;d&&(d=h.trim(k.ignoreCase?d.toLocaleLowerCase():d),d=k.sortLocaleCompare?p.replaceAccents(d):d);return d},type:"text"});p.addParser({id:"digit",is:function(d){return p.isDigit(d)},format:function(d,r){var k=p.formatFloat((d||"").replace(/[^\w,. \-()]/g,""),r);return d&&"number"===typeof k?k:d?h.trim(d&&r.config.ignoreCase?d.toLocaleLowerCase():d):d},type:"numeric"});p.addParser({id:"currency",is:function(d){return/^\(?\d+[\u00a3$\u20ac\u00a4\u00a5\u00a2?.]|[\u00a3$\u20ac\u00a4\u00a5\u00a2?.]\d+\)?$/.test((d||"").replace(/[+\-,. ]/g,""))},format:function(d,r){var k=p.formatFloat((d||"").replace(/[^\w,. \-()]/g,""),r);return d&&"number"===typeof k?k:d?h.trim(d&&r.config.ignoreCase?d.toLocaleLowerCase():d):d},type:"numeric"});p.addParser({id:"url",is:function(d){return/^(https?|ftp|file):\/\//.test(d)},format:function(d){return d?h.trim(d.replace(/(https?|ftp|file):\/\//,"")):d},parsed:!0,type:"text"});p.addParser({id:"isoDate",is:function(d){return/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}/.test(d)},format:function(d,h){var k=d?new Date(d.replace(/-/g,"/")):d;return k instanceof Date&&isFinite(k)?k.getTime():d},type:"numeric"});p.addParser({id:"percent",is:function(d){return/(\d\s*?%|%\s*?\d)/.test(d)&&15>d.length},format:function(d,h){return d?p.formatFloat(d.replace(/%/g,""),h):d},type:"numeric"});p.addParser({id:"image",is:function(d,h,k,p){return 0<p.find("img").length},format:function(d,r,k){return h(k).find("img").attr(r.config.imgAttr||"alt")||d},parsed:!0,type:"text"});p.addParser({id:"usLongDate",is:function(d){return/^[A-Z]{3,10}\.?\s+\d{1,2},?\s+(\d{4})(\s+\d{1,2}:\d{2}(:\d{2})?(\s+[AP]M)?)?$/i.test(d)||/^\d{1,2}\s+[A-Z]{3,10}\s+\d{4}/i.test(d)},format:function(d,h){var k=d?new Date(d.replace(/(\S)([AP]M)$/i,"$1 $2")):d;return k instanceof Date&&isFinite(k)?k.getTime():d},type:"numeric"});p.addParser({id:"shortDate",is:function(d){return/(^\d{1,2}[\/\s]\d{1,2}[\/\s]\d{4})|(^\d{4}[\/\s]\d{1,2}[\/\s]\d{1,2})/.test((d||"").replace(/\s+/g," ").replace(/[\-.,]/g,"/"))},format:function(d,h,k,v){if(d){k=h.config;var z=k.$headers.filter("[data-column="+v+"]:last");v=z.length&&z[0].dateFormat||p.getData(z,p.getColumnData(h,k.headers,v),"dateFormat")||k.dateFormat;h=d.replace(/\s+/g," ").replace(/[\-.,]/g,"/");"mmddyyyy"===v?h=h.replace(/(\d{1,2})[\/\s](\d{1,2})[\/\s](\d{4})/,"$3/$1/$2"):"ddmmyyyy"===v?h=h.replace(/(\d{1,2})[\/\s](\d{1,2})[\/\s](\d{4})/,"$3/$2/$1"):"yyyymmdd"===v&&(h=h.replace(/(\d{4})[\/\s](\d{1,2})[\/\s](\d{1,2})/,"$1/$2/$3"));h=new Date(h);return h instanceof Date&&isFinite(h)?h.getTime():d}return d},type:"numeric"});p.addParser({id:"time",is:function(d){return/^(([0-2]?\d:[0-5]\d)|([0-1]?\d:[0-5]\d\s?([AP]M)))$/i.test(d)},format:function(d,h){var k=d?new Date("2000/01/01 "+d.replace(/(\S)([AP]M)$/i,"$1 $2")):d;return k instanceof Date&&isFinite(k)?k.getTime():d},type:"numeric"});p.addParser({id:"metadata",is:function(){return!1},format:function(d,p,k){d=p.config;d=d.parserMetadataName?d.parserMetadataName:"sortValue";return h(k).metadata()[d]},type:"numeric"});p.addWidget({id:"zebra",priority:90,format:function(d,p,k){var v,z,y,B,F=new RegExp(p.cssChildRow,"i"),E=p.$tbodies;for(d=0;d<E.length;d++)y=0,v=E.eq(d),v=v.children("tr:visible").not(p.selectorRemove),v.each(function(){z=h(this);F.test(this.className)||y++;B=0===y%2;z.removeClass(k.zebra[B?1:0]).addClass(k.zebra[B?0:1])})},remove:function(d,h,k){var v;h=h.$tbodies;var z=(k.zebra||["even","odd"]).join(" ");for(k=0;k<h.length;k++)v=p.processTbody(d,h.eq(k),!0),v.children().removeClass(z),p.processTbody(d,v,!1)}})}(jQuery);!function(e,n,A){function o(e,n){return typeof e===n}function t(){var e,n,A,t,a,i,l;for(var f in r)if(r.hasOwnProperty(f)){if(e=[],n=r[f],n.name&&(e.push(n.name.toLowerCase()),n.options&&n.options.aliases&&n.options.aliases.length))for(A=0;A<n.options.aliases.length;A++)e.push(n.options.aliases[A].toLowerCase());for(t=o(n.fn,"function")?n.fn():n.fn,a=0;a<e.length;a++)i=e[a],l=i.split("."),1===l.length?Modernizr[l[0]]=t:(!Modernizr[l[0]]||Modernizr[l[0]]instanceof Boolean||(Modernizr[l[0]]=new Boolean(Modernizr[l[0]])),Modernizr[l[0]][l[1]]=t),s.push((t?"":"no-")+l.join("-"))}}function a(e){var n=u.className,A=Modernizr._config.classPrefix||"";if(c&&(n=n.baseVal),Modernizr._config.enableJSClass){var o=new RegExp("(^|\\s)"+A+"no-js(\\s|$)");n=n.replace(o,"$1"+A+"js$2")}Modernizr._config.enableClasses&&(n+=" "+A+e.join(" "+A),c?u.className.baseVal=n:u.className=n)}function i(e,n){if("object"==typeof e)for(var A in e)f(e,A)&&i(A,e[A]);else{e=e.toLowerCase();var o=e.split("."),t=Modernizr[o[0]];if(2==o.length&&(t=t[o[1]]),"undefined"!=typeof t)return Modernizr;n="function"==typeof n?n():n,1==o.length?Modernizr[o[0]]=n:(!Modernizr[o[0]]||Modernizr[o[0]]instanceof Boolean||(Modernizr[o[0]]=new Boolean(Modernizr[o[0]])),Modernizr[o[0]][o[1]]=n),a([(n&&0!=n?"":"no-")+o.join("-")]),Modernizr._trigger(e,n)}return Modernizr}var s=[],r=[],l={_version:"3.5.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,n){var A=this;setTimeout(function(){n(A[e])},0)},addTest:function(e,n,A){r.push({name:e,fn:n,options:A})},addAsyncTest:function(e){r.push({name:null,fn:e})}},Modernizr=function(){};Modernizr.prototype=l,Modernizr=new Modernizr;var f,u=n.documentElement,c="svg"===u.nodeName.toLowerCase();!function(){var e={}.hasOwnProperty;f=o(e,"undefined")||o(e.call,"undefined")?function(e,n){return n in e&&o(e.constructor.prototype[n],"undefined")}:function(n,A){return e.call(n,A)}}(),l._l={},l.on=function(e,n){this._l[e]||(this._l[e]=[]),this._l[e].push(n),Modernizr.hasOwnProperty(e)&&setTimeout(function(){Modernizr._trigger(e,Modernizr[e])},0)},l._trigger=function(e,n){if(this._l[e]){var A=this._l[e];setTimeout(function(){var e,o;for(e=0;e<A.length;e++)(o=A[e])(n)},0),delete this._l[e]}},Modernizr._q.push(function(){l.addTest=i}),Modernizr.addAsyncTest(function(){function e(e,n,A){function o(n){var o=n&&"load"===n.type?1==t.width:!1,a="webp"===e;i(e,a&&o?new Boolean(o):o),A&&A(n)}var t=new Image;t.onerror=o,t.onload=o,t.src=n}var n=[{uri:"data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAAwAQCdASoBAAEAAwA0JaQAA3AA/vuUAAA=",name:"webp"},{uri:"data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA==",name:"webp.alpha"},{uri:"data:image/webp;base64,UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA",name:"webp.animation"},{uri:"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",name:"webp.lossless"}],A=n.shift();e(A.name,A.uri,function(A){if(A&&"load"===A.type)for(var o=0;o<n.length;o++)e(n[o].name,n[o].uri)})}),t(),a(s),delete l.addTest,delete l.addAsyncTest;for(var p=0;p<Modernizr._q.length;p++)Modernizr._q[p]();e.Modernizr=Modernizr}(window,document);(function(){var a,b,c,d,e=[].slice,f=function(a,b){return function(){return a.apply(b,arguments)}},g={}.hasOwnProperty,h=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},i=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};b=window.Morris={},a=jQuery,b.EventEmitter=function(){function a(){}return a.prototype.on=function(a,b){return null==this.handlers&&(this.handlers={}),null==this.handlers[a]&&(this.handlers[a]=[]),this.handlers[a].push(b),this},a.prototype.fire=function(){var a,b,c,d,f,g,h;if(c=arguments[0],a=2<=arguments.length?e.call(arguments,1):[],null!=this.handlers&&null!=this.handlers[c]){for(g=this.handlers[c],h=[],d=0,f=g.length;f>d;d++)b=g[d],h.push(b.apply(null,a));return h}},a}(),b.commas=function(a){var b,c,d,e;return null!=a?(d=0>a?"-":"",b=Math.abs(a),c=Math.floor(b).toFixed(0),d+=c.replace(/(?=(?:\d{3})+$)(?!^)/g,","),e=b.toString(),e.length>c.length&&(d+=e.slice(c.length)),d):"-"},b.pad2=function(a){return(10>a?"0":"")+a},b.Grid=function(c){function d(b){this.resizeHandler=f(this.resizeHandler,this);var c=this;if(this.el="string"==typeof b.element?a(document.getElementById(b.element)):a(b.element),null==this.el||0===this.el.length)throw new Error("Graph container element not found");"static"===this.el.css("position")&&this.el.css("position","relative"),this.options=a.extend({},this.gridDefaults,this.defaults||{},b),"string"==typeof this.options.units&&(this.options.postUnits=b.units),this.raphael=new Raphael(this.el[0]),this.elementWidth=null,this.elementHeight=null,this.dirty=!1,this.selectFrom=null,this.init&&this.init(),this.setData(this.options.data),this.el.bind("mousemove",function(a){var b,d,e,f,g;return d=c.el.offset(),g=a.pageX-d.left,c.selectFrom?(b=c.data[c.hitTest(Math.min(g,c.selectFrom))]._x,e=c.data[c.hitTest(Math.max(g,c.selectFrom))]._x,f=e-b,c.selectionRect.attr({x:b,width:f})):c.fire("hovermove",g,a.pageY-d.top)}),this.el.bind("mouseleave",function(){return c.selectFrom&&(c.selectionRect.hide(),c.selectFrom=null),c.fire("hoverout")}),this.el.bind("touchstart touchmove touchend",function(a){var b,d;return d=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0],b=c.el.offset(),c.fire("hovermove",d.pageX-b.left,d.pageY-b.top)}),this.el.bind("click",function(a){var b;return b=c.el.offset(),c.fire("gridclick",a.pageX-b.left,a.pageY-b.top)}),this.options.rangeSelect&&(this.selectionRect=this.raphael.rect(0,0,0,this.el.innerHeight()).attr({fill:this.options.rangeSelectColor,stroke:!1}).toBack().hide(),this.el.bind("mousedown",function(a){var b;return b=c.el.offset(),c.startRange(a.pageX-b.left)}),this.el.bind("mouseup",function(a){var b;return b=c.el.offset(),c.endRange(a.pageX-b.left),c.fire("hovermove",a.pageX-b.left,a.pageY-b.top)})),this.options.resize&&a(window).bind("resize",function(){return null!=c.timeoutId&&window.clearTimeout(c.timeoutId),c.timeoutId=window.setTimeout(c.resizeHandler,100)}),this.el.css("-webkit-tap-highlight-color","rgba(0,0,0,0)"),this.postInit&&this.postInit()}return h(d,c),d.prototype.gridDefaults={dateFormat:null,axes:!0,grid:!0,gridLineColor:"#aaa",gridStrokeWidth:.5,gridTextColor:"#888",gridTextSize:12,gridTextFamily:"sans-serif",gridTextWeight:"normal",hideHover:!1,yLabelFormat:null,xLabelAngle:0,numLines:5,padding:25,parseTime:!0,postUnits:"",preUnits:"",ymax:"auto",ymin:"auto 0",goals:[],goalStrokeWidth:1,goalLineColors:["#666633","#999966","#cc6666","#663333"],events:[],eventStrokeWidth:1,eventLineColors:["#005a04","#ccffbb","#3a5f0b","#005502"],rangeSelect:null,rangeSelectColor:"#eef",resize:!1},d.prototype.setData=function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;return null==c&&(c=!0),this.options.data=a,null==a||0===a.length?(this.data=[],this.raphael.clear(),null!=this.hover&&this.hover.hide(),void 0):(o=this.cumulative?0:null,p=this.cumulative?0:null,this.options.goals.length>0&&(h=Math.min.apply(Math,this.options.goals),g=Math.max.apply(Math,this.options.goals),p=null!=p?Math.min(p,h):h,o=null!=o?Math.max(o,g):g),this.data=function(){var c,d,g;for(g=[],f=c=0,d=a.length;d>c;f=++c)j=a[f],i={src:j},i.label=j[this.options.xkey],this.options.parseTime?(i.x=b.parseDate(i.label),this.options.dateFormat?i.label=this.options.dateFormat(i.x):"number"==typeof i.label&&(i.label=new Date(i.label).toString())):(i.x=f,this.options.xLabelFormat&&(i.label=this.options.xLabelFormat(i))),l=0,i.y=function(){var a,b,c,d;for(c=this.options.ykeys,d=[],e=a=0,b=c.length;b>a;e=++a)n=c[e],q=j[n],"string"==typeof q&&(q=parseFloat(q)),null!=q&&"number"!=typeof q&&(q=null),null!=q&&(this.cumulative?l+=q:null!=o?(o=Math.max(q,o),p=Math.min(q,p)):o=p=q),this.cumulative&&null!=l&&(o=Math.max(l,o),p=Math.min(l,p)),d.push(q);return d}.call(this),g.push(i);return g}.call(this),this.options.parseTime&&(this.data=this.data.sort(function(a,b){return(a.x>b.x)-(b.x>a.x)})),this.xmin=this.data[0].x,this.xmax=this.data[this.data.length-1].x,this.events=[],this.options.events.length>0&&(this.events=this.options.parseTime?function(){var a,c,e,f;for(e=this.options.events,f=[],a=0,c=e.length;c>a;a++)d=e[a],f.push(b.parseDate(d));return f}.call(this):this.options.events,this.xmax=Math.max(this.xmax,Math.max.apply(Math,this.events)),this.xmin=Math.min(this.xmin,Math.min.apply(Math,this.events))),this.xmin===this.xmax&&(this.xmin-=1,this.xmax+=1),this.ymin=this.yboundary("min",p),this.ymax=this.yboundary("max",o),this.ymin===this.ymax&&(p&&(this.ymin-=1),this.ymax+=1),((r=this.options.axes)===!0||"both"===r||"y"===r||this.options.grid===!0)&&(this.options.ymax===this.gridDefaults.ymax&&this.options.ymin===this.gridDefaults.ymin?(this.grid=this.autoGridLines(this.ymin,this.ymax,this.options.numLines),this.ymin=Math.min(this.ymin,this.grid[0]),this.ymax=Math.max(this.ymax,this.grid[this.grid.length-1])):(k=(this.ymax-this.ymin)/(this.options.numLines-1),this.grid=function(){var a,b,c,d;for(d=[],m=a=b=this.ymin,c=this.ymax;k>0?c>=a:a>=c;m=a+=k)d.push(m);return d}.call(this))),this.dirty=!0,c?this.redraw():void 0)},d.prototype.yboundary=function(a,b){var c,d;return c=this.options["y"+a],"string"==typeof c?"auto"===c.slice(0,4)?c.length>5?(d=parseInt(c.slice(5),10),null==b?d:Math[a](b,d)):null!=b?b:0:parseInt(c,10):c},d.prototype.autoGridLines=function(a,b,c){var d,e,f,g,h,i,j,k,l;return h=b-a,l=Math.floor(Math.log(h)/Math.log(10)),j=Math.pow(10,l),e=Math.floor(a/j)*j,d=Math.ceil(b/j)*j,i=(d-e)/(c-1),1===j&&i>1&&Math.ceil(i)!==i&&(i=Math.ceil(i),d=e+i*(c-1)),0>e&&d>0&&(e=Math.floor(a/i)*i,d=Math.ceil(b/i)*i),1>i?(g=Math.floor(Math.log(i)/Math.log(10)),f=function(){var a,b;for(b=[],k=a=e;i>0?d>=a:a>=d;k=a+=i)b.push(parseFloat(k.toFixed(1-g)));return b}()):f=function(){var a,b;for(b=[],k=a=e;i>0?d>=a:a>=d;k=a+=i)b.push(k);return b}(),f},d.prototype._calc=function(){var a,b,c,d,e,f,g,h;return e=this.el.width(),c=this.el.height(),(this.elementWidth!==e||this.elementHeight!==c||this.dirty)&&(this.elementWidth=e,this.elementHeight=c,this.dirty=!1,this.left=this.options.padding,this.right=this.elementWidth-this.options.padding,this.top=this.options.padding,this.bottom=this.elementHeight-this.options.padding,((g=this.options.axes)===!0||"both"===g||"y"===g)&&(f=function(){var a,c,d,e;for(d=this.grid,e=[],a=0,c=d.length;c>a;a++)b=d[a],e.push(this.measureText(this.yAxisFormat(b)).width);return e}.call(this),this.left+=Math.max.apply(Math,f)),((h=this.options.axes)===!0||"both"===h||"x"===h)&&(a=function(){var a,b,c;for(c=[],d=a=0,b=this.data.length;b>=0?b>a:a>b;d=b>=0?++a:--a)c.push(this.measureText(this.data[d].text,-this.options.xLabelAngle).height);return c}.call(this),this.bottom-=Math.max.apply(Math,a)),this.width=Math.max(1,this.right-this.left),this.height=Math.max(1,this.bottom-this.top),this.dx=this.width/(this.xmax-this.xmin),this.dy=this.height/(this.ymax-this.ymin),this.calc)?this.calc():void 0},d.prototype.transY=function(a){return this.bottom-(a-this.ymin)*this.dy},d.prototype.transX=function(a){return 1===this.data.length?(this.left+this.right)/2:this.left+(a-this.xmin)*this.dx},d.prototype.redraw=function(){return this.raphael.clear(),this._calc(),this.drawGrid(),this.drawGoals(),this.drawEvents(),this.draw?this.draw():void 0},d.prototype.measureText=function(a,b){var c,d;return null==b&&(b=0),d=this.raphael.text(100,100,a).attr("font-size",this.options.gridTextSize).attr("font-family",this.options.gridTextFamily).attr("font-weight",this.options.gridTextWeight).rotate(b),c=d.getBBox(),d.remove(),c},d.prototype.yAxisFormat=function(a){return this.yLabelFormat(a)},d.prototype.yLabelFormat=function(a){return"function"==typeof this.options.yLabelFormat?this.options.yLabelFormat(a):""+this.options.preUnits+b.commas(a)+this.options.postUnits},d.prototype.drawGrid=function(){var a,b,c,d,e,f,g,h;if(this.options.grid!==!1||(e=this.options.axes)===!0||"both"===e||"y"===e){for(f=this.grid,h=[],c=0,d=f.length;d>c;c++)a=f[c],b=this.transY(a),((g=this.options.axes)===!0||"both"===g||"y"===g)&&this.drawYAxisLabel(this.left-this.options.padding/2,b,this.yAxisFormat(a)),this.options.grid?h.push(this.drawGridLine("M"+this.left+","+b+"H"+(this.left+this.width))):h.push(void 0);return h}},d.prototype.drawGoals=function(){var a,b,c,d,e,f,g;for(f=this.options.goals,g=[],c=d=0,e=f.length;e>d;c=++d)b=f[c],a=this.options.goalLineColors[c%this.options.goalLineColors.length],g.push(this.drawGoal(b,a));return g},d.prototype.drawEvents=function(){var a,b,c,d,e,f,g;for(f=this.events,g=[],c=d=0,e=f.length;e>d;c=++d)b=f[c],a=this.options.eventLineColors[c%this.options.eventLineColors.length],g.push(this.drawEvent(b,a));return g},d.prototype.drawGoal=function(a,b){return this.raphael.path("M"+this.left+","+this.transY(a)+"H"+this.right).attr("stroke",b).attr("stroke-width",this.options.goalStrokeWidth)},d.prototype.drawEvent=function(a,b){return this.raphael.path("M"+this.transX(a)+","+this.bottom+"V"+this.top).attr("stroke",b).attr("stroke-width",this.options.eventStrokeWidth)},d.prototype.drawYAxisLabel=function(a,b,c){return this.raphael.text(a,b,c).attr("font-size",this.options.gridTextSize).attr("font-family",this.options.gridTextFamily).attr("font-weight",this.options.gridTextWeight).attr("fill",this.options.gridTextColor).attr("text-anchor","end")},d.prototype.drawGridLine=function(a){return this.raphael.path(a).attr("stroke",this.options.gridLineColor).attr("stroke-width",this.options.gridStrokeWidth)},d.prototype.startRange=function(a){return this.hover.hide(),this.selectFrom=a,this.selectionRect.attr({x:a,width:0}).show()},d.prototype.endRange=function(a){var b,c;return this.selectFrom?(c=Math.min(this.selectFrom,a),b=Math.max(this.selectFrom,a),this.options.rangeSelect.call(this.el,{start:this.data[this.hitTest(c)].x,end:this.data[this.hitTest(b)].x}),this.selectFrom=null):void 0},d.prototype.resizeHandler=function(){return this.timeoutId=null,this.raphael.setSize(this.el.width(),this.el.height()),this.redraw()},d}(b.EventEmitter),b.parseDate=function(a){var b,c,d,e,f,g,h,i,j,k,l;return"number"==typeof a?a:(c=a.match(/^(\d+) Q(\d)$/),e=a.match(/^(\d+)-(\d+)$/),f=a.match(/^(\d+)-(\d+)-(\d+)$/),h=a.match(/^(\d+) W(\d+)$/),i=a.match(/^(\d+)-(\d+)-(\d+)[ T](\d+):(\d+)(Z|([+-])(\d\d):?(\d\d))?$/),j=a.match(/^(\d+)-(\d+)-(\d+)[ T](\d+):(\d+):(\d+(\.\d+)?)(Z|([+-])(\d\d):?(\d\d))?$/),c?new Date(parseInt(c[1],10),3*parseInt(c[2],10)-1,1).getTime():e?new Date(parseInt(e[1],10),parseInt(e[2],10)-1,1).getTime():f?new Date(parseInt(f[1],10),parseInt(f[2],10)-1,parseInt(f[3],10)).getTime():h?(k=new Date(parseInt(h[1],10),0,1),4!==k.getDay()&&k.setMonth(0,1+(4-k.getDay()+7)%7),k.getTime()+6048e5*parseInt(h[2],10)):i?i[6]?(g=0,"Z"!==i[6]&&(g=60*parseInt(i[8],10)+parseInt(i[9],10),"+"===i[7]&&(g=0-g)),Date.UTC(parseInt(i[1],10),parseInt(i[2],10)-1,parseInt(i[3],10),parseInt(i[4],10),parseInt(i[5],10)+g)):new Date(parseInt(i[1],10),parseInt(i[2],10)-1,parseInt(i[3],10),parseInt(i[4],10),parseInt(i[5],10)).getTime():j?(l=parseFloat(j[6]),b=Math.floor(l),d=Math.round(1e3*(l-b)),j[8]?(g=0,"Z"!==j[8]&&(g=60*parseInt(j[10],10)+parseInt(j[11],10),"+"===j[9]&&(g=0-g)),Date.UTC(parseInt(j[1],10),parseInt(j[2],10)-1,parseInt(j[3],10),parseInt(j[4],10),parseInt(j[5],10)+g,b,d)):new Date(parseInt(j[1],10),parseInt(j[2],10)-1,parseInt(j[3],10),parseInt(j[4],10),parseInt(j[5],10),b,d).getTime()):new Date(parseInt(a,10),0,1).getTime())},b.Hover=function(){function c(c){null==c&&(c={}),this.options=a.extend({},b.Hover.defaults,c),this.el=a("<div class='"+this.options["class"]+"'></div>"),this.el.hide(),this.options.parent.append(this.el)}return c.defaults={class:"morris-hover morris-default-style"},c.prototype.update=function(a,b,c){return a?(this.html(a),this.show(),this.moveTo(b,c)):this.hide()},c.prototype.html=function(a){return this.el.html(a)},c.prototype.moveTo=function(a,b){var c,d,e,f,g,h;return g=this.options.parent.innerWidth(),f=this.options.parent.innerHeight(),d=this.el.outerWidth(),c=this.el.outerHeight(),e=Math.min(Math.max(0,a-d/2),g-d),null!=b?(h=b-c-10,0>h&&(h=b+10,h+c>f&&(h=f/2-c/2))):h=f/2-c/2,this.el.css({left:e+"px",top:parseInt(h)+"px"})},c.prototype.show=function(){return this.el.show()},c.prototype.hide=function(){return this.el.hide()},c}(),b.Line=function(a){function c(a){return this.hilight=f(this.hilight,this),this.onHoverOut=f(this.onHoverOut,this),this.onHoverMove=f(this.onHoverMove,this),this.onGridClick=f(this.onGridClick,this),this instanceof b.Line?(c.__super__.constructor.call(this,a),void 0):new b.Line(a)}return h(c,a),c.prototype.init=function(){return"always"!==this.options.hideHover?(this.hover=new b.Hover({parent:this.el}),this.on("hovermove",this.onHoverMove),this.on("hoverout",this.onHoverOut),this.on("gridclick",this.onGridClick)):void 0},c.prototype.defaults={lineWidth:3,pointSize:4,lineColors:["#0b62a4","#7A92A3","#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"],pointStrokeWidths:[1],pointStrokeColors:["#ffffff"],pointFillColors:[],smooth:!0,xLabels:"auto",xLabelFormat:null,xLabelMargin:24,hideHover:!1},c.prototype.calc=function(){return this.calcPoints(),this.generatePaths()},c.prototype.calcPoints=function(){var a,b,c,d,e,f;for(e=this.data,f=[],c=0,d=e.length;d>c;c++)a=e[c],a._x=this.transX(a.x),a._y=function(){var c,d,e,f;for(e=a.y,f=[],c=0,d=e.length;d>c;c++)b=e[c],null!=b?f.push(this.transY(b)):f.push(b);return f}.call(this),f.push(a._ymax=Math.min.apply(Math,[this.bottom].concat(function(){var c,d,e,f;for(e=a._y,f=[],c=0,d=e.length;d>c;c++)b=e[c],null!=b&&f.push(b);return f}())));return f},c.prototype.hitTest=function(a){var b,c,d,e,f;if(0===this.data.length)return null;for(f=this.data.slice(1),b=d=0,e=f.length;e>d&&(c=f[b],!(a<(c._x+this.data[b]._x)/2));b=++d);return b},c.prototype.onGridClick=function(a,b){var c;return c=this.hitTest(a),this.fire("click",c,this.data[c].src,a,b)},c.prototype.onHoverMove=function(a){var b;return b=this.hitTest(a),this.displayHoverForRow(b)},c.prototype.onHoverOut=function(){return this.options.hideHover!==!1?this.displayHoverForRow(null):void 0},c.prototype.displayHoverForRow=function(a){var b;return null!=a?((b=this.hover).update.apply(b,this.hoverContentForRow(a)),this.hilight(a)):(this.hover.hide(),this.hilight())},c.prototype.hoverContentForRow=function(a){var b,c,d,e,f,g,h;for(d=this.data[a],b="<div class='morris-hover-row-label'>"+d.label+"</div>",h=d.y,c=f=0,g=h.length;g>f;c=++f)e=h[c],b+="<div class='morris-hover-point' style='color: "+this.colorFor(d,c,"label")+"'>\n  "+this.options.labels[c]+":\n  "+this.yLabelFormat(e)+"\n</div>";return"function"==typeof this.options.hoverCallback&&(b=this.options.hoverCallback(a,this.options,b,d.src)),[b,d._x,d._ymax]},c.prototype.generatePaths=function(){var a,c,d,e;return this.paths=function(){var f,g,h,j;for(j=[],c=f=0,g=this.options.ykeys.length;g>=0?g>f:f>g;c=g>=0?++f:--f)e="boolean"==typeof this.options.smooth?this.options.smooth:(h=this.options.ykeys[c],i.call(this.options.smooth,h)>=0),a=function(){var a,b,e,f;for(e=this.data,f=[],a=0,b=e.length;b>a;a++)d=e[a],void 0!==d._y[c]&&f.push({x:d._x,y:d._y[c]});return f}.call(this),a.length>1?j.push(b.Line.createPath(a,e,this.bottom)):j.push(null);return j}.call(this)},c.prototype.draw=function(){var a;return((a=this.options.axes)===!0||"both"===a||"x"===a)&&this.drawXAxis(),this.drawSeries(),this.options.hideHover===!1?this.displayHoverForRow(this.data.length-1):void 0},c.prototype.drawXAxis=function(){var a,c,d,e,f,g,h,i,j,k,l=this;for(h=this.bottom+this.options.padding/2,f=null,e=null,a=function(a,b){var c,d,g,i,j;return c=l.drawXAxisLabel(l.transX(b),h,a),j=c.getBBox(),c.transform("r"+-l.options.xLabelAngle),d=c.getBBox(),c.transform("t0,"+d.height/2+"..."),0!==l.options.xLabelAngle&&(i=-.5*j.width*Math.cos(l.options.xLabelAngle*Math.PI/180),c.transform("t"+i+",0...")),d=c.getBBox(),(null==f||f>=d.x+d.width||null!=e&&e>=d.x)&&d.x>=0&&d.x+d.width<l.el.width()?(0!==l.options.xLabelAngle&&(g=1.25*l.options.gridTextSize/Math.sin(l.options.xLabelAngle*Math.PI/180),e=d.x-g),f=d.x-l.options.xLabelMargin):c.remove()},d=this.options.parseTime?1===this.data.length&&"auto"===this.options.xLabels?[[this.data[0].label,this.data[0].x]]:b.labelSeries(this.xmin,this.xmax,this.width,this.options.xLabels,this.options.xLabelFormat):function(){var a,b,c,d;for(c=this.data,d=[],a=0,b=c.length;b>a;a++)g=c[a],d.push([g.label,g.x]);return d}.call(this),d.reverse(),k=[],i=0,j=d.length;j>i;i++)c=d[i],k.push(a(c[0],c[1]));return k},c.prototype.drawSeries=function(){var a,b,c,d,e,f;for(this.seriesPoints=[],a=b=d=this.options.ykeys.length-1;0>=d?0>=b:b>=0;a=0>=d?++b:--b)this._drawLineFor(a);for(f=[],a=c=e=this.options.ykeys.length-1;0>=e?0>=c:c>=0;a=0>=e?++c:--c)f.push(this._drawPointFor(a));return f},c.prototype._drawPointFor=function(a){var b,c,d,e,f,g;for(this.seriesPoints[a]=[],f=this.data,g=[],d=0,e=f.length;e>d;d++)c=f[d],b=null,null!=c._y[a]&&(b=this.drawLinePoint(c._x,c._y[a],this.colorFor(c,a,"point"),a)),g.push(this.seriesPoints[a].push(b));return g},c.prototype._drawLineFor=function(a){var b;return b=this.paths[a],null!==b?this.drawLinePath(b,this.colorFor(null,a,"line"),a):void 0},c.createPath=function(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(k="",c&&(g=b.Line.gradients(a)),l={y:null},h=q=0,r=a.length;r>q;h=++q)e=a[h],null!=e.y&&(null!=l.y?c?(f=g[h],j=g[h-1],i=(e.x-l.x)/4,m=l.x+i,o=Math.min(d,l.y+i*j),n=e.x-i,p=Math.min(d,e.y-i*f),k+="C"+m+","+o+","+n+","+p+","+e.x+","+e.y):k+="L"+e.x+","+e.y:c&&null==g[h]||(k+="M"+e.x+","+e.y)),l=e;return k},c.gradients=function(a){var b,c,d,e,f,g,h,i;for(c=function(a,b){return(a.y-b.y)/(a.x-b.x)},i=[],d=g=0,h=a.length;h>g;d=++g)b=a[d],null!=b.y?(e=a[d+1]||{y:null},f=a[d-1]||{y:null},null!=f.y&&null!=e.y?i.push(c(f,e)):null!=f.y?i.push(c(f,b)):null!=e.y?i.push(c(b,e)):i.push(null)):i.push(null);return i},c.prototype.hilight=function(a){var b,c,d,e,f;if(null!==this.prevHilight&&this.prevHilight!==a)for(b=c=0,e=this.seriesPoints.length-1;e>=0?e>=c:c>=e;b=e>=0?++c:--c)this.seriesPoints[b][this.prevHilight]&&this.seriesPoints[b][this.prevHilight].animate(this.pointShrinkSeries(b));if(null!==a&&this.prevHilight!==a)for(b=d=0,f=this.seriesPoints.length-1;f>=0?f>=d:d>=f;b=f>=0?++d:--d)this.seriesPoints[b][a]&&this.seriesPoints[b][a].animate(this.pointGrowSeries(b));return this.prevHilight=a},c.prototype.colorFor=function(a,b,c){return"function"==typeof this.options.lineColors?this.options.lineColors.call(this,a,b,c):"point"===c?this.options.pointFillColors[b%this.options.pointFillColors.length]||this.options.lineColors[b%this.options.lineColors.length]:this.options.lineColors[b%this.options.lineColors.length]},c.prototype.drawXAxisLabel=function(a,b,c){return this.raphael.text(a,b,c).attr("font-size",this.options.gridTextSize).attr("font-family",this.options.gridTextFamily).attr("font-weight",this.options.gridTextWeight).attr("fill",this.options.gridTextColor)},c.prototype.drawLinePath=function(a,b,c){return this.raphael.path(a).attr("stroke",b).attr("stroke-width",this.lineWidthForSeries(c))},c.prototype.drawLinePoint=function(a,b,c,d){return this.raphael.circle(a,b,this.pointSizeForSeries(d)).attr("fill",c).attr("stroke-width",this.pointStrokeWidthForSeries(d)).attr("stroke",this.pointStrokeColorForSeries(d))},c.prototype.pointStrokeWidthForSeries=function(a){return this.options.pointStrokeWidths[a%this.options.pointStrokeWidths.length]},c.prototype.pointStrokeColorForSeries=function(a){return this.options.pointStrokeColors[a%this.options.pointStrokeColors.length]},c.prototype.lineWidthForSeries=function(a){return this.options.lineWidth instanceof Array?this.options.lineWidth[a%this.options.lineWidth.length]:this.options.lineWidth},c.prototype.pointSizeForSeries=function(a){return this.options.pointSize instanceof Array?this.options.pointSize[a%this.options.pointSize.length]:this.options.pointSize},c.prototype.pointGrowSeries=function(a){return Raphael.animation({r:this.pointSizeForSeries(a)+3},25,"linear")},c.prototype.pointShrinkSeries=function(a){return Raphael.animation({r:this.pointSizeForSeries(a)},25,"linear")},c}(b.Grid),b.labelSeries=function(c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r;if(j=200*(d-c)/e,i=new Date(c),n=b.LABEL_SPECS[f],void 0===n)for(r=b.AUTO_LABEL_ORDER,p=0,q=r.length;q>p;p++)if(k=r[p],m=b.LABEL_SPECS[k],j>=m.span){n=m;break}for(void 0===n&&(n=b.LABEL_SPECS.second),g&&(n=a.extend({},n,{fmt:g})),h=n.start(i),l=[];(o=h.getTime())<=d;)o>=c&&l.push([n.fmt(h),o]),n.incr(h);return l},c=function(a){return{span:60*a*1e3,start:function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours())},fmt:function(a){return""+b.pad2(a.getHours())+":"+b.pad2(a.getMinutes())},incr:function(b){return b.setUTCMinutes(b.getUTCMinutes()+a)}}},d=function(a){return{span:1e3*a,start:function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes())},fmt:function(a){return""+b.pad2(a.getHours())+":"+b.pad2(a.getMinutes())+":"+b.pad2(a.getSeconds())},incr:function(b){return b.setUTCSeconds(b.getUTCSeconds()+a)}}},b.LABEL_SPECS={decade:{span:1728e8,start:function(a){return new Date(a.getFullYear()-a.getFullYear()%10,0,1)},fmt:function(a){return""+a.getFullYear()},incr:function(a){return a.setFullYear(a.getFullYear()+10)}},year:{span:1728e7,start:function(a){return new Date(a.getFullYear(),0,1)},fmt:function(a){return""+a.getFullYear()},incr:function(a){return a.setFullYear(a.getFullYear()+1)}},month:{span:24192e5,start:function(a){return new Date(a.getFullYear(),a.getMonth(),1)},fmt:function(a){return""+a.getFullYear()+"-"+b.pad2(a.getMonth()+1)},incr:function(a){return a.setMonth(a.getMonth()+1)}},week:{span:6048e5,start:function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())},fmt:function(a){return""+a.getFullYear()+"-"+b.pad2(a.getMonth()+1)+"-"+b.pad2(a.getDate())},incr:function(a){return a.setDate(a.getDate()+7)}},day:{span:864e5,start:function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())},fmt:function(a){return""+a.getFullYear()+"-"+b.pad2(a.getMonth()+1)+"-"+b.pad2(a.getDate())},incr:function(a){return a.setDate(a.getDate()+1)}},hour:c(60),"30min":c(30),"15min":c(15),"10min":c(10),"5min":c(5),minute:c(1),"30sec":d(30),"15sec":d(15),"10sec":d(10),"5sec":d(5),second:d(1)},b.AUTO_LABEL_ORDER=["decade","year","month","week","day","hour","30min","15min","10min","5min","minute","30sec","15sec","10sec","5sec","second"],b.Area=function(c){function d(c){var f;return this instanceof b.Area?(f=a.extend({},e,c),this.cumulative=!f.behaveLikeLine,"auto"===f.fillOpacity&&(f.fillOpacity=f.behaveLikeLine?.8:1),d.__super__.constructor.call(this,f),void 0):new b.Area(c)}var e;return h(d,c),e={fillOpacity:"auto",behaveLikeLine:!1},d.prototype.calcPoints=function(){var a,b,c,d,e,f,g;for(f=this.data,g=[],d=0,e=f.length;e>d;d++)a=f[d],a._x=this.transX(a.x),b=0,a._y=function(){var d,e,f,g;for(f=a.y,g=[],d=0,e=f.length;e>d;d++)c=f[d],this.options.behaveLikeLine?g.push(this.transY(c)):(b+=c||0,g.push(this.transY(b)));return g}.call(this),g.push(a._ymax=Math.max.apply(Math,a._y));return g},d.prototype.drawSeries=function(){var a,b,c,d,e,f,g,h;for(this.seriesPoints=[],b=this.options.behaveLikeLine?function(){f=[];for(var a=0,b=this.options.ykeys.length-1;b>=0?b>=a:a>=b;b>=0?a++:a--)f.push(a);return f}.apply(this):function(){g=[];for(var a=e=this.options.ykeys.length-1;0>=e?0>=a:a>=0;0>=e?a++:a--)g.push(a);return g}.apply(this),h=[],c=0,d=b.length;d>c;c++)a=b[c],this._drawFillFor(a),this._drawLineFor(a),h.push(this._drawPointFor(a));return h},d.prototype._drawFillFor=function(a){var b;return b=this.paths[a],null!==b?(b+="L"+this.transX(this.xmax)+","+this.bottom+"L"+this.transX(this.xmin)+","+this.bottom+"Z",this.drawFilledPath(b,this.fillForSeries(a))):void 0},d.prototype.fillForSeries=function(a){var b;return b=Raphael.rgb2hsl(this.colorFor(this.data[a],a,"line")),Raphael.hsl(b.h,this.options.behaveLikeLine?.9*b.s:.75*b.s,Math.min(.98,this.options.behaveLikeLine?1.2*b.l:1.25*b.l))},d.prototype.drawFilledPath=function(a,b){return this.raphael.path(a).attr("fill",b).attr("fill-opacity",this.options.fillOpacity).attr("stroke","none")},d}(b.Line),b.Bar=function(c){function d(c){return this.onHoverOut=f(this.onHoverOut,this),this.onHoverMove=f(this.onHoverMove,this),this.onGridClick=f(this.onGridClick,this),this instanceof b.Bar?(d.__super__.constructor.call(this,a.extend({},c,{parseTime:!1})),void 0):new b.Bar(c)}return h(d,c),d.prototype.init=function(){return this.cumulative=this.options.stacked,"always"!==this.options.hideHover?(this.hover=new b.Hover({parent:this.el}),this.on("hovermove",this.onHoverMove),this.on("hoverout",this.onHoverOut),this.on("gridclick",this.onGridClick)):void 0},d.prototype.defaults={barSizeRatio:.75,barGap:3,barColors:["#0b62a4","#7a92a3","#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"],barOpacity:1,barRadius:[0,0,0,0],xLabelMargin:50},d.prototype.calc=function(){var a;return this.calcBars(),this.options.hideHover===!1?(a=this.hover).update.apply(a,this.hoverContentForRow(this.data.length-1)):void 0},d.prototype.calcBars=function(){var a,b,c,d,e,f,g;for(f=this.data,g=[],a=d=0,e=f.length;e>d;a=++d)b=f[a],b._x=this.left+this.width*(a+.5)/this.data.length,g.push(b._y=function(){var a,d,e,f;for(e=b.y,f=[],a=0,d=e.length;d>a;a++)c=e[a],null!=c?f.push(this.transY(c)):f.push(null);return f}.call(this));return g},d.prototype.draw=function(){var a;return((a=this.options.axes)===!0||"both"===a||"x"===a)&&this.drawXAxis(),this.drawSeries()},d.prototype.drawXAxis=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;for(j=this.bottom+(this.options.xAxisLabelTopPadding||this.options.padding/2),g=null,f=null,m=[],a=k=0,l=this.data.length;l>=0?l>k:k>l;a=l>=0?++k:--k)h=this.data[this.data.length-1-a],b=this.drawXAxisLabel(h._x,j,h.label),i=b.getBBox(),b.transform("r"+-this.options.xLabelAngle),c=b.getBBox(),b.transform("t0,"+c.height/2+"..."),0!==this.options.xLabelAngle&&(e=-.5*i.width*Math.cos(this.options.xLabelAngle*Math.PI/180),b.transform("t"+e+",0...")),(null==g||g>=c.x+c.width||null!=f&&f>=c.x)&&c.x>=0&&c.x+c.width<this.el.width()?(0!==this.options.xLabelAngle&&(d=1.25*this.options.gridTextSize/Math.sin(this.options.xLabelAngle*Math.PI/180),f=c.x-d),m.push(g=c.x-this.options.xLabelMargin)):m.push(b.remove());return m},d.prototype.drawSeries=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o;return c=this.width/this.options.data.length,h=this.options.stacked?1:this.options.ykeys.length,a=(c*this.options.barSizeRatio-this.options.barGap*(h-1))/h,this.options.barSize&&(a=Math.min(a,this.options.barSize)),l=c-a*h-this.options.barGap*(h-1),g=l/2,o=this.ymin<=0&&this.ymax>=0?this.transY(0):null,this.bars=function(){var h,l,p,q;for(p=this.data,q=[],d=h=0,l=p.length;l>h;d=++h)i=p[d],e=0,q.push(function(){var h,l,p,q;for(p=i._y,q=[],j=h=0,l=p.length;l>h;j=++h)n=p[j],null!==n?(o?(m=Math.min(n,o),b=Math.max(n,o)):(m=n,b=this.bottom),f=this.left+d*c+g,this.options.stacked||(f+=j*(a+this.options.barGap)),k=b-m,this.options.verticalGridCondition&&this.options.verticalGridCondition(i.x)&&this.drawBar(this.left+d*c,this.top,c,Math.abs(this.top-this.bottom),this.options.verticalGridColor,this.options.verticalGridOpacity,this.options.barRadius),this.options.stacked&&(m-=e),this.drawBar(f,m,a,k,this.colorFor(i,j,"bar"),this.options.barOpacity,this.options.barRadius),q.push(e+=k)):q.push(null);return q}.call(this));return q}.call(this)},d.prototype.colorFor=function(a,b,c){var d,e;return"function"==typeof this.options.barColors?(d={x:a.x,y:a.y[b],label:a.label},e={index:b,key:this.options.ykeys[b],label:this.options.labels[b]},this.options.barColors.call(this,d,e,c)):this.options.barColors[b%this.options.barColors.length]},d.prototype.hitTest=function(a){return 0===this.data.length?null:(a=Math.max(Math.min(a,this.right),this.left),Math.min(this.data.length-1,Math.floor((a-this.left)/(this.width/this.data.length))))},d.prototype.onGridClick=function(a,b){var c;return c=this.hitTest(a),this.fire("click",c,this.data[c].src,a,b)},d.prototype.onHoverMove=function(a){var b,c;return b=this.hitTest(a),(c=this.hover).update.apply(c,this.hoverContentForRow(b))},d.prototype.onHoverOut=function(){return this.options.hideHover!==!1?this.hover.hide():void 0},d.prototype.hoverContentForRow=function(a){var b,c,d,e,f,g,h,i;for(d=this.data[a],b="<div class='morris-hover-row-label'>"+d.label+"</div>",i=d.y,c=g=0,h=i.length;h>g;c=++g)f=i[c],b+="<div class='morris-hover-point' style='color: "+this.colorFor(d,c,"label")+"'>\n  "+this.options.labels[c]+":\n  "+this.yLabelFormat(f)+"\n</div>";return"function"==typeof this.options.hoverCallback&&(b=this.options.hoverCallback(a,this.options,b,d.src)),e=this.left+(a+.5)*this.width/this.data.length,[b,e]},d.prototype.drawXAxisLabel=function(a,b,c){var d;return d=this.raphael.text(a,b,c).attr("font-size",this.options.gridTextSize).attr("font-family",this.options.gridTextFamily).attr("font-weight",this.options.gridTextWeight).attr("fill",this.options.gridTextColor)},d.prototype.drawBar=function(a,b,c,d,e,f,g){var h,i;return h=Math.max.apply(Math,g),i=0===h||h>d?this.raphael.rect(a,b,c,d):this.raphael.path(this.roundedRect(a,b,c,d,g)),i.attr("fill",e).attr("fill-opacity",f).attr("stroke","none")},d.prototype.roundedRect=function(a,b,c,d,e){return null==e&&(e=[0,0,0,0]),["M",a,e[0]+b,"Q",a,b,a+e[0],b,"L",a+c-e[1],b,"Q",a+c,b,a+c,b+e[1],"L",a+c,b+d-e[2],"Q",a+c,b+d,a+c-e[2],b+d,"L",a+e[3],b+d,"Q",a,b+d,a,b+d-e[3],"Z"]},d}(b.Grid),b.Donut=function(c){function d(c){this.resizeHandler=f(this.resizeHandler,this),this.select=f(this.select,this),this.click=f(this.click,this);var d=this;if(!(this instanceof b.Donut))return new b.Donut(c);if(this.options=a.extend({},this.defaults,c),this.el="string"==typeof c.element?a(document.getElementById(c.element)):a(c.element),null===this.el||0===this.el.length)throw new Error("Graph placeholder not found.");void 0!==c.data&&0!==c.data.length&&(this.raphael=new Raphael(this.el[0]),this.options.resize&&a(window).bind("resize",function(){return null!=d.timeoutId&&window.clearTimeout(d.timeoutId),d.timeoutId=window.setTimeout(d.resizeHandler,100)}),this.setData(c.data))}return h(d,c),d.prototype.defaults={colors:["#0B62A4","#3980B5","#679DC6","#95BBD7","#B0CCE1","#095791","#095085","#083E67","#052C48","#042135"],backgroundColor:"#FFFFFF",labelColor:"#000000",formatter:b.commas,resize:!1},d.prototype.redraw=function(){var a,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;for(this.raphael.clear(),c=this.el.width()/2,d=this.el.height()/2,n=(Math.min(c,d)-10)/3,l=0,u=this.values,o=0,r=u.length;r>o;o++)m=u[o],l+=m;for(i=5/(2*n),a=1.9999*Math.PI-i*this.data.length,g=0,f=0,this.segments=[],v=this.values,e=p=0,s=v.length;s>p;e=++p)m=v[e],j=g+i+a*(m/l),k=new b.DonutSegment(c,d,2*n,n,g,j,this.data[e].color||this.options.colors[f%this.options.colors.length],this.options.backgroundColor,f,this.raphael),k.render(),this.segments.push(k),k.on("hover",this.select),k.on("click",this.click),g=j,f+=1;for(this.text1=this.drawEmptyDonutLabel(c,d-10,this.options.labelColor,15,800),this.text2=this.drawEmptyDonutLabel(c,d+10,this.options.labelColor,14),h=Math.max.apply(Math,this.values),f=0,w=this.values,x=[],q=0,t=w.length;t>q;q++){if(m=w[q],m===h){this.select(f);break}x.push(f+=1)}return x},d.prototype.setData=function(a){var b;return this.data=a,this.values=function(){var a,c,d,e;for(d=this.data,e=[],a=0,c=d.length;c>a;a++)b=d[a],e.push(parseFloat(b.value));return e}.call(this),this.redraw()},d.prototype.click=function(a){return this.fire("click",a,this.data[a])},d.prototype.select=function(a){var b,c,d,e,f,g;for(g=this.segments,e=0,f=g.length;f>e;e++)c=g[e],c.deselect();return d=this.segments[a],d.select(),b=this.data[a],this.setLabels(b.label,this.options.formatter(b.value,b))},d.prototype.setLabels=function(a,b){var c,d,e,f,g,h,i,j;return c=2*(Math.min(this.el.width()/2,this.el.height()/2)-10)/3,f=1.8*c,e=c/2,d=c/3,this.text1.attr({text:a,transform:""}),g=this.text1.getBBox(),h=Math.min(f/g.width,e/g.height),this.text1.attr({transform:"S"+h+","+h+","+(g.x+g.width/2)+","+(g.y+g.height)}),this.text2.attr({text:b,transform:""}),i=this.text2.getBBox(),j=Math.min(f/i.width,d/i.height),this.text2.attr({transform:"S"+j+","+j+","+(i.x+i.width/2)+","+i.y})},d.prototype.drawEmptyDonutLabel=function(a,b,c,d,e){var f;return f=this.raphael.text(a,b,"").attr("font-size",d).attr("fill",c),null!=e&&f.attr("font-weight",e),f},d.prototype.resizeHandler=function(){return this.timeoutId=null,this.raphael.setSize(this.el.width(),this.el.height()),this.redraw()},d}(b.EventEmitter),b.DonutSegment=function(a){function b(a,b,c,d,e,g,h,i,j,k){this.cx=a,this.cy=b,this.inner=c,this.outer=d,this.color=h,this.backgroundColor=i,this.index=j,this.raphael=k,this.deselect=f(this.deselect,this),this.select=f(this.select,this),this.sin_p0=Math.sin(e),this.cos_p0=Math.cos(e),this.sin_p1=Math.sin(g),this.cos_p1=Math.cos(g),this.is_long=g-e>Math.PI?1:0,this.path=this.calcSegment(this.inner+3,this.inner+this.outer-5),this.selectedPath=this.calcSegment(this.inner+3,this.inner+this.outer),this.hilight=this.calcArc(this.inner)}return h(b,a),b.prototype.calcArcPoints=function(a){return[this.cx+a*this.sin_p0,this.cy+a*this.cos_p0,this.cx+a*this.sin_p1,this.cy+a*this.cos_p1]},b.prototype.calcSegment=function(a,b){var c,d,e,f,g,h,i,j,k,l;return k=this.calcArcPoints(a),c=k[0],e=k[1],d=k[2],f=k[3],l=this.calcArcPoints(b),g=l[0],i=l[1],h=l[2],j=l[3],"M"+c+","+e+("A"+a+","+a+",0,"+this.is_long+",0,"+d+","+f)+("L"+h+","+j)+("A"+b+","+b+",0,"+this.is_long+",1,"+g+","+i)+"Z"},b.prototype.calcArc=function(a){var b,c,d,e,f;return f=this.calcArcPoints(a),b=f[0],d=f[1],c=f[2],e=f[3],"M"+b+","+d+("A"+a+","+a+",0,"+this.is_long+",0,"+c+","+e)},b.prototype.render=function(){var a=this;return this.arc=this.drawDonutArc(this.hilight,this.color),this.seg=this.drawDonutSegment(this.path,this.color,this.backgroundColor,function(){return a.fire("hover",a.index)},function(){return a.fire("click",a.index)})},b.prototype.drawDonutArc=function(a,b){return this.raphael.path(a).attr({stroke:b,"stroke-width":2,opacity:0})},b.prototype.drawDonutSegment=function(a,b,c,d,e){return this.raphael.path(a).attr({fill:b,stroke:c,"stroke-width":3}).hover(d).click(e)},b.prototype.select=function(){return this.selected?void 0:(this.seg.animate({path:this.selectedPath},150,"<>"),this.arc.animate({opacity:1},150,"<>"),this.selected=!0)},b.prototype.deselect=function(){return this.selected?(this.seg.animate({path:this.path},150,"<>"),this.arc.animate({opacity:0},150,"<>"),this.selected=!1):void 0},b}(b.EventEmitter)}).call(this);(function(){"use strict";var objectTypes={function:true,object:true};var root=objectTypes[typeof window]&&window||this;var oldRoot=root;var freeExports=objectTypes[typeof exports]&&exports;var freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module;var freeGlobal=freeExports&&freeModule&&typeof global=="object"&&global;if(freeGlobal&&(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal)){root=freeGlobal}var maxSafeInteger=Math.pow(2,53)-1;var reOpera=/\bOpera/;var thisBinding=this;var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var toString=objectProto.toString;function capitalize(string){string=String(string);return string.charAt(0).toUpperCase()+string.slice(1)}function cleanupOS(os,pattern,label){var data={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};if(pattern&&label&&/^Win/i.test(os)&&!/^Windows Phone /i.test(os)&&(data=data[/[\d.]+$/.exec(os)])){os="Windows "+data}os=String(os);if(pattern&&label){os=os.replace(RegExp(pattern,"i"),label)}os=format(os.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0]);return os}function each(object,callback){var index=-1,length=object?object.length:0;if(typeof length=="number"&&length>-1&&length<=maxSafeInteger){while(++index<length){callback(object[index],index,object)}}else{forOwn(object,callback)}}function format(string){string=trim(string);return/^(?:webOS|i(?:OS|P))/.test(string)?string:capitalize(string)}function forOwn(object,callback){for(var key in object){if(hasOwnProperty.call(object,key)){callback(object[key],key,object)}}}function getClassOf(value){return value==null?capitalize(value):toString.call(value).slice(8,-1)}function isHostType(object,property){var type=object!=null?typeof object[property]:"number";return!/^(?:boolean|number|string|undefined)$/.test(type)&&(type=="object"?!!object[property]:true)}function qualify(string){return String(string).replace(/([ -])(?!$)/g,"$1?")}function reduce(array,callback){var accumulator=null;each(array,function(value,index){accumulator=callback(accumulator,value,index,array)});return accumulator}function trim(string){return String(string).replace(/^ +| +$/g,"")}function parse(ua){var context=root;var isCustomContext=ua&&typeof ua=="object"&&getClassOf(ua)!="String";if(isCustomContext){context=ua;ua=null}var nav=context.navigator||{};var userAgent=nav.userAgent||"";ua||(ua=userAgent);var isModuleScope=isCustomContext||thisBinding==oldRoot;var likeChrome=isCustomContext?!!nav.likeChrome:/\bChrome\b/.test(ua)&&!/internal|\n/i.test(toString.toString());var objectClass="Object",airRuntimeClass=isCustomContext?objectClass:"ScriptBridgingProxyObject",enviroClass=isCustomContext?objectClass:"Environment",javaClass=isCustomContext&&context.java?"JavaPackage":getClassOf(context.java),phantomClass=isCustomContext?objectClass:"RuntimeObject";var java=/\bJava/.test(javaClass)&&context.java;var rhino=java&&getClassOf(context.environment)==enviroClass;var alpha=java?"a":"α";var beta=java?"b":"β";var doc=context.document||{};var opera=context.operamini||context.opera;var operaClass=reOpera.test(operaClass=isCustomContext&&opera?opera["[[Class]]"]:getClassOf(opera))?operaClass:opera=null;var data;var arch=ua;var description=[];var prerelease=null;var useFeatures=ua==userAgent;var version=useFeatures&&opera&&typeof opera.version=="function"&&opera.version();var isSpecialCasedOS;var layout=getLayout([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]);var name=getName(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]);var product=getProduct([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]);var manufacturer=getManufacturer({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}});var os=getOS(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function getLayout(guesses){return reduce(guesses,function(result,guess){return result||RegExp("\\b"+(guess.pattern||qualify(guess))+"\\b","i").exec(ua)&&(guess.label||guess)})}function getManufacturer(guesses){return reduce(guesses,function(result,value,key){return result||(value[product]||value[/^[a-z]+(?: +[a-z]+\b)*/i.exec(product)]||RegExp("\\b"+qualify(key)+"(?:\\b|\\w*\\d)","i").exec(ua))&&key})}function getName(guesses){return reduce(guesses,function(result,guess){return result||RegExp("\\b"+(guess.pattern||qualify(guess))+"\\b","i").exec(ua)&&(guess.label||guess)})}function getOS(guesses){return reduce(guesses,function(result,guess){var pattern=guess.pattern||qualify(guess);if(!result&&(result=RegExp("\\b"+pattern+"(?:/[\\d.]+|[ \\w.]*)","i").exec(ua))){result=cleanupOS(result,pattern,guess.label||guess)}return result})}function getProduct(guesses){return reduce(guesses,function(result,guess){var pattern=guess.pattern||qualify(guess);if(!result&&(result=RegExp("\\b"+pattern+" *\\d+[.\\w_]*","i").exec(ua)||RegExp("\\b"+pattern+" *\\w+-[\\w]*","i").exec(ua)||RegExp("\\b"+pattern+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(ua))){if((result=String(guess.label&&!RegExp(pattern,"i").test(guess.label)?guess.label:result).split("/"))[1]&&!/[\d.]+/.test(result[0])){result[0]+=" "+result[1]}guess=guess.label||guess;result=format(result[0].replace(RegExp(pattern,"i"),guess).replace(RegExp("; *(?:"+guess+"[_-])?","i")," ").replace(RegExp("("+guess+")[-_.]?(\\w)","i"),"$1 $2"))}return result})}function getVersion(patterns){return reduce(patterns,function(result,pattern){return result||(RegExp(pattern+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(ua)||0)[1]||null})}function toStringPlatform(){return this.description||""}layout&&(layout=[layout]);if(/\bAndroid\b/.test(os)&&!product&&(data=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(ua))){product=trim(data[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null}if(manufacturer&&!product){product=getProduct([manufacturer])}else if(manufacturer&&product){product=product.replace(RegExp("^("+qualify(manufacturer)+")[-_.\\s]","i"),manufacturer+" ").replace(RegExp("^("+qualify(manufacturer)+")[-_.]?(\\w)","i"),manufacturer+" $2")}if(data=/\bGoogle TV\b/.exec(product)){product=data[0]}if(/\bSimulator\b/i.test(ua)){product=(product?product+" ":"")+"Simulator"}if(name=="Opera Mini"&&/\bOPiOS\b/.test(ua)){description.push("running in Turbo/Uncompressed mode")}if(name=="IE"&&/\blike iPhone OS\b/.test(ua)){data=parse(ua.replace(/like iPhone OS/,""));manufacturer=data.manufacturer;product=data.product}else if(/^iP/.test(product)){name||(name="Safari");os="iOS"+((data=/ OS ([\d_]+)/i.exec(ua))?" "+data[1].replace(/_/g,"."):"")}else if(name=="Konqueror"&&/^Linux\b/i.test(os)){os="Kubuntu"}else if(manufacturer&&manufacturer!="Google"&&(/Chrome/.test(name)&&!/\bMobile Safari\b/i.test(ua)||/\bVita\b/.test(product))||/\bAndroid\b/.test(os)&&/^Chrome/.test(name)&&/\bVersion\//i.test(ua)){name="Android Browser";os=/\bAndroid\b/.test(os)?os:"Android"}else if(name=="Silk"){if(!/\bMobi/i.test(ua)){os="Android";description.unshift("desktop mode")}if(/Accelerated *= *true/i.test(ua)){description.unshift("accelerated")}}else if(name=="UC Browser"&&/\bUCWEB\b/.test(ua)){description.push("speed mode")}else if(name=="PaleMoon"&&(data=/\bFirefox\/([\d.]+)\b/.exec(ua))){description.push("identifying as Firefox "+data[1])}else if(name=="Firefox"&&(data=/\b(Mobile|Tablet|TV)\b/i.exec(ua))){os||(os="Firefox OS");product||(product=data[1])}else if(!name||(data=!/\bMinefield\b/i.test(ua)&&/\b(?:Firefox|Safari)\b/.exec(name))){if(name&&!product&&/[\/,]|^[^(]+?\)/.test(ua.slice(ua.indexOf(data+"/")+8))){name=null}if((data=product||manufacturer||os)&&(product||manufacturer||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(os))){name=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(os)?os:data)+" Browser"}}else if(name=="Electron"&&(data=(/\bChrome\/([\d.]+)\b/.exec(ua)||0)[1])){description.push("Chromium "+data)}if(!version){version=getVersion(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",qualify(name),"(?:Firefox|Minefield|NetFront)"])}if(data=layout=="iCab"&&parseFloat(version)>3&&"WebKit"||/\bOpera\b/.test(name)&&(/\bOPR\b/.test(ua)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(ua)&&!/^(?:Trident|EdgeHTML)$/.test(layout)&&"WebKit"||!layout&&/\bMSIE\b/i.test(ua)&&(os=="Mac OS"?"Tasman":"Trident")||layout=="WebKit"&&/\bPlayStation\b(?! Vita\b)/i.test(name)&&"NetFront"){layout=[data]}if(name=="IE"&&(data=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(ua)||0)[1])){name+=" Mobile";os="Windows Phone "+(/\+$/.test(data)?data:data+".x");description.unshift("desktop mode")}else if(/\bWPDesktop\b/i.test(ua)){name="IE Mobile";os="Windows Phone 8.x";description.unshift("desktop mode");version||(version=(/\brv:([\d.]+)/.exec(ua)||0)[1])}else if(name!="IE"&&layout=="Trident"&&(data=/\brv:([\d.]+)/.exec(ua))){if(name){description.push("identifying as "+name+(version?" "+version:""))}name="IE";version=data[1]}if(useFeatures){if(isHostType(context,"global")){if(java){data=java.lang.System;arch=data.getProperty("os.arch");os=os||data.getProperty("os.name")+" "+data.getProperty("os.version")}if(rhino){try{version=context.require("ringo/engine").version.join(".");name="RingoJS"}catch(e){if((data=context.system)&&data.global.system==context.system){name="Narwhal";os||(os=data[0].os||null)}}if(!name){name="Rhino"}}else if(typeof context.process=="object"&&!context.process.browser&&(data=context.process)){if(typeof data.versions=="object"){if(typeof data.versions.electron=="string"){description.push("Node "+data.versions.node);name="Electron";version=data.versions.electron}else if(typeof data.versions.nw=="string"){description.push("Chromium "+version,"Node "+data.versions.node);name="NW.js";version=data.versions.nw}}if(!name){name="Node.js";arch=data.arch;os=data.platform;version=/[\d.]+/.exec(data.version);version=version?version[0]:null}}}else if(getClassOf(data=context.runtime)==airRuntimeClass){name="Adobe AIR";os=data.flash.system.Capabilities.os}else if(getClassOf(data=context.phantom)==phantomClass){name="PhantomJS";version=(data=data.version||null)&&data.major+"."+data.minor+"."+data.patch}else if(typeof doc.documentMode=="number"&&(data=/\bTrident\/(\d+)/i.exec(ua))){version=[version,doc.documentMode];if((data=+data[1]+4)!=version[1]){description.push("IE "+version[1]+" mode");layout&&(layout[1]="");version[1]=data}version=name=="IE"?String(version[1].toFixed(1)):version[0]}else if(typeof doc.documentMode=="number"&&/^(?:Chrome|Firefox)\b/.test(name)){description.push("masking as "+name+" "+version);name="IE";version="11.0";layout=["Trident"];os="Windows"}os=os&&format(os)}if(version&&(data=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(version)||/(?:alpha|beta)(?: ?\d)?/i.exec(ua+";"+(useFeatures&&nav.appMinorVersion))||/\bMinefield\b/i.test(ua)&&"a")){prerelease=/b/i.test(data)?"beta":"alpha";version=version.replace(RegExp(data+"\\+?$"),"")+(prerelease=="beta"?beta:alpha)+(/\d+\+?/.exec(data)||"")}if(name=="Fennec"||name=="Firefox"&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(os)){name="Firefox Mobile"}else if(name=="Maxthon"&&version){version=version.replace(/\.[\d.]+/,".x")}else if(/\bXbox\b/i.test(product)){if(product=="Xbox 360"){os=null}if(product=="Xbox 360"&&/\bIEMobile\b/.test(ua)){description.unshift("mobile mode")}}else if((/^(?:Chrome|IE|Opera)$/.test(name)||name&&!product&&!/Browser|Mobi/.test(name))&&(os=="Windows CE"||/Mobi/i.test(ua))){name+=" Mobile"}else if(name=="IE"&&useFeatures){try{if(context.external===null){description.unshift("platform preview")}}catch(e){description.unshift("embedded")}}else if((/\bBlackBerry\b/.test(product)||/\bBB10\b/.test(ua))&&(data=(RegExp(product.replace(/ +/g," *")+"/([.\\d]+)","i").exec(ua)||0)[1]||version)){data=[data,/BB10/.test(ua)];os=(data[1]?(product=null,manufacturer="BlackBerry"):"Device Software")+" "+data[0];version=null}else if(this!=forOwn&&product!="Wii"&&(useFeatures&&opera||/Opera/.test(name)&&/\b(?:MSIE|Firefox)\b/i.test(ua)||name=="Firefox"&&/\bOS X (?:\d+\.){2,}/.test(os)||name=="IE"&&(os&&!/^Win/.test(os)&&version>5.5||/\bWindows XP\b/.test(os)&&version>8||version==8&&!/\bTrident\b/.test(ua)))&&!reOpera.test(data=parse.call(forOwn,ua.replace(reOpera,"")+";"))&&data.name){data="ing as "+data.name+((data=data.version)?" "+data:"");if(reOpera.test(name)){if(/\bIE\b/.test(data)&&os=="Mac OS"){os=null}data="identify"+data}else{data="mask"+data;if(operaClass){name=format(operaClass.replace(/([a-z])([A-Z])/g,"$1 $2"))}else{name="Opera"}if(/\bIE\b/.test(data)){os=null}if(!useFeatures){version=null}}layout=["Presto"];description.push(data)}if(data=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(ua)||0)[1]){data=[parseFloat(data.replace(/\.(\d)$/,".0$1")),data];if(name=="Safari"&&data[1].slice(-1)=="+"){name="WebKit Nightly";prerelease="alpha";version=data[1].slice(0,-1)}else if(version==data[1]||version==(data[2]=(/\bSafari\/([\d.]+\+?)/i.exec(ua)||0)[1])){version=null}data[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(ua)||0)[1];if(data[0]==537.36&&data[2]==537.36&&parseFloat(data[1])>=28&&layout=="WebKit"){layout=["Blink"]}if(!useFeatures||!likeChrome&&!data[1]){layout&&(layout[1]="like Safari");data=(data=data[0],data<400?1:data<500?2:data<526?3:data<533?4:data<534?"4+":data<535?5:data<537?6:data<538?7:data<601?8:data<602?9:data<604?10:data<606?11:data<608?12:"12")}else{layout&&(layout[1]="like Chrome");data=data[1]||(data=data[0],data<530?1:data<532?2:data<532.05?3:data<533?4:data<534.03?5:data<534.07?6:data<534.1?7:data<534.13?8:data<534.16?9:data<534.24?10:data<534.3?11:data<535.01?12:data<535.02?"13+":data<535.07?15:data<535.11?16:data<535.19?17:data<536.05?18:data<536.1?19:data<537.01?20:data<537.11?"21+":data<537.13?23:data<537.18?24:data<537.24?25:data<537.36?26:layout!="Blink"?"27":"28")}layout&&(layout[1]+=" "+(data+=typeof data=="number"?".x":/[.+]/.test(data)?"":"+"));if(name=="Safari"&&(!version||parseInt(version)>45)){version=data}else if(name=="Chrome"&&/\bHeadlessChrome/i.test(ua)){description.unshift("headless")}}if(name=="Opera"&&(data=/\bzbov|zvav$/.exec(os))){name+=" ";description.unshift("desktop mode");if(data=="zvav"){name+="Mini";version=null}else{name+="Mobile"}os=os.replace(RegExp(" *"+data+"$"),"")}else if(name=="Safari"&&/\bChrome\b/.exec(layout&&layout[1])){description.unshift("desktop mode");name="Chrome Mobile";version=null;if(/\bOS X\b/.test(os)){manufacturer="Apple";os="iOS 4.3+"}else{os=null}}else if(/\bSRWare Iron\b/.test(name)&&!version){version=getVersion("Chrome")}if(version&&version.indexOf(data=/[\d.]+$/.exec(os))==0&&ua.indexOf("/"+data+"-")>-1){os=trim(os.replace(data,""))}if(os&&os.indexOf(name)!=-1&&!RegExp(name+" OS").test(os)){os=os.replace(RegExp(" *"+qualify(name)+" *"),"")}if(layout&&!/\b(?:Avant|Nook)\b/.test(name)&&(/Browser|Lunascape|Maxthon/.test(name)||name!="Safari"&&/^iOS/.test(os)&&/\bSafari\b/.test(layout[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(name)&&layout[1])){(data=layout[layout.length-1])&&description.push(data)}if(description.length){description=["("+description.join("; ")+")"]}if(manufacturer&&product&&product.indexOf(manufacturer)<0){description.push("on "+manufacturer)}if(product){description.push((/^on /.test(description[description.length-1])?"":"on ")+product)}if(os){data=/ ([\d.+]+)$/.exec(os);isSpecialCasedOS=data&&os.charAt(os.length-data[0].length-1)=="/";os={architecture:32,family:data&&!isSpecialCasedOS?os.replace(data[0],""):os,version:data?data[1]:null,toString:function(){var version=this.version;return this.family+(version&&!isSpecialCasedOS?" "+version:"")+(this.architecture==64?" 64-bit":"")}}}if((data=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(arch))&&!/\bi686\b/i.test(arch)){if(os){os.architecture=64;os.family=os.family.replace(RegExp(" *"+data),"")}if(name&&(/\bWOW64\b/i.test(ua)||useFeatures&&/\w(?:86|32)$/.test(nav.cpuClass||nav.platform)&&!/\bWin64; x64\b/i.test(ua))){description.unshift("32-bit")}}else if(os&&/^OS X/.test(os.family)&&name=="Chrome"&&parseFloat(version)>=39){os.architecture=64}ua||(ua=null);var platform={};platform.description=ua;platform.layout=layout&&layout[0];platform.manufacturer=manufacturer;platform.name=name;platform.prerelease=prerelease;platform.product=product;platform.ua=ua;platform.version=name&&version;platform.os=os||{architecture:null,family:null,version:null,toString:function(){return"null"}};platform.parse=parse;platform.toString=toStringPlatform;if(platform.version){description.unshift(version)}if(platform.name){description.unshift(name)}if(os&&name&&!(os==String(os).split(" ")[0]&&(os==name.split(" ")[0]||product))){description.push(product?"("+os+")":"on "+os)}if(description.length){platform.description=description.join(" ")}return platform}var platform=parse();if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){root.platform=platform;define(function(){return platform})}else if(freeExports&&freeModule){forOwn(platform,function(value,key){freeExports[key]=value})}else{root.platform=platform}}).call(this);function Range(){this._value=0;this._minimum=0;this._maximum=100;this._extent=0;this._isChanging=false}Range.prototype.setValue=function(value){value=Math.round(parseFloat(value));if(isNaN(value))return;if(this._value!=value){if(value+this._extent>this._maximum)this._value=this._maximum-this._extent;else if(value<this._minimum)this._value=this._minimum;else this._value=value;if(!this._isChanging&&typeof this.onchange=="function")this.onchange()}};Range.prototype.getValue=function(){return this._value};Range.prototype.setExtent=function(extent){if(this._extent!=extent){if(extent<0)this._extent=0;else if(this._value+extent>this._maximum)this._extent=this._maximum-this._value;else this._extent=extent;if(!this._isChanging&&typeof this.onchange=="function")this.onchange()}};Range.prototype.getExtent=function(){return this._extent};Range.prototype.setMinimum=function(minimum){if(this._minimum!=minimum){var oldIsChanging=this._isChanging;this._isChanging=true;this._minimum=minimum;if(minimum>this._value)this.setValue(minimum);if(minimum>this._maximum){this._extent=0;this.setMaximum(minimum);this.setValue(minimum)}if(minimum+this._extent>this._maximum)this._extent=this._maximum-this._minimum;this._isChanging=oldIsChanging;if(!this._isChanging&&typeof this.onchange=="function")this.onchange()}};Range.prototype.getMinimum=function(){return this._minimum};Range.prototype.setMaximum=function(maximum){if(this._maximum!=maximum){var oldIsChanging=this._isChanging;this._isChanging=true;this._maximum=maximum;if(maximum<this._value)this.setValue(maximum-this._extent);if(maximum<this._minimum){this._extent=0;this.setMinimum(maximum);this.setValue(this._maximum)}if(maximum<this._minimum+this._extent)this._extent=this._maximum-this._minimum;if(maximum<this._value+this._extent)this._extent=this._maximum-this._value;this._isChanging=oldIsChanging;if(!this._isChanging&&typeof this.onchange=="function")this.onchange()}};Range.prototype.getMaximum=function(){return this._maximum};!function t(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("Raphael",[],r):"object"==typeof exports?exports.Raphael=r():e.Raphael=r()}(this,function(){return function(t){function e(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){var i,n;i=[r(1),r(3),r(4)],n=function(t){return t}.apply(e,i),!(void 0!==n&&(t.exports=n))},function(t,e,r){var i,n;i=[r(2)],n=function(t){function e(r){if(e.is(r,"function"))return w?r():t.on("raphael.DOMload",r);if(e.is(r,Q))return e._engine.create[z](e,r.splice(0,3+e.is(r[0],$))).add(r);var i=Array.prototype.slice.call(arguments,0);if(e.is(i[i.length-1],"function")){var n=i.pop();return w?n.call(e._engine.create[z](e,i)):t.on("raphael.DOMload",function(){n.call(e._engine.create[z](e,i))})}return e._engine.create[z](e,arguments)}function r(t){if("function"==typeof t||Object(t)!==t)return t;var e=new t.constructor;for(var i in t)t[T](i)&&(e[i]=r(t[i]));return e}function i(t,e){for(var r=0,i=t.length;i>r;r++)if(t[r]===e)return t.push(t.splice(r,1)[0])}function n(t,e,r){function n(){var a=Array.prototype.slice.call(arguments,0),s=a.join("␀"),o=n.cache=n.cache||{},l=n.count=n.count||[];return o[T](s)?(i(l,s),r?r(o[s]):o[s]):(l.length>=1e3&&delete o[l.shift()],l.push(s),o[s]=t[z](e,a),r?r(o[s]):o[s])}return n}function a(){return this.hex}function s(t,e){for(var r=[],i=0,n=t.length;n-2*!e>i;i+=2){var a=[{x:+t[i-2],y:+t[i-1]},{x:+t[i],y:+t[i+1]},{x:+t[i+2],y:+t[i+3]},{x:+t[i+4],y:+t[i+5]}];e?i?n-4==i?a[3]={x:+t[0],y:+t[1]}:n-2==i&&(a[2]={x:+t[0],y:+t[1]},a[3]={x:+t[2],y:+t[3]}):a[0]={x:+t[n-2],y:+t[n-1]}:n-4==i?a[3]=a[2]:i||(a[0]={x:+t[i],y:+t[i+1]}),r.push(["C",(-a[0].x+6*a[1].x+a[2].x)/6,(-a[0].y+6*a[1].y+a[2].y)/6,(a[1].x+6*a[2].x-a[3].x)/6,(a[1].y+6*a[2].y-a[3].y)/6,a[2].x,a[2].y])}return r}function o(t,e,r,i,n){var a=-3*e+9*r-9*i+3*n,s=t*a+6*e-12*r+6*i;return t*s-3*e+3*r}function l(t,e,r,i,n,a,s,l,h){null==h&&(h=1),h=h>1?1:0>h?0:h;for(var u=h/2,c=12,f=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],p=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],d=0,g=0;c>g;g++){var x=u*f[g]+u,v=o(x,t,r,n,s),y=o(x,e,i,a,l),m=v*v+y*y;d+=p[g]*Y.sqrt(m)}return u*d}function h(t,e,r,i,n,a,s,o,h){if(!(0>h||l(t,e,r,i,n,a,s,o)<h)){var u=1,c=u/2,f=u-c,p,d=.01;for(p=l(t,e,r,i,n,a,s,o,f);H(p-h)>d;)c/=2,f+=(h>p?1:-1)*c,p=l(t,e,r,i,n,a,s,o,f);return f}}function u(t,e,r,i,n,a,s,o){if(!(W(t,r)<G(n,s)||G(t,r)>W(n,s)||W(e,i)<G(a,o)||G(e,i)>W(a,o))){var l=(t*i-e*r)*(n-s)-(t-r)*(n*o-a*s),h=(t*i-e*r)*(a-o)-(e-i)*(n*o-a*s),u=(t-r)*(a-o)-(e-i)*(n-s);if(u){var c=l/u,f=h/u,p=+c.toFixed(2),d=+f.toFixed(2);if(!(p<+G(t,r).toFixed(2)||p>+W(t,r).toFixed(2)||p<+G(n,s).toFixed(2)||p>+W(n,s).toFixed(2)||d<+G(e,i).toFixed(2)||d>+W(e,i).toFixed(2)||d<+G(a,o).toFixed(2)||d>+W(a,o).toFixed(2)))return{x:c,y:f}}}}function c(t,e){return p(t,e)}function f(t,e){return p(t,e,1)}function p(t,r,i){var n=e.bezierBBox(t),a=e.bezierBBox(r);if(!e.isBBoxIntersect(n,a))return i?0:[];for(var s=l.apply(0,t),o=l.apply(0,r),h=W(~~(s/5),1),c=W(~~(o/5),1),f=[],p=[],d={},g=i?0:[],x=0;h+1>x;x++){var v=e.findDotsAtSegment.apply(e,t.concat(x/h));f.push({x:v.x,y:v.y,t:x/h})}for(x=0;c+1>x;x++)v=e.findDotsAtSegment.apply(e,r.concat(x/c)),p.push({x:v.x,y:v.y,t:x/c});for(x=0;h>x;x++)for(var y=0;c>y;y++){var m=f[x],b=f[x+1],_=p[y],w=p[y+1],k=H(b.x-m.x)<.001?"y":"x",B=H(w.x-_.x)<.001?"y":"x",C=u(m.x,m.y,b.x,b.y,_.x,_.y,w.x,w.y);if(C){if(d[C.x.toFixed(4)]==C.y.toFixed(4))continue;d[C.x.toFixed(4)]=C.y.toFixed(4);var S=m.t+H((C[k]-m[k])/(b[k]-m[k]))*(b.t-m.t),T=_.t+H((C[B]-_[B])/(w[B]-_[B]))*(w.t-_.t);S>=0&&1.001>=S&&T>=0&&1.001>=T&&(i?g++:g.push({x:C.x,y:C.y,t1:G(S,1),t2:G(T,1)}))}}return g}function d(t,r,i){t=e._path2curve(t),r=e._path2curve(r);for(var n,a,s,o,l,h,u,c,f,d,g=i?0:[],x=0,v=t.length;v>x;x++){var y=t[x];if("M"==y[0])n=l=y[1],a=h=y[2];else{"C"==y[0]?(f=[n,a].concat(y.slice(1)),n=f[6],a=f[7]):(f=[n,a,n,a,l,h,l,h],n=l,a=h);for(var m=0,b=r.length;b>m;m++){var _=r[m];if("M"==_[0])s=u=_[1],o=c=_[2];else{"C"==_[0]?(d=[s,o].concat(_.slice(1)),s=d[6],o=d[7]):(d=[s,o,s,o,u,c,u,c],s=u,o=c);var w=p(f,d,i);if(i)g+=w;else{for(var k=0,B=w.length;B>k;k++)w[k].segment1=x,w[k].segment2=m,w[k].bez1=f,w[k].bez2=d;g=g.concat(w)}}}}}return g}function g(t,e,r,i,n,a){null!=t?(this.a=+t,this.b=+e,this.c=+r,this.d=+i,this.e=+n,this.f=+a):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function x(){return this.x+I+this.y}function v(){return this.x+I+this.y+I+this.width+" × "+this.height}function y(t,e,r,i,n,a){function s(t){return((c*t+u)*t+h)*t}function o(t,e){var r=l(t,e);return((d*r+p)*r+f)*r}function l(t,e){var r,i,n,a,o,l;for(n=t,l=0;8>l;l++){if(a=s(n)-t,H(a)<e)return n;if(o=(3*c*n+2*u)*n+h,H(o)<1e-6)break;n-=a/o}if(r=0,i=1,n=t,r>n)return r;if(n>i)return i;for(;i>r;){if(a=s(n),H(a-t)<e)return n;t>a?r=n:i=n,n=(i-r)/2+r}return n}var h=3*e,u=3*(i-e)-h,c=1-h-u,f=3*r,p=3*(n-r)-f,d=1-f-p;return o(t,1/(200*a))}function m(t,e){var r=[],i={};if(this.ms=e,this.times=1,t){for(var n in t)t[T](n)&&(i[ht(n)]=t[n],r.push(ht(n)));r.sort(Bt)}this.anim=i,this.top=r[r.length-1],this.percents=r}function b(r,i,n,a,s,o){n=ht(n);var l,h,u,c=[],f,p,d,x=r.ms,v={},m={},b={};if(a)for(w=0,B=Ee.length;B>w;w++){var _=Ee[w];if(_.el.id==i.id&&_.anim==r){_.percent!=n?(Ee.splice(w,1),u=1):h=_,i.attr(_.totalOrigin);break}}else a=+m;for(var w=0,B=r.percents.length;B>w;w++){if(r.percents[w]==n||r.percents[w]>a*r.top){n=r.percents[w],p=r.percents[w-1]||0,x=x/r.top*(n-p),f=r.percents[w+1],l=r.anim[n];break}a&&i.attr(r.anim[r.percents[w]])}if(l){if(h)h.initstatus=a,h.start=new Date-h.ms*a;else{for(var C in l)if(l[T](C)&&(pt[T](C)||i.paper.customAttributes[T](C)))switch(v[C]=i.attr(C),null==v[C]&&(v[C]=ft[C]),m[C]=l[C],pt[C]){case $:b[C]=(m[C]-v[C])/x;break;case"colour":v[C]=e.getRGB(v[C]);var S=e.getRGB(m[C]);b[C]={r:(S.r-v[C].r)/x,g:(S.g-v[C].g)/x,b:(S.b-v[C].b)/x};break;case"path":var A=Qt(v[C],m[C]),E=A[1];for(v[C]=A[0],b[C]=[],w=0,B=v[C].length;B>w;w++){b[C][w]=[0];for(var N=1,M=v[C][w].length;M>N;N++)b[C][w][N]=(E[w][N]-v[C][w][N])/x}break;case"transform":var L=i._,z=le(L[C],m[C]);if(z)for(v[C]=z.from,m[C]=z.to,b[C]=[],b[C].real=!0,w=0,B=v[C].length;B>w;w++)for(b[C][w]=[v[C][w][0]],N=1,M=v[C][w].length;M>N;N++)b[C][w][N]=(m[C][w][N]-v[C][w][N])/x;else{var F=i.matrix||new g,R={_:{transform:L.transform},getBBox:function(){return i.getBBox(1)}};v[C]=[F.a,F.b,F.c,F.d,F.e,F.f],se(R,m[C]),m[C]=R._.transform,b[C]=[(R.matrix.a-F.a)/x,(R.matrix.b-F.b)/x,(R.matrix.c-F.c)/x,(R.matrix.d-F.d)/x,(R.matrix.e-F.e)/x,(R.matrix.f-F.f)/x]}break;case"csv":var I=j(l[C])[q](k),D=j(v[C])[q](k);if("clip-rect"==C)for(v[C]=D,b[C]=[],w=D.length;w--;)b[C][w]=(I[w]-v[C][w])/x;m[C]=I;break;default:for(I=[][P](l[C]),D=[][P](v[C]),b[C]=[],w=i.paper.customAttributes[C].length;w--;)b[C][w]=((I[w]||0)-(D[w]||0))/x}var V=l.easing,O=e.easing_formulas[V];if(!O)if(O=j(V).match(st),O&&5==O.length){var Y=O;O=function(t){return y(t,+Y[1],+Y[2],+Y[3],+Y[4],x)}}else O=St;if(d=l.start||r.start||+new Date,_={anim:r,percent:n,timestamp:d,start:d+(r.del||0),status:0,initstatus:a||0,stop:!1,ms:x,easing:O,from:v,diff:b,to:m,el:i,callback:l.callback,prev:p,next:f,repeat:o||r.times,origin:i.attr(),totalOrigin:s},Ee.push(_),a&&!h&&!u&&(_.stop=!0,_.start=new Date-x*a,1==Ee.length))return Me();u&&(_.start=new Date-_.ms*a),1==Ee.length&&Ne(Me)}t("raphael.anim.start."+i.id,i,r)}}function _(t){for(var e=0;e<Ee.length;e++)Ee[e].el.paper==t&&Ee.splice(e--,1)}e.version="@@VERSION",e.eve=t;var w,k=/[, ]+/,B={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},C=/\{(\d+)\}/g,S="prototype",T="hasOwnProperty",A={doc:document,win:window},E={was:Object.prototype[T].call(A.win,"Raphael"),is:A.win.Raphael},N=function(){this.ca=this.customAttributes={}},M,L="appendChild",z="apply",P="concat",F="ontouchstart"in A.win||A.win.DocumentTouch&&A.doc instanceof DocumentTouch,R="",I=" ",j=String,q="split",D="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[q](I),V={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},O=j.prototype.toLowerCase,Y=Math,W=Y.max,G=Y.min,H=Y.abs,X=Y.pow,U=Y.PI,$="number",Z="string",Q="array",J="toString",K="fill",tt=Object.prototype.toString,et={},rt="push",it=e._ISURL=/^url\(['"]?(.+?)['"]?\)$/i,nt=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,at={NaN:1,Infinity:1,"-Infinity":1},st=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,ot=Y.round,lt="setAttribute",ht=parseFloat,ut=parseInt,ct=j.prototype.toUpperCase,ft=e._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},pt=e._availableAnimAttrs={blur:$,"clip-rect":"csv",cx:$,cy:$,fill:"colour","fill-opacity":$,"font-size":$,height:$,opacity:$,path:"path",r:$,rx:$,ry:$,stroke:"colour","stroke-opacity":$,"stroke-width":$,transform:"transform",width:$,x:$,y:$},dt=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]/g,gt=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,xt={hs:1,rg:1},vt=/,?([achlmqrstvxz]),?/gi,yt=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,mt=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,bt=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,_t=e._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,wt={},kt=function(t,e){return t.key-e.key},Bt=function(t,e){return ht(t)-ht(e)},Ct=function(){},St=function(t){return t},Tt=e._rectPath=function(t,e,r,i,n){return n?[["M",t+n,e],["l",r-2*n,0],["a",n,n,0,0,1,n,n],["l",0,i-2*n],["a",n,n,0,0,1,-n,n],["l",2*n-r,0],["a",n,n,0,0,1,-n,-n],["l",0,2*n-i],["a",n,n,0,0,1,n,-n],["z"]]:[["M",t,e],["l",r,0],["l",0,i],["l",-r,0],["z"]]},At=function(t,e,r,i){return null==i&&(i=r),[["M",t,e],["m",0,-i],["a",r,i,0,1,1,0,2*i],["a",r,i,0,1,1,0,-2*i],["z"]]},Et=e._getPath={path:function(t){return t.attr("path")},circle:function(t){var e=t.attrs;return At(e.cx,e.cy,e.r)},ellipse:function(t){var e=t.attrs;return At(e.cx,e.cy,e.rx,e.ry)},rect:function(t){var e=t.attrs;return Tt(e.x,e.y,e.width,e.height,e.r)},image:function(t){var e=t.attrs;return Tt(e.x,e.y,e.width,e.height)},text:function(t){var e=t._getBBox();return Tt(e.x,e.y,e.width,e.height)},set:function(t){var e=t._getBBox();return Tt(e.x,e.y,e.width,e.height)}},Nt=e.mapPath=function(t,e){if(!e)return t;var r,i,n,a,s,o,l;for(t=Qt(t),n=0,s=t.length;s>n;n++)for(l=t[n],a=1,o=l.length;o>a;a+=2)r=e.x(l[a],l[a+1]),i=e.y(l[a],l[a+1]),l[a]=r,l[a+1]=i;return t};if(e._g=A,e.type=A.win.SVGAngle||A.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==e.type){var Mt=A.doc.createElement("div"),Lt;if(Mt.innerHTML='<v:shape adj="1"/>',Lt=Mt.firstChild,Lt.style.behavior="url(#default#VML)",!Lt||"object"!=typeof Lt.adj)return e.type=R;Mt=null}e.svg=!(e.vml="VML"==e.type),e._Paper=N,e.fn=M=N.prototype=e.prototype,e._id=0,e._oid=0,e.is=function(t,e){return e=O.call(e),"finite"==e?!at[T](+t):"array"==e?t instanceof Array:"null"==e&&null===t||e==typeof t&&null!==t||"object"==e&&t===Object(t)||"array"==e&&Array.isArray&&Array.isArray(t)||tt.call(t).slice(8,-1).toLowerCase()==e},e.angle=function(t,r,i,n,a,s){if(null==a){var o=t-i,l=r-n;return o||l?(180+180*Y.atan2(-l,-o)/U+360)%360:0}return e.angle(t,r,a,s)-e.angle(i,n,a,s)},e.rad=function(t){return t%360*U/180},e.deg=function(t){return Math.round(180*t/U%360*1e3)/1e3},e.snapTo=function(t,r,i){if(i=e.is(i,"finite")?i:10,e.is(t,Q)){for(var n=t.length;n--;)if(H(t[n]-r)<=i)return t[n]}else{t=+t;var a=r%t;if(i>a)return r-a;if(a>t-i)return r-a+t}return r};var zt=e.createUUID=function(t,e){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(t,e).toUpperCase()}}(/[xy]/g,function(t){var e=16*Y.random()|0,r="x"==t?e:3&e|8;return r.toString(16)});e.setWindow=function(r){t("raphael.setWindow",e,A.win,r),A.win=r,A.doc=A.win.document,e._engine.initWin&&e._engine.initWin(A.win)};var Pt=function(t){if(e.vml){var r=/^\s+|\s+$/g,i;try{var a=new ActiveXObject("htmlfile");a.write("<body>"),a.close(),i=a.body}catch(s){i=createPopup().document.body}var o=i.createTextRange();Pt=n(function(t){try{i.style.color=j(t).replace(r,R);var e=o.queryCommandValue("ForeColor");return e=(255&e)<<16|65280&e|(16711680&e)>>>16,"#"+("000000"+e.toString(16)).slice(-6)}catch(n){return"none"}})}else{var l=A.doc.createElement("i");l.title="Raphaël Colour Picker",l.style.display="none",A.doc.body.appendChild(l),Pt=n(function(t){return l.style.color=t,A.doc.defaultView.getComputedStyle(l,R).getPropertyValue("color")})}return Pt(t)},Ft=function(){return"hsb("+[this.h,this.s,this.b]+")"},Rt=function(){return"hsl("+[this.h,this.s,this.l]+")"},It=function(){return this.hex},jt=function(t,r,i){if(null==r&&e.is(t,"object")&&"r"in t&&"g"in t&&"b"in t&&(i=t.b,r=t.g,t=t.r),null==r&&e.is(t,Z)){var n=e.getRGB(t);t=n.r,r=n.g,i=n.b}return(t>1||r>1||i>1)&&(t/=255,r/=255,i/=255),[t,r,i]},qt=function(t,r,i,n){t*=255,r*=255,i*=255;var a={r:t,g:r,b:i,hex:e.rgb(t,r,i),toString:It};return e.is(n,"finite")&&(a.opacity=n),a};e.color=function(t){var r;return e.is(t,"object")&&"h"in t&&"s"in t&&"b"in t?(r=e.hsb2rgb(t),t.r=r.r,t.g=r.g,t.b=r.b,t.hex=r.hex):e.is(t,"object")&&"h"in t&&"s"in t&&"l"in t?(r=e.hsl2rgb(t),t.r=r.r,t.g=r.g,t.b=r.b,t.hex=r.hex):(e.is(t,"string")&&(t=e.getRGB(t)),e.is(t,"object")&&"r"in t&&"g"in t&&"b"in t?(r=e.rgb2hsl(t),t.h=r.h,t.s=r.s,t.l=r.l,r=e.rgb2hsb(t),t.v=r.b):(t={hex:"none"},t.r=t.g=t.b=t.h=t.s=t.v=t.l=-1)),t.toString=It,t},e.hsb2rgb=function(t,e,r,i){this.is(t,"object")&&"h"in t&&"s"in t&&"b"in t&&(r=t.b,e=t.s,i=t.o,t=t.h),t*=360;var n,a,s,o,l;return t=t%360/60,l=r*e,o=l*(1-H(t%2-1)),n=a=s=r-l,t=~~t,n+=[l,o,0,0,o,l][t],a+=[o,l,l,o,0,0][t],s+=[0,0,o,l,l,o][t],qt(n,a,s,i)},e.hsl2rgb=function(t,e,r,i){this.is(t,"object")&&"h"in t&&"s"in t&&"l"in t&&(r=t.l,e=t.s,t=t.h),(t>1||e>1||r>1)&&(t/=360,e/=100,r/=100),t*=360;var n,a,s,o,l;return t=t%360/60,l=2*e*(.5>r?r:1-r),o=l*(1-H(t%2-1)),n=a=s=r-l/2,t=~~t,n+=[l,o,0,0,o,l][t],a+=[o,l,l,o,0,0][t],s+=[0,0,o,l,l,o][t],qt(n,a,s,i)},e.rgb2hsb=function(t,e,r){r=jt(t,e,r),t=r[0],e=r[1],r=r[2];var i,n,a,s;return a=W(t,e,r),s=a-G(t,e,r),i=0==s?null:a==t?(e-r)/s:a==e?(r-t)/s+2:(t-e)/s+4,i=(i+360)%6*60/360,n=0==s?0:s/a,{h:i,s:n,b:a,toString:Ft}},e.rgb2hsl=function(t,e,r){r=jt(t,e,r),t=r[0],e=r[1],r=r[2];var i,n,a,s,o,l;return s=W(t,e,r),o=G(t,e,r),l=s-o,i=0==l?null:s==t?(e-r)/l:s==e?(r-t)/l+2:(t-e)/l+4,i=(i+360)%6*60/360,a=(s+o)/2,n=0==l?0:.5>a?l/(2*a):l/(2-2*a),{h:i,s:n,l:a,toString:Rt}},e._path2string=function(){return this.join(",").replace(vt,"$1")};var Dt=e._preload=function(t,e){var r=A.doc.createElement("img");r.style.cssText="position:absolute;left:-9999em;top:-9999em",r.onload=function(){e.call(this),this.onload=null,A.doc.body.removeChild(this)},r.onerror=function(){A.doc.body.removeChild(this)},A.doc.body.appendChild(r),r.src=t};e.getRGB=n(function(t){if(!t||(t=j(t)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:a};if("none"==t)return{r:-1,g:-1,b:-1,hex:"none",toString:a};!(xt[T](t.toLowerCase().substring(0,2))||"#"==t.charAt())&&(t=Pt(t));var r,i,n,s,o,l,h,u=t.match(nt);return u?(u[2]&&(s=ut(u[2].substring(5),16),n=ut(u[2].substring(3,5),16),i=ut(u[2].substring(1,3),16)),u[3]&&(s=ut((l=u[3].charAt(3))+l,16),n=ut((l=u[3].charAt(2))+l,16),i=ut((l=u[3].charAt(1))+l,16)),u[4]&&(h=u[4][q](gt),i=ht(h[0]),"%"==h[0].slice(-1)&&(i*=2.55),n=ht(h[1]),"%"==h[1].slice(-1)&&(n*=2.55),s=ht(h[2]),"%"==h[2].slice(-1)&&(s*=2.55),"rgba"==u[1].toLowerCase().slice(0,4)&&(o=ht(h[3])),h[3]&&"%"==h[3].slice(-1)&&(o/=100)),u[5]?(h=u[5][q](gt),i=ht(h[0]),"%"==h[0].slice(-1)&&(i*=2.55),n=ht(h[1]),"%"==h[1].slice(-1)&&(n*=2.55),s=ht(h[2]),"%"==h[2].slice(-1)&&(s*=2.55),("deg"==h[0].slice(-3)||"°"==h[0].slice(-1))&&(i/=360),"hsba"==u[1].toLowerCase().slice(0,4)&&(o=ht(h[3])),h[3]&&"%"==h[3].slice(-1)&&(o/=100),e.hsb2rgb(i,n,s,o)):u[6]?(h=u[6][q](gt),i=ht(h[0]),"%"==h[0].slice(-1)&&(i*=2.55),n=ht(h[1]),"%"==h[1].slice(-1)&&(n*=2.55),s=ht(h[2]),"%"==h[2].slice(-1)&&(s*=2.55),("deg"==h[0].slice(-3)||"°"==h[0].slice(-1))&&(i/=360),"hsla"==u[1].toLowerCase().slice(0,4)&&(o=ht(h[3])),h[3]&&"%"==h[3].slice(-1)&&(o/=100),e.hsl2rgb(i,n,s,o)):(u={r:i,g:n,b:s,toString:a},u.hex="#"+(16777216|s|n<<8|i<<16).toString(16).slice(1),e.is(o,"finite")&&(u.opacity=o),u)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:a}},e),e.hsb=n(function(t,r,i){return e.hsb2rgb(t,r,i).hex}),e.hsl=n(function(t,r,i){return e.hsl2rgb(t,r,i).hex}),e.rgb=n(function(t,e,r){function i(t){return t+.5|0}return"#"+(16777216|i(r)|i(e)<<8|i(t)<<16).toString(16).slice(1)}),e.getColor=function(t){var e=this.getColor.start=this.getColor.start||{h:0,s:1,b:t||.75},r=this.hsb2rgb(e.h,e.s,e.b);return e.h+=.075,e.h>1&&(e.h=0,e.s-=.2,e.s<=0&&(this.getColor.start={h:0,s:1,b:e.b})),r.hex},e.getColor.reset=function(){delete this.start},e.parsePathString=function(t){if(!t)return null;var r=Vt(t);if(r.arr)return Yt(r.arr);var i={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},n=[];return e.is(t,Q)&&e.is(t[0],Q)&&(n=Yt(t)),n.length||j(t).replace(yt,function(t,e,r){var a=[],s=e.toLowerCase();if(r.replace(bt,function(t,e){e&&a.push(+e)}),"m"==s&&a.length>2&&(n.push([e][P](a.splice(0,2))),s="l",e="m"==e?"l":"L"),"r"==s)n.push([e][P](a));else for(;a.length>=i[s]&&(n.push([e][P](a.splice(0,i[s]))),i[s]););}),n.toString=e._path2string,r.arr=Yt(n),n},e.parseTransformString=n(function(t){if(!t)return null;var r={r:3,s:4,t:2,m:6},i=[];return e.is(t,Q)&&e.is(t[0],Q)&&(i=Yt(t)),i.length||j(t).replace(mt,function(t,e,r){var n=[],a=O.call(e);r.replace(bt,function(t,e){e&&n.push(+e)}),i.push([e][P](n))}),i.toString=e._path2string,i});var Vt=function(t){var e=Vt.ps=Vt.ps||{};return e[t]?e[t].sleep=100:e[t]={sleep:100},setTimeout(function(){for(var r in e)e[T](r)&&r!=t&&(e[r].sleep--,!e[r].sleep&&delete e[r])}),e[t]};e.findDotsAtSegment=function(t,e,r,i,n,a,s,o,l){var h=1-l,u=X(h,3),c=X(h,2),f=l*l,p=f*l,d=u*t+3*c*l*r+3*h*l*l*n+p*s,g=u*e+3*c*l*i+3*h*l*l*a+p*o,x=t+2*l*(r-t)+f*(n-2*r+t),v=e+2*l*(i-e)+f*(a-2*i+e),y=r+2*l*(n-r)+f*(s-2*n+r),m=i+2*l*(a-i)+f*(o-2*a+i),b=h*t+l*r,_=h*e+l*i,w=h*n+l*s,k=h*a+l*o,B=90-180*Y.atan2(x-y,v-m)/U;return(x>y||m>v)&&(B+=180),{x:d,y:g,m:{x:x,y:v},n:{x:y,y:m},start:{x:b,y:_},end:{x:w,y:k},alpha:B}},e.bezierBBox=function(t,r,i,n,a,s,o,l){e.is(t,"array")||(t=[t,r,i,n,a,s,o,l]);var h=Zt.apply(null,t);return{x:h.min.x,y:h.min.y,x2:h.max.x,y2:h.max.y,width:h.max.x-h.min.x,height:h.max.y-h.min.y}},e.isPointInsideBBox=function(t,e,r){return e>=t.x&&e<=t.x2&&r>=t.y&&r<=t.y2},e.isBBoxIntersect=function(t,r){var i=e.isPointInsideBBox;return i(r,t.x,t.y)||i(r,t.x2,t.y)||i(r,t.x,t.y2)||i(r,t.x2,t.y2)||i(t,r.x,r.y)||i(t,r.x2,r.y)||i(t,r.x,r.y2)||i(t,r.x2,r.y2)||(t.x<r.x2&&t.x>r.x||r.x<t.x2&&r.x>t.x)&&(t.y<r.y2&&t.y>r.y||r.y<t.y2&&r.y>t.y)},e.pathIntersection=function(t,e){return d(t,e)},e.pathIntersectionNumber=function(t,e){return d(t,e,1)},e.isPointInsidePath=function(t,r,i){var n=e.pathBBox(t);return e.isPointInsideBBox(n,r,i)&&d(t,[["M",r,i],["H",n.x2+10]],1)%2==1},e._removedFactory=function(e){return function(){t("raphael.log",null,"Raphaël: you are calling to method “"+e+"” of removed object",e)}};var Ot=e.pathBBox=function(t){var e=Vt(t);if(e.bbox)return r(e.bbox);if(!t)return{x:0,y:0,width:0,height:0,x2:0,y2:0};t=Qt(t);for(var i=0,n=0,a=[],s=[],o,l=0,h=t.length;h>l;l++)if(o=t[l],"M"==o[0])i=o[1],n=o[2],a.push(i),s.push(n);else{var u=Zt(i,n,o[1],o[2],o[3],o[4],o[5],o[6]);a=a[P](u.min.x,u.max.x),s=s[P](u.min.y,u.max.y),i=o[5],n=o[6]}var c=G[z](0,a),f=G[z](0,s),p=W[z](0,a),d=W[z](0,s),g=p-c,x=d-f,v={x:c,y:f,x2:p,y2:d,width:g,height:x,cx:c+g/2,cy:f+x/2};return e.bbox=r(v),v},Yt=function(t){var i=r(t);return i.toString=e._path2string,i},Wt=e._pathToRelative=function(t){var r=Vt(t);if(r.rel)return Yt(r.rel);e.is(t,Q)&&e.is(t&&t[0],Q)||(t=e.parsePathString(t));var i=[],n=0,a=0,s=0,o=0,l=0;"M"==t[0][0]&&(n=t[0][1],a=t[0][2],s=n,o=a,l++,i.push(["M",n,a]));for(var h=l,u=t.length;u>h;h++){var c=i[h]=[],f=t[h];if(f[0]!=O.call(f[0]))switch(c[0]=O.call(f[0]),c[0]){case"a":c[1]=f[1],c[2]=f[2],c[3]=f[3],c[4]=f[4],c[5]=f[5],c[6]=+(f[6]-n).toFixed(3),c[7]=+(f[7]-a).toFixed(3);break;case"v":c[1]=+(f[1]-a).toFixed(3);break;case"m":s=f[1],o=f[2];default:for(var p=1,d=f.length;d>p;p++)c[p]=+(f[p]-(p%2?n:a)).toFixed(3)}else{c=i[h]=[],"m"==f[0]&&(s=f[1]+n,o=f[2]+a);for(var g=0,x=f.length;x>g;g++)i[h][g]=f[g]}var v=i[h].length;switch(i[h][0]){case"z":n=s,a=o;break;case"h":n+=+i[h][v-1];break;case"v":a+=+i[h][v-1];break;default:n+=+i[h][v-2],a+=+i[h][v-1]}}return i.toString=e._path2string,r.rel=Yt(i),i},Gt=e._pathToAbsolute=function(t){var r=Vt(t);if(r.abs)return Yt(r.abs);if(e.is(t,Q)&&e.is(t&&t[0],Q)||(t=e.parsePathString(t)),!t||!t.length)return[["M",0,0]];var i=[],n=0,a=0,o=0,l=0,h=0;"M"==t[0][0]&&(n=+t[0][1],a=+t[0][2],o=n,l=a,h++,i[0]=["M",n,a]);for(var u=3==t.length&&"M"==t[0][0]&&"R"==t[1][0].toUpperCase()&&"Z"==t[2][0].toUpperCase(),c,f,p=h,d=t.length;d>p;p++){if(i.push(c=[]),f=t[p],f[0]!=ct.call(f[0]))switch(c[0]=ct.call(f[0]),c[0]){case"A":c[1]=f[1],c[2]=f[2],c[3]=f[3],c[4]=f[4],c[5]=f[5],c[6]=+(f[6]+n),c[7]=+(f[7]+a);break;case"V":c[1]=+f[1]+a;break;case"H":c[1]=+f[1]+n;break;case"R":for(var g=[n,a][P](f.slice(1)),x=2,v=g.length;v>x;x++)g[x]=+g[x]+n,g[++x]=+g[x]+a;i.pop(),i=i[P](s(g,u));break;case"M":o=+f[1]+n,l=+f[2]+a;default:for(x=1,v=f.length;v>x;x++)c[x]=+f[x]+(x%2?n:a)}else if("R"==f[0])g=[n,a][P](f.slice(1)),i.pop(),i=i[P](s(g,u)),c=["R"][P](f.slice(-2));else for(var y=0,m=f.length;m>y;y++)c[y]=f[y];switch(c[0]){case"Z":n=o,a=l;break;case"H":n=c[1];break;case"V":a=c[1];break;case"M":o=c[c.length-2],l=c[c.length-1];default:n=c[c.length-2],a=c[c.length-1]}}return i.toString=e._path2string,r.abs=Yt(i),i},Ht=function(t,e,r,i){return[t,e,r,i,r,i]},Xt=function(t,e,r,i,n,a){var s=1/3,o=2/3;return[s*t+o*r,s*e+o*i,s*n+o*r,s*a+o*i,n,a]},Ut=function(t,e,r,i,a,s,o,l,h,u){var c=120*U/180,f=U/180*(+a||0),p=[],d,g=n(function(t,e,r){var i=t*Y.cos(r)-e*Y.sin(r),n=t*Y.sin(r)+e*Y.cos(r);return{x:i,y:n}});if(u)S=u[0],T=u[1],B=u[2],C=u[3];else{d=g(t,e,-f),t=d.x,e=d.y,d=g(l,h,-f),l=d.x,h=d.y;var x=Y.cos(U/180*a),v=Y.sin(U/180*a),y=(t-l)/2,m=(e-h)/2,b=y*y/(r*r)+m*m/(i*i);b>1&&(b=Y.sqrt(b),r=b*r,i=b*i);var _=r*r,w=i*i,k=(s==o?-1:1)*Y.sqrt(H((_*w-_*m*m-w*y*y)/(_*m*m+w*y*y))),B=k*r*m/i+(t+l)/2,C=k*-i*y/r+(e+h)/2,S=Y.asin(((e-C)/i).toFixed(9)),T=Y.asin(((h-C)/i).toFixed(9));S=B>t?U-S:S,T=B>l?U-T:T,0>S&&(S=2*U+S),0>T&&(T=2*U+T),o&&S>T&&(S-=2*U),!o&&T>S&&(T-=2*U)}var A=T-S;if(H(A)>c){var E=T,N=l,M=h;T=S+c*(o&&T>S?1:-1),l=B+r*Y.cos(T),h=C+i*Y.sin(T),p=Ut(l,h,r,i,a,0,o,N,M,[T,E,B,C])}A=T-S;var L=Y.cos(S),z=Y.sin(S),F=Y.cos(T),R=Y.sin(T),I=Y.tan(A/4),j=4/3*r*I,D=4/3*i*I,V=[t,e],O=[t+j*z,e-D*L],W=[l+j*R,h-D*F],G=[l,h];if(O[0]=2*V[0]-O[0],O[1]=2*V[1]-O[1],u)return[O,W,G][P](p);p=[O,W,G][P](p).join()[q](",");for(var X=[],$=0,Z=p.length;Z>$;$++)X[$]=$%2?g(p[$-1],p[$],f).y:g(p[$],p[$+1],f).x;return X},$t=function(t,e,r,i,n,a,s,o,l){var h=1-l;return{x:X(h,3)*t+3*X(h,2)*l*r+3*h*l*l*n+X(l,3)*s,y:X(h,3)*e+3*X(h,2)*l*i+3*h*l*l*a+X(l,3)*o}},Zt=n(function(t,e,r,i,n,a,s,o){var l=n-2*r+t-(s-2*n+r),h=2*(r-t)-2*(n-r),u=t-r,c=(-h+Y.sqrt(h*h-4*l*u))/2/l,f=(-h-Y.sqrt(h*h-4*l*u))/2/l,p=[e,o],d=[t,s],g;return H(c)>"1e12"&&(c=.5),H(f)>"1e12"&&(f=.5),c>0&&1>c&&(g=$t(t,e,r,i,n,a,s,o,c),d.push(g.x),p.push(g.y)),f>0&&1>f&&(g=$t(t,e,r,i,n,a,s,o,f),d.push(g.x),p.push(g.y)),l=a-2*i+e-(o-2*a+i),h=2*(i-e)-2*(a-i),u=e-i,c=(-h+Y.sqrt(h*h-4*l*u))/2/l,f=(-h-Y.sqrt(h*h-4*l*u))/2/l,H(c)>"1e12"&&(c=.5),H(f)>"1e12"&&(f=.5),c>0&&1>c&&(g=$t(t,e,r,i,n,a,s,o,c),d.push(g.x),p.push(g.y)),f>0&&1>f&&(g=$t(t,e,r,i,n,a,s,o,f),d.push(g.x),p.push(g.y)),{min:{x:G[z](0,d),y:G[z](0,p)},max:{x:W[z](0,d),y:W[z](0,p)}}}),Qt=e._path2curve=n(function(t,e){var r=!e&&Vt(t);if(!e&&r.curve)return Yt(r.curve);for(var i=Gt(t),n=e&&Gt(e),a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=function(t,e,r){var i,n,a={T:1,Q:1};if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in a)&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"][P](Ut[z](0,[e.x,e.y][P](t.slice(1))));break;case"S":"C"==r||"S"==r?(i=2*e.x-e.bx,n=2*e.y-e.by):(i=e.x,n=e.y),t=["C",i,n][P](t.slice(1));break;case"T":"Q"==r||"T"==r?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"][P](Xt(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"][P](Xt(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"][P](Ht(e.x,e.y,t[1],t[2]));break;case"H":t=["C"][P](Ht(e.x,e.y,t[1],e.y));break;case"V":t=["C"][P](Ht(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"][P](Ht(e.x,e.y,e.X,e.Y))}return t},l=function(t,e){if(t[e].length>7){t[e].shift();for(var r=t[e];r.length;)u[e]="A",n&&(c[e]="A"),t.splice(e++,0,["C"][P](r.splice(0,6)));t.splice(e,1),g=W(i.length,n&&n.length||0)}},h=function(t,e,r,a,s){t&&e&&"M"==t[s][0]&&"M"!=e[s][0]&&(e.splice(s,0,["M",a.x,a.y]),r.bx=0,r.by=0,r.x=t[s][1],r.y=t[s][2],g=W(i.length,n&&n.length||0))},u=[],c=[],f="",p="",d=0,g=W(i.length,n&&n.length||0);g>d;d++){i[d]&&(f=i[d][0]),"C"!=f&&(u[d]=f,d&&(p=u[d-1])),i[d]=o(i[d],a,p),"A"!=u[d]&&"C"==f&&(u[d]="C"),l(i,d),n&&(n[d]&&(f=n[d][0]),"C"!=f&&(c[d]=f,d&&(p=c[d-1])),n[d]=o(n[d],s,p),"A"!=c[d]&&"C"==f&&(c[d]="C"),l(n,d)),h(i,n,a,s,d),h(n,i,s,a,d);var x=i[d],v=n&&n[d],y=x.length,m=n&&v.length;a.x=x[y-2],a.y=x[y-1],a.bx=ht(x[y-4])||a.x,a.by=ht(x[y-3])||a.y,s.bx=n&&(ht(v[m-4])||s.x),s.by=n&&(ht(v[m-3])||s.y),s.x=n&&v[m-2],s.y=n&&v[m-1]}return n||(r.curve=Yt(i)),n?[i,n]:i},null,Yt),Jt=e._parseDots=n(function(t){for(var r=[],i=0,n=t.length;n>i;i++){var a={},s=t[i].match(/^([^:]*):?([\d\.]*)/);if(a.color=e.getRGB(s[1]),a.color.error)return null;a.opacity=a.color.opacity,a.color=a.color.hex,s[2]&&(a.offset=s[2]+"%"),r.push(a)}for(i=1,n=r.length-1;n>i;i++)if(!r[i].offset){for(var o=ht(r[i-1].offset||0),l=0,h=i+1;n>h;h++)if(r[h].offset){l=r[h].offset;break}l||(l=100,h=n),l=ht(l);for(var u=(l-o)/(h-i+1);h>i;i++)o+=u,r[i].offset=o+"%"}return r}),Kt=e._tear=function(t,e){t==e.top&&(e.top=t.prev),t==e.bottom&&(e.bottom=t.next),t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next)},te=e._tofront=function(t,e){e.top!==t&&(Kt(t,e),t.next=null,t.prev=e.top,e.top.next=t,e.top=t)},ee=e._toback=function(t,e){e.bottom!==t&&(Kt(t,e),t.next=e.bottom,t.prev=null,e.bottom.prev=t,e.bottom=t)},re=e._insertafter=function(t,e,r){Kt(t,r),e==r.top&&(r.top=t),e.next&&(e.next.prev=t),t.next=e.next,t.prev=e,e.next=t},ie=e._insertbefore=function(t,e,r){Kt(t,r),e==r.bottom&&(r.bottom=t),e.prev&&(e.prev.next=t),t.prev=e.prev,e.prev=t,t.next=e},ne=e.toMatrix=function(t,e){var r=Ot(t),i={_:{transform:R},getBBox:function(){return r}};return se(i,e),i.matrix},ae=e.transformPath=function(t,e){return Nt(t,ne(t,e))},se=e._extractTransform=function(t,r){if(null==r)return t._.transform;r=j(r).replace(/\.{3}|\u2026/g,t._.transform||R);var i=e.parseTransformString(r),n=0,a=0,s=0,o=1,l=1,h=t._,u=new g;if(h.transform=i||[],i)for(var c=0,f=i.length;f>c;c++){var p=i[c],d=p.length,x=j(p[0]).toLowerCase(),v=p[0]!=x,y=v?u.invert():0,m,b,_,w,k;"t"==x&&3==d?v?(m=y.x(0,0),b=y.y(0,0),_=y.x(p[1],p[2]),w=y.y(p[1],p[2]),u.translate(_-m,w-b)):u.translate(p[1],p[2]):"r"==x?2==d?(k=k||t.getBBox(1),u.rotate(p[1],k.x+k.width/2,k.y+k.height/2),n+=p[1]):4==d&&(v?(_=y.x(p[2],p[3]),w=y.y(p[2],p[3]),u.rotate(p[1],_,w)):u.rotate(p[1],p[2],p[3]),n+=p[1]):"s"==x?2==d||3==d?(k=k||t.getBBox(1),u.scale(p[1],p[d-1],k.x+k.width/2,k.y+k.height/2),o*=p[1],l*=p[d-1]):5==d&&(v?(_=y.x(p[3],p[4]),w=y.y(p[3],p[4]),u.scale(p[1],p[2],_,w)):u.scale(p[1],p[2],p[3],p[4]),o*=p[1],l*=p[2]):"m"==x&&7==d&&u.add(p[1],p[2],p[3],p[4],p[5],p[6]),h.dirtyT=1,t.matrix=u}t.matrix=u,h.sx=o,h.sy=l,h.deg=n,h.dx=a=u.e,h.dy=s=u.f,1==o&&1==l&&!n&&h.bbox?(h.bbox.x+=+a,h.bbox.y+=+s):h.dirtyT=1},oe=function(t){var e=t[0];switch(e.toLowerCase()){case"t":return[e,0,0];case"m":return[e,1,0,0,1,0,0];case"r":return 4==t.length?[e,0,t[2],t[3]]:[e,0];case"s":return 5==t.length?[e,1,1,t[3],t[4]]:3==t.length?[e,1,1]:[e,1]}},le=e._equaliseTransform=function(t,r){r=j(r).replace(/\.{3}|\u2026/g,t),t=e.parseTransformString(t)||[],r=e.parseTransformString(r)||[];for(var i=W(t.length,r.length),n=[],a=[],s=0,o,l,h,u;i>s;s++){if(h=t[s]||oe(r[s]),u=r[s]||oe(h),h[0]!=u[0]||"r"==h[0].toLowerCase()&&(h[2]!=u[2]||h[3]!=u[3])||"s"==h[0].toLowerCase()&&(h[3]!=u[3]||h[4]!=u[4]))return;for(n[s]=[],a[s]=[],o=0,l=W(h.length,u.length);l>o;o++)o in h&&(n[s][o]=h[o]),o in u&&(a[s][o]=u[o])}return{from:n,to:a}};e._getContainer=function(t,r,i,n){var a;return a=null!=n||e.is(t,"object")?t:A.doc.getElementById(t),null!=a?a.tagName?null==r?{container:a,width:a.style.pixelWidth||a.offsetWidth,height:a.style.pixelHeight||a.offsetHeight}:{container:a,width:r,height:i}:{container:1,x:t,y:r,width:i,height:n}:void 0},e.pathToRelative=Wt,e._engine={},e.path2curve=Qt,e.matrix=function(t,e,r,i,n,a){return new g(t,e,r,i,n,a)},function(t){function r(t){return t[0]*t[0]+t[1]*t[1]}function i(t){var e=Y.sqrt(r(t));t[0]&&(t[0]/=e),t[1]&&(t[1]/=e)}t.add=function(t,e,r,i,n,a){var s=[[],[],[]],o=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],l=[[t,r,n],[e,i,a],[0,0,1]],h,u,c,f;for(t&&t instanceof g&&(l=[[t.a,t.c,t.e],[t.b,t.d,t.f],[0,0,1]]),h=0;3>h;h++)for(u=0;3>u;u++){for(f=0,c=0;3>c;c++)f+=o[h][c]*l[c][u];s[h][u]=f}this.a=s[0][0],this.b=s[1][0],this.c=s[0][1],this.d=s[1][1],this.e=s[0][2],this.f=s[1][2]},t.invert=function(){var t=this,e=t.a*t.d-t.b*t.c;return new g(t.d/e,-t.b/e,-t.c/e,t.a/e,(t.c*t.f-t.d*t.e)/e,(t.b*t.e-t.a*t.f)/e)},t.clone=function(){return new g(this.a,this.b,this.c,this.d,this.e,this.f)},t.translate=function(t,e){this.add(1,0,0,1,t,e)},t.scale=function(t,e,r,i){null==e&&(e=t),(r||i)&&this.add(1,0,0,1,r,i),this.add(t,0,0,e,0,0),(r||i)&&this.add(1,0,0,1,-r,-i)},t.rotate=function(t,r,i){t=e.rad(t),r=r||0,i=i||0;var n=+Y.cos(t).toFixed(9),a=+Y.sin(t).toFixed(9);this.add(n,a,-a,n,r,i),this.add(1,0,0,1,-r,-i)},t.x=function(t,e){return t*this.a+e*this.c+this.e},t.y=function(t,e){return t*this.b+e*this.d+this.f},t.get=function(t){return+this[j.fromCharCode(97+t)].toFixed(4)},t.toString=function(){return e.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},t.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},t.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},t.split=function(){var t={};t.dx=this.e,t.dy=this.f;var n=[[this.a,this.c],[this.b,this.d]];t.scalex=Y.sqrt(r(n[0])),i(n[0]),t.shear=n[0][0]*n[1][0]+n[0][1]*n[1][1],n[1]=[n[1][0]-n[0][0]*t.shear,n[1][1]-n[0][1]*t.shear],t.scaley=Y.sqrt(r(n[1])),i(n[1]),t.shear/=t.scaley;var a=-n[0][1],s=n[1][1];return 0>s?(t.rotate=e.deg(Y.acos(s)),0>a&&(t.rotate=360-t.rotate)):t.rotate=e.deg(Y.asin(a)),t.isSimple=!(+t.shear.toFixed(9)||t.scalex.toFixed(9)!=t.scaley.toFixed(9)&&t.rotate),t.isSuperSimple=!+t.shear.toFixed(9)&&t.scalex.toFixed(9)==t.scaley.toFixed(9)&&!t.rotate,t.noRotation=!+t.shear.toFixed(9)&&!t.rotate,t},t.toTransformString=function(t){var e=t||this[q]();return e.isSimple?(e.scalex=+e.scalex.toFixed(4),e.scaley=+e.scaley.toFixed(4),e.rotate=+e.rotate.toFixed(4),(e.dx||e.dy?"t"+[e.dx,e.dy]:R)+(1!=e.scalex||1!=e.scaley?"s"+[e.scalex,e.scaley,0,0]:R)+(e.rotate?"r"+[e.rotate,0,0]:R)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(g.prototype);for(var he=function(){this.returnValue=!1},ue=function(){return this.originalEvent.preventDefault()},ce=function(){this.cancelBubble=!0},fe=function(){return this.originalEvent.stopPropagation()},pe=function(t){var e=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,r=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft;return{x:t.clientX+r,y:t.clientY+e}},de=function(){return A.doc.addEventListener?function(t,e,r,i){var n=function(t){var e=pe(t);return r.call(i,t,e.x,e.y)};if(t.addEventListener(e,n,!1),F&&V[e]){var a=function(e){for(var n=pe(e),a=e,s=0,o=e.targetTouches&&e.targetTouches.length;o>s;s++)if(e.targetTouches[s].target==t){e=e.targetTouches[s],e.originalEvent=a,e.preventDefault=ue,e.stopPropagation=fe;break}return r.call(i,e,n.x,n.y)};t.addEventListener(V[e],a,!1)}return function(){return t.removeEventListener(e,n,!1),F&&V[e]&&t.removeEventListener(V[e],a,!1),!0}}:A.doc.attachEvent?function(t,e,r,i){var n=function(t){t=t||A.win.event;var e=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,n=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft,a=t.clientX+n,s=t.clientY+e;return t.preventDefault=t.preventDefault||he,t.stopPropagation=t.stopPropagation||ce,r.call(i,t,a,s)};t.attachEvent("on"+e,n);var a=function(){return t.detachEvent("on"+e,n),!0};return a}:void 0}(),ge=[],xe=function(e){for(var r=e.clientX,i=e.clientY,n=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,a=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft,s,o=ge.length;o--;){if(s=ge[o],F&&e.touches){for(var l=e.touches.length,h;l--;)if(h=e.touches[l],h.identifier==s.el._drag.id){r=h.clientX,i=h.clientY,(e.originalEvent?e.originalEvent:e).preventDefault();break}}else e.preventDefault();var u=s.el.node,c,f=u.nextSibling,p=u.parentNode,d=u.style.display;A.win.opera&&p.removeChild(u),u.style.display="none",c=s.el.paper.getElementByPoint(r,i),u.style.display=d,A.win.opera&&(f?p.insertBefore(u,f):p.appendChild(u)),c&&t("raphael.drag.over."+s.el.id,s.el,c),r+=a,i+=n,t("raphael.drag.move."+s.el.id,s.move_scope||s.el,r-s.el._drag.x,i-s.el._drag.y,r,i,e)}},ve=function(r){e.unmousemove(xe).unmouseup(ve);for(var i=ge.length,n;i--;)n=ge[i],n.el._drag={},t("raphael.drag.end."+n.el.id,n.end_scope||n.start_scope||n.move_scope||n.el,r);ge=[]},ye=e.el={},me=D.length;me--;)!function(t){e[t]=ye[t]=function(r,i){return e.is(r,"function")&&(this.events=this.events||[],this.events.push({name:t,f:r,unbind:de(this.shape||this.node||A.doc,t,r,i||this)})),this},e["un"+t]=ye["un"+t]=function(r){for(var i=this.events||[],n=i.length;n--;)i[n].name!=t||!e.is(r,"undefined")&&i[n].f!=r||(i[n].unbind(),i.splice(n,1),!i.length&&delete this.events);return this}}(D[me]);ye.data=function(r,i){var n=wt[this.id]=wt[this.id]||{};if(0==arguments.length)return n;if(1==arguments.length){if(e.is(r,"object")){for(var a in r)r[T](a)&&this.data(a,r[a]);return this}return t("raphael.data.get."+this.id,this,n[r],r),n[r]}return n[r]=i,t("raphael.data.set."+this.id,this,i,r),this},ye.removeData=function(t){return null==t?wt[this.id]={}:wt[this.id]&&delete wt[this.id][t],this},ye.getData=function(){return r(wt[this.id]||{})},ye.hover=function(t,e,r,i){return this.mouseover(t,r).mouseout(e,i||r)},ye.unhover=function(t,e){return this.unmouseover(t).unmouseout(e)};var be=[];ye.drag=function(r,i,n,a,s,o){function l(l){(l.originalEvent||l).preventDefault();var h=l.clientX,u=l.clientY,c=A.doc.documentElement.scrollTop||A.doc.body.scrollTop,f=A.doc.documentElement.scrollLeft||A.doc.body.scrollLeft;if(this._drag.id=l.identifier,F&&l.touches)for(var p=l.touches.length,d;p--;)if(d=l.touches[p],this._drag.id=d.identifier,d.identifier==this._drag.id){h=d.clientX,u=d.clientY;break}this._drag.x=h+f,this._drag.y=u+c,!ge.length&&e.mousemove(xe).mouseup(ve),ge.push({el:this,move_scope:a,start_scope:s,end_scope:o}),i&&t.on("raphael.drag.start."+this.id,i),r&&t.on("raphael.drag.move."+this.id,r),n&&t.on("raphael.drag.end."+this.id,n),t("raphael.drag.start."+this.id,s||a||this,l.clientX+f,l.clientY+c,l)}return this._drag={},be.push({el:this,start:l}),this.mousedown(l),this},ye.onDragOver=function(e){e?t.on("raphael.drag.over."+this.id,e):t.unbind("raphael.drag.over."+this.id)},ye.undrag=function(){for(var r=be.length;r--;)be[r].el==this&&(this.unmousedown(be[r].start),be.splice(r,1),t.unbind("raphael.drag.*."+this.id));!be.length&&e.unmousemove(xe).unmouseup(ve),ge=[]},M.circle=function(t,r,i){var n=e._engine.circle(this,t||0,r||0,i||0);return this.__set__&&this.__set__.push(n),n},M.rect=function(t,r,i,n,a){var s=e._engine.rect(this,t||0,r||0,i||0,n||0,a||0);return this.__set__&&this.__set__.push(s),s},M.ellipse=function(t,r,i,n){var a=e._engine.ellipse(this,t||0,r||0,i||0,n||0);return this.__set__&&this.__set__.push(a),a},M.path=function(t){t&&!e.is(t,Z)&&!e.is(t[0],Q)&&(t+=R);var r=e._engine.path(e.format[z](e,arguments),this);return this.__set__&&this.__set__.push(r),r},M.image=function(t,r,i,n,a){var s=e._engine.image(this,t||"about:blank",r||0,i||0,n||0,a||0);return this.__set__&&this.__set__.push(s),s},M.text=function(t,r,i){var n=e._engine.text(this,t||0,r||0,j(i));return this.__set__&&this.__set__.push(n),n},M.set=function(t){!e.is(t,"array")&&(t=Array.prototype.splice.call(arguments,0,arguments.length));var r=new ze(t);return this.__set__&&this.__set__.push(r),r.paper=this,r.type="set",r},M.setStart=function(t){this.__set__=t||this.set()},M.setFinish=function(t){var e=this.__set__;return delete this.__set__,e},M.getSize=function(){var t=this.canvas.parentNode;return{width:t.offsetWidth,height:t.offsetHeight}},M.setSize=function(t,r){return e._engine.setSize.call(this,t,r)},M.setViewBox=function(t,r,i,n,a){return e._engine.setViewBox.call(this,t,r,i,n,a)},M.top=M.bottom=null,M.raphael=e;var _e=function(t){var e=t.getBoundingClientRect(),r=t.ownerDocument,i=r.body,n=r.documentElement,a=n.clientTop||i.clientTop||0,s=n.clientLeft||i.clientLeft||0,o=e.top+(A.win.pageYOffset||n.scrollTop||i.scrollTop)-a,l=e.left+(A.win.pageXOffset||n.scrollLeft||i.scrollLeft)-s;return{y:o,x:l}};M.getElementByPoint=function(t,e){var r=this,i=r.canvas,n=A.doc.elementFromPoint(t,e);if(A.win.opera&&"svg"==n.tagName){var a=_e(i),s=i.createSVGRect();s.x=t-a.x,s.y=e-a.y,s.width=s.height=1;var o=i.getIntersectionList(s,null);o.length&&(n=o[o.length-1])}if(!n)return null;for(;n.parentNode&&n!=i.parentNode&&!n.raphael;)n=n.parentNode;return n==r.canvas.parentNode&&(n=i),n=n&&n.raphael?r.getById(n.raphaelid):null},M.getElementsByBBox=function(t){var r=this.set();return this.forEach(function(i){e.isBBoxIntersect(i.getBBox(),t)&&r.push(i)}),r},M.getById=function(t){for(var e=this.bottom;e;){if(e.id==t)return e;e=e.next}return null},M.forEach=function(t,e){for(var r=this.bottom;r;){if(t.call(e,r)===!1)return this;r=r.next}return this},M.getElementsByPoint=function(t,e){var r=this.set();return this.forEach(function(i){i.isPointInside(t,e)&&r.push(i)}),r},ye.isPointInside=function(t,r){var i=this.realPath=Et[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(i=e.transformPath(i,this.attr("transform"))),e.isPointInsidePath(i,t,r)},ye.getBBox=function(t){if(this.removed)return{};var e=this._;return t?(!e.dirty&&e.bboxwt||(this.realPath=Et[this.type](this),e.bboxwt=Ot(this.realPath),e.bboxwt.toString=v,e.dirty=0),e.bboxwt):((e.dirty||e.dirtyT||!e.bbox)&&(!e.dirty&&this.realPath||(e.bboxwt=0,this.realPath=Et[this.type](this)),e.bbox=Ot(Nt(this.realPath,this.matrix)),e.bbox.toString=v,e.dirty=e.dirtyT=0),e.bbox)},ye.clone=function(){if(this.removed)return null;var t=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(t),t},ye.glow=function(t){if("text"==this.type)return null;t=t||{};var e={width:(t.width||10)+(+this.attr("stroke-width")||1),fill:t.fill||!1,opacity:null==t.opacity?.5:t.opacity,offsetx:t.offsetx||0,offsety:t.offsety||0,color:t.color||"#000"},r=e.width/2,i=this.paper,n=i.set(),a=this.realPath||Et[this.type](this);a=this.matrix?Nt(a,this.matrix):a;for(var s=1;r+1>s;s++)n.push(i.path(a).attr({stroke:e.color,fill:e.fill?e.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(e.width/r*s).toFixed(3),opacity:+(e.opacity/r).toFixed(3)}));return n.insertBefore(this).translate(e.offsetx,e.offsety)};var we={},ke=function(t,r,i,n,a,s,o,u,c){return null==c?l(t,r,i,n,a,s,o,u):e.findDotsAtSegment(t,r,i,n,a,s,o,u,h(t,r,i,n,a,s,o,u,c))},Be=function(t,r){return function(i,n,a){i=Qt(i);for(var s,o,l,h,u="",c={},f,p=0,d=0,g=i.length;g>d;d++){if(l=i[d],"M"==l[0])s=+l[1],o=+l[2];else{if(h=ke(s,o,l[1],l[2],l[3],l[4],l[5],l[6]),p+h>n){if(r&&!c.start){if(f=ke(s,o,l[1],l[2],l[3],l[4],l[5],l[6],n-p),u+=["C"+f.start.x,f.start.y,f.m.x,f.m.y,f.x,f.y],a)return u;c.start=u,u=["M"+f.x,f.y+"C"+f.n.x,f.n.y,f.end.x,f.end.y,l[5],l[6]].join(),p+=h,s=+l[5],o=+l[6];continue}if(!t&&!r)return f=ke(s,o,l[1],l[2],l[3],l[4],l[5],l[6],n-p),{x:f.x,y:f.y,alpha:f.alpha}}p+=h,s=+l[5],o=+l[6]}u+=l.shift()+l}return c.end=u,f=t?p:r?c:e.findDotsAtSegment(s,o,l[0],l[1],l[2],l[3],l[4],l[5],1),f.alpha&&(f={x:f.x,y:f.y,alpha:f.alpha}),f}},Ce=Be(1),Se=Be(),Te=Be(0,1);e.getTotalLength=Ce,e.getPointAtLength=Se,e.getSubpath=function(t,e,r){if(this.getTotalLength(t)-r<1e-6)return Te(t,e).end;var i=Te(t,r,1);return e?Te(i,e).end:i},ye.getTotalLength=function(){var t=this.getPath();if(t)return this.node.getTotalLength?this.node.getTotalLength():Ce(t)},ye.getPointAtLength=function(t){var e=this.getPath();if(e)return Se(e,t)},ye.getPath=function(){var t,r=e._getPath[this.type];if("text"!=this.type&&"set"!=this.type)return r&&(t=r(this)),t},ye.getSubpath=function(t,r){var i=this.getPath();if(i)return e.getSubpath(i,t,r)};var Ae=e.easing_formulas={linear:function(t){return t},"<":function(t){return X(t,1.7)},">":function(t){return X(t,.48)},"<>":function(t){var e=.48-t/1.04,r=Y.sqrt(.1734+e*e),i=r-e,n=X(H(i),1/3)*(0>i?-1:1),a=-r-e,s=X(H(a),1/3)*(0>a?-1:1),o=n+s+.5;return 3*(1-o)*o*o+o*o*o},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){t-=1;var e=1.70158;return t*t*((e+1)*t+e)+1},elastic:function(t){return t==!!t?t:X(2,-10*t)*Y.sin((t-.075)*(2*U)/.3)+1},bounce:function(t){var e=7.5625,r=2.75,i;return 1/r>t?i=e*t*t:2/r>t?(t-=1.5/r,i=e*t*t+.75):2.5/r>t?(t-=2.25/r,i=e*t*t+.9375):(t-=2.625/r,i=e*t*t+.984375),i}};Ae.easeIn=Ae["ease-in"]=Ae["<"],Ae.easeOut=Ae["ease-out"]=Ae[">"],Ae.easeInOut=Ae["ease-in-out"]=Ae["<>"],Ae["back-in"]=Ae.backIn,Ae["back-out"]=Ae.backOut;var Ee=[],Ne=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,16)},Me=function(){for(var r=+new Date,i=0;i<Ee.length;i++){var n=Ee[i];if(!n.el.removed&&!n.paused){var a=r-n.start,s=n.ms,o=n.easing,l=n.from,h=n.diff,u=n.to,c=n.t,f=n.el,p={},d,g={},x;if(n.initstatus?(a=(n.initstatus*n.anim.top-n.prev)/(n.percent-n.prev)*s,n.status=n.initstatus,delete n.initstatus,n.stop&&Ee.splice(i--,1)):n.status=(n.prev+(n.percent-n.prev)*(a/s))/n.anim.top,!(0>a))if(s>a){var v=o(a/s);for(var y in l)if(l[T](y)){switch(pt[y]){case $:d=+l[y]+v*s*h[y];break;case"colour":d="rgb("+[Le(ot(l[y].r+v*s*h[y].r)),Le(ot(l[y].g+v*s*h[y].g)),Le(ot(l[y].b+v*s*h[y].b))].join(",")+")";break;case"path":d=[];for(var m=0,_=l[y].length;_>m;m++){d[m]=[l[y][m][0]];for(var w=1,k=l[y][m].length;k>w;w++)d[m][w]=+l[y][m][w]+v*s*h[y][m][w];d[m]=d[m].join(I)}d=d.join(I);break;case"transform":if(h[y].real)for(d=[],m=0,_=l[y].length;_>m;m++)for(d[m]=[l[y][m][0]],w=1,k=l[y][m].length;k>w;w++)d[m][w]=l[y][m][w]+v*s*h[y][m][w];else{var B=function(t){return+l[y][t]+v*s*h[y][t]};d=[["m",B(0),B(1),B(2),B(3),B(4),B(5)]]}break;case"csv":if("clip-rect"==y)for(d=[],m=4;m--;)d[m]=+l[y][m]+v*s*h[y][m];break;default:var C=[][P](l[y]);for(d=[],m=f.paper.customAttributes[y].length;m--;)d[m]=+C[m]+v*s*h[y][m]}p[y]=d}f.attr(p),function(e,r,i){setTimeout(function(){t("raphael.anim.frame."+e,r,i)})}(f.id,f,n.anim)}else{if(function(r,i,n){setTimeout(function(){t("raphael.anim.frame."+i.id,i,n),t("raphael.anim.finish."+i.id,i,n),e.is(r,"function")&&r.call(i)})}(n.callback,f,n.anim),f.attr(u),Ee.splice(i--,1),n.repeat>1&&!n.next){for(x in u)u[T](x)&&(g[x]=n.totalOrigin[x]);n.el.attr(g),b(n.anim,n.el,n.anim.percents[0],null,n.totalOrigin,n.repeat-1)}n.next&&!n.stop&&b(n.anim,n.el,n.next,null,n.totalOrigin,n.repeat)}}}Ee.length&&Ne(Me)},Le=function(t){return t>255?255:0>t?0:t};ye.animateWith=function(t,r,i,n,a,s){var o=this;if(o.removed)return s&&s.call(o),o;var l=i instanceof m?i:e.animation(i,n,a,s),h,u;b(l,o,l.percents[0],null,o.attr());for(var c=0,f=Ee.length;f>c;c++)if(Ee[c].anim==r&&Ee[c].el==t){Ee[f-1].start=Ee[c].start;break}return o},ye.onAnimation=function(e){return e?t.on("raphael.anim.frame."+this.id,e):t.unbind("raphael.anim.frame."+this.id),this},m.prototype.delay=function(t){var e=new m(this.anim,this.ms);return e.times=this.times,e.del=+t||0,e},m.prototype.repeat=function(t){var e=new m(this.anim,this.ms);return e.del=this.del,e.times=Y.floor(W(t,0))||1,e},e.animation=function(t,r,i,n){if(t instanceof m)return t;!e.is(i,"function")&&i||(n=n||i||null,i=null),t=Object(t),r=+r||0;var a={},s,o;for(o in t)t[T](o)&&ht(o)!=o&&ht(o)+"%"!=o&&(s=!0,a[o]=t[o]);if(s)return i&&(a.easing=i),n&&(a.callback=n),new m({100:a},r);if(n){var l=0;for(var h in t){var u=ut(h);t[T](h)&&u>l&&(l=u)}l+="%",!t[l].callback&&(t[l].callback=n)}return new m(t,r)},ye.animate=function(t,r,i,n){var a=this;if(a.removed)return n&&n.call(a),a;var s=t instanceof m?t:e.animation(t,r,i,n);return b(s,a,s.percents[0],null,a.attr()),a},ye.setTime=function(t,e){return t&&null!=e&&this.status(t,G(e,t.ms)/t.ms),this},ye.status=function(t,e){var r=[],i=0,n,a;if(null!=e)return b(t,this,-1,G(e,1)),this;for(n=Ee.length;n>i;i++)if(a=Ee[i],a.el.id==this.id&&(!t||a.anim==t)){if(t)return a.status;r.push({anim:a.anim,status:a.status})}return t?0:r},ye.pause=function(e){for(var r=0;r<Ee.length;r++)Ee[r].el.id!=this.id||e&&Ee[r].anim!=e||t("raphael.anim.pause."+this.id,this,Ee[r].anim)!==!1&&(Ee[r].paused=!0);return this},ye.resume=function(e){for(var r=0;r<Ee.length;r++)if(Ee[r].el.id==this.id&&(!e||Ee[r].anim==e)){var i=Ee[r];t("raphael.anim.resume."+this.id,this,i.anim)!==!1&&(delete i.paused,this.status(i.anim,i.status))}return this},ye.stop=function(e){for(var r=0;r<Ee.length;r++)Ee[r].el.id!=this.id||e&&Ee[r].anim!=e||t("raphael.anim.stop."+this.id,this,Ee[r].anim)!==!1&&Ee.splice(r--,1);return this},t.on("raphael.remove",_),t.on("raphael.clear",_),ye.toString=function(){return"Raphaël’s object"};var ze=function(t){if(this.items=[],this.length=0,this.type="set",t)for(var e=0,r=t.length;r>e;e++)!t[e]||t[e].constructor!=ye.constructor&&t[e].constructor!=ze||(this[this.items.length]=this.items[this.items.length]=t[e],this.length++)},Pe=ze.prototype;Pe.push=function(){for(var t,e,r=0,i=arguments.length;i>r;r++)t=arguments[r],!t||t.constructor!=ye.constructor&&t.constructor!=ze||(e=this.items.length,this[e]=this.items[e]=t,this.length++);return this},Pe.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},Pe.forEach=function(t,e){for(var r=0,i=this.items.length;i>r;r++)if(t.call(e,this.items[r],r)===!1)return this;return this};for(var Fe in ye)ye[T](Fe)&&(Pe[Fe]=function(t){return function(){var e=arguments;return this.forEach(function(r){r[t][z](r,e)})}}(Fe));return Pe.attr=function(t,r){if(t&&e.is(t,Q)&&e.is(t[0],"object"))for(var i=0,n=t.length;n>i;i++)this.items[i].attr(t[i]);else for(var a=0,s=this.items.length;s>a;a++)this.items[a].attr(t,r);return this},Pe.clear=function(){for(;this.length;)this.pop()},Pe.splice=function(t,e,r){t=0>t?W(this.length+t,0):t,e=W(0,G(this.length-t,e));var i=[],n=[],a=[],s;for(s=2;s<arguments.length;s++)a.push(arguments[s]);for(s=0;e>s;s++)n.push(this[t+s]);for(;s<this.length-t;s++)i.push(this[t+s]);var o=a.length;for(s=0;s<o+i.length;s++)this.items[t+s]=this[t+s]=o>s?a[s]:i[s-o];for(s=this.items.length=this.length-=e-o;this[s];)delete this[s++];return new ze(n)},Pe.exclude=function(t){for(var e=0,r=this.length;r>e;e++)if(this[e]==t)return this.splice(e,1),!0},Pe.animate=function(t,r,i,n){(e.is(i,"function")||!i)&&(n=i||null);var a=this.items.length,s=a,o,l=this,h;if(!a)return this;n&&(h=function(){!--a&&n.call(l)}),i=e.is(i,Z)?i:h;var u=e.animation(t,r,i,h);for(o=this.items[--s].animate(u);s--;)this.items[s]&&!this.items[s].removed&&this.items[s].animateWith(o,u,u),this.items[s]&&!this.items[s].removed||a--;return this},Pe.insertAfter=function(t){for(var e=this.items.length;e--;)this.items[e].insertAfter(t);return this},Pe.getBBox=function(){for(var t=[],e=[],r=[],i=[],n=this.items.length;n--;)if(!this.items[n].removed){var a=this.items[n].getBBox();t.push(a.x),e.push(a.y),r.push(a.x+a.width),i.push(a.y+a.height)}return t=G[z](0,t),e=G[z](0,e),r=W[z](0,r),i=W[z](0,i),{x:t,y:e,x2:r,y2:i,width:r-t,height:i-e}},Pe.clone=function(t){t=this.paper.set();for(var e=0,r=this.items.length;r>e;e++)t.push(this.items[e].clone());return t},Pe.toString=function(){return"Raphaël‘s set"},Pe.glow=function(t){var e=this.paper.set();return this.forEach(function(r,i){var n=r.glow(t);null!=n&&n.forEach(function(t,r){e.push(t)})}),e},Pe.isPointInside=function(t,e){var r=!1;return this.forEach(function(i){return i.isPointInside(t,e)?(r=!0,!1):void 0}),r},e.registerFont=function(t){if(!t.face)return t;this.fonts=this.fonts||{};var e={w:t.w,face:{},glyphs:{}},r=t.face["font-family"];for(var i in t.face)t.face[T](i)&&(e.face[i]=t.face[i]);if(this.fonts[r]?this.fonts[r].push(e):this.fonts[r]=[e],!t.svg){e.face["units-per-em"]=ut(t.face["units-per-em"],10);for(var n in t.glyphs)if(t.glyphs[T](n)){var a=t.glyphs[n];if(e.glyphs[n]={w:a.w,k:{},d:a.d&&"M"+a.d.replace(/[mlcxtrv]/g,function(t){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[t]||"M"})+"z"},a.k)for(var s in a.k)a[T](s)&&(e.glyphs[n].k[s]=a.k[s])}}return t},M.getFont=function(t,r,i,n){if(n=n||"normal",i=i||"normal",r=+r||{normal:400,bold:700,lighter:300,bolder:800}[r]||400,e.fonts){var a=e.fonts[t];if(!a){var s=new RegExp("(^|\\s)"+t.replace(/[^\w\d\s+!~.:_-]/g,R)+"(\\s|$)","i");for(var o in e.fonts)if(e.fonts[T](o)&&s.test(o)){a=e.fonts[o];break}}var l;if(a)for(var h=0,u=a.length;u>h&&(l=a[h],l.face["font-weight"]!=r||l.face["font-style"]!=i&&l.face["font-style"]||l.face["font-stretch"]!=n);h++);return l}},M.print=function(t,r,i,n,a,s,o,l){s=s||"middle",o=W(G(o||0,1),-1),l=W(G(l||1,3),1);var h=j(i)[q](R),u=0,c=0,f=R,p;if(e.is(n,"string")&&(n=this.getFont(n)),n){p=(a||16)/n.face["units-per-em"];for(var d=n.face.bbox[q](k),g=+d[0],x=d[3]-d[1],v=0,y=+d[1]+("baseline"==s?x+ +n.face.descent:x/2),m=0,b=h.length;b>m;m++){if("\n"==h[m])u=0,w=0,c=0,v+=x*l;else{var _=c&&n.glyphs[h[m-1]]||{},w=n.glyphs[h[m]];u+=c?(_.w||n.w)+(_.k&&_.k[h[m]]||0)+n.w*o:0,c=1}w&&w.d&&(f+=e.transformPath(w.d,["t",u*p,v*p,"s",p,p,g,y,"t",(t-g)/p,(r-y)/p]))}}return this.path(f).attr({fill:"#000",stroke:"none"})},M.add=function(t){if(e.is(t,"array"))for(var r=this.set(),i=0,n=t.length,a;n>i;i++)a=t[i]||{},B[T](a.type)&&r.push(this[a.type]().attr(a));return r},e.format=function(t,r){var i=e.is(r,Q)?[0][P](r):arguments;return t&&e.is(t,Z)&&i.length-1&&(t=t.replace(C,function(t,e){return null==i[++e]?R:i[e]})),t||R},e.fullfill=function(){var t=/\{([^\}]+)\}/g,e=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,r=function(t,r,i){var n=i;return r.replace(e,function(t,e,r,i,a){e=e||i,n&&(e in n&&(n=n[e]),"function"==typeof n&&a&&(n=n()))}),n=(null==n||n==i?t:n)+""};return function(e,i){return String(e).replace(t,function(t,e){return r(t,e,i)})}}(),e.ninja=function(){if(E.was)A.win.Raphael=E.is;else{window.Raphael=void 0;try{delete window.Raphael}catch(t){}}return e},e.st=Pe,t.on("raphael.DOMload",function(){w=!0}),function(t,r,i){function n(){/in/.test(t.readyState)?setTimeout(n,9):e.eve("raphael.DOMload")}null==t.readyState&&t.addEventListener&&(t.addEventListener(r,i=function(){t.removeEventListener(r,i,!1),t.readyState="complete"},!1),t.readyState="loading"),n()}(document,"DOMContentLoaded"),e}.apply(e,i),!(void 0!==n&&(t.exports=n))},function(t,e,r){var i,n;!function(r){var a="0.4.2",s="hasOwnProperty",o=/[\.\/]/,l="*",h=function(){},u=function(t,e){return t-e},c,f,p={n:{}},d=function(t,e){t=String(t);var r=p,i=f,n=Array.prototype.slice.call(arguments,2),a=d.listeners(t),s=0,o=!1,l,h=[],g={},x=[],v=c,y=[];c=t,f=0;for(var m=0,b=a.length;b>m;m++)"zIndex"in a[m]&&(h.push(a[m].zIndex),a[m].zIndex<0&&(g[a[m].zIndex]=a[m]));for(h.sort(u);h[s]<0;)if(l=g[h[s++]],x.push(l.apply(e,n)),f)return f=i,x;for(m=0;b>m;m++)if(l=a[m],"zIndex"in l)if(l.zIndex==h[s]){if(x.push(l.apply(e,n)),f)break;do{if(s++,l=g[h[s]],l&&x.push(l.apply(e,n)),f)break}while(l)}else g[l.zIndex]=l;else if(x.push(l.apply(e,n)),f)break;return f=i,c=v,x.length?x:null};d._events=p,d.listeners=function(t){var e=t.split(o),r=p,i,n,a,s,h,u,c,f,d=[r],g=[];for(s=0,h=e.length;h>s;s++){for(f=[],u=0,c=d.length;c>u;u++)for(r=d[u].n,n=[r[e[s]],r[l]],a=2;a--;)i=n[a],i&&(f.push(i),g=g.concat(i.f||[]));d=f}return g},d.on=function(t,e){if(t=String(t),"function"!=typeof e)return function(){};for(var r=t.split(o),i=p,n=0,a=r.length;a>n;n++)i=i.n,i=i.hasOwnProperty(r[n])&&i[r[n]]||(i[r[n]]={n:{}});for(i.f=i.f||[],n=0,a=i.f.length;a>n;n++)if(i.f[n]==e)return h;return i.f.push(e),function(t){+t==+t&&(e.zIndex=+t)}},d.f=function(t){var e=[].slice.call(arguments,1);return function(){d.apply(null,[t,null].concat(e).concat([].slice.call(arguments,0)))}},d.stop=function(){f=1},d.nt=function(t){return t?new RegExp("(?:\\.|\\/|^)"+t+"(?:\\.|\\/|$)").test(c):c},d.nts=function(){return c.split(o)},d.off=d.unbind=function(t,e){if(!t)return void(d._events=p={n:{}});var r=t.split(o),i,n,a,h,u,c,f,g=[p];for(h=0,u=r.length;u>h;h++)for(c=0;c<g.length;c+=a.length-2){if(a=[c,1],i=g[c].n,r[h]!=l)i[r[h]]&&a.push(i[r[h]]);else for(n in i)i[s](n)&&a.push(i[n]);g.splice.apply(g,a)}for(h=0,u=g.length;u>h;h++)for(i=g[h];i.n;){if(e){if(i.f){for(c=0,f=i.f.length;f>c;c++)if(i.f[c]==e){i.f.splice(c,1);break}!i.f.length&&delete i.f}for(n in i.n)if(i.n[s](n)&&i.n[n].f){var x=i.n[n].f;for(c=0,f=x.length;f>c;c++)if(x[c]==e){x.splice(c,1);break}!x.length&&delete i.n[n].f}}else{delete i.f;for(n in i.n)i.n[s](n)&&i.n[n].f&&delete i.n[n].f}i=i.n}},d.once=function(t,e){var r=function(){return d.unbind(t,r),e.apply(this,arguments)};return d.on(t,r)},d.version=a,d.toString=function(){return"You are running Eve "+a},"undefined"!=typeof t&&t.exports?t.exports=d:(i=[],n=function(){return d}.apply(e,i),!(void 0!==n&&(t.exports=n)))}(this)},function(t,e,r){var i,n;i=[r(1)],n=function(t){if(!t||t.svg){var e="hasOwnProperty",r=String,i=parseFloat,n=parseInt,a=Math,s=a.max,o=a.abs,l=a.pow,h=/[, ]+/,u=t.eve,c="",f=" ",p="http://www.w3.org/1999/xlink",d={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},g={};t.toString=function(){return"Your browser supports SVG.\nYou are running Raphaël "+this.version};var x=function(i,n){if(n){"string"==typeof i&&(i=x(i));for(var a in n)n[e](a)&&("xlink:"==a.substring(0,6)?i.setAttributeNS(p,a.substring(6),r(n[a])):i.setAttribute(a,r(n[a])))}else i=t._g.doc.createElementNS("http://www.w3.org/2000/svg",i),i.style&&(i.style.webkitTapHighlightColor="rgba(0,0,0,0)");return i},v=function(e,n){var h="linear",u=e.id+n,f=.5,p=.5,d=e.node,g=e.paper,v=d.style,y=t._g.doc.getElementById(u);if(!y){if(n=r(n).replace(t._radial_gradient,function(t,e,r){if(h="radial",e&&r){f=i(e),p=i(r);var n=2*(p>.5)-1;l(f-.5,2)+l(p-.5,2)>.25&&(p=a.sqrt(.25-l(f-.5,2))*n+.5)&&.5!=p&&(p=p.toFixed(5)-1e-5*n)}return c}),n=n.split(/\s*\-\s*/),"linear"==h){var b=n.shift();if(b=-i(b),isNaN(b))return null;var _=[0,0,a.cos(t.rad(b)),a.sin(t.rad(b))],w=1/(s(o(_[2]),o(_[3]))||1);_[2]*=w,_[3]*=w,_[2]<0&&(_[0]=-_[2],_[2]=0),_[3]<0&&(_[1]=-_[3],_[3]=0)}var k=t._parseDots(n);if(!k)return null;if(u=u.replace(/[\(\)\s,\xb0#]/g,"_"),e.gradient&&u!=e.gradient.id&&(g.defs.removeChild(e.gradient),delete e.gradient),!e.gradient){y=x(h+"Gradient",{id:u}),e.gradient=y,x(y,"radial"==h?{fx:f,fy:p}:{x1:_[0],y1:_[1],x2:_[2],y2:_[3],gradientTransform:e.matrix.invert()}),g.defs.appendChild(y);for(var B=0,C=k.length;C>B;B++)y.appendChild(x("stop",{offset:k[B].offset?k[B].offset:B?"100%":"0%","stop-color":k[B].color||"#fff","stop-opacity":isFinite(k[B].opacity)?k[B].opacity:1}))}}return x(d,{fill:m(u),opacity:1,"fill-opacity":1}),v.fill=c,v.opacity=1,v.fillOpacity=1,1},y=function(){var t=document.documentMode;return t&&(9===t||10===t)},m=function(t){if(y())return"url('#"+t+"')";var e=document.location,r=e.protocol+"//"+e.host+e.pathname+e.search;return"url('"+r+"#"+t+"')"},b=function(t){var e=t.getBBox(1);x(t.pattern,{patternTransform:t.matrix.invert()+" translate("+e.x+","+e.y+")"})},_=function(i,n,a){if("path"==i.type){for(var s=r(n).toLowerCase().split("-"),o=i.paper,l=a?"end":"start",h=i.node,u=i.attrs,f=u["stroke-width"],p=s.length,v="classic",y,m,b,_,w,k=3,B=3,C=5;p--;)switch(s[p]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":v=s[p];break;case"wide":B=5;break;case"narrow":B=2;break;case"long":k=5;break;case"short":k=2}if("open"==v?(k+=2,B+=2,C+=2,b=1,_=a?4:1,w={fill:"none",stroke:u.stroke}):(_=b=k/2,w={fill:u.stroke,stroke:"none"}),i._.arrows?a?(i._.arrows.endPath&&g[i._.arrows.endPath]--,i._.arrows.endMarker&&g[i._.arrows.endMarker]--):(i._.arrows.startPath&&g[i._.arrows.startPath]--,i._.arrows.startMarker&&g[i._.arrows.startMarker]--):i._.arrows={},"none"!=v){var S="raphael-marker-"+v,T="raphael-marker-"+l+v+k+B+"-obj"+i.id;t._g.doc.getElementById(S)?g[S]++:(o.defs.appendChild(x(x("path"),{"stroke-linecap":"round",d:d[v],id:S})),g[S]=1);var A=t._g.doc.getElementById(T),E;A?(g[T]++,E=A.getElementsByTagName("use")[0]):(A=x(x("marker"),{id:T,markerHeight:B,markerWidth:k,orient:"auto",refX:_,refY:B/2}),E=x(x("use"),{"xlink:href":"#"+S,transform:(a?"rotate(180 "+k/2+" "+B/2+") ":c)+"scale("+k/C+","+B/C+")","stroke-width":(1/((k/C+B/C)/2)).toFixed(4)}),A.appendChild(E),o.defs.appendChild(A),g[T]=1),x(E,w);var N=b*("diamond"!=v&&"oval"!=v);a?(y=i._.arrows.startdx*f||0,m=t.getTotalLength(u.path)-N*f):(y=N*f,m=t.getTotalLength(u.path)-(i._.arrows.enddx*f||0)),w={},w["marker-"+l]="url(#"+T+")",(m||y)&&(w.d=t.getSubpath(u.path,y,m)),x(h,w),i._.arrows[l+"Path"]=S,i._.arrows[l+"Marker"]=T,i._.arrows[l+"dx"]=N,i._.arrows[l+"Type"]=v,i._.arrows[l+"String"]=n}else a?(y=i._.arrows.startdx*f||0,m=t.getTotalLength(u.path)-y):(y=0,m=t.getTotalLength(u.path)-(i._.arrows.enddx*f||0)),i._.arrows[l+"Path"]&&x(h,{d:t.getSubpath(u.path,y,m)}),delete i._.arrows[l+"Path"],delete i._.arrows[l+"Marker"],delete i._.arrows[l+"dx"],delete i._.arrows[l+"Type"],delete i._.arrows[l+"String"];for(w in g)if(g[e](w)&&!g[w]){var M=t._g.doc.getElementById(w);M&&M.parentNode.removeChild(M)}}},w={"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},k=function(t,e,i){if(e=w[r(e).toLowerCase()]){for(var n=t.attrs["stroke-width"]||"1",a={round:n,square:n,butt:0}[t.attrs["stroke-linecap"]||i["stroke-linecap"]]||0,s=[],o=e.length;o--;)s[o]=e[o]*n+(o%2?1:-1)*a;x(t.node,{"stroke-dasharray":s.join(",")})}else x(t.node,{"stroke-dasharray":"none"})},B=function(i,a){var l=i.node,u=i.attrs,f=l.style.visibility;l.style.visibility="hidden";for(var d in a)if(a[e](d)){if(!t._availableAttrs[e](d))continue;var g=a[d];switch(u[d]=g,d){case"blur":i.blur(g);break;case"title":var y=l.getElementsByTagName("title");if(y.length&&(y=y[0]))y.firstChild.nodeValue=g;else{y=x("title");var m=t._g.doc.createTextNode(g);y.appendChild(m),l.appendChild(y)}break;case"href":case"target":var w=l.parentNode;if("a"!=w.tagName.toLowerCase()){var B=x("a");w.insertBefore(B,l),B.appendChild(l),w=B}"target"==d?w.setAttributeNS(p,"show","blank"==g?"new":g):w.setAttributeNS(p,d,g);break;case"cursor":l.style.cursor=g;break;case"transform":i.transform(g);break;case"arrow-start":_(i,g);break;case"arrow-end":_(i,g,1);break;case"clip-rect":var C=r(g).split(h);if(4==C.length){i.clip&&i.clip.parentNode.parentNode.removeChild(i.clip.parentNode);var T=x("clipPath"),A=x("rect");T.id=t.createUUID(),x(A,{x:C[0],y:C[1],width:C[2],height:C[3]}),T.appendChild(A),i.paper.defs.appendChild(T),x(l,{"clip-path":"url(#"+T.id+")"}),i.clip=A}if(!g){var E=l.getAttribute("clip-path");if(E){var N=t._g.doc.getElementById(E.replace(/(^url\(#|\)$)/g,c));N&&N.parentNode.removeChild(N),x(l,{"clip-path":c}),delete i.clip}}break;case"path":"path"==i.type&&(x(l,{d:g?u.path=t._pathToAbsolute(g):"M0,0"}),i._.dirty=1,i._.arrows&&("startString"in i._.arrows&&_(i,i._.arrows.startString),"endString"in i._.arrows&&_(i,i._.arrows.endString,1)));break;case"width":if(l.setAttribute(d,g),i._.dirty=1,!u.fx)break;d="x",g=u.x;case"x":u.fx&&(g=-u.x-(u.width||0));case"rx":if("rx"==d&&"rect"==i.type)break;case"cx":l.setAttribute(d,g),i.pattern&&b(i),i._.dirty=1;break;case"height":if(l.setAttribute(d,g),i._.dirty=1,!u.fy)break;d="y",g=u.y;case"y":u.fy&&(g=-u.y-(u.height||0));case"ry":if("ry"==d&&"rect"==i.type)break;case"cy":l.setAttribute(d,g),i.pattern&&b(i),i._.dirty=1;break;case"r":"rect"==i.type?x(l,{rx:g,ry:g}):l.setAttribute(d,g),i._.dirty=1;break;case"src":"image"==i.type&&l.setAttributeNS(p,"href",g);break;case"stroke-width":1==i._.sx&&1==i._.sy||(g/=s(o(i._.sx),o(i._.sy))||1),l.setAttribute(d,g),u["stroke-dasharray"]&&k(i,u["stroke-dasharray"],a),i._.arrows&&("startString"in i._.arrows&&_(i,i._.arrows.startString),"endString"in i._.arrows&&_(i,i._.arrows.endString,1));break;case"stroke-dasharray":k(i,g,a);break;case"fill":var M=r(g).match(t._ISURL);if(M){T=x("pattern");var L=x("image");T.id=t.createUUID(),x(T,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),x(L,{x:0,y:0,"xlink:href":M[1]}),T.appendChild(L),function(e){t._preload(M[1],function(){var t=this.offsetWidth,r=this.offsetHeight;x(e,{width:t,height:r}),x(L,{width:t,height:r})})}(T),i.paper.defs.appendChild(T),x(l,{fill:"url(#"+T.id+")"}),i.pattern=T,i.pattern&&b(i);break}var z=t.getRGB(g);if(z.error){if(("circle"==i.type||"ellipse"==i.type||"r"!=r(g).charAt())&&v(i,g)){if("opacity"in u||"fill-opacity"in u){var P=t._g.doc.getElementById(l.getAttribute("fill").replace(/^url\(#|\)$/g,c));if(P){var F=P.getElementsByTagName("stop");x(F[F.length-1],{"stop-opacity":("opacity"in u?u.opacity:1)*("fill-opacity"in u?u["fill-opacity"]:1)})}}u.gradient=g,u.fill="none";break}}else delete a.gradient,delete u.gradient,!t.is(u.opacity,"undefined")&&t.is(a.opacity,"undefined")&&x(l,{opacity:u.opacity}),!t.is(u["fill-opacity"],"undefined")&&t.is(a["fill-opacity"],"undefined")&&x(l,{"fill-opacity":u["fill-opacity"]});z[e]("opacity")&&x(l,{"fill-opacity":z.opacity>1?z.opacity/100:z.opacity});case"stroke":z=t.getRGB(g),l.setAttribute(d,z.hex),"stroke"==d&&z[e]("opacity")&&x(l,{"stroke-opacity":z.opacity>1?z.opacity/100:z.opacity}),"stroke"==d&&i._.arrows&&("startString"in i._.arrows&&_(i,i._.arrows.startString),"endString"in i._.arrows&&_(i,i._.arrows.endString,1));break;case"gradient":("circle"==i.type||"ellipse"==i.type||"r"!=r(g).charAt())&&v(i,g);break;case"opacity":u.gradient&&!u[e]("stroke-opacity")&&x(l,{"stroke-opacity":g>1?g/100:g});case"fill-opacity":if(u.gradient){P=t._g.doc.getElementById(l.getAttribute("fill").replace(/^url\(#|\)$/g,c)),P&&(F=P.getElementsByTagName("stop"),x(F[F.length-1],{"stop-opacity":g}));break}default:"font-size"==d&&(g=n(g,10)+"px");var R=d.replace(/(\-.)/g,function(t){return t.substring(1).toUpperCase()});l.style[R]=g,i._.dirty=1,l.setAttribute(d,g)}}S(i,a),l.style.visibility=f},C=1.2,S=function(i,a){if("text"==i.type&&(a[e]("text")||a[e]("font")||a[e]("font-size")||a[e]("x")||a[e]("y"))){var s=i.attrs,o=i.node,l=o.firstChild?n(t._g.doc.defaultView.getComputedStyle(o.firstChild,c).getPropertyValue("font-size"),10):10;if(a[e]("text")){for(s.text=a.text;o.firstChild;)o.removeChild(o.firstChild);for(var h=r(a.text).split("\n"),u=[],f,p=0,d=h.length;d>p;p++)f=x("tspan"),p&&x(f,{dy:l*C,x:s.x}),f.appendChild(t._g.doc.createTextNode(h[p])),o.appendChild(f),u[p]=f}else for(u=o.getElementsByTagName("tspan"),p=0,d=u.length;d>p;p++)p?x(u[p],{dy:l*C,x:s.x}):x(u[0],{dy:0});x(o,{x:s.x,y:s.y}),i._.dirty=1;var g=i._getBBox(),v=s.y-(g.y+g.height/2);v&&t.is(v,"finite")&&x(u[0],{dy:v})}},T=function(t){return t.parentNode&&"a"===t.parentNode.tagName.toLowerCase()?t.parentNode:t},A=function(e,r){var i=0,n=0;this[0]=this.node=e,e.raphael=!0,this.id=t._oid++,e.raphaelid=this.id,this.matrix=t.matrix(),this.realPath=null,this.paper=r,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!r.bottom&&(r.bottom=this),this.prev=r.top,r.top&&(r.top.next=this),r.top=this,this.next=null},E=t.el;A.prototype=E,E.constructor=A,t._engine.path=function(t,e){var r=x("path");e.canvas&&e.canvas.appendChild(r);var i=new A(r,e);return i.type="path",B(i,{fill:"none",stroke:"#000",path:t}),i},E.rotate=function(t,e,n){if(this.removed)return this;if(t=r(t).split(h),t.length-1&&(e=i(t[1]),n=i(t[2])),t=i(t[0]),null==n&&(e=n),null==e||null==n){var a=this.getBBox(1);e=a.x+a.width/2,n=a.y+a.height/2}return this.transform(this._.transform.concat([["r",t,e,n]])),this},E.scale=function(t,e,n,a){if(this.removed)return this;if(t=r(t).split(h),t.length-1&&(e=i(t[1]),n=i(t[2]),a=i(t[3])),t=i(t[0]),null==e&&(e=t),null==a&&(n=a),null==n||null==a)var s=this.getBBox(1);return n=null==n?s.x+s.width/2:n,a=null==a?s.y+s.height/2:a,this.transform(this._.transform.concat([["s",t,e,n,a]])),this},E.translate=function(t,e){return this.removed?this:(t=r(t).split(h),t.length-1&&(e=i(t[1])),t=i(t[0])||0,e=+e||0,this.transform(this._.transform.concat([["t",t,e]])),this)},E.transform=function(r){var i=this._;if(null==r)return i.transform;if(t._extractTransform(this,r),this.clip&&x(this.clip,{transform:this.matrix.invert()}),this.pattern&&b(this),this.node&&x(this.node,{transform:this.matrix}),1!=i.sx||1!=i.sy){var n=this.attrs[e]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":n})}return i.transform=this.matrix.toTransformString(),this},E.hide=function(){return this.removed||(this.node.style.display="none"),this},E.show=function(){return this.removed||(this.node.style.display=""),this},E.remove=function(){var e=T(this.node);if(!this.removed&&e.parentNode){var r=this.paper;r.__set__&&r.__set__.exclude(this),u.unbind("raphael.*.*."+this.id),this.gradient&&r.defs.removeChild(this.gradient),t._tear(this,r),e.parentNode.removeChild(e),this.removeData();for(var i in this)this[i]="function"==typeof this[i]?t._removedFactory(i):null;this.removed=!0}},E._getBBox=function(){if("none"==this.node.style.display){this.show();var t=!0}var e=!1,r;this.paper.canvas.parentElement?r=this.paper.canvas.parentElement.style:this.paper.canvas.parentNode&&(r=this.paper.canvas.parentNode.style),r&&"none"==r.display&&(e=!0,r.display="");var i={};try{i=this.node.getBBox()}catch(n){i={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}finally{i=i||{},e&&(r.display="none")}return t&&this.hide(),i},E.attr=function(r,i){if(this.removed)return this;if(null==r){var n={};for(var a in this.attrs)this.attrs[e](a)&&(n[a]=this.attrs[a]);return n.gradient&&"none"==n.fill&&(n.fill=n.gradient)&&delete n.gradient,n.transform=this._.transform,n}if(null==i&&t.is(r,"string")){if("fill"==r&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==r)return this._.transform;for(var s=r.split(h),o={},l=0,c=s.length;c>l;l++)r=s[l],r in this.attrs?o[r]=this.attrs[r]:t.is(this.paper.customAttributes[r],"function")?o[r]=this.paper.customAttributes[r].def:o[r]=t._availableAttrs[r];return c-1?o:o[s[0]]}if(null==i&&t.is(r,"array")){for(o={},l=0,c=r.length;c>l;l++)o[r[l]]=this.attr(r[l]);return o}if(null!=i){var f={};f[r]=i}else null!=r&&t.is(r,"object")&&(f=r);for(var p in f)u("raphael.attr."+p+"."+this.id,this,f[p]);for(p in this.paper.customAttributes)if(this.paper.customAttributes[e](p)&&f[e](p)&&t.is(this.paper.customAttributes[p],"function")){var d=this.paper.customAttributes[p].apply(this,[].concat(f[p]));this.attrs[p]=f[p];for(var g in d)d[e](g)&&(f[g]=d[g])}return B(this,f),this},E.toFront=function(){if(this.removed)return this;var e=T(this.node);e.parentNode.appendChild(e);var r=this.paper;return r.top!=this&&t._tofront(this,r),this},E.toBack=function(){if(this.removed)return this;var e=T(this.node),r=e.parentNode;r.insertBefore(e,r.firstChild),t._toback(this,this.paper);var i=this.paper;return this},E.insertAfter=function(e){if(this.removed||!e)return this;var r=T(this.node),i=T(e.node||e[e.length-1].node);return i.nextSibling?i.parentNode.insertBefore(r,i.nextSibling):i.parentNode.appendChild(r),t._insertafter(this,e,this.paper),this},E.insertBefore=function(e){if(this.removed||!e)return this;var r=T(this.node),i=T(e.node||e[0].node);return i.parentNode.insertBefore(r,i),t._insertbefore(this,e,this.paper),this},E.blur=function(e){var r=this;if(0!==+e){var i=x("filter"),n=x("feGaussianBlur");r.attrs.blur=e,i.id=t.createUUID(),x(n,{stdDeviation:+e||1.5}),i.appendChild(n),r.paper.defs.appendChild(i),r._blur=i,x(r.node,{filter:"url(#"+i.id+")"})}else r._blur&&(r._blur.parentNode.removeChild(r._blur),delete r._blur,delete r.attrs.blur),r.node.removeAttribute("filter");return r},t._engine.circle=function(t,e,r,i){var n=x("circle");t.canvas&&t.canvas.appendChild(n);var a=new A(n,t);return a.attrs={cx:e,cy:r,r:i,fill:"none",stroke:"#000"},a.type="circle",x(n,a.attrs),a},t._engine.rect=function(t,e,r,i,n,a){var s=x("rect");t.canvas&&t.canvas.appendChild(s);var o=new A(s,t);return o.attrs={x:e,y:r,width:i,height:n,rx:a||0,ry:a||0,fill:"none",stroke:"#000"},o.type="rect",x(s,o.attrs),o},t._engine.ellipse=function(t,e,r,i,n){var a=x("ellipse");t.canvas&&t.canvas.appendChild(a);var s=new A(a,t);return s.attrs={cx:e,cy:r,rx:i,ry:n,fill:"none",stroke:"#000"},s.type="ellipse",x(a,s.attrs),s},t._engine.image=function(t,e,r,i,n,a){var s=x("image");x(s,{x:r,y:i,width:n,height:a,preserveAspectRatio:"none"}),s.setAttributeNS(p,"href",e),t.canvas&&t.canvas.appendChild(s);var o=new A(s,t);return o.attrs={x:r,y:i,width:n,height:a,src:e},o.type="image",o},t._engine.text=function(e,r,i,n){var a=x("text");e.canvas&&e.canvas.appendChild(a);var s=new A(a,e);return s.attrs={x:r,y:i,"text-anchor":"middle",text:n,"font-family":t._availableAttrs["font-family"],"font-size":t._availableAttrs["font-size"],stroke:"none",fill:"#000"},s.type="text",B(s,s.attrs),s},t._engine.setSize=function(t,e){return this.width=t||this.width,this.height=e||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},t._engine.create=function(){var e=t._getContainer.apply(0,arguments),r=e&&e.container,i=e.x,n=e.y,a=e.width,s=e.height;if(!r)throw new Error("SVG container not found.");var o=x("svg"),l="overflow:hidden;",h;return i=i||0,n=n||0,a=a||512,s=s||342,x(o,{height:s,version:1.1,width:a,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),1==r?(o.style.cssText=l+"position:absolute;left:"+i+"px;top:"+n+"px",t._g.doc.body.appendChild(o),h=1):(o.style.cssText=l+"position:relative",r.firstChild?r.insertBefore(o,r.firstChild):r.appendChild(o)),r=new t._Paper,r.width=a,r.height=s,r.canvas=o,r.clear(),r._left=r._top=0,h&&(r.renderfix=function(){}),r.renderfix(),r},t._engine.setViewBox=function(t,e,r,i,n){u("raphael.setViewBox",this,this._viewBox,[t,e,r,i,n]);var a=this.getSize(),o=s(r/a.width,i/a.height),l=this.top,h=n?"xMidYMid meet":"xMinYMin",c,p;for(null==t?(this._vbSize&&(o=1),delete this._vbSize,c="0 0 "+this.width+f+this.height):(this._vbSize=o,c=t+f+e+f+r+f+i),x(this.canvas,{viewBox:c,preserveAspectRatio:h});o&&l;)p="stroke-width"in l.attrs?l.attrs["stroke-width"]:1,l.attr({"stroke-width":p}),l._.dirty=1,l._.dirtyT=1,l=l.prev;return this._viewBox=[t,e,r,i,!!n],this},t.prototype.renderfix=function(){var t=this.canvas,e=t.style,r;try{r=t.getScreenCTM()||t.createSVGMatrix()}catch(i){r=t.createSVGMatrix()}var n=-r.e%1,a=-r.f%1;(n||a)&&(n&&(this._left=(this._left+n)%1,e.left=this._left+"px"),a&&(this._top=(this._top+a)%1,e.top=this._top+"px"))},t.prototype.clear=function(){t.eve("raphael.clear",this);for(var e=this.canvas;e.firstChild;)e.removeChild(e.firstChild);this.bottom=this.top=null,(this.desc=x("desc")).appendChild(t._g.doc.createTextNode("Created with Raphaël "+t.version)),e.appendChild(this.desc),e.appendChild(this.defs=x("defs"))},t.prototype.remove=function(){u("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var e in this)this[e]="function"==typeof this[e]?t._removedFactory(e):null};var N=t.st;for(var M in E)E[e](M)&&!N[e](M)&&(N[M]=function(t){return function(){var e=arguments;return this.forEach(function(r){r[t].apply(r,e)})}}(M))}}.apply(e,i),!(void 0!==n&&(t.exports=n))},function(t,e,r){var i,n;i=[r(1)],n=function(t){if(!t||t.vml){var e="hasOwnProperty",r=String,i=parseFloat,n=Math,a=n.round,s=n.max,o=n.min,l=n.abs,h="fill",u=/[, ]+/,c=t.eve,f=" progid:DXImageTransform.Microsoft",p=" ",d="",g={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},x=/([clmz]),?([^clmz]*)/gi,v=/ progid:\S+Blur\([^\)]+\)/g,y=/-?[^,\s-]+/g,m="position:absolute;left:0;top:0;width:1px;height:1px;behavior:url(#default#VML)",b=21600,_={path:1,rect:1,image:1},w={circle:1,ellipse:1},k=function(e){var i=/[ahqstv]/gi,n=t._pathToAbsolute;if(r(e).match(i)&&(n=t._path2curve),i=/[clmz]/g,n==t._pathToAbsolute&&!r(e).match(i)){var s=r(e).replace(x,function(t,e,r){var i=[],n="m"==e.toLowerCase(),s=g[e];return r.replace(y,function(t){n&&2==i.length&&(s+=i+g["m"==e?"l":"L"],i=[]),i.push(a(t*b))}),s+i});return s}var o=n(e),l,h;s=[];for(var u=0,c=o.length;c>u;u++){l=o[u],h=o[u][0].toLowerCase(),"z"==h&&(h="x");for(var f=1,v=l.length;v>f;f++)h+=a(l[f]*b)+(f!=v-1?",":d);s.push(h)}return s.join(p)},B=function(e,r,i){var n=t.matrix();return n.rotate(-e,.5,.5),{dx:n.x(r,i),dy:n.y(r,i)}},C=function(t,e,r,i,n,a){var s=t._,o=t.matrix,u=s.fillpos,c=t.node,f=c.style,d=1,g="",x,v=b/e,y=b/r;if(f.visibility="hidden",e&&r){if(c.coordsize=l(v)+p+l(y),f.rotation=a*(0>e*r?-1:1),a){var m=B(a,i,n);i=m.dx,n=m.dy}if(0>e&&(g+="x"),0>r&&(g+=" y")&&(d=-1),f.flip=g,c.coordorigin=i*-v+p+n*-y,u||s.fillsize){var _=c.getElementsByTagName(h);_=_&&_[0],c.removeChild(_),u&&(m=B(a,o.x(u[0],u[1]),o.y(u[0],u[1])),_.position=m.dx*d+p+m.dy*d),s.fillsize&&(_.size=s.fillsize[0]*l(e)+p+s.fillsize[1]*l(r)),c.appendChild(_)}f.visibility="visible"}};t.toString=function(){return"Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël "+this.version};var S=function(t,e,i){for(var n=r(e).toLowerCase().split("-"),a=i?"end":"start",s=n.length,o="classic",l="medium",h="medium";s--;)switch(n[s]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":o=n[s];break;case"wide":case"narrow":h=n[s];break;case"long":case"short":l=n[s]}var u=t.node.getElementsByTagName("stroke")[0];u[a+"arrow"]=o,u[a+"arrowlength"]=l,u[a+"arrowwidth"]=h},T=function(n,l){n.attrs=n.attrs||{};var c=n.node,f=n.attrs,g=c.style,x,v=_[n.type]&&(l.x!=f.x||l.y!=f.y||l.width!=f.width||l.height!=f.height||l.cx!=f.cx||l.cy!=f.cy||l.rx!=f.rx||l.ry!=f.ry||l.r!=f.r),y=w[n.type]&&(f.cx!=l.cx||f.cy!=l.cy||f.r!=l.r||f.rx!=l.rx||f.ry!=l.ry),m=n;for(var B in l)l[e](B)&&(f[B]=l[B]);if(v&&(f.path=t._getPath[n.type](n),n._.dirty=1),l.href&&(c.href=l.href),l.title&&(c.title=l.title),l.target&&(c.target=l.target),l.cursor&&(g.cursor=l.cursor),"blur"in l&&n.blur(l.blur),(l.path&&"path"==n.type||v)&&(c.path=k(~r(f.path).toLowerCase().indexOf("r")?t._pathToAbsolute(f.path):f.path),n._.dirty=1,"image"==n.type&&(n._.fillpos=[f.x,f.y],n._.fillsize=[f.width,f.height],C(n,1,1,0,0,0))),"transform"in l&&n.transform(l.transform),y){var T=+f.cx,E=+f.cy,N=+f.rx||+f.r||0,L=+f.ry||+f.r||0;c.path=t.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",a((T-N)*b),a((E-L)*b),a((T+N)*b),a((E+L)*b),a(T*b)),n._.dirty=1}if("clip-rect"in l){var z=r(l["clip-rect"]).split(u);if(4==z.length){z[2]=+z[2]+ +z[0],z[3]=+z[3]+ +z[1];var P=c.clipRect||t._g.doc.createElement("div"),F=P.style;F.clip=t.format("rect({1}px {2}px {3}px {0}px)",z),c.clipRect||(F.position="absolute",F.top=0,F.left=0,F.width=n.paper.width+"px",F.height=n.paper.height+"px",c.parentNode.insertBefore(P,c),P.appendChild(c),c.clipRect=P)}l["clip-rect"]||c.clipRect&&(c.clipRect.style.clip="auto")}if(n.textpath){var R=n.textpath.style;l.font&&(R.font=l.font),l["font-family"]&&(R.fontFamily='"'+l["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,d)+'"'),l["font-size"]&&(R.fontSize=l["font-size"]),l["font-weight"]&&(R.fontWeight=l["font-weight"]),l["font-style"]&&(R.fontStyle=l["font-style"])}if("arrow-start"in l&&S(m,l["arrow-start"]),"arrow-end"in l&&S(m,l["arrow-end"],1),null!=l.opacity||null!=l["stroke-width"]||null!=l.fill||null!=l.src||null!=l.stroke||null!=l["stroke-width"]||null!=l["stroke-opacity"]||null!=l["fill-opacity"]||null!=l["stroke-dasharray"]||null!=l["stroke-miterlimit"]||null!=l["stroke-linejoin"]||null!=l["stroke-linecap"]){var I=c.getElementsByTagName(h),j=!1;if(I=I&&I[0],!I&&(j=I=M(h)),"image"==n.type&&l.src&&(I.src=l.src),l.fill&&(I.on=!0),null!=I.on&&"none"!=l.fill&&null!==l.fill||(I.on=!1),I.on&&l.fill){var q=r(l.fill).match(t._ISURL);if(q){I.parentNode==c&&c.removeChild(I),I.rotate=!0,I.src=q[1],I.type="tile";var D=n.getBBox(1);I.position=D.x+p+D.y,n._.fillpos=[D.x,D.y],t._preload(q[1],function(){n._.fillsize=[this.offsetWidth,this.offsetHeight]})}else I.color=t.getRGB(l.fill).hex,I.src=d,I.type="solid",t.getRGB(l.fill).error&&(m.type in{circle:1,ellipse:1}||"r"!=r(l.fill).charAt())&&A(m,l.fill,I)&&(f.fill="none",f.gradient=l.fill,I.rotate=!1)}if("fill-opacity"in l||"opacity"in l){var V=((+f["fill-opacity"]+1||2)-1)*((+f.opacity+1||2)-1)*((+t.getRGB(l.fill).o+1||2)-1);V=o(s(V,0),1),I.opacity=V,I.src&&(I.color="none")}c.appendChild(I);var O=c.getElementsByTagName("stroke")&&c.getElementsByTagName("stroke")[0],Y=!1;!O&&(Y=O=M("stroke")),(l.stroke&&"none"!=l.stroke||l["stroke-width"]||null!=l["stroke-opacity"]||l["stroke-dasharray"]||l["stroke-miterlimit"]||l["stroke-linejoin"]||l["stroke-linecap"])&&(O.on=!0),("none"==l.stroke||null===l.stroke||null==O.on||0==l.stroke||0==l["stroke-width"])&&(O.on=!1);var W=t.getRGB(l.stroke);O.on&&l.stroke&&(O.color=W.hex),V=((+f["stroke-opacity"]+1||2)-1)*((+f.opacity+1||2)-1)*((+W.o+1||2)-1);var G=.75*(i(l["stroke-width"])||1);if(V=o(s(V,0),1),null==l["stroke-width"]&&(G=f["stroke-width"]),l["stroke-width"]&&(O.weight=G),G&&1>G&&(V*=G)&&(O.weight=1),O.opacity=V,l["stroke-linejoin"]&&(O.joinstyle=l["stroke-linejoin"]||"miter"),O.miterlimit=l["stroke-miterlimit"]||8,l["stroke-linecap"]&&(O.endcap="butt"==l["stroke-linecap"]?"flat":"square"==l["stroke-linecap"]?"square":"round"),"stroke-dasharray"in l){var H={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};O.dashstyle=H[e](l["stroke-dasharray"])?H[l["stroke-dasharray"]]:d}Y&&c.appendChild(O)}if("text"==m.type){m.paper.canvas.style.display=d;var X=m.paper.span,U=100,$=f.font&&f.font.match(/\d+(?:\.\d*)?(?=px)/);g=X.style,f.font&&(g.font=f.font),f["font-family"]&&(g.fontFamily=f["font-family"]),f["font-weight"]&&(g.fontWeight=f["font-weight"]),f["font-style"]&&(g.fontStyle=f["font-style"]),$=i(f["font-size"]||$&&$[0])||10,g.fontSize=$*U+"px",m.textpath.string&&(X.innerHTML=r(m.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var Z=X.getBoundingClientRect();m.W=f.w=(Z.right-Z.left)/U,m.H=f.h=(Z.bottom-Z.top)/U,m.X=f.x,m.Y=f.y+m.H/2,("x"in l||"y"in l)&&(m.path.v=t.format("m{0},{1}l{2},{1}",a(f.x*b),a(f.y*b),a(f.x*b)+1));for(var Q=["x","y","text","font","font-family","font-weight","font-style","font-size"],J=0,K=Q.length;K>J;J++)if(Q[J]in l){m._.dirty=1;break}switch(f["text-anchor"]){case"start":m.textpath.style["v-text-align"]="left",m.bbx=m.W/2;break;case"end":m.textpath.style["v-text-align"]="right",m.bbx=-m.W/2;break;default:m.textpath.style["v-text-align"]="center",m.bbx=0}m.textpath.style["v-text-kern"]=!0}},A=function(e,a,s){e.attrs=e.attrs||{};var o=e.attrs,l=Math.pow,h,u,c="linear",f=".5 .5";if(e.attrs.gradient=a,a=r(a).replace(t._radial_gradient,function(t,e,r){return c="radial",e&&r&&(e=i(e),r=i(r),l(e-.5,2)+l(r-.5,2)>.25&&(r=n.sqrt(.25-l(e-.5,2))*(2*(r>.5)-1)+.5),f=e+p+r),d}),a=a.split(/\s*\-\s*/),"linear"==c){var g=a.shift();if(g=-i(g),isNaN(g))return null}var x=t._parseDots(a);if(!x)return null;if(e=e.shape||e.node,x.length){e.removeChild(s),s.on=!0,s.method="none",s.color=x[0].color,s.color2=x[x.length-1].color;for(var v=[],y=0,m=x.length;m>y;y++)x[y].offset&&v.push(x[y].offset+p+x[y].color);s.colors=v.length?v.join():"0% "+s.color,"radial"==c?(s.type="gradientTitle",s.focus="100%",s.focussize="0 0",s.focusposition=f,s.angle=0):(s.type="gradient",s.angle=(270-g)%360),e.appendChild(s)}return 1},E=function(e,r){this[0]=this.node=e,e.raphael=!0,this.id=t._oid++,e.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=r,this.matrix=t.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!r.bottom&&(r.bottom=this),this.prev=r.top,r.top&&(r.top.next=this),r.top=this,this.next=null},N=t.el;E.prototype=N,N.constructor=E,N.transform=function(e){if(null==e)return this._.transform;var i=this.paper._viewBoxShift,n=i?"s"+[i.scale,i.scale]+"-1-1t"+[i.dx,i.dy]:d,a;i&&(a=e=r(e).replace(/\.{3}|\u2026/g,this._.transform||d)),t._extractTransform(this,n+e);var s=this.matrix.clone(),o=this.skew,l=this.node,h,u=~r(this.attrs.fill).indexOf("-"),c=!r(this.attrs.fill).indexOf("url(");if(s.translate(1,1),c||u||"image"==this.type)if(o.matrix="1 0 0 1",o.offset="0 0",h=s.split(),u&&h.noRotation||!h.isSimple){l.style.filter=s.toFilter();var f=this.getBBox(),g=this.getBBox(1),x=f.x-g.x,v=f.y-g.y;l.coordorigin=x*-b+p+v*-b,C(this,1,1,x,v,0)}else l.style.filter=d,C(this,h.scalex,h.scaley,h.dx,h.dy,h.rotate);else l.style.filter=d,o.matrix=r(s),o.offset=s.offset();return null!==a&&(this._.transform=a,t._extractTransform(this,a)),this},N.rotate=function(t,e,n){if(this.removed)return this;if(null!=t){if(t=r(t).split(u),t.length-1&&(e=i(t[1]),n=i(t[2])),t=i(t[0]),null==n&&(e=n),null==e||null==n){var a=this.getBBox(1);e=a.x+a.width/2,n=a.y+a.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",t,e,n]])),this}},N.translate=function(t,e){return this.removed?this:(t=r(t).split(u),t.length-1&&(e=i(t[1])),t=i(t[0])||0,e=+e||0,this._.bbox&&(this._.bbox.x+=t,this._.bbox.y+=e),this.transform(this._.transform.concat([["t",t,e]])),this)},N.scale=function(t,e,n,a){if(this.removed)return this;if(t=r(t).split(u),t.length-1&&(e=i(t[1]),n=i(t[2]),a=i(t[3]),isNaN(n)&&(n=null),isNaN(a)&&(a=null)),t=i(t[0]),null==e&&(e=t),null==a&&(n=a),null==n||null==a)var s=this.getBBox(1);return n=null==n?s.x+s.width/2:n,a=null==a?s.y+s.height/2:a,this.transform(this._.transform.concat([["s",t,e,n,a]])),this._.dirtyT=1,this},N.hide=function(){return!this.removed&&(this.node.style.display="none"),this},N.show=function(){return!this.removed&&(this.node.style.display=d),this},N.auxGetBBox=t.el.getBBox,N.getBBox=function(){var t=this.auxGetBBox();if(this.paper&&this.paper._viewBoxShift){var e={},r=1/this.paper._viewBoxShift.scale;return e.x=t.x-this.paper._viewBoxShift.dx,e.x*=r,e.y=t.y-this.paper._viewBoxShift.dy,e.y*=r,e.width=t.width*r,e.height=t.height*r,e.x2=e.x+e.width,e.y2=e.y+e.height,e}return t},N._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},N.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this),t.eve.unbind("raphael.*.*."+this.id),t._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var e in this)this[e]="function"==typeof this[e]?t._removedFactory(e):null;this.removed=!0}},N.attr=function(r,i){if(this.removed)return this;if(null==r){var n={};for(var a in this.attrs)this.attrs[e](a)&&(n[a]=this.attrs[a]);return n.gradient&&"none"==n.fill&&(n.fill=n.gradient)&&delete n.gradient,n.transform=this._.transform,n}if(null==i&&t.is(r,"string")){if(r==h&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var s=r.split(u),o={},l=0,f=s.length;f>l;l++)r=s[l],r in this.attrs?o[r]=this.attrs[r]:t.is(this.paper.customAttributes[r],"function")?o[r]=this.paper.customAttributes[r].def:o[r]=t._availableAttrs[r];return f-1?o:o[s[0]]}if(this.attrs&&null==i&&t.is(r,"array")){for(o={},l=0,f=r.length;f>l;l++)o[r[l]]=this.attr(r[l]);return o}var p;null!=i&&(p={},p[r]=i),null==i&&t.is(r,"object")&&(p=r);for(var d in p)c("raphael.attr."+d+"."+this.id,this,p[d]);if(p){for(d in this.paper.customAttributes)if(this.paper.customAttributes[e](d)&&p[e](d)&&t.is(this.paper.customAttributes[d],"function")){var g=this.paper.customAttributes[d].apply(this,[].concat(p[d]));this.attrs[d]=p[d];for(var x in g)g[e](x)&&(p[x]=g[x])}p.text&&"text"==this.type&&(this.textpath.string=p.text),T(this,p)}return this},N.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&t._tofront(this,this.paper),this},N.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),t._toback(this,this.paper)),this)},N.insertAfter=function(e){return this.removed?this:(e.constructor==t.st.constructor&&(e=e[e.length-1]),e.node.nextSibling?e.node.parentNode.insertBefore(this.node,e.node.nextSibling):e.node.parentNode.appendChild(this.node),t._insertafter(this,e,this.paper),this)},N.insertBefore=function(e){return this.removed?this:(e.constructor==t.st.constructor&&(e=e[0]),e.node.parentNode.insertBefore(this.node,e.node),t._insertbefore(this,e,this.paper),this)},N.blur=function(e){var r=this.node.runtimeStyle,i=r.filter;return i=i.replace(v,d),0!==+e?(this.attrs.blur=e,r.filter=i+p+f+".Blur(pixelradius="+(+e||1.5)+")",r.margin=t.format("-{0}px 0 0 -{0}px",a(+e||1.5))):(r.filter=i,r.margin=0,delete this.attrs.blur),this},t._engine.path=function(t,e){var r=M("shape");r.style.cssText=m,r.coordsize=b+p+b,r.coordorigin=e.coordorigin;var i=new E(r,e),n={fill:"none",stroke:"#000"};t&&(n.path=t),i.type="path",i.path=[],i.Path=d,T(i,n),e.canvas&&e.canvas.appendChild(r);var a=M("skew");return a.on=!0,r.appendChild(a),i.skew=a,i.transform(d),i},t._engine.rect=function(e,r,i,n,a,s){var o=t._rectPath(r,i,n,a,s),l=e.path(o),h=l.attrs;return l.X=h.x=r,l.Y=h.y=i,l.W=h.width=n,l.H=h.height=a,h.r=s,h.path=o,l.type="rect",l},t._engine.ellipse=function(t,e,r,i,n){var a=t.path(),s=a.attrs;return a.X=e-i,a.Y=r-n,a.W=2*i,a.H=2*n,a.type="ellipse",T(a,{cx:e,cy:r,rx:i,ry:n}),a},t._engine.circle=function(t,e,r,i){var n=t.path(),a=n.attrs;return n.X=e-i,n.Y=r-i,n.W=n.H=2*i,n.type="circle",T(n,{cx:e,cy:r,r:i}),n},t._engine.image=function(e,r,i,n,a,s){var o=t._rectPath(i,n,a,s),l=e.path(o).attr({stroke:"none"}),u=l.attrs,c=l.node,f=c.getElementsByTagName(h)[0];return u.src=r,l.X=u.x=i,l.Y=u.y=n,l.W=u.width=a,l.H=u.height=s,u.path=o,l.type="image",f.parentNode==c&&c.removeChild(f),f.rotate=!0,f.src=r,f.type="tile",l._.fillpos=[i,n],l._.fillsize=[a,s],c.appendChild(f),C(l,1,1,0,0,0),l},t._engine.text=function(e,i,n,s){var o=M("shape"),l=M("path"),h=M("textpath");i=i||0,n=n||0,s=s||"",l.v=t.format("m{0},{1}l{2},{1}",a(i*b),a(n*b),a(i*b)+1),l.textpathok=!0,h.string=r(s),h.on=!0,o.style.cssText=m,o.coordsize=b+p+b,o.coordorigin="0 0";var u=new E(o,e),c={fill:"#000",stroke:"none",font:t._availableAttrs.font,text:s};u.shape=o,u.path=l,u.textpath=h,u.type="text",u.attrs.text=r(s),u.attrs.x=i,u.attrs.y=n,u.attrs.w=1,u.attrs.h=1,T(u,c),o.appendChild(h),o.appendChild(l),e.canvas.appendChild(o);var f=M("skew");return f.on=!0,o.appendChild(f),u.skew=f,u.transform(d),u},t._engine.setSize=function(e,r){var i=this.canvas.style;return this.width=e,this.height=r,e==+e&&(e+="px"),r==+r&&(r+="px"),i.width=e,i.height=r,i.clip="rect(0 "+e+" "+r+" 0)",this._viewBox&&t._engine.setViewBox.apply(this,this._viewBox),this},t._engine.setViewBox=function(e,r,i,n,a){t.eve("raphael.setViewBox",this,this._viewBox,[e,r,i,n,a]);var s=this.getSize(),o=s.width,l=s.height,h,u;return a&&(h=l/n,u=o/i,o>i*h&&(e-=(o-i*h)/2/h),l>n*u&&(r-=(l-n*u)/2/u)),this._viewBox=[e,r,i,n,!!a],this._viewBoxShift={dx:-e,dy:-r,scale:s},this.forEach(function(t){t.transform("...")}),this};var M;t._engine.initWin=function(t){var e=t.document;e.styleSheets.length<31?e.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)"):e.styleSheets[0].addRule(".rvml","behavior:url(#default#VML)");try{!e.namespaces.rvml&&e.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),M=function(t){return e.createElement("<rvml:"+t+' class="rvml">')}}catch(r){M=function(t){return e.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},t._engine.initWin(t._g.win),t._engine.create=function(){var e=t._getContainer.apply(0,arguments),r=e.container,i=e.height,n,a=e.width,s=e.x,o=e.y;if(!r)throw new Error("VML container not found.");var l=new t._Paper,h=l.canvas=t._g.doc.createElement("div"),u=h.style;return s=s||0,o=o||0,a=a||512,i=i||342,l.width=a,l.height=i,a==+a&&(a+="px"),i==+i&&(i+="px"),l.coordsize=1e3*b+p+1e3*b,l.coordorigin="0 0",l.span=t._g.doc.createElement("span"),l.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",h.appendChild(l.span),u.cssText=t.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",a,i),1==r?(t._g.doc.body.appendChild(h),u.left=s+"px",u.top=o+"px",u.position="absolute"):r.firstChild?r.insertBefore(h,r.firstChild):r.appendChild(h),l.renderfix=function(){},l},t.prototype.clear=function(){t.eve("raphael.clear",this),this.canvas.innerHTML=d,this.span=t._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},t.prototype.remove=function(){t.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var e in this)this[e]="function"==typeof this[e]?t._removedFactory(e):null;return!0};var L=t.st;for(var z in N)N[e](z)&&!L[e](z)&&(L[z]=function(t){return function(){var e=arguments;return this.forEach(function(r){r[t].apply(r,e)})}}(z))}}.apply(e,i),!(void 0!==n&&(t.exports=n))}])});!function(a,b){function c(c,j,k){var n=[];j=1==j?{entropy:!0}:j||{};var s=g(f(j.entropy?[c,i(a)]:null==c?h():c,3),n),t=new d(n),u=function(){for(var a=t.g(m),b=p,c=0;q>a;)a=(a+c)*l,b*=l,c=t.g(1);for(;a>=r;)a/=2,b/=2,c>>>=1;return(a+c)/b};return u.int32=function(){return 0|t.g(4)},u.quick=function(){return t.g(4)/4294967296},u["double"]=u,g(i(t.S),a),(j.pass||k||function(a,c,d,f){return f&&(f.S&&e(f,t),a.state=function(){return e(t,{})}),d?(b[o]=a,c):a})(u,s,"global"in j?j.global:this==b,j.state)}function d(a){var b,c=a.length,d=this,e=0,f=d.i=d.j=0,g=d.S=[];for(c||(a=[c++]);l>e;)g[e]=e++;for(e=0;l>e;e++)g[e]=g[f=s&f+a[e%c]+(b=g[e])],g[f]=b;(d.g=function(a){for(var b,c=0,e=d.i,f=d.j,g=d.S;a--;)b=g[e=s&e+1],c=c*l+g[s&(g[e]=g[f=s&f+b])+(g[f]=b)];return d.i=e,d.j=f,c})(l)}function e(a,b){return b.i=a.i,b.j=a.j,b.S=a.S.slice(),b}function f(a,b){var c,d=[],e=typeof a;if(b&&"object"==e)for(c in a)try{d.push(f(a[c],b-1))}catch(g){}return d.length?d:"string"==e?a:a+"\0"}function g(a,b){for(var c,d=a+"",e=0;e<d.length;)b[s&e]=s&(c^=19*b[s&e])+d.charCodeAt(e++);return i(b)}function h(){try{if(j)return i(j.randomBytes(l));var b=new Uint8Array(l);return(k.crypto||k.msCrypto).getRandomValues(b),i(b)}catch(c){var d=k.navigator,e=d&&d.plugins;return[+new Date,k,e,k.screen,i(a)]}}function i(a){return String.fromCharCode.apply(0,a)}var j,k=this,l=256,m=6,n=52,o="random",p=b.pow(l,m),q=b.pow(2,n),r=2*q,s=l-1;if(b["seed"+o]=c,g(b.random(),a),"object"==typeof module&&module.exports){module.exports=c;try{j=require("crypto")}catch(t){}}else"function"==typeof define&&define.amd&&define(function(){return c})}([],Math);"use strict";(function(L){function y(n,b,d){var c=0,f=[],e=0,a,h,l,k,m,t,u,q,v=!1,r=[],A=[],x,B=!1;d=d||{};a=d.encoding||"UTF8";x=d.numRounds||1;l=C(b,a);if(x!==parseInt(x,10)||1>x)throw Error("numRounds must a integer >= 1");if(0===n.lastIndexOf("SHA-",0))if(t=function(b,c){return D(b,c,n)},u=function(b,c,d,e){var p,f;if("SHA-384"===n||"SHA-512"===n)p=(c+129>>>10<<5)+31,f=32;else throw Error("Unexpected error in SHA-2 implementation");for(;b.length<=p;)b.push(0);b[c>>>5]|=128<<24-c%32;c=c+d;b[p]=c&4294967295;b[p-1]=c/4294967296|0;d=b.length;for(c=0;c<d;c+=f)e=D(b.slice(c,c+f),e,n);if("SHA-384"===n)b=[e[0].a,e[0].b,e[1].a,e[1].b,e[2].a,e[2].b,e[3].a,e[3].b,e[4].a,e[4].b,e[5].a,e[5].b];else if("SHA-512"===n)b=[e[0].a,e[0].b,e[1].a,e[1].b,e[2].a,e[2].b,e[3].a,e[3].b,e[4].a,e[4].b,e[5].a,e[5].b,e[6].a,e[6].b,e[7].a,e[7].b];else throw Error("Unexpected error in SHA-2 implementation");return b},q=function(b){return b.slice()},"SHA-384"===n)m=1024,k=384;else if("SHA-512"===n)m=1024,k=512;else throw Error("Chosen SHA variant is not supported");else throw Error("Chosen SHA variant is not supported");h=z(n);this.setHMACKey=function(b,d,e){var f;if(!0===v)throw Error("HMAC key already set");if(!0===B)throw Error("Cannot set HMAC key after calling update");a=(e||{}).encoding||"UTF8";d=C(d,a)(b);b=d.binLen;d=d.value;f=m>>>3;e=f/4-1;if(f<b/8){for(d=u(d,b,0,z(n),k);d.length<=e;)d.push(0);d[e]&=4294967040}else if(f>b/8){for(;d.length<=e;)d.push(0);d[e]&=4294967040}for(b=0;b<=e;b+=1)r[b]=d[b]^909522486,A[b]=d[b]^1549556828;h=t(r,h);c=m;v=!0};this.update=function(b){var d,n,a,g=0,k=m>>>5;d=l(b,f,e);b=d.binLen;n=d.value;d=b>>>5;for(a=0;a<d;a+=k)g+m<=b&&(h=t(n.slice(a,a+k),h),g+=m);c+=g;f=n.slice(g>>>5);e=b%m;B=!0};this.getHash=function(b,d){var a,g,m,l;if(!0===v)throw Error("Cannot call getHash after setting HMAC key");m=E(d);switch(b){case"HEX":a=function(b){return F(b,k,m)};break;case"B64":a=function(b){return G(b,k,m)};break;case"BYTES":a=function(b){return H(b,k)};break;case"ARRAYBUFFER":try{g=new ArrayBuffer(0)}catch(w){throw Error("ARRAYBUFFER not supported by this environment")}a=function(b){return I(b,k)};break;default:throw Error("format must be HEX, B64, BYTES, or ARRAYBUFFER")}l=u(f.slice(),e,c,q(h),k);for(g=1;g<x;g+=1)l=u(l,k,0,z(n),k);return a(l)};this.getHMAC=function(b,d){var a,g,l,r;if(!1===v)throw Error("Cannot call getHMAC without first setting HMAC key");l=E(d);switch(b){case"HEX":a=function(b){return F(b,k,l)};break;case"B64":a=function(b){return G(b,k,l)};break;case"BYTES":a=function(b){return H(b,k)};break;case"ARRAYBUFFER":try{a=new ArrayBuffer(0)}catch(w){throw Error("ARRAYBUFFER not supported by this environment")}a=function(b){return I(b,k)};break;default:throw Error("outputFormat must be HEX, B64, BYTES, or ARRAYBUFFER")}g=u(f.slice(),e,c,q(h),k);r=t(A,z(n));r=u(g,k,m,r,k);return a(r)}}function c(c,b){this.a=c;this.b=b}function M(c,b,d){var a=c.length,f,e,g,h,l;b=b||[0];d=d||0;l=d>>>3;if(0!==a%2)throw Error("String of HEX type must be in byte increments");for(f=0;f<a;f+=2){e=parseInt(c.substr(f,2),16);if(isNaN(e))throw Error("String of HEX type contains invalid characters");h=(f>>>1)+l;for(g=h>>>2;b.length<=g;)b.push(0);b[g]|=e<<8*(3-h%4)}return{value:b,binLen:4*a+d}}function N(c,b,d){var a=[],f,e,g,h,a=b||[0];d=d||0;e=d>>>3;for(f=0;f<c.length;f+=1)b=c.charCodeAt(f),h=f+e,g=h>>>2,a.length<=g&&a.push(0),a[g]|=b<<8*(3-h%4);return{value:a,binLen:8*c.length+d}}function O(c,b,d){var a=[],f=0,e,g,h,l,k,m,a=b||[0];d=d||0;b=d>>>3;if(-1===c.search(/^[a-zA-Z0-9=+\/]+$/))throw Error("Invalid character in base-64 string");g=c.indexOf("=");c=c.replace(/\=/g,"");if(-1!==g&&g<c.length)throw Error("Invalid '=' found in base-64 string");for(g=0;g<c.length;g+=4){k=c.substr(g,4);for(h=l=0;h<k.length;h+=1)e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(k[h]),l|=e<<18-6*h;for(h=0;h<k.length-1;h+=1){m=f+b;for(e=m>>>2;a.length<=e;)a.push(0);a[e]|=(l>>>16-8*h&255)<<8*(3-m%4);f+=1}}return{value:a,binLen:8*f+d}}function P(c,b,d){var a=[],f,e,g,a=b||[0];d=d||0;f=d>>>3;for(b=0;b<c.byteLength;b+=1)g=b+f,e=g>>>2,a.length<=e&&a.push(0),a[e]|=c[b]<<8*(3-g%4);return{value:a,binLen:8*c.byteLength+d}}function F(c,b,d){var a="";b/=8;var f,e;for(f=0;f<b;f+=1)e=c[f>>>2]>>>8*(3-f%4),a+="0123456789abcdef".charAt(e>>>4&15)+"0123456789abcdef".charAt(e&15);return d.outputUpper?a.toUpperCase():a}function G(c,b,d){var a="",f=b/8,e,g,h;for(e=0;e<f;e+=3)for(g=e+1<f?c[e+1>>>2]:0,h=e+2<f?c[e+2>>>2]:0,h=(c[e>>>2]>>>8*(3-e%4)&255)<<16|(g>>>8*(3-(e+1)%4)&255)<<8|h>>>8*(3-(e+2)%4)&255,g=0;4>g;g+=1)8*e+6*g<=b?a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h>>>6*(3-g)&63):a+=d.b64Pad;return a}function H(c,b){var d="",a=b/8,f,e;for(f=0;f<a;f+=1)e=c[f>>>2]>>>8*(3-f%4)&255,d+=String.fromCharCode(e);return d}function I(c,b){var d=b/8,a,f=new ArrayBuffer(d);for(a=0;a<d;a+=1)f[a]=c[a>>>2]>>>8*(3-a%4)&255;return f}function E(c){var b={outputUpper:!1,b64Pad:"=",shakeLen:-1};c=c||{};b.outputUpper=c.outputUpper||!1;!0===c.hasOwnProperty("b64Pad")&&(b.b64Pad=c.b64Pad);if("boolean"!==typeof b.outputUpper)throw Error("Invalid outputUpper formatting option");if("string"!==typeof b.b64Pad)throw Error("Invalid b64Pad formatting option");return b}function C(c,b){var d;switch(b){case"UTF8":case"UTF16BE":case"UTF16LE":break;default:throw Error("encoding must be UTF8, UTF16BE, or UTF16LE")}switch(c){case"HEX":d=M;break;case"TEXT":d=function(c,d,a){var n=[],h=[],l=0,k,m,t,u,q,n=d||[0];d=a||0;t=d>>>3;if("UTF8"===b)for(k=0;k<c.length;k+=1)for(a=c.charCodeAt(k),h=[],128>a?h.push(a):2048>a?(h.push(192|a>>>6),h.push(128|a&63)):55296>a||57344<=a?h.push(224|a>>>12,128|a>>>6&63,128|a&63):(k+=1,a=65536+((a&1023)<<10|c.charCodeAt(k)&1023),h.push(240|a>>>18,128|a>>>12&63,128|a>>>6&63,128|a&63)),m=0;m<h.length;m+=1){q=l+t;for(u=q>>>2;n.length<=u;)n.push(0);n[u]|=h[m]<<8*(3-q%4);l+=1}else if("UTF16BE"===b||"UTF16LE"===b)for(k=0;k<c.length;k+=1){a=c.charCodeAt(k);"UTF16LE"===b&&(m=a&255,a=m<<8|a>>>8);q=l+t;for(u=q>>>2;n.length<=u;)n.push(0);n[u]|=a<<8*(2-q%4);l+=2}return{value:n,binLen:8*l+d}};break;case"B64":d=O;break;case"BYTES":d=N;break;case"ARRAYBUFFER":try{d=new ArrayBuffer(0)}catch(a){throw Error("ARRAYBUFFER not supported by this environment")}d=P;break;default:throw Error("format must be HEX, TEXT, B64, BYTES, or ARRAYBUFFER")}return d}function v(a,b){var d=null,d=new c(a.a,a.b);return d=32>=b?new c(d.a>>>b|d.b<<32-b&4294967295,d.b>>>b|d.a<<32-b&4294967295):new c(d.b>>>b-32|d.a<<64-b&4294967295,d.a>>>b-32|d.b<<64-b&4294967295)}function J(a,b){var d=null;return d=32>=b?new c(a.a>>>b,a.b>>>b|a.a<<32-b&4294967295):new c(0,a.a>>>b-32)}function Q(a,b,d){return new c(a.a&b.a^~a.a&d.a,a.b&b.b^~a.b&d.b)}function R(a,b,d){return new c(a.a&b.a^a.a&d.a^b.a&d.a,a.b&b.b^a.b&d.b^b.b&d.b)}function S(a){var b=v(a,28),d=v(a,34);a=v(a,39);return new c(b.a^d.a^a.a,b.b^d.b^a.b)}function T(a){var b=v(a,14),d=v(a,18);a=v(a,41);return new c(b.a^d.a^a.a,b.b^d.b^a.b)}function U(a){var b=v(a,1),d=v(a,8);a=J(a,7);return new c(b.a^d.a^a.a,b.b^d.b^a.b)}function V(a){var b=v(a,19),d=v(a,61);a=J(a,6);return new c(b.a^d.a^a.a,b.b^d.b^a.b)}function W(a,b){var d,p,f;d=(a.b&65535)+(b.b&65535);p=(a.b>>>16)+(b.b>>>16)+(d>>>16);f=(p&65535)<<16|d&65535;d=(a.a&65535)+(b.a&65535)+(p>>>16);p=(a.a>>>16)+(b.a>>>16)+(d>>>16);return new c((p&65535)<<16|d&65535,f)}function X(a,b,d,p){var f,e,g;f=(a.b&65535)+(b.b&65535)+(d.b&65535)+(p.b&65535);e=(a.b>>>16)+(b.b>>>16)+(d.b>>>16)+(p.b>>>16)+(f>>>16);g=(e&65535)<<16|f&65535;f=(a.a&65535)+(b.a&65535)+(d.a&65535)+(p.a&65535)+(e>>>16);e=(a.a>>>16)+(b.a>>>16)+(d.a>>>16)+(p.a>>>16)+(f>>>16);return new c((e&65535)<<16|f&65535,g)}function Y(a,b,d,p,f){var e,g,h;e=(a.b&65535)+(b.b&65535)+(d.b&65535)+(p.b&65535)+(f.b&65535);g=(a.b>>>16)+(b.b>>>16)+(d.b>>>16)+(p.b>>>16)+(f.b>>>16)+(e>>>16);h=(g&65535)<<16|e&65535;e=(a.a&65535)+(b.a&65535)+(d.a&65535)+(p.a&65535)+(f.a&65535)+(g>>>16);g=(a.a>>>16)+(b.a>>>16)+(d.a>>>16)+(p.a>>>16)+(f.a>>>16)+(e>>>16);return new c((g&65535)<<16|e&65535,h)}function z(a){var b=[],d;if(0===a.lastIndexOf("SHA-",0))switch(b=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],d=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],a){case"SHA-224":break;case"SHA-256":b=d;break;case"SHA-384":b=[new c(3418070365,b[0]),new c(1654270250,b[1]),new c(2438529370,b[2]),new c(355462360,b[3]),new c(1731405415,b[4]),new c(41048885895,b[5]),new c(3675008525,b[6]),new c(1203062813,b[7])];break;case"SHA-512":b=[new c(d[0],4089235720),new c(d[1],2227873595),new c(d[2],4271175723),new c(d[3],1595750129),new c(d[4],2917565137),new c(d[5],725511199),new c(d[6],4215389547),new c(d[7],327033209)];break;default:throw Error("Unknown SHA variant")}else throw Error("No SHA variants supported");return b}function D(a,b,d){var p,f,e,g,h,l,k,m,t,u,q,v,r,A,x,B,y,z,C,D,E,F,w=[],G;if("SHA-384"===d||"SHA-512"===d)u=80,v=2,F=c,r=W,A=X,x=Y,B=U,y=V,z=S,C=T,E=R,D=Q,G=K;else throw Error("Unexpected error in SHA-2 implementation");d=b[0];p=b[1];f=b[2];e=b[3];g=b[4];h=b[5];l=b[6];k=b[7];for(q=0;q<u;q+=1)16>q?(t=q*v,m=a.length<=t?0:a[t],t=a.length<=t+1?0:a[t+1],w[q]=new F(m,t)):w[q]=A(y(w[q-2]),w[q-7],B(w[q-15]),w[q-16]),m=x(k,C(g),D(g,h,l),G[q],w[q]),t=r(z(d),E(d,p,f)),k=l,l=h,h=g,g=r(e,m),e=f,f=p,p=d,d=r(m,t);b[0]=r(d,b[0]);b[1]=r(p,b[1]);b[2]=r(f,b[2]);b[3]=r(e,b[3]);b[4]=r(g,b[4]);b[5]=r(h,b[5]);b[6]=r(l,b[6]);b[7]=r(k,b[7]);return b}var a,K;a=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];K=[new c(a[0],3609767458),new c(a[1],602891725),new c(a[2],3964484399),new c(a[3],2173295548),new c(a[4],4081628472),new c(a[5],3053834265),new c(a[6],2937671579),new c(a[7],3664609560),new c(a[8],2734883394),new c(a[9],1164996542),new c(a[10],1323610764),new c(a[11],3590304994),new c(a[12],4068182383),new c(a[13],991336113),new c(a[14],633803317),new c(a[15],3479774868),new c(a[16],2666613458),new c(a[17],944711139),new c(a[18],2341262773),new c(a[19],2007800933),new c(a[20],1495990901),new c(a[21],1856431235),new c(a[22],3175218132),new c(a[23],2198950837),new c(a[24],3999719339),new c(a[25],766784016),new c(a[26],2566594879),new c(a[27],3203337956),new c(a[28],1034457026),new c(a[29],2466948901),new c(a[30],3758326383),new c(a[31],168717936),new c(a[32],1188179964),new c(a[33],1546045734),new c(a[34],1522805485),new c(a[35],2643833823),new c(a[36],2343527390),new c(a[37],1014477480),new c(a[38],1206759142),new c(a[39],344077627),new c(a[40],1290863460),new c(a[41],3158454273),new c(a[42],3505952657),new c(a[43],106217008),new c(a[44],3606008344),new c(a[45],1432725776),new c(a[46],1467031594),new c(a[47],851169720),new c(a[48],3100823752),new c(a[49],1363258195),new c(a[50],3750685593),new c(a[51],3785050280),new c(a[52],3318307427),new c(a[53],3812723403),new c(a[54],2003034995),new c(a[55],3602036899),new c(a[56],1575990012),new c(a[57],1125592928),new c(a[58],2716904306),new c(a[59],442776044),new c(a[60],593698344),new c(a[61],3733110249),new c(a[62],2999351573),new c(a[63],3815920427),new c(3391569614,3928383900),new c(3515267271,566280711),new c(3940187606,3454069534),new c(4118630271,4000239992),new c(116418474,1914138554),new c(174292421,2731055270),new c(289380356,3203993006),new c(460393269,320620315),new c(685471733,587496836),new c(852142971,1086792851),new c(1017036298,365543100),new c(1126000580,2618297676),new c(1288033470,3409855158),new c(1501505948,4234509866),new c(1607167915,987167468),new c(1816402316,1246189591)];"function"===typeof define&&define.amd?define(function(){return y}):"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(module.exports=y),exports=y):L.jsSHA=y})(this);!function(a,b){"use strict";"function"==typeof define&&define.amd?define(b):"undefined"!=typeof exports?module.exports=b():a.simpleStorage=b()}(this,function(){"use strict";function a(){p=j(),d(),g(),b(),"addEventListener"in window&&window.addEventListener("pageshow",function(a){a.persisted&&c()},!1),p=!0}function b(){"addEventListener"in window?window.addEventListener("storage",c,!1):document.attachEvent("onstorage",c)}function c(){try{d()}catch(a){return void(p=!1)}g()}function d(){var a=localStorage.getItem("simpleStorage");try{n=JSON.parse(a)||{}}catch(b){n={}}o=f()}function e(){try{localStorage.setItem("simpleStorage",JSON.stringify(n)),o=f()}catch(a){return k(a)}return!0}function f(){var a=localStorage.getItem("simpleStorage");return a?String(a).length:0}function g(){var a,b,c,d,f,h=1/0,j=0;if(clearTimeout(q),n&&n.__simpleStorage_meta&&n.__simpleStorage_meta.TTL){for(a=+new Date,f=n.__simpleStorage_meta.TTL.keys||[],d=n.__simpleStorage_meta.TTL.expire||{},b=0,c=f.length;c>b;b++){if(!(d[f[b]]<=a)){d[f[b]]<h&&(h=d[f[b]]);break}j++,delete n[f[b]],delete d[f[b]]}h!==1/0&&(q=setTimeout(g,Math.min(h-a,2147483647))),j&&(f.splice(0,j),i(),e())}}function h(a,b){var c,d,e=+new Date,f=!1;if(b=Number(b)||0,0!==b){if(!n.hasOwnProperty(a))return!1;if(n.__simpleStorage_meta||(n.__simpleStorage_meta={}),n.__simpleStorage_meta.TTL||(n.__simpleStorage_meta.TTL={expire:{},keys:[]}),n.__simpleStorage_meta.TTL.expire[a]=e+b,n.__simpleStorage_meta.TTL.expire.hasOwnProperty(a))for(c=0,d=n.__simpleStorage_meta.TTL.keys.length;d>c;c++)n.__simpleStorage_meta.TTL.keys[c]===a&&n.__simpleStorage_meta.TTL.keys.splice(c);for(c=0,d=n.__simpleStorage_meta.TTL.keys.length;d>c;c++)if(n.__simpleStorage_meta.TTL.expire[n.__simpleStorage_meta.TTL.keys[c]]>e+b){n.__simpleStorage_meta.TTL.keys.splice(c,0,a),f=!0;break}f||n.__simpleStorage_meta.TTL.keys.push(a)}else if(n&&n.__simpleStorage_meta&&n.__simpleStorage_meta.TTL){if(n.__simpleStorage_meta.TTL.expire.hasOwnProperty(a))for(delete n.__simpleStorage_meta.TTL.expire[a],c=0,d=n.__simpleStorage_meta.TTL.keys.length;d>c;c++)if(n.__simpleStorage_meta.TTL.keys[c]===a){n.__simpleStorage_meta.TTL.keys.splice(c,1);break}i()}return clearTimeout(q),n&&n.__simpleStorage_meta&&n.__simpleStorage_meta.TTL&&n.__simpleStorage_meta.TTL.keys.length&&(q=setTimeout(g,Math.min(Math.max(n.__simpleStorage_meta.TTL.expire[n.__simpleStorage_meta.TTL.keys[0]]-e,0),2147483647))),!0}function i(){var a,b=!1,c=!1;if(!n||!n.__simpleStorage_meta)return b;n.__simpleStorage_meta.TTL&&!n.__simpleStorage_meta.TTL.keys.length&&(delete n.__simpleStorage_meta.TTL,b=!0);for(a in n.__simpleStorage_meta)if(n.__simpleStorage_meta.hasOwnProperty(a)){c=!0;break}return c||(delete n.__simpleStorage_meta,b=!0),b}function j(){var a,b=0;if(null===window.localStorage||"unknown"==typeof window.localStorage)throw a=new Error("localStorage is disabled"),a.code=t,a;if(!window.localStorage)throw a=new Error("localStorage not supported"),a.code=s,a;try{b=window.localStorage.length}catch(c){throw k(c)}try{window.localStorage.setItem("__simpleStorageInitTest",Date.now().toString(16)),window.localStorage.removeItem("__simpleStorageInitTest")}catch(c){throw b?k(c):(a=new Error("localStorage is disabled"),a.code=t,a)}return!0}function k(a){var b;return 22===a.code||1014===a.code||[-2147024882,-2146828281,-21474675259].indexOf(a.number)>0?(b=new Error("localStorage quota exceeded"),b.code=u,b):18===a.code||1e3===a.code?(b=new Error("localStorage is disabled"),b.code=t,b):"TypeError"===a.name?(b=new Error("localStorage is disabled"),b.code=t,b):a}function l(a){if(!a)return r="OK",a;switch(a.code){case s:case t:case u:r=a.code;break;default:r=a.code||a.number||a.message||a.name}return a}var m="0.2.1",n=!1,o=0,p=!1,q=null,r="OK",s="LS_NOT_AVAILABLE",t="LS_DISABLED",u="LS_QUOTA_EXCEEDED";try{a()}catch(v){l(v)}return{version:m,status:r,canUse:function(){return"OK"===r&&!!p},set:function(a,b,c){if("__simpleStorage_meta"===a)return!1;if(!n)return!1;if("undefined"==typeof b)return this.deleteKey(a);c=c||{};try{b=JSON.parse(JSON.stringify(b))}catch(d){return k(d)}return n[a]=b,h(a,c.TTL||0),e()},hasKey:function(a){return n&&n.hasOwnProperty(a)&&"__simpleStorage_meta"!==a?!0:!1},get:function(a){return n?n.hasOwnProperty(a)&&"__simpleStorage_meta"!==a&&this.getTTL(a)?n[a]:void 0:!1},deleteKey:function(a){return n&&a in n?(delete n[a],h(a,0),e()):!1},setTTL:function(a,b){return n?(h(a,b),e()):!1},getTTL:function(a){var b;return n&&n.hasOwnProperty(a)?n.__simpleStorage_meta&&n.__simpleStorage_meta.TTL&&n.__simpleStorage_meta.TTL.expire&&n.__simpleStorage_meta.TTL.expire.hasOwnProperty(a)?(b=Math.max(n.__simpleStorage_meta.TTL.expire[a]-+new Date||0,0),b||!1):1/0:!1},flush:function(){if(!n)return!1;n={};try{return localStorage.removeItem("simpleStorage"),!0}catch(a){return k(a)}},index:function(){if(!n)return!1;var a,b=[];for(a in n)n.hasOwnProperty(a)&&"__simpleStorage_meta"!==a&&b.push(a);return b},storageSize:function(){return o}}});Slider.isSupported=typeof document.createElement!="undefined"&&typeof document.documentElement!="undefined"&&typeof document.documentElement.offsetWidth=="number";function Slider(oElement,oInput,sOrientation){if(!oElement)return;this._orientation=sOrientation||"horizontal";this._range=new Range;this._range.setExtent(0);this._blockIncrement=10;this._unitIncrement=1;this._timer=new Timer(100);if(Slider.isSupported&&oElement){this.document=oElement.ownerDocument||oElement.document;this.element=oElement;this.element.slider=this;this.element.unselectable="on";this.element.className=this._orientation+" "+this.classNameTag+" "+this.element.className;this.line=this.document.createElement("DIV");this.line.className="line";this.line.unselectable="on";this.line.appendChild(this.document.createElement("DIV"));this.element.appendChild(this.line);this.handle=this.document.createElement("DIV");this.handle.className="handle";this.handle.unselectable="on";this.handle.appendChild(this.document.createElement("DIV"));this.handle.firstChild.appendChild(this.document.createTextNode(String.fromCharCode(160)));this.element.appendChild(this.handle)}this.input=oInput;var oThis=this;this._range.onchange=function(){oThis.recalculate();if(typeof oThis.onchange=="function")oThis.onchange()};if(Slider.isSupported&&oElement){this.element.onfocus=Slider.eventHandlers.onfocus;this.element.onblur=Slider.eventHandlers.onblur;this.element.onmousedown=Slider.eventHandlers.onmousedown;this.element.onmouseover=Slider.eventHandlers.onmouseover;this.element.onmouseout=Slider.eventHandlers.onmouseout;this.element.onkeydown=Slider.eventHandlers.onkeydown;this.element.onkeypress=Slider.eventHandlers.onkeypress;this.element.onmousewheel=Slider.eventHandlers.onmousewheel;this.handle.onselectstart=this.element.onselectstart=function(){return false};this._timer.ontimer=function(){oThis.ontimer()};window.setTimeout(function(){oThis.recalculate()},1)}else{this.input.onchange=function(e){oThis.setValue(oThis.input.value)}}}Slider.eventHandlers={getEvent:function(e,el){if(!e){if(el)e=el.document.parentWindow.event;else e=window.event}if(!e.srcElement){var el=e.target;while(el!=null&&el.nodeType!=1)el=el.parentNode;e.srcElement=el}if(typeof e.offsetX=="undefined"){e.offsetX=e.layerX;e.offsetY=e.layerY}return e},getDocument:function(e){if(e.target)return e.target.ownerDocument;return e.srcElement.document},getSlider:function(e){var el=e.target||e.srcElement;while(el!=null&&el.slider==null){el=el.parentNode}if(el)return el.slider;return null},getLine:function(e){var el=e.target||e.srcElement;while(el!=null&&el.className!="line"){el=el.parentNode}return el},getHandle:function(e){var el=e.target||e.srcElement;var re=/handle/;while(el!=null&&!re.test(el.className)){el=el.parentNode}return el},onfocus:function(e){var s=this.slider;s._focused=true;s.handle.className="handle hover"},onblur:function(e){var s=this.slider;s._focused=false;s.handle.className="handle"},onmouseover:function(e){e=Slider.eventHandlers.getEvent(e,this);var s=this.slider;if(e.srcElement==s.handle)s.handle.className="handle hover"},onmouseout:function(e){e=Slider.eventHandlers.getEvent(e,this);var s=this.slider;if(e.srcElement==s.handle&&!s._focused)s.handle.className="handle"},onmousedown:function(e){e=Slider.eventHandlers.getEvent(e,this);var s=this.slider;if(s.element.focus)s.element.focus();Slider._currentInstance=s;var doc=s.document;if(doc.addEventListener){doc.addEventListener("mousemove",Slider.eventHandlers.onmousemove,true);doc.addEventListener("mouseup",Slider.eventHandlers.onmouseup,true)}else if(doc.attachEvent){doc.attachEvent("onmousemove",Slider.eventHandlers.onmousemove);doc.attachEvent("onmouseup",Slider.eventHandlers.onmouseup);doc.attachEvent("onlosecapture",Slider.eventHandlers.onmouseup);s.element.setCapture()}if(Slider.eventHandlers.getHandle(e)){Slider._sliderDragData={screenX:e.screenX,screenY:e.screenY,dx:e.screenX-s.handle.offsetLeft,dy:e.screenY-s.handle.offsetTop,startValue:s.getValue(),slider:s}}else{var lineEl=Slider.eventHandlers.getLine(e);s._mouseX=e.offsetX+(lineEl?s.line.offsetLeft:0);s._mouseY=e.offsetY+(lineEl?s.line.offsetTop:0);s._increasing=null;s.ontimer()}},onmousemove:function(e){e=Slider.eventHandlers.getEvent(e,this);if(Slider._sliderDragData){var s=Slider._sliderDragData.slider;var boundSize=s.getMaximum()-s.getMinimum();var size,pos,reset;if(s._orientation=="horizontal"){size=s.element.offsetWidth-s.handle.offsetWidth;pos=e.screenX-Slider._sliderDragData.dx;reset=Math.abs(e.screenY-Slider._sliderDragData.screenY)>100}else{size=s.element.offsetHeight-s.handle.offsetHeight;pos=s.element.offsetHeight-s.handle.offsetHeight-(e.screenY-Slider._sliderDragData.dy);reset=Math.abs(e.screenX-Slider._sliderDragData.screenX)>100}s.setValue(reset?Slider._sliderDragData.startValue:s.getMinimum()+boundSize*pos/size);return false}else{var s=Slider._currentInstance;if(s!=null){var lineEl=Slider.eventHandlers.getLine(e);s._mouseX=e.offsetX+(lineEl?s.line.offsetLeft:0);s._mouseY=e.offsetY+(lineEl?s.line.offsetTop:0)}}},onmouseup:function(e){e=Slider.eventHandlers.getEvent(e,this);var s=Slider._currentInstance;var doc=s.document;if(doc.removeEventListener){doc.removeEventListener("mousemove",Slider.eventHandlers.onmousemove,true);doc.removeEventListener("mouseup",Slider.eventHandlers.onmouseup,true)}else if(doc.detachEvent){doc.detachEvent("onmousemove",Slider.eventHandlers.onmousemove);doc.detachEvent("onmouseup",Slider.eventHandlers.onmouseup);doc.detachEvent("onlosecapture",Slider.eventHandlers.onmouseup);s.element.releaseCapture()}if(Slider._sliderDragData){Slider._sliderDragData=null}else{s._timer.stop();s._increasing=null}Slider._currentInstance=null},onkeydown:function(e){e=Slider.eventHandlers.getEvent(e,this);var s=this.slider;var kc=e.keyCode;switch(kc){case 33:s.setValue(s.getValue()+s.getBlockIncrement());break;case 34:s.setValue(s.getValue()-s.getBlockIncrement());break;case 35:s.setValue(s.getOrientation()=="horizontal"?s.getMaximum():s.getMinimum());break;case 36:s.setValue(s.getOrientation()=="horizontal"?s.getMinimum():s.getMaximum());break;case 38:case 39:s.setValue(s.getValue()+s.getUnitIncrement());break;case 37:case 40:s.setValue(s.getValue()-s.getUnitIncrement());break}if(kc>=33&&kc<=40){return false}},onkeypress:function(e){e=Slider.eventHandlers.getEvent(e,this);var kc=e.keyCode;if(kc>=33&&kc<=40){return false}},onmousewheel:function(e){e=Slider.eventHandlers.getEvent(e,this);var s=this.slider;if(s._focused){s.setValue(s.getValue()+e.wheelDelta/120*s.getUnitIncrement());return false}}};Slider.prototype.classNameTag="dynamic-slider-control",Slider.prototype.setValue=function(v){this._range.setValue(v);this.input.value=this.getValue()};Slider.prototype.getValue=function(){return this._range.getValue()};Slider.prototype.setMinimum=function(v){this._range.setMinimum(v);this.input.value=this.getValue()};Slider.prototype.getMinimum=function(){return this._range.getMinimum()};Slider.prototype.setMaximum=function(v){this._range.setMaximum(v);this.input.value=this.getValue()};Slider.prototype.getMaximum=function(){return this._range.getMaximum()};Slider.prototype.setUnitIncrement=function(v){this._unitIncrement=v};Slider.prototype.getUnitIncrement=function(){return this._unitIncrement};Slider.prototype.setBlockIncrement=function(v){this._blockIncrement=v};Slider.prototype.getBlockIncrement=function(){return this._blockIncrement};Slider.prototype.getOrientation=function(){return this._orientation};Slider.prototype.setOrientation=function(sOrientation){if(sOrientation!=this._orientation){if(Slider.isSupported&&this.element){this.element.className=this.element.className.replace(this._orientation,sOrientation)}this._orientation=sOrientation;this.recalculate()}};Slider.prototype.recalculate=function(){if(!Slider.isSupported||!this.element)return;var w=this.element.offsetWidth;var h=this.element.offsetHeight;var hw=this.handle.offsetWidth;var hh=this.handle.offsetHeight;var lw=this.line.offsetWidth;var lh=this.line.offsetHeight;if(this._orientation=="horizontal"){this.handle.style.left=(w-hw)*(this.getValue()-this.getMinimum())/(this.getMaximum()-this.getMinimum())+"px";this.handle.style.top=(h-hh)/2+"px";this.line.style.top=(h-lh)/2+"px";this.line.style.left=hw/2+"px";this.line.style.width=Math.max(0,w-hw-2)+"px";this.line.firstChild.style.width=Math.max(0,w-hw-4)+"px"}else{this.handle.style.left=(w-hw)/2+"px";this.handle.style.top=h-hh-(h-hh)*(this.getValue()-this.getMinimum())/(this.getMaximum()-this.getMinimum())+"px";this.line.style.left=(w-lw)/2+"px";this.line.style.top=hh/2+"px";this.line.style.height=Math.max(0,h-hh-2)+"px";this.line.firstChild.style.height=Math.max(0,h-hh-4)+"px"}};Slider.prototype.ontimer=function(){var hw=this.handle.offsetWidth;var hh=this.handle.offsetHeight;var hl=this.handle.offsetLeft;var ht=this.handle.offsetTop;if(this._orientation=="horizontal"){if(this._mouseX>hl+hw&&(this._increasing==null||this._increasing)){this.setValue(this.getValue()+this.getBlockIncrement());this._increasing=true}else if(this._mouseX<hl&&(this._increasing==null||!this._increasing)){this.setValue(this.getValue()-this.getBlockIncrement());this._increasing=false}}else{if(this._mouseY>ht+hh&&(this._increasing==null||!this._increasing)){this.setValue(this.getValue()-this.getBlockIncrement());this._increasing=false}else if(this._mouseY<ht&&(this._increasing==null||this._increasing)){this.setValue(this.getValue()+this.getBlockIncrement());this._increasing=true}}this._timer.start()};(function(factory){"use strict";if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else if(typeof exports=="object"&&typeof module=="object"){module.exports=factory}else{factory(jQuery)}})(function($,undefined){"use strict";var defaultOpts={beforeShow:noop,move:noop,change:noop,show:noop,hide:noop,color:false,flat:false,showInput:false,allowEmpty:false,showButtons:true,clickoutFiresChange:true,showInitial:false,showPalette:false,showPaletteOnly:false,hideAfterPaletteSelect:false,togglePaletteOnly:false,showSelectionPalette:true,localStorageKey:false,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:false,className:"",containerClassName:"",replacerClassName:"",showAlpha:false,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:false,offset:null},spectrums=[],IE=!!/msie/i.exec(window.navigator.userAgent),rgbaSupport=function(){function contains(str,substr){return!!~(""+str).indexOf(substr)}var elem=document.createElement("div");var style=elem.style;style.cssText="background-color:rgba(0,0,0,.5)";return contains(style.backgroundColor,"rgba")||contains(style.backgroundColor,"hsla")}(),replaceInput=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),markup=function(){var gradientFix="";if(IE){for(var i=1;i<=6;i++){gradientFix+="<div class='sp-"+i+"'></div>"}}return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",gradientFix,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}();function paletteTemplate(p,color,className,opts){var html=[];for(var i=0;i<p.length;i++){var current=p[i];if(current){var tiny=tinycolor(current);var c=tiny.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";c+=tinycolor.equals(color,current)?" sp-thumb-active":"";var formattedString=tiny.toString(opts.preferredFormat||"rgb");var swatchStyle=rgbaSupport?"background-color:"+tiny.toRgbString():"filter:"+tiny.toFilter();html.push('<span title="'+formattedString+'" data-color="'+tiny.toRgbString()+'" class="'+c+'"><span class="sp-thumb-inner" style="'+swatchStyle+';" /></span>')}else{var cls="sp-clear-display";html.push($("<div />").append($('<span data-color="" style="background-color:transparent;" class="'+cls+'"></span>').attr("title",opts.noColorSelectedText)).html())}}return"<div class='sp-cf "+className+"'>"+html.join("")+"</div>"}function hideAll(){for(var i=0;i<spectrums.length;i++){if(spectrums[i]){spectrums[i].hide()}}}function instanceOptions(o,callbackContext){var opts=$.extend({},defaultOpts,o);opts.callbacks={move:bind(opts.move,callbackContext),change:bind(opts.change,callbackContext),show:bind(opts.show,callbackContext),hide:bind(opts.hide,callbackContext),beforeShow:bind(opts.beforeShow,callbackContext)};return opts}function spectrum(element,o){var opts=instanceOptions(o,element),flat=opts.flat,showSelectionPalette=opts.showSelectionPalette,localStorageKey=opts.localStorageKey,theme=opts.theme,callbacks=opts.callbacks,resize=throttle(reflow,10),visible=false,isDragging=false,dragWidth=0,dragHeight=0,dragHelperHeight=0,slideHeight=0,slideWidth=0,alphaWidth=0,alphaSlideHelperWidth=0,slideHelperHeight=0,currentHue=0,currentSaturation=0,currentValue=0,currentAlpha=1,palette=[],paletteArray=[],paletteLookup={},selectionPalette=opts.selectionPalette.slice(0),maxSelectionSize=opts.maxSelectionSize,draggingClass="sp-dragging",shiftMovementDirection=null;var doc=element.ownerDocument,body=doc.body,boundElement=$(element),disabled=false,container=$(markup,doc).addClass(theme),pickerContainer=container.find(".sp-picker-container"),dragger=container.find(".sp-color"),dragHelper=container.find(".sp-dragger"),slider=container.find(".sp-hue"),slideHelper=container.find(".sp-slider"),alphaSliderInner=container.find(".sp-alpha-inner"),alphaSlider=container.find(".sp-alpha"),alphaSlideHelper=container.find(".sp-alpha-handle"),textInput=container.find(".sp-input"),paletteContainer=container.find(".sp-palette"),initialColorContainer=container.find(".sp-initial"),cancelButton=container.find(".sp-cancel"),clearButton=container.find(".sp-clear"),chooseButton=container.find(".sp-choose"),toggleButton=container.find(".sp-palette-toggle"),isInput=boundElement.is("input"),isInputTypeColor=isInput&&boundElement.attr("type")==="color"&&inputTypeColorSupport(),shouldReplace=isInput&&!flat,replacer=shouldReplace?$(replaceInput).addClass(theme).addClass(opts.className).addClass(opts.replacerClassName):$([]),offsetElement=shouldReplace?replacer:boundElement,previewElement=replacer.find(".sp-preview-inner"),initialColor=opts.color||isInput&&boundElement.val(),colorOnShow=false,preferredFormat=opts.preferredFormat,currentPreferredFormat=preferredFormat,clickoutFiresChange=!opts.showButtons||opts.clickoutFiresChange,isEmpty=!initialColor,allowEmpty=opts.allowEmpty&&!isInputTypeColor;function applyOptions(){if(opts.showPaletteOnly){opts.showPalette=true}toggleButton.text(opts.showPaletteOnly?opts.togglePaletteMoreText:opts.togglePaletteLessText);if(opts.palette){palette=opts.palette.slice(0);paletteArray=$.isArray(palette[0])?palette:[palette];paletteLookup={};for(var i=0;i<paletteArray.length;i++){for(var j=0;j<paletteArray[i].length;j++){var rgb=tinycolor(paletteArray[i][j]).toRgbString();paletteLookup[rgb]=true}}}container.toggleClass("sp-flat",flat);container.toggleClass("sp-input-disabled",!opts.showInput);container.toggleClass("sp-alpha-enabled",opts.showAlpha);container.toggleClass("sp-clear-enabled",allowEmpty);container.toggleClass("sp-buttons-disabled",!opts.showButtons);container.toggleClass("sp-palette-buttons-disabled",!opts.togglePaletteOnly);container.toggleClass("sp-palette-disabled",!opts.showPalette);container.toggleClass("sp-palette-only",opts.showPaletteOnly);container.toggleClass("sp-initial-disabled",!opts.showInitial);container.addClass(opts.className).addClass(opts.containerClassName);reflow()}function initialize(){if(IE){container.find("*:not(input)").attr("unselectable","on")}applyOptions();if(shouldReplace){boundElement.after(replacer).hide()}if(!allowEmpty){clearButton.hide()}if(flat){boundElement.after(container).hide()}else{var appendTo=opts.appendTo==="parent"?boundElement.parent():$(opts.appendTo);if(appendTo.length!==1){appendTo=$("body")}appendTo.append(container)}updateSelectionPaletteFromStorage();offsetElement.bind("click.spectrum touchstart.spectrum",function(e){if(!disabled){toggle()}e.stopPropagation();if(!$(e.target).is("input")){e.preventDefault()}});if(boundElement.is(":disabled")||opts.disabled===true){disable()}container.click(stopPropagation);textInput.change(setFromTextInput);textInput.bind("paste",function(){setTimeout(setFromTextInput,1)});textInput.keydown(function(e){if(e.keyCode==13){setFromTextInput()}});cancelButton.text(opts.cancelText);cancelButton.bind("click.spectrum",function(e){e.stopPropagation();e.preventDefault();revert();hide()});clearButton.attr("title",opts.clearText);clearButton.bind("click.spectrum",function(e){e.stopPropagation();e.preventDefault();isEmpty=true;move();if(flat){updateOriginalInput(true)}});chooseButton.text(opts.chooseText);chooseButton.bind("click.spectrum",function(e){e.stopPropagation();e.preventDefault();if(IE&&textInput.is(":focus")){textInput.trigger("change")}if(isValid()){updateOriginalInput(true);hide()}});toggleButton.text(opts.showPaletteOnly?opts.togglePaletteMoreText:opts.togglePaletteLessText);toggleButton.bind("click.spectrum",function(e){e.stopPropagation();e.preventDefault();opts.showPaletteOnly=!opts.showPaletteOnly;if(!opts.showPaletteOnly&&!flat){container.css("left","-="+(pickerContainer.outerWidth(true)+5))}applyOptions()});draggable(alphaSlider,function(dragX,dragY,e){currentAlpha=dragX/alphaWidth;isEmpty=false;if(e.shiftKey){currentAlpha=Math.round(currentAlpha*10)/10}move()},dragStart,dragStop);draggable(slider,function(dragX,dragY){currentHue=parseFloat(dragY/slideHeight);isEmpty=false;if(!opts.showAlpha){currentAlpha=1}move()},dragStart,dragStop);draggable(dragger,function(dragX,dragY,e){if(!e.shiftKey){shiftMovementDirection=null}else if(!shiftMovementDirection){var oldDragX=currentSaturation*dragWidth;var oldDragY=dragHeight-currentValue*dragHeight;var furtherFromX=Math.abs(dragX-oldDragX)>Math.abs(dragY-oldDragY);shiftMovementDirection=furtherFromX?"x":"y"}var setSaturation=!shiftMovementDirection||shiftMovementDirection==="x";var setValue=!shiftMovementDirection||shiftMovementDirection==="y";if(setSaturation){currentSaturation=parseFloat(dragX/dragWidth)}if(setValue){currentValue=parseFloat((dragHeight-dragY)/dragHeight)}isEmpty=false;if(!opts.showAlpha){currentAlpha=1}move()},dragStart,dragStop);if(!!initialColor){set(initialColor);updateUI();currentPreferredFormat=preferredFormat||tinycolor(initialColor).format;addColorToSelectionPalette(initialColor)}else{updateUI()}if(flat){show()}function paletteElementClick(e){if(e.data&&e.data.ignore){set($(e.target).closest(".sp-thumb-el").data("color"));move()}else{set($(e.target).closest(".sp-thumb-el").data("color"));move();updateOriginalInput(true);if(opts.hideAfterPaletteSelect){hide()}}return false}var paletteEvent=IE?"mousedown.spectrum":"click.spectrum touchstart.spectrum";paletteContainer.delegate(".sp-thumb-el",paletteEvent,paletteElementClick);initialColorContainer.delegate(".sp-thumb-el:nth-child(1)",paletteEvent,{ignore:true},paletteElementClick)}function updateSelectionPaletteFromStorage(){if(localStorageKey&&window.localStorage){try{var oldPalette=window.localStorage[localStorageKey].split(",#");if(oldPalette.length>1){delete window.localStorage[localStorageKey];$.each(oldPalette,function(i,c){addColorToSelectionPalette(c)})}}catch(e){}try{selectionPalette=window.localStorage[localStorageKey].split(";")}catch(e){}}}function addColorToSelectionPalette(color){if(showSelectionPalette){var rgb=tinycolor(color).toRgbString();if(!paletteLookup[rgb]&&$.inArray(rgb,selectionPalette)===-1){selectionPalette.push(rgb);while(selectionPalette.length>maxSelectionSize){selectionPalette.shift()}}if(localStorageKey&&window.localStorage){try{window.localStorage[localStorageKey]=selectionPalette.join(";")}catch(e){}}}}function getUniqueSelectionPalette(){var unique=[];if(opts.showPalette){for(var i=0;i<selectionPalette.length;i++){var rgb=tinycolor(selectionPalette[i]).toRgbString();if(!paletteLookup[rgb]){unique.push(selectionPalette[i])}}}return unique.reverse().slice(0,opts.maxSelectionSize)}function drawPalette(){var currentColor=get();var html=$.map(paletteArray,function(palette,i){return paletteTemplate(palette,currentColor,"sp-palette-row sp-palette-row-"+i,opts)});updateSelectionPaletteFromStorage();if(selectionPalette){html.push(paletteTemplate(getUniqueSelectionPalette(),currentColor,"sp-palette-row sp-palette-row-selection",opts))}paletteContainer.html(html.join(""))}function drawInitial(){if(opts.showInitial){var initial=colorOnShow;var current=get();initialColorContainer.html(paletteTemplate([initial,current],current,"sp-palette-row-initial",opts))}}function dragStart(){if(dragHeight<=0||dragWidth<=0||slideHeight<=0){reflow()}isDragging=true;container.addClass(draggingClass);shiftMovementDirection=null;boundElement.trigger("dragstart.spectrum",[get()])}function dragStop(){isDragging=false;container.removeClass(draggingClass);boundElement.trigger("dragstop.spectrum",[get()])}function setFromTextInput(){var value=textInput.val();if((value===null||value==="")&&allowEmpty){set(null);updateOriginalInput(true)}else{var tiny=tinycolor(value);if(tiny.isValid()){set(tiny);updateOriginalInput(true)}else{textInput.addClass("sp-validation-error")}}}function toggle(){if(visible){hide()}else{show()}}function show(){var event=$.Event("beforeShow.spectrum");if(visible){reflow();return}boundElement.trigger(event,[get()]);if(callbacks.beforeShow(get())===false||event.isDefaultPrevented()){return}hideAll();visible=true;$(doc).bind("keydown.spectrum",onkeydown);$(doc).bind("click.spectrum",clickout);$(window).bind("resize.spectrum",resize);replacer.addClass("sp-active");container.removeClass("sp-hidden");reflow();updateUI();colorOnShow=get();drawInitial();callbacks.show(colorOnShow);boundElement.trigger("show.spectrum",[colorOnShow])}function onkeydown(e){if(e.keyCode===27){hide()}}function clickout(e){if(e.button==2){return}if(isDragging){return}if(clickoutFiresChange){updateOriginalInput(true)}else{revert()}hide()}function hide(){if(!visible||flat){return}visible=false;$(doc).unbind("keydown.spectrum",onkeydown);$(doc).unbind("click.spectrum",clickout);$(window).unbind("resize.spectrum",resize);replacer.removeClass("sp-active");container.addClass("sp-hidden");callbacks.hide(get());boundElement.trigger("hide.spectrum",[get()])}function revert(){set(colorOnShow,true)}function set(color,ignoreFormatChange){if(tinycolor.equals(color,get())){updateUI();return}var newColor,newHsv;if(!color&&allowEmpty){isEmpty=true}else{isEmpty=false;newColor=tinycolor(color);newHsv=newColor.toHsv();currentHue=newHsv.h%360/360;currentSaturation=newHsv.s;currentValue=newHsv.v;currentAlpha=newHsv.a}updateUI();if(newColor&&newColor.isValid()&&!ignoreFormatChange){currentPreferredFormat=preferredFormat||newColor.getFormat()}}function get(opts){opts=opts||{};if(allowEmpty&&isEmpty){return null}return tinycolor.fromRatio({h:currentHue,s:currentSaturation,v:currentValue,a:Math.round(currentAlpha*100)/100},{format:opts.format||currentPreferredFormat})}function isValid(){return!textInput.hasClass("sp-validation-error")}function move(){updateUI();callbacks.move(get());boundElement.trigger("move.spectrum",[get()])}function updateUI(){textInput.removeClass("sp-validation-error");updateHelperLocations();var flatColor=tinycolor.fromRatio({h:currentHue,s:1,v:1});dragger.css("background-color",flatColor.toHexString());var format=currentPreferredFormat;if(currentAlpha<1&&!(currentAlpha===0&&format==="name")){if(format==="hex"||format==="hex3"||format==="hex6"||format==="name"){format="rgb"}}var realColor=get({format:format}),displayColor="";previewElement.removeClass("sp-clear-display");previewElement.css("background-color","transparent");if(!realColor&&allowEmpty){previewElement.addClass("sp-clear-display")}else{var realHex=realColor.toHexString(),realRgb=realColor.toRgbString();if(rgbaSupport||realColor.alpha===1){previewElement.css("background-color",realRgb)}else{previewElement.css("background-color","transparent");previewElement.css("filter",realColor.toFilter())}if(opts.showAlpha){var rgb=realColor.toRgb();rgb.a=0;var realAlpha=tinycolor(rgb).toRgbString();var gradient="linear-gradient(left, "+realAlpha+", "+realHex+")";if(IE){alphaSliderInner.css("filter",tinycolor(realAlpha).toFilter({gradientType:1},realHex))}else{alphaSliderInner.css("background","-webkit-"+gradient);alphaSliderInner.css("background","-moz-"+gradient);alphaSliderInner.css("background","-ms-"+gradient);alphaSliderInner.css("background","linear-gradient(to right, "+realAlpha+", "+realHex+")")}}displayColor=realColor.toString(format)}if(opts.showInput){textInput.val(displayColor)}if(opts.showPalette){drawPalette()}drawInitial()}function updateHelperLocations(){var s=currentSaturation;var v=currentValue;if(allowEmpty&&isEmpty){alphaSlideHelper.hide();slideHelper.hide();dragHelper.hide()}else{alphaSlideHelper.show();slideHelper.show();dragHelper.show();var dragX=s*dragWidth;var dragY=dragHeight-v*dragHeight;dragX=Math.max(-dragHelperHeight,Math.min(dragWidth-dragHelperHeight,dragX-dragHelperHeight));dragY=Math.max(-dragHelperHeight,Math.min(dragHeight-dragHelperHeight,dragY-dragHelperHeight));dragHelper.css({top:dragY+"px",left:dragX+"px"});var alphaX=currentAlpha*alphaWidth;alphaSlideHelper.css({left:alphaX-alphaSlideHelperWidth/2+"px"});var slideY=currentHue*slideHeight;slideHelper.css({top:slideY-slideHelperHeight+"px"})}}function updateOriginalInput(fireCallback){var color=get(),displayColor="",hasChanged=!tinycolor.equals(color,colorOnShow);if(color){displayColor=color.toString(currentPreferredFormat);addColorToSelectionPalette(color)}if(isInput){boundElement.val(displayColor)}if(fireCallback&&hasChanged){callbacks.change(color);boundElement.trigger("change",[color])}}function reflow(){dragWidth=dragger.width();dragHeight=dragger.height();dragHelperHeight=dragHelper.height();slideWidth=slider.width();slideHeight=slider.height();slideHelperHeight=slideHelper.height();alphaWidth=alphaSlider.width();alphaSlideHelperWidth=alphaSlideHelper.width();if(!flat){container.css("position","absolute");if(opts.offset){container.offset(opts.offset)}else{container.offset(getOffset(container,offsetElement))}}updateHelperLocations();if(opts.showPalette){drawPalette()}boundElement.trigger("reflow.spectrum")}function destroy(){boundElement.show();offsetElement.unbind("click.spectrum touchstart.spectrum");container.remove();replacer.remove();spectrums[spect.id]=null}function option(optionName,optionValue){if(optionName===undefined){return $.extend({},opts)}if(optionValue===undefined){return opts[optionName]}opts[optionName]=optionValue;applyOptions()}function enable(){disabled=false;boundElement.attr("disabled",false);offsetElement.removeClass("sp-disabled")}function disable(){hide();disabled=true;boundElement.attr("disabled",true);offsetElement.addClass("sp-disabled")}function setOffset(coord){opts.offset=coord;reflow()}initialize();var spect={show:show,hide:hide,toggle:toggle,reflow:reflow,option:option,enable:enable,disable:disable,offset:setOffset,set:function(c){set(c);updateOriginalInput()},get:get,destroy:destroy,container:container};spect.id=spectrums.push(spect)-1;return spect}function getOffset(picker,input){var extraY=0;var dpWidth=picker.outerWidth();var dpHeight=picker.outerHeight();var inputHeight=input.outerHeight();var doc=picker[0].ownerDocument;var docElem=doc.documentElement;var viewWidth=docElem.clientWidth+$(doc).scrollLeft();var viewHeight=docElem.clientHeight+$(doc).scrollTop();var offset=input.offset();offset.top+=inputHeight;offset.left-=Math.min(offset.left,offset.left+dpWidth>viewWidth&&viewWidth>dpWidth?Math.abs(offset.left+dpWidth-viewWidth):0);offset.top-=Math.min(offset.top,offset.top+dpHeight>viewHeight&&viewHeight>dpHeight?Math.abs(dpHeight+inputHeight-extraY):extraY);return offset}function noop(){}function stopPropagation(e){e.stopPropagation()}function bind(func,obj){var slice=Array.prototype.slice;var args=slice.call(arguments,2);return function(){return func.apply(obj,args.concat(slice.call(arguments)))}}function draggable(element,onmove,onstart,onstop){onmove=onmove||function(){};onstart=onstart||function(){};onstop=onstop||function(){};var doc=document;var dragging=false;var offset={};var maxHeight=0;var maxWidth=0;var hasTouch="ontouchstart"in window;var duringDragEvents={};duringDragEvents["selectstart"]=prevent;duringDragEvents["dragstart"]=prevent;duringDragEvents["touchmove mousemove"]=move;duringDragEvents["touchend mouseup"]=stop;function prevent(e){if(e.stopPropagation){e.stopPropagation()}if(e.preventDefault){e.preventDefault()}e.returnValue=false}function move(e){if(dragging){if(IE&&doc.documentMode<9&&!e.button){return stop()}var t0=e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches[0];var pageX=t0&&t0.pageX||e.pageX;var pageY=t0&&t0.pageY||e.pageY;var dragX=Math.max(0,Math.min(pageX-offset.left,maxWidth));var dragY=Math.max(0,Math.min(pageY-offset.top,maxHeight));if(hasTouch){prevent(e)}onmove.apply(element,[dragX,dragY,e])}}function start(e){var rightclick=e.which?e.which==3:e.button==2;if(!rightclick&&!dragging){if(onstart.apply(element,arguments)!==false){dragging=true;maxHeight=$(element).height();maxWidth=$(element).width();offset=$(element).offset();$(doc).bind(duringDragEvents);$(doc.body).addClass("sp-dragging");move(e);prevent(e)}}}function stop(){if(dragging){$(doc).unbind(duringDragEvents);$(doc.body).removeClass("sp-dragging");setTimeout(function(){onstop.apply(element,arguments)},0)}dragging=false}$(element).bind("touchstart mousedown",start)}function throttle(func,wait,debounce){var timeout;return function(){var context=this,args=arguments;var throttler=function(){timeout=null;func.apply(context,args)};if(debounce)clearTimeout(timeout);if(debounce||!timeout)timeout=setTimeout(throttler,wait)}}function inputTypeColorSupport(){return $.fn.spectrum.inputTypeColorSupport()}var dataID="spectrum.id";$.fn.spectrum=function(opts,extra){if(typeof opts=="string"){var returnValue=this;var args=Array.prototype.slice.call(arguments,1);this.each(function(){var spect=spectrums[$(this).data(dataID)];if(spect){var method=spect[opts];if(!method){throw new Error("Spectrum: no such method: '"+opts+"'")}if(opts=="get"){returnValue=spect.get()}else if(opts=="container"){returnValue=spect.container}else if(opts=="option"){returnValue=spect.option.apply(spect,args)}else if(opts=="destroy"){spect.destroy();$(this).removeData(dataID)}else{method.apply(spect,args)}}});return returnValue}return this.spectrum("destroy").each(function(){var options=$.extend({},opts,$(this).data());var spect=spectrum(this,options);$(this).data(dataID,spect.id)})};$.fn.spectrum.load=true;$.fn.spectrum.loadOpts={};$.fn.spectrum.draggable=draggable;$.fn.spectrum.defaults=defaultOpts;$.fn.spectrum.inputTypeColorSupport=function inputTypeColorSupport(){if(typeof inputTypeColorSupport._cachedResult==="undefined"){var colorInput=$("<input type='color' value='!' />")[0];inputTypeColorSupport._cachedResult=colorInput.type==="color"&&colorInput.value!=="!"}return inputTypeColorSupport._cachedResult};$.spectrum={};$.spectrum.localization={};$.spectrum.palettes={};$.fn.spectrum.processNativeColorInputs=function(){var colorInputs=$("input[type=color]");if(colorInputs.length&&!inputTypeColorSupport()){colorInputs.spectrum({preferredFormat:"hex6"})}};(function(){var trimLeft=/^[\s,#]+/,trimRight=/\s+$/,tinyCounter=0,math=Math,mathRound=math.round,mathMin=math.min,mathMax=math.max,mathRandom=math.random;var tinycolor=function(color,opts){color=color?color:"";opts=opts||{};if(color instanceof tinycolor){return color}if(!(this instanceof tinycolor)){return new tinycolor(color,opts)}var rgb=inputToRGB(color);this._originalInput=color,this._r=rgb.r,this._g=rgb.g,this._b=rgb.b,this._a=rgb.a,this._roundA=mathRound(100*this._a)/100,this._format=opts.format||rgb.format;this._gradientType=opts.gradientType;if(this._r<1){this._r=mathRound(this._r)}if(this._g<1){this._g=mathRound(this._g)}if(this._b<1){this._b=mathRound(this._b)}this._ok=rgb.ok;this._tc_id=tinyCounter++};tinycolor.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var rgb=this.toRgb();return(rgb.r*299+rgb.g*587+rgb.b*114)/1e3},setAlpha:function(value){this._a=boundAlpha(value);this._roundA=mathRound(100*this._a)/100;return this},toHsv:function(){var hsv=rgbToHsv(this._r,this._g,this._b);return{h:hsv.h*360,s:hsv.s,v:hsv.v,a:this._a}},toHsvString:function(){var hsv=rgbToHsv(this._r,this._g,this._b);var h=mathRound(hsv.h*360),s=mathRound(hsv.s*100),v=mathRound(hsv.v*100);return this._a==1?"hsv("+h+", "+s+"%, "+v+"%)":"hsva("+h+", "+s+"%, "+v+"%, "+this._roundA+")"},toHsl:function(){var hsl=rgbToHsl(this._r,this._g,this._b);return{h:hsl.h*360,s:hsl.s,l:hsl.l,a:this._a}},toHslString:function(){var hsl=rgbToHsl(this._r,this._g,this._b);var h=mathRound(hsl.h*360),s=mathRound(hsl.s*100),l=mathRound(hsl.l*100);return this._a==1?"hsl("+h+", "+s+"%, "+l+"%)":"hsla("+h+", "+s+"%, "+l+"%, "+this._roundA+")"},toHex:function(allow3Char){return rgbToHex(this._r,this._g,this._b,allow3Char)},toHexString:function(allow3Char){return"#"+this.toHex(allow3Char)},toHex8:function(){return rgbaToHex(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:mathRound(this._r),g:mathRound(this._g),b:mathRound(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+mathRound(this._r)+", "+mathRound(this._g)+", "+mathRound(this._b)+")":"rgba("+mathRound(this._r)+", "+mathRound(this._g)+", "+mathRound(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:mathRound(bound01(this._r,255)*100)+"%",g:mathRound(bound01(this._g,255)*100)+"%",b:mathRound(bound01(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+mathRound(bound01(this._r,255)*100)+"%, "+mathRound(bound01(this._g,255)*100)+"%, "+mathRound(bound01(this._b,255)*100)+"%)":"rgba("+mathRound(bound01(this._r,255)*100)+"%, "+mathRound(bound01(this._g,255)*100)+"%, "+mathRound(bound01(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){if(this._a===0){return"transparent"}if(this._a<1){return false}return hexNames[rgbToHex(this._r,this._g,this._b,true)]||false},toFilter:function(secondColor){var hex8String="#"+rgbaToHex(this._r,this._g,this._b,this._a);var secondHex8String=hex8String;var gradientType=this._gradientType?"GradientType = 1, ":"";if(secondColor){var s=tinycolor(secondColor);secondHex8String=s.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+gradientType+"startColorstr="+hex8String+",endColorstr="+secondHex8String+")"},toString:function(format){var formatSet=!!format;format=format||this._format;var formattedString=false;var hasAlpha=this._a<1&&this._a>=0;var needsAlphaFormat=!formatSet&&hasAlpha&&(format==="hex"||format==="hex6"||format==="hex3"||format==="name");if(needsAlphaFormat){if(format==="name"&&this._a===0){return this.toName()}return this.toRgbString()}if(format==="rgb"){formattedString=this.toRgbString()}if(format==="prgb"){formattedString=this.toPercentageRgbString()}if(format==="hex"||format==="hex6"){formattedString=this.toHexString()}if(format==="hex3"){formattedString=this.toHexString(true)}if(format==="hex8"){formattedString=this.toHex8String()}if(format==="name"){formattedString=this.toName()}if(format==="hsl"){formattedString=this.toHslString()}if(format==="hsv"){formattedString=this.toHsvString()}return formattedString||this.toHexString()},_applyModification:function(fn,args){var color=fn.apply(null,[this].concat([].slice.call(args)));this._r=color._r;this._g=color._g;this._b=color._b;this.setAlpha(color._a);return this},lighten:function(){return this._applyModification(lighten,arguments)},brighten:function(){return this._applyModification(brighten,arguments)},darken:function(){return this._applyModification(darken,arguments)},desaturate:function(){return this._applyModification(desaturate,arguments)},saturate:function(){return this._applyModification(saturate,arguments)},greyscale:function(){return this._applyModification(greyscale,arguments)},spin:function(){return this._applyModification(spin,arguments)},_applyCombination:function(fn,args){return fn.apply(null,[this].concat([].slice.call(args)))},analogous:function(){return this._applyCombination(analogous,arguments)},complement:function(){return this._applyCombination(complement,arguments)},monochromatic:function(){return this._applyCombination(monochromatic,arguments)},splitcomplement:function(){return this._applyCombination(splitcomplement,arguments)},triad:function(){return this._applyCombination(triad,arguments)},tetrad:function(){return this._applyCombination(tetrad,arguments)}};tinycolor.fromRatio=function(color,opts){if(typeof color=="object"){var newColor={};for(var i in color){if(color.hasOwnProperty(i)){if(i==="a"){newColor[i]=color[i]}else{newColor[i]=convertToPercentage(color[i])}}}color=newColor}return tinycolor(color,opts)};function inputToRGB(color){var rgb={r:0,g:0,b:0};var a=1;var ok=false;var format=false;if(typeof color=="string"){color=stringInputToObject(color)}if(typeof color=="object"){if(color.hasOwnProperty("r")&&color.hasOwnProperty("g")&&color.hasOwnProperty("b")){rgb=rgbToRgb(color.r,color.g,color.b);ok=true;format=String(color.r).substr(-1)==="%"?"prgb":"rgb"}else if(color.hasOwnProperty("h")&&color.hasOwnProperty("s")&&color.hasOwnProperty("v")){color.s=convertToPercentage(color.s);color.v=convertToPercentage(color.v);rgb=hsvToRgb(color.h,color.s,color.v);ok=true;format="hsv"}else if(color.hasOwnProperty("h")&&color.hasOwnProperty("s")&&color.hasOwnProperty("l")){color.s=convertToPercentage(color.s);color.l=convertToPercentage(color.l);rgb=hslToRgb(color.h,color.s,color.l);ok=true;format="hsl"}if(color.hasOwnProperty("a")){a=color.a}}a=boundAlpha(a);return{ok:ok,format:color.format||format,r:mathMin(255,mathMax(rgb.r,0)),g:mathMin(255,mathMax(rgb.g,0)),b:mathMin(255,mathMax(rgb.b,0)),a:a}}function rgbToRgb(r,g,b){return{r:bound01(r,255)*255,g:bound01(g,255)*255,b:bound01(b,255)*255}}function rgbToHsl(r,g,b){r=bound01(r,255);g=bound01(g,255);b=bound01(b,255);var max=mathMax(r,g,b),min=mathMin(r,g,b);var h,s,l=(max+min)/2;if(max==min){h=s=0}else{var d=max-min;s=l>.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break}h/=6}return{h:h,s:s,l:l}}function hslToRgb(h,s,l){var r,g,b;h=bound01(h,360);s=bound01(s,100);l=bound01(l,100);function hue2rgb(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p}if(s===0){r=g=b=l}else{var q=l<.5?l*(1+s):l+s-l*s;var p=2*l-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3)}return{r:r*255,g:g*255,b:b*255}}function rgbToHsv(r,g,b){r=bound01(r,255);g=bound01(g,255);b=bound01(b,255);var max=mathMax(r,g,b),min=mathMin(r,g,b);var h,s,v=max;var d=max-min;s=max===0?0:d/max;if(max==min){h=0}else{switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break}h/=6}return{h:h,s:s,v:v}}function hsvToRgb(h,s,v){h=bound01(h,360)*6;s=bound01(s,100);v=bound01(v,100);var i=math.floor(h),f=h-i,p=v*(1-s),q=v*(1-f*s),t=v*(1-(1-f)*s),mod=i%6,r=[v,q,p,p,t,v][mod],g=[t,v,v,q,p,p][mod],b=[p,p,t,v,v,q][mod];return{r:r*255,g:g*255,b:b*255}}function rgbToHex(r,g,b,allow3Char){var hex=[pad2(mathRound(r).toString(16)),pad2(mathRound(g).toString(16)),pad2(mathRound(b).toString(16))];if(allow3Char&&hex[0].charAt(0)==hex[0].charAt(1)&&hex[1].charAt(0)==hex[1].charAt(1)&&hex[2].charAt(0)==hex[2].charAt(1)){return hex[0].charAt(0)+hex[1].charAt(0)+hex[2].charAt(0)}return hex.join("")}function rgbaToHex(r,g,b,a){var hex=[pad2(convertDecimalToHex(a)),pad2(mathRound(r).toString(16)),pad2(mathRound(g).toString(16)),pad2(mathRound(b).toString(16))];return hex.join("")}tinycolor.equals=function(color1,color2){if(!color1||!color2){return false}return tinycolor(color1).toRgbString()==tinycolor(color2).toRgbString()};tinycolor.random=function(){return tinycolor.fromRatio({r:mathRandom(),g:mathRandom(),b:mathRandom()})};function desaturate(color,amount){amount=amount===0?0:amount||10;var hsl=tinycolor(color).toHsl();hsl.s-=amount/100;hsl.s=clamp01(hsl.s);return tinycolor(hsl)}function saturate(color,amount){amount=amount===0?0:amount||10;var hsl=tinycolor(color).toHsl();hsl.s+=amount/100;hsl.s=clamp01(hsl.s);return tinycolor(hsl)}function greyscale(color){return tinycolor(color).desaturate(100)}function lighten(color,amount){amount=amount===0?0:amount||10;var hsl=tinycolor(color).toHsl();hsl.l+=amount/100;hsl.l=clamp01(hsl.l);return tinycolor(hsl)}function brighten(color,amount){amount=amount===0?0:amount||10;var rgb=tinycolor(color).toRgb();rgb.r=mathMax(0,mathMin(255,rgb.r-mathRound(255*-(amount/100))));rgb.g=mathMax(0,mathMin(255,rgb.g-mathRound(255*-(amount/100))));rgb.b=mathMax(0,mathMin(255,rgb.b-mathRound(255*-(amount/100))));return tinycolor(rgb)}function darken(color,amount){amount=amount===0?0:amount||10;var hsl=tinycolor(color).toHsl();hsl.l-=amount/100;hsl.l=clamp01(hsl.l);return tinycolor(hsl)}function spin(color,amount){var hsl=tinycolor(color).toHsl();var hue=(mathRound(hsl.h)+amount)%360;hsl.h=hue<0?360+hue:hue;return tinycolor(hsl)}function complement(color){var hsl=tinycolor(color).toHsl();hsl.h=(hsl.h+180)%360;return tinycolor(hsl)}function triad(color){var hsl=tinycolor(color).toHsl();var h=hsl.h;return[tinycolor(color),tinycolor({h:(h+120)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+240)%360,s:hsl.s,l:hsl.l})]}function tetrad(color){var hsl=tinycolor(color).toHsl();var h=hsl.h;return[tinycolor(color),tinycolor({h:(h+90)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+180)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+270)%360,s:hsl.s,l:hsl.l})]}function splitcomplement(color){var hsl=tinycolor(color).toHsl();var h=hsl.h;return[tinycolor(color),tinycolor({h:(h+72)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+216)%360,s:hsl.s,l:hsl.l})]}function analogous(color,results,slices){results=results||6;slices=slices||30;var hsl=tinycolor(color).toHsl();var part=360/slices;var ret=[tinycolor(color)];for(hsl.h=(hsl.h-(part*results>>1)+720)%360;--results;){hsl.h=(hsl.h+part)%360;ret.push(tinycolor(hsl))}return ret}function monochromatic(color,results){results=results||6;var hsv=tinycolor(color).toHsv();var h=hsv.h,s=hsv.s,v=hsv.v;var ret=[];var modification=1/results;while(results--){ret.push(tinycolor({h:h,s:s,v:v}));v=(v+modification)%1}return ret}tinycolor.mix=function(color1,color2,amount){amount=amount===0?0:amount||50;var rgb1=tinycolor(color1).toRgb();var rgb2=tinycolor(color2).toRgb();var p=amount/100;var w=p*2-1;var a=rgb2.a-rgb1.a;var w1;if(w*a==-1){w1=w}else{w1=(w+a)/(1+w*a)}w1=(w1+1)/2;var w2=1-w1;var rgba={r:rgb2.r*w1+rgb1.r*w2,g:rgb2.g*w1+rgb1.g*w2,b:rgb2.b*w1+rgb1.b*w2,a:rgb2.a*p+rgb1.a*(1-p)};return tinycolor(rgba)};tinycolor.readability=function(color1,color2){var c1=tinycolor(color1);var c2=tinycolor(color2);var rgb1=c1.toRgb();var rgb2=c2.toRgb();var brightnessA=c1.getBrightness();var brightnessB=c2.getBrightness();var colorDiff=Math.max(rgb1.r,rgb2.r)-Math.min(rgb1.r,rgb2.r)+Math.max(rgb1.g,rgb2.g)-Math.min(rgb1.g,rgb2.g)+Math.max(rgb1.b,rgb2.b)-Math.min(rgb1.b,rgb2.b);return{brightness:Math.abs(brightnessA-brightnessB),color:colorDiff}};tinycolor.isReadable=function(color1,color2){var readability=tinycolor.readability(color1,color2);return readability.brightness>125&&readability.color>500};tinycolor.mostReadable=function(baseColor,colorList){var bestColor=null;var bestScore=0;var bestIsReadable=false;for(var i=0;i<colorList.length;i++){var readability=tinycolor.readability(baseColor,colorList[i]);var readable=readability.brightness>125&&readability.color>500;var score=3*(readability.brightness/125)+readability.color/500;if(readable&&!bestIsReadable||readable&&bestIsReadable&&score>bestScore||!readable&&!bestIsReadable&&score>bestScore){bestIsReadable=readable;bestScore=score;bestColor=tinycolor(colorList[i])}}return bestColor};var names=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var hexNames=tinycolor.hexNames=flip(names);function flip(o){var flipped={};for(var i in o){if(o.hasOwnProperty(i)){flipped[o[i]]=i}}return flipped}function boundAlpha(a){a=parseFloat(a);if(isNaN(a)||a<0||a>1){a=1}return a}function bound01(n,max){if(isOnePointZero(n)){n="100%"}var processPercent=isPercentage(n);n=mathMin(max,mathMax(0,parseFloat(n)));if(processPercent){n=parseInt(n*max,10)/100}if(math.abs(n-max)<1e-6){return 1}return n%max/parseFloat(max)}function clamp01(val){return mathMin(1,mathMax(0,val))}function parseIntFromHex(val){return parseInt(val,16)}function isOnePointZero(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1}function isPercentage(n){return typeof n==="string"&&n.indexOf("%")!=-1}function pad2(c){return c.length==1?"0"+c:""+c}function convertToPercentage(n){if(n<=1){n=n*100+"%"}return n}function convertDecimalToHex(d){return Math.round(parseFloat(d)*255).toString(16)}function convertHexToDecimal(h){return parseIntFromHex(h)/255}var matchers=function(){var CSS_INTEGER="[-\\+]?\\d+%?";var CSS_NUMBER="[-\\+]?\\d*\\.\\d+%?";var CSS_UNIT="(?:"+CSS_NUMBER+")|(?:"+CSS_INTEGER+")";var PERMISSIVE_MATCH3="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?";var PERMISSIVE_MATCH4="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?";return{rgb:new RegExp("rgb"+PERMISSIVE_MATCH3),rgba:new RegExp("rgba"+PERMISSIVE_MATCH4),hsl:new RegExp("hsl"+PERMISSIVE_MATCH3),hsla:new RegExp("hsla"+PERMISSIVE_MATCH4),hsv:new RegExp("hsv"+PERMISSIVE_MATCH3),hsva:new RegExp("hsva"+PERMISSIVE_MATCH4),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function stringInputToObject(color){color=color.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var named=false;if(names[color]){color=names[color];named=true}else if(color=="transparent"){return{r:0,g:0,b:0,a:0,format:"name"}}var match;if(match=matchers.rgb.exec(color)){return{r:match[1],g:match[2],b:match[3]}}if(match=matchers.rgba.exec(color)){return{r:match[1],g:match[2],b:match[3],a:match[4]}}if(match=matchers.hsl.exec(color)){return{h:match[1],s:match[2],l:match[3]}}if(match=matchers.hsla.exec(color)){return{h:match[1],s:match[2],l:match[3],a:match[4]}}if(match=matchers.hsv.exec(color)){return{h:match[1],s:match[2],v:match[3]}}if(match=matchers.hsva.exec(color)){return{h:match[1],s:match[2],v:match[3],a:match[4]}}if(match=matchers.hex8.exec(color)){return{a:convertHexToDecimal(match[1]),r:parseIntFromHex(match[2]),g:parseIntFromHex(match[3]),b:parseIntFromHex(match[4]),format:named?"name":"hex8"}}if(match=matchers.hex6.exec(color)){return{r:parseIntFromHex(match[1]),g:parseIntFromHex(match[2]),b:parseIntFromHex(match[3]),format:named?"name":"hex"}}if(match=matchers.hex3.exec(color)){return{r:parseIntFromHex(match[1]+""+match[1]),g:parseIntFromHex(match[2]+""+match[2]),b:parseIntFromHex(match[3]+""+match[3]),format:named?"name":"hex"}}return false}window.tinycolor=tinycolor})();$(function(){if($.fn.spectrum.load){$.fn.spectrum.processNativeColorInputs()}})});!function(e,t,n){"use strict";!function o(e,t,n){function a(s,l){if(!t[s]){if(!e[s]){var i="function"==typeof require&&require;if(!l&&i)return i(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=t[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return a(n?n:t)},c,c.exports,o,e,t,n)}return t[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)a(n[s]);return a}({1:[function(o){var a,r,s,l,i=function(e){return e&&e.__esModule?e:{default:e}},u=o("./modules/handle-dom"),c=o("./modules/utils"),d=o("./modules/handle-swal-dom"),f=o("./modules/handle-click"),p=o("./modules/handle-key"),m=i(p),v=o("./modules/default-params"),y=i(v),h=o("./modules/set-params"),g=i(h);s=l=function(){function o(e){var t=s;return t[e]===n?y["default"][e]:t[e]}var s=arguments[0];if(u.addClass(t.body,"stop-scrolling"),d.resetInput(),s===n)return c.logStr("SweetAlert expects at least 1 attribute!"),!1;var i=c.extend({},y["default"]);switch(typeof s){case"string":i.title=s,i.text=arguments[1]||"",i.type=arguments[2]||"";break;case"object":if(s.title===n)return c.logStr('Missing "title" argument!'),!1;i.title=s.title;for(var p in y["default"])i[p]=o(p);i.confirmButtonText=i.showCancelButton?"Confirm":y["default"].confirmButtonText,i.confirmButtonText=o("confirmButtonText"),i.doneFunction=arguments[1]||null;break;default:return c.logStr('Unexpected type of argument! Expected "string" or "object", got '+typeof s),!1}g["default"](i),d.fixVerticalPosition(),d.openModal(arguments[1]);for(var v=d.getModal(),h=v.querySelectorAll("button"),b=["onclick","onmouseover","onmouseout","onmousedown","onmouseup","onfocus"],w=function(e){return f.handleButton(e,i,v)},C=0;C<h.length;C++)for(var S=0;S<b.length;S++){var x=b[S];h[C][x]=w}d.getOverlay().onclick=w,a=e.onkeydown;var k=function(e){return m["default"](e,i,v)};e.onkeydown=k,e.onfocus=function(){setTimeout(function(){r!==n&&(r.focus(),r=n)},0)},l.enableButtons()},s.setDefaults=l.setDefaults=function(e){if(!e)throw new Error("userParams is required");if("object"!=typeof e)throw new Error("userParams has to be a object");c.extend(y["default"],e)},s.close=l.close=function(){var o=d.getModal();u.fadeOut(d.getOverlay(),5),u.fadeOut(o,5),u.removeClass(o,"showSweetAlert"),u.addClass(o,"hideSweetAlert"),u.removeClass(o,"visible");var s=o.querySelector(".sa-icon.sa-success");u.removeClass(s,"animate"),u.removeClass(s.querySelector(".sa-tip"),"animateSuccessTip"),u.removeClass(s.querySelector(".sa-long"),"animateSuccessLong");var l=o.querySelector(".sa-icon.sa-error");u.removeClass(l,"animateErrorIcon"),u.removeClass(l.querySelector(".sa-x-mark"),"animateXMark");var i=o.querySelector(".sa-icon.sa-warning");return u.removeClass(i,"pulseWarning"),u.removeClass(i.querySelector(".sa-body"),"pulseWarningIns"),u.removeClass(i.querySelector(".sa-dot"),"pulseWarningIns"),setTimeout(function(){var e=o.getAttribute("data-custom-class");u.removeClass(o,e)},300),u.removeClass(t.body,"stop-scrolling"),e.onkeydown=a,e.previousActiveElement&&e.previousActiveElement.focus(),r=n,clearTimeout(o.timeout),!0},s.showInputError=l.showInputError=function(e){var t=d.getModal(),n=t.querySelector(".sa-input-error");u.addClass(n,"show");var o=t.querySelector(".sa-error-container");u.addClass(o,"show"),o.querySelector("p").innerHTML=e,setTimeout(function(){s.enableButtons()},1),t.querySelector("input").focus()},s.resetInputError=l.resetInputError=function(e){if(e&&13===e.keyCode)return!1;var t=d.getModal(),n=t.querySelector(".sa-input-error");u.removeClass(n,"show");var o=t.querySelector(".sa-error-container");u.removeClass(o,"show")},s.disableButtons=l.disableButtons=function(){var e=d.getModal(),t=e.querySelector("button.confirm"),n=e.querySelector("button.cancel");t.disabled=!0,n.disabled=!0},s.enableButtons=l.enableButtons=function(){var e=d.getModal(),t=e.querySelector("button.confirm"),n=e.querySelector("button.cancel");t.disabled=!1,n.disabled=!1},"undefined"!=typeof e?e.sweetAlert=e.swal=s:c.logStr("SweetAlert is a frontend module!")},{"./modules/default-params":2,"./modules/handle-click":3,"./modules/handle-dom":4,"./modules/handle-key":5,"./modules/handle-swal-dom":6,"./modules/set-params":8,"./modules/utils":9}],2:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var o={title:"",text:"",type:null,allowOutsideClick:!1,showConfirmButton:!0,showCancelButton:!1,closeOnConfirm:!0,closeOnCancel:!0,confirmButtonText:"OK",confirmButtonColor:"#8CD4F5",cancelButtonText:"Cancel",imageUrl:null,imageSize:null,timer:null,customClass:"",html:!1,animation:!0,allowEscapeKey:!0,inputType:"text",inputPlaceholder:"",inputValue:"",showLoaderOnConfirm:!1};n["default"]=o,t.exports=n["default"]},{}],3:[function(t,n,o){Object.defineProperty(o,"__esModule",{value:!0});var a=t("./utils"),r=(t("./handle-swal-dom"),t("./handle-dom")),s=function(t,n,o){function s(e){m&&n.confirmButtonColor&&(p.style.backgroundColor=e)}var u,c,d,f=t||e.event,p=f.target||f.srcElement,m=-1!==p.className.indexOf("confirm"),v=-1!==p.className.indexOf("sweet-overlay"),y=r.hasClass(o,"visible"),h=n.doneFunction&&"true"===o.getAttribute("data-has-done-function");switch(m&&n.confirmButtonColor&&(u=n.confirmButtonColor,c=a.colorLuminance(u,-.04),d=a.colorLuminance(u,-.14)),f.type){case"mouseover":s(c);break;case"mouseout":s(u);break;case"mousedown":s(d);break;case"mouseup":s(c);break;case"focus":var g=o.querySelector("button.confirm"),b=o.querySelector("button.cancel");m?b.style.boxShadow="none":g.style.boxShadow="none";break;case"click":var w=o===p,C=r.isDescendant(o,p);if(!w&&!C&&y&&!n.allowOutsideClick)break;m&&h&&y?l(o,n):h&&y||v?i(o,n):r.isDescendant(o,p)&&"BUTTON"===p.tagName&&sweetAlert.close()}},l=function(e,t){var n=!0;r.hasClass(e,"show-input")&&(n=e.querySelector("input").value,n||(n="")),t.doneFunction(n),t.closeOnConfirm&&sweetAlert.close(),t.showLoaderOnConfirm&&sweetAlert.disableButtons()},i=function(e,t){var n=String(t.doneFunction).replace(/\s/g,""),o="function("===n.substring(0,9)&&")"!==n.substring(9,10);o&&t.doneFunction(!1),t.closeOnCancel&&sweetAlert.close()};o["default"]={handleButton:s,handleConfirm:l,handleCancel:i},n.exports=o["default"]},{"./handle-dom":4,"./handle-swal-dom":6,"./utils":9}],4:[function(n,o,a){Object.defineProperty(a,"__esModule",{value:!0});var r=function(e,t){return new RegExp(" "+t+" ").test(" "+e.className+" ")},s=function(e,t){r(e,t)||(e.className+=" "+t)},l=function(e,t){var n=" "+e.className.replace(/[\t\r\n]/g," ")+" ";if(r(e,t)){for(;n.indexOf(" "+t+" ")>=0;)n=n.replace(" "+t+" "," ");e.className=n.replace(/^\s+|\s+$/g,"")}},i=function(e){var n=t.createElement("div");return n.appendChild(t.createTextNode(e)),n.innerHTML},u=function(e){e.style.opacity="",e.style.display="block"},c=function(e){if(e&&!e.length)return u(e);for(var t=0;t<e.length;++t)u(e[t])},d=function(e){e.style.opacity="",e.style.display="none"},f=function(e){if(e&&!e.length)return d(e);for(var t=0;t<e.length;++t)d(e[t])},p=function(e,t){for(var n=t.parentNode;null!==n;){if(n===e)return!0;n=n.parentNode}return!1},m=function(e){e.style.left="-9999px",e.style.display="block";var t,n=e.clientHeight;return t="undefined"!=typeof getComputedStyle?parseInt(getComputedStyle(e).getPropertyValue("padding-top"),10):parseInt(e.currentStyle.padding),e.style.left="",e.style.display="none","-"+parseInt((n+t)/2)+"px"},v=function(e,t){if(+e.style.opacity<1){t=t||16,e.style.opacity=0,e.style.display="block";var n=+new Date,o=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){e.style.opacity=+e.style.opacity+(new Date-n)/100,n=+new Date,+e.style.opacity<1&&setTimeout(o,t)});o()}e.style.display="block"},y=function(e,t){t=t||16,e.style.opacity=1;var n=+new Date,o=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){e.style.opacity=+e.style.opacity-(new Date-n)/100,n=+new Date,+e.style.opacity>0?setTimeout(o,t):e.style.display="none"});o()},h=function(n){if("function"==typeof MouseEvent){var o=new MouseEvent("click",{view:e,bubbles:!1,cancelable:!0});n.dispatchEvent(o)}else if(t.createEvent){var a=t.createEvent("MouseEvents");a.initEvent("click",!1,!1),n.dispatchEvent(a)}else t.createEventObject?n.fireEvent("onclick"):"function"==typeof n.onclick&&n.onclick()},g=function(t){"function"==typeof t.stopPropagation?(t.stopPropagation(),t.preventDefault()):e.event&&e.event.hasOwnProperty("cancelBubble")&&(e.event.cancelBubble=!0)};a.hasClass=r,a.addClass=s,a.removeClass=l,a.escapeHtml=i,a._show=u,a.show=c,a._hide=d,a.hide=f,a.isDescendant=p,a.getTopMargin=m,a.fadeIn=v,a.fadeOut=y,a.fireClick=h,a.stopEventPropagation=g},{}],5:[function(t,o,a){Object.defineProperty(a,"__esModule",{value:!0});var r=t("./handle-dom"),s=t("./handle-swal-dom"),l=function(t,o,a){var l=t||e.event,i=l.keyCode||l.which,u=a.querySelector("button.confirm"),c=a.querySelector("button.cancel"),d=a.querySelectorAll("button[tabindex]");if(-1!==[9,13,32,27].indexOf(i)){for(var f=l.target||l.srcElement,p=-1,m=0;m<d.length;m++)if(f===d[m]){p=m;break}9===i?(f=-1===p?u:p===d.length-1?d[0]:d[p+1],r.stopEventPropagation(l),f.focus(),o.confirmButtonColor&&s.setFocusStyle(f,o.confirmButtonColor)):13===i?("INPUT"===f.tagName&&(f=u,u.focus()),f=-1===p?u:n):27===i&&o.allowEscapeKey===!0?(f=c,r.fireClick(f,l)):f=n}};a["default"]=l,o.exports=a["default"]},{"./handle-dom":4,"./handle-swal-dom":6}],6:[function(n,o,a){var r=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(a,"__esModule",{value:!0});var s=n("./utils"),l=n("./handle-dom"),i=n("./default-params"),u=r(i),c=n("./injected-html"),d=r(c),f=".sweet-alert",p=".sweet-overlay",m=function(){var e=t.createElement("div");for(e.innerHTML=d["default"];e.firstChild;)t.body.appendChild(e.firstChild)},v=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=t.querySelector(f);return e||(m(),e=v()),e}),y=function(){var e=v();return e?e.querySelector("input"):void 0},h=function(){return t.querySelector(p)},g=function(e,t){var n=s.hexToRgb(t);e.style.boxShadow="0 0 2px rgba("+n+", 0.8), inset 0 0 0 1px rgba(0, 0, 0, 0.05)"},b=function(n){var o=v();l.fadeIn(h(),10),l.show(o),l.addClass(o,"showSweetAlert"),l.removeClass(o,"hideSweetAlert"),e.previousActiveElement=t.activeElement;var a=o.querySelector("button.confirm");a.focus(),setTimeout(function(){l.addClass(o,"visible")},500);var r=o.getAttribute("data-timer");if("null"!==r&&""!==r){var s=n;o.timeout=setTimeout(function(){var e=(s||null)&&"true"===o.getAttribute("data-has-done-function");e?s(null):sweetAlert.close()},r)}},w=function(){var e=v(),t=y();l.removeClass(e,"show-input"),t.value=u["default"].inputValue,t.setAttribute("type",u["default"].inputType),t.setAttribute("placeholder",u["default"].inputPlaceholder),C()},C=function(e){if(e&&13===e.keyCode)return!1;var t=v(),n=t.querySelector(".sa-input-error");l.removeClass(n,"show");var o=t.querySelector(".sa-error-container");l.removeClass(o,"show")},S=function(){var e=v();e.style.marginTop=l.getTopMargin(v())};a.sweetAlertInitialize=m,a.getModal=v,a.getOverlay=h,a.getInput=y,a.setFocusStyle=g,a.openModal=b,a.resetInput=w,a.resetInputError=C,a.fixVerticalPosition=S},{"./default-params":2,"./handle-dom":4,"./injected-html":7,"./utils":9}],7:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var o='<div class="sweet-overlay" tabIndex="-1"></div><div class="sweet-alert"><div class="sa-icon sa-error">\n      <span class="sa-x-mark">\n        <span class="sa-line sa-left"></span>\n        <span class="sa-line sa-right"></span>\n      </span>\n    </div><div class="sa-icon sa-warning">\n      <span class="sa-body"></span>\n      <span class="sa-dot"></span>\n    </div><div class="sa-icon sa-info"></div><div class="sa-icon sa-success">\n      <span class="sa-line sa-tip"></span>\n      <span class="sa-line sa-long"></span>\n\n      <div class="sa-placeholder"></div>\n      <div class="sa-fix"></div>\n    </div><div class="sa-icon sa-custom"></div><h2>Title</h2>\n    <p>Text</p>\n    <fieldset>\n      <input type="text" tabIndex="3" />\n      <div class="sa-input-error"></div>\n    </fieldset><div class="sa-error-container">\n      <div class="icon">!</div>\n      <p>Not valid!</p>\n    </div><div class="sa-button-container">\n      <button class="cancel" tabIndex="2">Cancel</button>\n      <div class="sa-confirm-button-container">\n        <button class="confirm" tabIndex="1">OK</button><div class="la-ball-fall">\n          <div></div>\n          <div></div>\n          <div></div>\n        </div>\n      </div>\n    </div></div>';n["default"]=o,t.exports=n["default"]},{}],8:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0});var a=e("./utils"),r=e("./handle-swal-dom"),s=e("./handle-dom"),l=["error","warning","info","success","input","prompt"],i=function(e){var t=r.getModal(),o=t.querySelector("h2"),i=t.querySelector("p"),u=t.querySelector("button.cancel"),c=t.querySelector("button.confirm");if(o.innerHTML=e.html?e.title:s.escapeHtml(e.title).split("\n").join("<br>"),i.innerHTML=e.html?e.text:s.escapeHtml(e.text||"").split("\n").join("<br>"),e.text&&s.show(i),e.customClass)s.addClass(t,e.customClass),t.setAttribute("data-custom-class",e.customClass);else{var d=t.getAttribute("data-custom-class");s.removeClass(t,d),t.setAttribute("data-custom-class","")}if(s.hide(t.querySelectorAll(".sa-icon")),e.type&&!a.isIE8()){var f=function(){for(var o=!1,a=0;a<l.length;a++)if(e.type===l[a]){o=!0;break}if(!o)return logStr("Unknown alert type: "+e.type),{v:!1};var i=["success","error","warning","info"],u=n;-1!==i.indexOf(e.type)&&(u=t.querySelector(".sa-icon.sa-"+e.type),s.show(u));var c=r.getInput();switch(e.type){case"success":s.addClass(u,"animate"),s.addClass(u.querySelector(".sa-tip"),"animateSuccessTip"),s.addClass(u.querySelector(".sa-long"),"animateSuccessLong");break;case"error":s.addClass(u,"animateErrorIcon"),s.addClass(u.querySelector(".sa-x-mark"),"animateXMark");break;case"warning":s.addClass(u,"pulseWarning"),s.addClass(u.querySelector(".sa-body"),"pulseWarningIns"),s.addClass(u.querySelector(".sa-dot"),"pulseWarningIns");break;case"input":case"prompt":c.setAttribute("type",e.inputType),c.value=e.inputValue,c.setAttribute("placeholder",e.inputPlaceholder),s.addClass(t,"show-input"),setTimeout(function(){c.focus(),c.addEventListener("keyup",swal.resetInputError)},400)}}();if("object"==typeof f)return f.v}if(e.imageUrl){var p=t.querySelector(".sa-icon.sa-custom");p.style.backgroundImage="url("+e.imageUrl+")",s.show(p);var m=80,v=80;if(e.imageSize){var y=e.imageSize.toString().split("x"),h=y[0],g=y[1];h&&g?(m=h,v=g):logStr("Parameter imageSize expects value with format WIDTHxHEIGHT, got "+e.imageSize)}p.setAttribute("style",p.getAttribute("style")+"width:"+m+"px; height:"+v+"px")}t.setAttribute("data-has-cancel-button",e.showCancelButton),e.showCancelButton?u.style.display="inline-block":s.hide(u),t.setAttribute("data-has-confirm-button",e.showConfirmButton),e.showConfirmButton?c.style.display="inline-block":s.hide(c),e.cancelButtonText&&(u.innerHTML=s.escapeHtml(e.cancelButtonText)),e.confirmButtonText&&(c.innerHTML=s.escapeHtml(e.confirmButtonText)),e.confirmButtonColor&&(c.style.backgroundColor=e.confirmButtonColor,c.style.borderLeftColor=e.confirmLoadingButtonColor,c.style.borderRightColor=e.confirmLoadingButtonColor,r.setFocusStyle(c,e.confirmButtonColor)),t.setAttribute("data-allow-outside-click",e.allowOutsideClick);var b=e.doneFunction?!0:!1;t.setAttribute("data-has-done-function",b),e.animation?"string"==typeof e.animation?t.setAttribute("data-animation",e.animation):t.setAttribute("data-animation","pop"):t.setAttribute("data-animation","none"),t.setAttribute("data-timer",e.timer)};o["default"]=i,t.exports=o["default"]},{"./handle-dom":4,"./handle-swal-dom":6,"./utils":9}],9:[function(t,n,o){Object.defineProperty(o,"__esModule",{value:!0});var a=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},r=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?parseInt(t[1],16)+", "+parseInt(t[2],16)+", "+parseInt(t[3],16):null},s=function(){return e.attachEvent&&!e.addEventListener},l=function(t){e.console&&e.console.log("SweetAlert: "+t)},i=function(e,t){e=String(e).replace(/[^0-9a-f]/gi,""),e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var n,o,a="#";for(o=0;3>o;o++)n=parseInt(e.substr(2*o,2),16),n=Math.round(Math.min(Math.max(0,n+n*t),255)).toString(16),a+=("00"+n).substr(n.length);return a};o.extend=a,o.hexToRgb=r,o.isIE8=s,o.logStr=l,o.colorLuminance=i},{}]},{},[1]),"function"==typeof define&&define.amd?define(function(){return sweetAlert}):"undefined"!=typeof module&&module.exports&&(module.exports=sweetAlert)}(window,document);function Timer(nPauseTime){this._pauseTime=typeof nPauseTime=="undefined"?1e3:nPauseTime;this._timer=null;this._isStarted=false}Timer.prototype.start=function(){if(this.isStarted())this.stop();var oThis=this;this._timer=window.setTimeout(function(){if(typeof oThis.ontimer=="function")oThis.ontimer()},this._pauseTime);this._isStarted=false};Timer.prototype.stop=function(){if(this._timer!=null)window.clearTimeout(this._timer);this._isStarted=false};Timer.prototype.isStarted=function(){return this._isStarted};Timer.prototype.getPauseTime=function(){return this._pauseTime};Timer.prototype.setPauseTime=function(nPauseTime){this._pauseTime=nPauseTime};var doubletaptimer=0;var touch_start_x;var touch_start_y;var map_select_setting_enabled=true;var map_select_check=false;var map_select_check_started=0;var map_select_active=false;var map_select_x;var map_select_y;var mouse_touch_started_on_unit=false;var mouse_click_mod_key={shiftKey:false};var dblclick_count=0;var dblclick_timeout=0;var num_suppressions=navigator.userAgent.indexOf("Chrome")!==-1?2:0;var suppress_touch_move=num_suppressions;function mapctrl_init_2d(){$("#canvas").mouseup(mapview_mouse_click);$("#canvas").mousedown(mapview_mouse_down);$(window).mousemove(mouse_moved_cb);if(is_touch_device()){$("#canvas").bind("touchstart",mapview_touch_start);$("#canvas").bind("touchend",mapview_touch_end);$("#canvas").bind("touchmove",mapview_touch_move)}}function mapview_mouse_click(e){var rightclick=false;var middleclick=false;mouse_click_mod_key=e;if(e.which){rightclick=e.which==3;middleclick=e.which==2}else if(e.button){rightclick=e.button==2;middleclick=e.button==1||e.button==4}if(rightclick){if(mouse_click_mod_key.shiftKey&&mouse_click_mod_key.ctrlKey&&!mouse_click_mod_key.altKey){paste_tile_target_for_prod(mouse_x,mouse_y)}else if(mouse_click_mod_key.shiftKey&&!mouse_click_mod_key.ctrlKey&&!mouse_click_mod_key.altKey){copy_tile_target_for_prod(mouse_x,mouse_y)}else if(mouse_click_mod_key.altKey&&mouse_click_mod_key.ctrlKey){key_paste_link_under_cursor()}else if(!e.shiftKey&&!e.altKey&&!e.ctrlKey&&(!map_select_active||!map_select_setting_enabled)){context_menu_active=true;recenter_button_pressed(mouse_x,mouse_y)}else{context_menu_active=false;map_select_units(mouse_x,mouse_y)}map_select_active=false;map_select_check=false}else if(!middleclick){if(map_select_active){context_menu_active=false;map_select_units(mouse_x,mouse_y);map_select_active=false;map_select_check=false;mapview_mouse_movement=false}else{action_button_pressed(mouse_x,mouse_y,SELECT_POPUP);mapview_mouse_movement=false;update_mouse_cursor()}}keyboard_input=true}function mapview_mouse_down(e){if(touch_device){if($(".context-menu-list").is(":visible")){mouse_touch_started_on_unit=false;context_menu_active=true;came_from_context_menu=false;mapview_mouse_movement=false;real_mouse_move_mode=false;touch_drag_mode=false;return}}else if($(".context-menu-list").is(":visible")){mouse_touch_started_on_unit=false;context_menu_active=true;came_from_context_menu=false;mapview_mouse_movement=false;real_mouse_move_mode=false;return}var rightclick=false;var middleclick=false;mouse_click_mod_key=e;if(e.which){rightclick=e.which==3;middleclick=e.which==2}else if(e.button){rightclick=e.button==2;middleclick=e.button==1||e.button==4}if(!rightclick&&!middleclick){if(user_marking_mode)return;if(e.altKey&&!map_select_active&&is_right_mouse_selection_supported()){map_select_check=true;map_select_x=mouse_x;map_select_y=mouse_y;map_select_check_started=(new Date).getTime();context_menu_active=false;return}if(action_tgt_sel_active)return;if(goto_active)return;if(paradrop_active)return;set_mouse_touch_started_on_unit(canvas_pos_to_tile(mouse_x,mouse_y));if(!mouse_click_mod_key["shiftKey"]){check_mouse_drag_unit(canvas_pos_to_tile(mouse_x,mouse_y));if(!map_select_check&&!mouse_touch_started_on_unit&&map_drag_enabled&&!came_from_context_menu){mapview_mouse_movement=true}}touch_start_x=mouse_x;touch_start_y=mouse_y}else if(rightclick&&e.altKey&&e.ctrlKey){context_menu_active=false;return false}else if(middleclick||e["altKey"]){if(!e["ctrlKey"]){popit();context_menu_active=false;return false}}else if(rightclick&&!map_select_active&&is_right_mouse_selection_supported()){map_select_check=true;map_select_x=mouse_x;map_select_y=mouse_y;map_select_check_started=(new Date).getTime();context_menu_active=false}}function mapview_touch_start(e){e.preventDefault();touch_drag_mode=false;touch_start_x=e.originalEvent.touches[0].pageX-$("#canvas").position().left;touch_start_y=e.originalEvent.touches[0].pageY-$("#canvas").position().top;var ptile=canvas_pos_to_tile(touch_start_x,touch_start_y);var time_elapsed=Date.now()-doubletaptimer;if(time_elapsed<350){mclick_tile=ptile;popit_req(ptile)}set_mouse_touch_started_on_unit(ptile);doubletaptimer=Date.now();suppress_touch_move=num_suppressions}function mapview_touch_end(e){if(touch_drag_mode&&!mouse_touch_started_on_unit&&!goto_active){touch_drag_mode=false;return}action_button_pressed(touch_start_x,touch_start_y,SELECT_POPUP)}function mapview_touch_move(e){suppress_touch_move--;if(suppress_touch_move>=0)return;touch_drag_mode=true;mouse_x=e.originalEvent.touches[0].pageX-$("#canvas").position().left;mouse_y=e.originalEvent.touches[0].pageY-$("#canvas").position().top;var diff_x=(touch_start_x-mouse_x)*2;var diff_y=(touch_start_y-mouse_y)*2;touch_start_x=mouse_x;touch_start_y=mouse_y;if(!goto_active){check_mouse_drag_unit(canvas_pos_to_tile(mouse_x,mouse_y));if(!goto_active&&!mouse_touch_started_on_unit){mapview["gui_x0"]+=diff_x;mapview["gui_y0"]+=diff_y}}if(client.conn.playing==null)return;goto_preview_active=true;if(goto_active&&current_focus.length>0){var ptile=canvas_pos_to_tile(mouse_x,mouse_y);if(ptile!=null){for(var i=0;i<current_focus.length;i++){if(i>=20)return;if(goto_request_map[current_focus[i]["id"]+","+ptile["x"]+","+ptile["y"]]==null){request_goto_path(current_focus[i]["id"],ptile["x"],ptile["y"])}}}}}function city_mapview_mouse_click(e){var rightclick;if(e.which){rightclick=e.which==3}else if(e.button){rightclick=e.button==2}if(!rightclick){city_action_button_pressed(mouse_x,mouse_y)}}function action_button_pressed(canvas_x,canvas_y,qtype){var ptile=canvas_pos_to_tile(canvas_x,canvas_y);clicked_city=tile_city(ptile);if(can_client_change_view()&&ptile!=null){do_map_click(ptile,qtype,true)}}function city_action_button_pressed(canvas_x,canvas_y){var ptile=canvas_pos_to_tile(canvas_x,canvas_y);if(can_client_change_view()&&ptile!=null){do_city_map_click(ptile)}}function map_select_units(canvas_x,canvas_y){var selected_tiles={};var selected_units=[];if(client_is_observer())return;var start_x=map_select_x<canvas_x?map_select_x:canvas_x;var start_y=map_select_y<canvas_y?map_select_y:canvas_y;var end_x=map_select_x<canvas_x?canvas_x:map_select_x;var end_y=map_select_y<canvas_y?canvas_y:map_select_y;for(var x=start_x;x<end_x;x+=15){for(var y=start_y;y<end_y;y+=15){var ptile=canvas_pos_to_tile(x,y);if(ptile!=null){selected_tiles[ptile["tile"]]=ptile}}}for(var tile_id in selected_tiles){var ptile=selected_tiles[tile_id];var cunits=tile_units(ptile);if(cunits==null)continue;for(var i=0;i<cunits.length;i++){var aunit=cunits[i];if(aunit["owner"]==client.conn.playing.playerno){selected_units.push(aunit)}}}current_focus=selected_units;action_selection_next_in_focus(IDENTITY_NUMBER_ZERO);update_active_units_dialog()}function recenter_button_pressed(canvas_x,canvas_y){var map_scroll_border=8;var big_map_size=24;var ptile=canvas_pos_to_tile(canvas_x,canvas_y);var orig_tile=ptile;if(ptile!=null&&ptile["y"]>map["ysize"]-map_scroll_border&&map["xsize"]>big_map_size&&map["ysize"]>big_map_size){ptile=map_pos_to_tile(ptile["x"],map["ysize"]-map_scroll_border)}if(ptile!=null&&ptile["y"]<map_scroll_border&&map["xsize"]>big_map_size&&map["ysize"]>big_map_size){ptile=map_pos_to_tile(ptile["x"],map_scroll_border)}if(can_client_change_view()&&ptile!=null&&orig_tile!=null){var sunit=find_visible_unit(orig_tile);if(!client_is_observer()&&sunit!=null&&sunit["owner"]==client.conn.playing.playerno){if(current_focus.length<=1)set_unit_focus(sunit);$("#canvas").contextMenu(true);$("#canvas").contextmenu();clicked_city=tile_city(ptile)}else{$("#canvas").contextMenu(false);enable_mapview_slide(ptile);center_tile_mapcanvas(ptile)}}}function city_click_goto_cooldown(ptile){if(ptile==LAST_GOTO_TILE){var elapsed_time=Date.now()-LAST_GOTO_TIMESTAMP;if(elapsed_time<GOTO_CLICK_COOLDOWN){return false}}return true}function handle_info_text_message(packet){var message=decodeURIComponent(packet["message"]);var lines=message.split("\n");var matcher={Terri:/^(Territory of )([^(]*)(\s+\([^,]*)(.*)/,"City:":/^(City:[^|]*\|\s+)([^(]*)(\s+\([^,]*)(.*)/,"Unit:":/^(Unit:[^|]*\|\s+)([^(]*)(\s+\([^,]*)(.*)/};for(var i=0;i<lines.length;i++){var re=matcher[lines[i].substr(0,5)];if(re!==undefined){var pplayer=null;var split_txt=lines[i].match(re);if(split_txt!=null&&split_txt.length>4){pplayer=player_by_full_username(split_txt[2])}if(pplayer!=null&&(client.conn.playing==null||pplayer!=client.conn.playing)){lines[i]=split_txt[1]+'<span onclick=\'$("#generic_dialog").parent().children().remove(); nation_table_select_player('+pplayer["playerno"]+");' class='nation_link' title='Select this player in the Nations Tab'>"+split_txt[2]+"</span>"+split_txt[3]+", "+get_player_connection_status(pplayer)+split_txt[4]}}}message=lines.join("<br>\n");message=message.replace(/team<br>\n/g,"team ");message=message.replace(/turn<br>\n/g,"turn ");message=message.replace(/\|<br>\n/g,"| ");message=message.replace(/\|/g,"&bull;");message=message.replace(/Occupied with<br>\n/g,"Occupied with ");message=message.replace(/Not<br>\n/g,"Not ");message=message.replace(/<br>\n<b>Hostile/g," <b class='black_shadow' style='color:d85454'>Hostile");message=message.replace(/<br>\nHostile/g," <b class='black_shadow' style='color:d85454'>Hostile</b>");message=message.replace(/<b>Hostile/g,"<b class='black_shadow' style='color:d85454'>Hostile");message=message.replace(/<br>\n<b>Friendly/g," <b class='black_shadow' style='color:#1b1'>Friendly");message=message.replace(/<br>\nFriendly/g," <b class='black_shadow' style='color:#1b1'>Friendly</b>");message=message.replace(/<b>Friendly/g,"<b class='black_shadow' style='color:#1b1'>Friendly");message=message.replace(/<br>\n<b>Neutral/g," <b class='black_shadow' style='color:#40a4d6'>Neutral");message=message.replace(/<br>\nNeutral/g," <b class='black_shadow' style='color:#40a4d6'>Neutral</b>");message=message.replace(/<b>Neutral/g,"<b class='black_shadow' style='color:#40a4d6'>Neutral");message=message.replace(/<br>\n<b>Mysterious/g," <b class='black_shadow' style='color:#9072de'>Mysterious");message=message.replace(/<br>\nMysterious/g," <b class='black_shadow' style='color:#9072de'Mysterious</b>");message=message.replace(/<b>Mysterious/g,"<b class='black_shadow' style='color:#9072de'>Mysterious");message=message.replace(/<br>\n<b>Peaceful/g," <b class='black_shadow' style='color:#0b8'>Peaceful");message=message.replace(/<br>\nPeaceful/g," <b class='black_shadow' style='color:#0b8'Peaceful</b>");message=message.replace(/<b>Peaceful/g,"<b class='black_shadow' style='color:#0b8'>Peaceful");message=message.replace(/11 turn cease-fire/g,"11 turn <b class='black_shadow' style='color:#790'>Cease-fire</b>");message=message.replace(/1 turn cease-fire/g,"<b class='black_shadow' style='color:#b50'><u>1 turn</u> Cease-fire</b>");message=message.replace(/turn cease-fire/g,"turn <b class='black_shadow' style='color:#790'>Cease-fire</b>");message=message.replace(/<br>\nunit/g," unit");message=message.replace("<br>\n   with"," &#11088; with");message=message.replace("[","[Continent #");message=message.replace("[Continent #-","[Sea #");show_dialog_message("Tile Information",message)}var mapview={};var mapdeco_highlight_table={};var mapdeco_crosshair_table={};var last_redraw_time=0;var MAPVIEW_REFRESH_INTERVAL=35;var mapview_slide={};mapview_slide["active"]=false;mapview_slide["dx"]=0;mapview_slide["dy"]=0;mapview_slide["i"]=0;mapview_slide["max"]=100;mapview_slide["slide_time"]=700;var total_draws=0;var mean_time=0;var stop_checking=false;var calibrate_threshold=1e9;var t_elapsed;var layer_elapsed=[0,0,0,0,0,0,0,0,0,0,0,0];var layer_mean_time=[0,0,0,0,0,0,0,0,0,0,0,0];function mapdeco_init(){mapdeco_highlight_table={};mapdeco_crosshair_table={};init_game_unit_panel();init_chatbox();keyboard_input=true}function center_tile_mapcanvas_2d(ptile){if(ptile==null)return;var r=map_to_gui_pos(ptile["x"],ptile["y"]);var gui_x=r["gui_dx"];var gui_y=r["gui_dy"];gui_x-=mapview["width"]-tileset_tile_width>>1;gui_y-=mapview["height"]-tileset_tile_height>>1;set_mapview_origin(gui_x,gui_y)}function center_tile_id(ptile_id){var ptile=tiles[ptile_id];if(is_small_screen()&&current_message_dialog_state=="maximized"&&$("#tabs").tabs("option","active")==TAB_MAP){$(".mobile_chatbox_dialog .ui-icon-circle-minus").click()}center_tile_mapcanvas(ptile)}function center_tile_id_click(ptile_id){center_tile_id(ptile_id);var sunits=tile_units(tiles[ptile_id]);if(sunits!=null&&sunits.length>0)set_unit_focus_and_redraw(sunits[0]);else{explosion_anim_map[ptile_id]=50;show_tile_marker_instead[ptile_id]=true}return}function map_to_gui_vector(map_dx,map_dy){var gui_dx=(map_dx-map_dy)*tileset_tile_width>>1;var gui_dy=(map_dx+map_dy)*tileset_tile_height>>1;return{gui_dx:gui_dx,gui_dy:gui_dy}}function set_mapview_origin(gui_x0,gui_y0){var r=normalize_gui_pos(gui_x0,gui_y0);gui_x0=r["gui_x"];gui_y0=r["gui_y"];base_set_mapview_origin(gui_x0,gui_y0)}function base_set_mapview_origin(gui_x0,gui_y0){var g=normalize_gui_pos(gui_x0,gui_y0);gui_x0=g["gui_x"];gui_y0=g["gui_y"];mapview["gui_x0"]=gui_x0;mapview["gui_y0"]=gui_y0}function normalize_gui_pos(gui_x,gui_y){var map_x,map_y,nat_x,nat_y,gui_x0,gui_y0,diff_x,diff_y;var r=gui_to_map_pos(gui_x,gui_y);map_x=r["map_x"];map_y=r["map_y"];var s=map_to_gui_pos(map_x,map_y);gui_x0=s["gui_dx"];gui_y0=s["gui_dy"];diff_x=gui_x-gui_x0;diff_y=gui_y-gui_y0;var t=MAP_TO_NATIVE_POS(map_x,map_y);nat_x=t["nat_x"];nat_y=t["nat_y"];if(topo_has_flag(TF_WRAPX)){nat_x=FC_WRAP(nat_x,map["xsize"])}if(topo_has_flag(TF_WRAPY)){nat_y=FC_WRAP(nat_y,map["ysize"])}var u=NATIVE_TO_MAP_POS(nat_x,nat_y);map_x=u["map_x"];map_y=u["map_y"];var v=map_to_gui_pos(map_x,map_y);gui_x=v["gui_dx"];gui_y=v["gui_dy"];gui_x+=diff_x;gui_y+=diff_y;return{gui_x:gui_x,gui_y:gui_y}}function gui_to_map_pos(gui_x,gui_y){var W=tileset_tile_width;var H=tileset_tile_height;gui_x-=W>>1;var map_x=DIVIDE(gui_x*H+gui_y*W,W*H);var map_y=DIVIDE(gui_y*W-gui_x*H,W*H);return{map_x:map_x,map_y:map_y}}function map_to_gui_pos(map_x,map_y){return map_to_gui_vector(map_x,map_y)}function update_map_canvas(canvas_x,canvas_y,width,height){var gui_x0=mapview["gui_x0"]+canvas_x;var gui_y0=mapview["gui_y0"]+canvas_y;var r=base_canvas_to_map_pos(0,0);var s=base_canvas_to_map_pos(mapview["width"],0);var t=base_canvas_to_map_pos(0,mapview["height"]);var u=base_canvas_to_map_pos(mapview["width"],mapview["height"]);if(r["map_x"]<0||r["map_x"]>map["xsize"]||r["map_y"]<0||r["map_y"]>map["ysize"]||s["map_x"]<0||s["map_x"]>map["xsize"]||s["map_y"]<0||s["map_y"]>map["ysize"]||t["map_x"]<0||t["map_x"]>map["xsize"]||t["map_y"]<0||t["map_y"]>map["ysize"]||u["map_x"]<0||u["map_x"]>map["xsize"]||u["map_y"]<0||u["map_y"]>map["ysize"]){canvas_put_rectangle(mapview_canvas_ctx,"rgb(0,0,0)",canvas_x,canvas_y,width,height)}for(var layer=0;layer<=LAYER_COUNT;layer++){if(layer==LAYER_SPECIAL1){}else if(layer==LAYER_CITY1){if(dashedSupport)mapview_canvas_ctx.setLineDash([])}var gui_x_0=gui_x0;var gui_y_0=gui_y0;var gui_x_w=width+(tileset_tile_width>>1);var gui_y_h=height+(tileset_tile_height>>1);if(gui_x_w<0){gui_x_0+=gui_x_w;gui_x_w=-gui_x_w}if(gui_y_h<0){gui_y_0+=gui_y_h;gui_y_h=-gui_y_h}if(gui_x_w>0&&gui_y_h>0){var ptilepcorner={};var ptile_xi,ptile_yi,ptile_si,ptile_di;var gui_x,gui_y;var ptile_r1=2;var ptile_r2=ptile_r1*2;var ptile_w=tileset_tile_width;var ptile_h=tileset_tile_height;var ptile_x0=Math.floor(gui_x_0*ptile_r2/ptile_w-(gui_x_0*ptile_r2<0&&gui_x_0*ptile_r2%ptile_w<0?1:0)-ptile_r1/2);var ptile_y0=Math.floor(gui_y_0*ptile_r2/ptile_h-(gui_y_0*ptile_r2<0&&gui_y_0*ptile_r2%ptile_h<0?1:0)-ptile_r1/2);var ptile_x1=Math.floor(((gui_x_0+gui_x_w)*ptile_r2+ptile_w-1)/ptile_w-((gui_x_0+gui_x_w)*ptile_r2+ptile_w-1<0&&((gui_x_0+gui_x_w)*ptile_r2+ptile_w-1)%ptile_w<0?1:0)+ptile_r1);var ptile_y1=Math.floor(((gui_y_0+gui_y_h)*ptile_r2+ptile_h-1)/ptile_h-((gui_y_0+gui_y_h)*ptile_r2+ptile_h-1<0&&((gui_y_0+gui_y_h)*ptile_r2+ptile_h-1)%ptile_h<0?1:0)+ptile_r1);var ptile_count=(ptile_x1-ptile_x0)*(ptile_y1-ptile_y0);for(var ptile_index=0;ptile_index<ptile_count;ptile_index++){var ptile=null;var pcorner=null;ptile_xi=ptile_x0+ptile_index%(ptile_x1-ptile_x0);ptile_yi=Math.floor(ptile_y0+ptile_index/(ptile_x1-ptile_x0));ptile_si=ptile_xi+ptile_yi;ptile_di=ptile_yi-ptile_xi;if((ptile_xi+ptile_yi)%2!=0){continue}if(map["topology_id"]==0&&(ptile_si<=0||ptile_si/4>map["xsize"]))continue;if(ptile_xi%2==0&&ptile_yi%2==0){if((ptile_xi+ptile_yi)%4==0){ptile=map_pos_to_tile(ptile_si/4-1,ptile_di/4)}else{pcorner=ptilepcorner;pcorner["tile"]=[];pcorner["tile"][0]=map_pos_to_tile((ptile_si-6)/4,(ptile_di-2)/4);pcorner["tile"][1]=map_pos_to_tile((ptile_si-2)/4,(ptile_di-2)/4);pcorner["tile"][2]=map_pos_to_tile((ptile_si-2)/4,(ptile_di+2)/4);pcorner["tile"][3]=map_pos_to_tile((ptile_si-6)/4,(ptile_di+2)/4)}}gui_x=Math.floor(ptile_xi*ptile_w/ptile_r2-ptile_w/2);gui_y=Math.floor(ptile_yi*ptile_h/ptile_r2-ptile_h/2);var cx=gui_x-mapview["gui_x0"];var cy=gui_y-mapview["gui_y0"];if(ptile!=null){put_one_tile(mapview_canvas_ctx,layer,ptile,cx,cy,null)}else if(pcorner!=null){put_one_element(mapview_canvas_ctx,layer,null,null,pcorner,null,null,cx,cy,null)}}}}if(draw_city_traderoutes){for(city_id in cities){if(cities[city_id]["traderoute_count"]>0){for(tr=0;tr<cities[city_id]["traderoute_count"];tr++){if(city_trade_routes[city_id][tr]){var correct_x,src=city_id,dest=city_trade_routes[city_id][tr]["partner"];src_x=tiles[cities[src]["tile"]]["x"];src_y=tiles[cities[src]["tile"]]["y"];dest_x=tiles[cities[dest]["tile"]]["x"];dest_y=tiles[cities[dest]["tile"]]["y"];if(dest_x<src_x){tmp_x=dest_x;dest_x=src_x;src_x=tmp_x;tmp_y=dest_y;dest_y=src_y;src_y=tmp_y}if(topo_has_flag(TF_WRAPX)){xs=map["xsize"];if(dest_x>src_x){if(Math.abs(dest_x-src_x)>Math.abs(src_x+xs-dest_x)){correct_x=-1*(xs-dest_x)}}}var from=map_to_gui_pos(src_x+1,src_y);var to=map_to_gui_pos(dest_x+1,dest_y);mapview_canvas_ctx.lineWidth=3;mapview_canvas_ctx.strokeStyle="rgb(255,0,255)";mapview_canvas_ctx.beginPath();mapview_canvas_ctx.moveTo(from["gui_dx"]-mapview.gui_x0,from["gui_dy"]-mapview.gui_y0);mapview_canvas_ctx.lineTo(to["gui_dx"]-mapview.gui_x0,to["gui_dy"]-mapview.gui_y0);mapview_canvas_ctx.stroke()}}}}}if(map_select_active&&map_select_setting_enabled){canvas_put_select_rectangle(mapview_canvas_ctx,map_select_x,map_select_y,mouse_x-map_select_x,mouse_y-map_select_y)}}function put_one_tile(pcanvas,layer,ptile,canvas_x,canvas_y,citymode){if(tile_get_known(ptile)!=TILE_UNKNOWN||layer==LAYER_GOTO){put_one_element(pcanvas,layer,ptile,null,null,get_drawable_unit(ptile,citymode),tile_city(ptile),canvas_x,canvas_y,citymode)}}function put_one_element(pcanvas,layer,ptile,pedge,pcorner,punit,pcity,canvas_x,canvas_y,citymode){var tile_sprs=fill_sprite_array(layer,ptile,pedge,pcorner,punit,pcity,citymode);var fog=ptile!=null&&draw_fog_of_war&&TILE_KNOWN_UNSEEN==tile_get_known(ptile);put_drawn_sprites(pcanvas,canvas_x,canvas_y,tile_sprs,fog)}function put_drawn_sprites(pcanvas,canvas_x,canvas_y,pdrawn,fog){for(var i=0;i<pdrawn.length;i++){var offset_x=0,offset_y=0;if("offset_x"in pdrawn[i]){offset_x+=pdrawn[i]["offset_x"]}if("offset_y"in pdrawn[i]){offset_y+=pdrawn[i]["offset_y"]}if(pdrawn[i]["key"]=="city_text"){mapview_put_city_bar(pcanvas,pdrawn[i]["city"],canvas_x+offset_x,canvas_y+offset_y)}else if(pdrawn[i]["key"]=="border"){mapview_put_border_line(pcanvas,pdrawn[i]["dir"],pdrawn[i]["color"],pdrawn[i]["color2"],pdrawn[i]["color3"],canvas_x,canvas_y)}else if(pdrawn[i]["key"]=="mapgrid"){mapview_put_grid_line(pcanvas,pdrawn[i]["dir"],pdrawn[i]["color"],canvas_x,canvas_y)}else if(pdrawn[i]["key"]=="goto_line"){mapview_put_goto_line(pcanvas,pdrawn[i]["goto_dir"],canvas_x,canvas_y)}else if(pdrawn[i]["key"]=="tile_label"){mapview_put_tile_label(pcanvas,pdrawn[i]["tile"],canvas_x+offset_x,canvas_y+offset_y)}else if(pdrawn[i]["scale"]){mapview_put_scaled_image(pcanvas,pdrawn[i]["key"],canvas_x+offset_x,canvas_y+offset_y,pdrawn[i]["scale"])}else{mapview_put_tile(pcanvas,pdrawn[i]["key"],canvas_x+offset_x,canvas_y+offset_y)}}}function base_canvas_to_map_pos(canvas_x,canvas_y){return gui_to_map_pos(canvas_x+mapview.gui_x0,canvas_y+mapview.gui_y0)}function canvas_pos_to_tile(canvas_x,canvas_y){var map_x,map_y;var r=base_canvas_to_map_pos(canvas_x,canvas_y);map_x=r["map_x"];map_y=r["map_y"];return map_pos_to_tile(map_x,map_y)}function canvas_pos_to_nearest_tile(canvas_x,canvas_y){var map_x,map_y;var r=base_canvas_to_map_pos(canvas_x,canvas_y);map_x=r["map_x"];map_y=r["map_y"];if(topo_has_flag(TF_WRAPX)){map_x=FC_WRAP(map_x,map["xsize"])}else if(map_x<0){map_x=0}else if(map_x>=map["xsize"]){map_x=map["xsize"]-1}if(topo_has_flag(TF_WRAPY)){nat_y=FC_WRAP(nat_y,map["ysize"])}else if(map_y<0){map_y=0}else if(map_y>=map["ysize"]){map_y=map["ysize"]-1}return map_pos_to_tile(map_x,map_y)}function update_map_canvas_full(){if(tiles!=null&&civclient_state>=C_S_RUNNING){if(!sprites_init)init_cache_sprites();if(active_city!=null)return;if(mapview_slide["active"]){update_map_slide()}else{update_map_canvas(0,0,mapview["store_width"],mapview["store_height"]);if(goto_active)check_request_goto_path()}last_redraw_time=(new Date).getTime()}}function update_map_canvas_check(){if(freeze)return;var time=(new Date).getTime()-last_redraw_time;if(time>MAPVIEW_REFRESH_INTERVAL){update_map_canvas_full()}try{if(window.requestAnimationFrame!=null)requestAnimationFrame(update_map_canvas_check)}catch(e){if(e.name=="NS_ERROR_NOT_AVAILABLE"){setTimeout(update_map_canvas_check,100)}else{}}}function update_map_slide(){var elapsed=1+(new Date).getTime()-mapview_slide["start"];mapview_slide["i"]=Math.floor(mapview_slide["max"]*(mapview_slide["slide_time"]-elapsed)/mapview_slide["slide_time"]);if(mapview_slide["i"]<=0){mapview_slide["active"]=false;return}var dx=mapview_slide["dx"];var dy=mapview_slide["dy"];var sx=0;var sy=0;if(dx>=0&&dy<=0){sx=Math.floor(dx*((mapview_slide["max"]-mapview_slide["i"])/mapview_slide["max"]));sy=Math.floor(dy*(-1*mapview_slide["i"]/mapview_slide["max"]))}else if(dx>=0&&dy>=0){sx=Math.floor(dx*((mapview_slide["max"]-mapview_slide["i"])/mapview_slide["max"]));sy=Math.floor(dy*((mapview_slide["max"]-mapview_slide["i"])/mapview_slide["max"]))}else if(dx<=0&&dy>=0){sx=Math.floor(dx*(-1*mapview_slide["i"]/mapview_slide["max"]));sy=Math.floor(dy*((mapview_slide["max"]-mapview_slide["i"])/mapview_slide["max"]))}else if(dx<=0&&dy<=0){sx=Math.floor(dx*(-1*mapview_slide["i"]/mapview_slide["max"]));sy=Math.floor(dy*(-1*mapview_slide["i"]/mapview_slide["max"]))}mapview_canvas_ctx.drawImage(buffer_canvas,sx,sy,mapview["width"],mapview["height"],0,0,mapview["width"],mapview["height"])}var border_anim=0;const border_anim_delay=750;var mapview_canvas_ctx=null;var mapview_canvas=null;var buffer_canvas_ctx=null;var buffer_canvas=null;var city_canvas_ctx=null;var city_canvas=null;var city_map_display_mode=0;const CMDM_SIZE=0;const CMDM_FINISHED=1;const CMDM_BUY_COST=2;const CMDM_GROWS=3;const CMDM_SHIELDS=4;const CMDM_POLLUTION=5;const CMDM_CORRUPTION=6;const CMDM_LAST=7;var tileset_images=[];var sprites={};var loaded_images=0;var sprites_init=false;var canvas_text_font="16px Helvetica, sans serif";var fullfog=[];var GOTO_DIR_DX=[0,1,2,-1,1,-2,-1,0];var GOTO_DIR_DY=[-2,-1,0,-1,1,0,1,2];var dashedSupport=false;var goto_colors_active=["0,10,40,1","30,208,255,1","2,26,45,1","197,243,255,1"];var goto_colors_info=["40,10,0,.91","255,208,30,.91","45,26,2,.91","255,243,197,.91"];var goto_colors_road=["40,10,0,.91","168,84,15,.91","65,18,2,.91","255,213,167,.91"];var goto_colors_irr=["0,40,10,1","128,208,84,1","25,45,15,1","150,255,123,1"];function mapview_cycle_city_display_mode(){var last=CMDM_LAST;city_map_display_mode++;if(city_map_display_mode>=last)city_map_display_mode=0;switch(city_map_display_mode){case CMDM_SIZE:add_client_message("Showing city population.");break;case CMDM_FINISHED:add_client_message("Showing turns to completion.");break;case CMDM_BUY_COST:add_client_message("Showing buy cost.");break;case CMDM_GROWS:add_client_message("Showing city growth turns.");break;case CMDM_SHIELDS:add_client_message("Showing city production surplus.");break;case CMDM_POLLUTION:add_client_message("Showing city pollution probability.");break;case CMDM_CORRUPTION:add_client_message("Showing city corruption.");break}}function init_mapview(){$("#canvas_div").append($("<canvas/>",{id:"canvas"}));$.ajax({url:"/javascript/2dcanvas/tileset_config_amplio2.js",dataType:"script",async:false}).fail(function(){console.error("Unable to load tileset config.")});$.ajax({url:"/javascript/2dcanvas/tileset_spec_amplio2.js",dataType:"script",async:false}).fail(function(){console.error("Unable to load tileset spec. Run Freeciv-img-extract.")});mapview_canvas=document.getElementById("canvas");mapview_canvas_ctx=mapview_canvas.getContext("2d");buffer_canvas=document.createElement("canvas");buffer_canvas_ctx=buffer_canvas.getContext("2d");if("imageSmoothingEnabled"in mapview_canvas_ctx){mapview_canvas_ctx.imageSmoothingEnabled=false}dashedSupport="setLineDash"in mapview_canvas_ctx;setup_window_size();mapview["gui_x0"]=0;mapview["gui_y0"]=0;var i;for(i=0;i<81;i++){var ids=["u","f","k"];var buf="t.fog";var values=[];var j,k=i;for(j=0;j<4;j++){values[j]=k%3;k=Math.floor(k/3);buf+="_"+ids[values[j]]}fullfog[i]=buf}if(is_small_screen())MAPVIEW_REFRESH_INTERVAL=12;orientation_changed();init_sprites();requestAnimationFrame(update_map_canvas_check,mapview_canvas)}function is_small_screen(){if($(window).width()<=640||$(window).height()<=590){return true}else{return false}}function init_sprites(){$.blockUI({message:"<h1 style='text-align:center'><font color='#ccc'>Loading...</font>"+"<br><center><img src='/images/loading.gif'></center></h1>",color:default_dialog_text_color});if(loaded_images!=tileset_image_count){for(var i=0;i<tileset_image_count;i++){var tileset_image=new Image;tileset_image.onload=preload_check;tileset_image.src="/tileset/freeciv-web-tileset-"+tileset_name+"-"+i+get_tileset_file_extention()+"?ts="+ts;tileset_images[i]=tileset_image}}else{$.unblockUI()}}function preload_check(){loaded_images+=1;if(loaded_images==tileset_image_count){init_cache_sprites();$.unblockUI()}}function init_cache_sprites(){try{if(typeof tileset==="undefined"){swal("Tileset not generated correctly. Run sync.sh in "+"freeciv-img-extract and recompile.");setSwalTheme();return}for(var tile_tag in tileset){var x=tileset[tile_tag][0];var y=tileset[tile_tag][1];var w=tileset[tile_tag][2];var h=tileset[tile_tag][3];var i=tileset[tile_tag][4];var newCanvas=document.createElement("canvas");newCanvas.height=h;newCanvas.width=w;var newCtx=newCanvas.getContext("2d");newCtx.drawImage(tileset_images[i],x,y,w,h,0,0,w,h);sprites[tile_tag]=newCanvas}sprites_init=true;tileset_images[0]=null;tileset_images[1]=null;tileset_images=null}catch(e){console.log("Problem caching sprite: "+tile_tag)}}function mapview_window_resized(){chatbox_scroll_to_bottom(false);if(active_city!=null||!resize_enabled)return;setup_window_size();update_map_canvas_full()}function drawPath(ctx,x1,y1,x2,y2,x3,y3,x4,y4){ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.lineTo(x3,y3);ctx.lineTo(x4,y4);ctx.lineTo(x1,y1)}function mapview_put_tile(pcanvas,tag,canvas_x,canvas_y){if(sprites[tag]==null){return}pcanvas.drawImage(sprites[tag],canvas_x,canvas_y)}function mapview_put_scaled_image(pcanvas,tag,canvas_x,canvas_y,scale){if(sprites[tag]==null){return}pcanvas.drawImage(sprites[tag],canvas_x,canvas_y,sprites[tag].width*scale,sprites[tag].height*scale)}function canvas_put_rectangle(canvas_context,pcolor,canvas_x,canvas_y,width,height){canvas_context.fillStyle=pcolor;canvas_context.fillRect(canvas_x,canvas_y,canvas_x+width,canvas_y+height)}function canvas_put_select_rectangle(canvas_context,canvas_x,canvas_y,width,height){canvas_context.beginPath();canvas_context.strokeStyle="rgb(255,0,0)";canvas_context.rect(canvas_x,canvas_y,width,height);canvas_context.stroke()}function mapview_get_citybar_num_and_color(city_id){var num="";var col="rgba(255,255,255,1)";const pcity=cities[city_id];switch(city_map_display_mode){case CMDM_SIZE:num=pcity["size"];break;case CMDM_FINISHED:num=get_city_production_time(pcity);if(num===undefined||num>999)num="";else if(num==1){num="%E2%9C%94";if(pcity["buy_cost"]){col="rgb(96,255,255)"}}else col="rgb(96,255,255)";break;case CMDM_BUY_COST:if(pcity["buy_cost"]!==undefined){num=pcity["buy_cost"];if(num===0){num="%E2%9C%94"}else col="rgb(255,213,44)"}break;case CMDM_GROWS:if(pcity.hasOwnProperty("granary_turns")){num=pcity["granary_turns"];if(num>999)num="";else if(num===0){num="--";col="rgb(196,196,196)"}else if(num>0)col="rgb(128,255,128)";else if(num<0){col="rgb(255,131,0)";if(num==-1)num+=" ** %E2%9A%A0"}}break;case CMDM_SHIELDS:if(pcity.hasOwnProperty("surplus")){num=pcity["surplus"][O_SHIELD];if(num>0)num="+"+num;else if(num===0){num="-";col="rgb(128,128,128)"}else{num+=" %E2%9A%A0";col="rgb(255,128,128)"}}break;case CMDM_POLLUTION:if(pcity["pollution"]){num=pcity["pollution"];if(num<1)num="";else{col="rgb(170,119,51)"}}break;case CMDM_CORRUPTION:if(pcity.hasOwnProperty("waste")){num=pcity["waste"][O_TRADE];if(num<1)num="";else{col="rgb(255,128,102)"}}break}return{num:num,col:col}}function mapview_put_city_bar(pcanvas,city,canvas_x,canvas_y){var airlift_text="";const SRC_UNLIMITED=4;const DEST_UNLIMITED=8;const infinity_symbol="%E2%88%9E";const left_div="%E2%9D%AC";const right_div="%E2%9D%AD";const bullet="%E2%88%99";var mood_text="";var size_color;var size_shadow_color="rgba(0, 0, 0, 1)";const peace="%E2%98%AE ";const celeb="%E2%9C%A8 ";const disorder="%E2%9C%8A ";const lose_celeb_color="rgba(0,0,0,1)";const start_celeb_color="rgb(128,255,128)";var start_celeb=false;var lose_celeb=0;if(draw_city_mood){if(client.conn.playing!=null&&!client_is_observer()){if(city["owner"]==client.conn.playing.playerno&&city["ppl_happy"]!=null&&city["ppl_content"]!=null&&city["ppl_unhappy"]!=null){var city_state=get_city_state(city);happy_people=city["ppl_happy"][FEELING_FINAL];content_people=city["ppl_content"][FEELING_FINAL];unhappy_angry_people=city["ppl_unhappy"][FEELING_FINAL]+city["ppl_angry"][FEELING_FINAL];switch(city_state){case"Peace":mood_text=peace;break;case"Disorder":mood_text=disorder;break;case"Celebrating":mood_text=celeb;break}if(happy_people>=city["size"]*.4999&&unhappy_angry_people==0&&city["size"]>2){if(mood_text==peace)start_celeb=true}else if(unhappy_angry_people>happy_people){if(mood_text==celeb){size_shadow_color="rgba(128,128,128,1)";size_color=lose_celeb_color;lose_celeb=1}}else{if(mood_text==celeb){size_shadow_color="rgba(128,128,128,1)";size_color=lose_celeb_color;lose_celeb=1}else if(mood_text==peace){mood_text=""}}}}}if(draw_city_airlift_counter){var src_capacity=game_info["airlifting_style"]&SRC_UNLIMITED?infinity_symbol:city["airlift"];if(src_capacity<0)src_capacity=0;if(client.conn.playing!=null&&!client_is_observer()){if(city["owner"]==client.conn.playing.playerno){if(game_info["airlift_dest_divisor"]==0){airlift_text=city["airlift"]>0?" "+left_div+src_capacity+right_div:""}else if(city_has_building(city,improvement_id_by_name(B_AIRPORT_NAME))){var airlift_receive_text;var airlift_receive_max_capacity=Math.round(city["size"]/game_info["airlift_dest_divisor"]);if(game_info["airlifting_style"]&DEST_UNLIMITED)airlift_receive_text=infinity_symbol;else airlift_receive_text=Math.max(0,city["airlift"]+airlift_receive_max_capacity-effects[1][0]["effect_value"]);airlift_text=city["airlift"]>0||airlift_receive_text==infinity_symbol||src_capacity==infinity_symbol||airlift_receive_text!="0"?" "+left_div+src_capacity+bullet+airlift_receive_text+right_div:" "+left_div+bullet+right_div}}}}var cityname=show_citybar<2?city["name"]:"";var text=decodeURIComponent(cityname+airlift_text).toUpperCase();if(replace_capital_i)text=text.replace(/I/gi,"|");var citybarinfo=mapview_get_citybar_num_and_color(city["id"]);var size=decodeURIComponent(mood_text+citybarinfo["num"]);if(!lose_celeb)size_color=citybarinfo["col"];var color=nations[city_owner(city)["nation"]]["color"];var prod_type=get_city_production_type(city);var txt_measure=pcanvas.measureText(text);var size_measure=pcanvas.measureText(size);pcanvas.globalAlpha=.7;pcanvas.fillStyle="rgba(0, 0, 0, 0.55)";pcanvas.fillRect(canvas_x-Math.floor(txt_measure.width/2)-14,canvas_y-17,txt_measure.width+20,20);pcanvas.fillStyle=color;pcanvas.fillRect(canvas_x+Math.floor(txt_measure.width/2)+5,canvas_y-19,prod_type!=null?size_measure.width+35:size_measure.width+8,24);var city_flag=get_city_flag_sprite(city);pcanvas.drawImage(sprites[city_flag["key"]],canvas_x-Math.floor(txt_measure.width/2)-45,canvas_y-17);pcanvas.drawImage(sprites[get_city_occupied_sprite(city)],canvas_x-Math.floor(txt_measure.width/2)-14,canvas_y-16);pcanvas.strokeStyle=color;pcanvas.lineWidth=1.5;pcanvas.beginPath();pcanvas.moveTo(canvas_x-Math.floor(txt_measure.width/2)-46,canvas_y-18);pcanvas.lineTo(canvas_x+Math.floor(txt_measure.width/2)+size_measure.width+13,canvas_y-18);pcanvas.moveTo(canvas_x+Math.floor(txt_measure.width/2)+size_measure.width+13,canvas_y+4);pcanvas.lineTo(canvas_x-Math.floor(txt_measure.width/2)-46,canvas_y+4);pcanvas.lineTo(canvas_x-Math.floor(txt_measure.width/2)-46,canvas_y-18);pcanvas.moveTo(canvas_x-Math.floor(txt_measure.width/2)-15,canvas_y-17);pcanvas.lineTo(canvas_x-Math.floor(txt_measure.width/2)-15,canvas_y+3);pcanvas.stroke();pcanvas.globalAlpha=1;if(prod_type!=null){var tag=tileset_ruleset_entity_tag_str_or_alt(prod_type,"unit or building");if(tag==null)return;pcanvas.drawImage(sprites[tag],canvas_x+Math.floor(txt_measure.width/2)+size_measure.width+13,canvas_y-19,28,24)}var shadow_offset_fix=lose_celeb||city_map_display_mode?1:0;pcanvas.fillStyle="rgba(40, 40, 40, 1)";pcanvas.fillText(text,canvas_x-Math.floor(txt_measure.width/2),canvas_y+1);pcanvas.fillStyle=size_shadow_color;pcanvas.fillText(size,canvas_x+Math.floor(txt_measure.width/2)+10-shadow_offset_fix,canvas_y+1-shadow_offset_fix);pcanvas.fillStyle="rgba(255, 255, 255, 1)";pcanvas.fillText(text,canvas_x-Math.floor(txt_measure.width/2)-2,canvas_y-1);pcanvas.fillStyle=size_color;pcanvas.fillText(size,canvas_x+Math.floor(txt_measure.width/2)+8,canvas_y-1);if(start_celeb){mood_text=decodeURIComponent(mood_text);pcanvas.fillStyle=start_celeb_color;pcanvas.fillText(mood_text,canvas_x+Math.floor(txt_measure.width/2)+8,canvas_y-1)}}function mapview_put_tile_label(pcanvas,tile,canvas_x,canvas_y){var text=tile["label"];if(text!=null&&text.length>0){var txt_measure=pcanvas.measureText(text);pcanvas.fillStyle="rgba(255, 255, 255, 1)";pcanvas.fillText(text,canvas_x+normal_tile_width/2-Math.floor(txt_measure.width/2),canvas_y-1)}}function mapview_put_grid_line(pcanvas,dir,color,canvas_x,canvas_y){var x=canvas_x+47;var y=canvas_y+3;pcanvas.strokeStyle=color;mapview_canvas_ctx.lineWidth=2;mapview_canvas_ctx.lineDashOffset=0;mapview_canvas_ctx.setLineDash([4,4]);pcanvas.beginPath();if(dir==DIR8_NORTH){pcanvas.moveTo(x,y-2,x+tileset_tile_width/2);pcanvas.lineTo(x+tileset_tile_width/2,y+tileset_tile_height/2-2)}else if(dir==DIR8_EAST){pcanvas.moveTo(x-3,y+tileset_tile_height-3);pcanvas.lineTo(x+tileset_tile_width/2-3,y+tileset_tile_height/2-3)}else if(dir==DIR8_SOUTH){pcanvas.moveTo(x-tileset_tile_width/2+3,y+tileset_tile_height/2-3);pcanvas.lineTo(x+3,y+tileset_tile_height-3)}else if(dir==DIR8_WEST){pcanvas.moveTo(x-tileset_tile_width/2+3,y+tileset_tile_height/2-3);pcanvas.lineTo(x+3,y-3)}pcanvas.closePath();pcanvas.stroke()}function mapview_put_border_line(pcanvas,dir,color,color2,color3,canvas_x,canvas_y){if(draw_border_mode&2)return;var x=canvas_x+47;var y=canvas_y+3;const ddb=draw_dashed_borders;const dtc=draw_tertiary_colors;const dtb=draw_thick_borders;mapview_canvas_ctx.lineWidth=dtb?3:2;mapview_canvas_ctx.lineCap="butt";pcanvas.beginPath();if(ddb){mapview_canvas_ctx.setLineDash([4,4]);switch(minimap_color){case 2:pcanvas.strokeStyle=color2;break;case 3:pcanvas.strokeStyle=color3;break;default:pcanvas.strokeStyle=color}}else{mapview_canvas_ctx.setLineDash([]);pcanvas.strokeStyle=dtc?color3:color}if(draw_moving_borders){border_anim++;mapview_canvas_ctx.lineDashOffset=Math.trunc(border_anim/border_anim_delay);if(border_anim>24*border_anim_delay)border_anim=0}switch(dir){case DIR8_NORTH:pcanvas.moveTo(x,y-2,x+tileset_tile_width/2);pcanvas.lineTo(x+tileset_tile_width/2,y+tileset_tile_height/2-2);pcanvas.stroke();if(ddb)break;pcanvas.strokeStyle=color2;mapview_canvas_ctx.setLineDash([6,6]);pcanvas.moveTo(x,y-2,x+tileset_tile_width/2);pcanvas.lineTo(x+tileset_tile_width/2,y+tileset_tile_height/2-2);pcanvas.stroke();if(!dtc)break;pcanvas.strokeStyle=color;mapview_canvas_ctx.setLineDash([6,18]);pcanvas.moveTo(x,y-2,x+tileset_tile_width/2);pcanvas.lineTo(x+tileset_tile_width/2,y+tileset_tile_height/2-2);pcanvas.stroke();break;case DIR8_EAST:pcanvas.moveTo(x-3,y+tileset_tile_height-3);pcanvas.lineTo(x+tileset_tile_width/2-3,y+tileset_tile_height/2-3);pcanvas.stroke();if(ddb)break;pcanvas.strokeStyle=color2;mapview_canvas_ctx.setLineDash([6,6]);pcanvas.moveTo(x-3,y+tileset_tile_height-3);pcanvas.lineTo(x+tileset_tile_width/2-3,y+tileset_tile_height/2-3);pcanvas.stroke();if(!dtc)break;pcanvas.strokeStyle=color;mapview_canvas_ctx.setLineDash([6,18]);pcanvas.moveTo(x-3,y+tileset_tile_height-3);pcanvas.lineTo(x+tileset_tile_width/2-3,y+tileset_tile_height/2-3);pcanvas.stroke();break;case DIR8_SOUTH:pcanvas.moveTo(x-tileset_tile_width/2+3,y+tileset_tile_height/2-3);pcanvas.lineTo(x+3,y+tileset_tile_height-3);pcanvas.stroke();if(ddb)break;pcanvas.strokeStyle=color2;mapview_canvas_ctx.setLineDash([6,6]);pcanvas.moveTo(x-tileset_tile_width/2+3,y+tileset_tile_height/2-3);pcanvas.lineTo(x+3,y+tileset_tile_height-3);pcanvas.stroke();if(!dtc)break;pcanvas.strokeStyle=color;mapview_canvas_ctx.setLineDash([6,18]);pcanvas.moveTo(x-tileset_tile_width/2+3,y+tileset_tile_height/2-3);pcanvas.lineTo(x+3,y+tileset_tile_height-3);pcanvas.stroke();break;case DIR8_WEST:pcanvas.moveTo(x-tileset_tile_width/2+3,y+tileset_tile_height/2-3);pcanvas.lineTo(x+3,y-3);pcanvas.stroke();if(ddb)break;pcanvas.strokeStyle=color2;mapview_canvas_ctx.setLineDash([6,6]);pcanvas.moveTo(x-tileset_tile_width/2+3,y+tileset_tile_height/2-3);pcanvas.lineTo(x+3,y-3);pcanvas.stroke();if(!dtc)break;pcanvas.strokeStyle=color;mapview_canvas_ctx.setLineDash([6,18]);pcanvas.moveTo(x-tileset_tile_width/2+3,y+tileset_tile_height/2-3);pcanvas.lineTo(x+3,y-3);pcanvas.stroke();break}}function mapview_territory_fill(pcanvas,color,canvas_x,canvas_y){var x=canvas_x+47;var y=canvas_y+25;pcanvas.beginPath();pcanvas.fillStyle=color;pcanvas.moveTo(x,y+tileset_tile_height/2);pcanvas.lineTo(x-tileset_tile_width/2,y);pcanvas.lineTo(x,y-tileset_tile_height/2);pcanvas.lineTo(x+tileset_tile_width/2,y);pcanvas.lineTo(x,y+tileset_tile_height/2);pcanvas.closePath();pcanvas.fill()}function mapview_put_goto_line(pcanvas,dir,canvas_x,canvas_y){var x0=canvas_x+tileset_tile_width/2;var y0=canvas_y+tileset_tile_height/2;var x1=x0+GOTO_DIR_DX[dir]*(tileset_tile_width/2);var y1=y0+GOTO_DIR_DY[dir]*(tileset_tile_height/2);var colors=goto_active?goto_colors_active:goto_colors_info;if(connect_active){if(connect_extra==EXTRA_ROAD)colors=goto_colors_road;else if(connect_extra==EXTRA_IRRIGATION)colors=goto_colors_irr}pcanvas.strokeStyle="rgba("+colors[0]+")";pcanvas.lineWidth=8;pcanvas.lineCap="round";pcanvas.beginPath();pcanvas.moveTo(x0,y0);pcanvas.lineTo(x1,y1);pcanvas.stroke();pcanvas.strokeStyle="rgba("+colors[1]+")";pcanvas.lineWidth=6;pcanvas.beginPath();pcanvas.moveTo(x0,y0);pcanvas.lineTo(x1,y1);pcanvas.stroke();pcanvas.lineWidth=12;pcanvas.strokeStyle="rgba("+colors[2]+")";pcanvas.beginPath();pcanvas.moveTo(x0,y0);pcanvas.lineTo(x0,y0);pcanvas.stroke();pcanvas.beginPath();pcanvas.moveTo(x1,y1);pcanvas.lineTo(x1,y1);pcanvas.stroke();pcanvas.lineWidth=4;pcanvas.strokeStyle="rgba("+colors[3]+")";pcanvas.lineCap="square";pcanvas.beginPath();pcanvas.moveTo(x0,y0);pcanvas.lineTo(x0,y0);pcanvas.stroke();pcanvas.beginPath();pcanvas.moveTo(x1,y1);pcanvas.lineTo(x1,y1);pcanvas.stroke()}function compass_click(){$("#compass").hide()}function set_city_mapview_active(){city_canvas=document.getElementById("city_canvas");if(city_canvas==null)return;city_canvas_ctx=city_canvas.getContext("2d");city_canvas_ctx.font=canvas_text_font;mapview_canvas_ctx=city_canvas.getContext("2d");mapview["width"]=505;mapview["height"]=265;mapview["store_width"]=505;mapview["store_height"]=265;set_default_mapview_inactive()}function set_default_mapview_inactive(){$("#compass").hide();if(overview_active)$("#game_overview_panel").parent().hide();if(unitpanel_active)$("#game_unit_panel").parent().hide();if(chatbox_active){$("#game_chatbox_panel").parent().hide();$(".mobile_chatbox_dialog").hide();$("#dialog-extend-fixed-container").hide()}}function set_default_mapview_active(){$("#warcalc_tab").hide();if(show_compass)$("#compass").show();else $("#compass").hide();mapview_canvas_ctx=mapview_canvas.getContext("2d");mapview_canvas_ctx.font=canvas_text_font;var active_tab=$("#tabs").tabs("option","active");if(active_tab==TAB_CITIES){return}$("#dialog-extend-fixed-container").show();if(!is_small_screen()&&overview_active){$("#game_overview_panel").parent().show();$(".overview_dialog").position({my:"left bottom",at:"left bottom",of:window,within:$("#tabs-map")});if(overview_current_state=="minimized")$("#game_overview_panel").dialogExtend("minimize")}if(unitpanel_active){update_active_units_dialog()}if(chatbox_active){$("#game_chatbox_panel").parent().show();$(".mobile_chatbox_dialog").show();if(current_message_dialog_state=="minimized")$("#game_chatbox_panel").dialogExtend("minimize")}$("#tabs").tabs("option","active",0);$("#tabs-map").height("auto");tech_dialog_active=false;allow_right_click=false;keyboard_input=true;chatbox_scroll_to_bottom(false)}function enable_mapview_slide(ptile){var r=map_to_gui_pos(ptile["x"],ptile["y"]);var gui_x=r["gui_dx"];var gui_y=r["gui_dy"];gui_x-=mapview["width"]-tileset_tile_width>>1;gui_y-=mapview["height"]-tileset_tile_height>>1;var dx=gui_x-mapview["gui_x0"];var dy=gui_y-mapview["gui_y0"];mapview_slide["dx"]=dx;mapview_slide["dy"]=dy;mapview_slide["i"]=mapview_slide["max"];mapview_slide["start"]=(new Date).getTime();if(dx==0&&dy==0||mapview_slide["active"]||Math.abs(dx)>mapview["width"]||Math.abs(dy)>mapview["height"]){mapview_slide["active"]=false;update_map_canvas_full();return}mapview_slide["active"]=true;var new_width=mapview["width"]+Math.abs(dx);var new_height=mapview["height"]+Math.abs(dy);var old_width=mapview["store_width"];var old_height=mapview["store_height"];mapview_canvas=buffer_canvas;mapview_canvas_ctx=buffer_canvas_ctx;if(dx>=0&&dy<=0){mapview["gui_y0"]-=Math.abs(dy)}else if(dx<=0&&dy>=0){mapview["gui_x0"]-=Math.abs(dx)}else if(dx<=0&&dy<=0){mapview["gui_x0"]-=Math.abs(dx);mapview["gui_y0"]-=Math.abs(dy)}mapview["store_width"]=new_width;mapview["store_height"]=new_height;mapview["width"]=new_width;mapview["height"]=new_height;if(dx>=0&&dy>=0){update_map_canvas(old_width,0,dx,new_height);update_map_canvas(0,old_height,old_width,dy)}else if(dx<=0&&dy<=0){update_map_canvas(0,0,Math.abs(dx),new_height);update_map_canvas(Math.abs(dx),0,old_width,Math.abs(dy))}else if(dx<=0&&dy>=0){update_map_canvas(0,0,Math.abs(dx),new_height);update_map_canvas(Math.abs(dx),old_height,old_width,Math.abs(dy))}else if(dx>=0&&dy<=0){update_map_canvas(0,0,new_width,Math.abs(dy));update_map_canvas(old_width,Math.abs(dy),Math.abs(dx),old_height)}mapview_canvas=document.getElementById("canvas");mapview_canvas_ctx=mapview_canvas.getContext("2d");if(dx>=0&&dy>=0){buffer_canvas_ctx.drawImage(mapview_canvas,0,0,old_width,old_height,0,0,old_width,old_height)}else if(dx<=0&&dy<=0){buffer_canvas_ctx.drawImage(mapview_canvas,0,0,old_width,old_height,Math.abs(dx),Math.abs(dy),old_width,old_height)}else if(dx<=0&&dy>=0){buffer_canvas_ctx.drawImage(mapview_canvas,0,0,old_width,old_height,Math.abs(dx),0,old_width,old_height)}else if(dx>=0&&dy<=0){buffer_canvas_ctx.drawImage(mapview_canvas,0,0,old_width,old_height,0,Math.abs(dy),old_width,old_height)}mapview["store_width"]=old_width;mapview["store_height"]=old_height;mapview["width"]=old_width;mapview["height"]=old_height}var UO_dx=[],UO_dy=[];var UO_sx=[],UO_sy=[];var UO_vx=[],UO_vy=[];var UO_mx=[],UO_my=[];var num_cardinal_tileset_dirs=4;var cardinal_tileset_dirs=[DIR8_NORTH,DIR8_EAST,DIR8_SOUTH,DIR8_WEST];var DIR4_TO_DIR8=[DIR8_NORTH,DIR8_SOUTH,DIR8_EAST,DIR8_WEST];var NUM_CORNER_DIRS=4;var border_flag_offsets={1:{x:56,y:13},4:{x:56,y:28},3:{x:26,y:13},6:{x:26,y:28},2:{x:66,y:20},0:{x:42,y:6},5:{x:16,y:20},7:{x:42,y:34}};var current_select_sprite=0;var max_select_sprite=4;var explosion_anim_map={};var anim_swords_instead={};var show_tile_marker_instead={};const USER_MARK_1=1;const USER_MARK_2=2;const USER_MARK_3=3;const USER_MARK_4=4;const USER_MARKS=["","grid.usermark","grid.userarea","user.attention","grid.userspot"];var LAYER_TERRAIN1=0;var LAYER_TERRAIN2=1;var LAYER_TERRAIN3=2;var LAYER_ROADS=3;var LAYER_SPECIAL1=4;var LAYER_CITY1=5;var LAYER_SPECIAL2=6;var LAYER_UNIT=7;var LAYER_FOG=8;var LAYER_SPECIAL3=9;var LAYER_TILELABEL=10;var LAYER_CITYBAR=11;var LAYER_GOTO=12;var LAYER_COUNT=13;var EDGE_NS=0;var EDGE_WE=1;var EDGE_UD=2;var EDGE_LR=3;var EDGE_COUNT=4;var MATCH_NONE=0;var MATCH_SAME=1;var MATCH_PAIR=2;var MATCH_FULL=3;var CELL_WHOLE=0;var CELL_CORNER=1;var DARKNESS_NONE=0;var DARKNESS_ISORECT=1;var DARKNESS_CARD_SINGLE=2;var DARKNESS_CARD_FULL=3;var DARKNESS_CORNER=4;var terrain_match={"t.l0.hills1":MATCH_NONE,"t.l0.mountains1":MATCH_NONE,"t.l0.plains1":MATCH_NONE,"t.l0.desert1":MATCH_NONE};function tileset_has_tag(tagname){return sprites[tagname]!=null}function tileset_ruleset_entity_tag_str_or_alt(entity,kind_name){if(entity==null){console.log("No "+kind_name+" to return tag for.");return null}if(tileset_has_tag(entity["graphic_str"])){return entity["graphic_str"]}if(tileset_has_tag(entity["graphic_alt"])){return entity["graphic_alt"]}console.log("No graphic for "+kind_name+" "+entity["name"]);return null}function tileset_extra_graphic_tag(extra){return tileset_ruleset_entity_tag_str_or_alt(extra,"extra")}function tileset_unit_type_graphic_tag(utype){return tileset_ruleset_entity_tag_str_or_alt(utype,"unit type")}function tileset_building_graphic_tag(pimprovement){return tileset_ruleset_entity_tag_str_or_alt(pimprovement,"building")}function tileset_tech_graphic_tag(ptech){return tileset_ruleset_entity_tag_str_or_alt(ptech,"tech")}function tileset_extra_id_graphic_tag(extra_id){return tileset_extra_graphic_tag(extras[extra_id])}function tileset_extra_activity_graphic_tag(extra){if(extra==null){console.log("No extra to return tag for.");return null}if(tileset_has_tag(extra["activity_gfx"])){return extra["activity_gfx"]}if(tileset_has_tag(extra["act_gfx_alt"])){return extra["act_gfx_alt"]}if(tileset_has_tag(extra["act_gfx_alt2"])){return extra["act_gfx_alt2"]}console.log("No activity graphic for extra "+extra["name"]);return null}function tileset_extra_id_activity_graphic_tag(extra_id){return tileset_extra_activity_graphic_tag(extras[extra_id])}function fill_sprite_array(layer,ptile,pedge,pcorner,punit,pcity,citymode){var sprite_array=[];switch(layer){case LAYER_TERRAIN1:if(ptile!=null){var tterrain_near=tile_terrain_near(ptile);var pterrain=tile_terrain(ptile);sprite_array=sprite_array.concat(fill_terrain_sprite_layer(0,ptile,pterrain,tterrain_near))}break;case LAYER_TERRAIN2:if(ptile!=null){var tterrain_near=tile_terrain_near(ptile);var pterrain=tile_terrain(ptile);sprite_array=sprite_array.concat(fill_terrain_sprite_layer(1,ptile,pterrain,tterrain_near))}break;case LAYER_TERRAIN3:if(ptile!=null){var tterrain_near=tile_terrain_near(ptile);var pterrain=tile_terrain(ptile);sprite_array=sprite_array.concat(fill_terrain_sprite_layer(2,ptile,pterrain,tterrain_near));sprite_array=sprite_array.concat(fill_irrigation_sprite_array(ptile,pcity))}break;case LAYER_ROADS:if(ptile!=null){sprite_array=sprite_array.concat(fill_road_rail_sprite_array(ptile,pcity))}break;case LAYER_SPECIAL1:if(ptile!=null){if(draw_map_grid)sprite_array=sprite_array.concat(get_grid_line_sprites(ptile));sprite_array=sprite_array.concat(get_border_line_sprites(ptile));var spec_sprite=get_tile_specials_sprite(ptile);if(spec_sprite!=null)sprite_array.push(spec_sprite);if(tile_has_extra(ptile,EXTRA_MINE)){sprite_array.push({key:tileset_extra_id_graphic_tag(EXTRA_MINE)})}if(tile_has_extra(ptile,EXTRA_OIL_WELL)){sprite_array.push({key:tileset_extra_id_graphic_tag(EXTRA_OIL_WELL)})}sprite_array=sprite_array.concat(fill_layer1_sprite_array(ptile,pcity));if(tile_has_extra(ptile,EXTRA_HUT)){sprite_array.push({key:tileset_extra_id_graphic_tag(EXTRA_HUT)})}if(tile_has_extra(ptile,EXTRA_POLLUTION)){sprite_array.push({key:tileset_extra_id_graphic_tag(EXTRA_POLLUTION)})}if(tile_has_extra(ptile,EXTRA_FALLOUT)){sprite_array.push({key:tileset_extra_id_graphic_tag(EXTRA_FALLOUT)})}if(draw_border_flags)sprite_array=sprite_array.concat(get_frontier_flag_sprites(ptile))}break;case LAYER_CITY1:var polluted=tile_has_extra(ptile,EXTRA_POLLUTION);if(pcity!=null){if(polluted)sprite_array.push({key:"grid.pollute_ring"});var layer_sprite=get_city_fortifications_underlay_sprite(pcity);if(layer_sprite)sprite_array.push(layer_sprite);layer_sprite=get_city_coastal_underlay_sprite(pcity);if(layer_sprite)sprite_array.push(layer_sprite);sprite_array.push(get_city_sprite(pcity));layer_sprite=get_city_fortifications_overlay_sprite(pcity);if(layer_sprite)sprite_array.push(layer_sprite);layer_sprite=get_city_coastal_overlay_sprite(pcity);if(layer_sprite)sprite_array.push(layer_sprite);if(polluted)sprite_array.push({key:"grid.pollute_icon"});if(pcity["unhappy"]){sprite_array.push({key:"city.disorder"})}}else if(draw_highlighted_pollution&&polluted){sprite_array.push({key:"grid.pollute_ring"});sprite_array.push({key:"grid.pollute_icon"})}break;case LAYER_SPECIAL2:if(ptile!=null){sprite_array=sprite_array.concat(fill_layer2_sprite_array(ptile,pcity))}break;case LAYER_UNIT:var do_draw_unit=punit!=null&&(draw_units||ptile==null||draw_focus_unit&&unit_is_in_focus(punit));var is_stacked=false;if(do_draw_unit&&active_city==null){is_stacked=ptile["units"]!=null&&ptile["units"].length>1?ptile["units"].length:false;if(is_stacked>9)is_stacked=9;if(unit_is_in_focus(punit)){sprite_array.push(get_select_sprite())}sprite_array=sprite_array.concat(fill_unit_sprite_array(punit,is_stacked))}if(!pcity&&ptile!=null)sprite_array=sprite_array.concat(fill_layer3_sprite_array(ptile,is_stacked,punit));if(ptile!=null&&explosion_anim_map[ptile["index"]]!=null){var explode_step=explosion_anim_map[ptile["index"]];var swords=anim_swords_instead[ptile["index"]];if(!swords)swords=0;var marker=show_tile_marker_instead[ptile["index"]];key_prefix=swords?"swords.unit_":"explode.unit_";frame_repeat=swords?3:5;frame=Math.abs(Math.round((23-explode_step)/frame_repeat));explosion_anim_map[ptile["index"]]=explode_step-1;if(marker){key_prefix=explode_step>16&&explode_step<34?"":USER_MARKS[USER_MARK_1];frame=""}if(explode_step<=1){delete explosion_anim_map[ptile["index"]];delete anim_swords_instead[ptile["index"]];delete show_tile_marker_instead[ptile["index"]]}else{const xo=marker?0:unit_offset_x+swords*8;const yo=marker?0:unit_offset_y+swords*-15;sprite_array.push({key:key_prefix+frame,offset_x:xo,offset_y:yo})}}break;case LAYER_FOG:sprite_array=sprite_array.concat(fill_fog_sprite_array(ptile,pedge,pcorner));break;case LAYER_TILELABEL:if(ptile!=null&&ptile["label"]!=null&&ptile["label"].length>0){sprite_array.push(get_tile_label_text(ptile))}if(!user_marking_mode||!ptile)break;const tkey="cPlan"+ptile["index"];if(myGameVars[tkey]){sprite_array.push(get_user_mark_sprite(myGameVars[tkey]))}break;case LAYER_CITYBAR:if(draw_city_output&&active_city==null&&ptile!=null&&ptile["worked"]>0){var acity=cities[ptile["worked"]];if(acity){if(acity["food_output"]!=null){var ctile=city_tile(acity);var d=map_distance_vector(ctile,ptile);var idx=get_city_dxy_to_index(d[0],d[1],acity);var food_output=acity["food_output"].substring(idx,idx+1);var shield_output=acity["shield_output"].substring(idx,idx+1);var trade_output=acity["trade_output"].substring(idx,idx+1);sprite_array.push(get_city_food_output_sprite(food_output));sprite_array.push(get_city_shields_output_sprite(shield_output));sprite_array.push(get_city_trade_output_sprite(trade_output))}}}if(pcity!=null&&active_city==null&&show_citybar){sprite_array.push(get_city_info_text(pcity))}if(active_city!=null&&ptile!=null&&ptile["worked"]!=null&&active_city["id"]==ptile["worked"]&&active_city["food_output"]!=null){var ctile=city_tile(active_city);var d=map_distance_vector(ctile,ptile);var idx=get_city_dxy_to_index(d[0],d[1],active_city);var food_output=active_city["food_output"].substring(idx,idx+1);var shield_output=active_city["shield_output"].substring(idx,idx+1);var trade_output=active_city["trade_output"].substring(idx,idx+1);sprite_array.push(get_city_food_output_sprite(food_output));sprite_array.push(get_city_shields_output_sprite(shield_output));sprite_array.push(get_city_trade_output_sprite(trade_output))}else if(active_city!=null&&ptile!=null&&ptile["worked"]!=0){sprite_array.push(get_city_invalid_worked_sprite())}break;case LAYER_GOTO:if(ptile!=null&&ptile["goto_dir"]!=null){sprite_array=sprite_array.concat(fill_goto_line_sprite_array(ptile))}if(ptile!=null&&ptile["nuke"]>0){ptile["nuke"]=ptile["nuke"]-1;sprite_array.push({key:"explode.nuke",offset_x:-45,offset_y:-45})}break}return sprite_array}function fill_terrain_sprite_layer(layer_num,ptile,pterrain,tterrain_near){return fill_terrain_sprite_array(layer_num,ptile,pterrain,tterrain_near)}function fill_terrain_sprite_array(l,ptile,pterrain,tterrain_near){if(tile_types_setup["l"+l+"."+pterrain["graphic_str"]]==null){return[]}var dlp=tile_types_setup["l"+l+"."+pterrain["graphic_str"]];switch(dlp["sprite_type"]){case CELL_WHOLE:{switch(dlp["match_style"]){case MATCH_NONE:{var result_sprites=[];if(dlp["dither"]==true){for(var i=0;i<num_cardinal_tileset_dirs;i++){if(ts_tiles[tterrain_near[DIR4_TO_DIR8[i]]["graphic_str"]]==null)continue;var near_dlp=tile_types_setup["l"+l+"."+tterrain_near[DIR4_TO_DIR8[i]]["graphic_str"]];var terrain_near=pterrain["graphic_str"]=="arctic"&&!(near_dlp["dither"]==true)?"swamp":near_dlp["dither"]==true?tterrain_near[DIR4_TO_DIR8[i]]["graphic_str"]:pterrain["graphic_str"];var dither_tile=i+pterrain["graphic_str"]+"_"+terrain_near;var x=dither_offset_x[i];var y=dither_offset_y[i];result_sprites.push({key:dither_tile,offset_x:x,offset_y:y})}return result_sprites}else{return[{key:"t.l"+l+"."+pterrain["graphic_str"]+1}]}}case MATCH_SAME:{var tileno=0;var this_match_type=ts_tiles[pterrain["graphic_str"]]["layer"+l+"_match_type"];for(var i=0;i<num_cardinal_tileset_dirs;i++){if(ts_tiles[tterrain_near[i]["graphic_str"]]==null)continue;var that=ts_tiles[tterrain_near[i]["graphic_str"]]["layer"+l+"_match_type"];if(that==this_match_type){tileno|=1<<i}}var gfx_key="t.l"+l+"."+pterrain["graphic_str"]+"_"+cardinal_index_str(tileno);var y=tileset_tile_height-tileset[gfx_key][3];return[{key:gfx_key,offset_x:0,offset_y:y}]}}}case CELL_CORNER:{var W=normal_tile_width;var H=normal_tile_height;var iso_offsets=[[W/4,0],[W/4,H/2],[W/2,H/4],[0,H/4]];var this_match_index="l"+l+"."+pterrain["graphic_str"]in tile_types_setup?tile_types_setup["l"+l+"."+pterrain["graphic_str"]]["match_index"][0]:-1;var that_match_index="l"+l+"."+pterrain["graphic_str"]in tile_types_setup?tile_types_setup["l"+l+"."+pterrain["graphic_str"]]["match_index"][1]:-1;var result_sprites=[];for(var i=0;i<NUM_CORNER_DIRS;i++){var count=dlp["match_indices"];var array_index=0;var dir=dir_ccw(DIR4_TO_DIR8[i]);var x=iso_offsets[i][0];var y=iso_offsets[i][1];var m=["l"+l+"."+tterrain_near[dir_ccw(dir)]["graphic_str"]in tile_types_setup?tile_types_setup["l"+l+"."+tterrain_near[dir_ccw(dir)]["graphic_str"]]["match_index"][0]:-1,"l"+l+"."+tterrain_near[dir]["graphic_str"]in tile_types_setup?tile_types_setup["l"+l+"."+tterrain_near[dir]["graphic_str"]]["match_index"][0]:-1,"l"+l+"."+tterrain_near[dir_cw(dir)]["graphic_str"]in tile_types_setup?tile_types_setup["l"+l+"."+tterrain_near[dir_cw(dir)]["graphic_str"]]["match_index"][0]:-1];switch(dlp["match_style"]){case MATCH_NONE:break;case MATCH_SAME:var b1=m[2]!=this_match_index?1:0;var b2=m[1]!=this_match_index?1:0;var b3=m[0]!=this_match_index?1:0;array_index=array_index*2+b1;array_index=array_index*2+b2;array_index=array_index*2+b3;break;case MATCH_PAIR:return[];break;case MATCH_FULL:{var n=[];var j=0;for(;j<3;j++){var k=0;for(;k<count;k++){n[j]=k;if(m[j]==dlp["match_index"][k]){break}}}array_index=array_index*count+n[2];array_index=array_index*count+n[1];array_index=array_index*count+n[0]}break}array_index=array_index*NUM_CORNER_DIRS+i;result_sprites.push({key:cellgroup_map[pterrain["graphic_str"]+"."+array_index]+"."+i,offset_x:x,offset_y:y})}return result_sprites}}return[]}function check_sprite_type(sprite_type){if(sprite_type=="corner"){return CELL_CORNER}if(sprite_type=="single"){return CELL_WHOLE}if(sprite_type=="whole"){return CELL_WHOLE}return CELL_WHOLE}function fill_unit_sprite_array(punit,num_stacked){var id=punit["type"];var unit_offset=get_unit_anim_offset(punit);unit_offset=get_unit_anim_offset(punit);unit_offset=get_unit_anim_offset(punit);unit_offset=get_unit_anim_offset(punit);var result=[get_unit_nation_flag_sprite(punit,unit_offset)];if(result[0]["offset_x"]){result[0]["offset_x"]+=UO_sx[id];result[0]["offset_y"]-=UO_sy[id]-1}result.push({key:tileset_unit_type_graphic_tag(unit_type(punit)),offset_x:unit_offset["x"]+UO_dx[id],offset_y:unit_offset["y"]-UO_dy[id]});var activities=get_unit_activity_sprite(punit);if(activities!=null){activities["offset_x"]=activities["offset_x"]+unit_offset["x"];activities["offset_y"]=activities["offset_y"]+unit_offset["y"];result.push(activities);if(activities["connect"]==true){result.push({key:"unit.connect",offset_x:unit_offset["x"]-6,offset_y:activities["offset_y"]+unit_offset["y"]+19})}}if(should_ask_server_for_actions(punit)){result.push({key:"unit.action_decision_want",offset_x:unit_activity_offset_x+unit_offset["x"],offset_y:-unit_activity_offset_y+unit_offset["y"]})}if(unit_offset["x"]==0&&unit_offset["y"]==0){if(show_unit_movepct&&punit["movesleft"]!=null)result.push(get_mp_sprite(punit));result.push(get_unit_hp_sprite(punit));if(num_stacked){var push_right=0;if(!UO_sy[id]&&draw_stacked_unit_mode&dsum_RING){if(UO_sx[id]>0){result.push({key:"unit.stk_shld_r",offset_x:unit_offset["x"],offset_y:-31-unit_offset["y"]});push_right=2}else result.push({key:"unit.stk_shld_l",offset_x:unit_offset["x"]-UO_sx[id],offset_y:-31-unit_offset["y"]-UO_sy[id]})}var stacked=get_unit_stack_sprite(num_stacked);if(draw_stacked_unit_mode&dsum_SMALL){stacked["offset_x"]+=push_right}else{stacked["offset_x"]+=UO_mx[id];stacked["offset_y"]-=UO_my[id]}result.push(stacked)}}if(punit["veteran"]>0){var veteran=get_unit_veteran_sprite(punit);veteran["offset_x"]+=UO_vx[id]+unit_offset["x"];veteran["offset_y"]-=UO_vy[id]-unit_offset["y"];result.push(veteran)}return result}function fill_stacked_in_base_sprite_array(punit,num_stacked){var stacked=get_unit_stack_sprite(num_stacked);if(!(draw_stacked_unit_mode&dsum_SMALL)){var id=punit["type"];const mx=UO_mx[id];const my=UO_my[id];stacked["offset_x"]+=mx;stacked["offset_y"]-=my}return stacked}function dir_get_tileset_name(dir){switch(dir){case DIR8_NORTH:return"n";case DIR8_NORTHEAST:return"ne";case DIR8_EAST:return"e";case DIR8_SOUTHEAST:return"se";case DIR8_SOUTH:return"s";case DIR8_SOUTHWEST:return"sw";case DIR8_WEST:return"w";case DIR8_NORTHWEST:return"nw"}return""}function cardinal_index_str(idx){var c="";for(var i=0;i<num_cardinal_tileset_dirs;i++){var value=idx>>i&1;c+=dir_get_tileset_name(cardinal_tileset_dirs[i])+value}return c}function get_city_flag_sprite(pcity){var owner_id=pcity["owner"];if(owner_id==null)return{};var owner=players[owner_id];if(owner==null)return{};var nation_id=owner["nation"];if(nation_id==null)return{};var nation=nations[nation_id];if(nation==null)return{};return{key:"f."+nation["graphic_str"],offset_x:city_flag_offset_x,offset_y:-city_flag_offset_y}}function get_base_flag_sprite(ptile){var owner_id=ptile["extras_owner"];if(owner_id==null)return{};var owner=players[owner_id];if(owner==null)return{};var nation_id=owner["nation"];if(nation_id==null)return{};var nation=nations[nation_id];if(nation==null)return{};return{key:"f."+nation["graphic_str"],offset_x:buoy_flag_offset_x,offset_y:-buoy_flag_offset_y,scale:.6}}function get_city_occupied_sprite(pcity){var owner_id=pcity["owner"];var ptile=city_tile(pcity);var punits=tile_units(ptile);if(!observing&&client.conn.playing!=null&&owner_id!=client.conn.playing.playerno&&pcity["occupied"]){return"citybar.occupied"}else if(punits.length>0){return punits.length>=20?"citybar.occupancy_20":"citybar.occupancy_"+punits.length}else{return"citybar.occupancy_0"}}function get_city_food_output_sprite(num){return{key:"city.t_food_"+num,offset_x:normal_tile_width/4,offset_y:-normal_tile_height/4}}function get_city_shields_output_sprite(num){return{key:"city.t_shields_"+num,offset_x:normal_tile_width/4,offset_y:-normal_tile_height/4}}function get_city_trade_output_sprite(num){return{key:"city.t_trade_"+num,offset_x:normal_tile_width/4,offset_y:-normal_tile_height/4}}function get_city_invalid_worked_sprite(){return{key:"grid.unavailable",offset_x:0,offset_y:0}}function get_user_mark_sprite(index){return{key:USER_MARKS[index],offset_x:0,offset_y:0}}function fill_goto_line_sprite_array(ptile){return{key:"goto_line",goto_dir:ptile["goto_dir"]}}function get_frontier_flag_sprites(ptile){var result=[];var border_dirs={};var drawn_dirs={};for(var i=0;i<num_cardinal_tileset_dirs;i++){var dir=cardinal_tileset_dirs[i];var checktile=mapstep(ptile,dir);if(checktile!=null&&checktile["owner"]!=null&&ptile["owner"]!=null&&ptile["owner"]!=checktile["owner"]&&ptile["owner"]!=255&&players[ptile["owner"]]!=null){var pnation=nations[players[ptile["owner"]]["nation"]];border_dirs[dir]=true}}if(border_dirs[DIR8_NORTH]){if(border_dirs[DIR8_EAST]){drawn_dirs[DIR8_NORTHEAST]=true;drawn_dirs[DIR8_NORTH]=false;drawn_dirs[DIR8_EAST]=false}if(border_dirs[DIR8_WEST]){drawn_dirs[DIR8_NORTHWEST]=true;drawn_dirs[DIR8_NORTH]=false;drawn_dirs[DIR8_WEST]=false}}if(border_dirs[DIR8_SOUTH]){if(border_dirs[DIR8_EAST]){drawn_dirs[DIR8_SOUTHEAST]=true;drawn_dirs[DIR8_SOUTH]=false;drawn_dirs[DIR8_EAST]=false}if(border_dirs[DIR8_WEST]){drawn_dirs[DIR8_SOUTHWEST]=true;drawn_dirs[DIR8_SOUTH]=false;drawn_dirs[DIR8_WEST]=false}}if(border_dirs[DIR8_NORTH]&&drawn_dirs[DIR8_NORTH]===undefined)drawn_dirs[DIR8_NORTH]=true;if(border_dirs[DIR8_EAST]&&drawn_dirs[DIR8_EAST]===undefined)drawn_dirs[DIR8_EAST]=true;if(border_dirs[DIR8_WEST]&&drawn_dirs[DIR8_WEST]===undefined)drawn_dirs[DIR8_WEST]=true;if(border_dirs[DIR8_SOUTH]&&drawn_dirs[DIR8_SOUTH]===undefined)drawn_dirs[DIR8_SOUTH]=true;if(drawn_dirs[DIR8_NORTHEAST]&&drawn_dirs[DIR8_NORTHWEST]){drawn_dirs[DIR8_NORTHEAST]=false;drawn_dirs[DIR8_NORTHWEST]=false;drawn_dirs[DIR8_NORTH]=true}else if(drawn_dirs[DIR8_NORTHEAST]&&drawn_dirs[DIR8_SOUTHEAST]){drawn_dirs[DIR8_NORTHEAST]=false;drawn_dirs[DIR8_SOUTHEAST]=false;drawn_dirs[DIR8_EAST]=true}else if(drawn_dirs[DIR8_SOUTHEAST]&&drawn_dirs[DIR8_SOUTHWEST]){drawn_dirs[DIR8_SOUTHEAST]=false;drawn_dirs[DIR8_SOUTHWEST]=false;drawn_dirs[DIR8_SOUTH]=true}else if(drawn_dirs[DIR8_SOUTHWEST]&&drawn_dirs[DIR8_NORTHWEST]){drawn_dirs[DIR8_SOUTHWEST]=false;drawn_dirs[DIR8_NORTHWEST]=false;drawn_dirs[DIR8_WEST]=true}for(const dir in drawn_dirs){if(drawn_dirs[dir]){result.push({key:"f."+pnation["graphic_str"],offset_x:border_flag_offsets[dir].x,offset_y:border_flag_offsets[dir].y,scale:.4})}}return result}function get_border_line_sprites(ptile){var result=[];for(var i=0;i<num_cardinal_tileset_dirs;i++){var dir=cardinal_tileset_dirs[i];var checktile=mapstep(ptile,dir);if(checktile!=null&&checktile["owner"]!=null&&ptile["owner"]!=null&&ptile["owner"]!=checktile["owner"]&&ptile["owner"]!=255&&players[ptile["owner"]]!=null){var pnation=nations[players[ptile["owner"]]["nation"]];result.push({key:"border",dir:dir,color:pnation.color,color2:pnation.color2,color3:pnation.color3})}}return result}function get_grid_line_sprites(ptile){var result=[];for(var i=0;i<num_cardinal_tileset_dirs/2;i++){var dir=cardinal_tileset_dirs[i];var checktile=mapstep(ptile,dir);if(checktile!=null){if(terrains[ptile["terrain"]]["name"]=="Deep Ocean")result.push({key:"mapgrid",dir:dir,color:"rgba(66,57,47,1.0)"});else result.push({key:"mapgrid",dir:dir,color:"rgba(0,0,0,0.35)"})}}return result}function get_unit_nation_flag_sprite(punit,unit_offset){var owner_id=punit["owner"];var owner=players[owner_id];var nation_id=owner["nation"];var nation=nations[nation_id];return{key:"f.shield."+nation["graphic_str"],offset_x:unit_flag_offset_x+unit_offset["x"],offset_y:-unit_flag_offset_y+unit_offset["y"]}}function get_html_nation_shield_sprite(nation){var tag="f.shield."+nation["graphic_str"];var sprite={type:null,sprite:get_sprite_from_tag(tag)};var shield_sprite=sprite["sprite"];return"<span class='v' title='"+nation["adjective"]+"' style='cursor:help;"+"background: transparent url("+shield_sprite["image-src"]+");transform: scale(1.0); background-position:-"+shield_sprite["tileset-x"]+"px -"+shield_sprite["tileset-y"]+"px;  width: "+shield_sprite["width"]+"px;height: "+shield_sprite["height"]+"px;"+" content-align: left;"+"vertical-align:top; float:left;'>"+"</span>"}function get_unit_nation_flag_normal_sprite(punit){var owner_id=punit["owner"];var owner=players[owner_id];var nation_id=owner["nation"];var nation=nations[nation_id];var unit_offset=get_unit_anim_offset(punit);return{key:"f."+nation["graphic_str"],offset_x:unit_flag_offset_x+unit_offset["x"],offset_y:-unit_flag_offset_y+unit_offset["y"]}}function get_unit_stack_sprite(stacksize){if(draw_stacked_unit_mode&dsum_SMALL){return{key:"unit.stack"+stacksize+"",offset_x:unit_flag_offset_x+-25,offset_y:-unit_flag_offset_y-15}}else return{key:"unit.stack",offset_x:unit_flag_offset_x+-25,offset_y:-unit_flag_offset_y-15}}function get_unit_hp_sprite(punit){var hp=punit["hp"];var unit_type=unit_types[punit["type"]];var max_hp=unit_type["hp"];var healthpercent=10*Math.floor(20*hp/max_hp)/2;var unit_offset=get_unit_anim_offset(punit);var bar_offset=punit["movesleft"]!=null?hp_bar_offset:0;return{key:"unit.hp_"+healthpercent,offset_x:unit_flag_offset_x+-25+unit_offset["x"],offset_y:-unit_flag_offset_y-15+bar_offset+unit_offset["y"]}}function get_mp_sprite(punit){var mp=punit["movesleft"];var unit_type=unit_types[punit["type"]];var max_mp=unit_type["move_rate"];var movepercent=10*Math.floor(20*mp/max_mp)/2;if(movepercent>100)movepercent=100;var unit_offset=get_unit_anim_offset(punit);return{key:"unit.hp_"+movepercent,offset_x:unit_flag_offset_x+-25+unit_offset["x"],offset_y:-unit_flag_offset_y-15+unit_offset["y"]}}function get_full_hp_sprite(punit){var hp=punit["hp"];var unit_type=unit_types[punit["type"]];var max_hp=unit_type["hp"];var healthpercent=10*Math.floor(20*hp/max_hp)/2;var tag="unit.hp_"+healthpercent;return get_sprite_from_tag(tag)}function get_html_hp_sprite(punit,unit_panel_pos){var htype_sprite={type:null,sprite:get_full_hp_sprite(punit)};var hp_sprite=htype_sprite["sprite"];var left_adj=-90;var top_adj=-16;if(unit_panel_pos){left_adj-=12;top_adj+=1}return"<div style='pointer-events: none; margin-left:"+left_adj+"px; margin-top:"+top_adj+"px; margin-right: -96px; float:left; content-align:left;"+"background: transparent url("+hp_sprite["image-src"]+");transform: scale(0.5); background-position:-"+hp_sprite["tileset-x"]+"px -"+hp_sprite["tileset-y"]+"px;  width: "+hp_sprite["width"]+"px;height: "+hp_sprite["height"]+"px;"+" content-align: left;"+"vertical-align:top; float:left;'>"+"</div>"}function get_full_mp_sprite(punit){var mp=punit["movesleft"];var unit_type=unit_types[punit["type"]];var max_mp=unit_type["move_rate"];var movepercent=10*Math.floor(20*mp/max_mp)/2;if(movepercent>100)movepercent=100;var tag="unit.hp_"+movepercent;return get_sprite_from_tag(tag)}function get_html_mp_sprite(punit,unit_panel_pos){var mtype_sprite={type:null,sprite:get_full_mp_sprite(punit)};var mp_sprite=mtype_sprite["sprite"];var left_adj=-90;var top_adj=-13;if(unit_panel_pos){left_adj-=12;top_adj+=1}return"<div style='pointer-events: none; margin-left:"+left_adj+"; margin-top:"+top_adj+"px; margin-right: -64px; float:left; content-align:left;"+"background: transparent url("+mp_sprite["image-src"]+");transform: scale(0.5); background-position:-"+mp_sprite["tileset-x"]+"px -"+mp_sprite["tileset-y"]+"px;  width: "+mp_sprite["width"]+"px;height: "+mp_sprite["height"]+"px;"+" content-align: left;"+"vertical-align:top; float:left;'>"+"</div>"}function get_full_vet_sprite(punit){if(punit["veteran"]>0){var tag="unit.vet_"+punit["veteran"];return get_sprite_from_tag(tag)}else return null}function get_html_vet_sprite(punit){if(!punit["veteran"]||punit["veteran"]<1)return"";var vtype_sprite={type:null,sprite:get_full_vet_sprite(punit)};var vet_sprite=vtype_sprite["sprite"];return"<div style='pointer-events: none; margin-left:-46px; margin-top:-24px; margin-right: -24px; float:left; content-align:left;"+"background: transparent url("+vet_sprite["image-src"]+");transform: scale(1.0); background-position:-"+vet_sprite["tileset-x"]+"px -"+vet_sprite["tileset-y"]+"px;  width: "+vet_sprite["width"]+"px;height: "+vet_sprite["height"]+"px;"+" content-align: left;"+"vertical-align:top; float:left;'>"+"</div>"}function get_html_activity_sprite(punit){var proto_sprite=get_unit_activity_sprite(punit);if(proto_sprite){var atype_sprite={type:null,sprite:get_sprite_from_tag(proto_sprite["key"])};var action_sprite=atype_sprite["sprite"];var ml=-25;var mr=-14;var mt=-14;if(proto_sprite["key"]=="unit.auto_settler"){ml-=38;mr-=30;mt=-9}return"<div style='pointer-events: none; margin-left:"+ml+"px; margin-top:"+mt+"px; margin-right: "+mr+"px; float:left; content-align:left;"+"background: transparent url("+action_sprite["image-src"]+");transform: scale(0.95); background-position:-"+action_sprite["tileset-x"]+"px -"+action_sprite["tileset-y"]+"px;  width: "+action_sprite["width"]+"px;height: "+action_sprite["height"]+"px;"+" content-align: left;"+"vertical-align:top; float:left;'>"+"</div>"}return""}function get_sprite_from_tag(tag){if(!tag)return null;var tileset_x=tileset[tag][0];var tileset_y=tileset[tag][1];var width=tileset[tag][2];var height=tileset[tag][3];var i=tileset[tag][4];return{tag:tag,"image-src":"/tileset/freeciv-web-tileset-"+tileset_name+"-"+i+get_tileset_file_extention()+"?ts="+ts,"tileset-x":tileset_x,"tileset-y":tileset_y,width:width,height:height}}function get_unit_veteran_sprite(punit){return{key:"unit.vet_"+punit["veteran"],offset_x:unit_activity_offset_x-20,offset_y:-unit_activity_offset_y-10}}function get_unit_activity_sprite(punit){var activity=punit["activity"];var act_tgt=punit["activity_tgt"];if(punit["transported"]){if(activity==ACTIVITY_SENTRY||activity==ACTIVITY_IDLE)return{key:"unit.cargo",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y}}switch(activity){case ACTIVITY_GEN_ROAD:return{key:tileset_extra_id_activity_graphic_tag(act_tgt),offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y,connect:punit["orders_length"]>0?true:false};case ACTIVITY_IRRIGATE:return{key:-1==act_tgt?"unit.irrigate":tileset_extra_id_activity_graphic_tag(act_tgt),offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y,connect:punit["orders_length"]>0?true:false};case ACTIVITY_CULTIVATE:return{key:"unit.irrigate",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y};case ACTIVITY_GOTO:return{key:"unit.goto",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y};case ACTIVITY_FORTIFYING:if(client_rules_flag[CRF_EXTRA_HIDEOUT]){if(tile_has_extra(tiles[punit["tile"]],EXTRA_)){return{key:"unit.fortifying_hidden",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y}}}return{key:"unit.fortifying",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y};case ACTIVITY_SENTRY:if(client_rules_flag[CRF_EXTRA_HIDEOUT]){if(tile_has_extra(tiles[punit["tile"]],EXTRA_)){return{key:"unit.sentry_hidden",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y}}}return{key:"unit.sentry",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y};case ACTIVITY_FORTIFIED:if(client_rules_flag[CRF_EXTRA_HIDEOUT]){if(tile_has_extra(tiles[punit["tile"]],EXTRA_)){return{key:"unit.fortified_hidden",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y}}}return{key:"unit.fortified",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y};case ACTIVITY_MINE:return{key:-1==act_tgt?"unit.plant":tileset_extra_id_activity_graphic_tag(act_tgt),offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y};case ACTIVITY_PLANT:return{key:"unit.plant",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y};case ACTIVITY_BASE:return{key:tileset_extra_id_activity_graphic_tag(act_tgt),offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y};case ACTIVITY_PILLAGE:return{key:"unit.pillage",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y};case ACTIVITY_VIGIL:return{key:"unit.vigil",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y};case ACTIVITY_EXPLORE:return{key:"unit.auto_explore",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y};case ACTIVITY_TRANSFORM:return{key:"unit.transform",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y};case ACTIVITY_POLLUTION:return{key:"unit.pollution",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y};case ACTIVITY_FALLOUT:return{key:"unit.fallout",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y};case ACTIVITY_CONVERT:return{key:"unit.convert",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y}}if(unit_has_goto(punit)){if(punit["movesleft"]>0&&punit["done_moving"]==false&&punit["changed_from"]==activity&&!(typeof server_settings["unitwaittime_style"]==="undefined")&&server_settings["unitwaittime_style"]["val"]&4&&act_tgt==punit["changed_from_tgt"]){return{key:"unit.goto_delay",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y}}return{key:"unit.goto",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y}}if(punit["ai"]==true){return{key:"unit.auto_settler",offset_x:20,offset_y:-unit_activity_offset_y}}if(client_rules_flag[CRF_EXTRA_HIDEOUT]){if(tile_has_extra(tiles[punit["tile"]],EXTRA_)){return{key:"unit.hidden",offset_x:unit_activity_offset_x,offset_y:-unit_activity_offset_y}}}return null}function get_city_coastal_overlay_sprite(pcity){if(pcity["walls"]&2){return{key:"city.coastal_overlay",offset_x:-4,offset_y:-24}}return null}function get_city_coastal_underlay_sprite(pcity){if(pcity["walls"]&2){return{key:"city.coastal_underlay",offset_x:-4,offset_y:-24}}return null}function get_city_fortifications_overlay_sprite(pcity){if(pcity["walls"]&4&&!(pcity["walls"]&1)){return{key:"city.fortifications_overlay",offset_x:-4,offset_y:-24}}return null}function get_city_fortifications_underlay_sprite(pcity){if(pcity["walls"]&4&&!(pcity["walls"]&1)){return{key:"city.fortifications_underlay",offset_x:-4,offset_y:-24}}return null}function get_city_sprite(pcity){var style_id=pcity["style"];if(style_id==-1)style_id=0;var city_rule=city_rules[style_id];var size=0;if(pcity["size"]>=4&&pcity["size"]<=7){size=1}else if(pcity["size"]>=8&&pcity["size"]<=11){size=2}else if(pcity["size"]>=12&&pcity["size"]<=15){size=3}else if(pcity["size"]>=16){size=4}var city_walls=pcity["walls"]&1?"wall":"city";var tag=city_rule["graphic"]+"_"+city_walls+"_"+size;if(sprites[tag]==null){tag=city_rule["graphic_alt"]+"_"+city_walls+"_"+size}return{key:tag,offset_x:-4,offset_y:-24}}function fill_fog_sprite_array(ptile,pedge,pcorner){var i,tileno=0;if(pcorner==null)return[];for(i=3;i>=0;i--){var unknown=0,fogged=1,known=2;var value=-1;if(pcorner["tile"][i]==null){value=unknown}else{switch(tile_get_known(pcorner["tile"][i])){case TILE_KNOWN_SEEN:value=known;break;case TILE_KNOWN_UNSEEN:value=fogged;break;case TILE_UNKNOWN:value=unknown;break}}tileno=tileno*3+value}if(tileno>=80)return[];return[{key:fullfog[tileno]}]}function get_select_sprite(){current_select_sprite=Math.floor((new Date).getTime()*6/1e3)%max_select_sprite;return{key:"unit.select"+current_select_sprite}}function get_city_info_text(pcity){return{key:"city_text",city:pcity,offset_x:citybar_offset_x,offset_y:citybar_offset_y}}function get_tile_label_text(ptile){return{key:"tile_label",tile:ptile,offset_x:tilelabel_offset_x,offset_y:tilelabel_offset_y}}function get_tile_specials_sprite(ptile){const extra_id=tile_resource(ptile);if(extra_id!==null){const extra=extras[extra_id];if(extra!=null){if(tile_get_known(ptile)==TILE_KNOWN_UNSEEN&&extras[extra_id].disappearance_chance!=RS_DEFAULT_EXTRA_DISAPPEARANCE)return null;return{key:extra["graphic_str"]}}}return null}function get_tile_river_like_sprite(ptile,extra,prefix){if(ptile==null){return null}var extra2=extra;var integrate_extras=[];if(typeof EXTRA_NAVALBASE!=="undefined"){if(typeof EXTRA_WATERWAY==="undefined"){if(extra==EXTRA_RIVER){extra2=EXTRA_NAVALBASE;integrate_extras=[EXTRA_NAVALBASE,EXTRA_CANAL]}else if(extra==EXTRA_CANAL){extra2=EXTRA_NAVALBASE;integrate_extras=[EXTRA_NAVALBASE,EXTRA_RIVER]}else if(extra==EXTRA_NAVALBASE){extra2=EXTRA_RIVER;integrate_extras=[EXTRA_RIVER,EXTRA_CANAL]}}else{if(extra==EXTRA_RIVER){extra2=EXTRA_NAVALBASE;integrate_extras=[EXTRA_WATERWAY,EXTRA_NAVALBASE,EXTRA_CANAL]}else if(extra==EXTRA_CANAL){extra2=EXTRA_NAVALBASE;integrate_extras=[EXTRA_WATERWAY,EXTRA_NAVALBASE,EXTRA_RIVER]}else if(extra==EXTRA_WATERWAY){extra2=EXTRA_NAVALBASE;integrate_extras=[EXTRA_RIVER,EXTRA_CANAL,EXTRA_NAVALBASE]}else if(extra==EXTRA_NAVALBASE){extra2=EXTRA_RIVER;integrate_extras=[EXTRA_RIVER,EXTRA_CANAL,EXTRA_WATERWAY]}}}if(typeof EXTRA_SEABRIDGE!=="undefined"&&extra==EXTRA_SEABRIDGE){if(tile_has_extra(ptile,extra)){var river_str="";for(var i=0;i<num_cardinal_tileset_dirs;i++){var dir=cardinal_tileset_dirs[i];var checktile=mapstep(ptile,dir);if(checktile&&(tile_has_extra(checktile,extra)||!is_ocean_tile(checktile)||tile_has_extra(checktile,EXTRA_ROAD))){river_str=river_str+dir_get_tileset_name(dir)+"1"}else{river_str=river_str+dir_get_tileset_name(dir)+"0"}}return{key:prefix+"_s_"+river_str}}var pterrain=tile_terrain(ptile);if(pterrain["graphic_str"]!="coast"){for(var i=0;i<num_cardinal_tileset_dirs;i++){var dir=cardinal_tileset_dirs[i];var checktile=mapstep(ptile,dir);if(checktile!=null&&(tile_has_extra(checktile,extra)||tile_has_extra(checktile,extra2))){return{key:prefix+"_outlet_"+dir_get_tileset_name(dir)}}}}}else{if(tile_has_extra(ptile,extra)){var river_str="";for(var i=0;i<num_cardinal_tileset_dirs;i++){var dir=cardinal_tileset_dirs[i];var checktile=mapstep(ptile,dir);if(checktile&&(tile_has_extra(checktile,extra)||is_ocean_tile(checktile)||tile_has_extra(checktile,integrate_extras[0])||tile_has_extra(checktile,integrate_extras[1])||tile_has_extra(checktile,integrate_extras[2]))){river_str=river_str+dir_get_tileset_name(dir)+"1"}else{river_str=river_str+dir_get_tileset_name(dir)+"0"}}return{key:prefix+"_s_"+river_str}}var pterrain=tile_terrain(ptile);if(pterrain["graphic_str"]=="coast"){for(var i=0;i<num_cardinal_tileset_dirs;i++){var dir=cardinal_tileset_dirs[i];var checktile=mapstep(ptile,dir);if(checktile!=null&&(tile_has_extra(checktile,extra)||tile_has_extra(checktile,extra2))){return{key:prefix+"_outlet_"+dir_get_tileset_name(dir)}}}}}return null}function get_unit_image_sprite(punit){var from_type=get_unit_type_image_sprite(unit_type(punit));if(from_type!=null&&from_type["height"]!=null)from_type["height"]=from_type["height"]-2;return from_type}function get_unit_type_image_sprite(punittype){var tag=tileset_unit_type_graphic_tag(punittype);if(tag==null){return null}var tileset_x=tileset[tag][0];var tileset_y=tileset[tag][1];var width=tileset[tag][2];var height=tileset[tag][3];var i=tileset[tag][4];return{tag:tag,"image-src":"/tileset/freeciv-web-tileset-"+tileset_name+"-"+i+get_tileset_file_extention()+"?ts="+ts,"tileset-x":tileset_x,"tileset-y":tileset_y,width:width,height:height}}function get_improvement_image_sprite(pimprovement){var tag=tileset_building_graphic_tag(pimprovement);if(tag==null){return null}var tileset_x=tileset[tag][0];var tileset_y=tileset[tag][1];var width=tileset[tag][2];var height=tileset[tag][3];var i=tileset[tag][4];return{tag:tag,"image-src":"/tileset/freeciv-web-tileset-"+tileset_name+"-"+i+get_tileset_file_extention()+"?ts="+ts,"tileset-x":tileset_x,"tileset-y":tileset_y,width:width,height:height}}function get_specialist_image_sprite(tag){if(tileset[tag]==null)return null;var tileset_x=tileset[tag][0];var tileset_y=tileset[tag][1];var width=tileset[tag][2];var height=tileset[tag][3];var i=tileset[tag][4];return{tag:tag,"image-src":"/tileset/freeciv-web-tileset-"+tileset_name+"-"+i+get_tileset_file_extention()+"?ts="+ts,"tileset-x":tileset_x,"tileset-y":tileset_y,width:width,height:height}}function get_technology_image_sprite(ptech){var tag=tileset_tech_graphic_tag(ptech);if(tag==null)return null;var tileset_x=tileset[tag][0];var tileset_y=tileset[tag][1];var width=tileset[tag][2];var height=tileset[tag][3];var i=tileset[tag][4];return{tag:tag,"image-src":"/tileset/freeciv-web-tileset-"+tileset_name+"-"+i+get_tileset_file_extention()+"?ts="+ts,"tileset-x":tileset_x,"tileset-y":tileset_y,width:width,height:height}}function get_nation_flag_sprite(pnation){var tag="f."+pnation["graphic_str"];if(tileset[tag]==null)return null;var tileset_x=tileset[tag][0];var tileset_y=tileset[tag][1];var width=tileset[tag][2];var height=tileset[tag][3];var i=tileset[tag][4];return{tag:tag,"image-src":"/tileset/freeciv-web-tileset-"+tileset_name+"-"+i+get_tileset_file_extention()+"?ts="+ts,"tileset-x":tileset_x,"tileset-y":tileset_y,width:width,height:height}}function get_treaty_agree_thumb_up(){var tag="treaty.agree_thumb_up";var tileset_x=tileset[tag][0];var tileset_y=tileset[tag][1];var width=tileset[tag][2];var height=tileset[tag][3];var i=tileset[tag][4];return{tag:tag,"image-src":"/tileset/freeciv-web-tileset-"+tileset_name+"-"+i+get_tileset_file_extention()+"?ts="+ts,"tileset-x":tileset_x,"tileset-y":tileset_y,width:width,height:height}}function get_treaty_disagree_thumb_down(){var tag="treaty.disagree_thumb_down";var tileset_x=tileset[tag][0];var tileset_y=tileset[tag][1];var width=tileset[tag][2];var height=tileset[tag][3];var i=tileset[tag][4];return{tag:tag,"image-src":"/tileset/freeciv-web-tileset-"+tileset_name+"-"+i+get_tileset_file_extention()+"?ts="+ts,"tileset-x":tileset_x,"tileset-y":tileset_y,width:width,height:height}}function fill_road_rail_sprite_array(ptile,pcity){var road=tile_has_extra(ptile,EXTRA_ROAD);var rail=tile_has_extra(ptile,EXTRA_RAIL);const MAGLEV_active=typeof EXTRA_MAGLEV!=="undefined";const CANAL_active=typeof EXTRA_CANAL!=="undefined";const WATERWAY_active=typeof EXTRA_WATERWAY!=="undefined";const QUAY_active=typeof EXTRA_QUAY!=="undefined";const SEABRIDGE_active=typeof EXTRA_SEABRIDGE!=="undefined";if(MAGLEV_active){var maglev=tile_has_extra(ptile,EXTRA_MAGLEV)}if(SEABRIDGE_active){var seabridge=tile_has_extra(ptile,EXTRA_SEABRIDGE)}var road_near=[];var rail_near=[];var maglev_near=[];var draw_rail=[];var draw_road=[];var draw_maglev=[];var result_sprites=[];var draw_single_road=road==true&&pcity==null&&rail==false;var draw_single_rail=rail&&pcity==null;var draw_single_maglev=maglev==true&&pcity==null&&maglev==false;for(var dir=0;dir<8;dir++){var tile1=mapstep(ptile,dir);if(tile1!=null&&tile_get_known(tile1)!=TILE_UNKNOWN){road_near[dir]=tile_has_extra(tile1,EXTRA_ROAD);if(QUAY_active)road_near[dir]|=tile_has_extra(tile1,EXTRA_QUAY);rail_near[dir]=tile_has_extra(tile1,EXTRA_RAIL);if(SEABRIDGE_active){if(cardinal_tileset_dirs.includes(dir)){road_near[dir]|=tile_has_extra(tile1,EXTRA_SEABRIDGE)}else{if(seabridge||tile_has_extra(tile1,EXTRA_SEABRIDGE))rail_near[dir]=false}}if(MAGLEV_active)maglev_near[dir]=tile_has_extra(tile1,EXTRA_MAGLEV);if(MAGLEV_active){draw_maglev[dir]=maglev&&maglev_near[dir];draw_rail[dir]=rail&&rail_near[dir]&&!draw_maglev[dir];draw_road[dir]=road&&road_near[dir]&&!draw_rail[dir]&&!draw_maglev[dir];draw_single_maglev&=!draw_maglev[dir];draw_single_rail&=!draw_maglev[dir]&&!draw_rail[dir];draw_single_road&=!draw_maglev[dir]&&!draw_rail[dir]&&!draw_road[dir]}else{draw_rail[dir]=rail&&rail_near[dir];draw_road[dir]=road&&road_near[dir]&&!draw_rail[dir];draw_single_rail&=!draw_rail[dir];draw_single_road&=!draw_rail[dir]&&!draw_road[dir]}}}var i;if(road){for(i=0;i<8;i++){if(draw_road[i]){result_sprites.push({key:"road.road_"+dir_get_tileset_name(i)})}}}var river_sprite=get_tile_river_like_sprite(ptile,EXTRA_RIVER,"road.river");var canal_sprite=null;var seabridge_sprite=null;if(CANAL_active){canal_sprite=get_tile_river_like_sprite(ptile,EXTRA_CANAL,"road.canal")}if(!canal_sprite&&WATERWAY_active){canal_sprite=get_tile_river_like_sprite(ptile,EXTRA_WATERWAY,"road.canal")}if(SEABRIDGE_active){seabridge_sprite=get_tile_river_like_sprite(ptile,EXTRA_SEABRIDGE,"road.sea_bridge")}if(river_sprite!=null)result_sprites.push(river_sprite);if(canal_sprite!=null)result_sprites.push(canal_sprite);if(seabridge_sprite!=null)result_sprites.push(seabridge_sprite);if(rail){for(i=0;i<8;i++){if(draw_rail[i]){result_sprites.push({key:"road.rail_"+dir_get_tileset_name(i)})}}}if(MAGLEV_active){if(maglev){for(i=0;i<8;i++){if(draw_maglev[i]){result_sprites.push({key:"road.maglev_"+dir_get_tileset_name(i)})}}}}if(draw_single_rail){result_sprites.push({key:"road.rail_isolated"})}else if(draw_single_road){result_sprites.push({key:"road.road_isolated"})}else if(MAGLEV_active){if(draw_single_maglev){result_sprites.push({key:"road.maglev_isolated"})}}return result_sprites}function fill_irrigation_sprite_array(ptile,pcity){var result_sprites=[];if(tile_has_extra(ptile,EXTRA_IRRIGATION)&&pcity==null){if(tile_has_extra(ptile,EXTRA_FARMLAND)){result_sprites.push({key:tileset_extra_id_graphic_tag(EXTRA_FARMLAND)})}else{result_sprites.push({key:tileset_extra_id_graphic_tag(EXTRA_IRRIGATION)})}}return result_sprites}function fill_layer1_sprite_array(ptile,pcity){var result_sprites=[];if(pcity==null){if(typeof EXTRA_NAVALBASE!=="undefined"){if(tile_has_extra(ptile,EXTRA_NAVALBASE)){var river_sprite=get_tile_river_like_sprite(ptile,EXTRA_NAVALBASE,"road.river");if(river_sprite!=null)result_sprites.push(river_sprite);result_sprites.push({key:"base.navalbase_bg",offset_y:-normal_tile_height/2});return result_sprites}}if(typeof EXTRA_BUNKER!=="undefined"){if(tile_has_extra(ptile,EXTRA_BUNKER)){return result_sprites}}if(typeof EXTRA_CASTLE!=="undefined"){if(tile_has_extra(ptile,EXTRA_CASTLE)){result_sprites.push({key:"base.castle_bg",offset_y:-normal_tile_height/2});return result_sprites}}if(tile_has_extra(ptile,EXTRA_FORTRESS)){result_sprites.push({key:"base.fortress_bg",offset_y:-normal_tile_height/2})}else if(typeof EXTRA_FORT!=="undefined"){if(tile_has_extra(ptile,EXTRA_FORT)){result_sprites.push({key:"base.outpost_bg",offset_y:-normal_tile_height/2})}}}return result_sprites}function fill_layer2_sprite_array(ptile,pcity){var result_sprites=[];if(pcity==null){if(typeof EXTRA_BUNKER!=="undefined"&&tile_has_extra(ptile,EXTRA_BUNKER)){result_sprites.push({key:"base.bunker_mg",offset_y:-normal_tile_height/2});return result_sprites}if(tile_has_extra(ptile,EXTRA_AIRBASE)){result_sprites.push({key:"base.airbase_mg",offset_y:-normal_tile_height/2})}else if(tile_has_extra(ptile,EXTRA_BUOY)){result_sprites.push(get_base_flag_sprite(ptile));result_sprites.push({key:"base.buoy_mg",offset_y:-normal_tile_height/2})}if(tile_has_extra(ptile,EXTRA_FORTRESS)||typeof EXTRA_NAVALBASE!=="undefined"&&tile_has_extra(ptile,EXTRA_NAVALBASE)){result_sprites.push(get_base_flag_sprite(ptile))}if(tile_has_extra(ptile,EXTRA_RUINS)){result_sprites.push({key:"extra.ruins_mg",offset_y:-normal_tile_height/2})}if(typeof EXTRA_RADAR!=="undefined"){if(tile_has_extra(ptile,EXTRA_RADAR)){result_sprites.push({key:"base.radar_mg",offset_y:-normal_tile_height/2})}}if(typeof EXTRA_QUAY!=="undefined"){if(tile_has_extra(ptile,EXTRA_QUAY)){result_sprites.push({key:"base.quay_mg",offset_y:-normal_tile_height/2})}}}return result_sprites}function fill_layer3_sprite_array(ptile,stacked,st_unit){var result_sprites=[];if(typeof EXTRA_BUNKER!=="undefined"){if(tile_has_extra(ptile,EXTRA_BUNKER)){return result_sprites}}if(typeof EXTRA_CASTLE!=="undefined"){if(tile_has_extra(ptile,EXTRA_CASTLE)){result_sprites.push({key:"base.castle_fg",offset_y:-normal_tile_height/2});if(stacked)result_sprites.push(fill_stacked_in_base_sprite_array(st_unit,stacked));return result_sprites}}if(tile_has_extra(ptile,EXTRA_FORTRESS)){result_sprites.push({key:"base.fortress_fg",offset_y:-normal_tile_height/2});if(stacked)result_sprites.push(fill_stacked_in_base_sprite_array(st_unit,stacked));return result_sprites}if(typeof EXTRA_NAVALBASE!=="undefined"){if(tile_has_extra(ptile,EXTRA_NAVALBASE)){result_sprites.push({key:"base.navalbase_fg",offset_y:-normal_tile_height/2});if(stacked)result_sprites.push(fill_stacked_in_base_sprite_array(st_unit,stacked));return result_sprites}}if(typeof EXTRA_FORT!=="undefined"){if(tile_has_extra(ptile,EXTRA_FORT)){result_sprites.push({key:"base.outpost_fg",offset_y:-normal_tile_height/2});if(stacked)result_sprites.push(fill_stacked_in_base_sprite_array(st_unit,stacked));return result_sprites}}return result_sprites}function create_unit_offset_arrays(){var num_utypes=Object.keys(unit_types).length;for(i=0;i<num_utypes;i++){var ptype=unit_types[i];var dx=unit_offset_adj_x;var dy=unit_offset_adj_y;var sx=0,sy=0;var vx=0,vy=0;var mx=-10,my=-19;switch(ptype["name"]){case"AEGIS Cruiser":dx-=2;dy-=7;vx-=11;vy+=8;mx-=6;my+=7;break;case"Alpine Troops":dx-=3;dy-=1;vx-=4;vy-=4;break;case"Archer":dx+=1;vx-=8;vy-=8;break;case"Armor":vx+=12;vy+=11;break;case"Armor II":vx+=11;vy+=4;break;case"Artillery":dx-=12;vx+=8;vy-=8;break;case"AWACS":dx-=17;dy+=3;mx-=7;my+=6;sx=8;break;case"Battleship":dx-=5;dy-=7;vx+=4;vy-=11;break;case"Cannon":vx+=1;vy-=4;break;case"Caravan":dx-=0;dy-=3;break;case"Caravel":dx-=3;dy-=3;vx+=3;vy-=3;break;case"Carrier":dx-=3;dy-=4;vx-=12;vy+=12;mx-=10;my+=7;break;case"Cargo Ship":dx-=1;dy-=2;mx-=6;my+=7;break;case"Catapult":vx-=14;vy+=15;dx+=2;dy-=2;break;case"Cavalry":vx+=5;vy-=15;dx+=4;dy-=3;break;case"Chariot":sx=8;dx-=2;dy-=3;vx-=11;vy+=4;mx-=6;my+=7;break;case"Cruiser":vx-=13;vy+=15;break;case"Cruise Missile":dx-=8;dy-=7;vx-=23;vy+=15;break;case"Crusaders":vx-=3;vy-=12;break;case"Destroyer":dx-=3;dy-=3;vx-=13;vy+=12;break;case"Diplomat":dx+=1;dy-=2;break;case"Dive Bomber":sx=8;dx-=11;dy-=1;vx-=3;vy-=4;mx+=2;my-=2;break;case"Dragoons":dx-=3;dy-=4;vx-=48;vy-=16;break;case"Engineers":dx-=3;dy-=4;break;case"Elephants":vx+=8;vy-=9;dx-=6;dy-=7;break;case"Escort Fighter":sx=8;dx-=8;dy-=4;vx+=2;vy+=2;mx-=6;my+=4;break;case"Explorer":dx-=0;dy+=2;break;case"Falconeers":dx+=2;dy+=2;vx+=3;vy-=5;break;case"Fighter":sx=8;dx-=11;dy-=6;vx-=14;vy+=10;break;case"Frigate":vx+=3;vy+=2;break;case"Galley":vx-=12;vy+=14;break;case"Ground Strike Fighter":sx=8;dx+=2;dy-=1;vx-=4;vy+=15;mx-=6;my+=7;break;case"Heavy Bomber":case"Bomber":sx=8;dx+=2;dy+=2;vx-=13;vy+=12;mx-=6;my+=5;break;case"Helicopter":sx=8;vx+=5;vy-=5;mx-=6;my+=7;break;case"Horsemen":dx-=3;dy-=3;vx-=47;vy-=16;break;case"Howitzer":dx-=9;dy+=1;vx-=43;vy-=9;break;case"Ironclad":dx-=4;dy-=5;vx+=5;vy+=2;break;case"Jet Bomber":sx=8;dx-=24;dy+=7;vx+=11;vy+=1;mx+=3;my-=3;break;case"Jet Fighter":dx+=2;dy+=3;vx+=9;vy+=16;break;case"Knights":dx+=3;dy-=3;vx+=9;vy+=4;break;case"Legion":vx+=1;vy-=7;break;case"Marines":dx+=2;dy+=2;vx-=11;vy-=13;break;case"Mechanized Infantry":case"Mech. Inf.":vx-=23;vy+=13;break;case"Medium Bomber":sx=8;dx+=5;dy+=2;vx+=7;vy+=18;break;case"Missile Destroyer":dx-=3;dy-=3;vx-=12;vy+=11;break;case"Musketeers":dx-=3;dy-=3;vx-=3;vy-=19;break;case"Phalanx":dx+=0;dy-=3;vx+=2;vy-=8;break;case"Paratroopers":vy-=7;break;case"Pikemen":dx+=1;dy-=4;vx-=1;vy-=7;break;case"Riflemen":dx-=4;dy-=2;vx-=9;vy-=4;break;case"Ram Ship":vx-=1;vy-=1;break;case"Settlers":dx-=3;dy-=2;break;case"Siege Ram":dx-=2;dy-=4;vx+=3;vy+=2;break;case"Spy Plane":sx=8;dx-=27;dy+=0;mx-=4;my-=6;break;case"Stealth Bomber":dx-=19;dy-=5;vx-=53;vy+=1;mx-=2;my-=1;break;case"Stealth Fighter":dx-=2;dy-=1;vx+=4;vy-=14;break;case"Strategic Bomber":sx=8;dx-=3;dy+=4;vx-=13;vy+=15;mx-=2;my-=1;break;case"Submarine":dx-=3;dy-=4;vx-=11;vy+=8;break;case"Train":dx+=5;dy-=8;break;case"Transport":dx-=3;dy-=1;vx-=23;vy+=12;break;case"Transport Helicopter":vx-=24;vy+=15;break;case"Trireme":vx+=2;vy+=1;break;case"Wagon":dx-=9;dy-=5;mx-=7;my-=3;break;case"War Galley":vx-=4;vy+=3;break;case"Warriors":dx-=3;dy-=2;vx-=2;vy-=2;break;case"Zeppelin":sx=-13;sy=5;dx-=19;dy+=4;vx+=11;vy-=5;mx+=3;my-=3;break}if(mx==-10&&my==-19){mx-=5;my+=6}UO_dx[i]=dx+unit_offset_x;UO_dy[i]=dy+unit_offset_y;UO_sx[i]=sx;UO_sy[i]=sy;UO_vx[i]=vx;UO_vy[i]=vy;UO_mx[i]=mx;UO_my[i]=my}}